<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>1.çº¿æ€§ä»£æ•°</title>
      <link href="/2022/08/12/xuan-ran/ta-ru-men/2.xian-xing-dai-shu/"/>
      <url>/2022/08/12/xuan-ran/ta-ru-men/2.xian-xing-dai-shu/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ä»€ä¹ˆäº‹æ˜¯çº¿æ€§ä»£æ•°">ä¸€ã€ä»€ä¹ˆäº‹æ˜¯çº¿æ€§ä»£æ•°</h2><p>â€ƒé¡¾åæ€ä¹‰ï¼Œå®ƒæ˜¯ç ”ç©¶çº¿æ€§é—®é¢˜çš„ä»£æ•°ç†è®ºã€‚</p><p>â€ƒä»£æ•°è‹±æ–‡æ˜¯Algebraï¼Œæºäºé˜¿æ‹‰ä¼¯è¯­ï¼Œå…¶æœ¬æ„æ˜¯â€œç»“åˆåœ¨ä¸€èµ·â€çš„æ„æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ä»£æ•°çš„åŠŸèƒ½æ˜¯æŠŠè®¸å¤šçœ‹ä¼¼ä¸ç›¸å…³çš„äº‹ç‰©â€œç»“åˆåœ¨ä¸€èµ·â€ï¼Œä¹Ÿå°±æ˜¯è¿›è¡ŒæŠ½è±¡ã€‚æŠ½è±¡çš„ç›®çš„ä¸æ˜¯ä¸ºäº†æ˜¾ç¤ºæŸäº›äººæ™ºå•†é«˜ï¼Œè€Œæ˜¯ä¸ºäº†è§£å†³é—®é¢˜çš„æ–¹ä¾¿ï¼Œä¸ºäº†æé«˜æ•ˆç‡ï¼ŒæŠŠè®¸å¤šçœ‹ä¼¼ä¸ç›¸å…³çš„é—®é¢˜åŒ–å½’ä¸ºä¸€ç±»é—®é¢˜ã€‚æ¯”å¦‚çº¿æ€§ä»£æ•°ä¸­çš„ä¸€ä¸ªé‡è¦çš„æŠ½è±¡æ¦‚å¿µæ˜¯çº¿æ€§ç©ºé—´ï¼ˆå¯¹æ‰€è°“çš„è¦æ»¡è¶³â€œåŠ æ³•â€å’Œâ€œæ•°ä¹˜â€ç­‰å…«æ¡å…¬ç†çš„å…ƒç´ çš„é›†åˆï¼‰ï¼Œè€Œå…¶å…ƒç´ è¢«ç§°ä¸ºå‘é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦æŸä¸ªé›†åˆé‡Œçš„å…ƒç´ æ»¡è¶³é‚£ä¹ˆå‡ æ¡å…¬ç†ï¼Œå…ƒç´ ä¹‹é—´çš„å˜åŒ–æ»¡è¶³è¿™äº›è§„å¾‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹è¿™ä¸ªé›†åˆï¼ˆç°åœ¨å¯ä»¥æ”¹åä¸ºçº¿æ€§ç©ºé—´äº†ï¼‰è¿›è¡Œä¸€ç³»åˆ—çº¿æ€§åŒ–å¤„ç†å’Œåˆ†æï¼Œè¿™ä¸ªé™Œç”Ÿçš„é›†åˆçš„æ€§è´¨å’Œç»“æ„ç‰¹ç‚¹æˆ‘ä»¬ä¸€ä¸‹å­å°±å…¨çŸ¥é“äº†ï¼Œå› ä¸ºå®‡å®™é—´çš„æ‰€æœ‰çš„çº¿æ€§ç©ºé—´ç±»çš„é›†åˆçš„æ€§è´¨éƒ½ä¸€æ ·ï¼Œåœ°çƒäººéƒ½çŸ¥é“ï¼ˆå¦‚æœåœ°çƒäººéƒ½å­¦äº†çº¿æ€§ä»£æ•°çš„è¯ï¼‰ã€‚å¤šä¹ˆæ·±åˆ»è€Œç¾å¦™çš„ç»“è®ºï¼è¿™å°±æ˜¯ä»£æ•°çš„ä¸€ä¸ªæŠ½è±¡ç‰¹æ€§ã€‚</p><h3 id="çº¿æ€§çš„æ„ä¹‰">1.1 çº¿æ€§çš„æ„ä¹‰</h3><p>â€ƒçº¿æ€§ä»£æ•°é‡Œé¢çš„çº¿æ€§ä¸»è¦çš„æ„æ€å°±æ˜¯çº¿æ€§ç©ºé—´é‡Œçš„çº¿æ€§å˜æ¢ã€‚</p><p>â€ƒçº¿æ€§å‡½æ•°è¡¨ç°ä¸ºç›´çº¿ï¼Œè¿™åªæ˜¯å‡ ä½•æ„ä¹‰ã€‚é‚£ä¹ˆæ‰€è°“â€œçº¿æ€§â€çš„ä»£æ•°æ„ä¹‰æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå®é™…ä¸Šï¼Œæœ€åŸºæœ¬çš„æ„ä¹‰åªæœ‰ä¸¤æ¡ï¼šå¯åŠ æ€§å’Œæ¯”ä¾‹æ€§ã€‚</p><ol type="1"><li><p>å¯åŠ æ€§,<strong>å’Œçš„å‡½æ•°ç­‰äºå‡½æ•°çš„å’Œ</strong>ã€‚å³å¦‚æœå‡½æ•°<span class="math inline">\(f(x)\)</span>æ˜¯çº¿æ€§çš„ï¼Œé‚£ä¹ˆæœ‰ï¼š <span class="math display">\[f(x_1 + x_2) = f(x_1) + f(x_2)\]</span></p></li><li><p>æ¯”ä¾‹æ€§ï¼Œ<strong>æ¯”ä¾‹çš„å‡½æ•°ç­‰äºå‡½æ•°çš„æ¯”ä¾‹ï¼›æˆ–è€…è¯´è‡ªå˜é‡ç¼©æ”¾ï¼Œå‡½æ•°ä¹ŸåŒç­‰æ¯”ä¾‹åœ°ç¼©æ”¾</strong>ã€‚ä¹Ÿå«å…¶æ¬¡æ€§ã€æ•°ä¹˜æ€§æˆ–å‡åŒ€æ€§,å¦‚æœ<span class="math inline">\(f(x)\)</span>æ˜¯çº¿æ€§ï¼Œé‚£ä¹ˆæœ‰ï¼š <span class="math display">\[f(kx) = kf(x) , å…¶ä¸­ k æ˜¯å¸¸é‡ã€‚\]</span></p></li></ol><blockquote><p>ğŸ’¡ æ³¨ï¼šå¯¹äºå‡½æ•° <span class="math inline">\(f(x) = ax + b\)</span>è€Œè¨€ä¸æ»¡è¶³æ­¤æ¯”ä¾‹æ€§ï¼Œ <span class="math inline">\(f(kx) = akx +b\)</span>, <span class="math inline">\(kf(x) = akx + kb\)</span>å› æ­¤<span class="math inline">\(f(kx) \ne kf(x)\)</span>ã€‚ä¸¥æ ¼çš„è®²ï¼Œ <span class="math inline">\(f(x) = ax + b\)</span> ä¸èƒ½å†å«çº¿æ€§å‡½æ•°äº†ã€‚</p></blockquote><p>å¯åŠ æ€§ä¸æ¯”ä¾‹æ€§ç»„åˆåœ¨ä¸€å—å°±æ˜¯â€œçº¿æ€§â€çš„å…¨éƒ¨æ„ä¹‰äº†ï¼Œ<strong>çº¿æ€§ç»„åˆçš„å‡½æ•°ï¼Œç­‰äºå‡½æ•°çš„çº¿æ€§ç»„åˆã€‚</strong>ï¼Œå³æœ‰:<span class="math display">\[f(k_1x_1 + k_2x_2) = k_1f(x_1) + k_2f(x_2), å…¶ä¸­ k_1, k_2 æ˜¯å¸¸é‡ã€‚\]</span></p><p>â€ƒçº¿æ€§å‡½æ•°çš„å¯åŠ æ€§è¡¨æ˜å‡½æ•°æ‰€æè¿°çš„äº‹ç‰©å…·æœ‰ç´¯åŠ æ€§ï¼Œæ‰€æœ‰èµ·å› çš„ç´¯åŠ æ‰€å¯¼è‡´çš„ç»“æœå®Œå…¨ç­‰äºæ¯ä¸ªèµ·å› ç‹¬è‡ªæ‰€å¼•èµ·çš„ç»“æœçš„ç´¯åŠ ã€‚</p><blockquote><p>ğŸ’¡ æ³¨ï¼šçº¿æ€§é½æ¬¡å‡½æ•°å½¢å¦‚ $ y = k_1x_1 + k_2x_2 +...k_nx_n$ï¼Œè¿™ä¸ªæ­£æ¯”ä¾‹å‡½æ•°çš„å¼å­ä¸­æ¯é¡¹é‡Œçš„å˜é‡å‡ºç°çš„æ¬¡æ•°éƒ½æ˜¯ä¸€æ¬¡çš„ï¼ˆæ²¡æœ‰å¸¸æ•°é¡¹ï¼‰ï¼Œ<strong>æ•´é½åˆ’ä¸€</strong>ï¼Œæ•…æ­¤ç§°ä¸ºâ€œé½æ¬¡â€çš„ï¼Œå…¨ç§°ä¸ºn å…ƒçº¿æ€§é½æ¬¡å‡½æ•°ã€‚</p></blockquote><ol type="1"><li>åˆç­‰çº¿æ€§å‡½æ•°çš„è‡ªå˜é‡ç”±ä¸€ä¸ªæ•°<span class="math inline">\(x\)</span>æ‹“å±•å®šä¹‰ä¸ºä¸€ä¸ªç«–æ’çš„æ•°ç»„<span class="math inline">\(\begin{pmatrix}x_1 \\x_2 \\...\\x_m\end{pmatrix}\)</span>, å› å˜é‡ä¸€ä¸ªæ•°<span class="math inline">\(y\)</span>ä¹Ÿæ‹“å±•å®šä¹‰ä¸ºä¸€ä¸ªç«–æ’çš„æ•°ç»„<span class="math inline">\(\begin{pmatrix}y_1 \\y_2 \\...\\y_m\end{pmatrix}\)</span>, è¿™äº› nå…ƒæ•°ç»„å’Œmå…ƒæ•°ç»„ç§°ä¹‹ä¸ºåˆ—å‘é‡ã€‚</li><li>åˆç­‰çº¿æ€§å‡½æ•°çš„æ¯”ä¾‹ç³»æ•°<span class="math inline">\(k\)</span>æ‹“å±•ä¸ºç”±æ‰€æœ‰çš„<span class="math inline">\(k_{ij}\)</span>æ„æˆä¸€ä¸ªæ•°çš„æ–¹é’ˆï¼Œç§°ä¹‹ä¸ºç³»æ•°çŸ©é˜µå¦‚ä¸‹ï¼š&gt; å› ä¸º <span class="math inline">\(y_1 = kf(x_1)\)</span> çš„æ—¶å€™<span class="math inline">\(k\)</span>, è™½ä¸ºå¸¸é‡,æšä¸¾å…¨åˆ™æœ‰ <span class="math inline">\(n\)</span>ä¸ªï¼Œ å› æ­¤æ‹“å±•ä¸ºè¡Œ <span class="math inline">\(\begin{pmatrix}k_1 &amp; k_2 &amp; ...&amp;k_n\end{pmatrix}\)</span>ã€‚ å†éšç€<span class="math inline">\(x,y\)</span>æ‹“å±•, å› æ­¤æ‹“å±•ä¸º<span class="math inline">\(mn\)</span>ç³»æ•°çŸ©é˜µã€‚</li></ol><p><span class="math display">\[\begin{bmatrix}    k_{11} &amp; k_{12}  &amp; ...... k_{1n}\\    k_{21} &amp; k_{22}  &amp; ...... k_{2n}\\    ...    &amp; ...     &amp; ..........   \\    k_{m1} &amp; k_{m2}  &amp; ...... k_{mn}\\  \end{bmatrix}\]</span></p><ol start="3" type="1"><li><p>ç„¶åå®šä¹‰ä¸€ç§ç³»æ•°çŸ©é˜µä¸å‘é‡ç›¸ä¹˜çš„è¿ç®—æ³•åˆ™ï¼š &gt;çŸ©é˜µè¿ç®—é¡ºåº,ç”±å·¦å‘å³ã€‚ <span class="math display">\[\begin{pmatrix}y_1\\y_2 \\ ...\\y_m\end{pmatrix}= \begin{bmatrix}k_{11} &amp; k_{12}  &amp; ...... k_{1n}\\k_{21} &amp; k_{22}  &amp; ...... k_{2n}\\...    &amp; ...     &amp; ..........   \\k_{m1} &amp; k_{m2}  &amp; ...... k_{mn}\\  \end{bmatrix}  \begin{pmatrix}x_1 \\x_2 \\ ...\\x_m\end{pmatrix}  \]</span></p></li><li><p>è¿›ä¸€æ­¥ç®€å†™ä¸ºï¼šy = f(x) = Kx ,å…¶ä¸­ï¼š <span class="math display">\[y= f(x) = \begin{pmatrix}y_1 \\y_2 \\ ...\\y_m\end{pmatrix},K = \begin{bmatrix}k_{11} &amp; k_{12}  &amp; ...... k_{1n}\\k_{21} &amp; k_{22}  &amp; ...... k_{2n}\\...    &amp; ...     &amp; ..........   \\k_{m1} &amp; k_{m2}  &amp; ...... k_{mn}\\  \end{bmatrix},  x = \begin{pmatrix}x_1 \\x_2 \\ ...\\x_m\end{pmatrix}  \]</span></p></li></ol><h4 id="å¤šå…ƒçº¿æ€§å‡½æ•°çš„å‡ ä½•æ„ä¹‰">å¤šå…ƒçº¿æ€§å‡½æ•°çš„å‡ ä½•æ„ä¹‰</h4><p>ä¸€å…ƒçº¿æ€§å‡½æ•°<span class="math inline">\(f(x) = kx\)</span>,æ‹“å±•åˆ°äºŒå…ƒçº¿æ€§å‡½æ•°$ f(x_1,x_2) = k_1x_1 + k_2x_2$ 1.åæ ‡ç³»ç”±äºŒç»´æ‹“å±•ä¸ºä¸‰ç»´ï¼š <span class="math inline">\(f(x) = kx\)</span>çš„ç›´çº¿å›¾å½¢æ˜¯åœ¨äºŒç»´ç¬›å¡å°”åæ ‡ä¸‹çš„å‡ ä½•å›¾å½¢ï¼Œæ”¾åˆ°ä¸‰ç»´ç¬›å¡å°”åæ ‡ç³»ä¸‹ï¼Œåº”å†™ä¸º$ f(x_1, x_2) = k_1x_1<span class="math inline">\(, æˆ–è€…\)</span> f(x_1,x_2) = k_2x_2<span class="math inline">\(, å–\)</span> f(x_1, x_2) =k_1x_1$ ä¸º$ f(x) = kx$çš„æ‹“å±•ç»´è¡¨è¾¾å¼ã€‚ &gt; ä¸€å…ƒåªæœ‰ä¸€ä¸ªå˜é‡, $ f(x) =kx$è¡¨è¾¾å¼, ç®€å•æ¥è¯´ ä¸€å…ƒæ˜¯äºŒå…ƒçš„å…¶ä¸­ä¸€ä¸ªå…ƒä¸º<code>0</code>çš„ç‰¹ä¾‹ã€‚</p><p><span class="math inline">\(f(x1, x_2) =k_1x_1\)</span>çš„å›¾å½¢æ˜¯è¿‡åŸç‚¹çš„å¹³é¢ã€‚ä¹Ÿå°±æ˜¯è¯´æ‹“ç»´åç”±ä¸€æ¡ç›´çº¿å˜æˆäº†ä¸€ä¸ªå¹³é¢ã€‚è¿™æ˜¯å› ä¸ºå‡½æ•°$f(x_1, x_2) = k_1x_1$ ä¸æ–°ç”Ÿé•¿å‡ºæ¥çš„åæ ‡è½´<span class="math inline">\(x_2\)</span>æ²¡æœ‰å…³ç³»ï¼Œ<span class="math inline">\(x_2\)</span>å¯ä»¥å–ä»»æ„å€¼ï¼›æ¢å¥è¯è¯´ï¼Œ <span class="math inline">\(x_2\)</span>çš„ ä»»æ„å€¼éƒ½åœ¨å‡½æ•° <span class="math inline">\(f(x1, x_2) =k_1x_1\)</span>çš„å›¾åƒä¸Šã€‚è¿›ä¸€æ­¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿‡ <span class="math inline">\(x_2\)</span>åæ ‡è½´çš„å¹³é¢ <img src="/imgs/matrix2.png"></p><ol start="2" type="1"><li>ä¸¤ä¸ªå¹³é¢åŠ èµ·æ¥ï¼Œæ˜¾ç„¶è¦å¾—åˆ°å‡½æ•°$ f(x_1,x_2) = k_1x_1 + k_2x_2<span class="math inline">\(çš„å›¾å½¢ï¼Œåªè¦æŠŠä¸‰ç»´åæ ‡ç³»ä¸‹çš„ä¸¤ä¸ªå‡½æ•°\)</span>f(x_1,x_2) = k_1x_1$ å’Œ $ f(x_2,x_2) =k_2x_2$æ‰€å¯¹åº”çš„å¹³é¢åŠ èµ·æ¥å³å¯å¾—åˆ°ã€‚<strong>ä¸€èˆ¬æƒ…å½¢ä¸‹ï¼Œä¸¤ä¸ªå¹³é¢ç›¸åŠ ä»ç„¶æ˜¯ä¸€ä¸ªå¹³é¢</strong><img src="/imgs/matrix3.png"> <img src="/imgs/matrix4.png"></li></ol><p>å› æ­¤ï¼Œçº¿æ€§å‡½æ•°$ f(x_1,x_2) = k_1x_1 +k_2x_2$çš„å‡ ä½•å›¾å½¢æ˜¯ä¸€ä¸ªè¿‡åŸç‚¹çš„å¹³é¢ã€‚</p><p>â€ƒå¯ä»¥æƒ³è±¡ï¼Œç”±äºŒå…ƒçº¿æ€§å‡½æ•° 1 2 11 2 (, ) 2 f x x kx kx = +ç»§ç»­æ‰©å±•åˆ°ä¸‰å…ƒåŠ n å…ƒçš„çº¿æ€§å‡½æ•° 1 2 11 2 2 ( , ..., ) ... n n n f x x xkx kx kx = + ++ ï¼ˆåæ ‡ç³»ç”±ä¸‰ç»´æ‰©å±•åˆ°å››ç»´åŠå…¶ n ç»´ï¼‰åï¼Œå…¶å‡ ä½•å›¾å½¢ä»ç„¶æ˜¯ä¸€ä¸ªâ€œå¹³é¢â€ï¼Œæ˜¯ä¸€ä¸ªæ‰©å±•æ„ä¹‰ä¸Šçš„å¹³é¢ï¼Œå¸¸è¢«ç§°ä¸ºè¶…å¹³é¢ã€‚</p><h3 id="çº¿æ€§æ˜ å°„æˆ–å˜æ¢çš„å‡ ä½•æ„ä¹‰">1.2 çº¿æ€§æ˜ å°„æˆ–å˜æ¢çš„å‡ ä½•æ„ä¹‰</h3><p>TODO</p>]]></content>
      
      
      <categories>
          
          <category> å›¾å½¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¸²æŸ“ </tag>
            
            <tag> å›¾å½¢ </tag>
            
            <tag> TA </tag>
            
            <tag> 3Dæ•°å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/godot-yin-qing/5.shu-xue-ku/"/>
      <url>/2022/08/10/godot-yin-qing/5.shu-xue-ku/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/godot-yin-qing/4.othercore/"/>
      <url>/2022/08/10/godot-yin-qing/4.othercore/</url>
      
        <content type="html"><![CDATA[<blockquote><ul><li>ustirng</li><li>NodePath</li><li>rid</li></ul></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/godot-yin-qing/3.rong-qi-shu-ju-jie-gou-jie-kou/"/>
      <url>/2022/08/10/godot-yin-qing/3.rong-qi-shu-ju-jie-gou-jie-kou/</url>
      
        <content type="html"><![CDATA[<h2 id="å®¹å™¨">å®¹å™¨</h2><blockquote><ul><li>vectoråŠ¨æ€æ•°ç»„</li><li>table</li><li>set</li><li>map</li><li>array</li><li>dictionary</li></ul></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/godot-yin-qing/2.yuan-ma-fen-xi-os-zhi-nei-cun/"/>
      <url>/2022/08/10/godot-yin-qing/2.yuan-ma-fen-xi-os-zhi-nei-cun/</url>
      
        <content type="html"><![CDATA[<h2 id="os1ä¹‹å†…å­˜memoryç¯‡">OS(1)ä¹‹å†…å­˜Memoryç¯‡</h2><hr><p>title: å†…å­˜Memory<br>date: 2020-09-25 19:07:05<br>categories: 3då¼•æ“<br>mathjax: false</p><hr><blockquote><p>ä¸»è¦æ–‡ä»¶ <a href="">core/os/memory.h</a> ã€<a href="">core/os/memory.cpp</a></p><ol type="1"><li><p>å°è£…åŸå§‹çš„mallocã€freeã€newã€deleteã€‚å¥½å¤„æ˜¯æ·»åŠ è‡ªå®šä¹‰å¼•ç”¨å¤´å’Œå†…å­˜ç»Ÿè®¡åˆ†æç­‰ã€‚</p></li><li><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>   <span class="co">//c é£æ ¼æ¥å£</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>   memalloc<span class="op">()</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>   memrealloc<span class="op">()</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>   memfree<span class="op">()</span></span></code></pre></div></li><li><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">//c++ é£æ ¼æ¥å£</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>memnew<span class="op">(</span> Class <span class="op">/</span> Class<span class="op">(</span>args<span class="op">)</span> <span class="op">)</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>memdelete<span class="op">(</span> instance <span class="op">)</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>memnew_arr<span class="op">(</span> Class <span class="op">,</span> amount <span class="op">)</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>memdelete_arr<span class="op">(</span> pointer to array <span class="op">)</span></span></code></pre></div></li><li><p>todo</p><ol type="1"><li>åŸå­æ“ä½œ åŠ å‡ã€‚</li><li>åŠ¨æ€å†…å­˜ poolvector&lt;&gt;æ¨¡æ¿</li></ol></li></ol></blockquote><ol type="1"><li><p>ä½¿ç”¨ç±»<code>Memory</code>é™æ€æˆå‘˜ï¼Œå…¨å±€å”¯ä¸€ç»Ÿè®¡å’Œè°ƒç”¨ã€‚</p><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Memory <span class="op">{</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    Memory<span class="op">();</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef DEBUG_ENABLED</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">uint64_t</span> mem_usage<span class="op">;</span> <span class="co">// å†…å­˜ä½¿ç”¨é‡ï¼Œç”³è¯·å’Œé‡Šæ”¾è¿›è¡Œç»Ÿè®¡</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">uint64_t</span> max_usage<span class="op">;</span> <span class="co">//</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">uint64_t</span> alloc_count<span class="op">;</span><span class="co">//å†…å­˜å—ä¸ªæ•°ï¼Œç”³è¯·å’Œé‡Šæ”¾è¿›è¡Œç»Ÿè®¡</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">//å°è£…åŸå§‹ç”³è¯·å‡½æ•°ï¼Œdebug or p_pad_alignä¸ºtrue æ—¶è¿›è¡Œç»Ÿè®¡</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">void</span> <span class="op">*</span>alloc_static<span class="op">(</span><span class="dt">size_t</span> p_bytes<span class="op">,</span> <span class="dt">bool</span> p_pad_align <span class="op">=</span> <span class="kw">false</span><span class="op">);</span> </span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">//å°è£…åŸå§‹ç”³è¯·å‡½æ•°ï¼Œdebug or p_pad_alignä¸ºtrue æ—¶è¿›è¡Œç»Ÿè®¡</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">void</span> <span class="op">*</span>realloc_static<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>p_memory<span class="op">,</span> <span class="dt">size_t</span> p_bytes<span class="op">,</span> <span class="dt">bool</span> p_pad_align <span class="op">=</span> <span class="kw">false</span><span class="op">);</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">//å°è£…åŸå§‹é‡Šæ”¾å‡½æ•°ï¼Œdebug or p_pad_alignä¸ºtrue æ—¶è¿›è¡Œç»Ÿè®¡</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">void</span> free_static<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>p_ptr<span class="op">,</span> <span class="dt">bool</span> p_pad_align <span class="op">=</span> <span class="kw">false</span><span class="op">);</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">uint64_t</span> get_mem_available<span class="op">();</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">uint64_t</span> get_mem_usage<span class="op">();</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">static</span> <span class="dt">uint64_t</span> get_mem_max_usage<span class="op">();</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div></li><li><p>Memory å®ç°</p><p>``` cpp</p><h1 id="ifdef-debug_enabled-debug-æƒ…å†µæ‰æœ‰ç”¨å¹¶é™æ€åˆå§‹åŒ–">ifdefDEBUG_ENABLED // debug æƒ…å†µæ‰æœ‰ç”¨å¹¶é™æ€åˆå§‹åŒ–</h1><p>uint64_t Memory::mem_usage = 0;<br>uint64_t Memory::max_usage = 0;</p><h1 id="endif">endif</h1><p>uint64_t Memory::alloc_count = 0;</p><p>void *Memory::alloc_static(size_t p_bytes, bool p_pad_align) { #ifdef DEBUG_ENABLED bool prepad = true;</p><h1 id="else">else</h1><p>bool prepad = p_pad_align; # endif</p><p>//å¤´éƒ¨å›ºå®š 16å­—èŠ‚ï¼ˆå¯ä»¥å®¹çº³ å››ä¸ªä¸ªint32ï¼Œ ä¸¤ä¸ªä¸ªint64ï¼‰ void *mem =malloc(p_bytes + (prepad ? PAD_ALIGN : 0));</p><p>//malloc å¤±è´¥åˆ¤æ–­ ERR_FAIL_COND_V(!mem, nullptr);</p><p>//é€’å¢ä½¿ç”¨çš„å†…å­˜å—ï¼Œvolatileå…³é”®å­—é™åˆ¶ï¼Œä¿è¯å‡†ç¡®æ€§ï¼Œcpuç¼“å­˜atomic_increment(&amp;alloc_count);</p><p>if (prepad) { //å‰8å­—èŠ‚æ”¾ç”¨æˆ·ä½¿ç”¨çš„å¤§å°ã€‚ uint64_t <em>s = (uint64_t</em>)mem; <em>s = p_bytes; //å†…å­˜å¤´ s8 ï¼Œ uint8_t ä¸€ä¸ªå­—èŠ‚+PAD_ALIGNï¼ˆ16å­—èŠ‚ï¼‰ï¼Œåç§»åˆ°ç”¨æˆ·åœ°å€ï¼Œreturn uint8_t </em>s8 = (uint8_t*)mem;<br># ifdef DEBUG_ENABLED<br>//ç»Ÿè®¡å†…å­˜æ€»å­—èŠ‚æ•° atomic_add(&amp;mem_usage, p_bytes); //åŸå­äº¤æ¢ todoatomic_exchange_if_greater(&amp;max_usage, mem_usage); # endif return s8+ PAD_ALIGN; } else { return mem; }</p><p>void _Memory::realloc_static(void _p_memory, size_t p_bytes, boolp_pad_align) { if (p_memory == nullptr) { return alloc_static(p_bytes,p_pad_align); } uint8_t mem = (uint8_t )p_memory;</p><p>#ifdef DEBUG_ENABLED bool prepad = true; #else bool prepad =p_pad_align; #endif if (prepad) { mem -= PAD_ALIGN; uint64_t s =(uint64_t )mem; #ifdef DEBUG_ENABLED if (p_bytes &gt; <em>s) {atomic_add(&amp;mem_usage, p_bytes - </em>s);atomic_exchange_if_greater(&amp;max_usage, mem_usage); } else {atomic_sub(&amp;mem_usage, <em>s - p_bytes); } #endif if (p_bytes == 0){ free(mem); return nullptr; } else { </em>s = p_bytes; mem = (uint8_t<em>)realloc(mem, p_bytes + PAD_ALIGN); ERR_FAIL_COND_V(!mem, nullptr);s = (uint64_t </em>)mem; <em>s = p_bytes; return mem + PAD_ALIGN; } }else { mem = (uint8_t </em>)realloc(mem, p_bytes); ERR_FAIL_COND_V(mem== nullptr &amp;&amp; p_bytes &gt; 0, nullptr); return mem; }<br>}</p></li></ol><p>void Memory::free_static(void *p_ptr, bool p_pad_align) {<br>ERR_FAIL_COND(p_ptr == nullptr);</p><pre><code>    uint8_t _mem = (uint8_t _)p_ptr;  # ifdef DEBUG_ENABLED  bool prepad = true;  # else  bool prepad = p_pad_align;  # endif  // åŸå­å‡ å†…å­˜å—æ•°é‡       atomic_decrement(&amp;alloc_count);  if (prepad) {     // è·³åˆ°mem åŸå§‹å¤´ï¼Œè¿›è¡Œfree     mem -= PAD_ALIGN;  # ifdef DEBUG_ENABLED     uint64_t *s = (uint64_t *)mem;     // åŸå­å‡ å†…å­˜å­—èŠ‚æ•°     atomic_sub(&amp;mem_usage, *s);  # endif     free(mem);  } else {      free(mem);    }}```</code></pre><ol start="3" type="1"><li><p>é»˜è®¤å†…å­˜ç”³è¯·å™¨</p><pre><code>``` cpp//ç®€å•çš„åŒ…ä¸€å±‚çš„ç”³è¯·å’Œé‡Šæ”¾å™¨class DefaultAllocator {public:    _FORCE_INLINE_ static void *alloc(size_t p_memory) { return Memory::alloc_static(p_memory, false); }    _FORCE_INLINE_ static void free(void *p_ptr) { Memory::free_static(p_ptr, false); }};```</code></pre></li><li><p>é‡è½½ newã€deleteã€new []ã€delete[], ç›®çš„æ˜¯å°è£…ï¼Œæœ€ç»ˆéƒ½ç»Ÿä¸€ä½¿ç”¨Memory'é™æ€æ–¹æ³•ï¼Œè°ƒç”¨malloc, free.</p><div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">//1. newé‡è½½1</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span><span class="kw">operator</span> <span class="kw">new</span><span class="op">(</span><span class="dt">size_t</span> p_size<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span> <span class="op">*</span>p_description<span class="op">);</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span><span class="kw">operator</span> <span class="kw">new</span><span class="op">(</span><span class="dt">size_t</span> p_size<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span> <span class="op">*</span>p_description<span class="op">)</span> <span class="op">{</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Memory<span class="op">::</span>alloc_static<span class="op">(</span>p_size<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co">//1. newé‡è½½2</span></span><span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span><span class="kw">operator</span> <span class="kw">new</span><span class="op">(</span><span class="dt">size_t</span> p_size<span class="op">,</span> <span class="dt">void</span> <span class="op">*(*</span>p_allocfunc<span class="op">)(</span><span class="dt">size_t</span> p_size<span class="op">));</span></span><span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span><span class="kw">operator</span> <span class="kw">new</span><span class="op">(</span><span class="dt">size_t</span> p_size<span class="op">,</span> <span class="dt">void</span> <span class="op">*(*</span>p_allocfunc<span class="op">)(</span><span class="dt">size_t</span> p_size<span class="op">))</span> <span class="op">{</span></span><span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> p_allocfunc<span class="op">(</span>p_size<span class="op">);</span></span><span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">//1. newé‡è½½3 æš‚æ—¶æ— ç”¨</span></span><span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span><span class="kw">operator</span> <span class="kw">new</span><span class="op">(</span><span class="dt">size_t</span> p_size<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>p_pointer<span class="op">,</span> <span class="dt">size_t</span> check<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span> <span class="op">*</span>p_description<span class="op">);</span> </span><span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>_ALWAYS_INLINE_ <span class="dt">void</span> <span class="op">*</span><span class="kw">operator</span> <span class="kw">new</span><span class="op">(</span><span class="dt">size_t</span> p_size<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>p_pointer<span class="op">,</span> <span class="dt">size_t</span> check<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span> <span class="op">*</span>p_description<span class="op">)</span> <span class="op">{</span></span><span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">//void *failptr=0;</span></span><span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">//ERR_FAIL_COND_V( check &lt; p_size , failptr); /** bug, or strange compiler, most likely */</span></span><span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> p_pointer<span class="op">;</span></span><span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">// 2. delete é‡è½½1ï¼Œ ç›®çš„æ˜¯é™åˆ¶ç›´æ¥ä½¿ç”¨delete, ä½¿ç”¨ç»Ÿä¸€çš„é‡Šæ”¾æ–¹æ³•ã€‚</span></span><span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="kw">operator</span> <span class="kw">delete</span><span class="op">(</span><span class="dt">void</span> <span class="op">*</span>p_mem<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span> <span class="op">*</span>p_description<span class="op">);</span></span><span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="kw">operator</span> <span class="kw">delete</span><span class="op">(</span><span class="dt">void</span> <span class="op">*</span>p_mem<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span> <span class="op">*</span>p_description<span class="op">)</span> <span class="op">{</span></span><span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  CRASH_NOW_MSG<span class="op">(</span><span class="st">"Call to placement delete should not happen."</span><span class="op">);</span></span><span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co">//2. delete é‡è½½2ï¼Œ ç›®çš„æ˜¯é™åˆ¶ç›´æ¥ä½¿ç”¨delete, ä½¿ç”¨ç»Ÿä¸€çš„é‡Šæ”¾æ–¹æ³•ã€‚</span></span><span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="kw">operator</span> <span class="kw">delete</span><span class="op">(</span><span class="dt">void</span> <span class="op">*</span>p_mem<span class="op">,</span> <span class="dt">void</span> <span class="op">*(*</span>p_allocfunc<span class="op">)(</span><span class="dt">size_t</span> p_size<span class="op">));</span></span><span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="kw">operator</span> <span class="kw">delete</span><span class="op">(</span><span class="dt">void</span> <span class="op">*</span>p_mem<span class="op">,</span> <span class="dt">void</span> <span class="op">*(*</span>p_allocfunc<span class="op">)(</span><span class="dt">size_t</span> p_size<span class="op">))</span> <span class="op">{</span></span><span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  CRASH_NOW_MSG<span class="op">(</span><span class="st">"Call to placement delete should not happen."</span><span class="op">);</span></span><span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co">//2. delete é‡è½½3ï¼Œ ç›®çš„æ˜¯é™åˆ¶ç›´æ¥ä½¿ç”¨delete, ä½¿ç”¨ç»Ÿä¸€çš„é‡Šæ”¾æ–¹æ³•ã€‚</span></span><span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="kw">operator</span> <span class="kw">delete</span><span class="op">(</span><span class="dt">void</span> <span class="op">*</span>p_mem<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>p_pointer<span class="op">,</span> <span class="dt">size_t</span> check<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span> <span class="op">*</span>p_description<span class="op">);</span></span><span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="kw">operator</span> <span class="kw">delete</span><span class="op">(</span><span class="dt">void</span> <span class="op">*</span>p_mem<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>p_pointer<span class="op">,</span> <span class="dt">size_t</span> check<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span> <span class="op">*</span>p_description<span class="op">)</span> <span class="op">{</span></span><span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  CRASH_NOW_MSG<span class="op">(</span><span class="st">"Call to placement delete should not happen."</span><span class="op">);</span></span><span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="co">// 3. new[] æ“ä½œï¼Œ åœ°å€--&gt; è®°å½•lenåˆ°å¤´éƒ¨æ•°æ®-&gt;for eles</span></span><span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span><span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>T <span class="op">*</span>memnew_arr_template<span class="op">(</span><span class="dt">size_t</span> p_elements<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span> <span class="op">*</span>p_descr <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op">{</span></span><span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>p_elements <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span><span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">nullptr</span><span class="op">;</span></span><span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span><span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="co">/** overloading operator new[] cannot be done , because it may not return the real allocated address (it may pad the 'element count' before the actual array). Because of that, it must be done by hand. This is the</span></span><span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a><span class="co">  same strategy used by std::vector, and the Vector class, so it should be safe.*/</span></span><span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>  <span class="dt">size_t</span> len <span class="op">=</span> <span class="kw">sizeof</span><span class="op">(</span>T<span class="op">)</span> <span class="op">*</span> p_elements<span class="op">;</span></span><span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>  <span class="dt">uint64_t</span> <span class="op">*</span>mem <span class="op">=</span> <span class="op">(</span><span class="dt">uint64_t</span> <span class="op">*)</span>Memory<span class="op">::</span>alloc_static<span class="op">(</span>len<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span><span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  T <span class="op">*</span>failptr <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span> <span class="co">//get rid of a warning</span></span><span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  ERR_FAIL_COND_V<span class="op">(!</span>mem<span class="op">,</span> failptr<span class="op">);</span></span><span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  <span class="op">*(</span>mem <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">=</span> p_elements<span class="op">;</span></span><span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(!</span><span class="fu">__has_trivial_constructor</span><span class="op">(</span>T<span class="op">))</span> <span class="op">{</span></span><span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>      T <span class="op">*</span>elems <span class="op">=</span> <span class="op">(</span>T <span class="op">*)</span>mem<span class="op">;</span></span><span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>      <span class="co">/* call operator new */</span></span><span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> p_elements<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span><span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>          <span class="kw">new</span> <span class="op">(&amp;</span>elems<span class="op">[</span>i<span class="op">],</span> <span class="kw">sizeof</span><span class="op">(</span>T<span class="op">),</span> p_descr<span class="op">)</span> T<span class="op">;</span></span><span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span><span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span><span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">(</span>T <span class="op">*)</span>mem<span class="op">;</span></span><span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a><span class="co">// 4. delete []ï¼Œnew[] é€†å‘é¡ºåºã€‚</span></span><span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">typename</span> T<span class="op">&gt;</span></span><span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> memdelete_arr<span class="op">(</span>T <span class="op">*</span>p_class<span class="op">)</span> <span class="op">{</span></span><span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>  <span class="dt">uint64_t</span> <span class="op">*</span>ptr <span class="op">=</span> <span class="op">(</span><span class="dt">uint64_t</span> <span class="op">*)</span>p_class<span class="op">;</span></span><span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(!</span><span class="fu">__has_trivial_destructor</span><span class="op">(</span>T<span class="op">))</span> <span class="op">{</span></span><span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>      <span class="dt">uint64_t</span> elem_count <span class="op">=</span> <span class="op">*(</span>ptr <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> <span class="op">(</span><span class="dt">uint64_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> elem_count<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span><span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>          p_class<span class="op">[</span>i<span class="op">].~</span>T<span class="op">();</span></span><span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span><span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span><span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>  Memory<span class="op">::</span>free_static<span class="op">(</span>ptr<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span><span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li><li><p>ç»Ÿä¸€ä½¿ç”¨æ¥å£</p><div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">//ç»Ÿä¸€æ¥å£ memallocã€memreallocã€memfree</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define memalloc</span><span class="op">(</span><span class="va">m_size</span><span class="op">)</span><span class="pp"> </span>Memory<span class="op">::</span>alloc_static<span class="op">(</span><span class="va">m_size</span><span class="op">)</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define memrealloc</span><span class="op">(</span><span class="va">m_mem</span><span class="op">,</span><span class="pp"> </span><span class="va">m_size</span><span class="op">)</span><span class="pp"> </span>Memory<span class="op">::</span>realloc_static<span class="op">(</span><span class="va">m_mem</span><span class="op">,</span><span class="pp"> </span><span class="va">m_size</span><span class="op">)</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define memfree</span><span class="op">(</span><span class="va">m_size</span><span class="op">)</span><span class="pp"> </span>Memory<span class="op">::</span>free_static<span class="op">(</span><span class="va">m_size</span><span class="op">)</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">// memdeleteï¼Œprehandler(ç›®å‰ç©ºå®ç°)--&gt; ææ„å‡½æ•° --&gt; ç»Ÿä¸€freeæ¥å£</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">class</span> T<span class="op">&gt;</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> memdelete<span class="op">(</span>T <span class="op">*</span>p_class<span class="op">)</span> <span class="op">{</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>predelete_handler<span class="op">(</span>p_class<span class="op">))</span> <span class="op">{</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span> <span class="co">// doesn't want to be deleted</span></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span><span class="fu">__has_trivial_destructor</span><span class="op">(</span>T<span class="op">))</span> <span class="op">{</span></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        p_class<span class="op">-&gt;~</span>T<span class="op">();</span></span><span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    Memory<span class="op">::</span>free_static<span class="op">(</span>p_class<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span><span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">//æŒ‡å®šå†…å­˜ç”³è¯·å™¨è¿›è¡Œé‡Šæ”¾ã€‚</span></span><span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">class</span> T<span class="op">,</span> <span class="kw">class</span> A<span class="op">&gt;</span></span><span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> memdelete_allocator<span class="op">(</span>T <span class="op">*</span>p_class<span class="op">)</span> <span class="op">{</span></span><span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>predelete_handler<span class="op">(</span>p_class<span class="op">))</span> <span class="op">{</span></span><span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span> <span class="co">// doesn't want to be deleted</span></span><span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span><span class="fu">__has_trivial_destructor</span><span class="op">(</span>T<span class="op">))</span> <span class="op">{</span></span><span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        p_class<span class="op">-&gt;~</span>T<span class="op">();</span></span><span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    A<span class="op">::</span>free<span class="op">(</span>p_class<span class="op">);</span></span><span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span> <span class="op">&lt;</span><span class="kw">class</span> T<span class="op">,</span> <span class="kw">class</span> A<span class="op">&gt;</span></span><span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> memdelete_allocator<span class="op">(</span>T <span class="op">*</span>p_class<span class="op">)</span> <span class="op">{</span></span><span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>predelete_handler<span class="op">(</span>p_class<span class="op">))</span> <span class="op">{</span></span><span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span> <span class="co">// doesn't want to be deleted</span></span><span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span><span class="fu">__has_trivial_destructor</span><span class="op">(</span>T<span class="op">))</span> <span class="op">{</span></span><span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>        p_class<span class="op">-&gt;~</span>T<span class="op">();</span></span><span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    A<span class="op">::</span>free<span class="op">(</span>p_class<span class="op">);</span></span><span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/godot-yin-qing/1.yuan-ma-gou-jian/"/>
      <url>/2022/08/10/godot-yin-qing/1.yuan-ma-gou-jian/</url>
      
        <content type="html"><![CDATA[<h2 id="æ„å»ºgodot">æ„å»ºgodot</h2><blockquote><p>godot ä½¿ç”¨ <a href="https://scons.org/">sconsç³»ç»Ÿæ„å»º</a>ï¼Œæ”¯æŒå¤šå¹³å°ã€‚</p></blockquote><ol type="1"><li><p>ç¯å¢ƒå‡†å¤‡ (Windows)</p><ol type="1"><li><a href="https://www.python.org/downloads/release/python-385/">Python3.5+</a></li><li><a href="https://scons.org/">SCons</a></li><li><a href="https://yasm.tortall.net/">yasm</a> å¯é€‰</li></ol></li><li><p>æ£€æŸ¥ç¯å¢ƒ</p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">python</span> <span class="at">--version</span> <span class="co">#æ£€æŸ¥python</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">scons</span> <span class="at">--version</span>  <span class="co">#æ£€æŸ¥scons</span></span></code></pre></div></li><li><p>å®‰è£… vs2017 or vs2019, å¹¶é€‰æ‹© å®‰è£…c++å¼€å‘ç¯å¢ƒã€‚</p></li><li><p>ä¸‹è½½ <a href="https://github.com/godotengine/godot">Godotæºç </a>,ç½‘é€Ÿæ…¢çš„è¯å¯ä»¥ä½¿ç”¨ <a href="https://gitee.com/">giteeä»“åº“</a>æœç´¢Godotã€‚</p></li><li><p>ç¼–è¯‘Godotç¼–è¾‘å™¨</p><div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> c:/godot  <span class="co">#è¿›å…¥è‡ªå·±çš„æ–‡ä»¶ç›®å½•</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#ä»¥ä¸‹äºŒé€‰ä¸€</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">scons</span> <span class="at">-j6</span> p=windows  <span class="co"># 1. ç›´æ¥ç”Ÿæˆ</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">scons</span> <span class="at">-j6</span> p=windows vsproj=yes <span class="co">#2. ç”Ÿæˆvsï¼Œå¯ä»¥é€šè¿‡vsç”Ÿæˆã€‚</span></span></code></pre></div></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/c-yu-yan-cpp/2.hong-ding-yi/"/>
      <url>/2022/08/10/c-yu-yan-cpp/2.hong-ding-yi/</url>
      
        <content type="html"><![CDATA[<pre><code>UNIX   _unix       or         _unix_Linux   _linux      or        _linux_Windows32       _WIN32Windows64       _WIN64IOS              __APPLE__android        __ANDROID__GCC                         __GNUC__Visual C++               _MSC_VERBorland C++            __BORLANDC__</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/c-yu-yan-cpp/1.jin-cheng-jian-tong-xin/"/>
      <url>/2022/08/10/c-yu-yan-cpp/1.jin-cheng-jian-tong-xin/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><a href="https://www.cnblogs.com/zgq0/p/8780893.html">è¿›ç¨‹é—´é€šä¿¡</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/android/5.profileapk/"/>
      <url>/2022/08/10/android/5.profileapk/</url>
      
        <content type="html"><![CDATA[<h1 id="æ€§èƒ½åˆ†æ">æ€§èƒ½åˆ†æ</h1><p>å¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åº<code>å“åº”ç¼“æ…¢</code>ã€<code>åŠ¨ç”»ä¸ç¨³å®š</code>ã€<code>æ­»æœº</code>ã€<code>å´©æºƒ</code>æˆ–<code>æ¶ˆè€—å¤§é‡ç”µåŠ›</code>ï¼Œé‚£ä¹ˆå®ƒå°±è¢«è®¤ä¸ºæ˜¯æ€§èƒ½å·®çš„ã€‚ä¸ºäº†é¿å…è¿™äº›æ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨æœ¬æ–‡ä¸­åˆ—å‡ºçš„åˆ†æå’ŒåŸºå‡†æµ‹è¯•å·¥å…·æ¥è¯†åˆ«åº”ç”¨ç¨‹åºåœ¨å“ªäº›åœ°æ–¹ä½æ•ˆåœ°ä½¿ç”¨äº†èµ„æºï¼Œå¦‚<strong>CPUã€å†…å­˜ã€å›¾å½¢ã€ç½‘ç»œå’Œè®¾å¤‡ç”µæ± </strong>ã€‚</p><h2 id="profiler">Profiler</h2><blockquote><p>Android Studio 3.0 åŠæ›´é«˜ç‰ˆæœ¬ä¸­çš„ Android Profiler å–ä»£äº† AndroidMonitor å·¥å…·ã€‚Android Profiler å·¥å…·å¯æä¾›å®æ—¶æ•°æ®ï¼Œå¸®åŠ©æ‚¨äº†è§£åº”ç”¨çš„CPUã€å†…å­˜ã€ç½‘ç»œå’Œç”µæ± èµ„æºä½¿ç”¨æƒ…å†µã€‚ Android Profiler ä¸ Android 5.0ï¼ˆAPIçº§åˆ« 21ï¼‰åŠæ›´é«˜ç‰ˆæœ¬å…¼å®¹ã€‚</p></blockquote><p>View &gt; Tool Windows &gt; Profilerï¼Œæˆ–ç‚¹å‡»å·¥å…·æ ä¸­çš„ Profile å›¾æ ‡ã€‚å¦‚æœ Select Deployment Targetå¯¹è¯æ¡†æç¤ºï¼Œè¯·é€‰æ‹©è¦åœ¨å“ªä¸ªè®¾å¤‡ä¸Šåˆ†æåº”ç”¨çš„æ€§èƒ½ã€‚å¦‚æœæ‚¨é€šè¿‡ USBè¿æ¥äº†æŸä¸ªè®¾å¤‡ä½†ç³»ç»Ÿæœªåˆ—å‡ºè¯¥è®¾å¤‡ï¼Œè¯·ç¡®ä¿æ‚¨<code>å·²å¯ç”¨ USB è°ƒè¯•</code>ã€‚<strong>å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯Android æ¨¡æ‹Ÿå™¨æˆ–å·²å–å¾— root æƒé™çš„è®¾å¤‡ï¼ŒAndroid Profilerå°†åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œå³ä½¿è¿™äº›è¿›ç¨‹å¯èƒ½æ— æ³•è°ƒè¯•ä¹Ÿä¼šåˆ—å‡º</strong>ã€‚å½“æ‚¨å¯åŠ¨å¯è°ƒè¯•çš„åº”ç”¨æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šé€‰æ‹©è¯¥è¿›ç¨‹ã€‚</p><p>Android Profiler ä¼šæŒç»­æ”¶é›†æ€§èƒ½åˆ†ææ•°æ®ï¼Œç›´åˆ°æ‚¨æ–­å¼€è®¾å¤‡è¿æ¥æˆ–ç‚¹å‡» EndSessionã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/android/4.googleandroid/"/>
      <url>/2022/08/10/android/4.googleandroid/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><a href="https://developer.android.com/google/play/expansion-files#java">Googleåˆ†åŒ…</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/android/3.apk-fan-bian-yi/"/>
      <url>/2022/08/10/android/3.apk-fan-bian-yi/</url>
      
        <content type="html"><![CDATA[<h2 id="apkåç¼–è¯‘">Apkåç¼–è¯‘</h2><ol type="1"><li><a href="https://cloud.tencent.com/developer/article/1004543">apktool</a></li><li><a href="https://bitbucket.org/JesusFreke/smali/downloads/">smali</a>ã€<a href="https://github.com/JesusFreke/smalidea">smali github</a></li><li><a href="https://www.52pojie.cn/thread-648530-1-1.html">androidåç¼–è¯‘è¯¾ç¨‹</a></li><li><a href="https://github.com/0xd4d/dnSpy/releases">dnSpy</a></li><li><a href="https://blog.csdn.net/lanyang123456/article/details/56497264">soåç¼–è¯‘åˆ°cä»£ç </a></li><li><a href="https://blog.csdn.net/zplxl99/article/details/80376298">Android soè¯¦è§£</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/android/2.android/"/>
      <url>/2022/08/10/android/2.android/</url>
      
        <content type="html"><![CDATA[<h2 id="androidç›¸å…³">Androidç›¸å…³</h2><ol type="1"><li><a href="http://hukai.me/android-training-course-in-chinese/index.html?utm_source=androiddevtools&amp;utm_medium=website">Androidå®˜æ–¹åŸ¹è®­è¯¾ç¨‹</a></li><li><a href="https://blog.csdn.net/strivero/article/details/53169679">AndroidJarå¼€å‘</a></li><li><a href="https://www.cnblogs.com/pbq-dream/p/5364614.html">Androidä¿å­˜å›¾ç‰‡åˆ°ç›¸å†Œ</a></li><li><a href="https://docs.oracle.com/javase/8/docs/">Java æ–‡æ¡£</a>ã€<a href="http://jcs.mobile-utopia.com/">Java æºç </a>ã€<a href="http://androidxref.com/8.0.0_r4/xref/frameworks/">Androidæºç </a></li><li><a href="https://blog.csdn.net/supernovaExp/article/details/78335363">nativeå’ŒJavaè°ƒç”¨</a></li><li><a href="https://blog.csdn.net/jlq_diligence/article/details/88884945">å®‰è£…Javaæ²¡æœ‰jreè§£å†³</a></li><li><a href="https://www.cnblogs.com/kuku19940613/p/10861460.html">aaptæŸ¥çœ‹apkä¿¡æ¯</a></li><li><a href="https://developer.android.com/studio/build/multidex#mdex-gradle">æ–¹æ³•è¶…è¿‡64k</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/android/1.adb/"/>
      <url>/2022/08/10/android/1.adb/</url>
      
        <content type="html"><![CDATA[<h2 id="adbç›¸å…³æ“ä½œ">ADBç›¸å…³æ“ä½œ</h2><blockquote><p>adb shell</p><p>â€‹ å¯é€‰å‚æ•° -s è®¾å¤‡id, å¤šä¸ªè®¾å¤‡éƒ½è¿æ¥æ—¶å¾ˆæœ‰ç”¨ã€‚</p></blockquote><ol type="1"><li><p>è¿æ¥è®¾å¤‡</p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> adb connect ip</span></code></pre></div></li><li><p>æŸ¥çœ‹è¿æ¥çš„è®¾å¤‡</p><pre><code>adb devices</code></pre></li><li><p>å®‰è£…å¸è½½åŒ…</p><pre><code>adb install/uninstall åŒ…è·¯å¾„</code></pre></li><li><p>æŸ¥çœ‹å·²ç»å®‰è£…çš„åŒ…</p><pre><code>adb shell pm list packages</code></pre></li><li><p>ä¼ è¾“æ–‡ä»¶</p><pre><code>adb shell pull æ‰‹æœºæ–‡ä»¶è·¯å¾„ æœ¬åœ°è·¯å¾„adb shell push æœ¬åœ°æ–‡ä»¶è·¯å¾„ æ‰‹æœºè·¯å¾„</code></pre></li><li><p>æˆªå±</p><ol type="1"><li><p>æˆªå±ä¿å­˜åœ¨æ‰‹æœº</p><div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> adb shell screencap <span class="at">-p</span> /sdcard/å›¾ç‰‡åç§°.png <span class="co">#è·¯å¾„è‡ªå·±èµ·</span></span></code></pre></div></li><li><p>æˆªå±ä¿å­˜åœ¨é“¾æ¥çš„ç”µè„‘</p><div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> adb exec-out screencap <span class="at">-p</span> <span class="op">&gt;</span> C:\Users\Administrator\Desktop\face\aaa.png <span class="co">#è·¯å¾„è‡ªå·±èµ·</span></span></code></pre></div></li></ol></li><li><p>å½•å±</p><blockquote><p>adb shell screenrecord /sdcard/video.mp4</p></blockquote><ol type="1"><li>--size 1280*720 å°ºå¯¸</li><li>--time-limit 200 æ—¶é•¿é™åˆ¶</li><li>-bit-rate 500000 ç ç‡ å•ä½å¤§å°</li></ol></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/yan-se-kong-jian/readme/"/>
      <url>/2022/08/10/yan-se-kong-jian/readme/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/yan-se-kong-jian/2.gamma-zhi-de-li-jie/"/>
      <url>/2022/08/10/yan-se-kong-jian/2.gamma-zhi-de-li-jie/</url>
      
        <content type="html"><![CDATA[<h1 id="gammaå€¼çš„ç†è§£">Gammaå€¼çš„ç†è§£</h1><h2 id="ä»€ä¹ˆæ˜¯gamma">ä»€ä¹ˆæ˜¯Gamma</h2><p>ä»¥å‰åœ¨CRTå’Œæ—©æœŸLCDç›‘è§†å™¨ä¸­çš„Gammaä¸ç”µå‹ç›´æ¥ç›¸å…³ï¼Œæ˜¯åœ¨æ˜¾ç¤ºå™¨ä¸Šå‡†ç¡®å†ç°å›¾åƒçš„é‡è¦å› ç´ ã€‚åœ¨å½“å‰çš„LCDç›‘è§†å™¨ä¸­ï¼ŒGammaå¯ä»¥è¢«è®¤ä¸ºæ˜¯åœ¨è§‚çœ‹æ˜¾ç¤ºå™¨æ—¶ï¼Œæ•è·çš„æ•°æ®çš„äº®åº¦ï¼ˆè¾“å…¥ï¼‰ä¸å¦‚ä½•å½±å“äººçœ¼å¯¹é¢œè‰²ï¼ˆè¾“å‡ºï¼‰çš„æ€»ä½“æ„ŸçŸ¥ä¹‹é—´çš„å…³ç³»çš„è°ƒèŠ‚å™¨ã€‚</p><p>ä»æŠ€æœ¯æ„ä¹‰ä¸Šè®²ï¼Œå®ƒæ˜¯é€šè¿‡åƒç´ å€¼ä¸­çš„é¢œè‰²é˜´å½±å¹³è¡¡æ¥æ ¡æ­£å›¾åƒé¢œè‰²çš„äº®åº¦ã€‚åƒç´ çš„å€¼ä»‹äº0ï¼ˆé»‘è‰²ï¼‰åˆ°255ï¼ˆç™½è‰²ï¼‰ä¹‹é—´ï¼Œå…¶é—´å…·æœ‰ä¸åŒçš„ç°åº¦ã€‚æˆ‘ä»¬çš„æ­£å¸¸è§†è§‰ï¼ˆä¸æ˜¯è¿‡æš—æˆ–éå¸¸æ˜äº®çš„æ¡ä»¶ï¼‰å¯¹æš—è‰²è°ƒçš„å˜åŒ–æ›´æ•æ„Ÿï¼Œå¹¶ä¸”ç”±äºå›¾åƒçš„æ•æ‰è¿‡ç¨‹ï¼Œé¢œè‰²å¯èƒ½è¢«è¯¯ä¼ ï¼Œç”±äºæˆ‘ä»¬ä»åŸå§‹å›¾åƒè¢«æ•è·æ—¶æ„ŸçŸ¥äº®åº¦å’Œäº®åº¦çš„æ–¹å¼ä¸åŒã€‚æˆ‘ä»¬çš„çœ¼ç›ä»¥ä¸æˆæ¯”ä¾‹çš„æ–¹å¼æ•æ‰äº®åº¦ï¼Œä¾‹å¦‚ï¼Œå¦‚æœç›¸æœºåœ¨æäº®çš„ç¯å¢ƒä¸­æ‹æ‘„å›¾åƒï¼Œæˆ‘ä»¬çš„çœ¼ç›ä¼šæ„Ÿè§‰åˆ°å…‰çº¿åªæ˜¯äº®åº¦çš„ä¸€å°éƒ¨åˆ†ã€‚å¦‚æœå›¾åƒåœ¨æ²¡æœ‰ä¼½é©¬æ ¡æ­£çš„æƒ…å†µä¸‹è¢«å¤„ç†å¹¶æ˜¾ç¤ºåœ¨æ¡Œé¢ä¸Šï¼Œåˆ™ç”¨æˆ·å°†å…¶è§†ä¸ºè¤ªè‰²æˆ–å¤ªäº®ã€‚<img src="images/Gamma-eye-camera.png" alt="è¾“å…¥äº®åº¦å’Œäººçœ¼æ„Ÿå—å¯¹æ¯”å›¾"></p><h3 id="å¹¿ä¹‰çš„gammaå€¼">å¹¿ä¹‰çš„Gammaå€¼</h3><p>Gammaå€¼çš„å¹¿ä¹‰å®šä¹‰å°±æ˜¯è¾“å…¥å€¼å’Œè¾“å‡ºå€¼çš„Gammaå¹‚æŒ‡æ•°å…³ç³»ï¼Œç”¨æ¥è¡¥å¿äººçœ¼å¯¹è‡ªç„¶äº®åº¦çš„éçº¿æ€§æ„ŸçŸ¥ã€‚</p><p><img src="images/gamma_io.png" alt="è¾“å…¥å’Œè¾“å‡ºçš„å…³ç³»å¯è¡¨è¾¾ä¸ºï¼šè¾“å‡º = è¾“å…¥gamma">Gamma=1ï¼Œæ–œ45Â°ç›´çº¿ï¼Œä¸æ ¡æ­£ï¼Œè¾“å‡º=è¾“å…¥ï¼›Gammaå¤§äº1ï¼Œæ›²çº¿ä¸‹å‹ï¼Œè¾“å‡ºå€¼å°äºè¾“å…¥å€¼ï¼›Gammaå°äº1ï¼Œæ›²çº¿ä¸Šæ‹±ï¼Œè¾“å‡ºå€¼å¤§äºè¾“å…¥å€¼ã€‚</p><h3 id="ä¸åŒgammaå€¼çš„å›¾ç‰‡">ä¸åŒGammaå€¼çš„å›¾ç‰‡</h3><ul><li><p>gamma1.0 <img src="images/Gamma-eye10.jpg" alt="gamma1.0"></p></li><li><p>gamma1.8 <img src="images/Gamma-eye18.jpg" alt="gamma1.8"></p></li><li><p>gamma2.2 <img src="images/Gamma-eye22.jpg" alt="gamma2.2"></p></li><li><p>gamma4.0 <img src="images/Gamma-eye40.jpg" alt="gamma4.0"></p></li></ul><p>å°†æ­¤èŒƒå›´åº”ç”¨äºé¢œè‰²ï¼ˆRGBï¼‰æ—¶ï¼Œå¯ä»¥åœ¨å„ç§äº®åº¦çº§åˆ«ç”Ÿæˆé¢œè‰²ã€‚å€¼ä¸º192çš„çº¢è‰²åƒç´ å°†æ˜¯å¯èƒ½äº®åº¦çš„å››åˆ†ä¹‹ä¸‰ï¼Œè€Œå€¼ä¸º10çš„çº¢è‰²åƒç´ æ˜¯éå¸¸æš—çš„ï¼Œéœ€è¦è¿›è¡ŒGammaæ ¡æ­£ä»¥å“åº”äººç±»è§†è§‰çš„ç‰¹æ€§ï¼Œä»¥äº§ç”ŸçœŸå®çš„é¢œè‰²ã€‚æˆ‘ä»¬çš„çœ¼ç›ä»¥ä¸æˆæ¯”ä¾‹çš„æ–¹å¼æ•æ‰äº®åº¦ï¼Œä¾‹å¦‚ï¼Œå¦‚æœæ‘„åƒæœºæ•è·å›¾åƒå¹¶ä¸”å®ƒéå¸¸æ˜äº®ï¼Œæˆ‘ä»¬å°†æ„ŸçŸ¥å…‰çº¿åªæ˜¯äº®åº¦çš„ä¸€å°éƒ¨åˆ†ã€‚å¦‚æœå›¾åƒåœ¨æ²¡æœ‰ä¼½é©¬æ ¡æ­£çš„æƒ…å†µä¸‹è¢«å¤„ç†å¹¶æ˜¾ç¤ºåœ¨æ¡Œé¢ä¸Šï¼Œåˆ™ç”¨æˆ·çœ‹åˆ°çš„æ˜¯å¤ªäº®çš„å›¾åƒã€‚ç”±äºäº®åº¦ä¸å¹³è¡¡ï¼Œéœ€è¦ä½¿ç”¨Gammaå¹³è¡¡è¾“å…¥å…³ç³»ä»¥åŒ¹é…æ¡Œé¢è¾“å‡ºï¼Œä»è€Œåˆ›å»ºé€¼çœŸçš„é¢œè‰²ï¼ŒGammaæ›²çº¿è°ƒæ•´æˆä¸ºä¸“ä¸šæ˜¾ç¤ºå™¨ç”Ÿäº§çš„æ–°è§„èŒƒã€‚</p><p>ç›®å‰<strong>Gamma 2.2ä¸€ç›´æ˜¯Windowså’ŒAppleçš„æ ‡å‡†ï¼ˆè‡ªMac OS X v10.6Snow Leopardä»¥æ¥ï¼‰</strong>ã€‚ä½¿ç”¨Gamma2.2çš„æ˜¾ç¤ºå™¨å¯ä»¥äº§ç”Ÿå‡ ä¹æœ€ä½³çš„é¢œè‰²ã€‚æ­¤çº§åˆ«ä¸ºçœŸå½©è‰²æä¾›äº†æœ€ä½³å¹³è¡¡ï¼Œå¹¶è¢«ç”¨ä½œå›¾å½¢å’Œè§†é¢‘ä¸“ä¸šäººå‘˜çš„æ ‡å‡†ã€‚</p><h2 id="ä¸ºä»€ä¹ˆè¦å°†è¾“å‡ºå’Œè¾“å…¥åšgammaè¿ç®—">ä¸ºä»€ä¹ˆè¦å°†è¾“å‡ºå’Œè¾“å…¥åšGammaè¿ç®—ï¼Ÿ</h2><p>ä¸Šé¢æåˆ°ï¼ŒGammaä¸ºäº†è§£å†³äººçœ¼å¯¹è‡ªç„¶äº®åº¦éçº¿æ€§æ„ŸçŸ¥çš„é—®é¢˜ï¼Œå…¶äºŒæ˜¯å› ä¸ºè®°å½•å­˜å‚¨çš„æœ‰é™æ€§ã€‚ä¸¾ä¸ªæ —å­ï¼šä¸€é—´é»‘å±‹å­ä¸­ï¼Œç‚¹äº®äº†ä¸€åªç¯æ³¡Aï¼Œäººçœ¼ä¼šæ„Ÿè§‰ç…§äº®æ•´é—´å±‹å­ï¼ŒæŒç»­ç‚¹äº®ç¬¬2ä¸ªã€ç¬¬2ä¸ªâ€¦â€¦ç¯æ³¡åï¼Œäººçœ¼ä¼šæ„Ÿè§‰å±‹å­é€æ¸å˜å¾—æ˜äº®ï¼Œæ­¤æ—¶å†ç‚¹äº®ç¬¬N+1ä¸ªç¯æ³¡ï¼Œå…¶å®äººçœ¼æ²¡æœ‰ä»€ä¹ˆæ„Ÿè§‰ç”šè‡³å¾®ä¹å…¶å¾®ï¼Œä¸ºä»€ä¹ˆï¼Ÿ*äº®åº¦å¯¹äººçœ¼çš„åˆºæ¿€æ˜¯éçº¿æ€§çš„ï¼Œç¬¬1ä¸ªå’Œæœ€åä¸€ä¸ªç¯æ³¡ç‚¹äº®å¯¹äººçœ¼çš„åˆºæ¿€æ„Ÿè§‰æ˜¯ä¸åŒçš„ï¼›*äººçœ¼æ„Ÿè§‰é»‘-&gt;ç™½èŒƒå›´â€œæœ‰é™â€ï¼Œç¯æ³¡å¯ä»¥æ— é™ï¼Œä½†æ„Ÿè§‰ä¼šè¶‹äºä¸€ä¸ªæœ‰é™åˆ¶å€¼ï¼›</p><h3 id="åˆ†æ">åˆ†æ</h3><p>æ­¤æ—¶è¾“å…¥æ˜¯ç¯æ³¡çš„å¼ºåº¦ï¼Œè¾“å‡ºæ˜¯äººçœ¼çš„æ„Ÿè§‰ï¼Œå¤§è‡ªç„¶ä¸­ï¼Œæ„Ÿè§‰çš„å·®åˆ«é˜ˆé™éšåŸæ¥åˆºæ¿€é‡çš„å˜åŒ–è€Œå˜åŒ–ï¼Œè¿™æ˜¯è‘—åçš„éŸ¦ä¼¯å®šå¾‹ï¼Œä¸‹å›¾æ˜¾ç¤ºäº†è‡ªç„¶ç•Œçš„çº¿æ€§å¢é•¿çš„äº®åº¦å’Œäººå¿ƒé‡Œæ„Ÿè§‰çš„ç°ä»‹å…³ç³»å›¾ï¼š<img src="images/l_i6.jpg" alt="è‡ªç„¶äº®åº¦å’Œäººæ„ŸçŸ¥çš„äº®åº¦">å½“ç‰©ç†äº®åº¦è¾¾åˆ°ç™½è‰²çš„20%å·¦å³çš„æ—¶å€™ï¼Œäººçš„å¿ƒç›®ä¸­å·²ç»æ„Ÿå—åˆ°ä¸­ç°è‰²ï¼ˆå³0.5å¤„ï¼‰çš„æ¦‚å¿µã€‚è€Œå‰©ä¸‹çš„ä¸€åŠé«˜å…‰åŒºçš„ç°é˜¶ï¼Œéœ€è¦ç”¨ç™½è‰²80%çš„ç‰©ç†èƒ½é‡æ‰èƒ½ç…§äº®æˆç™½è‰²ã€‚æ ¹æ®è¾“å…¥å’Œè¾“å‡ºçš„å…³ç³»ï¼Œå¯ç¡®å®šæ­¤æ—¶çš„Gammaå¤§çº¦åœ¨1.8~2.5ï¼Œè€Œç°åœ¨å¤§å¤šæ•°ç”¨2.2ã€‚æ‰€ä»¥ï¼ŒGAMMAå€¼çš„åº”ç”¨éå¸¸å¤šï¼Œå¦‚å›¾åƒçš„æ‹æ‘„ä¸­çš„ç›¸æœºçš„GAMMAã€å›¾åƒæ˜¾ç¤ºä¸­çš„æ˜¾ç¤ºå™¨çš„GAMMAã€å›¾åƒè¾“å‡ºä¸­çš„æ‰“å°æœºã€å°åˆ·æœºç­‰GAMMAç­‰ï¼Œä¸åŒè®¾å¤‡çš„GAMMAæè¿°çš„éƒ½æ˜¯æ­¤è®¾å¤‡çš„ä¿¡å·å€¼å¯¹åº”çš„äº®æš—å…³ç³»ï¼Œè€Œä¸”ï¼Œè¿™äº›å…³ç³»éƒ½æ˜¯éçº¿æ€§çš„ã€‚</p><h2 id="æ˜¾ç¤ºå™¨çš„gammaå€¼">æ˜¾ç¤ºå™¨çš„Gammaå€¼</h2><p>æ˜¾ç¤ºå™¨çš„Gammaå€¼è¡¨ç¤ºäº†è¾“å…¥ä¿¡å·çš„é¢œè‰²å€¼ä»¥åŠå‘å…‰çš„äº®åº¦ä¹‹é—´çš„å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¾“å‡ºæ—¶ä»é»‘åˆ°ç™½çš„äº®åº¦è¿‡æ¸¡ã€‚åŒæ ·ï¼Œå…¶ä¹Ÿæ˜¯éçº¿æ€§å…³ç³»çš„ã€‚ä½¿ç”¨ä¸åŒçš„Gammaå€¼ï¼š1.0(çº¿æ€§å“åº”)ï¼Œ1.8~2.2(è¾ƒæš—çš„å›¾åƒ)ï¼Œ3.0(è¿‡æš—çš„å›¾åƒ)æ˜¾ç¤ºåŒä¸€å¹…å›¾åƒï¼š<img src="images/l_i6.jpg" alt="åŒä¸€å¹…å›¾ç‰‡çš„ä¸åŒGammaå€¼">å¯è§ï¼Œè¾ƒä½çš„Gammaå€¼(1.0)æœ‰ä¸€ä¸ªè¾ƒäº®ï¼Œè¾ƒå¹³ç¨³çš„æ˜¾ç¤ºï¼›è€Œè¾ƒé«˜çš„Gammaå€¼(2.2)æœ‰æ›´é«˜å¯¹æ¯”åº¦çš„è¾ƒæš—çš„æ˜¾ç¤ºã€‚ç°åœ¨æ˜¾ç¤ºå™¨ä¸€èˆ¬ç”¨8ä½æ·±çš„RGBæ¥è®°å½•æ•°å­—å›¾åƒï¼Œæ‰€ä»¥æœ€å¤§çš„æ•°æ®å­˜å‚¨é‡å°±æ˜¯28* 28 * 28 =16,777,216ï¼Œå¦‚æœä½¿ç”¨çº¿æ€§çš„æ–¹å¼è¿›è¡Œå­˜å‚¨è‡ªç„¶ä¸­çš„äº®åº¦ï¼Œé‚£å¯èƒ½æ ¹æœ¬ä¸å¤Ÿç”¨ã€‚æ‰€ä»¥æ‹æ‘„çš„å›¾åƒå…ˆç”¨GAMMAè¿›è¡Œå‹ç¼©ï¼Œä¿ç•™äº†å¤§éƒ¨åˆ†çš„ä¸­é—´å’Œæš—è°ƒç»†èŠ‚ï¼Œå†é€šè¿‡GAMMAé‡Šæ”¾ï¼ˆæ ¡æ­£ï¼‰å¹¶æ˜¾ç¤ºï¼Œå±•ç¤ºç»™äººçœ¼çœ‹è§ï¼Œä¿è¯äº†äººçœ¼åœ¨æ˜¾ç¤ºå™¨ä¸Šæ„Ÿè§‰å’Œè‡ªç„¶ä¸­ç›¸åŒã€‚</p><h2 id="ä»€ä¹ˆæ˜¯gammaå€¼ä¸º1.0çº¿æ€§å“åº”">ä»€ä¹ˆæ˜¯Gammaå€¼ä¸º1.0çº¿æ€§å“åº”?</h2><p>å¯¹äºé‡‡é›†è®¾å¤‡ï¼Œå¦‚ç›¸æœºæˆ–è€…æ‰«æä»ªï¼ŒGammaä¸º1.0çš„æ—¶å€™ï¼Œå›¾åƒä¸å­˜åœ¨å‹ç¼©å’Œé‡Šæ”¾ï¼Œç›´æ¥å°†åŸè‡ªç„¶é«˜åŠ¨æ€äº®åº¦1:1è¾“å‡ºä¸ºé«˜åŠ¨æ€æ˜¾ç¤ºä¿¡å·ï¼Œå¦‚æœä¸å¯¹å›¾åƒè¿›è¡ŒGAMMAæ ¡æ­£ï¼Œæ•´ä½“å›¾åƒä¼šæ˜¾å¾—æ›´äº®ï¼Œä¼šå¤±å»æ›´å¤šçš„ä¸­é—´è°ƒå’Œæš—è°ƒï¼ŒåŒæ—¶å›¾åƒ<code>æ–‡ä»¶çš„å¤§å°ä¹Ÿä¼šæ›´å¤§</code>ã€‚å¦‚æˆ‘ä»¬ç†ŸçŸ¥çš„RAWå·¥ä½œæµç¨‹å°±æ˜¯ä¸€ç§çº¿æ€§GAMMAæµç¨‹ã€‚</p><h2 id="æ˜¾ç¤ºå™¨çš„gammaå€¼æ ‡å‡†æ˜¯å¤šå°‘">æ˜¾ç¤ºå™¨çš„Gammaå€¼æ ‡å‡†æ˜¯å¤šå°‘?</h2><p>GAMMAå€¼æ²¡æœ‰æ ‡å‡†ï¼Œå¦‚æœè¦æ­£ç¡®çš„æ‰¾åˆ°GAMMAçš„æ ‡å‡†ï¼Œåªèƒ½é€šè¿‡æ¯å°æ˜¾ç¤ºå™¨çš„è°ƒæ•´GAMMAæ›´é€‚åˆäººçœ¼çš„æ„Ÿè§‰ï¼Œå³æ„Ÿè§‰ç™½-é»‘ä¹‹é—´çš„æ¸å˜å¹³æ»‘ï¼Œè€Œä¸”ä¸­é—´ç°å¤„äº0.5ä¸­é—´çš„ä½ç½®ï¼Œå¦‚ä¸‹å›¾ï¼ˆ8ä½æ·±çš„RGBç¼–ç æ¨¡å¼ä¸‹ï¼‰ï¼š<img src="images/l_i6.jpg"></p><p>ä¸€èˆ¬è€Œè¨€ï¼Œæ˜¾ç¤ºå™¨çš„GAMMAå€¼ä¼šåœ¨1.8~2.5ä¹‹é—´ã€‚ç”±äºæœ€åˆçš„CRTæ˜¾ç¤ºå™¨çš„GAMMAé‡‡ç”¨2.2ï¼Œæ‰€ä»¥ç°åœ¨å¤§éƒ¨åˆ†æ˜¾ç¤ºå™¨è¿˜æ˜¯æ²¿ç”¨2.2ä½œä¸ºæ¨èçš„GAMMAå€¼ï¼Œä½†Macä¸­ä½¿ç”¨1.8ã€‚æ²¡æœ‰å¯¹ä¸é”™ï¼Œæœ€æ­£ç¡®çš„æ–¹æ³•åˆ™æ˜¯é€šè¿‡ç°ä»‹è‡ªå·±æ‰¾åˆ°æœ€ä½³çš„GAMMAå€¼ã€‚<img src="images/gamma_compare.jpg"></p><h2 id="æ‰“å°æœºå°åˆ·æœºgammaå€¼">æ‰“å°æœºã€å°åˆ·æœºGammaå€¼?</h2><p>æµç¨‹ä¸­çš„æ‰€æœ‰è®¾å¤‡éƒ½æœ‰å®ƒä»¬è‡ªå·±ç‹¬æœ‰çš„Gammaç‰¹æ€§ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆç”¨GammaæŸ¥æ‰¾è¡¨(LUTs)æ¥ç”Ÿæˆæ˜¾ç¤ºå™¨çš„Gammaä»¥åŒ¹é…å…¶å®ƒè®¾å¤‡çš„Gammaã€‚å¦‚ä¸“ä¸šçš„æ‰«æä»ªçš„Gammaå€¼ä¸€ç›´éƒ½æ˜¯1.0ï¼Œè¿™æ ·å¯ä»¥åœ¨æ‰«æè¿‡ç¨‹ä¸­å¾—åˆ°æœ€å¤§çš„çº¿æ€§å“åº”ï¼Œè€Œä¾¿å®œçš„æ‰«æä»ªåˆ™ä½¿ç”¨è¾ƒé«˜çš„Gammaå€¼æ¥é¿å…å¤šä½™çš„æš—è°ƒå™ªå£°ã€‚</p><p>å¯¹äºèƒ¶å°ï¼ŒGAMMAæ˜¯CMYKæ¯”ä¾‹å’Œäººçœ¼çš„äº®åº¦åˆºæ¿€å…³ç³»ï¼Œä¹Ÿå°±æ˜¯å¯†åº¦å€¼å¤§å°ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä½¿ç”¨â€œç½‘ç‚¹æ‰©å¤§â€æˆ–è€…â€œTVIâ€ï¼Œè€Œä¸æ˜¯â€œGammaâ€ï¼Œä½†æ˜¯ä¸¤è€…åŒç†ã€‚å®ƒæ˜¯è®¾å¤‡çš„é˜¶è°ƒå“åº”ä»¥åŠä¸­é—´è°ƒçš„ä¸»è¦å½±å“å› ç´ ï¼Œè¿™ç‚¹ä¸Gammaç±»ä¼¼ã€‚å°åˆ·æœºçš„ç½‘ç‚¹æ‰©å¤§æœ‰ç‚¹åƒ1.7ï¼Œ1.8çš„Gammaã€‚ä½†æ˜¯å®é™…çš„å€¼å–å†³äºå°åˆ·æœºã€çº¸å¼ ã€æ²¹å¢¨ç­‰ã€‚ç›¸å…³çš„å› ç´ æ¯”æ˜¾ç¤ºå™¨çš„GAMMAæ ¡æ­£å¤šå¾ˆå¤šã€‚</p><h2 id="å°åˆ·æœºgammaä¸æ˜¾ç¤ºå™¨çš„gammaçš„æ¯”è¾ƒ">å°åˆ·æœºGammaä¸æ˜¾ç¤ºå™¨çš„Gammaçš„æ¯”è¾ƒ</h2><p>äº‹å®ä¸Šï¼Œå¦‚æœè§‚å¯Ÿä¸€å¹…å°åˆ·å›¾åƒï¼Œä½ å®é™…ä¼šçœ‹åˆ°ä½äº®åº¦å’Œé«˜å…‰éƒ¨åˆ†çš„å‹ç¼©ï¼Œå› æ­¤ï¼Œåœ¨æ›²çº¿å›¾ä¸Šï¼Œå°åˆ·å›¾åƒçš„è‰²è°ƒæ›²çº¿æˆ–Gammaæ›²çº¿ä¼šå‘ˆç°Så½¢ã€‚<img src="images/press_monitor.jpg"><strong>æ˜¾ç¤ºå™¨çš„Gammaæ›²çº¿åœ¨ç«¯ç‚¹åªä¼šæ²¿ç€ä¸€ä¸ªæ–¹å‘ä¼¸å±•ï¼Œè¿™å–å†³äºæ˜¾ç¤ºå™¨çš„æ¨¡æ‹ŸçŠ¶å†µã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ˜¾ç¤ºå™¨ä¸Šçš„å›¾åƒä¸€ç›´æ¯”å°åˆ·å›¾åƒå‘ˆç°å‡ºæ›´å¤§çš„å¯¹æ¯”åº¦çš„åŸå› ã€‚</strong></p><!-- > ä»¥å‰åœ¨CRTå’Œæ—©æœŸLCDç›‘è§†å™¨ä¸­çš„Gammaä¸ç”µå‹ç›´æ¥ç›¸å…³ï¼Œæ˜¯åœ¨æ˜¾ç¤ºå™¨ä¸Šå‡†ç¡®å†ç°å›¾åƒçš„é‡è¦å› ç´ ã€‚åœ¨å½“å‰çš„LCDç›‘è§†å™¨ä¸­ï¼ŒGammaå¯ä»¥è¢«è®¤ä¸ºæ˜¯åœ¨è§‚çœ‹æ˜¾ç¤ºå™¨æ—¶ï¼Œæ•è·çš„æ•°æ®çš„äº®åº¦ï¼ˆè¾“å…¥ï¼‰ä¸å¦‚ä½•å½±å“äººçœ¼å¯¹é¢œè‰²ï¼ˆè¾“å‡ºï¼‰çš„æ€»ä½“æ„ŸçŸ¥ä¹‹é—´çš„å…³ç³»çš„è°ƒèŠ‚å™¨ã€‚ -->]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/yan-se-kong-jian/1.unity-de-yan-se-kong-jian-guan-li-yu-zhuan-huan/"/>
      <url>/2022/08/10/yan-se-kong-jian/1.unity-de-yan-se-kong-jian-guan-li-yu-zhuan-huan/</url>
      
        <content type="html"><![CDATA[<h1 id="unityçš„é¢œè‰²ç©ºé—´ç®¡ç†ä¸è½¬æ¢">Unityçš„é¢œè‰²ç©ºé—´ç®¡ç†ä¸è½¬æ¢</h1><blockquote><ol type="1"><li>çº¹ç†å–æ¶ˆé€‰ä¸­ sRGB (Color Texture)ï¼Œ åˆ™å¯ä»¥ç»•è¿‡sRGB é‡‡æ ·</li><li>Unityå…‰ç…§è®¡ç®—éƒ½æ˜¯åœ¨çº¿æ€§ç©ºé—´ä¸­</li><li>è€ç‰ˆæœ¬çš„guiç³»ç»Ÿ è´´å›¾å¯¼å…¥æ—¶ä¸ä¼šç§»é™¤å…¶ä¼½é©¬æ ¡æ­£ã€‚</li><li>å¯ä»¥åœ¨çº¿æ€§ç©ºé—´shaderä¸­æ‰‹åŠ¨è¿›è¡ŒgammaçŸ«æ­£ã€‚<strong>å°½é‡ä½¿ç”¨å†…ç½®å‡½æ•°,å› ä¸ºUnityå¤„ç†äº†å›¾ç‰‡,å‚æ•°ä¹‹ç±»çš„éœ€è¦ä¸€è‡´æ€§</strong></li></ol></blockquote><h2 id="ä¸¤ç§é¢œè‰²ç©ºé—´çš„ä»‹ç»">ä¸¤ç§é¢œè‰²ç©ºé—´çš„ä»‹ç»</h2><blockquote><p>Unityå¼•æ“æ”¯æŒä¸¤ç§é¢œè‰²ç©ºé—´: ä¼½é©¬(Gamma) å’Œ çº¿æ€§(Liner)ä¼½é©¬é¢œè‰²ç©ºé—´æ˜¯<strong>å†å²æ‚ ä¹…çš„æ ‡å‡†æ ¼å¼</strong>ï¼Œä½†çº¿æ€§é¢œè‰²ç©ºé—´æ¸²æŸ“å¯æä¾›<strong>æ›´ç²¾ç¡®çš„ç»“æœ</strong>ã€‚</p></blockquote><p><img src="images/LinearLighting-LinearGradients.png">ç”±äºå†å²åŸå› ï¼Œç›‘è§†å™¨å’Œæ˜¾ç¤ºå™¨å…·æœ‰ç›¸åŒçš„ç‰¹æ€§ã€‚å‘ç›‘è§†å™¨å‘é€çº¿æ€§ä¿¡å·ä¼šå¯¼è‡´çœ‹èµ·æ¥åƒä¸Šå›¾å³ä¾§çš„æ¸å˜ï¼Œäººçœ¼è§‚å¯Ÿæ„Ÿè§‰æ˜¯é”™è¯¯çš„ã€‚ä¸ºäº†å¼¥è¡¥è¿™ä¸€ç‚¹ï¼Œéœ€è¦å‘é€ç»æ ¡æ­£çš„ä¿¡å·æ¥ç¡®ä¿ç›‘è§†å™¨èƒ½å¤Ÿå‘ˆç°å‡ºçœ‹èµ·æ¥è‡ªç„¶çš„å›¾åƒã€‚è¿™ç§æ ¡æ­£ç§°ä¸ºä¼½é©¬æ ¡æ­£ã€‚</p><p><strong>Unityä¼½é©¬å’Œçº¿æ€§é¢œè‰²ç©ºé—´åŒæ—¶å­˜åœ¨çš„åŸå› æ˜¯ï¼Œå…‰ç…§è®¡ç®—åº”è¯¥åœ¨çº¿æ€§ç©ºé—´ä¸­è¿›è¡Œï¼Œä»¥ä¾¿ç¡®ä¿æ•°å­¦ä¸Šçš„æ­£ç¡®æ€§ï¼Œä½†ç»“æœåº”è¯¥åœ¨ä¼½é©¬ç©ºé—´ä¸­å‘ˆç°ä»¥ä¾¿è®©äººçœ¼çœ‹èµ·æ¥æ­£ç¡®ã€‚</strong>åœ¨å¸§ç¼“å†²æ ¼å¼é™åˆ¶ä¸ºæ¯é€šé“ 8ä½çš„æ—§ç¡¬ä»¶ä¸Šï¼Œè®¡ç®—å…‰ç…§æ—¶ä½¿ç”¨ä¼½é©¬æ›²çº¿å¯åœ¨äººç±»å¯æ„ŸçŸ¥çš„èŒƒå›´å†…æä¾›æ›´é«˜çš„ç²¾åº¦ã€‚åœ¨äººçœ¼æœ€æ•æ„Ÿçš„èŒƒå›´å†…ï¼Œä½¿ç”¨çš„ä½æ•°æœ€å¤šã€‚å³ä½¿å½“ä»Šçš„ç›‘è§†å™¨æ˜¯æ•°å­—æ˜¾ç¤ºå™¨ï¼Œå®ƒä»¬ä»ç„¶é‡‡ç”¨ä¼½é©¬ç¼–ç ä¿¡å·ä½œä¸ºè¾“å…¥ä¿¡å·ã€‚å›¾åƒæ–‡ä»¶å’Œè§†é¢‘æ–‡ä»¶æ˜¾å¼ç¼–ç åˆ°ä¼½é©¬ç©ºé—´ï¼ˆè¿™æ„å‘³ç€å®ƒä»¬å¸¦æœ‰ä¼½é©¬ç¼–ç å€¼ï¼Œè€Œä¸æ˜¯çº¿æ€§å¼ºåº¦ï¼‰ã€‚è¿™ä¾¿æ˜¯æ ‡å‡†ï¼›ä¸€åˆ‡æ•°å€¼éƒ½åœ¨ä¼½é©¬ç©ºé—´å†…ã€‚ä¼½é©¬ç©ºé—´çš„å…¬è®¤æ ‡å‡†ç§°ä¸º sRGBï¼ˆè¯·å‚é˜…Wikipediaï¼‰ã€‚è¯¥æ ‡å‡†å®šä¹‰äº†å®ƒä¸çº¿æ€§ç©ºé—´ä¹‹é—´çš„ä¸€ä¸ªæ˜ å°„ï¼Œä½¿å¾—äººçœ¼èƒ½å……åˆ†åˆ©ç”¨8 ä½/é€šé“çš„ç²¾åº¦ã€‚ä¸‹é¢æ˜¯æ­¤æ˜ å°„çš„å›¾è¡¨ã€‚ <img src="images/LinearRenderingMapping.png">çº¿æ€§æ¸²æŸ“æŒ‡çš„æ˜¯æ¸²æŸ“åœºæ™¯çš„è¿‡ç¨‹ï¼Œæ­¤æƒ…å†µä¸‹çš„æ‰€æœ‰è¾“å…¥éƒ½æ˜¯çº¿æ€§çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰ç»è¿‡ä¼½é©¬æ ¡æ­£ä»¥é€‚åˆäººçœ¼è§‚å¯Ÿæˆ–è¾“å‡ºåˆ°æ˜¾ç¤ºå™¨ã€‚</p><h2 id="unityçº¿æ€§å’Œä¼½é©¬å·¥ä½œæµç¨‹">Unityçº¿æ€§å’Œä¼½é©¬å·¥ä½œæµç¨‹</h2><p>çº¹ç†å€¾å‘äºä¿å­˜åœ¨ä¼½é©¬é¢œè‰²ç©ºé—´ä¸­ï¼Œè€Œç€è‰²å™¨æœŸæœ›ä½¿ç”¨çº¿æ€§é¢œè‰²ç©ºé—´ã€‚å› æ­¤ï¼Œåœ¨ç€è‰²å™¨ä¸­å¯¹çº¹ç†è¿›è¡Œé‡‡æ ·æ—¶ï¼ŒåŸºäºä¼½é©¬çš„å€¼ä¼šå¯¼è‡´ä¸å‡†ç¡®çš„ç»“æœã€‚ä¸ºäº†è§£å†³æ­¤é—®é¢˜ï¼Œå¯å°†Unity è®¾ç½®ä¸ºä½¿ç”¨ RGBé‡‡æ ·å™¨ä»ä¼½é©¬é‡‡æ ·è·¨è¶Šåˆ°çº¿æ€§é‡‡æ ·ã€‚è¿™æ ·ç¡®ä¿äº†çº¿æ€§å·¥ä½œæµç¨‹ä¸­çš„ç€è‰²å™¨çš„æ‰€æœ‰è¾“å…¥å’Œè¾“å‡ºéƒ½åœ¨æ­£ç¡®çš„é¢œè‰²ç©ºé—´ä¸­ï¼Œä»è€Œäº§ç”Ÿæ­£ç¡®çš„ç»“æœã€‚</p><h3 id="åˆ‡æ¢gamma-å’Œliner-é€‰é¡¹æ¨¡å¼">åˆ‡æ¢Gamma å’ŒLiner é€‰é¡¹æ¨¡å¼</h3><p>è¦æŒ‡å®šä¼½é©¬æˆ–çº¿æ€§å·¥ä½œæµç¨‹ï¼Œè¯·é€‰æ‹©<code>Edit</code> &gt;<code>Project Settings</code>ï¼Œå†é€‰æ‹© <code>Player</code> ç±»åˆ«ï¼Œå¯¼èˆªåˆ°<code>Other Settings</code>ï¼Œæ‰“å¼€ <code>Rendering</code>éƒ¨åˆ†ï¼Œç„¶åæ ¹æ®åå¥½å°† Color Space æ›´æ”¹ä¸º <code>Linear</code> æˆ–<code>Gamma</code>ã€‚</p><p>éœ€è¦æ³¨æ„ï¼šAndroidå¹³å°éœ€è¦æ³¨æ„çš„æ˜¯, Liner æ¨¡å¼ä¸æ”¯æŒ<code>OpenGLES2</code>, è‡ªç„¶ä¹Ÿä¸æ”¯æŒ<code>Auto Graphic API</code>é€‰é¡¹</p><h2 id="éœ€è¦æ³¨æ„çš„é¡¹">éœ€è¦æ³¨æ„çš„é¡¹</h2><h3 id="gammaç©ºé—´æ¨¡å¼">Gammaç©ºé—´æ¨¡å¼</h3><p>å³ä½¿è¿™äº›å€¼åœ¨ä¼½é©¬ç©ºé—´ä¸­ï¼ŒUnity Editorçš„æ‰€æœ‰ç€è‰²å™¨è®¡ç®—ä»ç„¶æŒ‰ç…§åœ¨çº¿æ€§ç©ºé—´ä¸­çš„æ–¹å¼å¤„ç†å®ƒä»¬çš„è¾“å…¥ã€‚ä¸ºäº†ç¡®ä¿è·å¾—å¯æ¥å—çš„æœ€ç»ˆç»“æœï¼ŒEditoråœ¨å°†ç€è‰²å™¨è¾“å‡ºå†™å…¥å¸§ç¼“å†²åŒºæ—¶è¿›è¡Œè°ƒæ•´ä»¥å¤„ç†ä¸åŒ¹é…çš„æ ¼å¼ï¼Œå¹¶ä¸”ä¸å¯¹æœ€ç»ˆç»“æœåº”ç”¨ä¼½é©¬æ ¡æ­£ã€‚</p><h3 id="linerç©ºé—´æ¨¡å¼">Linerç©ºé—´æ¨¡å¼</h3><p>å¦‚æœçº¹ç†æ˜¯åœ¨çº¿æ€§æˆ–ä¼½é©¬é¢œè‰²ç©ºé—´ä¸­åˆ›å»ºçš„ï¼Œåˆ™å¯ä½¿ç”¨çº¿æ€§é¢œè‰²ç©ºé—´ã€‚å‘çº¿æ€§é¢œè‰²ç©ºé—´ç€è‰²å™¨ç¨‹åºæä¾›çš„ä¼½é©¬é¢œè‰²ç©ºé—´çº¹ç†å°†åœ¨ç§»é™¤ä¼½é©¬æ ¡æ­£åè¾“å…¥ç»™ç€è‰²å™¨ã€‚</p><h2 id="unityçº¿æ€§å’Œä¼½é©¬ç©ºé—´çš„çº¹ç†">Unityçº¿æ€§å’Œä¼½é©¬ç©ºé—´çš„çº¹ç†</h2><p>Unity åœ¨<strong>é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨ GPU çš„ sRGBé‡‡æ ·å™¨ä»ä¼½é©¬é¢œè‰²ç©ºé—´è·¨è¶Šåˆ°çº¿æ€§é¢œè‰²ç©ºé—´ã€‚å¦‚æœçº¹ç†æ˜¯åœ¨çº¿æ€§é¢œè‰²ç©ºé—´å†…åˆ›å»ºçš„ï¼Œåˆ™éœ€è¦ç»•è¿‡sRGB é‡‡æ ·</strong>ã€‚</p><h3 id="é‡‡ç”¨çº¿æ€§æ¸²æŸ“çš„-gamma-çº¹ç†">é‡‡ç”¨çº¿æ€§æ¸²æŸ“çš„ Gamma çº¹ç†</h3><p>å¦‚æœçº¹ç†ä½äºçº¿æ€§é¢œè‰²ç©ºé—´å†…ï¼Œéœ€è¦ç¦ç”¨ sRGB é‡‡æ ·ã€‚</p><p>çº¿æ€§æ¸²æŸ“ä¸ºæ¸²æŸ“çš„åœºæ™¯æä¾›ä¸åŒçš„å¤–è§‚ã€‚å¦‚æœåˆ›ä½œçš„é¡¹ç›®åœ¨ä¼½é©¬ç©ºé—´ä¸­æ¸²æŸ“æ—¶çœ‹èµ·æ¥å¾ˆå¥½ï¼Œé‚£ä¹ˆæ›´æ”¹ä¸ºçº¿æ€§æ¸²æŸ“æ—¶ï¼Œè§†è§‰æ•ˆæœä¸å¤ªä¼šä»ç„¶ä¿æŒè‰¯å¥½ã€‚å› æ­¤ï¼Œå¦‚æœä»ä¼½é©¬æ¸²æŸ“æ›´æ”¹ä¸ºçº¿æ€§æ¸²æŸ“ï¼Œæ‚¨å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´æ¥è°ƒæ•´é¡¹ç›®ï¼Œä½¿å…¶çœ‹èµ·æ¥åƒä»¥å‰ä¸€æ ·å¥½ã€‚ä¸è¿‡ï¼Œè¿™ç§è½¬å˜æœ€ç»ˆå¯å®ç°æ›´åŠ ä¸€è‡´å’Œé€¼çœŸçš„æ¸²æŸ“ã€‚æ‚¨å¯èƒ½éœ€è¦è°ƒæ•´çº¹ç†ã€æè´¨å’Œå…‰ç…§ã€‚</p><h4 id="å…‰ç…§è´´å›¾">å…‰ç…§è´´å›¾</h4><p>å…‰ç…§è´´å›¾ä¸­çš„å…‰ç…§è®¡ç®—å§‹ç»ˆåœ¨çº¿æ€§ç©ºé—´ä¸­å®Œæˆã€‚<strong>å…‰ç…§è´´å›¾å§‹å­˜å‚¨åœ¨ä¼½é©¬ç©ºé—´ä¸­ã€‚è¿™æ„å‘³ç€ï¼Œæ— è®ºæ˜¯åœ¨ä¼½é©¬è¿˜æ˜¯çº¿æ€§é¢œè‰²ç©ºé—´ä¸­ï¼Œå…‰ç…§è´´å›¾çº¹ç†éƒ½æ˜¯ç›¸åŒçš„ã€‚</strong>ä½äºçº¿æ€§é¢œè‰²ç©ºé—´æ—¶ï¼Œçº¹ç†æ ·æœ¬åœ¨çº¹ç†é‡‡æ ·æ—¶ä¼šä»ä¼½é©¬ç©ºé—´è½¬æ¢ä¸ºçº¿æ€§ç©ºé—´ã€‚ä½äºä¼½é©¬é¢œè‰²ç©ºé—´æ—¶åˆ™ä¸éœ€è¦è½¬æ¢ã€‚<strong>å› æ­¤ï¼Œåœ¨æ›´æ”¹é¢œè‰²ç©ºé—´è®¾ç½®åï¼Œå¿…é¡»é‡æ–°çƒ˜ç„™å…‰ç…§è´´å›¾ï¼šå½“Unityçš„å…‰ç…§è®¾ç½®ä¸ºè‡ªåŠ¨çƒ˜ç„™ï¼ˆé»˜è®¤è®¾ç½®ï¼‰æ—¶ï¼Œæ­¤è¿‡ç¨‹ä¼šè‡ªåŠ¨æ¿€æ´»ã€‚</strong></p><p>Unity åˆ›å»ºçš„å…‰ç…§è´´å›¾ EXRæ–‡ä»¶ä¸­çš„æ•°æ®ä½äºçº¿æ€§ç©ºé—´å†…ã€‚å¯¼å…¥è¿‡ç¨‹ä¸­å®ƒå°†è¢«è½¬æ¢åˆ°ä¼½é©¬ç©ºé—´ã€‚ä»å¤–éƒ¨å…‰ç…§è´´å›¾ä¸­å¼•å…¥å…‰ç…§è´´å›¾æ—¶ï¼Œ<strong>è¯·å°†å…‰ç…§è´´å›¾çš„Texture Type è®¾ç½®ä¸º Lightmapã€‚æ­¤è®¾ç½®å¯ç¡®ä¿åœ¨å¯¼å…¥æ—¶ç»•è¿‡ sRGBé‡‡æ ·ã€‚</strong></p><h4 id="çº¿æ€§æ¸²æŸ“æ”¯æŒçš„å¹³å°">çº¿æ€§æ¸²æŸ“æ”¯æŒçš„å¹³å°</h4><ul><li>Windowsã€Mac OS X å’Œ Linuxï¼ˆç‹¬ç«‹å¹³å°ï¼‰</li><li>Xbox One</li><li>PlayStation 4</li><li>Android</li><li>iOS</li><li>WebGL</li></ul><p>å½“è®¾å¤‡ä¸æ”¯æŒçº¿æ€§æ¸²æŸ“æ—¶ï¼Œä¸ä¼šå›é€€åˆ°ä¼½é©¬ç©ºé—´ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ’­æ”¾å™¨å°†é€€å‡ºã€‚é€šè¿‡åœ¨è„šæœ¬ä¸­æŸ¥æ‰¾QualitySettings.activeColorSpace å³å¯æ ¸å®æœ‰æ•ˆçš„é¢œè‰²ç©ºé—´ã€‚å¦‚æœå¹³å°æˆ–ç¡¬ä»¶ä¸æ”¯æŒç»™å®šçš„é¢œè‰²ç©ºé—´ï¼Œåˆ™æœ€ç»ˆå®é™…ä½¿ç”¨çš„é¢œè‰²ç©ºé—´å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒ *QualitySettings.desiredColorSpace : ç”¨æˆ·æŒ‡å®šçš„é¢œè‰²ç©ºé—´rending *QualitySettings.activeColorSpace : å®é™…ä½¿ç”¨çš„é¢œè‰²ç©ºé—´rending</p><div class="sourceCode" id="cb1"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">namespace</span> UnityEngine</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// æ‘˜è¦:</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">//     Color space for player settings.</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">enum</span> ColorSpace</span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">//</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// æ‘˜è¦:</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">//     Uninitialized color space.</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        Uninitialized <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">//</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">// æ‘˜è¦:</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">//     Gamma color space.</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        Gamma <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">//</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">// æ‘˜è¦:</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">//     Linear color space.</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        Linear <span class="op">=</span> <span class="dv">1</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><p>åœ¨ Androidä¸Šï¼Œçº¿æ€§æ¸²æŸ“<code>è‡³å°‘éœ€è¦ OpenGL ES 3.0 å›¾å½¢ API å’Œ Android 4.3ã€‚</code>åœ¨ iOS ä¸Šï¼Œçº¿æ€§æ¸²æŸ“éœ€è¦ Metal å›¾å½¢ APIã€‚ åœ¨ WebGL ä¸Šï¼Œçº¿æ€§æ¸²æŸ“è‡³å°‘éœ€è¦WebGL 2.0 å›¾å½¢ APIã€‚</p><h4 id="çº¿æ€§é¢œè‰²ç©ºé—´å’Œ-hdr">çº¿æ€§é¢œè‰²ç©ºé—´å’Œ HDR</h4><p>ä½¿ç”¨ HDRæ—¶ï¼Œæ¸²æŸ“åœ¨çº¿æ€§ç©ºé—´ä¸­æ‰§è¡Œåˆ°æµ®ç‚¹ç¼“å†²åŒºã€‚è¿™äº›ç¼“å†²åŒºå…·æœ‰è¶³å¤Ÿçš„ç²¾åº¦ï¼Œæ— è®ºä½•æ—¶è®¿é—®ç¼“å†²åŒºï¼Œéƒ½ä¸éœ€è¦è½¬æ¢åˆ°ä¼½é©¬ç©ºé—´æˆ–ä»ä¼½é©¬ç©ºé—´è½¬æ¢ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨çº¿æ€§æ¨¡å¼ä¸‹æ¸²æŸ“æ—¶ï¼Œæ‚¨ä½¿ç”¨çš„å¸§ç¼“å†²åŒºä¼šå°†é¢œè‰²å­˜å‚¨åœ¨çº¿æ€§ç©ºé—´ä¸­ã€‚å› æ­¤ï¼Œæ‰€æœ‰æ··åˆæ•ˆæœå’Œåå¤„ç†æ•ˆæœå‡åœ¨çº¿æ€§ç©ºé—´ä¸­éšå¼æ‰§è¡Œã€‚å½“å†™å…¥æœ€ç»ˆåå¤‡ç¼“å†²åŒºæ—¶ï¼Œå°†åº”ç”¨ä¼½é©¬æ ¡æ­£ã€‚</p><h4 id="çº¿æ€§é¢œè‰²ç©ºé—´å’Œé-hdr">çº¿æ€§é¢œè‰²ç©ºé—´å’Œé HDR</h4><p>å¯ç”¨çº¿æ€§é¢œè‰²ç©ºé—´ä½†æœªå¯ç”¨ HDR æ—¶ï¼Œå°†ä½¿ç”¨ä¸€ç§ç‰¹æ®Šçš„å¸§ç¼“å†²ç±»å‹ï¼Œå®ƒæ”¯æŒsRGB è¯»å–å’Œ sRGBå†™å…¥ï¼ˆè¯»å–æ—¶ä»ä¼½é©¬è½¬æ¢ä¸ºçº¿æ€§ï¼Œè€Œå†™å…¥æ—¶ä»çº¿æ€§è½¬æ¢ä¸ºä¼½é©¬ï¼‰ã€‚å½“æ­¤å¸§ç¼“å†²åŒºç”¨äºæ··åˆï¼Œæˆ–å°†å…¶ç»‘å®šä¸ºçº¹ç†æ—¶ï¼Œå€¼åœ¨ä½¿ç”¨å‰å°†è½¬æ¢ä¸ºçº¿æ€§ç©ºé—´ã€‚å†™å…¥è¿™äº›ç¼“å†²åŒºæ—¶ï¼Œæ‰€å†™å…¥çš„å€¼å°†ä»çº¿æ€§ç©ºé—´è½¬æ¢ä¸ºä¼½é©¬ç©ºé—´ã€‚å¦‚æœåœ¨çº¿æ€§æ¨¡å¼å’ŒéHDR æ¨¡å¼ä¸‹è¿›è¡Œæ¸²æŸ“ï¼Œåˆ™æ‰€æœ‰åå¤„ç†æ•ˆæœéƒ½ä¼šåˆ›å»ºå…¶æºç¼“å†²åŒºå’Œç›®æ ‡ç¼“å†²åŒºå¹¶å¯ç”¨sRGB è¯»å†™æƒé™ï¼Œä»¥ä¾¿åœ¨çº¿æ€§ç©ºé—´ä¸­è¿›è¡Œåå¤„ç†å’Œåå¤„ç†æ··åˆã€‚</p><h3 id="ä½¿ç”¨çº¿æ€§çº¹ç†">ä½¿ç”¨çº¿æ€§çº¹ç†</h3><p>å½“çº¹ç†å¤„äºä¼½é©¬é¢œè‰²ç©ºé—´æ—¶ï¼ŒsRGB é‡‡æ ·å…è®¸ Unity Editoråœ¨çº¿æ€§é¢œè‰²ç©ºé—´ä¸­æ¸²æŸ“ç€è‰²å™¨ã€‚<strong>å½“æ‚¨é€‰æ‹©ä½¿ç”¨çº¿æ€§é¢œè‰²ç©ºé—´æ—¶ï¼ŒEditoré»˜è®¤ä½¿ç”¨ sRGBé‡‡æ ·ã€‚å¦‚æœçº¹ç†å¤„äºçº¿æ€§é¢œè‰²ç©ºé—´ï¼Œåˆ™éœ€è¦ä½¿ç”¨çº¿æ€§é¢œè‰²ç©ºé—´å¹¶ä¸ºæ¯ä¸ªçº¹ç†ç¦ç”¨sRGB é‡‡æ ·</strong>ã€‚</p><ul><li>æ—§ç‰ˆæœ¬ guiä¸ä¼šç§»é™¤ sRGB å¯¹æ—§ç‰ˆ GUIç³»ç»Ÿå…ƒç´ çš„æ¸²æŸ“å§‹ç»ˆåœ¨ä¼½é©¬ç©ºé—´ä¸­å®Œæˆã€‚Editor GUI and Legacy GUIçš„çº¹ç†åœ¨å¯¼å…¥æ—¶ä¸ä¼šç§»é™¤å…¶ä¼½é©¬æ ¡æ­£ã€‚</li></ul><h4 id="çº¿æ€§åˆ›ä½œçš„çº¹ç†">çº¿æ€§åˆ›ä½œçš„çº¹ç†</h4><p>åŒæ ·é‡è¦çš„æ˜¯ï¼Œå¦‚æœæŸ¥æ‰¾çº¹ç†ã€é®ç½©å’Œå…¶ä»–çº¹ç†<strong>å­˜åœ¨æœ‰ç‰¹æ®Šæ„ä¹‰ä¸”æœªåº”ç”¨ä¼½é©¬æ ¡æ­£çš„RGB å€¼ï¼Œåˆ™å¿…é¡»ç»•è¿‡ sRGBé‡‡æ ·ã€‚</strong>è¿™æ ·å¯ä»¥é˜²æ­¢è¢«é‡‡æ ·çº¹ç†çš„å€¼åœ¨ç”¨äºç€è‰²å™¨ä¹‹å‰åˆ é™¤ä¸å­˜åœ¨çš„ä¼½é©¬æ ¡æ­£ï¼Œç¡®ä¿ä½¿ç”¨ç£ç›˜ä¸Šå­˜å‚¨çš„åŸå§‹å€¼è¿›è¡Œè®¡ç®—ã€‚Unityå‡è®¾ GUI çº¹ç†å’Œæ³•çº¿è´´å›¾çº¹ç†éƒ½æ˜¯åœ¨çº¿æ€§ç©ºé—´ä¸­åˆ›ä½œçš„ã€‚</p><h2 id="unity-shder-ä¸­è¿›è¡Œæ‰‹åŠ¨çŸ«æ­£">Unity Shder ä¸­è¿›è¡Œæ‰‹åŠ¨çŸ«æ­£</h2><h3 id="ä½¿ç”¨å†…ç½®å‡½æ•°">ä½¿ç”¨å†…ç½®å‡½æ•°</h3><ul><li>åŒ…å« <code>UnityCG.cginc</code><ul><li>å†…ç½®çš„ linerè½¬æ¢ gammaå‡½æ•°</li></ul><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">inline</span> half3 LinearToGammaSpace <span class="op">(</span>half3 linRGB<span class="op">)</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        linRGB <span class="op">=</span> max<span class="op">(</span>linRGB<span class="op">,</span> half3<span class="op">(</span><span class="fl">0.</span><span class="er">h</span><span class="op">,</span> <span class="fl">0.</span><span class="er">h</span><span class="op">,</span> <span class="fl">0.</span><span class="er">h</span><span class="op">));</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">// An almost-perfect approximation from http://chilliant.blogspot.com.au/2012/08/srgb-approximations-for-hlsl.html?m=1</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> max<span class="op">(</span><span class="fl">1.055</span><span class="er">h</span> <span class="op">*</span> pow<span class="op">(</span>linRGB<span class="op">,</span> <span class="fl">0.416666667</span><span class="er">h</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.055</span><span class="er">h</span><span class="op">,</span> <span class="fl">0.</span><span class="er">h</span><span class="op">);</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Exact version, useful for debugging.</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">//return half3(LinearToGammaSpaceExact(linRGB.r), LinearToGammaSpaceExact(linRGB.g), LinearToGammaSpaceExact(linRGB.b));</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><ul><li>å†…ç½®çš„ gamma è½¬æ¢linerå‡½æ•°</li></ul><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> half3 GammaToLinearSpace <span class="op">(</span>half3 sRGB<span class="op">)</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Approximate version from http://chilliant.blogspot.com.au/2012/08/srgb-approximations-for-hlsl.html?m=1</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sRGB <span class="op">*</span> <span class="op">(</span>sRGB <span class="op">*</span> <span class="op">(</span>sRGB <span class="op">*</span> <span class="fl">0.305306011</span><span class="er">h</span> <span class="op">+</span> <span class="fl">0.682171111</span><span class="er">h</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.012522878</span><span class="er">h</span><span class="op">);</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Precise version, useful for debugging.</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//return half3(GammaToLinearSpaceExact(sRGB.r), GammaToLinearSpaceExact(sRGB.g), GammaToLinearSpaceExact(sRGB.b));</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li><li>å¯¹æœ€ç»ˆçš„é¢œè‰²è¿›è¡Œè¿ç®—</li></ul><div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Unity built-in shader source. Copyright (c) 2016 Unity Technologies. MIT license (see license.txt)</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>Shader <span class="st">"Name"</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    Properties</span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">//...</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    SubShader</span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ...</span></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        Pass</span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>           <span class="co">//...</span></span><span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        CGPROGRAM</span><span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ...</span></span><span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma fragment frag</span></span><span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ...</span></span><span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#include </span><span class="im">"UnityUI.cginc"</span></span><span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ...</span></span><span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>            fixed4 frag<span class="op">(</span>v2f IN<span class="op">)</span> <span class="op">:</span> SV_Target</span><span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                half4 color <span class="op">=</span> <span class="co">// ...;</span></span><span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                <span class="co">//å°†çº¿æ€§è¿ç®—çš„ç»“æœè¿›è¡Œ gammaçŸ«æ­£</span></span><span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                color<span class="op">.</span>rgb <span class="op">=</span> LinearToGammaSpace<span class="op">(</span>color<span class="op">.</span>rgb<span class="op">);</span></span><span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                <span class="co">// ...</span></span><span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> color<span class="op">;</span></span><span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        ENDCG</span><span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/wang-luo-dai-li-he-ji/1.wang-luo-dai-li-he-ji/"/>
      <url>/2022/08/10/wang-luo-dai-li-he-ji/1.wang-luo-dai-li-he-ji/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li>nodejs æ’ä»¶ä¸‹è½½è¿‡æ…¢<code>bash         npm config set registry https://registry.npm.taobao.org # è®¾ç½®taobaoé•œåƒåœ°å€         npm config get registry #æŸ¥çœ‹å·²ç»è®¾ç½®çš„é•œåƒåœ°å€</code></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/wang-luo/1.http-ji-chu/"/>
      <url>/2022/08/10/wang-luo/1.http-ji-chu/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><a href="https://www.cnblogs.com/testyao/p/6548261.html">å“åº”çŠ¶æ€</a></li><li><a href="http://www.skywind.me/blog/topics/network">ä¼ è¾“ä¼˜åŒ–</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/wang-luo/0.wireshark/"/>
      <url>/2022/08/10/wang-luo/0.wireshark/</url>
      
        <content type="html"><![CDATA[<h2 id="wireshark">Wireshark</h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/xuan-ran/0.xian-dai-ji-suan-ji-tu-xing-xue-ru-men-yan-ling-qi/"/>
      <url>/2022/08/10/xuan-ran/0.xian-dai-ji-suan-ji-tu-xing-xue-ru-men-yan-ling-qi/</url>
      
        <content type="html"><![CDATA[<h1 id="çº¿æ€§ä»£æ•°">çº¿æ€§ä»£æ•°</h1><p>å›¾å½¢å­¦é»˜è®¤å‘é‡ä¸º åˆ—å‘é‡ <span class="math display">\[A =\begin{bmatrix}x\\y\\z\end{bmatrix}, \]</span> ä¹Ÿå¯ä»¥è½¬æ¢ä¸ºè¡Œå‘é‡ <span class="math display">\[ A^T = \begin{bmatrix}x &amp;y&amp;z\end{bmatrix}, \]</span></p><h2 id="ç‚¹ä¹˜æ³•dot">ç‚¹ä¹˜æ³•dot</h2><p>å‘é‡ç‚¹æˆ dotï¼Œ <span class="math display">\[ a . b  = |a||b|\cos\theta \]</span> , å‡ ä½•æ„ä¹‰æŠ•å½±ã€‚ å‘é‡ç‚¹ä¹˜ï¼Œ <span class="math display">\[ a . b  =\begin{bmatrix}a_x\\a_y\\a_z\end{bmatrix}\begin{bmatrix}b_x\\b_y\\b_z\end{bmatrix}= a_x* b_x + a_y* b_y + a_z* b_z\]</span></p>çŸ©é˜µå‘é‡ç‚¹ä¹˜ï¼Œ $ a . b =<span class="math display">\[\begin{bmatrix}a_x &amp; a_y &amp;a_z\end{bmatrix}\begin{bmatrix} b_x \\ b_y \\ b_z \end{bmatrix}\]</span><p>= a_x* b_x + a_y* b_y + a_z* b_z $$</p><h2 id="å‰ä¹˜-cross">å‰ä¹˜ cross</h2><p>(MxN)(NxP) = MxP, Eij = RowAi Cross ColumnBj.</p><p>axb = - bxa., <strong>å‰ææ˜¯ açš„åˆ—ç­‰äºbçš„è¡Œ</strong> å¤§å°ï¼š <span class="math display">\[|axb| = |a||b|\sin\theta\]</span> æ–¹å‘ï¼šå³æ‰‹èºæ—‹å®šåˆ™ æ‹‡æŒ‡æ–¹å‘ã€‚ <strong>æ»¡è¶³ç»“åˆå¾‹å’Œäº¤æ¢å¾‹</strong></p><h3 id="å‰ä¹˜åº”ç”¨">å‰ä¹˜åº”ç”¨</h3><ol type="1"><li>åˆ¤å®šbå‘é‡åœ¨aå‘é‡å·¦å³ï¼Œ** aå‰ä¹˜b çœ‹z å¦‚æœå¤§äº0 åˆ™åœ¨å·¦ **</li><li>åˆ¤å®šp åœ¨ä¸‰è§’å½¢å†…ï¼Œ</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/she-ji-mo-shi/1.she-ji-mo-shi/"/>
      <url>/2022/08/10/she-ji-mo-shi/1.she-ji-mo-shi/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><a href="https://gpp.tkchu.me/architecture-performance-and-games.html">è®¾è®¡æ¨¡å¼æ•™ç¨‹</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/ruan-jian-yi-ji-po-jie/2.ruan-jian-shi-yong-wen-ti-jie-jue/"/>
      <url>/2022/08/10/ruan-jian-yi-ji-po-jie/2.ruan-jian-shi-yong-wen-ti-jie-jue/</url>
      
        <content type="html"><![CDATA[<h2 id="è½¯ä»¶ä½¿ç”¨é—®é¢˜è§£å†³">è½¯ä»¶ä½¿ç”¨é—®é¢˜è§£å†³</h2><ol type="1"><li><p>SVN</p><ol type="1"><li><p>Svn æ›´æ–°å‘½ä»¤å†²çªæ—¶ä½¿ç”¨theirs</p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">svn</span> cleanup</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">svn</span> revert <span class="at">-R</span> <span class="at">-q</span> ./</span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">svn</span> up <span class="at">--force</span> <span class="at">--accept</span> tc</span></code></pre></div></li></ol></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/ruan-jian-yi-ji-po-jie/1.ruan-jian-yi-ji-po-jie/"/>
      <url>/2022/08/10/ruan-jian-yi-ji-po-jie/1.ruan-jian-yi-ji-po-jie/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><a href="https://www.52pojie.cn/forum.php?mod=viewthread&amp;tid=796683&amp;page=1">StarUML</a></li><li>sublime text3 æ¿€æ´»ç <code>c         ----- BEGIN LICENSE -----         Member J2TeaM         Single User License         EA7E-1011316         D7DA350E 1B8B0760 972F8B60 F3E64036         B9B4E234 F356F38F 0AD1E3B7 0E9C5FAD         FA0A2ABE 25F65BD8 D51458E5 3923CE80         87428428 79079A01 AA69F319 A1AF29A4         A684C2DC 0B1583D4 19CBD290 217618CD         5653E0A0 BACE3948 BB2EE45E 422D2C87         DD9AF44B 99C49590 D2DBDEE1 75860FD2         8C8BB2AD B2ECE5A4 EFC08AF2 25A9B864         ------ END LICENSE ------â€‹</code></li><li><a href="https://www.ainiseo.com/question/8170.html">VMwareWorkstation Pro15</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/ji-suan-ji-ji-chu/2.nei-cun-zhi-shi/"/>
      <url>/2022/08/10/ji-suan-ji-ji-chu/2.nei-cun-zhi-shi/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><a href="https://blog.csdn.net/qq_36894974/article/details/102779264">å†…å­˜çŸ¥è¯†</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/ji-suan-ji-ji-chu/1.cpu-huan-cun/"/>
      <url>/2022/08/10/ji-suan-ji-ji-chu/1.cpu-huan-cun/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><a href="http://cenalulu.github.io/linux/all-about-cpu-cache/">cpucache</a></li><li><a href="https://zhuanlan.zhihu.com/p/31859105">cpu cache</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/hui-bian/2.vs-fan-hui-bian-gong-ju/"/>
      <url>/2022/08/10/hui-bian/2.vs-fan-hui-bian-gong-ju/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><a href="https://docs.microsoft.com/zh-cn/dotnet/framework/tools/ildasm-exe-il-disassembler">ildasm</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/hui-bian/1.il-zhi-ling-xiang-jie/"/>
      <url>/2022/08/10/hui-bian/1.il-zhi-ling-xiang-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="ilæŒ‡ä»¤">ILæŒ‡ä»¤</h2><ol type="1"><li><a href="https://www.cnblogs.com/zery/p/3368460.html">ILæŒ‡ä»¤</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/gou-jian-xi-tong/2.doxygen-wen-dang/"/>
      <url>/2022/08/10/gou-jian-xi-tong/2.doxygen-wen-dang/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><a href="http://ftp.kaist.ac.kr/doxygen/">doxygenæ–‡æ¡£</a></li><li><a href="https://www.cnblogs.com/silencehuan/p/11169084.html">doxygenæ³¨é‡Š</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/gou-jian-xi-tong/1.gradle/"/>
      <url>/2022/08/10/gou-jian-xi-tong/1.gradle/</url>
      
        <content type="html"><![CDATA[<h2 id="gradleæ„å»º">Gradleæ„å»º</h2><ol type="1"><li><a href="https://guides.gradle.org">Gradleå®˜ç½‘</a></li><li><a href="https://services.gradle.org/distributions/">Gradleä¸‹è½½</a></li><li><a href="https://blog.csdn.net/u010349644/article/details/84715076">mavenä»“åº“</a></li><li><a href="https://groovy-lang.org/index.html">Groovy</a>ã€<a href="https://docs.gradle.org/current/dsl/">DSL</a></li><li><a href="https://www.2cto.com/kf/201712/702944.html">å¤šæ¸ é“æ„å»ºé…ç½®</a></li><li><a href="https://blog.csdn.net/chouhuan1877/article/details/100808667">Gradleç¼–è¯‘</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/du-shu-bi-ji/shi-shi-xuan-ran-di-si-ban/5.shadingbasics/"/>
      <url>/2022/08/10/du-shu-bi-ji/shi-shi-xuan-ran-di-si-ban/5.shadingbasics/</url>
      
        <content type="html"><![CDATA[<h1 id="å®æ—¶æ¸²æŸ“ç¬¬å››ç‰ˆ">å®æ—¶æ¸²æŸ“ç¬¬å››ç‰ˆ</h1><p>@(ç¿»è¯‘&amp;ç¬”è®°)[Real-time Rendering|å®æ—¶æ¸²æŸ“|å›¾å½¢]</p><hr><p>[TOC]</p><h2 id="å‰è¨€">å‰è¨€</h2><p>â€ƒæ¸²æŸ“ä¸‰ç»´å¯¹è±¡çš„å›¾åƒæ—¶ï¼Œæ¨¡å‹ä¸ä»…ä»…åº”å…·æœ‰é€‚å½“çš„å‡ ä½•å½¢çŠ¶ï¼Œè¿˜å…·æœ‰æ‰€éœ€çš„è§†è§‰å¤–è§‚ã€‚æ ¹æ®åº”ç”¨çš„ä¸åŒï¼Œè¿™å¯ä»¥ä»å›¾ç‰‡å†™å®ä¸»ä¹‰åˆ°å¤„äºåˆ›é€ æ€§çš„åŸå› è€Œé€‰æ‹©çš„å„ç§ç±»å‹çš„é£æ ¼åŒ–å¤–è§‚ã€‚</p><h2 id="ç€è‰²æ¨¡å‹">5.1 ç€è‰²æ¨¡å‹</h2><p>â€ƒç¡®å®šæ¸²æŸ“å¯¹è±¡å¤–è§‚çš„ç¬¬ä¸€æ­¥æ˜¯é€‰æ‹©ç€è‰²æ¨¡å‹ï¼Œä»¥æè¿°å¯¹è±¡çš„é¢œè‰²åº”å¦‚ä½•æ ¹æ®æ›²é¢æ–¹å‘ï¼Œè§†å›¾æ–¹å‘å’Œç…§æ˜æ–¹å‘ç­‰å› ç´ è€Œå˜åŒ–ã€‚â€ƒä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨'Gooch shading model'ã€‚è¿™æ˜¯éçœŸå®æ¸²æŸ“çš„ä¸€ç§å½¢å¼ã€‚â€ƒå¤å¼ç€è‰²æ¨¡å‹çš„åŸºæœ¬æ€æƒ³æ˜¯å°†æ›²é¢å‘ç°ä¸ç¯å…‰çš„ä½ç½®è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå‘ç°æŒ‡å‘ç¯å…‰ï¼Œåˆ™ä½¿ç”¨è¾ƒæš–çš„è‰²è°ƒä¸ºæ›²é¢ç€è‰²ã€‚<span class="math display">\[     C_{shaded} = s ( C_{highlight}) + (1 - s)(t C_{warm} + (1- t)C_{cool})    \]</span></p><p>â€ƒç€è‰²æ¨¡å‹é€šå¸¸å…·æœ‰ç”¨äºæ§åˆ¶å¤–è§‚å˜åŒ–çš„å±æ€§ã€‚è®¾ç½®è¿™äº›å±æ€§çš„å€¼æ˜¯ç¡®å®šå¯¹è±¡å¤–è§‚çš„ä¸‹ä¸€æ­¥ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/du-shu-bi-ji/2.tu-jie-http/"/>
      <url>/2022/08/10/du-shu-bi-ji/2.tu-jie-http/</url>
      
        <content type="html"><![CDATA[<h1 id="å›¾è§£http">å›¾è§£Http</h1><h1 id="webä»¥åŠç½‘ç»œåŸºç¡€">Webä»¥åŠç½‘ç»œåŸºç¡€</h1><h2 id="ç½‘ç»œåŸºç¡€tcp">ç½‘ç»œåŸºç¡€Tcp</h2><ul><li>é€šå¸¸ äº’è”ç½‘ç›¸å…³è”çš„åè®®é›†åˆèµ·æ¥æ€»ç§°ä¸º TCP/IPã€‚ä¹Ÿæœ‰è¯´æ³•è®¤ä¸ºï¼ŒTCP/IPæ˜¯æŒ‡ TCP å’Œ IP è¿™ä¸¤ç§åè®®ã€‚è¿˜æœ‰ä¸€ç§è¯´æ³•è®¤ä¸ºï¼ŒTCP/IP æ˜¯åœ¨ IPåè®®çš„é€šä¿¡è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨åˆ°çš„åè®®æ—çš„ç»Ÿç§°ã€‚</li></ul><h3 id="tcpip-åˆ†å±‚ç®¡ç†">tcp/ip åˆ†å±‚ç®¡ç†</h3><p>TCP/IP åè®®æ—æŒ‰å±‚æ¬¡åˆ†åˆ«åˆ†ä¸ºä»¥ä¸‹ 4å±‚ï¼šåº”ç”¨å±‚ã€ä¼ è¾“å±‚ã€ç½‘ç»œå±‚å’Œæ•°æ®é“¾è·¯å±‚ã€‚</p><ul><li><p>åº”ç”¨å±‚ï¼Œåº”ç”¨å±‚å†³å®šäº†å‘ç”¨æˆ·æä¾›åº”ç”¨æœåŠ¡æ—¶é€šä¿¡çš„æ´»åŠ¨ã€‚ TCP/IPåè®®æ—å†…é¢„å­˜äº†å„ç±»é€šç”¨çš„åº”ç”¨æœåŠ¡ã€‚æ¯”å¦‚ï¼ŒFTPï¼ˆFileTransferProtocolï¼Œæ–‡ä»¶ä¼ è¾“åè®®ï¼‰å’Œ DNSï¼ˆDomain NameSystemï¼ŒåŸŸåç³»ç»Ÿï¼‰æœåŠ¡å°±æ˜¯å…¶ä¸­ä¸¤ç±»ã€‚HTTP åè®®ä¹Ÿå¤„äºè¯¥å±‚ã€‚</p></li><li><p>ä¼ è¾“å±‚ï¼Œä¼ è¾“å±‚å¯¹ä¸Šå±‚åº”ç”¨å±‚ï¼Œæä¾›å¤„äºç½‘ç»œè¿æ¥ä¸­çš„ä¸¤å°è®¡ç®—æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚åœ¨ä¼ è¾“å±‚æœ‰ä¸¤ä¸ªæ€§è´¨ä¸åŒçš„åè®®ï¼šTCPï¼ˆTransmission ControlProtocolï¼Œä¼ è¾“æ§åˆ¶åè®®ï¼‰å’Œ UDPï¼ˆUser DataProtocolï¼Œç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼‰ã€‚</p></li><li><p>ç½‘ç»œå±‚ï¼ˆåˆåç½‘ç»œäº’è¿å±‚ï¼‰ï¼Œç½‘ç»œå±‚ç”¨æ¥å¤„ç†åœ¨ç½‘ç»œä¸ŠæµåŠ¨çš„æ•°æ®åŒ…ã€‚æ•°æ®åŒ…æ˜¯ç½‘ç»œä¼ è¾“çš„æœ€å°æ•°æ®å•ä½ã€‚è¯¥å±‚è§„å®šäº†é€šè¿‡æ€æ ·çš„è·¯å¾„ï¼ˆæ‰€è°“çš„ä¼ è¾“è·¯çº¿ï¼‰åˆ°è¾¾å¯¹æ–¹è®¡ç®—æœºï¼Œå¹¶æŠŠæ•°æ®åŒ…ä¼ é€ç»™å¯¹æ–¹ã€‚ä¸å¯¹æ–¹è®¡ç®—æœºä¹‹é—´é€šè¿‡å¤šå°è®¡ç®—æœºæˆ–ç½‘ç»œè®¾å¤‡è¿›è¡Œä¼ è¾“æ—¶ï¼Œç½‘ç»œå±‚æ‰€èµ·çš„ä½œç”¨å°±æ˜¯åœ¨ä¼—å¤šçš„é€‰é¡¹å†…é€‰æ‹©ä¸€æ¡ä¼ è¾“è·¯çº¿ã€‚</p></li><li><p>æ•°æ®é“¾è·¯å±‚ï¼ˆåˆåæ•°æ®é“¾è·¯å±‚ï¼Œç½‘ç»œæ¥å£å±‚ï¼‰ï¼Œç”¨æ¥å¤„ç†è¿æ¥ç½‘ç»œçš„ç¡¬ä»¶éƒ¨åˆ†ã€‚åŒ…æ‹¬æ§åˆ¶æ“ä½œç³»ç»Ÿã€ç¡¬ä»¶çš„è®¾å¤‡é©±åŠ¨ã€NICï¼ˆNetworkInterfaceCardï¼Œç½‘ç»œé€‚é…å™¨ï¼Œå³ç½‘å¡ï¼‰ï¼ŒåŠå…‰çº¤ç­‰ç‰©ç†å¯è§éƒ¨åˆ†ï¼ˆè¿˜åŒ…æ‹¬è¿æ¥å™¨ç­‰ä¸€åˆ‡ä¼ è¾“åª’ä»‹ï¼‰ã€‚ç¡¬ä»¶ä¸Šçš„èŒƒç•´å‡åœ¨é“¾è·¯å±‚çš„ä½œç”¨èŒƒå›´ä¹‹å†…ã€‚</p></li></ul><h3 id="tcpip-é€šä¿¡ä¼ è¾“æµ">Tcp/ip é€šä¿¡ä¼ è¾“æµ</h3><p><img src="/imgs/é€šä¿¡æ¨¡å‹.png"> <img src="/imgs/é€šä¿¡æ¨¡å‹2.png"></p><h3 id="ä¸http-ç›¸å…³çš„-iptcpdns">ä¸Http ç›¸å…³çš„ IPã€TCPã€DNS</h3><h4 id="ip">ip</h4><ul><li><p>TCP/IP åè®®æ—ä¸­çš„ IPæŒ‡çš„å°±æ˜¯ç½‘é™…åè®®ï¼Œåè®®åç§°ä¸­å æ®äº†ä¸€åŠä½ç½®ï¼Œå…¶é‡è¦æ€§å¯è§ä¸€æ–‘ã€‚å¯èƒ½æœ‰äººä¼šæŠŠâ€œIPâ€å’Œâ€œIPåœ°å€â€ææ··ï¼Œâ€œIPâ€å…¶å®æ˜¯ä¸€ç§åè®®çš„åç§°ã€‚</p></li><li><p>IPåè®®çš„ä½œç”¨æ˜¯æŠŠå„ç§æ•°æ®åŒ…ä¼ é€ç»™å¯¹æ–¹ã€‚è€Œè¦ä¿è¯ç¡®å®ä¼ é€åˆ°å¯¹æ–¹é‚£é‡Œï¼Œåˆ™éœ€è¦æ»¡è¶³å„ç±»æ¡ä»¶ã€‚å…¶ä¸­ä¸¤ä¸ªé‡è¦çš„æ¡ä»¶æ˜¯IP åœ°å€å’Œ MACåœ°å€ï¼ˆMedia Access Control Addressï¼‰ã€‚ IPåœ°å€æŒ‡æ˜äº†èŠ‚ç‚¹è¢«åˆ†é…åˆ°çš„åœ°å€ï¼ŒMAC åœ°å€æ˜¯æŒ‡ç½‘å¡æ‰€å±çš„å›ºå®šåœ°å€ã€‚IPåœ°å€å¯ä»¥å’Œ MAC åœ°å€è¿›è¡Œé…å¯¹ã€‚IP åœ°å€å¯å˜æ¢ï¼Œä½†MACåœ°å€åŸºæœ¬ä¸Šä¸ä¼šæ›´æ”¹ã€‚</p></li></ul><p><img src="/imgs/tpè·¯ç”±.png"></p><h3 id="ç¡®ä¿å¯é æ€§çš„-tcp-åè®®">ç¡®ä¿å¯é æ€§çš„ TCP åè®®</h3><p>æ‰€è°“çš„å­—èŠ‚æµæœåŠ¡ï¼ˆByte StreamServiceï¼‰æ˜¯æŒ‡ï¼Œä¸ºäº†æ–¹ä¾¿ä¼ è¾“ï¼Œå°†å¤§å—æ•°æ®åˆ†å‰²æˆä»¥æŠ¥æ–‡æ®µï¼ˆsegmentï¼‰ä¸ºå•ä½çš„æ•°æ®åŒ…è¿›è¡Œç®¡ç†ã€‚è€Œå¯é çš„ä¼ è¾“æœåŠ¡æ˜¯æŒ‡ï¼Œèƒ½å¤ŸæŠŠæ•°æ®å‡†ç¡®å¯é åœ°ä¼ ç»™å¯¹æ–¹ã€‚ä¸€è¨€ä»¥è”½ä¹‹ï¼ŒTCPåè®®ä¸ºäº†æ›´å®¹æ˜“ä¼ é€å¤§æ•°æ®æ‰æŠŠæ•°æ®åˆ†å‰²ï¼Œè€Œä¸” TCPåè®®èƒ½å¤Ÿç¡®è®¤æ•°æ®æœ€ç»ˆæ˜¯å¦é€è¾¾åˆ°å¯¹æ–¹ã€‚</p><p>ä¸ºäº†å‡†ç¡®æ— è¯¯åœ°å°†æ•°æ®é€è¾¾ç›®æ ‡å¤„ï¼ŒTCP åè®®é‡‡ç”¨äº†ä¸‰æ¬¡æ¡æ‰‹ï¼ˆthree-wayhandshakingï¼‰ç­–ç•¥ã€‚</p><p><img src="/imgs/Tcpä¸‰æ¬¡æ¡æ‰‹.png"></p><h4 id="è´Ÿè´£åŸŸåè§£æçš„dnsæœåŠ¡">è´Ÿè´£åŸŸåè§£æçš„DNSæœåŠ¡</h4><p>DNSï¼ˆDomain Name Systemï¼‰æœåŠ¡æ˜¯å’Œ HTTPåè®®ä¸€æ ·ä½äºåº”ç”¨å±‚çš„åè®®ã€‚å®ƒæä¾›åŸŸååˆ° IPåœ°å€ä¹‹é—´çš„è§£ææœåŠ¡ã€‚è®¡ç®—æœºæ—¢å¯ä»¥è¢«èµ‹äºˆ IPåœ°å€ï¼Œä¹Ÿå¯ä»¥è¢«èµ‹äºˆä¸»æœºåå’ŒåŸŸåã€‚</p><p>ä½†è¦è®©è®¡ç®—æœºå»ç†è§£åç§°ï¼Œç›¸å¯¹è€Œè¨€å°±å˜å¾—å›°éš¾äº†ã€‚å› ä¸ºè®¡ç®—æœºæ›´æ“…é•¿å¤„ç†ä¸€é•¿ä¸²æ•°å­—ã€‚ä¸ºäº†è§£å†³ä¸Šè¿°çš„é—®é¢˜ï¼ŒDNSæœåŠ¡åº”è¿è€Œç”Ÿã€‚</p><p><img src="/imgs/DNSåº”ç”¨.png"></p><h4 id="å°ç»“">å°ç»“</h4><p><img src="/imgs/å„ç§åè®®.png"></p><h3 id="uri-å’Œ-url">URI å’Œ URL</h3><p>ä¸ URIï¼ˆç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼‰ç›¸æ¯”ï¼Œæˆ‘ä»¬æ›´ç†Ÿæ‚‰ URLï¼ˆUniform ResourceLocatorï¼Œç»Ÿä¸€èµ„æºå®šä½ç¬¦ï¼‰ã€‚ URI ç”¨å­—ç¬¦ä¸²æ ‡è¯†æŸä¸€äº’è”ç½‘èµ„æºï¼Œè€ŒURLè¡¨ç¤ºèµ„æºçš„åœ°ç‚¹ï¼ˆäº’è”ç½‘ä¸Šæ‰€å¤„çš„ä½ç½®ï¼‰ã€‚ URLæ˜¯ URI çš„å­é›†ã€‚</p><p><img src="/imgs/URLæ ¼å¼.png"></p><ul><li><p>æ–¹æ¡ˆåï¼š ä½¿ç”¨ http: æˆ– https:ç­‰åè®®æ–¹æ¡ˆåè·å–è®¿é—®èµ„æºæ—¶è¦æŒ‡å®šåè®®ç±»å‹ã€‚ä¸åŒºåˆ†å­—æ¯å¤§å°å†™ï¼Œæœ€åé™„ä¸€ä¸ªå†’å·ï¼ˆ:ï¼‰ã€‚ä¹Ÿå¯ä½¿ç”¨data: æˆ– javascript: è¿™ç±»æŒ‡å®šæ•°æ®æˆ–è„šæœ¬ç¨‹åºçš„æ–¹æ¡ˆåã€‚</p></li><li><p>ç™»å½•ä¿¡æ¯ï¼ˆè®¤è¯ï¼‰æŒ‡å®šç”¨æˆ·åå’Œå¯†ç ä½œä¸ºä»æœåŠ¡å™¨ç«¯è·å–èµ„æºæ—¶å¿…è¦çš„ç™»å½•ä¿¡æ¯ï¼ˆèº«ä»½è®¤è¯ï¼‰ã€‚æ­¤é¡¹æ˜¯å¯é€‰é¡¹ã€‚</p></li><li><p>æœåŠ¡å™¨åœ°å€ ä½¿ç”¨ç»å¯¹ URIå¿…é¡»æŒ‡å®šå¾…è®¿é—®çš„æœåŠ¡å™¨åœ°å€ã€‚åœ°å€å¯ä»¥æ˜¯ç±»ä¼¼hackr.jp è¿™ç§ DNSå¯è§£æçš„åç§°ï¼Œæˆ–æ˜¯ 192.168.1.1 è¿™ç±» IPv4 åœ°å€åï¼Œè¿˜å¯ä»¥æ˜¯[0:0:0:0:0:0:0:1] è¿™æ ·ç”¨æ–¹æ‹¬å·æ‹¬èµ·æ¥çš„ IPv6 åœ°å€åã€‚</p></li><li><p>æœåŠ¡å™¨ç«¯å£å·æŒ‡å®šæœåŠ¡å™¨è¿æ¥çš„ç½‘ç»œç«¯å£å·ã€‚æ­¤é¡¹ä¹Ÿæ˜¯å¯é€‰é¡¹ï¼Œè‹¥ç”¨æˆ·çœç•¥åˆ™è‡ªåŠ¨ä½¿ç”¨é»˜è®¤ç«¯å£å·ã€‚</p></li><li><p>å¸¦å±‚æ¬¡çš„æ–‡ä»¶è·¯å¾„</p></li><li><p>æŸ¥è¯¢å­—ç¬¦ä¸²é’ˆå¯¹å·²æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„å†…çš„èµ„æºï¼Œå¯ä»¥ä½¿ç”¨æŸ¥è¯¢å­—ç¬¦ä¸²ä¼ å…¥ä»»æ„å‚æ•°ã€‚æ­¤é¡¹å¯é€‰ã€‚</p></li><li><p>ç‰‡æ®µæ ‡è¯†ç¬¦ä½¿ç”¨ç‰‡æ®µæ ‡è¯†ç¬¦é€šå¸¸å¯æ ‡è®°å‡ºå·²è·å–èµ„æºä¸­çš„å­èµ„æºï¼ˆæ–‡æ¡£å†…çš„æŸä¸ªä½ç½®ï¼‰ã€‚ä½†åœ¨RFC ä¸­å¹¶æ²¡æœ‰æ˜ç¡®è§„å®šå…¶ä½¿ç”¨æ–¹æ³•ã€‚è¯¥é¡¹ä¹Ÿä¸ºå¯é€‰é¡¹ã€‚</p></li></ul><h2 id="http-åè®®">Http åè®®</h2><p>è¯·æ±‚æŠ¥æ–‡ï¼šæ˜¯ç”±è¯·æ±‚æ–¹æ³•ã€è¯·æ±‚URIã€åè®®ç‰ˆæœ¬ã€å¯é€‰çš„è¯·æ±‚é¦–éƒ¨å­—æ®µå’Œå†…å®¹å®ä½“æ„æˆçš„ã€‚</p><p><img src="/imgs/HttpGet.png"></p><p>å“åº”æŠ¥æ–‡ï¼šåŸºæœ¬ä¸Šç”±åè®®ç‰ˆæœ¬ã€çŠ¶æ€ç ï¼ˆè¡¨ç¤ºè¯·æ±‚æˆåŠŸæˆ–å¤±è´¥çš„æ•°å­—ä»£ç ï¼‰ã€ç”¨ä»¥è§£é‡ŠçŠ¶æ€ç çš„åŸå› çŸ­è¯­ã€å¯é€‰çš„å“åº”é¦–éƒ¨å­—æ®µä»¥åŠå®ä½“ä¸»ä½“æ„æˆã€‚</p><p><img src="/imgs/HttpResp.png"></p><p>HTTP æ˜¯ä¸€ç§ä¸ä¿å­˜çŠ¶æ€ï¼Œå³æ— çŠ¶æ€ï¼ˆstatelessï¼‰åè®®ã€‚HTTPåè®®è‡ªèº«ä¸å¯¹è¯·æ±‚å’Œå“åº”ä¹‹é—´çš„é€šä¿¡çŠ¶æ€è¿›è¡Œä¿å­˜ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨ HTTPè¿™ä¸ªçº§åˆ«ï¼Œåè®®å¯¹äºå‘é€è¿‡çš„è¯·æ±‚æˆ–å“åº”éƒ½ä¸åšæŒä¹…åŒ–å¤„ç†ã€‚ HTTP/1.1è™½ç„¶æ˜¯æ— çŠ¶æ€åè®®ï¼Œä½†ä¸ºäº†å®ç°æœŸæœ›çš„ä¿æŒçŠ¶æ€åŠŸèƒ½ï¼Œäºæ˜¯å¼•å…¥äº† CookieæŠ€æœ¯ã€‚æœ‰äº† Cookie å†ç”¨ HTTP åè®®é€šä¿¡ï¼Œå°±å¯ä»¥ç®¡ç†çŠ¶æ€äº†ã€‚</p><p><img src="/imgs/Httpæ”¯æŒçš„æ–¹æ³•.png"></p><p>HTTP åè®®çš„åˆå§‹ç‰ˆæœ¬ä¸­ï¼Œæ¯è¿›è¡Œä¸€æ¬¡ HTTP é€šä¿¡å°±è¦æ–­å¼€ä¸€æ¬¡ TCPè¿æ¥ã€‚ä¸ºè§£å†³ä¸Šè¿° TCP è¿æ¥çš„é—®é¢˜ï¼ŒHTTP/1.1 å’Œä¸€éƒ¨åˆ†çš„ HTTP/1.0æƒ³å‡ºäº†æŒä¹…è¿æ¥ï¼ˆHTTP Persistent Connectionsï¼Œä¹Ÿç§°ä¸º HTTP keep-aliveæˆ–HTTP connectionreuseï¼‰çš„æ–¹æ³•ã€‚æŒä¹…è¿æ¥çš„ç‰¹ç‚¹æ˜¯ï¼Œåªè¦ä»»æ„ä¸€ç«¯æ²¡æœ‰æ˜ç¡®æå‡ºæ–­å¼€è¿æ¥ï¼Œåˆ™ä¿æŒTCP è¿æ¥çŠ¶æ€ã€‚</p><h2 id="å“åº”çŠ¶æ€ç ">å“åº”çŠ¶æ€ç </h2><p><img src="/imgs/å“åº”çŠ¶æ€ç .png"></p><h3 id="xx-æˆåŠŸ">2xx æˆåŠŸ</h3><ul><li><p>200 ok è¡¨ç¤ºä»å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚åœ¨æœåŠ¡å™¨ç«¯è¢«æ­£å¸¸å¤„ç†äº†ã€‚</p></li><li><p>204 è¯·æ±‚æˆåŠŸ,ä½†æ²¡æœ‰èµ„æºè¿”å›ä¸€èˆ¬åœ¨åªéœ€è¦ä»å®¢æˆ·ç«¯å¾€æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œè€Œå¯¹å®¢æˆ·ç«¯ä¸éœ€è¦å‘é€æ–°ä¿¡æ¯å†…å®¹çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚</p></li><li><p>206 è¯¥çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯è¿›è¡Œäº†èŒƒå›´è¯·æ±‚ï¼Œè€ŒæœåŠ¡å™¨æˆåŠŸæ‰§è¡Œäº†è¿™éƒ¨åˆ†çš„GET è¯·æ±‚ã€‚</p></li></ul><h3 id="xx-é‡å®šå‘">3xx é‡å®šå‘</h3><ul><li><p>301 æ°¸ä¹…æ€§é‡å®šå‘ã€‚è¯¥çŠ¶æ€ç è¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²è¢«åˆ†é…äº†æ–°çš„URIï¼Œä»¥ååº”ä½¿ç”¨èµ„æºç°åœ¨æ‰€æŒ‡çš„ URIã€‚</p></li><li><p>302 ä¸´æ—¶æ€§é‡å®šå‘ã€‚è¯¥çŠ¶æ€ç è¡¨ç¤ºè¯·æ±‚çš„èµ„æºå·²è¢«åˆ†é…äº†æ–°çš„URIï¼Œå¸Œæœ›ç”¨æˆ·ï¼ˆæœ¬æ¬¡ï¼‰èƒ½ä½¿ç”¨æ–°çš„ URI è®¿é—®ã€‚</p></li><li><p>303 è¯¥çŠ¶æ€ç è¡¨ç¤ºç”±äºè¯·æ±‚å¯¹åº”çš„èµ„æºå­˜åœ¨ç€å¦ä¸€ä¸ª URIï¼Œåº”ä½¿ç”¨GETæ–¹æ³•å®šå‘è·å–è¯·æ±‚çš„èµ„æºã€‚</p></li></ul><p><strong>å½“ 301ã€302ã€303 å“åº”çŠ¶æ€ç è¿”å›æ—¶ï¼Œå‡ ä¹æ‰€æœ‰çš„æµè§ˆå™¨éƒ½ä¼šæŠŠPOSTæ”¹æˆ GETï¼Œå¹¶åˆ é™¤è¯·æ±‚æŠ¥æ–‡å†…çš„ä¸»ä½“ï¼Œä¹‹åè¯·æ±‚ä¼šè‡ªåŠ¨å†æ¬¡å‘é€ã€‚301ã€302æ ‡å‡†æ˜¯ç¦æ­¢å°† POST æ–¹æ³•æ”¹å˜æˆ GETæ–¹æ³•çš„ï¼Œä½†å®é™…ä½¿ç”¨æ—¶å¤§å®¶éƒ½ä¼šè¿™ä¹ˆåšã€‚</strong></p><ul><li><p>304 è¯¥çŠ¶æ€ç è¡¨ç¤ºå®¢æˆ·ç«¯å‘é€é™„å¸¦æ¡ä»¶çš„è¯·æ±‚ 2æ—¶ï¼ŒæœåŠ¡å™¨ç«¯å…è®¸è¯·æ±‚è®¿é—®èµ„æºï¼Œä½†æœªæ»¡è¶³æ¡ä»¶çš„æƒ…å†µã€‚</p></li><li><p>307 ä¸´æ—¶é‡å®šå‘ã€‚è¯¥çŠ¶æ€ç ä¸ 302 Found æœ‰ç€ç›¸åŒçš„å«ä¹‰ã€‚</p></li></ul><h3 id="xx-å®¢æˆ·ç«¯é”™è¯¯">4XX å®¢æˆ·ç«¯é”™è¯¯</h3><ul><li><p>400è¯¥çŠ¶æ€ç è¡¨ç¤ºè¯·æ±‚æŠ¥æ–‡ä¸­å­˜åœ¨è¯­æ³•é”™è¯¯ã€‚å½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œéœ€ä¿®æ”¹è¯·æ±‚çš„å†…å®¹åå†æ¬¡å‘é€è¯·æ±‚ã€‚å¦å¤–ï¼Œæµè§ˆå™¨ä¼šåƒ200 OK ä¸€æ ·å¯¹å¾…è¯¥çŠ¶æ€ç ã€‚</p></li><li><p>401 è¯¥çŠ¶æ€ç è¡¨ç¤ºå‘é€çš„è¯·æ±‚éœ€è¦æœ‰é€šè¿‡ HTTP è®¤è¯ï¼ˆBASICè®¤è¯ã€DIGEST è®¤è¯ï¼‰çš„è®¤è¯ä¿¡æ¯ã€‚å¦å¤–è‹¥ä¹‹å‰å·²è¿›è¡Œè¿‡ 1 æ¬¡è¯·æ±‚ï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·è®¤è¯å¤±è´¥ã€‚</p></li><li><p>403è¯¥çŠ¶æ€ç è¡¨æ˜å¯¹è¯·æ±‚èµ„æºçš„è®¿é—®è¢«æœåŠ¡å™¨æ‹’ç»äº†ã€‚æœåŠ¡å™¨ç«¯æ²¡æœ‰å¿…è¦ç»™å‡ºæ‹’ç»çš„è¯¦ç»†ç†ç”±ï¼Œä½†å¦‚æœæƒ³ä½œè¯´æ˜çš„è¯ï¼Œå¯ä»¥åœ¨å®ä½“çš„ä¸»ä½“éƒ¨åˆ†å¯¹åŸå› è¿›è¡Œæè¿°ï¼Œè¿™æ ·å°±èƒ½è®©ç”¨æˆ·çœ‹åˆ°äº†ã€‚</p></li><li><p>404è¯¥çŠ¶æ€ç è¡¨æ˜æœåŠ¡å™¨ä¸Šæ— æ³•æ‰¾åˆ°è¯·æ±‚çš„èµ„æºã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿå¯ä»¥åœ¨æœåŠ¡å™¨ç«¯æ‹’ç»è¯·æ±‚ä¸”ä¸æƒ³è¯´æ˜ç†ç”±æ—¶ä½¿ç”¨ã€‚</p></li></ul><h3 id="xx-æœåŠ¡å™¨é”™è¯¯">5XX æœåŠ¡å™¨é”™è¯¯</h3><p><strong>çŠ¶æ€ç å’ŒçŠ¶å†µçš„ä¸ä¸€è‡´ä¸å°‘è¿”å›çš„çŠ¶æ€ç å“åº”éƒ½æ˜¯é”™è¯¯çš„ï¼Œä½†æ˜¯ç”¨æˆ·å¯èƒ½å¯Ÿè§‰ä¸åˆ°è¿™ç‚¹ã€‚æ¯”å¦‚Web åº”ç”¨ç¨‹åºå†…éƒ¨å‘ç”Ÿé”™è¯¯ï¼ŒçŠ¶æ€ç ä¾ç„¶è¿”å› 200OKï¼Œè¿™ç§æƒ…å†µä¹Ÿç»å¸¸é‡åˆ°ã€‚</strong></p><ul><li><p>500 è¯¥çŠ¶æ€ç è¡¨æ˜æœåŠ¡å™¨ç«¯åœ¨æ‰§è¡Œè¯·æ±‚æ—¶å‘ç”Ÿäº†é”™è¯¯ã€‚ä¹Ÿæœ‰å¯èƒ½æ˜¯Webåº”ç”¨å­˜åœ¨çš„ bug æˆ–æŸäº›ä¸´æ—¶çš„æ•…éšœã€‚</p></li><li><p>503è¯¥çŠ¶æ€ç è¡¨æ˜æœåŠ¡å™¨æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–æ­£åœ¨è¿›è¡Œåœæœºç»´æŠ¤ï¼Œç°åœ¨æ— æ³•å¤„ç†è¯·æ±‚ã€‚å¦‚æœäº‹å…ˆå¾—çŸ¥è§£é™¤ä»¥ä¸ŠçŠ¶å†µéœ€è¦çš„æ—¶é—´ï¼Œæœ€å¥½å†™å…¥RetryAfteré¦–éƒ¨å­—æ®µå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p></li></ul><h2 id="http-é¦–éƒ¨å­—æ®µ">HTTP é¦–éƒ¨å­—æ®µ</h2><p>HTTP é¦–éƒ¨å­—æ®µæ˜¯ç”±é¦–éƒ¨å­—æ®µåå’Œå­—æ®µå€¼æ„æˆçš„ï¼Œä¸­é—´ç”¨å†’å·â€œ:â€ åˆ†éš”ã€‚</p><h3 id="ç§-http-é¦–éƒ¨å­—æ®µç±»å‹">4 ç§ HTTP é¦–éƒ¨å­—æ®µç±»å‹</h3><ul><li><p>é€šç”¨é¦–éƒ¨å­—æ®µï¼ˆGeneral Header Fieldsï¼‰è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡ä¸¤æ–¹éƒ½ä¼šä½¿ç”¨çš„é¦–éƒ¨ã€‚</p></li><li><p>è¯·æ±‚é¦–éƒ¨å­—æ®µï¼ˆRequest Header Fieldsï¼‰ä»å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘é€è¯·æ±‚æŠ¥æ–‡æ—¶ä½¿ç”¨çš„é¦–éƒ¨ã€‚è¡¥å……äº†è¯·æ±‚çš„é™„åŠ å†…å®¹ã€å®¢æˆ·ç«¯ä¿¡æ¯ã€å“åº”å†…å®¹ç›¸å…³ä¼˜å…ˆçº§ç­‰ä¿¡æ¯ã€‚</p></li><li><p>å“åº”é¦–éƒ¨å­—æ®µï¼ˆResponse Header Fieldsï¼‰ä»æœåŠ¡å™¨ç«¯å‘å®¢æˆ·ç«¯è¿”å›å“åº”æŠ¥æ–‡æ—¶ä½¿ç”¨çš„é¦–éƒ¨ã€‚è¡¥å……äº†å“åº”çš„é™„åŠ å†…å®¹ï¼Œä¹Ÿä¼šè¦æ±‚å®¢æˆ·ç«¯é™„åŠ é¢å¤–çš„å†…å®¹ä¿¡æ¯ã€‚</p></li><li><p>å®ä½“é¦–éƒ¨å­—æ®µï¼ˆEntity Header Fieldsï¼‰é’ˆå¯¹è¯·æ±‚æŠ¥æ–‡å’Œå“åº”æŠ¥æ–‡çš„å®ä½“éƒ¨åˆ†ä½¿ç”¨çš„é¦–éƒ¨ã€‚è¡¥å……äº†èµ„æºå†…å®¹æ›´æ–°æ—¶é—´ç­‰ä¸å®ä½“æœ‰å…³çš„ä¿¡æ¯ã€‚</p></li></ul><p>é€šç”¨é¦–éƒ¨å­—æ®µ <img src="/imgs/Httpé€šç”¨é¦–éƒ¨å­—æ®µ.png" alt="é€šç”¨é¦–éƒ¨å­—æ®µ"></p><p>è¯·æ±‚é¦–éƒ¨å­—æ®µ <img src="/imgs/Httpè¯·æ±‚é¦–éƒ¨å­—æ®µ.png" alt="è¯·æ±‚é¦–éƒ¨å­—æ®µ"></p><p>å“åº”é¦–éƒ¨å­—æ®µ <img src="/imgs/Httpå“åº”é¦–éƒ¨å­—æ®µ.png" alt="å“åº”é¦–éƒ¨å­—æ®µ"></p><p>å®ä½“é¦–éƒ¨å­—æ®µ <img src="/imgs/Httpå®ä½“é¦–éƒ¨å­—æ®µ.png" alt="å“åº”é¦–éƒ¨å­—æ®µ"></p><h4 id="å¸¸ç”¨é¦–éƒ¨å­—æ®µ">å¸¸ç”¨é¦–éƒ¨å­—æ®µ</h4><ol type="1"><li>é¦–éƒ¨å­—æ®µ Cache-Control èƒ½å¤Ÿæ§åˆ¶ç¼“å­˜çš„è¡Œä¸º</li></ol><pre><code>Cache-Control: private, max-age=0, no-cache</code></pre><figure><img src="/imgs/httpç¼“å­˜æ§åˆ¶.png" alt="å“åº”é¦–éƒ¨å­—æ®µ"><figcaption aria-hidden="true">å“åº”é¦–éƒ¨å­—æ®µ</figcaption></figure><ol start="2" type="1"><li>Connection é¦–éƒ¨å­—æ®µå…·å¤‡å¦‚ä¸‹ä¸¤ä¸ªä½œç”¨ã€‚<ul><li>æ§åˆ¶ä¸å†è½¬å‘ç»™ä»£ç†çš„é¦–éƒ¨å­—æ®µ</li><li>ç®¡ç†æŒä¹…è¿æ¥</li></ul></li></ol><pre><code>Connection: close// Connection: Keep-Alive</code></pre><ol start="3" type="1"><li><p>é¦–éƒ¨å­—æ®µ Date è¡¨æ˜åˆ›å»º HTTP æŠ¥æ–‡çš„æ—¥æœŸå’Œæ—¶é—´ã€‚</p></li><li><p>Transfer-Encoding é¦–éƒ¨å­—æ®µ Transfer-Encodingè§„å®šäº†ä¼ è¾“æŠ¥æ–‡ä¸»ä½“æ—¶é‡‡ç”¨çš„ç¼–ç æ–¹å¼ã€‚</p></li><li><p>Via. ä½¿ç”¨é¦–éƒ¨å­—æ®µ Viaæ˜¯ä¸ºäº†è¿½è¸ªå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„è¯·æ±‚å’Œå“åº”æŠ¥æ–‡çš„ä¼ è¾“è·¯å¾„ã€‚Viaé¦–éƒ¨æ˜¯ä¸ºäº†è¿½è¸ªä¼ è¾“è·¯å¾„ï¼Œæ‰€ä»¥ç»å¸¸ä¼šå’Œ TRACE æ–¹æ³•ä¸€èµ·ä½¿ç”¨ã€‚</p></li><li><p>Accept-Charset. Accept-Charseté¦–éƒ¨å­—æ®µå¯ç”¨æ¥é€šçŸ¥æœåŠ¡å™¨ç”¨æˆ·ä»£ç†æ”¯æŒçš„å­—ç¬¦é›†åŠå­—ç¬¦é›†çš„ç›¸å¯¹ä¼˜å…ˆé¡ºåºã€‚å¦å¤–ï¼Œå¯ä¸€æ¬¡æ€§æŒ‡å®šå¤šç§å­—ç¬¦é›†ã€‚ä¸é¦–éƒ¨å­—æ®µAccept ç›¸åŒçš„æ˜¯å¯ç”¨æƒé‡ q å€¼æ¥è¡¨ç¤ºç›¸å¯¹ä¼˜å…ˆçº§ã€‚</p></li></ol><h4 id="websocket-å’Œ-http-2.0">WebSocket å’Œ Http 2.0</h4><p>ä¸ºé…åˆæ‰©å±•çš„æ–¹æ³•ï¼ŒçŠ¶æ€ç ä¹Ÿéšä¹‹æ‰©å±•ã€‚ 102 Processingï¼šå¯æ­£å¸¸å¤„ç†è¯·æ±‚ï¼Œä½†ç›®å‰æ˜¯å¤„ç†ä¸­çŠ¶æ€ 207 Multi-Status ï¼šå­˜åœ¨å¤šç§çŠ¶æ€ 422Unprocessible Entity ï¼šæ ¼å¼æ­£ç¡®ï¼Œå†…å®¹æœ‰è¯¯ 423 Locked ï¼šèµ„æºå·²è¢«åŠ é” 424Failed Dependency ï¼šå¤„ç†ä¸æŸè¯·æ±‚å…³è”çš„è¯·æ±‚å¤±è´¥ï¼Œå› æ­¤ä¸å†ç»´ 507Insufficient Storage ï¼šä¿å­˜ç©ºé—´ä¸è¶³</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/du-shu-bi-ji/1.gpu-bian-cheng-yu-cg-yu-yan/"/>
      <url>/2022/08/10/du-shu-bi-ji/1.gpu-bian-cheng-yu-cg-yu-yan/</url>
      
        <content type="html"><![CDATA[<h2 id="gpuç¼–ç¨‹ä¸cgè¯­è¨€"># GPUç¼–ç¨‹ä¸CGè¯­è¨€</h2><p>title: 1.GPUç¼–ç¨‹ä¸CGè¯­è¨€ date: 2020-09-25 19:20:05 author: lyg cover:true mathjax: true categories: å›¾å½¢ tags: - å›¾å½¢ - Graphics ---</p><h2 id="ç»ªè®º">ç»ªè®º</h2><h3 id="gpu-vs-cpu">GPU Vs CPU</h3><p><img src="imgs/CPU_GPU"></p><ul><li>GPU å¹¶è¡Œç»“æ„ã€‚é€Ÿåº¦å¿«äºCPUã€‚ä½†æ˜¯ï¼Œæ•°æ®ä¹‹é—´æ²¡æœ‰ä¾èµ–ï¼Œæ‰€ä»¥éœ€è¦æå¼ºçš„ä¾èµ–æ€§ç®—æ³• ä»£æ›¿æ•°æ®ä¾èµ–ã€‚</li><li>CPU æ§åˆ¶å™¨æ›´å¤šã€‚æ§åˆ¶æµæ–¹é¢ GPU å¼±äºCPU</li></ul><h2 id="gpu-å›¾å½¢ç»˜åˆ¶ç®¡çº¿">GPU å›¾å½¢ç»˜åˆ¶ç®¡çº¿</h2><h3 id="è§£é‡Š1">è§£é‡Š1</h3><p>ä¸‰ä¸ªä¸»è¦é˜¶æ®µï¼š åº”ç”¨ç¨‹åºé˜¶æ®µã€å‡ ä½•é˜¶æ®µã€å…‰æ …åŒ–é˜¶æ®µã€‚</p><ul><li><p>åº”ç”¨ç¨‹åºé˜¶æ®µã€‚ ä½¿ç”¨é«˜çº§è¯­è¨€è¿›è¡Œå¼€å‘ï¼Œä¸»è¦å’Œå†…å­˜ã€CPUæ‰“äº¤é“ã€‚ä¾‹å¦‚ç¢°æ’æ£€æµ‹ï¼Œåœºæ™¯å›¾å»ºç«‹ã€ç©ºé—´å…«å‰æ ‘æ›´æ–°ã€<strong>è§†æ¤ä½“è£å‰ª</strong>ç­‰ã€‚åœ¨è¯¥é˜¶æ®µæœ«ç«¯ï¼Œå‡ ä½•ä½“æ•°æ®ï¼ˆé¡¶ç‚¹åæ ‡ã€æ³•å‘é‡ã€çº¹ç†åæ ‡ã€çº¹ç†ç­‰ï¼‰é€šè¿‡<code>æ•°æ®æ€»çº¿</code>ä¼ è¾“ç»™å›¾å½¢ç¡¬ä»¶ã€‚</p></li><li><p>å‡ ä½•é˜¶æ®µã€‚ä¸»è¦è´Ÿè´£é¡¶ç‚¹åæ ‡å˜æ¢ã€å…‰ç…§ã€è£å‰ªã€æŠ•å½±ä»¥åŠå±å¹•æ˜ å°„ï¼Œè¯¥é˜¶æ®µåŸºäº GPUè¿›è¡Œè¿ç®—ï¼Œåœ¨è¯¥é˜¶æ®µæœ«ç«¯å¾—åˆ°äº†ç»è¿‡å˜æ¢å’ŒæŠ•å½±ä¹‹åçš„é¡¶ç‚¹åæ ‡ã€é¢œè‰²ã€ä»¥åŠçº¹ç†åæ ‡ã€‚</p></li><li><p>å…‰æ …åŒ–é˜¶æ®µã€‚åŸºäºå‡ ä½•æç«¯çš„è¾“å‡ºæ•°æ®ï¼Œä¸ºåƒç´ ï¼ˆPixelï¼‰æ­£ç¡®é…è‰²ï¼Œä»¥ä¾¿äºç»˜åˆ¶å®Œæ•´å›¾åƒï¼Œè¯¥é˜¶æ®µè¿›è¡Œçš„éƒ½æ˜¯å•åƒç´ çš„æ“ä½œï¼Œæ¯ä¸ªåƒç´ çš„ä¿¡æ¯æ ‘æ‘åœ¨é¢œè‰²ç¼“å†²å™¨ï¼ˆcolorbuffer æˆ–è€… framebufferï¼‰ä¸­ã€‚</p></li></ul><p>æ‹“å±•ï¼š *æ•°æ®æ€»çº¿ï¼šå¯ä»¥å…±äº«çš„é€šé“ï¼Œç”¨äºå¤šä¸ªè®¾å¤‡ä¹‹é—´ä¼ è¾“æ•°æ®ï¼›ç«¯å£æ˜¯ä¸¤ä¸ªè®¾å¤‡ä¹‹é—´ä¼ è¾“çš„é€šé“ï¼›å¸¦å®½ç”¨æ¥æè¿°ç«¯å£æˆ–æ€»çº¿ä¸Šçš„ååé‡ï¼Œå¯ä»¥ç”¨æ¯ç§’å­—èŠ‚æ•°ï¼ˆb/sï¼‰æ¥åº¦é‡ã€‚æ•°æ®æ€»çº¿å’Œç«¯å£å°†ä¸åŒçš„åŠŸèƒ½æ¨¡å—<code>ç²˜ç²˜</code>åœ¨ä¸€èµ·ã€‚ç”±äºç«¯å£å’Œæ•°æ®æ€»çº¿å‡å…·æœ‰ä¼ è¾“èƒ½åŠ›ï¼Œå› æ­¤é€šå¸¸ä¹Ÿå°†ç«¯å£è®¤ä¸ºæ˜¯æ•°æ®æ€»çº¿ã€‚</p><ul><li><p>å…‰ç…§è®¡ç®—å±äºç»“åˆæç«¯ï¼Œå› ä¸ºå…‰ç…§è®¡ç®—æ¶‰åŠè§†ç‚¹ã€å…‰æºå’Œç‰©ä½“çš„ä¸–ç•Œåæ ‡ï¼Œæ‰€ä»¥é€šå¸¸æ”¾åœ¨<strong>ä¸–ç•Œåæ ‡ç³»</strong>ä¸­è¿›è¡Œè®¡ç®—ã€‚</p></li><li><p>é›¾åŒ–ä»¥åŠæ¶‰åŠç‰©ä½“é€æ˜åº¦çš„è®¡ç®—å±äºå…‰æ …åŒ–é˜¶æ®µ,å› ä¸ºä¸¤ç§è®¡ç®—éƒ½éœ€è¦æ·±åº¦å€¼ä¿¡æ¯ï¼ˆZå€¼ï¼‰ï¼Œè€Œæ·±åº¦å€¼æ˜¯åœ¨å‡ ä½•æç«¯è®¡ç®—å¹¶ä¼ é€’ç»™å…‰æ …æ¢é˜¶æ®µ,<strong>æå‰æ·±åº¦åˆ™å¯ä»¥æå‰å¾—çŸ¥?</strong>ã€‚</p></li></ul><h4 id="å‡ ä½•é˜¶æ®µ">å‡ ä½•é˜¶æ®µ</h4><h5 id="åæ ‡ç³»">åæ ‡ç³»</h5><p><img src="imgs/åæ ‡ç³».png"> <img src="imgs/åæ ‡ç³»0.png"></p><p>æ ¹æ®é¡¶ç‚¹åæ ‡å˜æ¢çš„å…ˆåé¡ºåºï¼Œä¸»è¦æœ‰å‡ ä¸ªåæ ‡ç©ºé—´ï¼Œæˆ–è€…è¯´åæ ‡ç±»å‹ï¼šæ¨¡å‹åæ ‡ç©ºé—´(Object space)ã€ ä¸–ç•Œåæ ‡ç©ºé—´(World space)ã€è§‚å¯Ÿåæ ‡ç©ºé—´(Eye space/ View space)ã€ å±å¹•åæ ‡ç©ºé—´/è£å‰ªåæ ‡ç©ºé—´(Clip AndProject space)ã€‚</p><p><img src="imgs/æ¸²æŸ“ç®¡çº¿.png"></p><p>æ¨¡å‹ç©ºé—´ï¼ˆObject spaceï¼‰,éœ€è¦æ˜ç™½çš„ä¸¤ä¸ªé‡è¦çš„å«ä¹‰ï¼š * object spacecoordinate æ˜¯æ¨¡å‹ç©ºé—´çš„é¡¶ç‚¹å€¼ï¼Œæ¨¡å‹æ–‡ä»¶å¯¼å‡ºçš„æ•°æ®æ˜¯ object spacecoordinateã€‚ * object space coordinateä¸å…¶ä»–ç‰©ä½“æ²¡æœ‰å‚ç…§å…³ç³»ï¼Œå› æ­¤ä¸åŒæ¨¡å‹ç½®äºåŒä¸€ä¸ªä¸–ç•Œåæ ‡ç³»æ‰ç›¸äº’ä½ç½®æœ‰å…³è”ã€‚</p><ul><li>æ¨¡å‹ç©ºé—´è½¬æ¢åˆ°ä¸–ç•Œåæ ‡ç©ºé—´<br>æ¨¡å‹ç©ºé—´è½¬æ¢åˆ°ä¸–ç•Œåæ ‡ç©ºé—´ï¼Œé€šè¿‡ <code>Model Matrix</code> å®Œæˆ ï¼Ÿ</li></ul><p>å…‰ç…§è®¡ç®—é€šå¸¸åœ¨ä¸–ç•Œåæ ‡ç³»ä¸­å®Œæˆï¼Œ ä¹Ÿå¯ä»¥åœ¨è§‚å¯Ÿç©ºé—´ä¸­å®Œæˆï¼Œå› ä¸ºåœ¨åŒä¸€è§‚å¯Ÿç©ºé—´ä¸­ç‰©ä½“ä¹‹é—´çš„ç›¸å¯¹å…³ç³»æ˜¯ä¸å˜çš„ã€‚</p><p>é¡¶ç‚¹æ³•å‘é‡åœ¨æ¨¡å‹æ–‡ä»¶ä¸­å±äº æ¨¡å‹åæ ‡ï¼Œåœ¨GPU é¡¶ç‚¹ç¨‹åºä¸­å¿…é¡»å°†æ³•å‘é‡è½¬æ¢åˆ°ä¸–ç•Œåæ ‡æ‰èƒ½ç”¨ã€‚<strong>ä¸é¡¶ç‚¹è½¬æ¢åˆ°ä¸–ç•Œåæ ‡ä¸åŒçš„ï¼Œæ³•å‘é‡çš„è½¬æ¢çŸ©é˜µæ˜¯<code>Model matrix çš„è½¬ç½®çŸ©é˜µçš„é€†çŸ©é˜µ</code></strong><a href="">æ½˜æäº®çš„ 3D å˜æ¢ä¸­æ³•å‘é‡å˜æ¢çŸ©é˜µçš„æ¨å¯¼ä¸€æ–‡</a></p><ul><li>ä¸–ç•Œåæ ‡ç©ºé—´è½¬æ¢åˆ°è§‚å¯Ÿç©ºé—´ æ‰€è°“çš„ eye space/ view space,å³ä»¥camera(è§†ç‚¹æˆ–è€…ç›¸æœº)ä¸ºåŸç‚¹ï¼Œ ç”±å®ç°æ–¹å‘ã€è§†è§’å’Œè¿œè¿‘å¹³é¢ï¼Œå…±åŒç»„æˆçš„ä¸€ä¸ªæ¢¯å½¢çš„ä¸‰ç»´ç©ºé—´ï¼Œ ç§°ä¹‹ä¸ºè§†é”¥ï¼ˆviewing frustumï¼‰ã€‚é‡‘å¹³é¢æ˜¯æ¢¯å½¢è¾ƒå°çš„çŸ©å½¢é¢ï¼Œä½œä¸ºæŠ•å½±å¹³é¢ï¼Œåœ¨è¿™ä¸ªæ¢¯å½¢ä½“é‡çš„æ‰€æœ‰é¡¶ç‚¹æ•°æ®æ˜¯å¯è§çš„ï¼Œè€Œè¶…å‡ºè¿™ä¸ªæ¢¯å½¢ä½“ä¹‹å¤–çš„åœºæ™¯æ•°æ®ï¼Œä¼šè¢«è§†ç‚¹å»é™¤ï¼ˆfrustumCulling, ä¹Ÿç§°ä¹‹ä¸ºè§†æ¤è£å‰ªï¼‰ã€‚æ‰€ç”¨çš„ç®—æ³•ç§°ä¹‹ä¸ºè£å‰ªç®—æ³•ã€‚</li></ul><p><img src="imgs/è§†æ¤ä½“.png"></p><ul><li>è§‚å¯Ÿç©ºé—´è½¬æ¢åˆ°è£å‰ªç©ºé—´(project and clip space)</li></ul><p>ä¸å°‘äººè§‰å¾—æ˜¯â€œå…ˆè£å‡å†æŠ•å½±â€ï¼Œä¸è¿‡äº‹å®å¹¶éå¦‚æ­¤ã€‚å› ä¸ºåœ¨ ä¸è§„åˆ™çš„ä½“ï¼ˆviewing frustumï¼‰ä¸­è¿›è¡Œè£å‰ªå¹¶éæ˜“äº‹ï¼Œæ‰€ä»¥ç»è¿‡å›¾å½¢å­¦å‰è¾ˆä»¬çš„ç²¾å¿ƒåˆ†æï¼Œè£å‰ªè¢«å®‰æ’åˆ°ä¸€ä¸ªå•ä½ç«‹æ–¹ä½“ä¸­è¿›è¡Œï¼Œè¯¥ç«‹æ–¹ä½“çš„å¯¹è§’é¡¶ç‚¹åˆ†åˆ«æ˜¯(-1,-1,-1)å’Œ(1,1,1)ï¼Œé€šå¸¸ç§°è¿™ä¸ªå•ä½ç«‹æ–¹ä½“ä¸ºè§„èŒƒç«‹æ–¹ä½“ï¼ˆ Canonical viewvolume, CVVï¼‰ã€‚ CVV çš„è¿‘å¹³é¢ï¼ˆæ¢¯å½¢ä½“è¾ƒå°çš„çŸ©å½¢é¢ï¼‰çš„ Xã€ Yåæ ‡å¯¹åº”å±å¹•åƒç´ åæ ‡ï¼ˆå·¦ä¸‹è§’æ˜¯ 0ã€ 0ï¼‰ï¼Œ Zåæ ‡åˆ™æ˜¯ä»£è¡¨ç”»é¢åƒç´ æ·±åº¦ã€‚</p><h4 id="å…‰æ …åŒ–é˜¶æ®µ">å…‰æ …åŒ–é˜¶æ®µ</h4><p>å…‰æ …åŒ–ï¼šå†³å®šå“ªäº›åƒç´ è¢«é›†åˆå›¾å…ƒè¦†ç›–çš„è¿‡ç¨‹ï¼ˆ Rasterization is theprocess of determining the set of pixels covered by a geometricprimitiveï¼‰ç»è¿‡ä¸Šé¢è¯¸å¤šåæ ‡ è½¬æ¢ä¹‹åï¼Œç°åœ¨æˆ‘ä»¬å¾—åˆ°äº†æ¯ä¸ªç‚¹çš„å±å¹•åæ ‡å€¼ï¼ˆScreen coordinateï¼‰ï¼Œä¹ŸçŸ¥é“æˆ‘ä»¬éœ€è¦ç»˜åˆ¶çš„å›¾å…ƒï¼ˆç‚¹ã€çº¿ã€é¢ï¼‰ã€‚ä½†æ­¤æ—¶è¿˜å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p><p>é—®é¢˜ä¸€ï¼šç‚¹çš„å±å¹•åæ ‡å€¼æ˜¯æµ®ç‚¹æ•°ï¼Œä½†åƒç´ éƒ½æ˜¯ç”±æ•´æ•°ç‚¹æ¥è¡¨ç¤ºçš„ï¼Œå¦‚æœç¡®å®šå±å¹•åæ ‡å€¼æ‰€å¯¹åº”çš„åƒç´ ï¼Ÿé—®é¢˜äºŒï¼šåœ¨å±å¹•ä¸Šéœ€è¦ç»˜åˆ¶çš„æœ‰ç‚¹ã€çº¿ã€é¢ï¼Œå¦‚ä½•æ ¹æ®ä¸¤ä¸ªå·²ç»ç¡®å®šä½ç½®çš„ 2ä¸ªåƒç´ ç‚¹ç»˜åˆ¶ä¸€æ¡çº¿æ®µï¼Œå¦‚æœæ ¹æ®å·²ç»ç¡®å®šäº†ä½ç½®çš„ 3 ä¸ªåƒç´ ç‚¹ç»˜åˆ¶ä¸€ä¸ªä¸‰è§’å½¢é¢ç‰‡ï¼Ÿ</p><p>é—®é¢˜ä¸€ï¼Œâ€œç»˜åˆ¶çš„ä½ç½®åªèƒ½æ¥è¿‘ä¸¤æŒ‡å®šç«¯ç‚¹é—´çš„å®é™…çº¿æ®µä½ç½®ï¼Œä¾‹å¦‚ï¼Œä¸€æ¡çº¿æ®µçš„ä½ç½®æ˜¯ï¼ˆ10.48ï¼Œ 20.51ï¼‰ï¼Œè½¬æ¢ä¸ºåƒç´ ä½ç½®åˆ™æ˜¯ï¼ˆ 10ï¼Œ 21ï¼‰ â€</p><p>é—®é¢˜äºŒæ¶‰åŠåˆ°å…·ä½“çš„ç”»çº¿ç®—æ³•ï¼Œä»¥åŠåŒºåŸŸå›¾å…ƒå¡«å……ç®—æ³•ã€‚é€šå¸¸çš„ç”»çº¿ç®—æ³•æœ‰DDA ç®—æ³•ã€ Bresenham ç”»çº¿ç®—æ³•ï¼›åŒºåŸŸå›¾å…ƒå¡«å……ç®—æ³•æœ‰ï¼Œæ‰«æçº¿å¤šè¾¹å½¢å¡«å……ç®—æ³•ã€è¾¹ç•Œå¡«å……ç®—æ³•ç­‰</p><p>Pixel operation åˆç§°ä¸º Raster Operationï¼ˆRasterOperationï¼‰ï¼Œæ˜¯åœ¨æ›´æ–°å¸§ç¼“å­˜ä¹‹å‰ï¼Œæ‰§è¡Œæœ€åä¸€ç³»åˆ—é’ˆå¯¹æ¯ä¸ªç‰‡æ®µçš„æ“ä½œï¼Œå…¶ç›®çš„æ˜¯ï¼šè®¡ç®—å‡ºæ¯ä¸ªåƒç´ çš„é¢œè‰²å€¼ã€‚</p><p><img src="imgs/Raster.png"></p><p>Shader ç¼–æˆæ˜¯åŸºäºè®¡ç®—æœºå›¾å½¢ç¡¬ä»¶çš„ï¼Œè¿™å…¶ä¸­å°±åŒ…æ‹¬ GPU ä¸Šçš„å¯„å­˜å™¨ç±»å‹ï¼Œglsl å’Œ hlsl çš„ç€è‰²è™šæ‹Ÿæœºç‰ˆæœ¬å°±æ˜¯åŸºäº GPU çš„å¯„å­˜å™¨å’ŒæŒ‡ä»¤é›†è€ŒåŒºåˆ†çš„ã€‚</p><p><img src="imgs/GPUå‚¨å­˜æ¶æ„.png"></p><ul><li>æ·±åº¦ç¼“å†²(depth buffer/z buffer)</li></ul><p>Z buffer åº”è¯¥æ˜¯å¤§å®¶æœ€ä¸ºç†Ÿæ‚‰çš„ç¼“å†²åŒºç±»å‹ï¼Œåˆç§°ä¸º depthbufferï¼Œå³æ·±åº¦ç¼“å†²åŒºï¼Œå…¶ä¸­å­˜æ”¾çš„æ˜¯è§†ç‚¹åˆ°æ¯ä¸ªåƒç´ æ‰€å¯¹åº”çš„ç©ºé—´ç‚¹çš„è·ç¦»è¡¡é‡ï¼Œç§°ä¹‹ä¸ºZ å€¼æˆ–è€…æ·±åº¦å€¼ã€‚å¯è§ç‰©ä½“çš„ Z å€¼èŒƒå›´ä½äºã€ 0ï¼Œ1ã€‘åŒºé—´ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæœ€æ¥è¿‘çœ¼ç›çš„é¡¶ç‚¹ï¼ˆè¿‘è£å‡é¢ä¸Šï¼‰å…¶ Z å€¼ä¸º0.0ï¼Œç¦»çœ¼ç›æœ€è¿œçš„é¡¶ç‚¹ï¼ˆè¿œè£å‡é¢ä¸Šï¼‰å…¶ Zå€¼ä¸º 1.0ã€‚ ä½¿ç”¨ z bufferå¯ä»¥ç”¨æ¥åˆ¤æ–­ç©ºé—´ç‚¹çš„é®æŒ¡å…³ç³»ï¼Œè‘—åçš„æ·±åº¦ç¼“å†²åŒºç®—æ³•ï¼ˆ depth-buffermethodï¼Œåˆç§° Z ç¼“å†²åŒºç®—æ³•ï¼‰å°±æ˜¯å¯¹æŠ•å½±å¹³é¢ä¸Šæ¯ä¸ªåƒç´ æ‰€å¯¹åº”çš„ Zå€¼è¿›è¡Œæ¯”è¾ƒçš„ã€‚</p><p>Z å€¼å¹¶éçœŸæ­£çš„ç¬›å¡å„¿ç©ºé—´åæ ‡ç³»ä¸­çš„æ¬§å‡ é‡Œå¾·è·ç¦»ï¼ˆ Euclideandistanceï¼‰ï¼Œè€Œæ˜¯ä¸€ç§â€œé¡¶ç‚¹åˆ°è§†ç‚¹è·ç¦»â€çš„ç›¸å¯¹åº¦é‡ã€‚æ‰€è°“ç›¸å¯¹åº¦é‡ï¼Œå³è¿™ä¸ªå€¼ä¿ç•™äº†ä¸å…¶ä»–åŒç±»å‹å€¼çš„ç›¸å¯¹å¤§å°å…³ç³»ã€‚</p><p><img src="imgs/zbuffer0.png"> <img src="imgs/zbuffer1.png"></p><p>å…¶ä¸­ f è¡¨ç¤ºè§†ç‚¹åˆ°è¿œè£å‡é¢çš„ç©ºé—´è·ç¦»ï¼Œ nè¡¨ç¤ºè§†ç‚¹åˆ°è¿‘è£å‡é¢çš„ç©ºé—´è·ç¦»ï¼Œ z è¡¨ç¤ºè§†ç‚¹åˆ°é¡¶ç‚¹çš„ç©ºé—´è·ç¦»ï¼Œ N è¡¨ç¤º Zå€¼ç²¾åº¦ã€‚å¤§å¤šæ•°äººæ‰€å¿½ç•¥çš„æ˜¯ï¼Œ z buffer ä¸­å­˜æ”¾çš„ zå€¼ä¸ä¸€å®šæ˜¯çº¿æ€§å˜åŒ–çš„ã€‚åœ¨æ­£æŠ•å½±ä¸­åŒä¸€å›¾å…ƒç›¸é‚»åƒç´ çš„ Zå€¼æ˜¯çº¿æ€§å…³ç³»çš„ï¼Œä½†åœ¨é€è§†æŠ•å½±ä¸­å´ä¸æ˜¯çš„ã€‚åœ¨é€è§†æŠ•å½±ä¸­è¿™ç§å…³ç³»æ˜¯éçº¿æ€§çš„ï¼Œè€Œä¸”éçº¿æ€§çš„ç¨‹åº¦éšç€ç©ºé—´ç‚¹åˆ°è§†ç‚¹çš„è·ç¦»å¢åŠ è€Œè¶Šå‘æ˜æ˜¾ã€‚</p><p>FrameBuffer</p><p>Frame bufferï¼Œç§°ä¸ºå¸§ç¼“å†²å™¨ï¼Œç”¨äºå­˜æ”¾æ˜¾ç¤ºè¾“å‡ºçš„æ•°æ®ï¼Œè¿™ä¸ª bufferä¸­çš„æ•°æ®ä¸€èˆ¬æ˜¯åƒç´ é¢œè‰²å€¼ã€‚ Frame buffer æœ‰æ—¶ä¹Ÿè¢«è®¤ä¸ºæ˜¯ colorbufferï¼ˆé¢œè‰²ç¼“å†²å™¨ï¼‰å’Œ z buffer çš„ç»„åˆï¼ˆã€Šå®æ—¶è®¡ç®—æœºå›¾å½¢å­¦ï¼ˆç¬¬äºŒç‰ˆï¼‰ã€‹12 é¡µï¼‰ã€‚é‚£ä¹ˆ frame buffer ä½äºä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿåœ¨ webMediaBrandsç½‘ç«™ä¸Šæ‘˜å½•äº†ä¸€æ®µè‹±æ–‡è¯´æ˜ï¼Œå³ framebufferé€šå¸¸éƒ½åœ¨æ˜¾å¡ä¸Šï¼Œ<strong>ä½†æ˜¯æœ‰æ—¶æ˜¾å¡ä¼šé›†æˆåˆ°ä¸»æ¿ä¸Šï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸‹frame bufferè¢«æ”¾åœ¨å†…å­˜åŒºåŸŸï¼ˆ general main memoryï¼‰</strong>ã€‚</p><h2 id="å…‰ç…§æ¨¡å‹">å…‰ç…§æ¨¡å‹</h2><h3 id="æ¼«åå°„ä¸lambert">æ¼«åå°„ä¸Lambert</h3><p>ç²—ç³™çš„ç‰©ä½“è¡¨é¢å‘å„ä¸ªæ–¹å‘ç­‰å¼ºåº¦åœ°åå°„å…‰ï¼Œè¿™ç§ç­‰åŒåœ°å‘å„ä¸ªæ–¹å‘æ•£å°„çš„ç°è±¡ç§°ä¸ºå…‰çš„æ¼«åå°„ï¼ˆdiffusereflectionï¼‰ã€‚äº§ç”Ÿå…‰çš„æ¼«åå°„ç°è±¡çš„ç‰©ä½“è¡¨é¢ç§°ä¸ºç†æƒ³æ¼«åå°„ä½“ï¼Œä¹Ÿç§°ä¸ºæœ—ä¼¯ï¼ˆLambertï¼‰åå°„ä½“ã€‚</p><p>æ¼«åå°„ä½“ä¸ç¯å¢ƒå…‰äº¤äº’åå°„çš„å…‰å¼º. <span class="math display">\[    I_{ambdiff} = k_{d}I_{a}, I_{a} è¡¨ç¤ºå…‰å¼ºï¼Œk_{d}è¡¨ç¤ºæè´¨å¯¹ç¯å¢ƒå…‰çš„åå°„ç³»æ•°ï¼Œ  I_{ambdiff}æ˜¯æ¼«åå°„ä½“ä¸ç¯å¢ƒå…‰äº¤äº’åå°„çš„å…‰å¼º\]</span></p><p>å½“æ–¹å‘å…‰ç…§å°„åˆ°æœ—ä¼¯åå°„ä½“ä¸Šæ—¶ï¼Œæ¼«åå°„å…‰çš„å…‰å¼ºä¸å…¥å°„å…‰çš„æ–¹å‘å’Œå…¥å°„ç‚¹è¡¨é¢æ³•å‘å¤¹è§’çš„ä½™å¼¦æˆæ­£æ¯”ï¼Œè¿™ç§°ä¹‹ä¸ºLambert å®šå¾‹ï¼Œå¹¶ç”±æ­¤æ„é€ å‡º Lambert æ¼«åå°„æ¨¡å‹ï¼š</p><p><span class="math display">\[    I_{ldiff} = k_{d}I_{l}\cos\theta  I_{l}æ˜¯æ–¹å‘å…‰æºå¼ºåº¦ï¼Œ\thetaæ˜¯å…¥å°„å…‰æ–¹å‘ä¸é¡¶ç‚¹æ³•çº¿çš„å¤¹è§’ï¼Œç§°ä¸ºå…¥å°„ (0â‰¤Î¸â‰¤90Â°)ï¼ŒI_{ldiff}æ˜¯æ¼«åå°„ä½“ä¸æ–¹å‘å…‰äº¤äº’åå°„çš„å…‰å¼ºã€‚å…¥å°„è§’ä¸ºé›¶æ—¶ï¼Œè¯´æ˜å…‰çº¿å‚ç›´äºç‰©ä½“è¡¨é¢ï¼Œæ¼«åå°„å…‰å¼ºæœ€å¤§ï¼›90Â°æ—¶å…‰çº¿ä¸ç‰©ä½“è¡¨é¢å¹³è¡Œï¼Œç‰©ä½“æ¥æ”¶ä¸åˆ°ä»»ä½•å…‰çº¿ã€‚\]</span></p><p>ç»¼åˆè€ƒè™‘ç¯å¢ƒå…‰å’Œæ–¹å‘å…‰ï¼Œå…¬å¼ä¸ºï¼š</p><p>è‹¥Nä¸ºé¡¶ç‚¹å•ä½æ³•å‘é‡ï¼ŒLè¡¨ç¤ºä»é¡¶ç‚¹æŒ‡å‘å…‰æºçš„å•ä½å‘é‡ï¼ˆæ³¨æ„ï¼Œæ˜¯ç”±é¡¶ç‚¹æŒ‡å‘å…‰æºï¼Œä¸è¦å¼„åäº†ï¼‰ï¼Œåˆ™cosÎ¸ç­‰ä»·äºNä¸Lçš„ç‚¹ç§¯ã€‚ <span class="math display">\[    I_{diff} = I_{ambdiff} + I_{ldiff} = k_{d}I_{a} +k_{d}I_{l}\cos\theta = k_{d}I_{a} + k_{d}I_{l}(N.L),\]</span></p><h3 id="é•œé¢åå°„ä¸phong">é•œé¢åå°„ä¸Phong</h3><p>Lambert æ¨¡å‹è¾ƒå¥½åœ°è¡¨ç°äº†ç²—ç³™è¡¨é¢ä¸Šçš„å…‰ç…§ç°è±¡ï¼Œå¦‚çŸ³ç°ç²‰åˆ·çš„å¢™å£ã€çº¸å¼ ç­‰ï¼Œä½†åœ¨ç”¨äºè¯¸å¦‚é‡‘å±æè´¨åˆ¶æˆçš„ç‰©ä½“æ—¶ï¼Œåˆ™ä¼šæ˜¾å¾—å‘†æ¿ï¼Œè¡¨ç°ä¸å‡ºå…‰æ³½ï¼Œä¸»è¦åŸå› æ˜¯è¯¥æ¨¡å‹æ²¡æœ‰è€ƒè™‘è¿™äº›è¡¨é¢çš„é•œé¢åå°„æ•ˆæœã€‚ä¸€ä¸ªå…‰æ»‘ç‰©ä½“è¢«å…‰ç…§å°„æ—¶ï¼Œå¯ä»¥åœ¨æŸä¸ªæ–¹å‘ä¸Šçœ‹åˆ°å¾ˆå¼ºçš„åå°„å…‰ï¼Œè¿™æ˜¯å› ä¸ºåœ¨æ¥è¿‘é•œé¢åå°„è§’çš„ä¸€ä¸ªåŒºåŸŸå†…ï¼Œåå°„äº†å…¥å°„å…‰çš„å…¨éƒ¨æˆ–ç»å¤§éƒ¨åˆ†å…‰å¼ºï¼Œè¯¥ç°è±¡ç§°ä¸ºé•œé¢åå°„ã€‚ Phong BuiTuong æå‡ºä¸€ä¸ªè®¡ç®—é•œé¢åå°„å…‰å¼ºçš„ç»éªŒæ¨¡å‹ï¼Œç§°ä¸º phongæ¨¡å‹ï¼Œè®¤ä¸ºé•œé¢åå°„çš„å…‰å¼ºä¸<strong>åå°„å…‰çº¿å’Œè§†çº¿çš„å¤¹è§’</strong>ç›¸å…³ï¼Œå…¶æ•°å­¦è¡¨è¾¾å¦‚å…¬å¼(9-5)æ‰€ç¤ºï¼š</p><p><span class="math display">\[    I_{spec} = K_{s} + I_{l}(V.R)^{n_{s}},  K_{s}ä¸ºæè´¨çš„é•œé¢åå°„ç³»æ•°ï¼Œn_{s}æ˜¯é«˜å…‰æŒ‡æ•°ï¼ŒV è¡¨ç¤ºä»é¡¶ç‚¹åˆ°è§‚å¯Ÿç‚¹çš„æ–¹å‘ï¼ŒRä»£è¡¨åå°„å…‰æ–¹å‘\]</span></p><p>é«˜å…‰æŒ‡æ•°åæ˜ äº†ç‰©ä½“è¡¨é¢çš„å…‰æ³½ç¨‹åº¦ã€‚ s n è¶Šå¤§ï¼Œåå°„å…‰è¶Šé›†ä¸­ï¼Œå½“åç¦»åå°„æ–¹å‘æ—¶ï¼Œå…‰çº¿è¡°å‡çš„è¶Šå‰å®³ï¼Œåªæœ‰å½“è§†çº¿æ–¹å‘ä¸åå°„å…‰çº¿æ–¹å‘éå¸¸æ¥è¿‘æ—¶æ‰èƒ½çœ‹åˆ°é•œé¢åå°„çš„é«˜å…‰ç°è±¡ï¼Œæ­¤æ—¶ï¼Œé•œé¢åå°„å…‰å°†ä¼šåœ¨åå°„æ–¹å‘é™„è¿‘å½¢æˆäº®ä¸”å°çš„å…‰æ–‘ï¼› s nè¶Šå°ï¼Œè¡¨ç¤ºç‰©ä½“è¶Šç²—ç³™ï¼Œåå°„å…‰åˆ†æ•£ï¼Œè§‚å¯Ÿåˆ°çš„å…‰æ–‘åŒºåŸŸå°ï¼Œå¼ºåº¦å¼±ã€‚</p><p>åå°„å…‰çš„æ–¹å‘Rå¯ä»¥é€šè¿‡å…¥å°„å…‰æ–¹å‘Lï¼ˆä»é¡¶ç‚¹æŒ‡å‘å…‰æºï¼‰å’Œç‰©ä½“æ³•å‘é‡Næ±‚å‡ºï¼š <span class="math display">\[    R + L = (2N.L).N, æ‰€ä»¥ R =  (2N.L).N - L\]</span></p><h3 id="blinn-phong">Blinn-Phong</h3><p>Blinn-Phong å…‰ç…§æ¨¡å‹ï¼Œåˆç§°ä¸º Blinn-phong åå°„æ¨¡å‹ï¼ˆBlinnâ€“Phongreflection modelï¼‰æˆ–è€… phong ä¿®æ­£æ¨¡å‹ï¼ˆmodified Phong reflectionmodelï¼‰,å’Œä¼ ç»Ÿ phong å…‰ç…§æ¨¡å‹ç›¸æ¯”ï¼Œ Blinn-phong å…‰ç…§æ¨¡å‹æ··åˆäº† Lambertçš„æ¼«å°„éƒ¨åˆ†å’Œæ ‡å‡†çš„é«˜å…‰ï¼Œæ¸²æŸ“æ•ˆæœæœ‰æ—¶ æ¯” Phongé«˜å…‰æ›´æŸ”å’Œã€æ›´å¹³æ»‘ï¼Œæ­¤å¤–å®ƒåœ¨é€Ÿåº¦ä¸Šç›¸å½“å¿«ï¼Œå› æ­¤æˆä¸ºè®¸å¤šCGè½¯ä»¶ä¸­çš„é»˜è®¤å…‰ç…§æ¸²æŸ“æ–¹æ³•ã€‚</p><p>phong å…‰ç…§æ¨¡å‹ä¸­ï¼Œå¿…é¡»è®¡ç®—VRâ€¢ çš„å€¼ï¼Œå…¶ä¸­Rä¸ºåå°„å…‰çº¿æ–¹å‘å•ä½å‘é‡ï¼ŒVä¸ºè§†çº¿æ–¹å‘å•ä½å‘é‡ï¼Œä½†æ˜¯åœ¨ Blinn-phong å…‰ç…§æ¨¡å‹ä¸­ï¼Œç”¨NHâ€¢ çš„å€¼å–ä»£äº† VRâ€¢ã€‚Blinn-phong å…‰ç…§æ¨¡å‹å…¬å¼ä¸ºï¼š</p><p><span class="math display">\[    I_{spec} = K_{s} + I_{l}(N.H)^{n_{s}},å…¶ä¸­Næ˜¯å…¥å°„ç‚¹çš„å•ä½æ³•å‘é‡ï¼ŒHæ˜¯â€œå…‰å…¥å°„æ–¹å‘Lå’Œè§†ç‚¹æ–¹å‘Vçš„ä¸­é—´å‘é‡â€ï¼Œé€šå¸¸ä¹Ÿç§°ä¹‹ä¸ºåŠè§’å‘é‡ã€‚\]</span></p><p>æ³¨æ„ï¼šåŠè§’å‘é‡è¢«å¹¿æ³›ç”¨äºå„ç±»å…‰ç…§æ¨¡å‹ï¼ŒåŸå› ä¸ä½†åœ¨äºåŠè§’å‘é‡è•´å«çš„ä¿¡æ¯ä»·å€¼ï¼Œä¹Ÿåœ¨äºè®¡ç®—åŠè§’å‘é‡æ˜¯ä¸€ä»¶ç®€å•ã€è€—æ—¶ä¸å¤šçš„å·¥ä½œ</p><p><span class="math display">\[    H = \frac{L + V}{L.V},\]</span></p><h3 id="å…¨å±€å…‰ç…§æ¨¡å‹ä¸-rendering-equation">å…¨å±€å…‰ç…§æ¨¡å‹ä¸ RenderingEquation</h3><p>Kajia åœ¨ 1986 å¹´æå‡º rendering equationï¼š</p><p><span class="math display">\[    L_{0}(x, w_{0}) = L_{e}(x, w_{0})  + \int_{}^{omega}f_{r}(x, w_{i},w_{0})L_{i}(x, w_{i})(n.w_{i})dw_{i}, å…¶ä¸­xè¡¨ç¤ºå…¥å°„ç‚¹ï¼›    L_{0}(x, w_{0}) å³ä»ç‰©ä½“è¡¨é¢xç‚¹ï¼Œæ²¿æ–¹å‘ w_{0} åå°„çš„å…‰å¼ºï¼›    L_{e}(x, w_{0})  è¡¨ç¤ºä»ç‰©ä½“è¡¨é¢xä»¥æ–¹å‘ w_{0}å‘å°„å‡ºå»å…‰å¼ºï¼Œè¯¥å€¼ä»…å¯¹è‡ªå‘å…‰ä½“æœ‰æ•ˆï¼›    f_{r}(x, w_{i}, w_{0}) ä¸ºï¼Œå…¥å°„å…‰çº¿æ–¹å‘ä¸º w_{i}ç…§å°„åˆ°ç‚¹xä¸Šï¼Œç„¶åä»w_{0} æ–¹å‘åå°„å‡ºå»çš„ BRDF å€¼ã€‚æ˜¯ä¸€ç§å‡½æ•°ç±»å‹ã€‚    L_{i}(x, w_{i}) ä¸ºå…¥å°„æ–¹å‘ä¸º w_{i}, ç…§å°„åˆ° x ä¸Šçš„ å…¥å°„å…‰å¼ºï¼›    n è¡¨ç¤º x å‡ºçš„æ³•å‘é‡ã€‚    ç„¶åå¯¹å…¥å°„æ–¹å‘è¿›è¡Œç§¯åˆ†(å¯¹ä¸åŒæ–¹å‘å…¥å°„è¿›è¡Œè®¡ç®—ï¼Œåœ¨ç›¸åŠ )ï¼Œè®¡ç®—çš„ç»“æœå°±æ˜¯ä»è§‚å¯Ÿæ–¹å‘ä¸Šçœ‹åˆ°çš„è¾å°„ç»¿ã€‚    ä¸ºå…¥å°„æ–¹å‘ä¸º i w æ–¹å‘åå°„å‡ºå»çš„ wï¼Œç…§å°„åˆ°ç‚¹xä¸Šå…¥å°„å…‰å¼ºï¼›nè¡¨ç¤ºç‚¹xå¤„çš„æ³•å‘é‡ã€‚ç„¶åå¯¹å…¥å°„æ–¹å‘è¿›è¡Œç§¯åˆ†ï¼ˆå› ä¸ºå…‰çº¿å…¥å°„çš„æ–¹å‘æ˜¯å››é¢å…«æ–¹çš„ï¼Œç§¯åˆ†çš„æ„ä¹‰æ˜¯å¯¹æ¯ä¸ªæ–¹å‘è¿›è¡Œä¸€éè®¡ç®—åè¿›è¡Œç›¸åŠ ï¼‰ï¼Œè®¡ç®—çš„ç»“æœå°±æ˜¯â€œä»è§‚å¯Ÿæ–¹å‘ä¸Šçœ‹åˆ°çš„è¾å°„ç‡â€ã€‚\]</span></p><h3 id="cook-torrance">Cook-Torrance</h3><p>Cook-Torrance å…‰ç…§æ¨¡å‹å°†ç‰©ä½“ç²—ç³™è¡¨é¢ï¼ˆrough surfaceï¼‰çœ‹ä½œç”±å¾ˆå¤šå¾®å°å¹³é¢ï¼ˆå¾®å¹³é¢ï¼‰ç»„æˆï¼Œæ¯ä¸€ä¸ªå¾®å¹³é¢éƒ½è¢«çœ‹ä½œä¸€ä¸ªç†æƒ³çš„é•œé¢åå°„ä½“ï¼Œç‰©ä½“è¡¨é¢çš„ç²—ç³™åº¦ç”±å¾®å¹³é¢æ–œç‡çš„å˜åŒ–æ¥è¡¡é‡ã€‚ä¸€ä¸ªç²—ç³™è¡¨é¢ç”±ä¸€ç³»åˆ—æ–œç‡å˜åŒ–å¾ˆå¤§çš„å¾®å¹³é¢ç»„æˆï¼Œè€Œåœ¨ç›¸å¯¹å¹³æ»‘çš„è¡¨é¢ä¸Šå¾®å¹³é¢æ–œç‡å˜åŒ–è¾ƒå°ã€‚</p><p>Cook-Torranceæ¨¡å‹å°†å…‰åˆ†ä¸ºä¸¤ä¸ªæ–¹é¢è€ƒè™‘ï¼šæ¼«åå°„å…‰å¼ºå’Œé•œé¢åå°„å…‰å¼ºã€‚</p><p><span class="math display">\[I_{c-t} = I_{diff} + I_{spec} = I_{diff} + k_{s}I_{l}R_{s}, å…¶ä¸­I_{diff} æ˜¯æ¼«åå°„å…‰å¼ºï¼Œ è¯¥éƒ¨åˆ†ä½ çš„è®¡ç®—æ–¹æ³•å’Œå‰é¢çš„æ‰€è®²çš„ç›¸åŒï¼Œk_{s}I_{l}R_{s} æ˜¯é•œé¢åå°„å…‰å¼ºçš„è®¡ç®—æ–¹æ³•ã€‚\]</span></p><p>ä»å…¬å¼ä¸Šå¯ä»¥çœ‹å‡º: cook_Torrance æ¨¡å‹ä¸phongã€blinn-phongä¸‰ä¸­é«˜å…‰ç…§æ¨¡å‹æœ¬è´¨çš„åŒºåˆ«åœ¨äº<strong>ä½¿ç”¨ä¸åŒçš„æ•°å­¦è¡¨è¾¾å¼è®¡ç®—<span class="math display">\[R_{s}\]</span></strong></p><p><span class="math display">\[R_{s} = \frac{F*D*G}{(N.V)*(N.L)}\]</span></p><p>, å…¶ä¸­F æ˜¯Fresnel åå°„ç³»æ•°ï¼Œ è¡¨ç¤ºåå°„å…‰æƒ³ä¸Šçš„å…‰å¼ºå åŸå§‹å…‰å‰çš„æ¯”ç‡ï¼› Dè¡¨ç¤ºä½å¹³é¢åˆ†å¸ƒå‡½æ•°ï¼Œ è¿”å›çš„æ˜¯ç»™å®šæ–¹å‘ä¸Šçš„ä½å¹³é¢çš„åˆ†æ•°å€¼ï¼›Gæ˜¯é›†åˆè¡°å‡ç³»æ•°ï¼Œ è¡¡é‡ä½å¹³é¢è‡ªèº«çš„é®è”½å…‰å¼ºçš„å½±å“ã€‚ Nã€Vã€Låˆ†åˆ«è¡¨ç¤ºæ³•å‘é‡ã€è§†çº¿æ–¹å‘ï¼ˆä»é¡¶ç‚¹åˆ°è§†ç‚¹ï¼‰ å’Œå…¥å°„æ–¹å‘ï¼ˆä»é¡¶ç‚¹å‘å¤–ï¼‰ã€‚</p><p>schlich ç»™å‡ºäº† Fresnel åå°„ç³»æ•°çš„ä¸€ä¸ªè¿‘ä¼¼ï¼Œç²¾åº¦åœ¨1% èŒƒå›´å†…çš„å…¬å¼ï¼š<span class="math display">\[    F = f_{0} + (1-f_{0})(1- V.H)^5,  f_{0}ä¸ºå…¥ç¤¾è§’åº¦è¿‘ä¼¼0(å…¥ç¤¾æ–¹å‘é è¿‘æ³•å‘é‡)æ—¶çš„ Fresnel åå°„ç³»æ•°ï¼Œ Væ—¶æŒ‡å‘è§†ç‚¹çš„å‘é‡ï¼Œ Hä¸ºåŠè§’å‘é‡ã€‚\]</span></p><p>ä½å¹³é¢åˆ†å¸ƒå‡½æ•°ï¼š æ ¹æ®ç»™å®šçš„åŠè§’å‘é‡ Hï¼Œå¾®å¹³é¢åˆ†å¸ƒå‡½æ•°è¿”å›å¾®å¹³é¢çš„åˆ†æ•°å€¼ã€‚æœ€å¸¸ä½¿ç”¨çš„å¾®å¹³é¢åˆ†å¸ƒå‡½æ•°æ—¶ Backmannåˆ†å¸ƒå‡½æ•°ï¼š</p><p><span class="math display">\[    D = \frac{1}{m^2\cos^2\alpha}e^{-\frac{\tan^2\alpha}{m^2}}\]</span></p><p>m å€¼ç”¨äºåº¦é‡è¡¨é¢çš„ç²—ç³™ç¨‹åº¦ï¼Œ è¾ƒå¤§çš„m å€¼å¯¹åº”ç²—ç³™å¹³é¢ï¼Œ è¾ƒå°çš„må€¼å¯¹åº”å…‰æ»‘å¹³é¢ï¼Œa æ—¶é¡¶ç‚¹æ³•å‘é‡ N å’ŒåŠè§’å‘é‡ H çš„å¤¹è§’ã€‚ å…¶ä¸­</p><p><span class="math display">\[    -\frac{\tan^2\alpha}{m^2} =-\frac{\frac{1-\cos^2\alpha}{\cos^2\alpha}}{m^2} = \frac{\cos^2\alpha-1}{m^2*\cos^2\alpha} = \frac{(N.H)^2 - 1}{m^2*(N*H)^2}\]</span></p><p>æ‰€ä»¥Backmann å¾®å¹³é¢åˆ†å¸ƒå‡½æ•°çš„æœ€ç»ˆå‡½æ•°è¡¨è¾¾ä¸ºå…¬å¼ï¼š</p><p><span class="math display">\[    D = \frac{1}{m^2\cos^2\alpha}e^{\frac{(N.H)^2 -1}{m^2*(N.H)^2}} =\frac{1}{m^2(N.H)^4}e^{\frac{(N.H)^2 -1}{m^2*(N.H)^2}}\]</span></p><p>å¾®å¹³é¢ä¸Šåå°„çš„å…‰å¯èƒ½å‡ºç°ä¸‰ç§æƒ…å†µï¼šå…¥å°„å…‰æœªè¢«é®æŒ¡ï¼Œæ­¤æ—¶åˆ°è¾¾è§‚å¯Ÿè€…çš„å…‰å¼ºä¸º 1ï¼›å…¥å°„å…‰éƒ¨åˆ†è¢«é®æŒ¡ï¼›åå°„å…‰éƒ¨åˆ†è¢«é®æŒ¡ã€‚å‡ ä½•è¡°å‡ç³»æ•°è¢«å®šä¹‰ä¸ºï¼šåˆ°è¾¾è§‚å¯Ÿè€…çš„å…‰çš„æœ€å°å¼ºåº¦ã€‚æ‰€ä»¥</p><p><span class="math display">\[    G = min(1, G_{1}, G_{2}) \\    G_{1} = \frac{2(N.H)(N.L)}{V.H} \\    G_{2} = \frac{2(N.H)(N.V)}{V.H} \\\]</span></p><p>æ‰€ä»¥æœ€ç»ˆçš„ Cook-Torrance å…‰ç…§æ¨¡å‹çš„ specular termçš„æœ€ç»ˆæ•°å­¦è¡¨è¾¾ä¸ºï¼š</p><p><span class="math display">\[    I_{c-t} = I_{diff} + I_{spec} = k_{d}I_{l}(N.L) + k_{s}I_{l}R_{s} =k_{d}I_{l}(N.L) + k_{s}I_{l}\frac{(f_{0} + (1-f_{0})(1-V.H)^5)\frac{1}{m^2\cos^4\alpha}e^{\frac{(N.H)^2 -1}{m^2*(N.H)^2}}min(1, \frac{2(N.H)(N.L)}{V.H},\frac{2(N.H)(N.V)}{V.H})}{V.N}\]</span></p><p>Cook-Torrance æå‡ºä¹‹å‰ï¼Œå¾®å¹³é¢åˆ†å¸ƒå‡½æ•°ä½¿ç”¨çš„æ˜¯é«˜æ–¯åˆ†å¸ƒï¼ˆå³æ­£æ€åˆ†å¸ƒï¼‰å‡½æ•°ã€‚</p><h3 id="brdf">BRDF</h3><p>åŒå‘åå°„åˆ†å¸ƒå‡½æ•°(Bindirectional Reflectance Distribution Function).è¯¥å‡½æ•°é¢ç†Ÿäº†å…¥å°„å…‰çº¤åœ¨éé€æ˜ç‰©ä½“è¡¨é¢å¦‚ä½•è¿›è¡Œåå°„ã€‚BRDFçš„ç»“æœæ˜¯ä¸€ä¸ªæ²¡æœ‰å•ä½çš„æ•°å€¼ï¼Œè¡¨ç¤ºåœ¨ç»™å®šå…¥å°„æ¡ä»¶ä¸‹ï¼ŒæŸä¸ªå‡ºå°„æ–¹å‘ä¸Šåå°„å…‰çš„ç›¸å¯¹èƒ½é‡ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºâ€œå…¥å°„å…‰ä»¥ç‰¹å®šæ–¹å‘ç¦»å¼€çš„æ¦‚ç‡â€</p><p>BRDFå€¼è¡¨ç¤ºï¼šå…‰çº¿ä»¥ Wi æ–¹å‘å…¥å°„ ï¼Œç„¶åä»¥ W0 æ–¹å‘å‡ºå°„çš„æ¦‚ç‡ï¼Œæˆ–è€…å…‰å¼ºã€‚ä¾æ®å…‰å­¦åŸç†ï¼Œ BRDF çš„è®¡ç®—å…¬å¼ä¸ºï¼š</p><p><span class="math display">\[    f_{r}(w_{i}, w_{0}) = \frac{dL_{r}(w_{0})}{dE_{i}(w_{i})} =\frac{dL_{r}(w_{0})}{L_{i}(w_{i})\cos\theta_{i}dw_{i}}, å…¶ä¸­L_{r}(w_{0}) è¡¨ç¤ºä» w_{0}  æ–¹å‘å‘å°„çš„å…‰çº¿çš„è¾å°„äº®åº¦ï¼ŒE_{i}(w_{i}) è¡¨ç¤ºä»w_{i} æ–¹å‘å…¥å°„çš„å…‰ç…§çš„è¾å°„ç…§åº¦ã€‚\]</span></p><p>è¾å°„äº®åº¦ï¼šæ²¡å•ä½ç«‹ä½“è§’åœ¨å‚ç›´äºç»™å®šæ–¹å‘çš„å¹³é¢ä¸Šçš„å•ä½æ­£æŠ•å½±é¢ç§¯ä¸Šçš„åŠŸç‡ã€‚è¾å°„ç…§åº¦åˆ™æ˜¯æ•´ä¸ªå…¥å°„è¡¨é¢çš„åŠŸç‡ï¼Œç­‰äºæŠ•å°„åœ¨åŒ…æ‹¬è¯¥ç‚¹çš„ä¸€ä¸ªé¢å…ƒçš„è¾å°„é€šé‡<span class="math display">\[d\varphi\]</span> é™¤ä»¥è¯¥é¢å…ƒçš„é¢ç§¯ <span class="math display">\[dA\]</span>, ä»ç‰©ç†å…‰å­¦ä¸Šæˆ‘ä»¬å¯ä»¥å°† å…¬å¼ç†è§£ä¸ºï¼šBRDFå‡½æ•°è®¡ç®—çš„æ˜¯â€œç‰¹å®šåå°„æ–¹å‘çš„å…‰å¼ºä¸å…¥å°„å…‰å¼ºçš„æ¯”ä¾‹â€ã€‚</p><p>å„å‘å¼‚æ€§(anisotropy)ä¸å‡å‘æ€§ç›¸åï¼Œæ˜¯æŒ‡åœ¨ä¸åŒæ–¹å‘å…·æœ‰ä¸åŒè¡Œä¸ºçš„æ€§è´¨ï¼Œä¹Ÿå°±æ˜¯å…¶è¡Œä¸ºä¸æ–¹å‘æœ‰å…³ã€‚å¦‚åœ¨ç‰©ç†å­¦ä¸Šï¼Œæ²¿ç€ææ–™åšä¸åŒæ–¹å‘çš„é‡æµ‹ï¼Œè‹¥ä¼šå‡ºç°ä¸åŒè¡Œä¸ºï¼Œé€šå¸¸ç§°è¯¥ææ–™å…·æœ‰æŸç§â€œå„å‘å¼‚æ€§â€ï¼Œè¿™æ ·çš„ææ–™è¡¨é¢ç§°ä¸ºå„å‘å¼‚æ€§è¡¨é¢ï¼ˆanisotropic surfaceï¼‰ï¼›</p><p>ç”±äºæè´¨æœ‰ç»„ç»‡çš„ç»†å¾®å‡¹å‡¸ç»“æ„çš„ä¸åŒï¼Œå„å‘å¼‚æ€§ä¹Ÿåˆ†ä¸ºåŸºæœ¬çš„ä¸‰ç§ç±»å‹: 1.çº¿æ€§å„å‘å¼‚æ€§ï¼› 2. å¾„å‘å„å‘å¼‚æ€§ï¼› 3.åœ†æŸ±å½¢å„å‘å¼‚æ€§ï¼Œå®é™…ä¸Šçº¿æ€§å„å‘å¼‚æ€§ï¼Œå•è¢«æ˜ åƒä¸ºåœ†æŸ±å½¢ã€‚</p><h3 id="bank-brdf-ç»éªŒæ¨¡å‹">Bank BRDF ç»éªŒæ¨¡å‹</h3><p>Bank BRDF å±äºç»éªŒæ¨¡å‹ï¼Œç”±äºå…¶è®¡ç®—ç®€å•ï¼Œä¸”æ•ˆæœè‰¯å¥½ï¼Œæ‰€ä»¥è¯¥æ¨¡å‹åœ¨å„å‘å¼‚æ€§å…‰ç…§æ•ˆæœçš„æ¨¡æ‹Ÿæ–¹é¢éå¸¸æœ‰ç”¨ã€‚Bank BRDFçš„é•œé¢åå°„éƒ¨åˆ†å¯ä»¥è¡¨è¾¾ä¸ºå…¬å¼çš„å½¢å¼ï¼š</p><p><span class="math display">\[    f= k_{s}(\sqrt{1 - (L.T)^2} \sqrt{1 - (V.T)^2} - (L.T)(V.T))^{n_{s}}\]</span></p><p><span class="math display">\[ k_{s}ã€ n_{s}\]</span>åˆ†åˆ«è¡¨ç¤ºé•œé¢åå°„ç³»æ•°å’Œé«˜å…‰ç³»æ•°ï¼› Lè¡¨ç¤ºå…¥å°„å…‰çº¤çš„æ–¹å‘ã€ Vè¡¨ç¤ºè§†çº¿è§‚å¯Ÿæ–¹å‘ã€Tè¡¨ç¤ºè¯¥åº—çš„åˆ‡å‘é‡ã€‚å°¤å…¶è¦æ³¨æ„åˆ‡å‘é‡çš„è®¡ç®—æ–¹æ³•ï¼Œå› ä¸ºä¸€ä¸ªä¸‰ç»´ç©ºé—´ç‚¹å¯èƒ½å­˜åœ¨æ— æ•°ä¸ªåˆ‡å‘é‡ï¼Œé€šå¸¸æˆ‘é‡‡ç”¨â€œé¡¶ç‚¹çš„æ³•å‘é‡å’Œè§†çº¿æ–¹å‘åšå‰ç§¯ï¼Œå…¶ç»“æœä½œä¸º Tã€‚</p><h2 id="é€æ˜å…‰ç…§æ¨¡å‹ä¸ç¯å¢ƒè´´å›¾">é€æ˜å…‰ç…§æ¨¡å‹ä¸ç¯å¢ƒè´´å›¾</h2><p>æè´¨å’Œå…‰çš„äº¤äº’é™¤äº†åå°„ç°è±¡ï¼Œå¯¹äºé€æ˜ç‰©ä½“è¿˜å­˜åœ¨é€å°„ç°è±¡ã€‚æ¨¡æ‹Ÿå…‰çš„é€å°„ç°è±¡é€šå¸¸æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤´ç—›çš„é—®é¢˜ï¼Œå› ä¸ºéœ€è¦è‡³å°‘è®¡ç®—å…‰çš„ä¸¤æ¬¡é€å°„æ–¹å‘ï¼Œé¦–å…ˆè®¡ç®—å…‰ä»ä»‹è´¨ä¸€è¿›å…¥ä»‹è´¨äºŒçš„é€å°„æ–¹å‘ï¼Œç„¶åè®¡ç®—å…‰ä»ä»‹è´¨äºŒè¿›å…¥ä»‹è´¨ä¸€çš„é€å°„æ–¹è±¡ã€‚æ­¤å¤–ï¼Œå…‰åœ¨é€æ˜ç‰©ä½“å†…ç©¿è¶Šçš„è·ç¦»ä»¥åŠè¢«ç©¿è¶Šçš„æè´¨ï¼Œç›´æ¥å…³ç³»åˆ°å…‰çš„è¡°å‡ç¨‹åº¦ï¼›åŠ ä¸Šï¼Œè¿˜æœ‰å¾ˆå¤æ‚çš„é€æ˜æè´¨çš„æ¬¡è¡¨é¢æ•£å°„ç°è±¡ï¼Œå³å…‰çº¿æ¸—é€åˆ°é€æ˜æè´¨ä¸­ï¼Œåœ¨å†…éƒ¨å‘ç”Ÿæ•£å°„ï¼Œæœ€åå°„å‡ºç‰©ä½“å¹¶è¿›å…¥è§†é‡ä¸­äº§ç”Ÿçš„ç°è±¡ã€‚æ€»è€Œè¨€ä¹‹ï¼Œä¸è®ºåœ¨CPUä¸Šè¿˜æ˜¯åœ¨GPUä¸Šï¼Œæƒ³è¦ç²¾ç¡®å®Œå–„çš„æ¨¡æ‹Ÿå…‰é€ç°è±¡æ˜¯ä¸€ä»¶ç›¸å½“å¤æ‚çš„äº‹æƒ…ã€‚</p><h3 id="snell-ä¸-fresbel">Snell ä¸ Fresbel</h3><p>æŠ˜å°„ç‡<span class="math display">\[ n\]</span>,ç­‰äºå…‰åœ¨çœŸç©ºä¸­çš„é€Ÿåº¦<span class="math display">\[ c\]</span>ä¸åœ¨é€æ˜ä»‹è´¨ä¸­çš„é€Ÿåº¦ <span class="math display">\[v\]</span>ä¹‹æ¯”ã€‚ <span class="math display">\[n = \frac{c}{v}\]</span></p><p>å¸¸è§æŠ˜å°„ç‡:</p><table><thead><tr class="header"><th style="text-align: left;">æè´¨</th><th style="text-align: left;">æŠ˜å°„ç‡</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">çœŸç©º/ç©ºæ°”</td><td style="text-align: left;">1.0/1.0003</td></tr><tr class="even"><td style="text-align: left;">æ°´</td><td style="text-align: left;">1.333</td></tr><tr class="odd"><td style="text-align: left;">ç»ç’ƒ</td><td style="text-align: left;">1.5-1.7</td></tr><tr class="even"><td style="text-align: left;">é’»çŸ³</td><td style="text-align: left;">2.417</td></tr><tr class="odd"><td style="text-align: left;">å†°</td><td style="text-align: left;">1.309</td></tr></tbody></table><ul><li>Snellå®šå¾‹Snellå®šå¾‹æè¿°å…‰çº¤ä»ä¸€ä¸ªä»‹è´¨ä¼ æ’­åˆ°å¦ä¸€ä¸ªä»‹è´¨æ—¶ï¼Œå…¥å°„è§’ã€æŠ˜å°„è§’å’Œä»‹è´¨æŠ˜å°„ç‡çš„å…³ç³»(ç­‰å¼æ–¹ç¨‹)ã€‚</li></ul><p><span class="math display">\[    \sin\theta_{i}*n_{i} = \sin\theta_{t}*n_{t}, å…¥å°„è§’ \theta_{i}, iå¯¹t çš„æŠ˜å°„ç‡ä¸º n_{i}ï¼Œ æŠ˜å°„ç‡è§’åº¦ä¸º\theta_{t}, t    å¯¹ içš„æŠ˜å°„ç‡ä¸ºn_{i}ã€‚\]</span></p><ul><li>è‰²æ•£</li></ul><p>æ­£å¸¸è‰²æ•£çš„ç»éªŒå…¬å¼ï¼ŒæŸ¯è¥¿å…¬å¼ã€‚</p><ul><li>Fresbelå®šå¾‹</li></ul><p>å…‰çº¿ç…§å°„åˆ°é€æ˜ç‰©ä½“ä¸Šæ—¶ï¼Œä¸€éƒ¨åˆ†å‘ç”Ÿåå°„ï¼Œä¸€éƒ¨åˆ†è¿›å…¥ç‰©ä½“å†…éƒ¨å¹¶åœ¨ä»‹è´¨äº¤ç•Œå¤„å‘ç”ŸæŠ˜å°„ï¼Œè¢«åå°„å’ŒæŠ˜å°„çš„å…‰é€šé‡å­˜åœ¨ä¸€å®šçš„æ¯”ç‡å…³ç³»ï¼Œè¿™ä¸ªæ¯”ç‡å…³ç³»å¯ä»¥é€šè¿‡ Fresnel å®šå¾‹è¿›è¡Œè®¡ç®—ã€‚</p><p>ä¸€ä¸ªå®Œæ•´çš„ fresnel å…¬å¼ä¾èµ–äºæŠ˜å°„ç‡ã€æ¶ˆå…‰ç‡å’Œå…¥å°„è§’åº¦ç­‰å› ç´ ï¼Œè¯¥å…¬å¼çš„æ¨å¯¼æœ¬è´¨ä¸Šæ˜¯å±äºç‰©ç†å…‰å­¦çš„éƒ¨åˆ†ã€‚ Fresnel ç³»æ•°çš„ç®€æ˜“æ¨å¯¼æ–¹å¼ï¼Œè¿‘ä¼¼åº¦åœ¨1%ã€‚</p><p><span class="math display">\[    F = f_{0} + (1 - f_{0})(1 - V.H)^5\]</span> <span class="math display">\[f_{0} \]</span>ä¸ºå…¥å°„è§’åº¦æ¥è¿‘0ï¼ˆå…¥å°„æ–¹å‘é è¿‘æ³•å‘é‡ï¼‰æ—¶çš„ Fresnel åå°„ç³»æ•°ï¼ŒVæ˜¯æŒ‡å‘è§†ç‚¹çš„è§‚å¯Ÿæ–¹å‘ï¼ŒHä¸ºåŠè§’å‘é‡ã€‚è§‚å¯Ÿå…¬å¼ï¼Œå¯ä»¥å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šéšç€å…¥å°„è§’è¶‹è¿‘ 90ï¼Œåå°„ç³»æ•°è¶‹è¿‘1ï¼Œå³æ“¦åœ°å…¥å°„æ—¶ï¼Œæ‰€æœ‰å…¥å°„å…‰éƒ½è¢«åå°„ã€‚</p><p>fresnel åå°„ç³»æ•°è®¡ç®—å…¬å¼:</p><p><span class="math display">\[    F \approx  \frac{(n_{i} - n_{t})^2}{(n_{i} + n_{t})^2} +\frac{4n_{1}n_{2}}{(n_{i} + n_{t})^2} *(1 - V.H)^5\]</span></p><p>ç¨‹åºä¸­ä¸ºäº†æé«˜æ€§èƒ½ï¼Œé€šå¸¸ä½¿ç”¨å…¥å°„è§’æ¥è¿‘ 0 æ—¶çš„fresnelç³»æ•°ã€‚ç²¾åº¦ä¸é«˜ï¼Œä½†æ˜¯è®¡ç®—é€Ÿåº¦å¿«ï¼Œä¾¿äºç¡¬ä»¶å®ç°ï¼š</p><p><span class="math display">\[    F \approx  (1 - V.H)^4\]</span></p><h3 id="ç®€å•é€æ˜å…‰ç…§æ¨¡å‹">ç®€å•é€æ˜å…‰ç…§æ¨¡å‹</h3><p>ç®€å•é€æ˜å…‰ç…§æ¨¡å‹ä¸è€ƒè™‘é€æ˜ç‰©ä½“å¯¹å…‰çš„ç¬¬äºŒæ¬¡æŠ˜å°„ã€æ¬¡è¡¨é¢æ•£å°„ï¼Œä»¥åŠå…‰åœ¨ç©¿è¶Šé€æ˜ç‰©ä½“æ—¶çš„å¼ºåº¦è¡°å‡ï¼Œåªæ˜¯ç®€å•çš„ä½¿ç”¨é¢œè‰²è°ƒå’Œçš„æ–¹æ³•ï¼Œå³æˆ‘ä»¬æœ€ç»ˆæ‰€çœ‹åˆ°çš„é¢œè‰²ï¼Œæ˜¯ç‰©ä½“è¡¨é¢çš„é¢œè‰²å’ŒèƒŒæ™¯é¢œè‰²çš„å åŠ ã€‚</p><h2 id="æŠ•å½±çº¹ç†æ˜ å°„">æŠ•å½±çº¹ç†æ˜ å°„</h2><p>æŠ•å½±çº¹ç†æ˜ å°„ä¸éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­æŒ‡å®šé¡¶ç‚¹çº¹ç†åæ ‡ï¼Œå®é™…ä¸Šï¼ŒæŠ•å½±çº¹ç†æ˜ å°„ä¸­ä½¿ç”¨çš„çº¹ç†åæ ‡æ˜¯åœ¨é¡¶ç‚¹ç€è‰²ç¨‹åºä¸­é€šè¿‡è§†ç‚¹çŸ©é˜µå’ŒæŠ•å½±çŸ©é˜µè®¡ç®—å¾—åˆ°çš„ï¼Œé€šå¸¸ä¹Ÿè¢«ç§°ä½œæŠ•å½±çº¹ç†åæ ‡(coordinatesin projective space)ã€‚</p><p>é½æ¬¡çº¹ç†åæ ‡é€šå¸¸è¡¨ç¤ºä¸ºï¼ˆs,t,r,qï¼‰,ä»¥åŒºåˆ«äºç‰©ä½“ä½ç½®é½æ¬¡åæ ‡(x, y, z,w)ã€‚ä¸€ç»´çº¹ç†å¸¸ç”¨ s åæ ‡è¡¨ç¤ºï¼ŒäºŒç»´çº¹ç†å¸¸ç”¨(s, t)åæ ‡è¡¨ç¤ºï¼Œç›®å‰å¿½ç•¥ råæ ‡ï¼Œ q åæ ‡çš„ä½œç”¨ä¸é½æ¬¡åæ ‡ç‚¹ä¸­çš„ w åæ ‡éå¸¸ç±»ä¼¼ã€‚å€¼ä¸€èˆ¬ä¸º1ã€‚</p><p>å’Œé¡¶ç‚¹ç€è‰²æµç¨‹åŸºæœ¬ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«åœ¨äºæ±‚å–é¡¶ç‚¹æŠ•å½±åæ ‡åçš„å½’ä¸€åŒ–ä¸ä¸€æ ·ï¼šè®¡ç®—æŠ•å½±çº¹ç†åæ ‡éœ€è¦å°†æŠ•å½±é¡¶ç‚¹åæ ‡å½’ä¸€åŒ–åˆ°ã€0ï¼Œ1ã€‘ç©ºé—´ä¸­ï¼Œå®ç°è¿™ä¸€æ­¥ï¼Œå¯ä»¥åœ¨éœ€è¦å·¦ä¹˜çŸ©é˜µnormalMatrix, ä¹Ÿå¯ä»¥åœ¨ç€è‰²ç¨‹åºä¸­å¯¹é¡¶ç‚¹æŠ•å½±åæ ‡çš„æ¯ä¸ªåˆ†é‡å…ˆä¹˜ä»¥1/2ç„¶åå†åŠ ä¸Š1/2ã€‚</p><p>tex2DProjå‡½æ•°ä¸tex2Då‡½æ•°çš„åŒºåˆ«å°±åœ¨äºï¼šå‰è€…ä¼šå¯¹é½æ¬¡çº¹ç†åæ ‡é™¤ä»¥æœ€åä¸€ä¸ªåˆ†é‡qï¼Œç„¶åå†è¿›è¡Œçº¹ç†æ£€ç´¢ï¼</p><h2 id="shadow-map">Shadow Map</h2><p>Shadow Map æ˜¯ä¸€ç§åŸºäºæ·±åº¦å›¾ï¼ˆdepthmapï¼‰çš„é˜´å½±ç”Ÿæˆæ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä¸»è¦æ€æƒ³æ˜¯ï¼šåœ¨ç¬¬ä¸€éæ¸²æŸ“åœºæ™¯æ—¶ï¼Œå°†åœºæ™¯çš„æ·±åº¦ä¿¡æ¯å­˜æ”¾åœ¨çº¹ç†å›¾ç‰‡ä¸Šï¼Œè¿™ä¸ªçº¹ç†å›¾ç‰‡ç§°ä¸ºæ·±åº¦å›¾ï¼›ç„¶ååœ¨ç¬¬äºŒæ¬¡æ¸²æŸ“åœºæ™¯æ—¶ï¼Œå°†æ·±åº¦å›¾ä¸­çš„ä¿¡æ¯<span class="math display">\[l enth_{1} \]</span>å–å‡ºï¼Œå’Œå½“å‰é¡¶ç‚¹ä¸å…‰æºçš„è·ç¦»<span class="math display">\[lenth_{2} \]</span>åšæ¯”è¾ƒï¼Œå¦‚æœ <span class="math display">\[lenth_{1} \]</span> å°äº <span class="math display">\[lenth_{2} \]</span>ï¼Œåˆ™è¯´æ˜å½“å‰é¡¶ç‚¹è¢«é®æŒ¡å¤„äºé˜´å½±åŒºï¼Œç„¶ååœ¨ç‰‡æ®µç€è‰²ç¨‹åºä¸­ï¼Œå°†è¯¥é¡¶ç‚¹è®¾ç½®ä¸ºé˜´å½±é¢œè‰²ã€‚</p><h3 id="depth-map">depth map</h3><p>æ·±åº¦å›¾æ˜¯ä¸€å¼  2D å›¾ç‰‡ï¼Œæ¯ä¸ªåƒç´ éƒ½è®°å½•äº†ä»å…‰æºåˆ°é®æŒ¡ç‰©ï¼ˆé®æŒ¡ç‰©å°±æ˜¯é˜´å½±ç”Ÿæˆç‰©ä½“ï¼‰çš„è·ç¦»ï¼Œå¹¶ä¸”è¿™äº›åƒç´ å¯¹åº”çš„é¡¶ç‚¹å¯¹äºå…‰æºè€Œè¨€æ˜¯â€œå¯è§çš„â€ã€‚</p><h2 id="å…‰çº¿æŠ•å°„ç®—æ³•">å…‰çº¿æŠ•å°„ç®—æ³•</h2><h2 id="other">Other</h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/windows/1.windows/"/>
      <url>/2022/08/10/windows/1.windows/</url>
      
        <content type="html"><![CDATA[<h2 id="windows">Windows</h2><ol type="1"><li><p><a href="https://blog.csdn.net/qq_25166683/article/details/81352868">è‡ªå®šä¹‰å³é”®èœå•</a></p></li><li><p><a href="https://www.cnblogs.com/Wayou/p/3359993.html">æ³¨å†Œè¡¨</a></p></li><li><p><a href="https://blog.csdn.net/qq_34352738/article/details/79433197">å®‰è£…msié—®é¢˜</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/29161824">C#è°ƒç”¨WindowsAPI</a></p></li><li><p>FreePic2Pdf. è½¯ä»¶ æ ¼å¼ä¸º<code>\t</code></p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/xiao-guo-shi-xian/1.2-ping-mian-yin-ying-fang-an/"/>
      <url>/2022/08/10/unity/xiao-guo-shi-xian/1.2-ping-mian-yin-ying-fang-an/</url>
      
        <content type="html"><![CDATA[<h1 id="å¹³é¢é˜´å½±å®ç°">å¹³é¢é˜´å½±å®ç°</h1><blockquote><p>æœ€è¿‘é¡¹ç›®ä¼˜åŒ–ä½ç«¯æœºçš„æ¸²æŸ“æ€§èƒ½ï¼Œå¯¹äºé˜´å½±çš„å¤„ç†ä¸€æ–¹é¢æ˜¯å…³é—­é˜´å½±ï¼Œå¦ä¸€æ–¹é¢æ˜¯ç®€åŒ–åŸæœ‰çš„Shaderé˜´å½±éƒ¨åˆ†çš„å®ç°ã€‚å°±åœ¨åˆšæ‰ç‹è€…æ‰“åä¹‹é™…ï¼Œé—²æ¥æ— äº‹å†™ä¸ªç®€åŒ–ç‰ˆé˜´å½±Shader,ã€‚</p></blockquote><p>æ€è·¯å¾ˆç®€å•ï¼šè„šä¸‹ä¸ºå¹³é¢ï¼Œè¿›è¡Œå¹³é¢æŠ•å°„ã€‚æ²¡é”™å°±æ˜¯è¿™ä¹ˆç®€å•ã€‚å› ä¸ºç®€å•æ‰€ä»¥é«˜æ•ˆã€‚</p><p><img src="imgs/design.png"></p><p>ç”±äºæ—¶åˆ»è·Ÿéšè„šä¸‹ï¼Œæ‰€ä»¥é‡è§éå¹³é¢ä¼šé•¶åµŒé‡Œé¢æˆ–è€…ä¼¸å‡ºã€‚ä½†è¿™å¹¶ä¸å½±å“ï¼Œä¸»è¦ç›®çš„æ˜¯ä½ç«¯æœºçš„æ›¿ä»£å“ã€‚</p><p>å¦‚æœå¸®åŠ©åˆ°ä½ ï¼Œå®å±è£å¹¸ã€‚å¦‚æœä½ æœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼ˆä¸»è¦å…¼é¡¾æ€§èƒ½ï¼Œå…¶æ¬¡è¡¨ç°ï¼‰æ¬¢è¿ç•™è¨€è®¨è®ºã€‚</p><p>æœ€åé™„ä¸Šæ•ˆæœå›¾ å’Œ å…¨éƒ¨ä»£ç ï¼Œä»£ç çš„æ¸²æŸ“pass è‡ªå·±å®ç°ï¼Œé˜´å½±éƒ¨åˆ†å¯ä»¥å¤åˆ¶ä»£ç ï¼Œæˆ–è€…usepass ã€‚</p><p>æ—¶å€™ä¸æ—©äº†, ç¡è§‰ï¼Œ æ—©å®‰å„ä½ï¼</p><p><img src="imgs/result0.png"></p><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Shader <span class="st">"Shadows/LowPassShadow"</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    Properties</span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        _ShadowOffset<span class="op">(</span><span class="st">"ShadowOffset"</span><span class="op">,</span> vector<span class="op">)</span> <span class="op">=</span> <span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        _ShadowColor<span class="op">(</span><span class="st">"ShadowColor"</span><span class="op">,</span> Color<span class="op">)</span> <span class="op">=</span> <span class="op">(</span><span class="fl">0.3</span><span class="op">,</span> <span class="fl">0.3</span><span class="op">,</span> <span class="fl">0.3</span><span class="op">,</span> <span class="dv">1</span><span class="op">)</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">[</span>Enum<span class="op">(</span>UnityEngine<span class="op">.</span>Rendering<span class="op">.</span>BlendMode<span class="op">)]</span> _SrcBlend<span class="op">(</span><span class="st">"Src Blend Mode"</span><span class="op">,</span> Float<span class="op">)</span> <span class="op">=</span> <span class="dv">1</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">[</span>Enum<span class="op">(</span>UnityEngine<span class="op">.</span>Rendering<span class="op">.</span>BlendMode<span class="op">)]</span> _DstBlend<span class="op">(</span><span class="st">"Dst Blend Mode"</span><span class="op">,</span> Float<span class="op">)</span> <span class="op">=</span> <span class="dv">10</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    SubShader</span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        Tags <span class="op">{</span> <span class="st">"RenderType"</span><span class="op">=</span><span class="st">"Opaque"</span> <span class="op">}</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        LOD <span class="dv">100</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">//ç®€å•é˜´å½±Pass</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        Pass</span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            Name <span class="st">"SampleShadow"</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>            Tags<span class="op">{</span><span class="st">"LightMode"</span> <span class="op">=</span> <span class="st">"ForwardBase"</span><span class="op">}</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>            ZWrite off</span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            <span class="co">//Blend Srcalpha OneminusSrcAlpha</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>            Blend <span class="op">[</span>_SrcBlend<span class="op">]</span> <span class="op">[</span>_DstBlend<span class="op">]</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            CGPROGRAM</span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma vertex vert</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma fragment frag</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#include </span><span class="im">"UnityCG.cginc"</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#include </span><span class="im">"Lighting.cginc"</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma shader_feature _Off_Shadow</span></span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>            float3 _ShadowOffset<span class="op">;</span></span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>            float4 _ShadowColor <span class="op">=</span> float4<span class="op">(</span><span class="fl">0.3</span><span class="op">,</span> <span class="fl">0.3</span><span class="op">,</span> <span class="fl">0.3</span><span class="op">,</span> <span class="fl">0.5</span><span class="op">);</span></span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>            <span class="dt">const</span> float4 farPosition <span class="op">=</span> float4<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>            float4 vert<span class="op">(</span>float4 vertex<span class="op">:</span>POSITION<span class="op">):</span>SV_POSITION</span><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>                float3 light2ObjectDirection <span class="op">=</span> UnityWorldSpaceLightDir<span class="op">(</span>vertex<span class="op">);</span></span><span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>                </span><span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>                <span class="co">// è‡ªå·±æ§åˆ¶å…‰çº¿ä¸è¦å‡ºç°ä»°è§’</span></span><span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>                <span class="co">/*</span></span><span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co">                if (light2ObjectDirection.y &lt;= 0.4)</span></span><span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co">                {</span></span><span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co">                    return farPosition;</span></span><span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co">                }</span></span><span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co">                */</span></span><span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>                float3 objectWorldPosition <span class="op">=</span> mul<span class="op">(</span>unity_ObjectToWorld<span class="op">,</span> vertex<span class="op">);</span></span><span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>                float3 objectButtomWorldPosition <span class="op">=</span> mul<span class="op">(</span>unity_ObjectToWorld<span class="op">,</span> float4<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> vertex<span class="op">.</span>w<span class="op">));</span></span><span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>                float3 outPosition <span class="op">=</span> objectWorldPosition <span class="op">+</span> <span class="op">(</span>objectWorldPosition <span class="op">-</span> objectButtomWorldPosition<span class="op">).</span>y <span class="op">/</span> <span class="op">(-</span>light2ObjectDirection<span class="op">.</span>y<span class="op">)</span> <span class="op">*</span> light2ObjectDirection<span class="op">;</span></span><span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef _Off_Shadow  </span></span><span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> farPosition<span class="op">;</span></span><span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span><span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> mul<span class="op">(</span>UNITY_MATRIX_VP<span class="op">,</span> float4<span class="op">(</span>outPosition <span class="op">-</span> _ShadowOffset<span class="op">,</span> <span class="fl">1.0</span><span class="op">));</span></span><span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span><span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>            float4 frag<span class="op">(</span>float4 position<span class="op">:</span> SV_POSITION<span class="op">)</span> <span class="op">:</span>COLOR</span><span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> _ShadowColor<span class="op">;</span></span><span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>            ENDCG</span><span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/xiao-guo-shi-xian/1.1-yin-ying-shi-xian-fang-an/"/>
      <url>/2022/08/10/unity/xiao-guo-shi-xian/1.1-yin-ying-shi-xian-fang-an/</url>
      
        <content type="html"><![CDATA[<h1 id="é˜´å½±å®ç°ç®—æ³•">é˜´å½±å®ç°ç®—æ³•</h1><p><a href="https://zhuanlan.zhihu.com/p/104687855">https://zhuanlan.zhihu.com/p/104687855</a><a href="https://blog.csdn.net/weixin_39845825/article/details/111340354">https://blog.csdn.net/weixin_39845825/article/details/111340354</a></p><p><a href="https://blog.csdn.net/pizi0475/article/details/7934712">https://blog.csdn.net/pizi0475/article/details/7934712</a></p><h2 id="ä¸€å‚ç›´æ‹‰é•¿ç”Ÿæˆé¢meshé˜´å½±">ä¸€ã€å‚ç›´æ‹‰é•¿ç”Ÿæˆé¢Meshé˜´å½±</h2><ul><li>[ x ] å¹³é¢é˜´å½±æ–¹æ¡ˆ ## äºŒã€å¸¸è§„Shadowmap</li></ul><h2 id="ä¸‰pcf">ä¸‰ã€PCF</h2><h2 id="å››csm">å››ã€CSM</h2><h2 id="äº”vsm">äº”ã€VSM</h2><h2 id="å…­esm">å…­ã€ESM</h2><h2 id="ä¸ƒpcss">ä¸ƒã€PCSS</h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/xiao-guo-shi-xian/0.yu-ye-xiao-guo/"/>
      <url>/2022/08/10/unity/xiao-guo-shi-xian/0.yu-ye-xiao-guo/</url>
      
        <content type="html"><![CDATA[<h1 id="é›¨å¤œæ•ˆæœ">é›¨å¤œæ•ˆæœ</h1><h2 id="ç‰¹ç—‡">ç‰¹ç—‡</h2><ol type="1"><li>é•¿é•¿çš„é«˜å…‰åå°„ã€‚ ä¸é™äºå¤œæ™šï¼Œæ½®æ¹¿çš„è¡¨é¢ä¹Ÿä¼šå‡ºç°ã€‚</li><li>é«˜å…‰åå°„æ ¹æ®è¡¨é¢ç²—ç³™åº¦ï¼Œå‘ˆç°å‡ºå¤šæ ·æ€§ã€‚ï¼ˆè¶Šç²—ç³™è¶Šæš—ï¼‰ã€‚</li><li>é«˜å…‰å¤§å°ä¾èµ–äºè§†è§’ã€‚å„å‘å¼‚æ€§åå°„ä¼¼ä¹éµå¾ªBlinn-Phongè¡Œä¸º(åŒæ—¶Blinn-Phongæ¨¡å‹ä¸å…è®¸æ‹‰ä¼¸å¤ªå¤š):ï¼Œç„¶è€Œï¼Œå½“è¡¨é¢æ˜¯å…‰æ»‘çš„ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå®Œç¾çš„åå°„(å·¦)ï¼Œæ— è®ºè·ç¦»ï¼Œéµå¾ªPhongè¡Œä¸º</li><li>åå°„æ¨¡ç³Šåº¦å–å†³äºè§†è§’ã€å…‰çº¿è§’åº¦ã€æŠ˜å°„ç‡(å³é•œé¢)ã€è¡¨é¢ç²—ç³™åº¦å’Œè·ç¦»å…‰æºçš„è·ç¦»(ä½†ä»…åœ¨ç²—ç³™è¡¨é¢çš„æƒ…å†µä¸‹ï¼Œå¯¹äºå…‰æ»‘è¡¨é¢çš„æ¨¡ç³Šåº¦ä¸å˜åŒ–):</li><li>ï¼šä¸ä»…æ˜äº®çš„å…‰æºä¼šè¢«åå°„ï¼Œæ‰€æœ‰çš„ä¸œè¥¿éƒ½ä¼šè¢«åå°„ï¼Œå³ä½¿åœ¨å¤œæ™šåå°„ä¹Ÿæ˜¯æœ‰é¢œè‰²çš„(é€šå¸¸é»‘æš—çš„åœ°æ–¹é¿å…çœ‹åˆ°å½©è‰²çš„åå°„ï¼Œå› ä¸ºæ²¡æœ‰è¶³å¤Ÿçš„åå°„å…‰):</li><li>æ°´ä¼šåœ¨å †ç§¯åœ¨æ·±å¤„ã€‚å½“æœ‰è¶³å¤Ÿçš„æ°´ç§¯ç´¯ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€å±‚è–„çš„æ°´æˆ–ä¸€ä¸ªæ·±çš„æ°´å‘è¡¨ç°å‡ºåŒå±‚è¡Œä¸ºã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ°´å±‚å’Œä¸‹é¢çš„è¡¨å±‚:</li><li>æ°´å±‚çš„åå°„éµå¾ªè²æ¶…è€³å®šå¾‹ã€‚è¿™æ„å‘³ç€ä½ åœ¨æ å°„è§’åº¦(0Â°)æœ‰å…¨åå°„ï¼Œè€Œåœ¨å‚ç›´äºè¡¨é¢(90Â°)æ—¶æœ‰ä½åå°„(äº‹å®ä¸Šæ¯ä¸ªè¡¨é¢éƒ½æœ‰è²æ¶…å°”åå°„ï¼Œä½†è¿™åœ¨æ°´çš„æƒ…å†µä¸‹æ›´æ˜æ˜¾):</li><li>æ½®æ¹¿è¡¨é¢æ•´ä½“å˜æš—ï¼Œé•œé¢æ›´æ˜äº®</li></ol><p><img src="/imgs/rainnight.jpg"></p><h2 id="å®ç°æ½®æ¹¿çš„åœ°è¡¨">å®ç°æ½®æ¹¿çš„åœ°è¡¨</h2><p>ä¸»è¦åˆ†ä¸º: * å¹²ç‡¥çš„åŒºåŸŸ *æ½®æ¹¿ï¼Œä½†æ˜¯æ²¡æœ‰ç§¯æ°´çš„åŒºåŸŸï¼Œ<strong>å»ºè®®åå°„ç³»æ•°ä¸º5~10ï¼Œ æ¼«åå°„Spencular0.1~0.3</strong> * æœ‰ç§¯æ°´ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å½¢æˆæ°´å‘ï¼Œæˆ–è€…åœ¨æ°´å‘è¾¹ç¼˜çš„åŒºåŸŸã€‚ *æ°´å‘åŒºåŸŸ</p><p>æ½®æ¹¿ä½†æ²¡æœ‰ç§¯æ°´çš„åœ°é¢ï¼Œ åœ°é¢å˜æš—ï¼Œ é•œé¢åå°„æ›´æ˜äº®ï¼Œé«˜å…‰å‡èšæ›´é«˜ã€‚è®¾å®šWetLevelï¼š 0 ä¸ºå¹²ç‡¥ï¼Œ 1 ä¸ºæ¹¿æ¶¦ï¼Œ é€šè¿‡æ½®æ¹¿æˆéƒ½ WetLevel æ¥æ§åˆ¶ glossé«˜å…‰å‚æ•°ï¼Œ å‹æš— diffuse é¢œè‰²ã€‚</p><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> DoWetShading<span class="op">(</span>inout float3 albedo<span class="op">,</span> inout <span class="dt">float</span> gloss<span class="op">,</span> <span class="dt">float</span> wetLevel<span class="op">)</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// è¶Šæ½®æ¹¿ï¼Œåœ°é¢è¶Šæš—</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        albedo <span class="op">*=</span> lerp<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.3</span><span class="op">,</span> wetLevel<span class="op">);</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        gloss <span class="op">=</span> min<span class="op">(</span>gloss <span class="op">*</span> lerp<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">2.5</span><span class="op">,</span> wetLevel<span class="op">),</span> <span class="fl">1.0</span><span class="op">)</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><p>å†åŠ ä¸Šä¸€ä¸ªMaskè´´å›¾ï¼Œ è¡¨ç¤ºæ°´å‘çš„æ·±åº¦å’Œå¤§å°ã€‚ å†åŠ ä¸Šç¯å¢ƒåå°„å’Œè²å°¼å°”åå°„ã€‚</p><h2 id="è²å°¼å°”åå°„">è²å°¼å°”åå°„</h2><blockquote><p>å½“å…‰åˆ°è¾¾ä»‹è´¨è¡¨é¢ï¼Œä¸€éƒ¨åˆ†å…‰åå°„ï¼Œä¸€éƒ¨åˆ†å…‰æŠ˜å°„ï¼Œå½“è§†çº¿å‚ç›´äºè¡¨é¢ï¼Œåå°„ä¼šå˜å¾—éå¸¸å¼±ï¼Œå½“è§†çº¿æ¥è¿‘å¹³è¡Œäºä»‹è´¨è¡¨é¢ï¼Œåå°„ä¼šå˜å¾—éå¸¸å¼ºã€‚æ¯”å¦‚åœ¨æ¹–è¾¹ï¼Œä½ è¿œè¿œçœ‹å»ï¼Œæ¹–é¢æ³¢å…‰ç²¼ç²¼ï¼Œä½å¤´ç›´è§†æ¹–é¢ï¼Œå°±æ¸…æ¾ˆè§åº•ã€‚æˆ‘ä»¬å¸¸ç”¨çš„æ˜¯è²æ¶…å°”çš„è¿‘ä¼¼å…¬å¼ï¼š</p></blockquote><p><span class="math display">\[    F_{Schlick}(n, v, F_0) = F_0 + (1 - F_0)(1 - (n*v))^5  \]</span></p><p>å…¶ä¸­F(0)è¡¨ç¤ºå½“å…‰çº¤å‚ç›´ï¼Œ 0åº¦è§’æ‘„å…¥ä»‹è´¨çš„åŸºç¡€åå°„ç‡ã€å¸¸è§çš„è²å°¼å°” F0åå°„ç‡ï¼š <img src="/imgs/feinier.jpg"></p><p>è®¾ç½®ä¸€ä¸ªç§¯æ°´ç³»æ•° **_AccumulateWater**. è®¾BrickF0 ä¸ºåœ°é¢çš„F0å€¼ï¼Œ 0.02ä¸ºè°çš„F0 å€¼ã€‚</p><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> f0 <span class="op">=</span> lerp<span class="op">(</span>_BrickF0<span class="op">,</span> <span class="fl">0.02</span><span class="op">,</span> _AccumulateWater<span class="op">);</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> frensel <span class="op">=</span> f0 <span class="op">+</span> <span class="op">(</span><span class="dv">1</span><span class="op">-</span> f0<span class="op">)*</span>pow<span class="op">((</span> <span class="dv">1</span><span class="op">-</span> dotNV<span class="op">),</span> <span class="dv">5</span><span class="op">);</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    float3 specular <span class="op">=</span> frensel <span class="op">*</span> <span class="op">((</span>specularPower <span class="op">+</span><span class="fl">2.0</span><span class="op">)/</span> <span class="fl">8.0</span><span class="op">)</span> <span class="op">*</span> pow<span class="op">(</span>dotNH<span class="op">,</span> specularPower<span class="op">)*</span> dotNL<span class="op">;</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    float3 reflection <span class="op">=</span> reflect<span class="op">(</span>viewDir<span class="op">,</span> normal<span class="op">);</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    float3 reflCol <span class="op">=</span> texCUBE<span class="op">(</span>_CubeMap<span class="op">,</span> reflection<span class="op">)</span> <span class="op">*</span> glossParam<span class="op">;</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    float3 ambient <span class="op">=</span> saturate<span class="op">(</span>_ReflectFactor <span class="op">+</span>frensel<span class="op">)</span> <span class="op">*</span> reflCol<span class="op">;</span></span></code></pre></div><h2 id="åœ°è¡¨ç¡çœ æ¶Ÿæ¼ª">åœ°è¡¨ç¡çœ æ¶Ÿæ¼ª</h2><blockquote><p>å¤§éƒ¨åˆ†æ¸¸æˆä½¿ç”¨ä¸€ä¸ªåŠ¨æ€çš„rippleæ³•çº¿è´´å›¾æ¥å®ç°è¿™ä¸ªæ•ˆæœã€‚æ¯å¸§ç”Ÿæˆä¸€ä¸ªæ–°çš„ripple æ³•çº¿è´´å›¾ã€‚â€‹ç”Ÿæˆæ³¢çº¹æ¯”è¾ƒç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨åŠ¨ç”»çº¹ç†ï¼Œç¼ºç‚¹å°±æ˜¯æ˜¾ç¤ºå½¢å¼æ¯”è¾ƒå›ºå®šã€‚æœ¬æ–‡é€‰æ‹©ç¨‹åºåŒ–çº¹ç†æ–¹å¼æ¥å®ç°ã€‚ä»è€Œé¿å…æ˜¾ç¤ºé‡å¤å’Œæ¯”ç‰©ç†æ¨¡æ‹Ÿæˆæœ¬æ›´ä½ã€‚</p></blockquote><p>æˆ‘ä»¬ä»çº¹ç†ä¸­ç”Ÿæˆä¸ä¸€æ ·å¤§å°çš„åŠ¨ç”»åœ†å½¢æ³¢çº¹ã€‚æ–‡ç« é‡Œçš„ç®—æ³•ä¼šç”Ÿæˆä¸åŒå¤§å°çš„åœ†åœˆï¼Œç”¨äº†ä¸€å¼ å¾ˆç‰¹æ®Šçš„çº¹ç†æ¥ç”Ÿæˆä¸ä¸€æ ·å¤§å°çš„åœ†å½¢æ¶Ÿæ¼ªã€‚</p><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>float3 ComputeRipple<span class="op">(</span>float2 uv<span class="op">,</span> <span class="dt">float</span> currentTime<span class="op">,</span> <span class="dt">float</span> weight<span class="op">)</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    float4 ripple <span class="op">=</span> tex2D<span class="op">(</span>_MainTex<span class="op">,</span>uv<span class="op">);</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//gb é€šé“ä»[0,1]å˜æˆ[-1,1]</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    ripple<span class="op">.</span>yz <span class="op">=</span> ripple<span class="op">.</span>yz <span class="op">*</span> <span class="fl">2.0</span> <span class="op">-</span> <span class="fl">1.0</span><span class="op">;</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//rippleTexçš„wé€šé“ï¼ˆAlphaé€šé“ï¼‰åœ†åœˆå¤–é¢éƒ½æ˜¯0</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">//åŠ ä¸Šæ—¶é—´åç§»ã€‚dropFrac é™åˆ¶åœ¨[0,1)</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> dropFrac <span class="op">=</span> frac<span class="op">(</span>ripple<span class="op">.</span>w <span class="op">+</span>currentTime<span class="op">);</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">//timeFracé™åˆ¶åœ¨[-1,1],dropFrac - 1.0,å¯ä»¥ç¡®ä¿åœ†åœˆçš„å¤–é¢(ripple.x=0),timeFrac&lt;=0.</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ä»è€Œæ³¢çº¹å¤–é¢çš„æ³•çº¿æ˜¯å‚ç›´çš„ã€‚ä¹Ÿå°±æ˜¯æ°´å¹³çš„ã€‚</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> timeFrac <span class="op">=</span> dropFrac <span class="op">-</span> <span class="fl">1.0</span> <span class="op">+</span> ripple<span class="op">.</span>x<span class="op">;</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// æ³¢çº¹éšç€æ—¶é—´æ‰©å¤§(dropFrac å˜å¤§)ï¼ŒdropFatorè¶Šå°ï¼Œæ³¢çº¹æ…¢æ…¢å˜å¹³</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> dropFator <span class="op">=</span> saturate<span class="op">(</span><span class="fl">0.2</span> <span class="op">+</span> weight <span class="op">*</span> <span class="fl">0.8</span> <span class="op">-</span> dropFrac<span class="op">);</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ä»æ³¢çº¹å‡ºç°å¼€å§‹ï¼Œæ—¶é—´è¶Šå¤§(dropFrac å˜å¤§)ï¼ŒdropFator è¶Šå°ï¼Œfinal è¶Šå°ï¼Œæ³¢çº¹è¶Šå¹³ã€‚</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">//sin(clamp(timeFrac * 9.0,0.0,3.0)PI)ï¼š0-3PIä¹‹é—´ï¼Œsinå°±æ˜¯ä¸€ä¸ªæ³¢å³°-æ³¢è°·-æ³¢å³°çš„å‡½æ•°å›¾åƒï¼Œ</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">//åœ¨0-3*PIä¹‹å¤–sinå‡½æ•°çš†ä¸º0.9.0æ˜¯ä¸€ä¸ªæŠŠtimeFracå‚æ•°æ”¾å¤§çš„å› å­ã€‚</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">//æ³¢çº¹åœˆå†…çš„å€¼ï¼Œæ¯”å¦‚æ³¢çº¹ä¸­å¿ƒå€¼ï¼Œç»è¿‡sinå‡½æ•°çš„è®¡ç®—ï¼Œå˜æˆ0.ä¹Ÿå°±æ˜¯è¯´æ³¢çº¹ä¸­å¿ƒç‚¹ä¹Ÿæ˜¯å¹³çš„ã€‚è¿™ä¸ªå¹³çš„åŒºåŸŸï¼Œ</span></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">// éšç€æ—¶é—´å˜å¤§ï¼Œæ…¢æ…¢æ‰©å¤§ï¼Œï¼ˆæ—¶é—´è¶Šå¤§ï¼Œåªæœ‰çº¢è‰²é€šé“éƒ¨åˆ†è¶Šå°çš„åœ°æ–¹(çº¢è‰²é€šé“ripple.xæ¸å˜åˆ°0)ï¼Œ</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">//sinå‡½æ•°æ‰ä¸ä¸º0.æ‰€æœ‰æ³¢çº¹å°±ä¼šæœ‰æ…¢æ…¢å˜å¤§çš„æ•ˆæœ</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> final <span class="op">=</span> dropFator <span class="op">*</span> ripple<span class="op">.</span>x <span class="op">*</span> sin<span class="op">(</span>clamp<span class="op">(</span>timeFrac <span class="op">*</span> <span class="fl">9.0</span><span class="op">,</span><span class="fl">0.0</span><span class="op">,</span><span class="fl">3.0</span><span class="op">)*</span>PI<span class="op">);</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> float3<span class="op">(</span>ripple<span class="op">.</span>yz <span class="op">*</span> final <span class="op">*</span> <span class="fl">0.35</span><span class="op">,</span><span class="fl">1.0</span><span class="op">);</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><p>è¾“å‡ºå‘ç°ç‰¹å›¾</p><div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> float4<span class="op">(</span>normalize<span class="op">(</span>N<span class="op">)</span> <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span> </span></code></pre></div><h2 id="æ¶Ÿæ¼ªæ³•çº¿è´´å›¾å’Œåœ°é¢æ··åˆ">æ¶Ÿæ¼ªæ³•çº¿è´´å›¾å’Œåœ°é¢æ··åˆ</h2><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç”Ÿæˆçš„æ¶Ÿæ¼ªæ³•çº¿å’Œåœ°è¡¨åŸæœ¬çš„æ³•çº¿åšä¸€æ¬¡çº¿æ€§æ’å€¼ã€‚</p><div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ripple tex</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>            float3 rippleNormal <span class="op">=</span> tex2D<span class="op">(</span>_RippleTex<span class="op">,</span>i<span class="op">.</span>uv <span class="op">*</span> _RippleDensity<span class="op">).</span>xyz <span class="op">*</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>            float3 wRippleNormal <span class="op">=</span> normalize<span class="op">(</span>mul<span class="op">(</span>matToW<span class="op">,</span>rippleNormal<span class="op">));</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>            float3 normal <span class="op">=</span> lerp<span class="op">(</span>wNormal<span class="op">,</span>wRippleNormal<span class="op">,</span>_AccumulateWater<span class="op">);</span></span></code></pre></div><h2 id="å‡¹å‡¸é—´éš™ç§¯æ°´">å‡¹å‡¸é—´éš™ç§¯æ°´</h2><p>â€‹ä¸ºäº†æ¨¡æ‹Ÿå‡ºåœ¨åœ°è¡¨å‡¹å‡¸é—´éš™çš„æ°´ç§¯ç´¯æ•ˆæœï¼Œæ–‡ç« ç”¨é«˜åº¦å›¾è¡¨ç°ç –ç¼çš„é«˜åº¦å˜åŒ–ï¼Œç”¨é¡¶ç‚¹é¢œè‰²è¡¨ç°æ°´å‘æ·±åº¦ï¼ˆè¿™é‡Œæˆ‘ä»¬ç”¨maskå›¾æ¥æ§åˆ¶æ°´å‘çš„æ·±åº¦ï¼‰ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/cha-jian-gou-jian/1.bian-yi-android-cha-jian/"/>
      <url>/2022/08/10/unity/cha-jian-gou-jian/1.bian-yi-android-cha-jian/</url>
      
        <content type="html"><![CDATA[<h2 id="unityæ„å»ºandroidæ’ä»¶">Unityæ„å»ºAndroidæ’ä»¶</h2><ol type="1"><li><a href="https://blog.csdn.net/zp288105109a/article/details/81569079">AARåŒ…æ„å»º</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/unity-xuan-ran-tan-jiu/1.unity-yin-ying-tan-jiu/"/>
      <url>/2022/08/10/unity/unity-xuan-ran-tan-jiu/1.unity-yin-ying-tan-jiu/</url>
      
        <content type="html"><![CDATA[<h1 id="é˜´å½±æ¢ç©¶">é˜´å½±æ¢ç©¶</h1>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/unitysrp/5.api/"/>
      <url>/2022/08/10/unity/unitysrp/5.api/</url>
      
        <content type="html"><![CDATA[<h1 id="api-å­¦ä¹ è®°å½•">API å­¦ä¹ è®°å½•</h1><h2 id="ä¸€æ¸²æŸ“ç®¡çº¿">ä¸€ã€æ¸²æŸ“ç®¡çº¿</h2><h3 id="renderpipelineasset">1. RenderPipelineAsset</h3><blockquote><p>namespace UnityEngine.Rendering</p></blockquote><blockquote><p>ç”¨æ¥åˆ›å»ºç‰¹æ®Šçš„<code>IRenderPipeline</code> èµ„æºç±»å‹ã€‚é»˜è®¤ç»§æ‰¿è‡ª<code>IRenderPipelineAsset</code>. ç®¡ç†æ­¤èµ„æºç±»å‹çš„ç”Ÿå‘½å‘¨æœŸ,ä¹Ÿå¯ä»¥ç”¨æ¥ç®¡ç†åˆ›å»ºä»¥åŠä¿®æ”¹çš„äº‹ä»¶ç­‰ã€‚</p></blockquote><ul><li><p>æŠ½è±¡æ–¹æ³•<code>protected abstract RenderPipeline CreatePipeline()</code>,ç”¨æ¥åˆ›å»º <code>IRenderPipeline</code> å¯¹è±¡ã€‚</p></li><li><p>å…¶ä»–é»˜è®¤Shader å’Œæè´¨ã€‚</p></li></ul><h3 id="renderpipeline">2. RenderPipeline</h3><blockquote><p>namespace UnityEngine.Rendering</p></blockquote><blockquote><p>å®šä¹‰ä¸€ç³»åˆ—å‘½ä»¤ï¼Œç”¨æ¥è®¾ç½®ä¸€å¸§çš„æ¸²æŸ“.é»˜è®¤ç»§æ‰¿è‡ª<code>IRenderPipelineAsset</code>. ç®¡ç†æ­¤èµ„æºç±»å‹çš„ç”Ÿå‘½å‘¨æœŸ,ä¹Ÿå¯ä»¥ç”¨æ¥ç®¡ç†åˆ›å»ºä»¥åŠä¿®æ”¹çš„äº‹ä»¶ç­‰ã€‚</p></blockquote><ul><li><p>æ¸²æŸ“å›è°ƒå‡½æ•°ã€‚ protected override voidRender(ScriptableRenderContext context, Camera[] cameras)ã€‚è‡ªå®šä¹‰æ¸²æŸ“å…¥å£å‡½æ•°ã€‚</p></li><li><p>void ProcessRenderRequests(ScriptableRenderContext context,Camera camera, List&lt;Camera.RenderRequest&gt; renderRequests)</p></li></ul><h3 id="scriptablerendercontext">3. ScriptableRenderContext</h3><blockquote><p>å®šä¹‰è‡ªå®šä¹‰æ¸²æŸ“ç®¡çº¿ä½¿ç”¨çš„çŠ¶æ€å’Œç»˜åˆ¶å‘½ä»¤ã€‚</p></blockquote><ul><li><p>BeginRenderPass<br>å¼€å§‹æ‰§è¡Œä¸€ä¸ªæ–°çš„æ¸²æŸ“é€šé“ã€‚<strong>ä»»ä½•æ—¶å€™åªèƒ½æ¿€æ´»ä¸€ä¸ªæ¸²æŸ“é€šé“ã€‚</strong></p></li><li><p>BeginScopedRenderPass ä½¿ç”¨ <code>Using</code> è¯­æ³•åŒ…è£¹, ä»£æ›¿å†å†™EndRenderPassã€‚<strong>ä»»ä½•æ—¶å€™åªèƒ½æ¿€æ´»ä¸€ä¸ªæ¸²æŸ“é€šé“ã€‚</strong></p></li><li><p>BeginScopedSubPass<br>åœ¨ä¸€ä¸ªRenderPass ä¸‹ è°ƒç”¨ä¸€ä¸ªæ–°çš„<code>å­</code>Passã€‚ ä½¿ç”¨<code>Using</code> è¯­æ³•åŒ…è£¹, ä»£æ›¿å†å†™EndRenderSubPassã€‚<strong>ä»»ä½•æ—¶å€™åªèƒ½æ¿€æ´»ä¸€ä¸ª<code>å­</code>æ¸²æŸ“é€šé“ã€‚</strong></p></li><li><p>BeginSubPass<br>å¼€å§‹æ‰§è¡Œä¸€ä¸ªæ–°çš„å­æ¸²æŸ“é€šé“ã€‚<strong>ä»»ä½•æ—¶å€™åªèƒ½æ¿€æ´»ä¸€ä¸ªå­æ¸²æŸ“é€šé“ã€‚</strong></p></li><li><p>Cull<br>æ ¹æ®<code>ScriptableCullingParameters</code>æ‰§è¡Œç­›é€‰ï¼Œè¿™äº›å‚æ•°é€šå¸¸æ˜¯ä»å½“å‰æ¸²æŸ“çš„æ‘„åƒæœºä¸­è·å¾—çš„ã€‚<code>Camera.TryGetCullingParameters</code></p></li><li><p>DrawGizmos<br>Schedules the drawing of a subset of Gizmos (before or afterpost-processing) for the given Camera. åœ¨åå¤„ç†å‰æˆ–è€…åå¤„ç†åæ‰§è¡Œç›¸æœºç»˜åˆ¶ Gizmoså­é›†åˆã€‚ 'PreImageEffects, PostImageEffects'</p></li><li><p>DrawRenderersæ‰§è¡Œç»˜åˆ¶ä¸€ç»„å¯è§å¯¹è±¡ï¼Œå¹¶å¯é€‰æ‹©é‡å†™GPUçš„æ¸²æŸ“çŠ¶æ€</p></li><li><p>DrawShadows<br>æ‰§è¡Œä¸ºä¸€ä¸ªå…‰æºç»˜åˆ¶é˜´å½±æŠ•å°„ã€‚</p></li><li><p>DrawSkybox<br>ç»˜åˆ¶ skybox</p></li><li><p>DrawUIOverlay ç»˜åˆ¶ UI overlay.</p></li><li><p>DrawWireOverlay<br>ä½¿ç”¨ Scene View Camer ç»˜åˆ¶ <code>wireframe overlay</code></p></li><li><p>EndRenderPass Schedules the end of a currently active renderpass.</p></li><li><p>EndSubPass<br>ç»“æŸå½“å‰æ¿€æ´»çš„ subpass</p></li><li><p>ExecuteCommandBuffer<br>æ‰§è¡Œè‡ªå®šä¹‰æ¸²æŸ“çš„ commandbuffer</p></li><li><p>ExecuteCommandBufferAsync å¼‚æ­¥æ‰§è¡Œè‡ªå®šä¹‰çš„æ¸²æŸ“ commandbufferï¼Œé˜Ÿåˆ—é¡ºåºç”±<code>ComputeQueueType</code>å†³å®šã€‚</p></li><li><p>InvokeOnRenderObjectCallback<br>æ‰§è¡Œ<code>Monobehaviour</code>è„šæœ¬çš„ <code>OnRenderObject</code>å›è°ƒå‡½æ•°ã€‚</p></li><li><p>SetupCameraProperties å°†ç›¸æœºçš„å‚æ•°è®¾ç½®åˆ°Shaderçš„å…¨å±€å‚æ•°ã€‚</p></li><li><p>StartMultiEye Schedules a fine-grained beginning of stereorendering on the ScriptableRenderContext.</p></li><li><p>StereoEndRender<br>Schedule notification of completion of stereo rendering on a singleframe.</p></li><li><p>StopMultiEye<br>Schedules a stop of stereo rendering on theScriptableRenderContext.</p></li><li><p>Submit<br>æäº¤æ‰€æœ‰ç»˜åˆ¶å‘½ä»¤</p></li><li><p>EmitGeometryForCamera Emits UI geometry for rendering for thespecified camera.</p></li><li><p>EmitWorldGeometryForSceneView Emits UI geometry into the Sceneview for rendering.</p></li></ul><h2 id="äºŒæ¸²æŸ“">äºŒã€æ¸²æŸ“</h2><h3 id="åŸºç¡€è®¾ç½®">1. åŸºç¡€è®¾ç½®</h3><pre><code>    // è£å‰ªå‚æ•°    if (!camera.TryGetCullingParameters(out var cullingParameters)) return;    //é‡æ–°è®¾ç½®    // è£å‰ªå‚æ•°    CullingResults cullingResults = context.Cull(ref cullingParameters);    // è®¾ç½®ç›¸æœºå‚æ•° åˆ°Shader å…¨å±€å˜é‡ã€‚    context.SetupCameraProperties(camera);    //å…‰ç…§ é˜´å½±ã€‚    //</code></pre><ul><li>ScriptableCullingParameters è£å‰ªå‚æ•°ã€‚</li><li>CullingResults è£å‰ªResultså‚æ•°ã€‚</li></ul><h3 id="ç»˜åˆ¶">2. ç»˜åˆ¶</h3><ul><li><p>public void DrawRenderers(Rendering.CullingResultscullingResults, ref Rendering.DrawingSettings drawingSettings, refRendering.FilteringSettings filteringSettings);</p></li><li><p>public void DrawRenderers(Rendering.CullingResultscullingResults, ref Rendering.DrawingSettings drawingSettings, refRendering.FilteringSettings filteringSettings, refRendering.RenderStateBlock stateBlock);</p></li><li><p>public void DrawRenderers(Rendering.CullingResultscullingResults, ref Rendering.DrawingSettings drawingSettings, refRendering.FilteringSettings filteringSettings, NativeArray<shadertagid>renderTypes, NativeArray<renderstateblock> stateBlocks);</renderstateblock></shadertagid></p></li></ul><blockquote><p>ç»˜åˆ¶å­å¯¹è±¡é›†åˆã€‚</p></blockquote><blockquote><p>cullingResults è£å‰ªå‰”é™¤åçš„å¯è§å¯¹è±¡ã€‚ drawingSettingsè®¾ç½®å¦‚ä½•ç»˜åˆ¶ç‰©ä½“ filteringSettingsæŒ‡å®šæ¸²æŸ“ç®¡é“åº”è¯¥å¦‚ä½•è¿›ä¸€æ­¥è¿‡æ»¤åœºæ™¯ä¸­çš„æ¸²æŸ“å™¨ã€‚ stateBlock é‡å®šä¹‰æ¸²æŸ“çŠ¶æ€renderTypes é€‰æ‹©æ¸²æŸ“çš„RenderType é›†åˆ stateBlocks é‡å®šä¹‰æ¸²æŸ“çŠ¶æ€é›†åˆ</p></blockquote><ul><li>DrawingSettings<ul><li>ShaderTagId</li><li>SortingSettings</li></ul></li><li>SortingCriteria<ul><li>SortingLayer é€šè¿‡<code>sorting layer</code> æ’åº.</li><li>RenderQueue é€šè¿‡<code>render queue</code> æ’åº.</li><li>BackToFront é€šè¿‡<code>ä»åå¾€å‰</code> æ’åº</li><li>QuantizedFrontToBack é€šè¿‡<code>ä»å‰å¾€å</code> æ’åº.</li><li>OptimizeStateChanges å¯¹å¯¹è±¡è¿›è¡Œæ’åºä»¥å‡å°‘ç»˜åˆ¶çŠ¶æ€çš„å˜åŒ–.</li><li>CanvasOrder é€šè¿‡Canvasé¡ºåºæ’åºæ¸²æŸ“å™¨.</li><li>RendererPriority é€šè¿‡<code>renderer priority</code>æ’åºæ¸²æŸ“å™¨.</li><li>CommonOpaque å…¸å‹çš„ä¸é€æ˜å¯¹è±¡æ’åºã€‚</li><li>CommonTransparent å…¸å‹çš„é€æ˜åº¦æ’åºã€‚</li></ul><blockquote><p>å¯ç»„åˆæ’åº</p></blockquote></li><li>SetShaderPassName Set the shader passes that this draw call canrender.</li><li>FilteringSettings<ul><li>excludeMotionVectorObjects trueå½“å‰æ¸²æŸ“çš„å¯¹è±¡æ’é™¤åœ¨å¤–ï¼Œé»˜è®¤false.</li><li>layerMask åªæ¸²æŸ“æ­¤layermask</li><li>renderingLayerMask The rendering layer mask to use when filteringavailable renderers for drawing.</li><li>renderQueueRange æ¸²æŸ“QueueRangeçš„è®¾ç½®</li><li>sortingLayerRange æ¸²æŸ“ sortinglayer Rangeçš„è®¾ç½®ã€‚</li></ul></li></ul><h3 id="drawcall-api">3. Drawcall API</h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/unitysrp/4.yin-ying/"/>
      <url>/2022/08/10/unity/unitysrp/4.yin-ying/</url>
      
        <content type="html"><![CDATA[<h1 id="é˜´å½±">é˜´å½±</h1><blockquote><p>è®¡ç®—å…‰ç…§å½±å“ï¼Œéœ€è¦é‡è¦çš„å‚æ•°<code>æ³•çº¿</code> å’Œ <code>å…‰</code>ä»¥åŠ<code>æè´¨å±æ€§</code>ã€‚ æ³•çº¿é•¿åº¦ï¼Ÿ</p></blockquote><h2 id="åŸºç¡€ä¿®æ”¹">åŸºç¡€ä¿®æ”¹</h2><ol type="1"><li>æ·»åŠ  Pass'Tag</li></ol><pre><code>Tags {    "LightMode" = "CustomLit"}</code></pre><ol start="2" type="1"><li>æ·»åŠ ç»˜åˆ¶ä»£ç </li></ol><pre><code>litShaderTagId = new ShaderTagId("CustomLit");//...drawingSettings.SetShaderPassName(1, litShaderTagId);</code></pre><ol start="3" type="1"><li>ç€è‰²å™¨ç»“æ„æ·»åŠ æ³•çº¿å±æ€§</li></ol><pre><code>struct a2v {    float3 position : POSITION;    float3 normal : NORMAL;    //...    UNITY_VERTEX_INPUT_INSTANCE_ID}struct v2f {    float3 position : SV_POSITION;    float3 normal : VAR_NORMAL;    //...    UNITY_VERTEX_INPUT_INSTANCE_ID}v2f vert(a2v input){    //...    output.normal = TransformObjectToWorldNormal(input.normal);    //...}float4 frag(v2f input):SV_Target{    float4 base = (1.0, 1.0, 1.0, 1.0);    // ä½¿ç”¨æ³•çº¿é•¿åº¦è¿›è¡Œæ˜¾ç¤º    base.rgb = abs(length(input.normal) - 1.0) * 10.0;    return base;}</code></pre><h2 id="å…‰ç…§è®¡ç®—">å…‰ç…§è®¡ç®—</h2><h3 id="ç®€å•ä½¿ç”¨">ç®€å•ä½¿ç”¨</h3><ol type="1"><li>å®šä¹‰å…‰ç…§è®¡ç®—å±æ€§ç»“æ„</li></ol><pre><code>struct Surface {    float3 normal;    float3 color;    float alpha;};</code></pre><ol start="2" type="1"><li>frag è¿›è¡Œå±æ€§å¡«å……å’Œè®¡ç®—</li></ol><pre><code>//...    Surface surface;    surface.normal = normalize(input.normal);    surface.color = base.rgb;    surface.alpha = base.a;    return float4(surface.color, surface.alpha);//...</code></pre><ol start="3" type="1"><li>è®¡ç®—å…‰ç…§</li></ol><pre><code>float3 color = GetLighting(surface);return float4(color, surface.alpha);</code></pre><pre><code>// åŸºç¡€ç‰ˆæœ¬ ä½¿ç”¨æ³•çº¿yåˆ†é‡ ä½œä¸ºå½±å“å€¼ã€‚float3 GetLighting (Surface surface) {    return surface.normal.y * surface.color;}</code></pre><h3 id="å…‰ç…§è®¡ç®—-1">å…‰ç…§è®¡ç®—</h3><ol type="1"><li>å®šä¹‰å…‰æºå±æ€§</li></ol><pre><code>// åŸºç¡€ç‰ˆæœ¬ é¢œè‰²å’Œæ–¹å‘ã€‚struct Light {    float3 color;    float3 direction;};</code></pre><ol start="2" type="1"><li>å…‰ç…§å‡½æ•°</li></ol><p>** saturate æˆªæ­¢åœ¨0-1 èŒƒå›´ï¼Œ å»æ‰è´Ÿå€¼ï¼Œä¹Ÿå°±æ˜¯èƒŒé¢å½±å“ã€‚**</p><pre><code>// ä½¿ç”¨å…‰ç…§åœ¨æ³•çº¿çš„åˆ†é‡ å’Œ å…‰ç…§é¢œè‰² ä¹˜ç§¯ä½œä¸ºå½±å“å› å­float3 IncomingLight (Surface surface, Light light) {    return saturate(dot(surface.normal, light.direction)) * light.color;}// èåˆå…‰ç…§å½±å“å’Œæè´¨é¢œè‰²å±æ€§ã€‚float3 GetLighting (Surface surface, Light light) {    return IncomingLight(surface, light) * surface.color;}// todo, è¿™ä¸ªçœå´å…‰ç…§ï¼Œ ä½¿ç”¨å¤ªé˜³å…‰ä½œä¸ºé»˜è®¤å‚æ•°ã€‚float3 GetLighting (Surface surface) {    return GetLighting(surface, GetDirectionalLight());}</code></pre><ol start="3" type="1"><li>æ·»åŠ ç›´çº¿å…‰æ•°æ®ç»™GPU</li></ol><p>Shaderéƒ¨åˆ†å®šä¹‰ã€‚</p><pre><code>CBUFFER_START(_CustomLight)    float3 _DirectionalLightColor;    float3 _DirectionalLightDirection;CBUFFER_ENDLight GetDirectionalLight () {    Light light;    light.color = _DirectionalLightColor;    light.direction = _DirectionalLightDirection;    return light;}</code></pre><p>C# éƒ¨åˆ†è¿›è¡Œä¼ è¾“æ•°æ®ã€‚ ä½¿ç”¨commandbuffer è¿›è¡Œè®¾ç½®</p><pre><code>sing UnityEngine;using UnityEngine.Rendering;public class Lighting {    // Shader å±æ€§    static int        dirLightColorId = Shader.PropertyToID("_DirectionalLightColor"),        dirLightDirectionId = Shader.PropertyToID("_DirectionalLightDirection");    const string bufferName = "Lighting";    CommandBuffer buffer = new CommandBuffer {        name = bufferName    };        public void Setup (ScriptableRenderContext context) {        buffer.BeginSample(bufferName);        SetupDirectionalLight();        buffer.EndSample(bufferName);        context.ExecuteCommandBuffer(buffer);        buffer.Clear();    }        void SetupDirectionalLight () {        Light light = RenderSettings.sun; // **é»˜è®¤çš„å¤ªé˜³å…‰ï¼Œå› æ­¤åœºæ™¯ä¸­å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªã€‚ä¹Ÿå°±æ˜¯è¯´å…‰ç…§è®¾ç½®ä¸­çš„`Sun Source`å€¼ä¸èƒ½ä¸ºç©ºã€‚**        buffer.SetGlobalVector(dirLightColorId, light.color.linear * light.intensity); //**.linear è¿™ä¸ªå¾ˆé‡è¦**        buffer.SetGlobalVector(dirLightDirectionId, -light.transform.forward);    }}</code></pre><p>åœ¨Render ä¸­è¿›è¡Œè°ƒç”¨</p><pre><code>Lighting lighting = new Lighting();//...lighting.Setup(context);</code></pre><h3 id="æ”¹è¿›å®Œå–„ç‰ˆæœ¬-ä½¿ç”¨å‰”é™¤çš„å¯è§å…‰-å’Œå¤šå…‰æº">æ”¹è¿›å®Œå–„ç‰ˆæœ¬ï¼Œä½¿ç”¨å‰”é™¤çš„å¯è§å…‰ å’Œå¤šå…‰æº</h3><ul><li>æ”¹è¿›1ï¼Œä½¿ç”¨å‰”é™¤çš„å¯è§å…‰ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ Sunã€‚</li><li>æ”¹è¿›2ï¼Œä¼ é€’å…‰åŸæ•°ç»„ ã€é¢œè‰²æ•°ç»„ å’Œå…‰æºæ•°é‡</li><li>æ”¹è¿›3ï¼Œä¼ é€’æ•°ç»„ï¼ŒShaderä¹Ÿè·Ÿç€æ”¹ï¼Œå¹¶ä¸”æ··åˆå¤šå…‰æºå½±å“</li><li>æ”¹è¿›4ï¼Œä½¿ç”¨Linearå…‰ç…§ç»˜åˆ¶ã€‚<code>GraphicsSettings.lightsUseLinearIntensity = true;</code></li></ul><p>åŒæ ·é—®é¢˜ï¼Œ è‡³å°‘æœ‰ä¸€ä¸ªç›´çº¿å…‰ã€‚</p><pre><code>// æ¸²æŸ“ç®¡çº¿è®¾ç½®`GraphicsSettings.lightsUseLinearIntensity = true;`</code></pre><pre><code>// Renderè°ƒç”¨ä¿®æ”¹lighting.Setup(context, cullingResults);</code></pre><pre><code>    // å…‰æºè®¾ç½®æ•°æ®ä¿®æ”¹    const int maxDirLightCount = 4;    // å¯¹åº”Shader å±æ€§    static int        dirLightCountId = Shader.PropertyToID("_DirectionalLightCount"),            dirLightColorsId = Shader.PropertyToID("_DirectionalLightColors"),        dirLightDirectionsId = Shader.PropertyToID("_DirectionalLightDirections");    static Vector4[]        dirLightColors = new Vector4[maxDirLightCount],        dirLightDirections = new Vector4[maxDirLightCount];    //    CullingResults cullingResults;    public void Setup (        ScriptableRenderContext context, CullingResults cullingResults    ) {        this.cullingResults = cullingResults;        buffer.BeginSample(bufferName);        //SetupDirectionalLight();        // ä¿®æ”¹ä¸ºä½¿ç”¨å¤šå…‰æº        SetupLights();        //â€¦    }    //...    //    void SetupDirectionalLight (int index, VisibleLight visibleLight) {        dirLightColors[index] = visibleLight.finalColor;        dirLightDirections[index] = -visibleLight.localToWorldMatrix.GetColumn(2);    }    void SetupLights () {        NativeArray&lt;VisibleLight&gt; visibleLights = cullingResults.visibleLights;        for (int i = 0; i &lt; visibleLights.Length; i++) {            VisibleLight visibleLight = visibleLights[i];            // åªå¤„ç†ç›´çº¿å…‰å½±å“ å’Œæœ€å¤§æ•°é‡æ”¯æŒä»¥å†…çš„ç›´çº¿å…‰ã€‚            if (visibleLight.lightType == LightType.Directional) {                ** å€¼ç±»å‹æ‹·è´ä¼šå¼•èµ·å†…å­˜å¢é•¿ï¼Œå› æ­¤æ”¹ä¸ºrefå½¢å¼ **                SetupDirectionalLight(dirLightCount++, ref visibleLight);                if (dirLightCount &gt;= maxDirLightCount) {                    break;                }            }        }        buffer.SetGlobalInt(dirLightCountId, visibleLights.Length);        buffer.SetGlobalVectorArray(dirLightColorsId, dirLightColors);        buffer.SetGlobalVectorArray(dirLightDirectionsId, dirLightDirections);    }</code></pre><p>Shaderéƒ¨åˆ†ä¿®æ”¹</p><pre><code>#define MAX_DIRECTIONAL_LIGHT_COUNT 4CBUFFER_START(_CustomLight)    //float4 _DirectionalLightColor;    //float4 _DirectionalLightDirection;    int _DirectionalLightCount;    float4 _DirectionalLightColors[MAX_DIRECTIONAL_LIGHT_COUNT];    float4 _DirectionalLightDirections[MAX_DIRECTIONAL_LIGHT_COUNT];CBUFFER_ENDint GetDirectionalLightCount () {    return _DirectionalLightCount;}Light GetDirectionalLight (int index) {    Light light;    light.color = _DirectionalLightColors[index].rgb;    light.direction = _DirectionalLightDirections[index].xyz;    return light;}// ä½¿ç”¨ å¤šå…‰æºæ··åˆfloat3 GetLighting (Surface surface) {    float3 color = 0.0;    for (int i = 0; i &lt; GetDirectionalLightCount(); i++) {        color += GetLighting(surface, GetDirectionalLight(i));    }    return color;}</code></pre><p>ç”±äº <code>GetDirectionalLightCount();</code> ä½œä¸ºå¾ªç¯é•¿åº¦ã€‚è€Œè€ç‰ˆæœ¬OpenGL ES 2.0å’ŒWebGL 1.0å›¾å½¢apiåœ¨é»˜è®¤æƒ…å†µä¸‹ä¸èƒ½å¤„ç†è¿™æ ·çš„å¾ªç¯ï¼Œä»¥åŠçº¿æ€§å…‰ç…§ã€‚æ‰€ä»¥ä½¿ç”¨<code>#pragma target 3.5</code>æŒ‡ä»¤å°†ç€è‰²å™¨çš„ç›®æ ‡çº§åˆ«æå‡åˆ°3.5ã€‚</p><pre><code>HLSLPROGRAM#pragma target 3.5//â€¦ENDHLSL</code></pre><h3 id="brdf">BRDF</h3><p>å‰é¢ä½¿ç”¨ç®€åŒ–çš„å…‰ç…§æ¨¡å‹åªèƒ½å¤„ç†ç†æƒ³çš„ç»†èŠ‚ï¼Œä½¿ç”¨BRDFï¼ˆåŒå‘åå°„åˆ†å¸ƒå‡½æ•°ï¼‰ å¯ä»¥å¤„ç†æ›´å¤šæ ·åŒ–çš„ç»†èŠ‚è¡¨é¢ã€‚ æœ‰å¾ˆå¤šç§BRDFçš„å®ç°ï¼Œæ€§èƒ½ä¸Šæœ‰æ‰€ä¸åŒï¼Œ å¯ä»¥ä½¿ç”¨ <code>Universal RP</code>ç‰ˆæœ¬çš„ BRDFå®ç°ã€‚</p><p>ç†æƒ³çš„å…‰çº¿åå°„æŒ‰ç…§é•œé¢åå°„ã€‚ä½†æ˜¯å¦‚æœè¡¨é¢æœ‰æ›´å¤šçš„ç»†èŠ‚ï¼Œä¸å¤Ÿå¹³å¦ï¼Œé‚£ä¹ˆå°±å¯èƒ½ä¼šå‘å››å‘¨è¿›è¡Œåå°„ã€‚å› æ­¤æ— è®ºç›¸æœºåœ¨å“ªé‡Œï¼Œä»è¡¨é¢æ¥æ”¶åˆ°çš„æ¼«å°„å…‰çš„é‡æ˜¯ç›¸åŒçš„ã€‚ä½†è¿™æ„å‘³ç€æˆ‘ä»¬è§‚æµ‹åˆ°çš„å…‰èƒ½è¿œå°äºåˆ°è¾¾è¡¨é¢ç¢ç‰‡çš„å…‰èƒ½ã€‚</p><ol type="1"><li>æ·»åŠ ç»†èŠ‚æ§åˆ¶å±æ€§</li></ol><pre><code>_Metallic ("Metallic", Range(0, 1)) = 0 // é‡‘å±åº¦_Smoothness ("Smoothness", Range(0, 1)) = 0.5 //å…‰æ»‘åº¦</code></pre><pre><code>UNITY_INSTANCING_BUFFER_START(UnityPerMaterial)    UNITY_DEFINE_INSTANCED_PROP(float4, _BaseMap_ST)    UNITY_DEFINE_INSTANCED_PROP(float4, _BaseColor)    UNITY_DEFINE_INSTANCED_PROP(float, _Cutoff)    // æ·»åŠ è‡³ Instanced å±æ€§    UNITY_DEFINE_INSTANCED_PROP(float, _Metallic)    UNITY_DEFINE_INSTANCED_PROP(float, _Smoothness)UNITY_INSTANCING_BUFFER_END(UnityPerMaterial)</code></pre><pre><code>struct Surface {    float3 normal;    float3 color;    float alpha;    // ç»†èŠ‚è¡¨é¢æ·»åŠ  é‡‘å±åº¦å’Œå…‰æ»‘åº¦ å±æ€§ã€‚    float metallic;    float smoothness;};</code></pre><pre><code>float4 frag(v2f input): SV_Target{    Surface surface;    surface.normal = normalize(input.normalWS);    surface.color = base.rgb;    surface.alpha = base.a;    // èµ‹å€¼æ·»åŠ é‡‘å±åº¦å’Œå…‰æ»‘åº¦    surface.metallic = UNITY_ACCESS_INSTANCED_PROP(UnityPerMaterial, _Metallic);    surface.smoothness =        UNITY_ACCESS_INSTANCED_PROP(UnityPerMaterial, _Smoothness);        // ...}</code></pre><ol start="2" type="1"><li>æµ‹è¯•ä»£ç ï¼Œè¿›è¡Œé‡‘å±åº¦å’Œå…‰æ»‘åº¦èµ‹å€¼</li></ol><pre><code>static int        baseColorId = Shader.PropertyToID("_BaseColor"),        cutoffId = Shader.PropertyToID("_Cutoff"),        metallicId = Shader.PropertyToID("_Metallic"),        smoothnessId = Shader.PropertyToID("_Smoothness");        //...        block.SetFloat(metallicId, metallic);        block.SetFloat(smoothnessId, smoothness);        GetComponent&lt;Renderer&gt;().SetPropertyBlock(block);</code></pre><ol start="3" type="1"><li>æ·»åŠ BRDF ç»“æ„ï¼Œç»“æ„åŒ– BRDFå½±å“å€¼</li></ol><pre><code>struct BRDF {    float3 diffuse;    float3 specular;    float roughness;};</code></pre><ol start="4" type="1"><li>æ·»åŠ  BRDF å…‰ç…§å‡½æ•°</li></ol><pre><code>//ç®€å•ä½¿ç”¨ï¼Œ åªç”¨ æ¼«åå°„è¿›è¡Œå½±å“ã€‚BRDF GetBRDF (Surface surface) {    BRDF brdf;    brdf.diffuse = surface.color;    brdf.specular = 0.0;    brdf.roughness = 1.0;    return brdf;}float3 GetLighting (Surface surface, BRDF brdf, Light light) {    return IncomingLight(surface, light) * brdf.diffuse;}float3 GetLighting (Surface surface, BRDF brdf) {    float3 color = 0.0;    for (int i = 0; i &lt; GetDirectionalLightCount(); i++) {        color += GetLighting(surface, brdf, GetDirectionalLight(i));    }    return color;}// Shaderä¸­ä½¿ç”¨ã€‚BRDF brdf = GetBRDF(surface);float3 color = GetLighting(surface, brdf);</code></pre><ol start="5" type="1"><li>ä½¿ç”¨åå°„ç‡ BRDF</li></ol><p>æ¼«åå°„ å’Œ é«˜å…‰</p><pre><code>#define MIN_REFLECTIVITY 0.04float OneMinusReflectivity (float metallic) {    float range = 1.0 - MIN_REFLECTIVITY;    return range - metallic * range;}//...float oneMinusReflectivity = OneMinusReflectivity(surface.metallic);brdf.diffuse = surface.color * oneMinusReflectivity;//brdf.specular = surface.color - brdf.diffuse; // ç®€å•ä½¿ç”¨è¿›å‡ºç›¸ç­‰ã€‚// ä½¿ç”¨é‡‘å±åº¦ è¿›è¡Œå·®å€¼ colorbrdf.specular = lerp(MIN_REFLECTIVITY, surface.color, surface.metallic);//...</code></pre><p>ç²—ç³™åº¦</p><pre><code>// ä½¿ç”¨ Universal RP ç²—ç³™åº¦è½¬æ¢#include "Packages/com.unity.render-pipelines.core/ShaderLibrary/CommonMaterial.hlsl"// å…‰æ»‘åº¦ è½¬æ¢ä¸ºç²—ç³™åº¦ 1 - å…‰æ»‘åº¦ã€‚float perceptualRoughness =        PerceptualSmoothnessToPerceptualRoughness(surface.smoothness);    // ç²—ç³™åº¦å¹³æ–¹    brdf.roughness = PerceptualRoughnessToRoughness(perceptualRoughness);</code></pre><p>é«˜å…‰éƒ¨åˆ†éœ€è¦ä½¿ç”¨åˆ° è§†çº¿æ–¹å‘ï¼ŒåŸç†æ˜¯å…‰ç…§åœ¨ è§†çº¿çš„åˆ†é‡ã€‚</p><pre><code>// ç›¸æœºä½ç½®ï¼Œåé¢ä¼šåœ¨csä¸­è¿›è¡Œè®¾ç½®float3 _WorldSpaceCameraPos;</code></pre><pre><code>//è¡¨é¢ç»†èŠ‚æ·»åŠ  è§†çº¿å±æ€§struct Surface {    float3 normal;    // è§†çº¿    float3 viewDirection;    float3 color;    float alpha;    float metallic;    float smoothness;};</code></pre><pre><code>struct v2f {    float3 position : SV_POSITION;    float3 positionWorld : VAR_POSITION; //å‚¨å­˜worldPos    //...}v2f vert(a2v input){    //...    output.positionWorld = TransformObjectToWorld(input.position);    output.position = TransformWorldToHClip(output.positionWorld);    //...}float4 frag(v2f input): SV_Target{    surface.viewDirection = normalize(_WorldSpaceCameraPos - input.positionWorld);}</code></pre><p>é«˜å…‰å¼ºåº¦è®¡ç®—, ä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬çš„ <code>CookTorrance BRDF</code>ï¼Œå…¬å¼ï¼šBRDF TODO</p><h2 id="shadergui">ShaderGUI</h2><p>é€šè¿‡åœ¨ Shader æœ€åä¸­æŒ‡å®š è‡ªå®šä¹‰çš„ShaderGUI</p><pre><code>Shader "ShaderName" {    //...    CustomEditor "CustomShaderGUI"}</code></pre><p>C#</p><pre><code>public class CustomShaderGUI : ShaderGUI {    public override void OnGUI (MaterialEditor materialEditor, MaterialProperty[] properties)    {        //base.OnGUI (materialEditor, properties);        Material targetMat = materialEditor.target as Material;        //...    }}</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/unitysrp/3.quan-ju-guang/"/>
      <url>/2022/08/10/unity/unitysrp/3.quan-ju-guang/</url>
      
        <content type="html"><![CDATA[<h1 id="å…¨å±€å…‰">å…¨å±€å…‰</h1><blockquote><p>è®¡ç®—å…‰ç…§å½±å“ï¼Œéœ€è¦é‡è¦çš„å‚æ•°<code>æ³•çº¿</code> å’Œ <code>å…‰</code>ä»¥åŠ<code>æè´¨å±æ€§</code>ã€‚ æ³•çº¿é•¿åº¦ï¼Ÿ</p></blockquote><h2 id="åŸºç¡€ä¿®æ”¹">åŸºç¡€ä¿®æ”¹</h2><ol type="1"><li>æ·»åŠ  Pass'Tag</li></ol><pre><code>Tags {    "LightMode" = "CustomLit"}</code></pre><ol start="2" type="1"><li>æ·»åŠ ç»˜åˆ¶ä»£ç </li></ol><pre><code>litShaderTagId = new ShaderTagId("CustomLit");//...drawingSettings.SetShaderPassName(1, litShaderTagId);</code></pre><ol start="3" type="1"><li>ç€è‰²å™¨ç»“æ„æ·»åŠ æ³•çº¿å±æ€§</li></ol><pre><code>struct a2v {    float3 position : POSITION;    float3 normal : NORMAL;    //...    UNITY_VERTEX_INPUT_INSTANCE_ID}struct v2f {    float3 position : SV_POSITION;    float3 normal : VAR_NORMAL;    //...    UNITY_VERTEX_INPUT_INSTANCE_ID}v2f vert(a2v input){    //...    output.normal = TransformObjectToWorldNormal(input.normal);    //...}float4 frag(v2f input):SV_Target{    float4 base = (1.0, 1.0, 1.0, 1.0);    // ä½¿ç”¨æ³•çº¿é•¿åº¦è¿›è¡Œæ˜¾ç¤º    base.rgb = abs(length(input.normal) - 1.0) * 10.0;    return base;}</code></pre><h2 id="å…‰ç…§è®¡ç®—">å…‰ç…§è®¡ç®—</h2><h3 id="ç®€å•ä½¿ç”¨">ç®€å•ä½¿ç”¨</h3><ol type="1"><li>å®šä¹‰å…‰ç…§è®¡ç®—å±æ€§ç»“æ„</li></ol><pre><code>struct Surface {    float3 normal;    float3 color;    float alpha;};</code></pre><ol start="2" type="1"><li>frag è¿›è¡Œå±æ€§å¡«å……å’Œè®¡ç®—</li></ol><pre><code>//...    Surface surface;    surface.normal = normalize(input.normal);    surface.color = base.rgb;    surface.alpha = base.a;    return float4(surface.color, surface.alpha);//...</code></pre><ol start="3" type="1"><li>è®¡ç®—å…‰ç…§</li></ol><pre><code>float3 color = GetLighting(surface);return float4(color, surface.alpha);</code></pre><pre><code>// åŸºç¡€ç‰ˆæœ¬ ä½¿ç”¨æ³•çº¿yåˆ†é‡ ä½œä¸ºå½±å“å€¼ã€‚float3 GetLighting (Surface surface) {    return surface.normal.y * surface.color;}</code></pre><h3 id="å…‰ç…§è®¡ç®—-1">å…‰ç…§è®¡ç®—</h3><ol type="1"><li>å®šä¹‰å…‰æºå±æ€§</li></ol><pre><code>// åŸºç¡€ç‰ˆæœ¬ é¢œè‰²å’Œæ–¹å‘ã€‚struct Light {    float3 color;    float3 direction;};</code></pre><ol start="2" type="1"><li>å…‰ç…§å‡½æ•°</li></ol><p>** saturate æˆªæ­¢åœ¨0-1 èŒƒå›´ï¼Œ å»æ‰è´Ÿå€¼ï¼Œä¹Ÿå°±æ˜¯èƒŒé¢å½±å“ã€‚**</p><pre><code>// ä½¿ç”¨å…‰ç…§åœ¨æ³•çº¿çš„åˆ†é‡ å’Œ å…‰ç…§é¢œè‰² ä¹˜ç§¯ä½œä¸ºå½±å“å› å­float3 IncomingLight (Surface surface, Light light) {    return saturate(dot(surface.normal, light.direction)) * light.color;}// èåˆå…‰ç…§å½±å“å’Œæè´¨é¢œè‰²å±æ€§ã€‚float3 GetLighting (Surface surface, Light light) {    return IncomingLight(surface, light) * surface.color;}// todo, è¿™ä¸ªçœå´å…‰ç…§ï¼Œ ä½¿ç”¨å¤ªé˜³å…‰ä½œä¸ºé»˜è®¤å‚æ•°ã€‚float3 GetLighting (Surface surface) {    return GetLighting(surface, GetDirectionalLight());}</code></pre><ol start="3" type="1"><li>æ·»åŠ ç›´çº¿å…‰æ•°æ®ç»™GPU</li></ol><p>Shaderéƒ¨åˆ†å®šä¹‰ã€‚</p><pre><code>CBUFFER_START(_CustomLight)    float3 _DirectionalLightColor;    float3 _DirectionalLightDirection;CBUFFER_ENDLight GetDirectionalLight () {    Light light;    light.color = _DirectionalLightColor;    light.direction = _DirectionalLightDirection;    return light;}</code></pre><p>C# éƒ¨åˆ†è¿›è¡Œä¼ è¾“æ•°æ®ã€‚ ä½¿ç”¨commandbuffer è¿›è¡Œè®¾ç½®</p><pre><code>sing UnityEngine;using UnityEngine.Rendering;public class Lighting {    // Shader å±æ€§    static int        dirLightColorId = Shader.PropertyToID("_DirectionalLightColor"),        dirLightDirectionId = Shader.PropertyToID("_DirectionalLightDirection");    const string bufferName = "Lighting";    CommandBuffer buffer = new CommandBuffer {        name = bufferName    };        public void Setup (ScriptableRenderContext context) {        buffer.BeginSample(bufferName);        SetupDirectionalLight();        buffer.EndSample(bufferName);        context.ExecuteCommandBuffer(buffer);        buffer.Clear();    }        void SetupDirectionalLight () {        Light light = RenderSettings.sun; // **é»˜è®¤çš„å¤ªé˜³å…‰ï¼Œå› æ­¤åœºæ™¯ä¸­å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªã€‚ä¹Ÿå°±æ˜¯è¯´å…‰ç…§è®¾ç½®ä¸­çš„`Sun Source`å€¼ä¸èƒ½ä¸ºç©ºã€‚**        buffer.SetGlobalVector(dirLightColorId, light.color.linear * light.intensity); //**.linear è¿™ä¸ªå¾ˆé‡è¦**        buffer.SetGlobalVector(dirLightDirectionId, -light.transform.forward);    }}</code></pre><p>åœ¨Render ä¸­è¿›è¡Œè°ƒç”¨</p><pre><code>Lighting lighting = new Lighting();//...lighting.Setup(context);</code></pre><h3 id="æ”¹è¿›å®Œå–„ç‰ˆæœ¬-ä½¿ç”¨å‰”é™¤çš„å¯è§å…‰-å’Œå¤šå…‰æº">æ”¹è¿›å®Œå–„ç‰ˆæœ¬ï¼Œä½¿ç”¨å‰”é™¤çš„å¯è§å…‰ å’Œå¤šå…‰æº</h3><ul><li>æ”¹è¿›1ï¼Œä½¿ç”¨å‰”é™¤çš„å¯è§å…‰ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ Sunã€‚</li><li>æ”¹è¿›2ï¼Œä¼ é€’å…‰åŸæ•°ç»„ ã€é¢œè‰²æ•°ç»„ å’Œå…‰æºæ•°é‡</li><li>æ”¹è¿›3ï¼Œä¼ é€’æ•°ç»„ï¼ŒShaderä¹Ÿè·Ÿç€æ”¹ï¼Œå¹¶ä¸”æ··åˆå¤šå…‰æºå½±å“</li><li>æ”¹è¿›4ï¼Œä½¿ç”¨Linearå…‰ç…§ç»˜åˆ¶ã€‚<code>GraphicsSettings.lightsUseLinearIntensity = true;</code></li></ul><p>åŒæ ·é—®é¢˜ï¼Œ è‡³å°‘æœ‰ä¸€ä¸ªç›´çº¿å…‰ã€‚</p><pre><code>// æ¸²æŸ“ç®¡çº¿è®¾ç½®`GraphicsSettings.lightsUseLinearIntensity = true;`</code></pre><pre><code>// Renderè°ƒç”¨ä¿®æ”¹lighting.Setup(context, cullingResults);</code></pre><pre><code>    // å…‰æºè®¾ç½®æ•°æ®ä¿®æ”¹    const int maxDirLightCount = 4;    // å¯¹åº”Shader å±æ€§    static int        dirLightCountId = Shader.PropertyToID("_DirectionalLightCount"),            dirLightColorsId = Shader.PropertyToID("_DirectionalLightColors"),        dirLightDirectionsId = Shader.PropertyToID("_DirectionalLightDirections");    static Vector4[]        dirLightColors = new Vector4[maxDirLightCount],        dirLightDirections = new Vector4[maxDirLightCount];    //    CullingResults cullingResults;    public void Setup (        ScriptableRenderContext context, CullingResults cullingResults    ) {        this.cullingResults = cullingResults;        buffer.BeginSample(bufferName);        //SetupDirectionalLight();        // ä¿®æ”¹ä¸ºä½¿ç”¨å¤šå…‰æº        SetupLights();        //â€¦    }    //...    //    void SetupDirectionalLight (int index, VisibleLight visibleLight) {        dirLightColors[index] = visibleLight.finalColor;        dirLightDirections[index] = -visibleLight.localToWorldMatrix.GetColumn(2);    }    void SetupLights () {        NativeArray&lt;VisibleLight&gt; visibleLights = cullingResults.visibleLights;        for (int i = 0; i &lt; visibleLights.Length; i++) {            VisibleLight visibleLight = visibleLights[i];            // åªå¤„ç†ç›´çº¿å…‰å½±å“ å’Œæœ€å¤§æ•°é‡æ”¯æŒä»¥å†…çš„ç›´çº¿å…‰ã€‚            if (visibleLight.lightType == LightType.Directional) {                ** å€¼ç±»å‹æ‹·è´ä¼šå¼•èµ·å†…å­˜å¢é•¿ï¼Œå› æ­¤æ”¹ä¸ºrefå½¢å¼ **                SetupDirectionalLight(dirLightCount++, ref visibleLight);                if (dirLightCount &gt;= maxDirLightCount) {                    break;                }            }        }        buffer.SetGlobalInt(dirLightCountId, visibleLights.Length);        buffer.SetGlobalVectorArray(dirLightColorsId, dirLightColors);        buffer.SetGlobalVectorArray(dirLightDirectionsId, dirLightDirections);    }</code></pre><p>Shaderéƒ¨åˆ†ä¿®æ”¹</p><pre><code>#define MAX_DIRECTIONAL_LIGHT_COUNT 4CBUFFER_START(_CustomLight)    //float4 _DirectionalLightColor;    //float4 _DirectionalLightDirection;    int _DirectionalLightCount;    float4 _DirectionalLightColors[MAX_DIRECTIONAL_LIGHT_COUNT];    float4 _DirectionalLightDirections[MAX_DIRECTIONAL_LIGHT_COUNT];CBUFFER_ENDint GetDirectionalLightCount () {    return _DirectionalLightCount;}Light GetDirectionalLight (int index) {    Light light;    light.color = _DirectionalLightColors[index].rgb;    light.direction = _DirectionalLightDirections[index].xyz;    return light;}// ä½¿ç”¨ å¤šå…‰æºæ··åˆfloat3 GetLighting (Surface surface) {    float3 color = 0.0;    for (int i = 0; i &lt; GetDirectionalLightCount(); i++) {        color += GetLighting(surface, GetDirectionalLight(i));    }    return color;}</code></pre><p>ç”±äº <code>GetDirectionalLightCount();</code> ä½œä¸ºå¾ªç¯é•¿åº¦ã€‚è€Œè€ç‰ˆæœ¬OpenGL ES 2.0å’ŒWebGL 1.0å›¾å½¢apiåœ¨é»˜è®¤æƒ…å†µä¸‹ä¸èƒ½å¤„ç†è¿™æ ·çš„å¾ªç¯ï¼Œä»¥åŠçº¿æ€§å…‰ç…§ã€‚æ‰€ä»¥ä½¿ç”¨<code>#pragma target 3.5</code>æŒ‡ä»¤å°†ç€è‰²å™¨çš„ç›®æ ‡çº§åˆ«æå‡åˆ°3.5ã€‚</p><pre><code>HLSLPROGRAM#pragma target 3.5//â€¦ENDHLSL</code></pre><h3 id="brdf">BRDF</h3><p>å‰é¢ä½¿ç”¨ç®€åŒ–çš„å…‰ç…§æ¨¡å‹åªèƒ½å¤„ç†ç†æƒ³çš„ç»†èŠ‚ï¼Œä½¿ç”¨BRDFï¼ˆåŒå‘åå°„åˆ†å¸ƒå‡½æ•°ï¼‰ å¯ä»¥å¤„ç†æ›´å¤šæ ·åŒ–çš„ç»†èŠ‚è¡¨é¢ã€‚ æœ‰å¾ˆå¤šç§BRDFçš„å®ç°ï¼Œæ€§èƒ½ä¸Šæœ‰æ‰€ä¸åŒï¼Œ å¯ä»¥ä½¿ç”¨ <code>Universal RP</code>ç‰ˆæœ¬çš„ BRDFå®ç°ã€‚</p><p>ç†æƒ³çš„å…‰çº¿åå°„æŒ‰ç…§é•œé¢åå°„ã€‚ä½†æ˜¯å¦‚æœè¡¨é¢æœ‰æ›´å¤šçš„ç»†èŠ‚ï¼Œä¸å¤Ÿå¹³å¦ï¼Œé‚£ä¹ˆå°±å¯èƒ½ä¼šå‘å››å‘¨è¿›è¡Œåå°„ã€‚å› æ­¤æ— è®ºç›¸æœºåœ¨å“ªé‡Œï¼Œä»è¡¨é¢æ¥æ”¶åˆ°çš„æ¼«å°„å…‰çš„é‡æ˜¯ç›¸åŒçš„ã€‚ä½†è¿™æ„å‘³ç€æˆ‘ä»¬è§‚æµ‹åˆ°çš„å…‰èƒ½è¿œå°äºåˆ°è¾¾è¡¨é¢ç¢ç‰‡çš„å…‰èƒ½ã€‚</p><ol type="1"><li>æ·»åŠ ç»†èŠ‚æ§åˆ¶å±æ€§</li></ol><pre><code>_Metallic ("Metallic", Range(0, 1)) = 0 // é‡‘å±åº¦_Smoothness ("Smoothness", Range(0, 1)) = 0.5 //å…‰æ»‘åº¦</code></pre><pre><code>UNITY_INSTANCING_BUFFER_START(UnityPerMaterial)    UNITY_DEFINE_INSTANCED_PROP(float4, _BaseMap_ST)    UNITY_DEFINE_INSTANCED_PROP(float4, _BaseColor)    UNITY_DEFINE_INSTANCED_PROP(float, _Cutoff)    // æ·»åŠ è‡³ Instanced å±æ€§    UNITY_DEFINE_INSTANCED_PROP(float, _Metallic)    UNITY_DEFINE_INSTANCED_PROP(float, _Smoothness)UNITY_INSTANCING_BUFFER_END(UnityPerMaterial)</code></pre><pre><code>struct Surface {    float3 normal;    float3 color;    float alpha;    // ç»†èŠ‚è¡¨é¢æ·»åŠ  é‡‘å±åº¦å’Œå…‰æ»‘åº¦ å±æ€§ã€‚    float metallic;    float smoothness;};</code></pre><pre><code>float4 frag(v2f input): SV_Target{    Surface surface;    surface.normal = normalize(input.normalWS);    surface.color = base.rgb;    surface.alpha = base.a;    // èµ‹å€¼æ·»åŠ é‡‘å±åº¦å’Œå…‰æ»‘åº¦    surface.metallic = UNITY_ACCESS_INSTANCED_PROP(UnityPerMaterial, _Metallic);    surface.smoothness =        UNITY_ACCESS_INSTANCED_PROP(UnityPerMaterial, _Smoothness);        // ...}</code></pre><ol start="2" type="1"><li>æµ‹è¯•ä»£ç ï¼Œè¿›è¡Œé‡‘å±åº¦å’Œå…‰æ»‘åº¦èµ‹å€¼</li></ol><pre><code>static int        baseColorId = Shader.PropertyToID("_BaseColor"),        cutoffId = Shader.PropertyToID("_Cutoff"),        metallicId = Shader.PropertyToID("_Metallic"),        smoothnessId = Shader.PropertyToID("_Smoothness");        //...        block.SetFloat(metallicId, metallic);        block.SetFloat(smoothnessId, smoothness);        GetComponent&lt;Renderer&gt;().SetPropertyBlock(block);</code></pre><ol start="3" type="1"><li>æ·»åŠ BRDF ç»“æ„ï¼Œç»“æ„åŒ– BRDFå½±å“å€¼</li></ol><pre><code>struct BRDF {    float3 diffuse;    float3 specular;    float roughness;};</code></pre><ol start="4" type="1"><li>æ·»åŠ  BRDF å…‰ç…§å‡½æ•°</li></ol><pre><code>//ç®€å•ä½¿ç”¨ï¼Œ åªç”¨ æ¼«åå°„è¿›è¡Œå½±å“ã€‚BRDF GetBRDF (Surface surface) {    BRDF brdf;    brdf.diffuse = surface.color;    brdf.specular = 0.0;    brdf.roughness = 1.0;    return brdf;}float3 GetLighting (Surface surface, BRDF brdf, Light light) {    return IncomingLight(surface, light) * brdf.diffuse;}float3 GetLighting (Surface surface, BRDF brdf) {    float3 color = 0.0;    for (int i = 0; i &lt; GetDirectionalLightCount(); i++) {        color += GetLighting(surface, brdf, GetDirectionalLight(i));    }    return color;}// Shaderä¸­ä½¿ç”¨ã€‚BRDF brdf = GetBRDF(surface);float3 color = GetLighting(surface, brdf);</code></pre><ol start="5" type="1"><li>ä½¿ç”¨åå°„ç‡ BRDF</li></ol><p>æ¼«åå°„ å’Œ é«˜å…‰</p><pre><code>#define MIN_REFLECTIVITY 0.04float OneMinusReflectivity (float metallic) {    float range = 1.0 - MIN_REFLECTIVITY;    return range - metallic * range;}//...float oneMinusReflectivity = OneMinusReflectivity(surface.metallic);brdf.diffuse = surface.color * oneMinusReflectivity;//brdf.specular = surface.color - brdf.diffuse; // ç®€å•ä½¿ç”¨è¿›å‡ºç›¸ç­‰ã€‚// ä½¿ç”¨é‡‘å±åº¦ è¿›è¡Œå·®å€¼ colorbrdf.specular = lerp(MIN_REFLECTIVITY, surface.color, surface.metallic);//...</code></pre><p>ç²—ç³™åº¦</p><pre><code>// ä½¿ç”¨ Universal RP ç²—ç³™åº¦è½¬æ¢#include "Packages/com.unity.render-pipelines.core/ShaderLibrary/CommonMaterial.hlsl"// å…‰æ»‘åº¦ è½¬æ¢ä¸ºç²—ç³™åº¦ 1 - å…‰æ»‘åº¦ã€‚float perceptualRoughness =        PerceptualSmoothnessToPerceptualRoughness(surface.smoothness);    // ç²—ç³™åº¦å¹³æ–¹    brdf.roughness = PerceptualRoughnessToRoughness(perceptualRoughness);</code></pre><p>é«˜å…‰éƒ¨åˆ†éœ€è¦ä½¿ç”¨åˆ° è§†çº¿æ–¹å‘ï¼ŒåŸç†æ˜¯å…‰ç…§åœ¨ è§†çº¿çš„åˆ†é‡ã€‚</p><pre><code>// ç›¸æœºä½ç½®ï¼Œåé¢ä¼šåœ¨csä¸­è¿›è¡Œè®¾ç½®float3 _WorldSpaceCameraPos;</code></pre><pre><code>//è¡¨é¢ç»†èŠ‚æ·»åŠ  è§†çº¿å±æ€§struct Surface {    float3 normal;    // è§†çº¿    float3 viewDirection;    float3 color;    float alpha;    float metallic;    float smoothness;};</code></pre><pre><code>struct v2f {    float3 position : SV_POSITION;    float3 positionWorld : VAR_POSITION; //å‚¨å­˜worldPos    //...}v2f vert(a2v input){    //...    output.positionWorld = TransformObjectToWorld(input.position);    output.position = TransformWorldToHClip(output.positionWorld);    //...}float4 frag(v2f input): SV_Target{    surface.viewDirection = normalize(_WorldSpaceCameraPos - input.positionWorld);}</code></pre><p>é«˜å…‰å¼ºåº¦è®¡ç®—, ä½¿ç”¨ç®€åŒ–ç‰ˆæœ¬çš„ <code>CookTorrance BRDF</code>ï¼Œå…¬å¼ï¼šBRDF TODO</p><h2 id="shadergui">ShaderGUI</h2><p>é€šè¿‡åœ¨ Shader æœ€åä¸­æŒ‡å®š è‡ªå®šä¹‰çš„ShaderGUI</p><pre><code>Shader "ShaderName" {    //...    CustomEditor "CustomShaderGUI"}</code></pre><p>C#</p><pre><code>public class CustomShaderGUI : ShaderGUI {    public override void OnGUI (MaterialEditor materialEditor, MaterialProperty[] properties)    {        //base.OnGUI (materialEditor, properties);        Material targetMat = materialEditor.target as Material;        //...    }}</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/unitysrp/2.1.srp-zhao-se-qi-he-batcher/"/>
      <url>/2022/08/10/unity/unitysrp/2.1.srp-zhao-se-qi-he-batcher/</url>
      
        <content type="html"><![CDATA[<h1 id="srpç€è‰²å™¨å’Œbatcher">SRPç€è‰²å™¨å’ŒBatcher</h1><h2 id="ulitshader-ä½¿ç”¨hlslprogram-å’Œendhlsl-åŒ…è£¹">UlitShader,ä½¿ç”¨<code>HLSLPROGRAM</code> å’Œ<code>ENDHLSL</code> åŒ…è£¹</h2><p>åŒ…å«æ–‡ä»¶å¯ä»¥åƒc/c++ ä¸€æ ·ä½¿ç”¨ã€‚ é˜²æ­¢é‡å¤ç¼–è¯‘ä½¿ç”¨ <code>#if</code>æ¡ä»¶ç¼–è¯‘ã€‚ #include åŒ…å«è·¯å¾„ç›¸å¯¹äºæ–‡ä»¶å¤¹è·¯å¾„ã€‚</p><p>Unlit.shader</p><pre><code>Shader "Custom RP/Unlit"{    Properties    {        _BaseColor("BaseColor", Color) = (1, 1, 1, 1)    }        SubShader    {        Tags { "RenderType" = "Opaque" }        Pass        {            HLSLPROGRAM            #pragma vertex UnlitPassVertex            #pragma fragment UnlitPassFragment            #include "UnlitPass.hlsl"            ENDHLSL        }    }}</code></pre><p>UnlitPass.hlsl</p><pre><code>#ifndef CUSTOM_UNLIT_PASS_INCLUDED#define CUSTOM_UNLIT_PASS_INCLUDED#include "../ShaderLibrary/Common.hlsl"float4 _BaseColor;float4 unity_LODFade;real4 unity_WorldTransformParams;CBUFFER_ENDfloat4 UnlitPassVertex(float3 positionOS : POSITION) : SV_POSITION{    float3 positionWS = TransformObjectToWorld(positionOS);    return TransformWorldToHClip(positionWS);}float4 UnlitPassFragment() : SV_TARGET{    return _BaseColor;}#endif</code></pre><pre><code>#ifndef CUSTOM_COMMON_INCLUDED#define CUSTOM_COMMON_INCLUDED#include "Packages/com.unity.render-pipelines.core/ShaderLibrary/Common.hlsl"#include "UnityInput.hlsl"#define UNITY_MATRIX_M unity_ObjectToWorld#define UNITY_MATRIX_I_M unity_WorldToObject#define UNITY_MATRIX_V unity_MatrixV#define UNITY_MATRIX_VP unity_MatrixVP#define UNITY_MATRIX_P glstate_matrix_projectionfloat3 TransformObjectToWorld(float3 positionOS) {    return mul(unity_ObjectToWorld, float4(positionOS, 1.0)).xyz;}float4 TransformWorldToHClip(float3 positionWS) {    return mul(unity_MatrixVP, float4(positionWS, 1.0));}#endif</code></pre><p>UnityInput.hlsl</p><pre><code>#ifndef CUSTOM_UNITY_INPUT_INCLUDED#define CUSTOM_UNITY_INPUT_INCLUDEDfloat4x4 unity_ObjectToWorld;float4x4 unity_WorldToObject;real4 unity_WorldTransformParams;float4x4 unity_MatrixVP;float4x4 unity_MatrixV;float4x4 glstate_matrix_projection;#endif</code></pre><h2 id="ç°åœ¨ä½¿ç”¨-è¿™ä¸ªç€è‰²å™¨-æ¸²æŸ“å¤šä¸ªå¯¹è±¡-å‡ºç°drawcallè¿‡å¤šé—®é¢˜">ç°åœ¨ä½¿ç”¨è¿™ä¸ªç€è‰²å™¨ æ¸²æŸ“å¤šä¸ªå¯¹è±¡ å‡ºç°drawcallè¿‡å¤šé—®é¢˜</h2><p>æ¯æ¬¡ç»˜åˆ¶è°ƒç”¨éƒ½éœ€è¦CPUå’ŒGPUä¹‹é—´çš„é€šä¿¡ã€‚å¦‚æœéœ€è¦å‘é€å¤§é‡æ•°æ®åˆ°GPUï¼Œé‚£ä¹ˆå®ƒå¯èƒ½ä¼šæµªè´¹æ—¶é—´ã€‚å½“CPUå¿™äºå‘é€æ•°æ®æ—¶ï¼Œå®ƒä¸èƒ½åšå…¶ä»–äº‹æƒ…ã€‚è¿™ä¸¤ä¸ªé—®é¢˜éƒ½å¯ä»¥é™ä½å¸§é€Ÿç‡ã€‚ç›®å‰æˆ‘ä»¬çš„æ–¹æ³•å¾ˆç®€å•:æ¯ä¸ªå¯¹è±¡éƒ½æœ‰è‡ªå·±çš„drawè°ƒç”¨ã€‚è¿™æ˜¯æœ€ç³Ÿç³•çš„æ–¹æ³•ï¼Œå°½ç®¡æˆ‘ä»¬æœ€ç»ˆåªå‘é€äº†å¾ˆå°‘çš„æ•°æ®ï¼Œæ‰€ä»¥ç°åœ¨è¿˜å¥½ã€‚</p><h3 id="srp-batcher">SRP Batcher</h3><p>æ‰¹å¤„ç†æ˜¯ç»“åˆdrawè°ƒç”¨çš„è¿‡ç¨‹ï¼Œå‡å°‘äº†èŠ±è´¹åœ¨CPUå’ŒGPUä¹‹é—´çš„é€šä¿¡æ—¶é—´ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯å¯ç”¨SRPæ‰¹å¤„ç†ç¨‹åºã€‚ç„¶è€Œï¼Œ<strong>è¿™åªé€‚ç”¨äºå…¼å®¹çš„ç€è‰²å™¨</strong>ï¼Œè€Œæˆ‘ä»¬çš„Unlitç€è‰²å™¨ä¸æ˜¯ã€‚æ‚¨å¯ä»¥åœ¨æ£€æŸ¥å™¨ä¸­é€‰æ‹©å®ƒæ¥éªŒè¯è¿™ä¸€ç‚¹ã€‚æœ‰ä¸€ä¸ªè¡¨ç¤ºä¸å…¼å®¹çš„SRPæ‰¹å¤„ç†ç¨‹åºè¡Œï¼Œå…¶ä¸­ç»™å‡ºäº†ä¸€ä¸ªåŸå› ã€‚</p><p><img src="/imgs/SRP_Batcher.png"></p><p>SPR batch é‡‡ç”¨çš„æ–¹æ³•ä¸æ˜¯å‡å°‘ draw callsçš„æ•°é‡ï¼Œè€Œæ˜¯é‡‡ç”¨äº†æ›´ç²¾ç®€çš„åŠæ³•ã€‚å®ƒæŠŠæè´¨çš„å±æ€§å…ˆç¼“å­˜åˆ°GPUä¸­ï¼Œå› æ­¤è¿™æ ·æ¯ä¸ªDrawcallå°±ä¸ç”¨å‘é€åŒæ ·çš„æ•°æ®äº†ã€‚è¿™å¤§å¤§å‡å°‘äº†GPUä¸ CPU çš„ äº¤æµä¸­ä½¿ç”¨çš„æ•°æ®ã€‚ä½†æ˜¯ä½¿ç”¨è¿™ç§æ–¹å¼çš„è¯ä¼šæœ‰ä¸¥æ ¼çš„è¦æ±‚æ¡ä»¶ï¼šæ•°æ®æ˜¯Uniform ç±»å‹çš„ç»“æ„ä½“ã€‚</p><pre><code>CBUFFER_START(UnityPerMaterial)float4 _BaseColor;CBUFFER_END</code></pre><pre><code>CBUFFER_START(UnityPerDraw)    float4x4 unity_ObjectToWorld;    float4x4 unity_WorldToObject;    float4 unity_LODFade;    real4 unity_WorldTransformParams;CBUFFER_END</code></pre><p>å¦‚æœä½¿ç”¨ <code>MaterialPropertyBlock</code> è¿›è¡Œèµ‹å€¼ï¼Œ drawcallåˆå›åˆ° æœªåˆæ‰¹çŠ¶æ€ã€‚</p><h2 id="gpu-instanced">GPU Instanced</h2><h3 id="æ·»åŠ pragma-multi_compile_instancingæŒ‡ä»¤">æ·»åŠ <code>#pragma multi_compile_instancing</code>æŒ‡ä»¤</h3><p>å› ä¸ºGPUInstancedéœ€è¦é€šè¿‡æ•°ç»„æä¾›æ•°æ®ï¼Œæˆ‘ä»¬çš„ç€è‰²å™¨ç›®å‰ä¸æ”¯æŒå®ƒã€‚ç¬¬ä¸€æ­¥æ˜¯æ·»åŠ <code>#pragma multi_compile_instancing</code>æŒ‡ä»¤åˆ°æˆ‘ä»¬çš„ç€è‰²å™¨çš„é€šé“å—çš„é¡¶ç‚¹å’Œç‰‡æ®µç¼–è¯‘çš„ä¸Šæ–¹ã€‚</p><p><code>#pragma multi_compile_instancing</code></p><p><img src="/imgs/gpu-instancing-material.png"></p><h3 id="æ·»åŠ -gpuinstance-å†…ç½®">æ·»åŠ  gpuinstance å†…ç½®</h3><p><code>#include "Packages/com.unity.render-pipelines.core/ShaderLibrary/UnityInstancing.hlsl"</code></p><h3 id="instance-å±æ€§">instance å±æ€§</h3><p>è¢« UNITY_INSTANCING_BUFFER_START(xxx) å’ŒUNITY_INSTANCING_BUFFER_ENDï¼ˆxxx) åŒ…è£¹ï¼Œ ä½¿ç”¨<code>UNITY_DEFINE_INSTANCED_PROP(type, name)</code> å£°æ˜ã€‚</p><pre><code> //float4 _BaseColor; æ”¹ä¸º UNITY_INSTANCING_BUFFER_START(UnityPerMaterial) UNITY_DEFINE_INSTANCED_PROP(float4, _BaseColor) UNITY_INSTANCING_BUFFER_END(UnityPerMaterial)</code></pre><h3 id="instance-id">instance id</h3><p>é¡¶ç‚¹è¾“å…¥ç»“æ„å’Œè¾“å‡ºç»“æ„åˆ†åˆ«æ·»åŠ <code>UNITY_VERTEX_INPUT_INSTANCE_ID</code> å±æ€§ã€‚</p><p>ç€è‰²å™¨å‡½æ•° è·å–instanceid<code>UNITY_SETUP_INSTANCE_ID(input);</code>ã€‚</p><p>é€šè¿‡ <code>UNITY_ACCESS_INSTANCED_PROP(ç»“æ„åï¼Œ å­—æ®µå)</code>è·å–å±æ€§ã€‚</p><pre><code>struct a2v {    float3 position : POSITION;    UNITY_VERTEX_INPUT_INSTANCE_ID};struct v2f {    float3 position : SV_POSITION;    UNITY_VERTEX_INPUT_INSTANCE_ID};v2f vert(a2v input){    v2f output;    UNITY_SETUP_INSTANCE_ID(input);    UNITY_TRANSFER_INSTANCE_ID(input, output);    float3 worldPos = TransformObjectToWorld(input.position);    output.position = TransformWorldToHClip(worldPos);    return output;}float4 frag(v2f input): SV_Target{    UNITY_SETUP_INSTANCE_ID(input);    float4 baseColor = UNITY_ACCESS_INSTANCED_PROP(UnityPerMaterial, _BaseColor);    return baseColor;}</code></pre><p><strong>GPU Instancedéœ€è¦å¤šå°‘ä¸ªdrawè°ƒç”¨å–å†³äºå¹³å°ï¼Œå› ä¸ºæ¯ä¸ªdrawè°ƒç”¨çš„æœ€å¤§ç¼“å†²åŒºå¤§å°æ˜¯ä¸åŒçš„ã€‚</strong></p><h2 id="åŠ¨æ€åˆæ‰¹dynamic-batching">åŠ¨æ€åˆæ‰¹ï¼ˆDynamic Batchingï¼‰</h2><p>è¿˜æœ‰ç¬¬ä¸‰ç§å‡å°‘drawè°ƒç”¨çš„æ–¹æ³•ï¼Œç§°ä¸ºåŠ¨æ€æ‰¹å¤„ç†ã€‚è¿™æ˜¯ä¸€ä¸ªå¤è€çš„æŠ€æœ¯ï¼Œå°†å¤šä¸ªå…±äº«ç›¸åŒæè´¨çš„å°ç½‘æ ¼åˆå¹¶æˆä¸€ä¸ªæ›´å¤§çš„ç½‘æ ¼ã€‚å½“ä½¿ç”¨æ¯ä¸ªå¯¹è±¡çš„æè´¨å±æ€§æ—¶ï¼ˆMaterialBlockï¼‰ï¼Œè¿™ä¹Ÿä¸èµ·ä½œç”¨ã€‚æ ¹æ®éœ€è¦ç”Ÿæˆè¾ƒå¤§çš„ç½‘æ ¼ï¼Œæ‰€ä»¥å®ƒåªé€‚ç”¨äºå°ç½‘æ ¼ã€‚çƒä½“å¤ªå¤§äº†ï¼Œä½†æ˜¯ç«‹æ–¹ä½“å°±å¯ä»¥äº†ã€‚å®ä¾‹åŒ–è®¾ç½®ä¸ºfalseï¼Œ åŠ¨æ€åˆæ‰¹è®¾ç½®ä¸ºtrueã€‚</p><pre><code>var drawingSettings = new DrawingSettings(unlitShaderTagId, sortingSettings){    enableDynamicBatching = useDynamicBatching,    enableInstancing = useGPUInstancing};</code></pre><h2 id="å…¶ä»–ä¸€äº›">å…¶ä»–ä¸€äº›ï¼Œ</h2><ul><li><p>è´´å›¾ã€é‡‡æ ·å™¨ ä¸èƒ½ä½œä¸ºå®ä¾‹åŒ–å±æ€§ã€‚</p></li><li><p>Shaderæ”¯æŒçš„Aributeï¼š</p><ul><li>[Enum(UnityEngine.Rendering.BlendMode)] ï¼Œ ä½œä¸ºenum åœ¨æè´¨é¢æ¿ç»˜åˆ¶ï¼Œå¯¹åº”CSharp æšä¸¾ã€‚</li><li>[Enum(Off, 0, On, 1)] ï¼Œ key -v å½¢å¼çš„enumã€‚</li><li>[Toggle(_CLIPPING)]</li></ul></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/unitysrp/2.0.hlsl-cg/"/>
      <url>/2022/08/10/unity/unitysrp/2.0.hlsl-cg/</url>
      
        <content type="html"><![CDATA[<h1 id="unityæ‚è°ˆ-srpä¸ºä½•å†ä¹Ÿä¸ä½¿ç”¨cg">Unityæ‚è°ˆ-SRPä¸ºä½•å†ä¹Ÿä¸ä½¿ç”¨CG</h1><p>é¦–å…ˆçœ‹Unityå‰æœŸä¸ºä½•ä½¿ç”¨Cg, ç”±äºCgèƒ½æ‰“é€šHLSLå’ŒGLSL.HLSLå’ŒCgè¯­è¨€ç±»ä¼¼,å·®åˆ«éƒ¨åˆ†èƒ½å¤Ÿç”¨å®æ¥å¤„ç†,è€ŒCgåˆ°HLSLèƒ½å¤Ÿç”±å…¶ä½™å·¥å…·è¿›è¡Œè½¬æ¢.Cgè‡ªå·±çš„ç¼–è¯‘å™¨å°±èƒ½å¤Ÿæä¾›Cgåˆ°GLSLçš„è½¬æ¢,<strong>å¯æ˜¯, ç”Ÿæˆçš„GLSLéµç…§çš„æ˜¯NVIDIAçš„è§„çŸ©, å¯¹AMD,Intelçš„æ”¯æŒå°±æœ‰é—®é¢˜ç¼–è¯‘å™¨</strong></p><p><img src="/imgs/HLSL_CG.jpg"> <img src="/imgs/HLSL_CG2.jpg"></p><p>å†æ—¥åå„ç±»ç€è‰²å™¨è¯­éŸ³ä¸æ–­å‘å±•, è€ŒCgåˆ™åœ¨2012å¹´ä»¥åå†æ— æ›´æ–°,åœ¨åŠŸèƒ½ä¸Š,çœ‹çœ‹ä¸Šå›¾ä¸­è¢«æ‰“å‰çš„Hull Shader, Domain Shaderå’ŒComputeShader.åœ¨è·¨å¹³å°æ–¹é¢å‘¢, å‘Vulkan, Metalçš„çº¿ä¹Ÿéš¾ä»¥é“¾æ¥.ç¼–è¯‘è¿™ä¸ªæ—¶å€™SPIR-Væˆä¸ºäº†é“¾æ¥å…¨éƒ¨ç€è‰²è¯­è¨€æ–°çš„æ¡¥æ¢.å¾®è½¯æ¨å‡ºäº†DirectXShaderCompiler,èƒ½å¤ŸæŠŠHLSLç¼–è¯‘ä¸ºSPIR-V, å¯ç›´æ¥ç”¨äºVulkanå’Œè¾ƒæ–°çš„OpenGL.KhronosGroupåˆ™æ¨å‡ºäº†SPIRV-Cross, èƒ½å¤ŸæŠŠSPIR-Vè½¬æ¢ä¸ºOpenGLçš„GLSL, OpenGLESçš„ESSL, Metalçš„MSL.è¿™æ ·å°±æŠŠå…¨éƒ¨çš„ç€è‰²è¯­è¨€é“¾æ¥äº†èµ·æ¥, è‡³äºCg, å¾ˆé—æ†¾,å·²ç»æ²¡æœ‰å®ƒçš„ä½ç½®äº†.</p><p>å‚è€ƒï¼š <a href="https://www.cnblogs.com/yusjoel/p/13272524.html">https://www.cnblogs.com/yusjoel/p/13272524.html</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/unitysrp/1.ji-ben-srp-gong-zuo-fang-shi/"/>
      <url>/2022/08/10/unity/unitysrp/1.ji-ben-srp-gong-zuo-fang-shi/</url>
      
        <content type="html"><![CDATA[<h1 id="unity-srp-å·¥ä½œæ–¹å¼">Unity SRP å·¥ä½œæ–¹å¼</h1><h2 id="å®‰è£…-universal-rp-åŒ…universal-é€šç”¨">å®‰è£… Universal RPåŒ…(Universal: é€šç”¨)</h2><h2 id="å®šåˆ¶-renderpipelineasset">å®šåˆ¶ RenderPipelineAsset</h2><pre><code>[CreateAssetMenu(menuName = "Rendering/Custom Render Pipeline")]public class CustomRenderPipelineAsset : RenderPipelineAsset{    public bool useSRPBatcher    {        get { return m_UseSRPBatcher; }        set { m_UseSRPBatcher = value; }    }    [SerializeField] bool m_UseSRPBatcher = true;    protected override RenderPipeline CreatePipeline()    {        return new CustomRenderPipeline();    }}</code></pre><h2 id="å®šåˆ¶-renderpipeline">å®šåˆ¶ RenderPipeline</h2><pre><code>public class CustomRenderPipeline : RenderPipeline{    private CameraRenderer renderer = new CameraRenderer();    protected override void Render(ScriptableRenderContext context, Camera[] cameras)    {        foreach (var camera in cameras)        {            renderer.Render(context, camera);        }    }}</code></pre><h2 id="è´Ÿè´£å…·ä½“æ¸²æŸ“äº‹å®œçš„å·¥ä½œrender">è´Ÿè´£å…·ä½“æ¸²æŸ“äº‹å®œçš„å·¥ä½œRender</h2><pre><code>using System.Collections;using System.Collections.Generic;using UnityEngine;using UnityEngine.Rendering;public partial class CameraRenderer {    static ShaderTagId unlitShaderTagId = new ShaderTagId("SRPDefaultUnlit");    const string bufferName = "Render Camera";    CommandBuffer buffer = new CommandBuffer() { name = bufferName };    private ScriptableRenderContext context;    private Camera camera;    CullingResults cullingResults;    public void Render(ScriptableRenderContext context, Camera camera)    {        this.context = context;        this.camera = camera;        PrepareBuffer();        PrepareForSceneWindow();        if (!Cull())        {            return;        }        Setup();        DrawVisibleGeometry();        DrawUnsupportedShaders();        DrawGizmos();        Submit();    }    private bool Cull()    {        if (camera.TryGetCullingParameters(out ScriptableCullingParameters p))        {            cullingResults = context.Cull(ref p);            return true;        }        return false;    }    private void Setup()    {        context.SetupCameraProperties(camera);        CameraClearFlags flags = camera.clearFlags;        buffer.ClearRenderTarget(flags &lt;= CameraClearFlags.Depth            , flags == CameraClearFlags.Color            , flags == CameraClearFlags.Color? camera.backgroundColor.linear: Color.clear);        buffer.BeginSample(SampleName);        ExecuteBuffer();    }    private void DrawVisibleGeometry()    {        var sortingSettings = new SortingSettings(camera) { criteria = SortingCriteria.CommonOpaque };        var drawingSettings = new DrawingSettings(unlitShaderTagId, sortingSettings);        var filteringSettings = new FilteringSettings(RenderQueueRange.opaque);        context.DrawRenderers(            cullingResults, ref drawingSettings, ref filteringSettings        );        if (drawingSettings.mainLightIndex &gt;= 0)        {            ShadowDrawingSettings shadowDrawingSettings = new ShadowDrawingSettings(cullingResults, drawingSettings.mainLightIndex);            context.DrawShadows(ref shadowDrawingSettings);        }        //context.DrawSkybox(camera);        if (camera.clearFlags == CameraClearFlags.Skybox &amp;&amp; RenderSettings.skybox != null)        {            context.DrawSkybox(camera);        }        sortingSettings.criteria = SortingCriteria.CommonTransparent;        drawingSettings.sortingSettings = sortingSettings;        filteringSettings.renderQueueRange = RenderQueueRange.transparent;        context.DrawRenderers(            cullingResults, ref drawingSettings, ref filteringSettings        );    }    private void Submit()    {        buffer.EndSample(SampleName);        ExecuteBuffer();        context.Submit();    }    private void ExecuteBuffer()    {        context.ExecuteCommandBuffer(buffer);        buffer.Clear();    }}</code></pre><h2 id="è®¾ç½®">è®¾ç½®</h2><ol type="1"><li><p>åˆ›å»º<code>.asset</code>ä½œä¸ºèµ„æºçš„å½¢å¼èµ‹å€¼ç»™<code>ProjectSettings-&gt;Graphics</code>çš„ <code>Scriptable Render Pipeline Settings</code></p></li><li><p>ä»£ç å½¢å¼<code>GraphicsSettings.renderPipelineAsset = asset;</code></p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/ugui-yuan-ma-ji-lu/7.ugui-xing-neng-you-hua/"/>
      <url>/2022/08/10/unity/ugui-yuan-ma-ji-lu/7.ugui-xing-neng-you-hua/</url>
      
        <content type="html"><![CDATA[<h2 id="uguiä¹‹æ€§èƒ½ä¼˜åŒ–">uGUIä¹‹æ€§èƒ½ä¼˜åŒ–</h2><ol type="1"><li>RaycastTargetï¼Œ</li><li>Maskï¼Œ å› ä¸ºæ˜¯æ¨¡æ¿å®ç°ï¼Œæ‰€ä»¥ä¼šå•ç‹¬Drawcall æ¨¡æ¿ï¼Œåœ¨ä¸€ä¸ªdrawcallè‡ªå·±ã€‚ Mask2D ä½¿ç”¨ CanvasRender.clip</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/ugui-yuan-ma-ji-lu/6.ugui-rebuild/"/>
      <url>/2022/08/10/unity/ugui-yuan-ma-ji-lu/6.ugui-rebuild/</url>
      
        <content type="html"><![CDATA[<h2 id="uguiä¹‹rebuild">uGUIä¹‹Rebuild</h2><blockquote><p>UIçš„Rebuild.</p></blockquote><h2 id="ä¸€åŸºç¡€">ä¸€ã€åŸºç¡€</h2><h3 id="canvas-é™æ€æ–¹æ³•">Canvas é™æ€æ–¹æ³•</h3><ul><li><p>Canvas.willRenderCanvasesï¼Œäº‹ä»¶ Canvas æ¸²æŸ“ä¹‹å‰è¢«è°ƒç”¨</p></li><li><p>Canvas.ForceUpdateCanvases</p></li><li><p>Canvas.ForceUpdateCanvases</p></li></ul><h2 id="canvasrenderer">CanvasRenderer</h2><blockquote><p>GUIçš„æ¸²æŸ“å™¨ã€‚ä¾èµ–äº<code>Canvas</code>.</p></blockquote><ol type="1"><li>int absoluteDepth, ç›¸å¯¹äºRoot Canvasçš„Render' depth</li><li>Vector2 clippingSoftness , åº”ç”¨äºRenderçš„softness(è½¯) è£å‰ªã€‚</li><li>bool cull { get; set; }</li><li>bool cullTransparentMesh { get; set; }</li><li><strong>CanvasRenderer.DisableRectClipping</strong></li><li><strong>CanvasRenderer.EnableRectClipping(Rect rect);</strong></li></ol><h2 id="äºŒugui-rebuildè®¾è®¡">äºŒã€UGUI Rebuildè®¾è®¡</h2><blockquote><p>ä½œç”¨æ˜¯ç›‘å¬Canvas.willRenderCanvasesï¼Œåœ¨æ¸²æŸ“Canvasä¹‹å‰ï¼Œæ›´æ–°Meshã€Materialã€Colorã€Cullç­‰ã€‚<code>CanvasUpdateRegistry</code>ç®¡ç†æ‰§è¡Œé€»è¾‘ã€‚ Rebuildå¯¹è±¡æ˜¯ç»§æ‰¿<code>ICanvasElement</code>æ¥å£</p></blockquote><ul><li>æ¥å£ã€‚</li></ul><div class="sourceCode" id="cb1"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> ICanvasElement</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Rebuild the element for the given stage.</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"executing"</span><span class="kw">&gt;</span><span class="co">The current CanvasUpdate stage being rebuild.</span><span class="kw">&lt;/param&gt;</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">Rebuild</span><span class="op">(</span>CanvasUpdate executing<span class="op">);</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Get the transform associated with the ICanvasElement.</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    Transform transform <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="op">}</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Callback sent when this ICanvasElement has completed layout.</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">LayoutComplete</span><span class="op">();</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Callback sent when this ICanvasElement has completed Graphic rebuild.</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">GraphicUpdateComplete</span><span class="op">();</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Used if the native representation has been destroyed.</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">Return true if the element is considered destroyed.</span><span class="kw">&lt;/returns&gt;</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> <span class="fu">IsDestroyed</span><span class="op">();</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><ul><li>ç›‘å¬äº‹ä»¶</li></ul><div class="sourceCode" id="cb2"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="fu">CanvasUpdateRegistry</span><span class="op">()</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    Canvas<span class="op">.</span><span class="fu">willRenderCanvases</span> <span class="op">+=</span> PerformUpdate<span class="op">;</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><ul><li>ä¸»è¦çš„å›è°ƒç›‘å¬å¤„ç†æ–¹å¼ã€‚</li></ul><p>å¤„ç†æ­¥éª¤æšä¸¾å®šä¹‰</p><div class="sourceCode" id="cb3"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">enum</span> CanvasUpdate</span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Called before layout.</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    Prelayout <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Called for layout.</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    Layout <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Called after layout.</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    PostLayout <span class="op">=</span> <span class="dv">2</span><span class="op">,</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Called before rendering.</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    PreRender <span class="op">=</span> <span class="dv">3</span><span class="op">,</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Called late, before render.</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    LatePreRender <span class="op">=</span> <span class="dv">4</span><span class="op">,</span></span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Max enum value. Always last.</span></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    MaxUpdateValue <span class="op">=</span> <span class="dv">5</span></span><span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><ul><li><p><code>PerformUpdate</code>ä¸»è¦æ­¥éª¤å½’çº³</p><ol type="1"><li><p>ç¬¬ä¸€ä¸ªæ­¥éª¤ï¼šç§»é™¤æ— ç”¨å¯¹è±¡ã€‚<code>CleanInvalidItems()</code>;</p></li><li><p>LayoutRebuildåˆ—è¡¨å¯¹è±¡ 1.å¯¹<code>null</code>å€¼çš„<code>ICanvasElement</code>è¿›è¡Œç§»é™¤ 2.å¯¹<code>IsDestroyed()</code>çš„<code>ICanvasElement</code>è¿›è¡Œç§»é™¤ï¼Œå¹¶å›è°ƒLayoutComplete</p></li><li><p>GraphicRebuildåˆ—è¡¨å¯¹è±¡ 1.å¯¹<code>null</code>å€¼çš„<code>ICanvasElement</code>è¿›è¡Œç§»é™¤ 2.å¯¹<code>IsDestroyed()</code>çš„<code>ICanvasElement</code>è¿›è¡Œç§»é™¤ï¼Œå¹¶å›è°ƒLayoutComplete</p></li><li><p>ç¬¬äºŒæ­¥éª¤ï¼šå¯¹Layoutåˆ—è¡¨æ‰§è¡Œ<code>Prelayout</code>ã€<code>Layout</code>ã€<code>PostLayout</code>ã€‚ä¹Ÿå°±æ˜¯Layoutçš„å‰ä¸­åä¸‰ä¸ªå­æ­¥éª¤ï¼Œæœ€åæ‰§è¡Œ<code>LayoutComplete</code>å›è°ƒã€‚<code>è¿™æœ‰ä¸ªåˆ¤æ–­éœ€è¦å¯¹è±¡æ˜¯</code>UnityEngine.Object<code>å¯¹è±¡</code>ã€‚</p></li><li><p>Rebuild(CanvasUpdate.Prelayout)</p></li><li><p>Rebuild(CanvasUpdate.Layout)</p></li><li><p>Rebuild(CanvasUpdate.PostLayout)</p></li><li><p>LayoutComplete</p></li><li><p>ç¬¬ä¸‰ä¸ªæ­¥éª¤ï¼šæ‰§è¡ŒCullã€‚<code>ClipperRegistry.Cull()</code></p></li><li><p>ç¬¬å››æ­¥éª¤ï¼šå¯¹Graphicåˆ—è¡¨æ‰§è¡Œ<code>PreRender</code>ã€<code>LatePreRender</code>ã€‚ä¹Ÿå°±æ˜¯Layoutçš„å‰ä¸­åä¸‰ä¸ªå­æ­¥éª¤ï¼Œæœ€åæ‰§è¡Œ<code>GraphicUpdateComplete</code>å›è°ƒã€‚<code>è¿™æœ‰ä¸ªåˆ¤æ–­éœ€è¦å¯¹è±¡æ˜¯</code>UnityEngine.Object<code>å¯¹è±¡</code>ã€‚</p></li><li><p>Rebuild(CanvasUpdate.PreRender)</p></li><li><p>Rebuild(CanvasUpdate.LatePreRender)</p></li><li><p>GraphicUpdateComplete</p></li></ol></li><li><p>ç»Ÿè®¡ä¸»è¦æ¥å£å’Œè¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚</p></li></ul><ol type="1"><li>LayoutRebuild, ç›‘å¬Layout Rebuildæœ‰ä¸¤ä¸ªæ–¹æ³•ã€‚ä½œç”¨ä¸€æ ·ï¼ŒåŒºåˆ«æ˜¯å°†è¿”å›å€¼è¿”å›ã€‚</li><li>void RegisterCanvasElementForLayoutRebuild(ICanvasElement element)ï¼Œ1. ScrollRectBar 2. ScrollRect 3. Slider 4. Toggle</li><li>bool TryRegisterCanvasElementForLayoutRebuild(ICanvasElementelement) 1. LayoutRebuilder</li><li>GraphicRebuild,ç›‘å¬ GraphicRebuildï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•ã€‚ä½œç”¨ä¸€æ ·ï¼ŒåŒºåˆ«æ˜¯å°†è¿”å›å€¼è¿”å›ã€‚</li><li>void RegisterCanvasElementForGraphicRebuild(ICanvasElement element)1. Graphic 2. InputField</li><li>bool TryRegisterCanvasElementForGraphicRebuild(ICanvasElementelement) 1. æ²¡æœ‰ç”¨åˆ°</li><li>UnRegisterCanvasElementForRebuild, å–æ¶ˆç›‘å¬LayoutRebuildå’ŒGraphicRebuildã€‚</li></ol><h2 id="å…·ä½“ç›‘å¬å¯¹è±¡çš„å®ç°">å…·ä½“ç›‘å¬å¯¹è±¡çš„å®ç°ã€‚</h2><h3 id="layoutéƒ¨åˆ†">Layoutéƒ¨åˆ†ã€‚</h3><p>LayoutRebuilderï¼Œ &gt; è¿™æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ã€‚ ç»„ä»¶é€šè¿‡è°ƒç”¨<code>MarkLayoutForRebuild</code>,ç„¶åå†…éƒ¨é€šè¿‡ä¸€ç³»åˆ—è¿‡æ»¤,ç„¶åé€šè¿‡<code>TryRegisterCanvasElementForLayoutRebuild</code>è¿›è¡Œæ³¨å†Œã€‚Rebuildå›è°ƒå†ç®¡ç†æ´¾å‘å›è°ƒã€‚</p><ul><li>MarkLayoutForRebuild è°ƒç”¨<ol type="1"><li>Graphic</li><li>AspectRatioFitter</li><li>ContentSizeFitter</li><li>HorzontalOrVertcalLayoutGroup</li><li>LayoutElement</li><li>LayoutGroup</li><li>ScrollRect</li></ol></li></ul><h4 id="æ³¨å†Œ-void-marklayoutforrebuildrecttransform-rect">æ³¨å†Œ voidMarkLayoutForRebuild(RectTransform rect)ã€‚</h4><ol type="1"><li>å¯¹è‡ªå·±/çˆ¶èŠ‚ç‚¹ä¸åŒ…å«æœ‰æ•ˆçš„<code>ILayoutGroup</code>,ä¸”è‡ªå·±ä¸åŒ…å«æœ‰æ•ˆçš„<code>ILayoutController</code>ã€‚çš„ç»„ä»¶ï¼Œæ‰§è¡ŒReturnã€‚</li><li>å¯¹è‡ªå·±/çˆ¶èŠ‚ç‚¹<strong>åŒ…å«</strong>æœ‰æ•ˆçš„<code>ILayoutGroup</code>ï¼Œæˆ–è€…ä¸”è‡ªå·±<strong>åŒ…å«</strong>æœ‰æ•ˆçš„<code>ILayoutController</code>ã€‚æ‰§è¡ŒMarkLayoutRootForRebuild(layoutRoot);ï¼Œä½¿ç”¨åŒ…å«<code>ILayoutGroup</code>çš„ç»„ä»¶è¿›è¡Œæ·»åŠ Rebuildæ³¨å†Œ<code>CanvasUpdateRegistry.TryRegisterCanvasElementForLayoutRebuild(rebuilder)</code>ã€‚</li></ol><h4 id="å›è°ƒ">å›è°ƒ</h4><ol type="1"><li>Rebuildï¼Œ è¿™é‡Œåªå¤„ç†<code>CanvasUpdate.Layout</code> çŠ¶æ€ã€‚</li><li>æ°´å¹³è®¡ç®—,ILayoutElement.CalculateLayoutInputHorizontal(),å¯¹äºå«æœ‰<code>ILayoutElement</code>/<code>ILayoutGroup</code>é€’å½’Childï¼Œåœ¨æ‰§è¡Œè‡ªå·±ã€‚</li><li>æ°´å¹³è®¾ç½®,ILayoutController.SetLayoutHorizontal(),<del><code>ILayoutController</code>ã€<code>ILayoutSelfController</code>ã€<code>ScrollRect</code></del>ã€‚</li><li>ç«–ç›´è®¡ç®—ï¼ŒILayoutElement.CalculateLayoutInputVertical(),å¯¹äºå«æœ‰<code>ILayoutElement</code>/<code>ILayoutGroup</code>é€’å½’Childï¼Œåœ¨æ‰§è¡Œè‡ªå·±ã€‚</li><li>ç«–ç›´è®¾ç½®ï¼ŒILayoutController.SetLayoutVertical(),<del><code>ILayoutController</code>ã€<code>ILayoutSelfController</code>ã€<code>ScrollRect</code></del>ã€‚</li><li>LayoutComplete, xxç©ºç¼ºã€‚</li><li>GraphicUpdateComplete ç©ºç¼ºã€‚</li></ol><h3 id="cull-éƒ¨åˆ†">Cull éƒ¨åˆ†ã€‚</h3><blockquote><p>ClipperRegistry</p></blockquote><h4 id="æ³¨å†Œå–æ¶ˆæ³¨å†Œè£å‰ª">æ³¨å†Œ/å–æ¶ˆæ³¨å†Œè£å‰ª</h4><blockquote><p>public static void Register(IClipper c)ã€public static voidUnregister(IClipper c)</p></blockquote><ol type="1"><li>RectMask2D</li></ol><h3 id="graphicrebuild-éƒ¨åˆ†">GraphicRebuild éƒ¨åˆ†</h3><blockquote><p>InputFieldã€Graphic</p></blockquote><h4 id="graphic">Graphic</h4><ul><li><p>Rebuid &gt; åªå¤„ç†äº†CanvasUpdate.PreRenderçŠ¶æ€ã€‚</p><ol type="1"><li>m_VertsDirty å˜åŒ–æ—¶ï¼Œæ‰§è¡ŒMeshçš„ç”Ÿæˆã€‚</li></ol><div class="sourceCode" id="cb4"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Textã€Imageã€RawImageæ—¶ï¼Œ useLegacyMeshGenerationä¸ºtrueã€‚</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="op">(</span>useLegacyMeshGeneration<span class="op">)</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">DoLegacyMeshGeneration</span><span class="op">();</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">else</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">DoMeshGeneration</span><span class="op">();</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span></code></pre></div><div class="sourceCode" id="cb5"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>  <span class="co">//...</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">//å¡«å……é¡¶ç‚¹ã€é¢œè‰²ã€uvç­‰ä¿¡æ¯ã€‚</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">OnPopulateMesh</span><span class="op">(</span>s_VertexHelper<span class="op">);</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">//...</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">GetComponents</span><span class="op">(</span><span class="kw">typeof</span><span class="op">(</span>IMeshModifier<span class="op">),</span> components<span class="op">);</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">//é€šçŸ¥ç›‘å¬è€…ã€‚ä¸»è¦æœ‰ BashMeshEffectã€Outlineã€PositionAsUV1ã€Shadowã€‚</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> components<span class="op">.</span><span class="fu">Count</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>      <span class="op">((</span>IMeshModifier<span class="op">)</span>components<span class="op">[</span>i<span class="op">]).</span><span class="fu">ModifyMesh</span><span class="op">(</span>s_VertexHelper<span class="op">);</span></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// å¡«å……å’Œè®¾ç½®é¡¶ç‚¹ã€‚</span></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  s_VertexHelper<span class="op">.</span><span class="fu">FillMesh</span><span class="op">(</span>workerMesh<span class="op">);</span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  canvasRenderer<span class="op">.</span><span class="fu">SetMesh</span><span class="op">(</span>workerMesh<span class="op">);</span></span></code></pre></div><ol start="2" type="1"><li>m_MaterialDirty å˜æ¢æ—¶ï¼Œæ‰§è¡Œ</li></ol><div class="sourceCode" id="cb6"><pre class="sourceCode cs"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>  canvasRenderer<span class="op">.</span><span class="fu">materialCount</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  canvasRenderer<span class="op">.</span><span class="fu">SetMaterial</span><span class="op">(</span>materialForRendering<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  canvasRenderer<span class="op">.</span><span class="fu">SetTexture</span><span class="op">(</span>mainTexture<span class="op">);</span></span></code></pre></div><p>â€‹</p><p>â€‹</p><p>â€‹</p><p>â€‹</p><p>â€‹</p></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/ugui-yuan-ma-ji-lu/5.ugui-eventsystem/"/>
      <url>/2022/08/10/unity/ugui-yuan-ma-ji-lu/5.ugui-eventsystem/</url>
      
        <content type="html"><![CDATA[<h2 id="uguiä¹‹eventsystem">uGUIä¹‹EventSystem</h2><blockquote><p>UIçš„äº‹ä»¶ç³»ç»Ÿ</p></blockquote><ol type="1"><li><p>EventSystem</p><blockquote><p>uGUIç³»ç»Ÿçš„äº‹ä»¶ç›‘æµ‹æ´¾å‘ç³»ç»Ÿ</p><p>åœ¨updateä¸­ç›‘æµ‹æ‰§è¡Œ, List<baseinputmodule>è¿›è¡Œäº‹ä»¶æ”¶é›†ã€ç›‘æµ‹ã€åˆ†å‘ã€‚</baseinputmodule></p></blockquote><ol type="1"><li><p>å®ç°ç»†èŠ‚</p><blockquote><p>è¾“å…¥ã€ç›‘æµ‹+æ´¾å‘ã€å¤„ç†</p><p>è¾“å…¥ InputModules, åŸºç±» BaseInputModuleï¼Œåˆ†åˆ«å®ç°PointerInputModuleã€StandaloneInputModuleã€TouchInputModuleäº‹ä»¶çš„ç›‘æµ‹åœ¨InputModuleçš„Processå¤„ç†ï¼Œä½¿ç”¨Raycasterç›‘æµ‹å’Œè¾“å…¥äº‹ä»¶æ•°æ®ç”Ÿæˆ, å¹¶è°ƒç”¨ç»Ÿä¸€EventSystemçš„RaycastAllç›‘æµ‹å’Œåˆ†å‘ã€‚</p></blockquote><ol type="1"><li>å¤„ç†ç³»ç»Ÿ</li></ol><div class="sourceCode" id="cb1"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">Update</span><span class="op">()</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>           <span class="co">//è™½ç„¶æ˜¯åˆ—è¡¨ï¼Œè¿˜æ˜¯ä½œä¸ºå•ä¾‹ä½¿ç”¨</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>current <span class="op">!=</span> <span class="kw">this</span><span class="op">)</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span><span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>           <span class="co">//æ›´æ–° InputModules åˆ—è¡¨</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>           <span class="co">//è™½ç„¶æ˜¯åˆ—è¡¨ï¼Œè¿˜æ˜¯ä½œä¸ºå•ä¾‹ä½¿ç”¨</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">TickModules</span><span class="op">();</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">bool</span> changedModule <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> m_SystemInputModules<span class="op">.</span><span class="fu">Count</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>                <span class="dt">var</span> module <span class="op">=</span> m_SystemInputModules<span class="op">[</span>i<span class="op">];</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>module<span class="op">.</span><span class="fu">IsModuleSupported</span><span class="op">()</span> <span class="op">&amp;&amp;</span> module<span class="op">.</span><span class="fu">ShouldActivateModule</span><span class="op">())</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>m_CurrentInputModule <span class="op">!=</span> module<span class="op">)</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ChangeEventModule</span><span class="op">(</span>module<span class="op">);</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                        changedModule <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">break</span><span class="op">;</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            <span class="co">// no event module set... set the first valid one...</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>m_CurrentInputModule <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> m_SystemInputModules<span class="op">.</span><span class="fu">Count</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">var</span> module <span class="op">=</span> m_SystemInputModules<span class="op">[</span>i<span class="op">];</span></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>module<span class="op">.</span><span class="fu">IsModuleSupported</span><span class="op">())</span></span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>                        <span class="co">//è°ƒç”¨pre å–æ¶ˆæ¿€æ´»ï¼Œ modelæ¿€æ´»</span></span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">ChangeEventModule</span><span class="op">(</span>module<span class="op">);</span></span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>                        changedModule <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">break</span><span class="op">;</span></span><span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span><span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>           <span class="co">// åˆ‡æ¢çš„éœ€è¦ç­‰ä¸€å¸§ï¼Œå¦åˆ™ç«‹å³æ‰§è¡Œ Process</span></span><span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(!</span>changedModule <span class="op">&amp;&amp;</span> m_CurrentInputModule <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>                m_CurrentInputModule<span class="op">.</span><span class="fu">Process</span><span class="op">();</span></span><span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div><ol start="2" type="1"><li><p>è¾“å…¥</p><ol type="1"><li><p>BaseInputModuleï¼Œç»§æ‰¿è‡ªUIBehaviour</p><div class="sourceCode" id="cb2"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>       <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">OnEnable</span><span class="op">()</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>            <span class="kw">base</span><span class="op">.</span><span class="fu">OnEnable</span><span class="op">();</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>            m_EventSystem <span class="op">=</span> GetComponent<span class="op">&lt;</span>EventSystem<span class="op">&gt;();</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>            <span class="co">//æ›´æ–°EventSystemçš„BaseInputModuleç»„ä»¶åˆ—è¡¨</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>            m_EventSystem<span class="op">.</span><span class="fu">UpdateModules</span><span class="op">();</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">OnDisable</span><span class="op">()</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">//æ›´æ–°EventSystemçš„BaseInputModuleç»„ä»¶åˆ—è¡¨</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>            m_EventSystem<span class="op">.</span><span class="fu">UpdateModules</span><span class="op">();</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">base</span><span class="op">.</span><span class="fu">OnDisable</span><span class="op">();</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div><div class="sourceCode" id="cb3"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a> <span class="co">// ä¸»è¦çš„å…¬å¼€åŠŸèƒ½ ï¼š</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">abstract</span> <span class="dt">void</span> <span class="fu">Process</span><span class="op">();</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">bool</span> <span class="fu">ShouldActivateModule</span><span class="op">()</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> enabled <span class="op">&amp;&amp;</span> gameObject<span class="op">.</span><span class="fu">activeInHierarchy</span><span class="op">;</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">DeactivateModule</span><span class="op">()</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="op">{}</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">/// Called when the module is activated. Override this if you want custom code to execute when you activate your module.</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">ActivateModule</span><span class="op">()</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="op">{}</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">/// Update the internal state of the Module.</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">UpdateModule</span><span class="op">()</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="op">{}</span></span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co">/// Check to see if the module is supported. Override this if you have a platform specific module (eg. TouchInputModule that you do not want to activate on standalone.)</span></span><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">Is the module supported.</span><span class="kw">&lt;/returns&gt;</span></span><span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">bool</span> <span class="fu">IsModuleSupported</span><span class="op">()</span></span><span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li><li><p>PointerInputModule ç»§æ‰¿è‡ª BaseInputModule</p><blockquote><p>é¼ æ ‡è¾“å…¥ï¼š<code>å·¦é”®</code>ã€<code>å³é”®</code>ã€<code>ä¸­é—´é”®</code>ã€<code>æ¨¡æ‹Ÿè§¦æ‘¸é”®</code></p></blockquote><div class="sourceCode" id="cb4"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">//todo</span></span></code></pre></div></li><li><p>StandaloneInputModule</p><blockquote><p>é¼ æ ‡é”®ç›˜</p></blockquote><ol type="1"><li><p>ShouldActivateModuleå®ç°</p><div class="sourceCode" id="cb5"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ç›‘æµ‹æ˜¯å¦æœ‰è¾“å…¥</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">override</span> <span class="dt">bool</span> <span class="fu">ShouldActivateModule</span><span class="op">()</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// enabled &amp;&amp; gameObject.activeInHierarchy;</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a> <span class="kw">if</span> <span class="op">(!</span><span class="kw">base</span><span class="op">.</span><span class="fu">ShouldActivateModule</span><span class="op">())</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">return</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a> <span class="dt">var</span> shouldActivate <span class="op">=</span> m_ForceModuleActive<span class="op">;</span></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    shouldActivate <span class="op">|=</span> input<span class="op">.</span><span class="fu">GetButtonDown</span><span class="op">(</span>m_SubmitButton<span class="op">);</span></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    shouldActivate <span class="op">|=</span> input<span class="op">.</span><span class="fu">GetButtonDown</span><span class="op">(</span>m_CancelButton<span class="op">);</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    shouldActivate <span class="op">|=</span> <span class="op">!</span>Mathf<span class="op">.</span><span class="fu">Approximately</span><span class="op">(</span>input<span class="op">.</span><span class="fu">GetAxisRaw</span><span class="op">(</span>m_HorizontalAxis<span class="op">),</span> <span class="fl">0.0f</span><span class="op">);</span></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    shouldActivate <span class="op">|=</span> <span class="op">!</span>Mathf<span class="op">.</span><span class="fu">Approximately</span><span class="op">(</span>input<span class="op">.</span><span class="fu">GetAxisRaw</span><span class="op">(</span>m_VerticalAxis<span class="op">),</span> <span class="fl">0.0f</span><span class="op">);</span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    shouldActivate <span class="op">|=</span> <span class="op">(</span>m_MousePosition <span class="op">-</span> m_LastMousePosition<span class="op">).</span><span class="fu">sqrMagnitude</span> <span class="op">&gt;</span> <span class="fl">0.0f</span><span class="op">;</span></span><span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    shouldActivate <span class="op">|=</span> input<span class="op">.</span><span class="fu">GetMouseButtonDown</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>input<span class="op">.</span><span class="fu">touchCount</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>     shouldActivate <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> shouldActivate<span class="op">;</span></span><span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li><li><p>DeactivateModule éæ¿€æ´»çŠ¶æ€æ¸…é™¤å½“å‰å‚¨å­˜çš„è¾“å…¥</p><div class="sourceCode" id="cb6"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">DeactivateModule</span><span class="op">()</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> <span class="kw">base</span><span class="op">.</span><span class="fu">DeactivateModule</span><span class="op">();</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ClearSelection</span><span class="op">();</span></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><div class="sourceCode" id="cb7"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">ClearSelection</span><span class="op">()</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> baseEventData <span class="op">=</span> <span class="fu">GetBaseEventData</span><span class="op">();</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">foreach</span> <span class="op">(</span><span class="dt">var</span> pointer <span class="kw">in</span> m_PointerData<span class="op">.</span><span class="fu">Values</span><span class="op">)</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                <span class="co">// clear all selection</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">HandlePointerExitAndEnter</span><span class="op">(</span>pointer<span class="op">,</span> <span class="kw">null</span><span class="op">);</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>            m_PointerData<span class="op">.</span><span class="fu">Clear</span><span class="op">();</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            eventSystem<span class="op">.</span><span class="fu">SetSelectedGameObject</span><span class="op">(</span><span class="kw">null</span><span class="op">,</span> baseEventData<span class="op">);</span></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div></li><li><p>ActivateModule</p><div class="sourceCode" id="cb8"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">//æ›´æ–°ä½ç½®å’Œé€‰æ‹©ç‰©ä½“</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">ActivateModule</span><span class="op">()</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(!</span>eventSystem<span class="op">.</span><span class="fu">isFocused</span> <span class="op">&amp;&amp;</span> <span class="fu">ShouldIgnoreEventsOnNoFocus</span><span class="op">())</span></span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span><span class="op">;</span></span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            <span class="kw">base</span><span class="op">.</span><span class="fu">ActivateModule</span><span class="op">();</span></span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            m_MousePosition <span class="op">=</span> input<span class="op">.</span><span class="fu">mousePosition</span><span class="op">;</span></span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            m_LastMousePosition <span class="op">=</span> input<span class="op">.</span><span class="fu">mousePosition</span><span class="op">;</span></span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> toSelect <span class="op">=</span> eventSystem<span class="op">.</span><span class="fu">currentSelectedGameObject</span><span class="op">;</span></span><span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>toSelect <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                toSelect <span class="op">=</span> eventSystem<span class="op">.</span><span class="fu">firstSelectedGameObject</span><span class="op">;</span></span><span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>            eventSystem<span class="op">.</span><span class="fu">SetSelectedGameObject</span><span class="op">(</span>toSelect<span class="op">,</span> <span class="fu">GetBaseEventData</span><span class="op">());</span></span><span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div></li><li><p>UpdateModule</p></li></ol><div class="sourceCode" id="cb9"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">UpdateModule</span><span class="op">()</span></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(!</span>eventSystem<span class="op">.</span><span class="fu">isFocused</span> <span class="op">&amp;&amp;</span> <span class="fu">ShouldIgnoreEventsOnNoFocus</span><span class="op">())</span></span><span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>                <span class="co">// æ‹–æ‹½ä¸­</span></span><span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>m_InputPointerEvent <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> m_InputPointerEvent<span class="op">.</span><span class="fu">pointerDrag</span> <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> m_InputPointerEvent<span class="op">.</span><span class="fu">dragging</span><span class="op">)</span></span><span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">ReleaseMouse</span><span class="op">(</span>m_InputPointerEvent<span class="op">,</span> m_InputPointerEvent<span class="op">.</span><span class="fu">pointerCurrentRaycast</span><span class="op">.</span><span class="fu">gameObject</span><span class="op">);</span></span><span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                m_InputPointerEvent <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span><span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span><span class="op">;</span></span><span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            m_LastMousePosition <span class="op">=</span> m_MousePosition<span class="op">;</span></span><span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            m_MousePosition <span class="op">=</span> input<span class="op">.</span><span class="fu">mousePosition</span><span class="op">;</span></span><span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div><ol start="5" type="1"><li><p>IsModuleSupported</p><div class="sourceCode" id="cb10"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>   <span class="kw">public</span> <span class="kw">override</span> <span class="dt">bool</span> <span class="fu">IsModuleSupported</span><span class="op">()</span></span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>             <span class="co">//å¼ºåˆ¶æ¿€æ´» or é¼ æ ‡è®¾å¤‡ or è§¦æ‘¸è®¾å¤‡</span></span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> m_ForceModuleActive <span class="op">||</span> input<span class="op">.</span><span class="fu">mousePresent</span> <span class="op">||</span> input<span class="op">.</span><span class="fu">touchSupported</span><span class="op">;</span></span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div></li><li><p>Process</p><div class="sourceCode" id="cb11"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">//Navigation å’Œé¼ æ ‡äº‹ä»¶</span></span><span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Process</span><span class="op">()</span></span><span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(!</span>eventSystem<span class="op">.</span><span class="fu">isFocused</span> <span class="op">&amp;&amp;</span> <span class="fu">ShouldIgnoreEventsOnNoFocus</span><span class="op">())</span></span><span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span><span class="op">;</span></span><span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">bool</span> usedEvent <span class="op">=</span> <span class="fu">SendUpdateEventToSelectedObject</span><span class="op">();</span></span><span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            <span class="co">// case 1004066 - touch / mouse events should be processed before navigation events in case</span></span><span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            <span class="co">// they change the current selected gameobject and the submit button is a touch / mouse button.</span></span><span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            <span class="co">// touch needs to take precedence because of the mouse emulation layer</span></span><span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="co">//é€šè¿‡BaseRaycasterè¿›è¡Œäº‹ä»¶ç›‘æµ‹</span></span><span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>         <span class="kw">if</span> <span class="op">(!</span><span class="fu">ProcessTouchEvents</span><span class="op">()</span> <span class="op">&amp;&amp;</span> input<span class="op">.</span><span class="fu">mousePresent</span><span class="op">)</span></span><span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>                <span class="co">//ExcuteEvent å›è°ƒè§¦å‘</span></span><span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ProcessMouseEvent</span><span class="op">();</span></span><span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span><span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>eventSystem<span class="op">.</span><span class="fu">sendNavigationEvents</span><span class="op">)</span></span><span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(!</span>usedEvent<span class="op">)</span></span><span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>                    usedEvent <span class="op">|=</span> <span class="fu">SendMoveEventToSelectedObject</span><span class="op">();</span></span><span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span><span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(!</span>usedEvent<span class="op">)</span></span><span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">SendSubmitEventToSelectedObject</span><span class="op">();</span></span><span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div></li></ol></li><li><p>TouchInputModule</p><div class="sourceCode" id="cb12"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">// todo ç±»ä¼¼ StandaloneInputModule</span></span></code></pre></div></li><li><p>å¯¹ç»„ä»¶è¿›è¡Œäº‹ä»¶å›è°ƒ</p><blockquote><p>é€šè¿‡åœ¨EventSystem.ExcuteEventsä¸­è¿›è¡Œè·å–ç»„ä»¶çš„<code>IEventSystemHandler</code>æ¥å£ï¼Œ è¿›è¡Œåˆ†ç±»æ´¾å‘ä¸åŒäº‹ä»¶</p></blockquote><ol type="1"><li>IPointerEnterHandler,</li><li>IPointerExitHandler,</li><li>IPointerDownHandler,</li><li>IPointerUpHandler,</li><li>IPointerClickHandler,</li><li>IInitializePotentialDragHandler,</li><li>IBeginDragHandler,</li><li>IDragHandler,</li><li>IEndDragHandler,</li><li>IDropHandler,</li><li>IScrollHandler,</li><li>IUpdateSelectedHandler,</li><li>ISelectHandler,</li><li>IDeselectHandler,</li><li>IMoveHandler,</li><li>ISubmitHandler,</li><li>ICancelHandler</li></ol></li></ol></li><li><p>Raycaster</p><blockquote><p>è¾…åŠ©ç›‘æµ‹ BaseRaycasteråŸºç±»</p><p>Physics2DRaycasterã€PhysicsRaycasterï¼ŒGraphicRaycaster,ä¸»è¦å®ç°ä¸åŒçš„Raycastå‡½æ•°ï¼ŒåŒºåˆ«åœ¨äº indexï¼Œ sortlayerï¼Œ sortOrder,distance æ³¨å†Œåˆ° RaycasterManager ç»Ÿä¸€è°ƒç”¨</p></blockquote><ol type="1"><li><p>BaseRaycaster</p><div class="sourceCode" id="cb13"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">OnEnable</span><span class="op">()</span></span><span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>            <span class="kw">base</span><span class="op">.</span><span class="fu">OnEnable</span><span class="op">();</span></span><span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>            RaycasterManager<span class="op">.</span><span class="fu">AddRaycaster</span><span class="op">(</span><span class="kw">this</span><span class="op">);</span></span><span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">OnDisable</span><span class="op">()</span></span><span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>            RaycasterManager<span class="op">.</span><span class="fu">RemoveRaycasters</span><span class="op">(</span><span class="kw">this</span><span class="op">);</span></span><span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">base</span><span class="op">.</span><span class="fu">OnDisable</span><span class="op">();</span></span><span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div><div class="sourceCode" id="cb14"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">//çˆ¶èŠ‚ç‚¹ Raycaster</span></span><span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> BaseRaycaster m_RootRaycaster<span class="op">;</span></span></code></pre></div><div class="sourceCode" id="cb15"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">//ä¸»è¦çš„ç›‘æµ‹æ¥å£</span></span><span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">abstract</span> <span class="dt">void</span> <span class="fu">Raycast</span><span class="op">(</span>PointerEventData eventData<span class="op">,</span> List<span class="op">&lt;</span>RaycastResult<span class="op">&gt;</span> resultAppendList<span class="op">);</span></span></code></pre></div><div class="sourceCode" id="cb16"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">//è§¦å‘å°„çº¿ç›‘æµ‹çš„ç›¸æœº</span></span><span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">abstract</span> Camera eventCamera <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="op">}</span></span></code></pre></div></li><li><p>PhysicsRaycaster</p><div class="sourceCode" id="cb17"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Raycast</span><span class="op">(</span>PointerEventData eventData<span class="op">,</span> List<span class="op">&lt;</span>RaycastResult<span class="op">&gt;</span> resultAppendList<span class="op">)</span></span><span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>            Ray ray <span class="op">=</span> <span class="kw">new</span> <span class="fu">Ray</span><span class="op">();</span></span><span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> distanceToClipPlane <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>            <span class="co">// eventPosition = Display.RelativeMouseAt(eventData.position);</span></span><span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>            <span class="co">//1. æ£€æŸ¥ç›¸æœºå’Œæ˜¾ç¤ºå™¨çš„åŒ¹é…</span></span><span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>            <span class="co">//2. æ£€æŸ¥åæ ‡åœ¨ç›¸æœºçš„æ¸²æŸ“åŒºåŸŸå†…</span></span><span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>            <span class="co">//3. æ»¡è¶³æ¡ä»¶çš„æƒ…å†µä¸‹ï¼š</span></span><span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ray = eventCamera.ScreenPointToRay(eventPosition)</span></span><span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>            <span class="co">// float projectionDirection = ray.direction.z;</span></span><span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ç›¸å¯¹ç›¸æœºè·ç¦»çš„å€’æ•°ï¼Œ è·ç¦»ç›¸æœºè¶Šè¿‘ å€¼è¶Šå¤§</span></span><span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Mathf.Abs((eventCamera.farClipPlane - eventCamera.nearClipPlane) / projectionDirection)</span></span><span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(!</span><span class="fu">ComputeRayAndDistance</span><span class="op">(</span>eventData<span class="op">,</span> <span class="kw">ref</span> ray<span class="op">,</span> <span class="kw">ref</span> distanceToClipPlane<span class="op">))</span></span><span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span><span class="op">;</span></span><span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> hitCount <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span><span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>            <span class="co">// è·ç¦» maskè¿›è¡Œraycastå¼•æ“è°ƒç”¨ï¼Œè·å–å°„çº¿ç¢°æ’</span></span><span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>m_MaxRayIntersections <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>ReflectionMethodsCache<span class="op">.</span><span class="fu">Singleton</span><span class="op">.</span><span class="fu">raycast3DAll</span> <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">return</span><span class="op">;</span></span><span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>                m_Hits <span class="op">=</span> ReflectionMethodsCache<span class="op">.</span><span class="fu">Singleton</span><span class="op">.</span><span class="fu">raycast3DAll</span><span class="op">(</span>ray<span class="op">,</span> distanceToClipPlane<span class="op">,</span> finalEventMask<span class="op">);</span></span><span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>                hitCount <span class="op">=</span> m_Hits<span class="op">.</span><span class="fu">Length</span><span class="op">;</span></span><span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span><span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>ReflectionMethodsCache<span class="op">.</span><span class="fu">Singleton</span><span class="op">.</span><span class="fu">getRaycastNonAlloc</span> <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">return</span><span class="op">;</span></span><span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a></span><span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>m_LastMaxRayIntersections <span class="op">!=</span> m_MaxRayIntersections<span class="op">)</span></span><span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a>                    m_Hits <span class="op">=</span> <span class="kw">new</span> RaycastHit<span class="op">[</span>m_MaxRayIntersections<span class="op">];</span></span><span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>                    m_LastMaxRayIntersections <span class="op">=</span> m_MaxRayIntersections<span class="op">;</span></span><span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a></span><span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>                hitCount <span class="op">=</span> ReflectionMethodsCache<span class="op">.</span><span class="fu">Singleton</span><span class="op">.</span><span class="fu">getRaycastNonAlloc</span><span class="op">(</span>ray<span class="op">,</span> m_Hits<span class="op">,</span> distanceToClipPlane<span class="op">,</span> finalEventMask<span class="op">);</span></span><span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a></span><span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>            <span class="co">//è·ç¦»æ’åº</span></span><span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>hitCount <span class="op">&gt;</span> <span class="dv">1</span><span class="op">)</span></span><span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>                System<span class="op">.</span><span class="fu">Array</span><span class="op">.</span><span class="fu">Sort</span><span class="op">(</span>m_Hits<span class="op">,</span> <span class="op">(</span>r1<span class="op">,</span> r2<span class="op">)</span> <span class="op">=&gt;</span> r1<span class="op">.</span><span class="fu">distance</span><span class="op">.</span><span class="fu">CompareTo</span><span class="op">(</span>r2<span class="op">.</span><span class="fu">distance</span><span class="op">));</span></span><span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a></span><span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>            <span class="co">// RaycastHit è½¬æ¢æˆRaycastResult æ·»åŠ åˆ°åˆ—è¡¨</span></span><span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>hitCount <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> b <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> bmax <span class="op">=</span> hitCount<span class="op">;</span> b <span class="op">&lt;</span> bmax<span class="op">;</span> <span class="op">++</span>b<span class="op">)</span></span><span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">var</span> result <span class="op">=</span> <span class="kw">new</span> RaycastResult</span><span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span><span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>                        gameObject <span class="op">=</span> m_Hits<span class="op">[</span>b<span class="op">].</span><span class="fu">collider</span><span class="op">.</span><span class="fu">gameObject</span><span class="op">,</span></span><span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>                        module <span class="op">=</span> <span class="kw">this</span><span class="op">,</span></span><span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>                        distance <span class="op">=</span> m_Hits<span class="op">[</span>b<span class="op">].</span><span class="fu">distance</span><span class="op">,</span></span><span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>                        worldPosition <span class="op">=</span> m_Hits<span class="op">[</span>b<span class="op">].</span><span class="fu">point</span><span class="op">,</span></span><span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>                        worldNormal <span class="op">=</span> m_Hits<span class="op">[</span>b<span class="op">].</span><span class="fu">normal</span><span class="op">,</span></span><span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>                        screenPosition <span class="op">=</span> eventData<span class="op">.</span><span class="fu">position</span><span class="op">,</span></span><span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>                        index <span class="op">=</span> resultAppendList<span class="op">.</span><span class="fu">Count</span><span class="op">,</span></span><span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>                        sortingLayer <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span><span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>                        sortingOrder <span class="op">=</span> <span class="dv">0</span></span><span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>                    <span class="op">};</span></span><span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>                    resultAppendList<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>result<span class="op">);</span></span><span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div></li><li><p>GraphicRaycaster ç»§æ‰¿è‡ª BaseRaycaster</p><div class="sourceCode" id="cb18"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Raycast</span><span class="op">(</span>PointerEventData eventData<span class="op">,</span> List<span class="op">&lt;</span>RaycastResult<span class="op">&gt;</span> resultAppendList<span class="op">)</span></span><span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>            <span class="co">//uiéœ€è¦åœ¨Canvasä¸‹</span></span><span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>canvas <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span><span class="op">;</span></span><span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>            <span class="co">//å¯æ¸²æŸ“ç»„ä»¶</span></span><span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> canvasGraphics <span class="op">=</span> GraphicRegistry<span class="op">.</span><span class="fu">GetGraphicsForCanvas</span><span class="op">(</span>canvas<span class="op">);</span></span><span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>canvasGraphics <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> canvasGraphics<span class="op">.</span><span class="fu">Count</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span><span class="op">;</span></span><span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>            <span class="co">//æ¡ä»¶ç›‘æµ‹ï¼š1. åŒç›¸æœºåŒæ˜¾ç¤ºç›®æ ‡ï¼Œ2. éœ€è¦åæ ‡åœ¨æ˜¾ç¤ºçš„èŒƒå›´å†…</span></span><span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> displayIndex<span class="op">;</span></span><span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> currentEventCamera <span class="op">=</span> eventCamera<span class="op">;</span> <span class="co">// Property can call Camera.main, so cache the reference</span></span><span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>canvas<span class="op">.</span><span class="fu">renderMode</span> <span class="op">==</span> RenderMode<span class="op">.</span><span class="fu">ScreenSpaceOverlay</span> <span class="op">||</span> currentEventCamera <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>                displayIndex <span class="op">=</span> canvas<span class="op">.</span><span class="fu">targetDisplay</span><span class="op">;</span></span><span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span><span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>                displayIndex <span class="op">=</span> currentEventCamera<span class="op">.</span><span class="fu">targetDisplay</span><span class="op">;</span></span><span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> eventPosition <span class="op">=</span> Display<span class="op">.</span><span class="fu">RelativeMouseAt</span><span class="op">(</span>eventData<span class="op">.</span><span class="fu">position</span><span class="op">);</span></span><span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>eventPosition <span class="op">!=</span> Vector3<span class="op">.</span><span class="fu">zero</span><span class="op">)</span></span><span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>                <span class="co">// We support multiple display and display identification based on event position.</span></span><span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>                <span class="dt">int</span> eventDisplayIndex <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>eventPosition<span class="op">.</span><span class="fu">z</span><span class="op">;</span></span><span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Discard events that are not part of this display so the user does not interact with multiple displays at once.</span></span><span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>eventDisplayIndex <span class="op">!=</span> displayIndex<span class="op">)</span></span><span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">return</span><span class="op">;</span></span><span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span><span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>                <span class="co">// The multiple display system is not supported on all platforms, when it is not supported the returned position</span></span><span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>                <span class="co">// will be all zeros so when the returned index is 0 we will default to the event data to be safe.</span></span><span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>                eventPosition <span class="op">=</span> eventData<span class="op">.</span><span class="fu">position</span><span class="op">;</span></span><span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>                <span class="co">// We dont really know in which display the event occured. We will process the event assuming it occured in our display.</span></span><span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Convert to view space</span></span><span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>            Vector2 pos<span class="op">;</span></span><span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>currentEventCamera <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Multiple display support only when not the main display. For display 0 the reported</span></span><span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>                <span class="co">// resolution is always the desktops resolution since its part of the display API,</span></span><span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>                <span class="co">// so we use the standard none multiple display method. (case 741751)</span></span><span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>                <span class="dt">float</span> w <span class="op">=</span> Screen<span class="op">.</span><span class="fu">width</span><span class="op">;</span></span><span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>                <span class="dt">float</span> h <span class="op">=</span> Screen<span class="op">.</span><span class="fu">height</span><span class="op">;</span></span><span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>displayIndex <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> displayIndex <span class="op">&lt;</span> Display<span class="op">.</span><span class="fu">displays</span><span class="op">.</span><span class="fu">Length</span><span class="op">)</span></span><span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>                    w <span class="op">=</span> Display<span class="op">.</span><span class="fu">displays</span><span class="op">[</span>displayIndex<span class="op">].</span><span class="fu">systemWidth</span><span class="op">;</span></span><span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>                    h <span class="op">=</span> Display<span class="op">.</span><span class="fu">displays</span><span class="op">[</span>displayIndex<span class="op">].</span><span class="fu">systemHeight</span><span class="op">;</span></span><span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>                pos <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector2</span><span class="op">(</span>eventPosition<span class="op">.</span><span class="fu">x</span> <span class="op">/</span> w<span class="op">,</span> eventPosition<span class="op">.</span><span class="fu">y</span> <span class="op">/</span> h<span class="op">);</span></span><span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span><span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a>                pos <span class="op">=</span> currentEventCamera<span class="op">.</span><span class="fu">ScreenToViewportPoint</span><span class="op">(</span>eventPosition<span class="op">);</span></span><span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a>            <span class="co">// If it's outside the camera's viewport, do nothing</span></span><span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>pos<span class="op">.</span><span class="fu">x</span> <span class="op">&lt;</span> 0f <span class="op">||</span> pos<span class="op">.</span><span class="fu">x</span> <span class="op">&gt;</span> 1f <span class="op">||</span> pos<span class="op">.</span><span class="fu">y</span> <span class="op">&lt;</span> 0f <span class="op">||</span> pos<span class="op">.</span><span class="fu">y</span> <span class="op">&gt;</span> 1f<span class="op">)</span></span><span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span><span class="op">;</span></span><span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> hitDistance <span class="op">=</span> <span class="dt">float</span><span class="op">.</span><span class="fu">MaxValue</span><span class="op">;</span></span><span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a>            Ray ray <span class="op">=</span> <span class="kw">new</span> <span class="fu">Ray</span><span class="op">();</span></span><span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a>            <span class="co">//å°„çº¿ç›‘æµ‹ï¼Œè·å–ç¬¬ä¸€ä¸ªç¢°æ’çš„ä¿¡æ¯</span></span><span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>currentEventCamera <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a>                ray <span class="op">=</span> currentEventCamera<span class="op">.</span><span class="fu">ScreenPointToRay</span><span class="op">(</span>eventPosition<span class="op">);</span></span><span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>canvas<span class="op">.</span><span class="fu">renderMode</span> <span class="op">!=</span> RenderMode<span class="op">.</span><span class="fu">ScreenSpaceOverlay</span> <span class="op">&amp;&amp;</span> blockingObjects <span class="op">!=</span> BlockingObjects<span class="op">.</span><span class="fu">None</span><span class="op">)</span></span><span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>                <span class="dt">float</span> distanceToClipPlane <span class="op">=</span> <span class="fl">100.0f</span><span class="op">;</span></span><span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>currentEventCamera <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">float</span> projectionDirection <span class="op">=</span> ray<span class="op">.</span><span class="fu">direction</span><span class="op">.</span><span class="fu">z</span><span class="op">;</span></span><span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>                    distanceToClipPlane <span class="op">=</span> Mathf<span class="op">.</span><span class="fu">Approximately</span><span class="op">(</span><span class="fl">0.0f</span><span class="op">,</span> projectionDirection<span class="op">)</span></span><span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>                        <span class="op">?</span> Mathf<span class="op">.</span><span class="fu">Infinity</span></span><span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>                        <span class="op">:</span> Mathf<span class="op">.</span><span class="fu">Abs</span><span class="op">((</span>currentEventCamera<span class="op">.</span><span class="fu">farClipPlane</span> <span class="op">-</span> currentEventCamera<span class="op">.</span><span class="fu">nearClipPlane</span><span class="op">)</span> <span class="op">/</span> projectionDirection<span class="op">);</span></span><span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>blockingObjects <span class="op">==</span> BlockingObjects<span class="op">.</span><span class="fu">ThreeD</span> <span class="op">||</span> blockingObjects <span class="op">==</span> BlockingObjects<span class="op">.</span><span class="fu">All</span><span class="op">)</span></span><span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>ReflectionMethodsCache<span class="op">.</span><span class="fu">Singleton</span><span class="op">.</span><span class="fu">raycast3D</span> <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span><span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">var</span> hits <span class="op">=</span> ReflectionMethodsCache<span class="op">.</span><span class="fu">Singleton</span><span class="op">.</span><span class="fu">raycast3DAll</span><span class="op">(</span>ray<span class="op">,</span> distanceToClipPlane<span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>m_BlockingMask<span class="op">);</span></span><span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">if</span> <span class="op">(</span>hits<span class="op">.</span><span class="fu">Length</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a>                            hitDistance <span class="op">=</span> hits<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">distance</span><span class="op">;</span></span><span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span><span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>blockingObjects <span class="op">==</span> BlockingObjects<span class="op">.</span><span class="fu">TwoD</span> <span class="op">||</span> blockingObjects <span class="op">==</span> BlockingObjects<span class="op">.</span><span class="fu">All</span><span class="op">)</span></span><span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>ReflectionMethodsCache<span class="op">.</span><span class="fu">Singleton</span><span class="op">.</span><span class="fu">raycast2D</span> <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span><span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">var</span> hits <span class="op">=</span> ReflectionMethodsCache<span class="op">.</span><span class="fu">Singleton</span><span class="op">.</span><span class="fu">getRayIntersectionAll</span><span class="op">(</span>ray<span class="op">,</span> distanceToClipPlane<span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>m_BlockingMask<span class="op">);</span></span><span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">if</span> <span class="op">(</span>hits<span class="op">.</span><span class="fu">Length</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>                            hitDistance <span class="op">=</span> hits<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">distance</span><span class="op">;</span></span><span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span><span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>            m_RaycastResults<span class="op">.</span><span class="fu">Clear</span><span class="op">();</span></span><span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a>            <span class="co">//ä»ç¬¦åˆæ¡ä»¶çš„å¯æ¸²æŸ“ç»„ä»¶è¿›è¡Œä½ç½®ç›‘æµ‹</span></span><span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a>            <span class="fu">Raycast</span><span class="op">(</span>canvas<span class="op">,</span> currentEventCamera<span class="op">,</span> eventPosition<span class="op">,</span> canvasGraphics<span class="op">,</span> m_RaycastResults<span class="op">);</span></span><span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> totalCount <span class="op">=</span> m_RaycastResults<span class="op">.</span><span class="fu">Count</span><span class="op">;</span></span><span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> index <span class="op">&lt;</span> totalCount<span class="op">;</span> index<span class="op">++)</span></span><span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a>                <span class="dt">var</span> go <span class="op">=</span> m_RaycastResults<span class="op">[</span>index<span class="op">].</span><span class="fu">gameObject</span><span class="op">;</span></span><span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a>                <span class="dt">bool</span> appendGraphic <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>ignoreReversedGraphics<span class="op">)</span></span><span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a>                    <span class="co">//ç›‘æµ‹UIæ˜¯å¦å‚ç›´äºç›¸æœº</span></span><span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>currentEventCamera <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb18-116"><a href="#cb18-116" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span><span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// If we dont have a camera we know that we should always be facing forward</span></span><span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">var</span> dir <span class="op">=</span> go<span class="op">.</span><span class="fu">transform</span><span class="op">.</span><span class="fu">rotation</span> <span class="op">*</span> Vector3<span class="op">.</span><span class="fu">forward</span><span class="op">;</span></span><span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a>                        appendGraphic <span class="op">=</span> Vector3<span class="op">.</span><span class="fu">Dot</span><span class="op">(</span>Vector3<span class="op">.</span><span class="fu">forward</span><span class="op">,</span> dir<span class="op">)</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span><span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">else</span></span><span id="cb18-122"><a href="#cb18-122" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span><span id="cb18-123"><a href="#cb18-123" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// If we have a camera compare the direction against the cameras forward.</span></span><span id="cb18-124"><a href="#cb18-124" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">var</span> cameraFoward <span class="op">=</span> currentEventCamera<span class="op">.</span><span class="fu">transform</span><span class="op">.</span><span class="fu">rotation</span> <span class="op">*</span> Vector3<span class="op">.</span><span class="fu">forward</span><span class="op">;</span></span><span id="cb18-125"><a href="#cb18-125" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">var</span> dir <span class="op">=</span> go<span class="op">.</span><span class="fu">transform</span><span class="op">.</span><span class="fu">rotation</span> <span class="op">*</span> Vector3<span class="op">.</span><span class="fu">forward</span><span class="op">;</span></span><span id="cb18-126"><a href="#cb18-126" aria-hidden="true" tabindex="-1"></a>                        appendGraphic <span class="op">=</span> Vector3<span class="op">.</span><span class="fu">Dot</span><span class="op">(</span>cameraFoward<span class="op">,</span> dir<span class="op">)</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb18-127"><a href="#cb18-127" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span><span id="cb18-128"><a href="#cb18-128" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb18-129"><a href="#cb18-129" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-130"><a href="#cb18-130" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>appendGraphic<span class="op">)</span></span><span id="cb18-131"><a href="#cb18-131" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb18-132"><a href="#cb18-132" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">float</span> distance <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb18-133"><a href="#cb18-133" aria-hidden="true" tabindex="-1"></a>                    Transform trans <span class="op">=</span> go<span class="op">.</span><span class="fu">transform</span><span class="op">;</span></span><span id="cb18-134"><a href="#cb18-134" aria-hidden="true" tabindex="-1"></a>                    Vector3 transForward <span class="op">=</span> trans<span class="op">.</span><span class="fu">forward</span><span class="op">;</span></span><span id="cb18-135"><a href="#cb18-135" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-136"><a href="#cb18-136" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>currentEventCamera <span class="op">==</span> <span class="kw">null</span> <span class="op">||</span> canvas<span class="op">.</span><span class="fu">renderMode</span> <span class="op">==</span> RenderMode<span class="op">.</span><span class="fu">ScreenSpaceOverlay</span><span class="op">)</span></span><span id="cb18-137"><a href="#cb18-137" aria-hidden="true" tabindex="-1"></a>                        distance <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb18-138"><a href="#cb18-138" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">else</span></span><span id="cb18-139"><a href="#cb18-139" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span><span id="cb18-140"><a href="#cb18-140" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// http://geomalgorithms.com/a06-_intersect-2.html</span></span><span id="cb18-141"><a href="#cb18-141" aria-hidden="true" tabindex="-1"></a>                        distance <span class="op">=</span> <span class="op">(</span>Vector3<span class="op">.</span><span class="fu">Dot</span><span class="op">(</span>transForward<span class="op">,</span> trans<span class="op">.</span><span class="fu">position</span> <span class="op">-</span> ray<span class="op">.</span><span class="fu">origin</span><span class="op">)</span> <span class="op">/</span> Vector3<span class="op">.</span><span class="fu">Dot</span><span class="op">(</span>transForward<span class="op">,</span> ray<span class="op">.</span><span class="fu">direction</span><span class="op">));</span></span><span id="cb18-142"><a href="#cb18-142" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-143"><a href="#cb18-143" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// Check to see if the go is behind the camera.</span></span><span id="cb18-144"><a href="#cb18-144" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">if</span> <span class="op">(</span>distance <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb18-145"><a href="#cb18-145" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">continue</span><span class="op">;</span></span><span id="cb18-146"><a href="#cb18-146" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span><span id="cb18-147"><a href="#cb18-147" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-148"><a href="#cb18-148" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>distance <span class="op">&gt;=</span> hitDistance<span class="op">)</span></span><span id="cb18-149"><a href="#cb18-149" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">continue</span><span class="op">;</span></span><span id="cb18-150"><a href="#cb18-150" aria-hidden="true" tabindex="-1"></a></span><span id="cb18-151"><a href="#cb18-151" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">var</span> castResult <span class="op">=</span> <span class="kw">new</span> RaycastResult</span><span id="cb18-152"><a href="#cb18-152" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span><span id="cb18-153"><a href="#cb18-153" aria-hidden="true" tabindex="-1"></a>                        gameObject <span class="op">=</span> go<span class="op">,</span></span><span id="cb18-154"><a href="#cb18-154" aria-hidden="true" tabindex="-1"></a>                        module <span class="op">=</span> <span class="kw">this</span><span class="op">,</span></span><span id="cb18-155"><a href="#cb18-155" aria-hidden="true" tabindex="-1"></a>                        distance <span class="op">=</span> distance<span class="op">,</span></span><span id="cb18-156"><a href="#cb18-156" aria-hidden="true" tabindex="-1"></a>                        screenPosition <span class="op">=</span> eventPosition<span class="op">,</span></span><span id="cb18-157"><a href="#cb18-157" aria-hidden="true" tabindex="-1"></a>                        index <span class="op">=</span> resultAppendList<span class="op">.</span><span class="fu">Count</span><span class="op">,</span></span><span id="cb18-158"><a href="#cb18-158" aria-hidden="true" tabindex="-1"></a>                        depth <span class="op">=</span> m_RaycastResults<span class="op">[</span>index<span class="op">].</span><span class="fu">depth</span><span class="op">,</span></span><span id="cb18-159"><a href="#cb18-159" aria-hidden="true" tabindex="-1"></a>                        sortingLayer <span class="op">=</span> canvas<span class="op">.</span><span class="fu">sortingLayerID</span><span class="op">,</span></span><span id="cb18-160"><a href="#cb18-160" aria-hidden="true" tabindex="-1"></a>                        sortingOrder <span class="op">=</span> canvas<span class="op">.</span><span class="fu">sortingOrder</span><span class="op">,</span></span><span id="cb18-161"><a href="#cb18-161" aria-hidden="true" tabindex="-1"></a>                        worldPosition <span class="op">=</span> ray<span class="op">.</span><span class="fu">origin</span> <span class="op">+</span> ray<span class="op">.</span><span class="fu">direction</span> <span class="op">*</span> distance<span class="op">,</span></span><span id="cb18-162"><a href="#cb18-162" aria-hidden="true" tabindex="-1"></a>                        worldNormal <span class="op">=</span> <span class="op">-</span>transForward</span><span id="cb18-163"><a href="#cb18-163" aria-hidden="true" tabindex="-1"></a>                    <span class="op">};</span></span><span id="cb18-164"><a href="#cb18-164" aria-hidden="true" tabindex="-1"></a>                    resultAppendList<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>castResult<span class="op">);</span></span><span id="cb18-165"><a href="#cb18-165" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb18-166"><a href="#cb18-166" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb18-167"><a href="#cb18-167" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div><div class="sourceCode" id="cb19"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">//RectTransformçš„Raycastç›‘æµ‹æ–¹å¼</span></span><span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Raycast</span><span class="op">(</span>Canvas canvas<span class="op">,</span> Camera eventCamera<span class="op">,</span> Vector2 pointerPosition<span class="op">,</span> IList<span class="op">&lt;</span>Graphic<span class="op">&gt;</span> foundGraphics<span class="op">,</span> List<span class="op">&lt;</span>Graphic<span class="op">&gt;</span> results<span class="op">)</span></span><span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Necessary for the event system</span></span><span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> totalCount <span class="op">=</span> foundGraphics<span class="op">.</span><span class="fu">Count</span><span class="op">;</span></span><span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> totalCount<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span></span><span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                Graphic graphic <span class="op">=</span> foundGraphics<span class="op">[</span>i<span class="op">];</span></span><span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                <span class="co">// -1 means it hasn't been processed by the canvas, which means it isn't actually drawn</span></span><span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>graphic<span class="op">.</span><span class="fu">depth</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span> <span class="op">||</span> <span class="op">!</span>graphic<span class="op">.</span><span class="fu">raycastTarget</span> <span class="op">||</span> graphic<span class="op">.</span><span class="fu">canvasRenderer</span><span class="op">.</span><span class="fu">cull</span><span class="op">)</span></span><span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">continue</span><span class="op">;</span></span><span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(!</span>RectTransformUtility<span class="op">.</span><span class="fu">RectangleContainsScreenPoint</span><span class="op">(</span>graphic<span class="op">.</span><span class="fu">rectTransform</span><span class="op">,</span> pointerPosition<span class="op">,</span> eventCamera<span class="op">))</span></span><span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">continue</span><span class="op">;</span></span><span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>                <span class="co">// z ä¸èƒ½è¶…è¿‡è¿œè£å‰ªé¢</span></span><span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>eventCamera <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> eventCamera<span class="op">.</span><span class="fu">WorldToScreenPoint</span><span class="op">(</span>graphic<span class="op">.</span><span class="fu">rectTransform</span><span class="op">.</span><span class="fu">position</span><span class="op">).</span><span class="fu">z</span> <span class="op">&gt;</span> eventCamera<span class="op">.</span><span class="fu">farClipPlane</span><span class="op">)</span></span><span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">continue</span><span class="op">;</span></span><span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a></span><span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>graphic<span class="op">.</span><span class="fu">Raycast</span><span class="op">(</span>pointerPosition<span class="op">,</span> eventCamera<span class="op">))</span></span><span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>                    s_SortedGraphics<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>graphic<span class="op">);</span></span><span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span><span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>            s_SortedGraphics<span class="op">.</span><span class="fu">Sort</span><span class="op">((</span>g1<span class="op">,</span> g2<span class="op">)</span> <span class="op">=&gt;</span> g2<span class="op">.</span><span class="fu">depth</span><span class="op">.</span><span class="fu">CompareTo</span><span class="op">(</span>g1<span class="op">.</span><span class="fu">depth</span><span class="op">));</span></span><span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>            totalCount <span class="op">=</span> s_SortedGraphics<span class="op">.</span><span class="fu">Count</span><span class="op">;</span></span><span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> totalCount<span class="op">;</span> <span class="op">++</span>i<span class="op">)</span></span><span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>                results<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>s_SortedGraphics<span class="op">[</span>i<span class="op">]);</span></span><span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a></span><span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>            s_SortedGraphics<span class="op">.</span><span class="fu">Clear</span><span class="op">();</span></span><span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div></li><li><p>Physics2DRaycaster ç»§æ‰¿è‡ª PhysicsRaycaster</p></li></ol><div class="sourceCode" id="cb20"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">Raycast</span><span class="op">(</span>PointerEventData eventData<span class="op">,</span> List<span class="op">&lt;</span>RaycastResult<span class="op">&gt;</span> resultAppendList<span class="op">)</span></span><span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>            Ray ray <span class="op">=</span> <span class="kw">new</span> <span class="fu">Ray</span><span class="op">();</span></span><span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> distanceToClipPlane <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(!</span><span class="fu">ComputeRayAndDistance</span><span class="op">(</span>eventData<span class="op">,</span> <span class="kw">ref</span> ray<span class="op">,</span> <span class="kw">ref</span> distanceToClipPlane<span class="op">))</span></span><span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span><span class="op">;</span></span><span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> hitCount <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>maxRayIntersections <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>ReflectionMethodsCache<span class="op">.</span><span class="fu">Singleton</span><span class="op">.</span><span class="fu">getRayIntersectionAll</span> <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">return</span><span class="op">;</span></span><span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                m_Hits <span class="op">=</span> ReflectionMethodsCache<span class="op">.</span><span class="fu">Singleton</span><span class="op">.</span><span class="fu">getRayIntersectionAll</span><span class="op">(</span>ray<span class="op">,</span> distanceToClipPlane<span class="op">,</span> finalEventMask<span class="op">);</span></span><span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>                hitCount <span class="op">=</span> m_Hits<span class="op">.</span><span class="fu">Length</span><span class="op">;</span></span><span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span><span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>ReflectionMethodsCache<span class="op">.</span><span class="fu">Singleton</span><span class="op">.</span><span class="fu">getRayIntersectionAllNonAlloc</span> <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">return</span><span class="op">;</span></span><span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span><span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>m_LastMaxRayIntersections <span class="op">!=</span> m_MaxRayIntersections<span class="op">)</span></span><span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>                    m_Hits <span class="op">=</span> <span class="kw">new</span> RaycastHit2D<span class="op">[</span>maxRayIntersections<span class="op">];</span></span><span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>                    m_LastMaxRayIntersections <span class="op">=</span> m_MaxRayIntersections<span class="op">;</span></span><span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a></span><span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>                hitCount <span class="op">=</span> ReflectionMethodsCache<span class="op">.</span><span class="fu">Singleton</span><span class="op">.</span><span class="fu">getRayIntersectionAllNonAlloc</span><span class="op">(</span>ray<span class="op">,</span> m_Hits<span class="op">,</span> distanceToClipPlane<span class="op">,</span> finalEventMask<span class="op">);</span></span><span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a></span><span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>hitCount <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> b <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> bmax <span class="op">=</span> hitCount<span class="op">;</span> b <span class="op">&lt;</span> bmax<span class="op">;</span> <span class="op">++</span>b<span class="op">)</span></span><span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">var</span> sr <span class="op">=</span> m_Hits<span class="op">[</span>b<span class="op">].</span><span class="fu">collider</span><span class="op">.</span><span class="fu">gameObject</span><span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>SpriteRenderer<span class="op">&gt;();</span></span><span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a></span><span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">var</span> result <span class="op">=</span> <span class="kw">new</span> RaycastResult</span><span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span><span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>                        gameObject <span class="op">=</span> m_Hits<span class="op">[</span>b<span class="op">].</span><span class="fu">collider</span><span class="op">.</span><span class="fu">gameObject</span><span class="op">,</span></span><span id="cb20-41"><a href="#cb20-41" aria-hidden="true" tabindex="-1"></a>                        module <span class="op">=</span> <span class="kw">this</span><span class="op">,</span></span><span id="cb20-42"><a href="#cb20-42" aria-hidden="true" tabindex="-1"></a>                        distance <span class="op">=</span> Vector3<span class="op">.</span><span class="fu">Distance</span><span class="op">(</span>eventCamera<span class="op">.</span><span class="fu">transform</span><span class="op">.</span><span class="fu">position</span><span class="op">,</span> m_Hits<span class="op">[</span>b<span class="op">].</span><span class="fu">point</span><span class="op">),</span></span><span id="cb20-43"><a href="#cb20-43" aria-hidden="true" tabindex="-1"></a>                        worldPosition <span class="op">=</span> m_Hits<span class="op">[</span>b<span class="op">].</span><span class="fu">point</span><span class="op">,</span></span><span id="cb20-44"><a href="#cb20-44" aria-hidden="true" tabindex="-1"></a>                        worldNormal <span class="op">=</span> m_Hits<span class="op">[</span>b<span class="op">].</span><span class="fu">normal</span><span class="op">,</span></span><span id="cb20-45"><a href="#cb20-45" aria-hidden="true" tabindex="-1"></a>                        screenPosition <span class="op">=</span> eventData<span class="op">.</span><span class="fu">position</span><span class="op">,</span></span><span id="cb20-46"><a href="#cb20-46" aria-hidden="true" tabindex="-1"></a>                        index <span class="op">=</span> resultAppendList<span class="op">.</span><span class="fu">Count</span><span class="op">,</span></span><span id="cb20-47"><a href="#cb20-47" aria-hidden="true" tabindex="-1"></a>                        sortingLayer <span class="op">=</span>  sr <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> sr<span class="op">.</span><span class="fu">sortingLayerID</span> <span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span><span id="cb20-48"><a href="#cb20-48" aria-hidden="true" tabindex="-1"></a>                        sortingOrder <span class="op">=</span> sr <span class="op">!=</span> <span class="kw">null</span> <span class="op">?</span> sr<span class="op">.</span><span class="fu">sortingOrder</span> <span class="op">:</span> <span class="dv">0</span></span><span id="cb20-49"><a href="#cb20-49" aria-hidden="true" tabindex="-1"></a>                    <span class="op">};</span></span><span id="cb20-50"><a href="#cb20-50" aria-hidden="true" tabindex="-1"></a>                    resultAppendList<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>result<span class="op">);</span></span><span id="cb20-51"><a href="#cb20-51" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb20-52"><a href="#cb20-52" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb20-53"><a href="#cb20-53" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div><ol start="5" type="1"><li><p>äº‹ä»¶æ’åºè§„åˆ™</p><div class="sourceCode" id="cb21"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">private</span> <span class="kw">static</span> <span class="dt">int</span> <span class="fu">RaycastComparer</span><span class="op">(</span>RaycastResult lhs<span class="op">,</span> RaycastResult rhs<span class="op">)</span></span><span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>            <span class="co">//ä¸åŒçš„ BaseRaycaster</span></span><span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>lhs<span class="op">.</span><span class="fu">module</span> <span class="op">!=</span> rhs<span class="op">.</span><span class="fu">module</span><span class="op">)</span></span><span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                <span class="dt">var</span> lhsEventCamera <span class="op">=</span> lhs<span class="op">.</span><span class="fu">module</span><span class="op">.</span><span class="fu">eventCamera</span><span class="op">;</span></span><span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                <span class="dt">var</span> rhsEventCamera <span class="op">=</span> rhs<span class="op">.</span><span class="fu">module</span><span class="op">.</span><span class="fu">eventCamera</span><span class="op">;</span></span><span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>                <span class="co">//1. Raycasterçš„ä¸ç›¸æœºçš„depth è¶Šå°è¶Šé å‰</span></span><span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>lhsEventCamera <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> rhsEventCamera <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> lhsEventCamera<span class="op">.</span><span class="fu">depth</span> <span class="op">!=</span> rhsEventCamera<span class="op">.</span><span class="fu">depth</span><span class="op">)</span></span><span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                    <span class="co">// need to reverse the standard compareTo</span></span><span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>lhsEventCamera<span class="op">.</span><span class="fu">depth</span> <span class="op">&lt;</span> rhsEventCamera<span class="op">.</span><span class="fu">depth</span><span class="op">)</span></span><span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>lhsEventCamera<span class="op">.</span><span class="fu">depth</span> <span class="op">==</span> rhsEventCamera<span class="op">.</span><span class="fu">depth</span><span class="op">)</span></span><span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span><span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span><span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>                <span class="co">//2. Raycasterçš„æ’åºä¼˜å…ˆçº§</span></span><span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>lhs<span class="op">.</span><span class="fu">module</span><span class="op">.</span><span class="fu">sortOrderPriority</span> <span class="op">!=</span> rhs<span class="op">.</span><span class="fu">module</span><span class="op">.</span><span class="fu">sortOrderPriority</span><span class="op">)</span></span><span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">return</span> rhs<span class="op">.</span><span class="fu">module</span><span class="op">.</span><span class="fu">sortOrderPriority</span><span class="op">.</span><span class="fu">CompareTo</span><span class="op">(</span>lhs<span class="op">.</span><span class="fu">module</span><span class="op">.</span><span class="fu">sortOrderPriority</span><span class="op">);</span></span><span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>                <span class="co">//3. Raycasterçš„æ¸²æŸ“ä¼˜å…ˆçº§</span></span><span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>lhs<span class="op">.</span><span class="fu">module</span><span class="op">.</span><span class="fu">renderOrderPriority</span> <span class="op">!=</span> rhs<span class="op">.</span><span class="fu">module</span><span class="op">.</span><span class="fu">renderOrderPriority</span><span class="op">)</span></span><span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">return</span> rhs<span class="op">.</span><span class="fu">module</span><span class="op">.</span><span class="fu">renderOrderPriority</span><span class="op">.</span><span class="fu">CompareTo</span><span class="op">(</span>lhs<span class="op">.</span><span class="fu">module</span><span class="op">.</span><span class="fu">renderOrderPriority</span><span class="op">);</span></span><span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a></span><span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>            <span class="co">//å±‚çº§æ’åº</span></span><span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>lhs<span class="op">.</span><span class="fu">sortingLayer</span> <span class="op">!=</span> rhs<span class="op">.</span><span class="fu">sortingLayer</span><span class="op">)</span></span><span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Uses the layer value to properly compare the relative order of the layers.</span></span><span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>                <span class="dt">var</span> rid <span class="op">=</span> SortingLayer<span class="op">.</span><span class="fu">GetLayerValueFromID</span><span class="op">(</span>rhs<span class="op">.</span><span class="fu">sortingLayer</span><span class="op">);</span></span><span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>                <span class="dt">var</span> lid <span class="op">=</span> SortingLayer<span class="op">.</span><span class="fu">GetLayerValueFromID</span><span class="op">(</span>lhs<span class="op">.</span><span class="fu">sortingLayer</span><span class="op">);</span></span><span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> rid<span class="op">.</span><span class="fu">CompareTo</span><span class="op">(</span>lid<span class="op">);</span></span><span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a></span><span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>            <span class="co">//æ·±åº¦å€¼æ’åº</span></span><span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>lhs<span class="op">.</span><span class="fu">sortingOrder</span> <span class="op">!=</span> rhs<span class="op">.</span><span class="fu">sortingOrder</span><span class="op">)</span></span><span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> rhs<span class="op">.</span><span class="fu">sortingOrder</span><span class="op">.</span><span class="fu">CompareTo</span><span class="op">(</span>lhs<span class="op">.</span><span class="fu">sortingOrder</span><span class="op">);</span></span><span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a></span><span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>            <span class="co">// comparing depth only makes sense if the two raycast results have the same root canvas (case 912396)</span></span><span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>lhs<span class="op">.</span><span class="fu">depth</span> <span class="op">!=</span> rhs<span class="op">.</span><span class="fu">depth</span> <span class="op">&amp;&amp;</span> lhs<span class="op">.</span><span class="fu">module</span><span class="op">.</span><span class="fu">rootRaycaster</span> <span class="op">==</span> rhs<span class="op">.</span><span class="fu">module</span><span class="op">.</span><span class="fu">rootRaycaster</span><span class="op">)</span></span><span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> rhs<span class="op">.</span><span class="fu">depth</span><span class="op">.</span><span class="fu">CompareTo</span><span class="op">(</span>lhs<span class="op">.</span><span class="fu">depth</span><span class="op">);</span></span><span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a></span><span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>            <span class="co">//è·ç¦»</span></span><span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>lhs<span class="op">.</span><span class="fu">distance</span> <span class="op">!=</span> rhs<span class="op">.</span><span class="fu">distance</span><span class="op">)</span></span><span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> lhs<span class="op">.</span><span class="fu">distance</span><span class="op">.</span><span class="fu">CompareTo</span><span class="op">(</span>rhs<span class="op">.</span><span class="fu">distance</span><span class="op">);</span></span><span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a></span><span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>            <span class="co">//æ¡ä»¶ç›¸åŒçš„æƒ…å†µ ä½¿ç”¨å°„çº¿ç›‘æµ‹çš„åå‘é¡ºåº</span></span><span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> lhs<span class="op">.</span><span class="fu">index</span><span class="op">.</span><span class="fu">CompareTo</span><span class="op">(</span>rhs<span class="op">.</span><span class="fu">index</span><span class="op">);</span></span><span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div></li></ol></li><li><p>å…¶ä»–</p><ol type="1"><li>Display.RelativeMouseAt å¯¹äºå¤šæ˜¾ç¤ºå™¨å–ç›¸å¯¹ä½ç½®ã€‚ zè½´ä¸ºç›¸æœºçš„<code>targetDisplay</code></li><li>RectTransformUtility.RectangleContainsScreenPointç›‘æµ‹å±å¹•ç‚¹åŒ…å«äºRect</li></ol></li></ol></li></ol><p>â€‹</p><p>â€‹</p><p>â€‹</p><p>â€‹</p><p>â€‹</p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/ugui-yuan-ma-ji-lu/4.ugui-maskablegraphic/"/>
      <url>/2022/08/10/unity/ugui-yuan-ma-ji-lu/4.ugui-maskablegraphic/</url>
      
        <content type="html"><![CDATA[<h2 id="uguiä¹‹maskablegraphic">uGUIä¹‹MaskableGraphic</h2><blockquote><p>å®é™…uiæ§ä»¶çš„æŠ½è±¡åŸºç±»</p><p>åœ¨éœ€è¦ç»˜åˆ¶çš„uiç»„ä»¶çš„æŠ½è±¡ç±»çš„åŸºç¡€æ·»åŠ äº† IMaskable,IClippable,IMaterialModifier åŠŸèƒ½ï¼Œ</p><p>ä¸»è¦ IMaskable,IClippableåŠŸèƒ½ï¼Œå¯è¢«maskè£å‰ªã€‚</p></blockquote><ol type="1"><li><p>MaskableGraphic</p><blockquote><p>ç»§æ‰¿è‡ª Graphic, IClippable, IMaskable,IMaterialModifierï¼Œå®é™…çš„æ§ä»¶çš„åŸºç±»</p><p>è¿™éƒ¨åˆ†ä¸»è¦æ˜¯è®¡ç®— maskå’Œ clipåŒºåŸŸï¼Œ åŸºäº æ¨¡æ¿</p></blockquote><ol type="1"><li><p>IClippable</p><blockquote><p>ä¸»è¦çš„æ¥å£ RecalculateClippingï¼ŒCullï¼ŒSetClipRect</p></blockquote><div class="sourceCode" id="cb1"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">public</span> <span class="kw">interface</span> IClippable</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// GameObject of the IClippable object</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        GameObject gameObject <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="op">}</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Will be called when the state of a parent IClippable changed.</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> <span class="fu">RecalculateClipping</span><span class="op">();</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// The RectTransform of the clippable.</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        RectTransform rectTransform <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="op">}</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Clip and cull the IClippable given a specific clipping rect</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"clipRect"</span><span class="kw">&gt;</span><span class="co">The Rectangle in which to clip against.</span><span class="kw">&lt;/param&gt;</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"validRect"</span><span class="kw">&gt;</span><span class="co">Is the Rect valid. If not then the rect has 0 size.</span><span class="kw">&lt;/param&gt;</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> <span class="fu">Cull</span><span class="op">(</span>Rect clipRect<span class="op">,</span> <span class="dt">bool</span> validRect<span class="op">);</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Set the clip rect for the IClippable.</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"value"</span><span class="kw">&gt;</span><span class="co">The Rectangle for the clipping</span><span class="kw">&lt;/param&gt;</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"validRect"</span><span class="kw">&gt;</span><span class="co">Is the rect valid.</span><span class="kw">&lt;/param&gt;</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> <span class="fu">SetClipRect</span><span class="op">(</span>Rect value<span class="op">,</span> <span class="dt">bool</span> validRect<span class="op">);</span></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li><li><p>IMaskableæ¥å£å®ç°</p><blockquote><p>ä¸»è¦æ¥å£ RecalculateMasking</p></blockquote><div class="sourceCode" id="cb2"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">interface</span> IMaskable</span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Recalculate masking for this element and all children elements.</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;remarks&gt;</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Use this to update the internal state (recreate materials etc).</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/remarks&gt;</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> <span class="fu">RecalculateMasking</span><span class="op">();</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li><li><p>IMaterialModifier</p><blockquote><p>ä¸»è¦æ¥å£ GetModifiedMaterial</p></blockquote><div class="sourceCode" id="cb3"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>   <span class="kw">public</span> <span class="kw">interface</span> IMaterialModifier</span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Perform material modification in this function.</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"baseMaterial"</span><span class="kw">&gt;</span><span class="co">The material that is to be modified</span><span class="kw">&lt;/param&gt;</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">The modified material.</span><span class="kw">&lt;/returns&gt;</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        Material <span class="fu">GetModifiedMaterial</span><span class="op">(</span>Material baseMaterial<span class="op">);</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li><li><p>å®ç°ç»†èŠ‚</p><blockquote><p>ä¸»è¦åŠŸèƒ½æ˜¯ Clipable å’Œmask</p></blockquote><ol type="1"><li>mask å®ç°</li></ol><blockquote><p>ä¸»è¦é€šè¿‡ æè´¨<code>æ¨¡æ¿å±æ€§Stencil</code>çš„æ“ä½œ</p><p><code>StencilMaterial.Remove</code> å’Œ<code>StencilMaterial.Add</code> è¿›è¡Œç¼“å­˜</p></blockquote><div class="sourceCode" id="cb4"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">//StencilMaterial.cs  </span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span> <span class="kw">class</span> MatEntry</span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> Material baseMat<span class="op">;</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> Material customMat<span class="op">;</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">int</span> count<span class="op">;</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">int</span> stencilId<span class="op">;</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> StencilOp operation <span class="op">=</span> StencilOp<span class="op">.</span><span class="fu">Keep</span><span class="op">;</span></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> CompareFunction compareFunction <span class="op">=</span> CompareFunction<span class="op">.</span><span class="fu">Always</span><span class="op">;</span></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">int</span> readMask<span class="op">;</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">int</span> writeMask<span class="op">;</span></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">bool</span> useAlphaClip<span class="op">;</span></span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> ColorWriteMask colorMask<span class="op">;</span></span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div><div class="sourceCode" id="cb5"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">static</span> Material <span class="fu">Add</span><span class="op">(</span>Material baseMat<span class="op">,</span> <span class="dt">int</span> stencilID<span class="op">,</span> StencilOp operation<span class="op">,</span> CompareFunction compareFunction<span class="op">,</span> ColorWriteMask colorWriteMask<span class="op">)</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="fu">Add</span><span class="op">(</span>baseMat<span class="op">,</span> stencilID<span class="op">,</span> operation<span class="op">,</span> compareFunction<span class="op">,</span> colorWriteMask<span class="op">,</span> <span class="dv">255</span><span class="op">,</span> <span class="dv">255</span><span class="op">);</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Add a new material using the specified base and stencil ID.</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="kw">static</span> Material <span class="fu">Add</span><span class="op">(</span>Material baseMat<span class="op">,</span> <span class="dt">int</span> stencilID<span class="op">,</span> StencilOp operation<span class="op">,</span> CompareFunction compareFunction<span class="op">,</span> ColorWriteMask colorWriteMask<span class="op">,</span> <span class="dt">int</span> readMask<span class="op">,</span> <span class="dt">int</span> writeMask<span class="op">)</span></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            <span class="co">///æ£€æŸ¥æ˜¯å¦æœ‰æ ‡å‡†çš„æ¨¡æ¿é€‰é¡¹ </span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            <span class="co">// _Stencil,_StencilOpï¼Œ_StencilCompï¼Œ_StencilReadMaskï¼Œ_StencilWriteMaskï¼Œ_ColorMask</span></span><span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">((</span>stencilID <span class="op">&lt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> colorWriteMask <span class="op">==</span> ColorWriteMask<span class="op">.</span><span class="fu">All</span><span class="op">)</span> <span class="op">||</span> baseMat <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> baseMat<span class="op">;</span></span><span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(!</span>baseMat<span class="op">.</span><span class="fu">HasProperty</span><span class="op">(</span><span class="st">"_Stencil"</span><span class="op">))</span></span><span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                Debug<span class="op">.</span><span class="fu">LogWarning</span><span class="op">(</span><span class="st">"Material "</span> <span class="op">+</span> baseMat<span class="op">.</span><span class="fu">name</span> <span class="op">+</span> <span class="st">" doesn't have _Stencil property"</span><span class="op">,</span> baseMat<span class="op">);</span></span><span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> baseMat<span class="op">;</span></span><span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(!</span>baseMat<span class="op">.</span><span class="fu">HasProperty</span><span class="op">(</span><span class="st">"_StencilOp"</span><span class="op">))</span></span><span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                Debug<span class="op">.</span><span class="fu">LogWarning</span><span class="op">(</span><span class="st">"Material "</span> <span class="op">+</span> baseMat<span class="op">.</span><span class="fu">name</span> <span class="op">+</span> <span class="st">" doesn't have _StencilOp property"</span><span class="op">,</span> baseMat<span class="op">);</span></span><span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> baseMat<span class="op">;</span></span><span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(!</span>baseMat<span class="op">.</span><span class="fu">HasProperty</span><span class="op">(</span><span class="st">"_StencilComp"</span><span class="op">))</span></span><span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                Debug<span class="op">.</span><span class="fu">LogWarning</span><span class="op">(</span><span class="st">"Material "</span> <span class="op">+</span> baseMat<span class="op">.</span><span class="fu">name</span> <span class="op">+</span> <span class="st">" doesn't have _StencilComp property"</span><span class="op">,</span> baseMat<span class="op">);</span></span><span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> baseMat<span class="op">;</span></span><span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(!</span>baseMat<span class="op">.</span><span class="fu">HasProperty</span><span class="op">(</span><span class="st">"_StencilReadMask"</span><span class="op">))</span></span><span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>                Debug<span class="op">.</span><span class="fu">LogWarning</span><span class="op">(</span><span class="st">"Material "</span> <span class="op">+</span> baseMat<span class="op">.</span><span class="fu">name</span> <span class="op">+</span> <span class="st">" doesn't have _StencilReadMask property"</span><span class="op">,</span> baseMat<span class="op">);</span></span><span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> baseMat<span class="op">;</span></span><span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(!</span>baseMat<span class="op">.</span><span class="fu">HasProperty</span><span class="op">(</span><span class="st">"_StencilWriteMask"</span><span class="op">))</span></span><span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>                Debug<span class="op">.</span><span class="fu">LogWarning</span><span class="op">(</span><span class="st">"Material "</span> <span class="op">+</span> baseMat<span class="op">.</span><span class="fu">name</span> <span class="op">+</span> <span class="st">" doesn't have _StencilWriteMask property"</span><span class="op">,</span> baseMat<span class="op">);</span></span><span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> baseMat<span class="op">;</span></span><span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(!</span>baseMat<span class="op">.</span><span class="fu">HasProperty</span><span class="op">(</span><span class="st">"_ColorMask"</span><span class="op">))</span></span><span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>                Debug<span class="op">.</span><span class="fu">LogWarning</span><span class="op">(</span><span class="st">"Material "</span> <span class="op">+</span> baseMat<span class="op">.</span><span class="fu">name</span> <span class="op">+</span> <span class="st">" doesn't have _ColorMask property"</span><span class="op">,</span> baseMat<span class="op">);</span></span><span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> baseMat<span class="op">;</span></span><span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ä»ç¼“å†²è¯»å–</span></span><span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> m_List<span class="op">.</span><span class="fu">Count</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span></span><span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>                MatEntry ent <span class="op">=</span> m_List<span class="op">[</span>i<span class="op">];</span></span><span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>ent<span class="op">.</span><span class="fu">baseMat</span> <span class="op">==</span> baseMat</span><span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&amp;&amp;</span> ent<span class="op">.</span><span class="fu">stencilId</span> <span class="op">==</span> stencilID</span><span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&amp;&amp;</span> ent<span class="op">.</span><span class="fu">operation</span> <span class="op">==</span> operation</span><span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&amp;&amp;</span> ent<span class="op">.</span><span class="fu">compareFunction</span> <span class="op">==</span> compareFunction</span><span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&amp;&amp;</span> ent<span class="op">.</span><span class="fu">readMask</span> <span class="op">==</span> readMask</span><span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&amp;&amp;</span> ent<span class="op">.</span><span class="fu">writeMask</span> <span class="op">==</span> writeMask</span><span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>                    <span class="op">&amp;&amp;</span> ent<span class="op">.</span><span class="fu">colorMask</span> <span class="op">==</span> colorWriteMask<span class="op">)</span></span><span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>                    <span class="op">++</span>ent<span class="op">.</span><span class="fu">count</span><span class="op">;</span></span><span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">return</span> ent<span class="op">.</span><span class="fu">customMat</span><span class="op">;</span></span><span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>            <span class="co">// è®¾ç½®æ¨¡æ¿é€‰é¡¹ å¹¶åŠ å…¥ç¼“å­˜</span></span><span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> newEnt <span class="op">=</span> <span class="kw">new</span> <span class="fu">MatEntry</span><span class="op">();</span></span><span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">count</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">baseMat</span> <span class="op">=</span> baseMat<span class="op">;</span></span><span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">customMat</span> <span class="op">=</span> <span class="kw">new</span> <span class="fu">Material</span><span class="op">(</span>baseMat<span class="op">);</span></span><span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">customMat</span><span class="op">.</span><span class="fu">hideFlags</span> <span class="op">=</span> HideFlags<span class="op">.</span><span class="fu">HideAndDontSave</span><span class="op">;</span></span><span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">stencilId</span> <span class="op">=</span> stencilID<span class="op">;</span></span><span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">operation</span> <span class="op">=</span> operation<span class="op">;</span></span><span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">compareFunction</span> <span class="op">=</span> compareFunction<span class="op">;</span></span><span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">readMask</span> <span class="op">=</span> readMask<span class="op">;</span></span><span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">writeMask</span> <span class="op">=</span> writeMask<span class="op">;</span></span><span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">colorMask</span> <span class="op">=</span> colorWriteMask<span class="op">;</span></span><span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">useAlphaClip</span> <span class="op">=</span> operation <span class="op">!=</span> StencilOp<span class="op">.</span><span class="fu">Keep</span> <span class="op">&amp;&amp;</span> writeMask <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">customMat</span><span class="op">.</span><span class="fu">name</span> <span class="op">=</span> <span class="dt">string</span><span class="op">.</span><span class="fu">Format</span><span class="op">(</span><span class="st">"Stencil Id:{0}, Op:{1}, Comp:{2}, WriteMask:{3}, ReadMask:{4}, ColorMask:{5} AlphaClip:{6} ({7})"</span><span class="op">,</span> stencilID<span class="op">,</span> operation<span class="op">,</span> compareFunction<span class="op">,</span> writeMask<span class="op">,</span> readMask<span class="op">,</span> colorWriteMask<span class="op">,</span> newEnt<span class="op">.</span><span class="fu">useAlphaClip</span><span class="op">,</span> baseMat<span class="op">.</span><span class="fu">name</span><span class="op">);</span></span><span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">customMat</span><span class="op">.</span><span class="fu">SetInt</span><span class="op">(</span><span class="st">"_Stencil"</span><span class="op">,</span> stencilID<span class="op">);</span></span><span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">customMat</span><span class="op">.</span><span class="fu">SetInt</span><span class="op">(</span><span class="st">"_StencilOp"</span><span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>operation<span class="op">);</span></span><span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">customMat</span><span class="op">.</span><span class="fu">SetInt</span><span class="op">(</span><span class="st">"_StencilComp"</span><span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>compareFunction<span class="op">);</span></span><span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">customMat</span><span class="op">.</span><span class="fu">SetInt</span><span class="op">(</span><span class="st">"_StencilReadMask"</span><span class="op">,</span> readMask<span class="op">);</span></span><span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">customMat</span><span class="op">.</span><span class="fu">SetInt</span><span class="op">(</span><span class="st">"_StencilWriteMask"</span><span class="op">,</span> writeMask<span class="op">);</span></span><span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">customMat</span><span class="op">.</span><span class="fu">SetInt</span><span class="op">(</span><span class="st">"_ColorMask"</span><span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>colorWriteMask<span class="op">);</span></span><span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>            newEnt<span class="op">.</span><span class="fu">customMat</span><span class="op">.</span><span class="fu">SetInt</span><span class="op">(</span><span class="st">"_UseUIAlphaClip"</span><span class="op">,</span> newEnt<span class="op">.</span><span class="fu">useAlphaClip</span> <span class="op">?</span> <span class="dv">1</span> <span class="op">:</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>newEnt<span class="op">.</span><span class="fu">useAlphaClip</span><span class="op">)</span></span><span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>                newEnt<span class="op">.</span><span class="fu">customMat</span><span class="op">.</span><span class="fu">EnableKeyword</span><span class="op">(</span><span class="st">"UNITY_UI_ALPHACLIP"</span><span class="op">);</span></span><span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span><span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>                newEnt<span class="op">.</span><span class="fu">customMat</span><span class="op">.</span><span class="fu">DisableKeyword</span><span class="op">(</span><span class="st">"UNITY_UI_ALPHACLIP"</span><span class="op">);</span></span><span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>            m_List<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>newEnt<span class="op">);</span></span><span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> newEnt<span class="op">.</span><span class="fu">customMat</span><span class="op">;</span></span><span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div><div class="sourceCode" id="cb6"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">Remove</span><span class="op">(</span>Material customMat<span class="op">)</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>customMat <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span><span class="op">;</span></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> m_List<span class="op">.</span><span class="fu">Count</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span></span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                MatEntry ent <span class="op">=</span> m_List<span class="op">[</span>i<span class="op">];</span></span><span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>ent<span class="op">.</span><span class="fu">customMat</span> <span class="op">!=</span> customMat<span class="op">)</span></span><span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">continue</span><span class="op">;</span></span><span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(--</span>ent<span class="op">.</span><span class="fu">count</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                    Misc<span class="op">.</span><span class="fu">DestroyImmediate</span><span class="op">(</span>ent<span class="op">.</span><span class="fu">customMat</span><span class="op">);</span></span><span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                    ent<span class="op">.</span><span class="fu">baseMat</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span><span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                    m_List<span class="op">.</span><span class="fu">RemoveAt</span><span class="op">(</span>i<span class="op">);</span></span><span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span><span class="op">;</span></span><span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> </span></code></pre></div><ol start="2" type="1"><li>Clip å®ç°</li></ol><blockquote><p>ä¸»è¦é€šè¿‡RectåŒºåŸŸï¼ˆå‘ä¸Šé€’å½’ï¼‰ï¼Œ Clipping.FindCullAndClipWorldRect</p></blockquote><div class="sourceCode" id="cb7"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">//RectMask2D.cs</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">PerformClipping</span><span class="op">()</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span><span class="fu">ReferenceEquals</span><span class="op">(</span>Canvas<span class="op">,</span> <span class="kw">null</span><span class="op">))</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span><span class="op">;</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            <span class="co">//</span><span class="al">TODO</span><span class="co"> See if an IsActive() test would work well here or whether it might cause unexpected side effects (re case 776771)</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">// if the parents are changed</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            <span class="co">// or something similar we</span></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="co">// do a recalculate here</span></span><span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>m_ShouldRecalculateClipRects<span class="op">)</span></span><span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                <span class="co">//è·å–ç¬¦åˆæ¡ä»¶çš„ RectMasks</span></span><span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                MaskUtilities<span class="op">.</span><span class="fu">GetRectMasksForClip</span><span class="op">(</span><span class="kw">this</span><span class="op">,</span> m_Clippers<span class="op">);</span></span><span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                m_ShouldRecalculateClipRects <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>            <span class="co">// get the compound rects from</span></span><span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            <span class="co">// the clippers that are valid</span></span><span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>            <span class="dt">bool</span> validRect <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>           <span class="co">//éå†è·å–æœ€å°rectåŒºåŸŸ(xMin, yMin, Width, height)</span></span><span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>            Rect clipRect <span class="op">=</span> Clipping<span class="op">.</span><span class="fu">FindCullAndClipWorldRect</span><span class="op">(</span>m_Clippers<span class="op">,</span> <span class="kw">out</span> validRect<span class="op">);</span></span><span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>            <span class="co">// If the mask is in ScreenSpaceOverlay/Camera render mode, its content is only rendered when its rect</span></span><span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>            <span class="co">// overlaps that of the root canvas.</span></span><span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>           <span class="co">// 1. å¯è£å‰ªçš„ç›¸æœºæ¨¡å¼ 2. ç‰©ä½“åŒºåŸŸå’Œè£å‰ªåŒºåŸŸæ²¡æœ‰é‡åˆéƒ¨åˆ†</span></span><span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>           <span class="co">// æ»¡è¶³æ¡ä»¶åˆ™è¿›è¡Œè®¾ç½®è£å‰ªåŒºåŸŸè¿›è¡Œè£å‰ª</span></span><span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>           RenderMode renderMode <span class="op">=</span> Canvas<span class="op">.</span><span class="fu">rootCanvas</span><span class="op">.</span><span class="fu">renderMode</span><span class="op">;</span></span><span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>            <span class="dt">bool</span> maskIsCulled <span class="op">=</span></span><span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>                <span class="op">(</span>renderMode <span class="op">==</span> RenderMode<span class="op">.</span><span class="fu">ScreenSpaceCamera</span> <span class="op">||</span> renderMode <span class="op">==</span> RenderMode<span class="op">.</span><span class="fu">ScreenSpaceOverlay</span><span class="op">)</span> <span class="op">&amp;&amp;</span></span><span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>                <span class="op">!</span>clipRect<span class="op">.</span><span class="fu">Overlaps</span><span class="op">(</span>rootCanvasRect<span class="op">,</span> <span class="kw">true</span><span class="op">);</span> <span class="co">// </span></span><span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>maskIsCulled<span class="op">)</span></span><span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>                <span class="co">// Children are only displayed when inside the mask. If the mask is culled, then the children</span></span><span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>                <span class="co">// inside the mask are also culled. In that situation, we pass an invalid rect to allow callees</span></span><span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>                <span class="co">// to avoid some processing.</span></span><span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>                clipRect <span class="op">=</span> Rect<span class="op">.</span><span class="fu">zero</span><span class="op">;</span></span><span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>                validRect <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>clipRect <span class="op">!=</span> m_LastClipRectCanvasSpace<span class="op">)</span></span><span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>                <span class="kw">foreach</span> <span class="op">(</span>IClippable clipTarget <span class="kw">in</span> m_ClipTargets<span class="op">)</span></span><span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>                    clipTarget<span class="op">.</span><span class="fu">SetClipRect</span><span class="op">(</span>clipRect<span class="op">,</span> validRect<span class="op">);</span></span><span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>                <span class="kw">foreach</span> <span class="op">(</span>MaskableGraphic maskableTarget <span class="kw">in</span> m_MaskableTargets<span class="op">)</span></span><span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>                    maskableTarget<span class="op">.</span><span class="fu">SetClipRect</span><span class="op">(</span>clipRect<span class="op">,</span> validRect<span class="op">);</span></span><span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>                    maskableTarget<span class="op">.</span><span class="fu">Cull</span><span class="op">(</span>clipRect<span class="op">,</span> validRect<span class="op">);</span></span><span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span>m_ForceClip<span class="op">)</span></span><span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>                <span class="kw">foreach</span> <span class="op">(</span>IClippable clipTarget <span class="kw">in</span> m_ClipTargets<span class="op">)</span></span><span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>                    clipTarget<span class="op">.</span><span class="fu">SetClipRect</span><span class="op">(</span>clipRect<span class="op">,</span> validRect<span class="op">);</span></span><span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>                <span class="kw">foreach</span> <span class="op">(</span>MaskableGraphic maskableTarget <span class="kw">in</span> m_MaskableTargets<span class="op">)</span></span><span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>                    maskableTarget<span class="op">.</span><span class="fu">SetClipRect</span><span class="op">(</span>clipRect<span class="op">,</span> validRect<span class="op">);</span></span><span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>maskableTarget<span class="op">.</span><span class="fu">canvasRenderer</span><span class="op">.</span><span class="fu">hasMoved</span><span class="op">)</span></span><span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>                        maskableTarget<span class="op">.</span><span class="fu">Cull</span><span class="op">(</span>clipRect<span class="op">,</span> validRect<span class="op">);</span></span><span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span><span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>                <span class="kw">foreach</span> <span class="op">(</span>MaskableGraphic maskableTarget <span class="kw">in</span> m_MaskableTargets<span class="op">)</span></span><span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>maskableTarget<span class="op">.</span><span class="fu">canvasRenderer</span><span class="op">.</span><span class="fu">hasMoved</span><span class="op">)</span></span><span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>                        maskableTarget<span class="op">.</span><span class="fu">Cull</span><span class="op">(</span>clipRect<span class="op">,</span> validRect<span class="op">);</span></span><span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>            m_LastClipRectCanvasSpace <span class="op">=</span> clipRect<span class="op">;</span></span><span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>            m_ForceClip <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div><div class="sourceCode" id="cb8"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">//å‘ä¸Šéå† è·å–ç¬¦åˆæ¡ä»¶çš„ RectMask2D</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">static</span> <span class="dt">void</span> <span class="fu">GetRectMasksForClip</span><span class="op">(</span>RectMask2D clipper<span class="op">,</span> List<span class="op">&lt;</span>RectMask2D<span class="op">&gt;</span> masks<span class="op">)</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>            masks<span class="op">.</span><span class="fu">Clear</span><span class="op">();</span></span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            List<span class="op">&lt;</span>Canvas<span class="op">&gt;</span> canvasComponents <span class="op">=</span> ListPool<span class="op">&lt;</span>Canvas<span class="op">&gt;.</span><span class="fu">Get</span><span class="op">();</span></span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            List<span class="op">&lt;</span>RectMask2D<span class="op">&gt;</span> rectMaskComponents <span class="op">=</span> ListPool<span class="op">&lt;</span>RectMask2D<span class="op">&gt;.</span><span class="fu">Get</span><span class="op">();</span></span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            clipper<span class="op">.</span><span class="fu">transform</span><span class="op">.</span><span class="fu">GetComponentsInParent</span><span class="op">(</span><span class="kw">false</span><span class="op">,</span> rectMaskComponents<span class="op">);</span></span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>rectMaskComponents<span class="op">.</span><span class="fu">Count</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                clipper<span class="op">.</span><span class="fu">transform</span><span class="op">.</span><span class="fu">GetComponentsInParent</span><span class="op">(</span><span class="kw">false</span><span class="op">,</span> canvasComponents<span class="op">);</span></span><span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> rectMaskComponents<span class="op">.</span><span class="fu">Count</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">--)</span></span><span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(!</span>rectMaskComponents<span class="op">[</span>i<span class="op">].</span><span class="fu">IsActive</span><span class="op">())</span></span><span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">continue</span><span class="op">;</span></span><span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">bool</span> shouldAdd <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> canvasComponents<span class="op">.</span><span class="fu">Count</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> j <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> j<span class="op">--)</span></span><span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span><span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">if</span> <span class="op">(!</span><span class="fu">IsDescendantOrSelf</span><span class="op">(</span>canvasComponents<span class="op">[</span>j<span class="op">].</span><span class="fu">transform</span><span class="op">,</span> rectMaskComponents<span class="op">[</span>i<span class="op">].</span><span class="fu">transform</span><span class="op">)</span> <span class="op">&amp;&amp;</span> canvasComponents<span class="op">[</span>j<span class="op">].</span><span class="fu">overrideSorting</span><span class="op">)</span></span><span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>                        <span class="op">{</span></span><span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                            shouldAdd <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                            <span class="kw">break</span><span class="op">;</span></span><span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>                        <span class="op">}</span></span><span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span><span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>shouldAdd<span class="op">)</span></span><span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>                        masks<span class="op">.</span><span class="fu">Add</span><span class="op">(</span>rectMaskComponents<span class="op">[</span>i<span class="op">]);</span></span><span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>            ListPool<span class="op">&lt;</span>RectMask2D<span class="op">&gt;.</span><span class="fu">Release</span><span class="op">(</span>rectMaskComponents<span class="op">);</span></span><span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>            ListPool<span class="op">&lt;</span>Canvas<span class="op">&gt;.</span><span class="fu">Release</span><span class="op">(</span>canvasComponents<span class="op">);</span></span><span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div><div class="sourceCode" id="cb9"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cliping.cs</span></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">///è¿”å›æœ€å°åŒºåŸŸçš„ Rectã€‚ (xMin, yMin, Width, height)</span></span><span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">static</span> Rect <span class="fu">FindCullAndClipWorldRect</span><span class="op">(</span>List<span class="op">&lt;</span>RectMask2D<span class="op">&gt;</span> rectMaskParents<span class="op">,</span> <span class="kw">out</span> <span class="dt">bool</span> validRect<span class="op">)</span></span><span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>rectMaskParents<span class="op">.</span><span class="fu">Count</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                validRect <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Rect</span><span class="op">();</span></span><span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            Rect current <span class="op">=</span> rectMaskParents<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">canvasRect</span><span class="op">;</span></span><span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> xMin <span class="op">=</span> current<span class="op">.</span><span class="fu">xMin</span><span class="op">;</span></span><span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> xMax <span class="op">=</span> current<span class="op">.</span><span class="fu">xMax</span><span class="op">;</span></span><span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> yMin <span class="op">=</span> current<span class="op">.</span><span class="fu">yMin</span><span class="op">;</span></span><span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> yMax <span class="op">=</span> current<span class="op">.</span><span class="fu">yMax</span><span class="op">;</span></span><span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> rectMaskParents<span class="op">.</span><span class="fu">Count</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span></span><span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>                current <span class="op">=</span> rectMaskParents<span class="op">[</span>i<span class="op">].</span><span class="fu">canvasRect</span><span class="op">;</span></span><span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>xMin <span class="op">&lt;</span> current<span class="op">.</span><span class="fu">xMin</span><span class="op">)</span></span><span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                    xMin <span class="op">=</span> current<span class="op">.</span><span class="fu">xMin</span><span class="op">;</span></span><span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>yMin <span class="op">&lt;</span> current<span class="op">.</span><span class="fu">yMin</span><span class="op">)</span></span><span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>                    yMin <span class="op">=</span> current<span class="op">.</span><span class="fu">yMin</span><span class="op">;</span></span><span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>xMax <span class="op">&gt;</span> current<span class="op">.</span><span class="fu">xMax</span><span class="op">)</span></span><span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>                    xMax <span class="op">=</span> current<span class="op">.</span><span class="fu">xMax</span><span class="op">;</span></span><span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                <span class="kw">if</span> <span class="op">(</span>yMax <span class="op">&gt;</span> current<span class="op">.</span><span class="fu">yMax</span><span class="op">)</span></span><span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>                    yMax <span class="op">=</span> current<span class="op">.</span><span class="fu">yMax</span><span class="op">;</span></span><span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>            validRect <span class="op">=</span> xMax <span class="op">&gt;</span> xMin <span class="op">&amp;&amp;</span> yMax <span class="op">&gt;</span> yMin<span class="op">;</span></span><span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>validRect<span class="op">)</span></span><span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Rect</span><span class="op">(</span>xMin<span class="op">,</span> yMin<span class="op">,</span> xMax <span class="op">-</span> xMin<span class="op">,</span> yMax <span class="op">-</span> yMin<span class="op">);</span></span><span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span><span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Rect</span><span class="op">();</span></span><span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div><div class="sourceCode" id="cb10"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">internal</span> <span class="kw">class</span> RectangularVertexClipper</span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">readonly</span> Vector3<span class="op">[]</span> m_WorldCorners <span class="op">=</span> <span class="kw">new</span> Vector3<span class="op">[</span><span class="dv">4</span><span class="op">];</span></span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">readonly</span> Vector3<span class="op">[]</span> m_CanvasCorners <span class="op">=</span> <span class="kw">new</span> Vector3<span class="op">[</span><span class="dv">4</span><span class="op">];</span></span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>       <span class="co">// è¿”å›ç›¸å¯¹äºCanvas çš„Cornerçš„Rect</span></span><span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> Rect <span class="fu">GetCanvasRect</span><span class="op">(</span>RectTransform t<span class="op">,</span> Canvas c<span class="op">)</span></span><span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>c <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Rect</span><span class="op">();</span></span><span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>            t<span class="op">.</span><span class="fu">GetWorldCorners</span><span class="op">(</span>m_WorldCorners<span class="op">);</span></span><span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> canvasTransform <span class="op">=</span> c<span class="op">.</span><span class="fu">GetComponent</span><span class="op">&lt;</span>Transform<span class="op">&gt;();</span></span><span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> <span class="op">++</span>i<span class="op">)</span></span><span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>                m_CanvasCorners<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> canvasTransform<span class="op">.</span><span class="fu">InverseTransformPoint</span><span class="op">(</span>m_WorldCorners<span class="op">[</span>i<span class="op">]);</span></span><span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Rect</span><span class="op">(</span>m_CanvasCorners<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">x</span><span class="op">,</span> m_CanvasCorners<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">y</span><span class="op">,</span> m_CanvasCorners<span class="op">[</span><span class="dv">2</span><span class="op">].</span><span class="fu">x</span> <span class="op">-</span> m_CanvasCorners<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">x</span><span class="op">,</span> m_CanvasCorners<span class="op">[</span><span class="dv">2</span><span class="op">].</span><span class="fu">y</span> <span class="op">-</span> m_CanvasCorners<span class="op">[</span><span class="dv">0</span><span class="op">].</span><span class="fu">y</span><span class="op">);</span></span><span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li></ol><p>â€‹</p><p>â€‹</p><p>â€‹</p><p>â€‹</p><p>â€‹</p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/ugui-yuan-ma-ji-lu/3.ugui-graphic/"/>
      <url>/2022/08/10/unity/ugui-yuan-ma-ji-lu/3.ugui-graphic/</url>
      
        <content type="html"><![CDATA[<h2 id="uguiä¹‹graphic">uGUIä¹‹graphic</h2><blockquote><p>æ‰€æœ‰éœ€è¦ç»˜åˆ¶çš„uiç»„ä»¶çš„æŠ½è±¡åŸºç±»</p></blockquote><ol type="1"><li><p>Graphic</p><blockquote><p>ç»§æ‰¿è‡ªUIBehaviourã€<code>ICanvesElement</code> ï¼Œå¯æ¸²æŸ“çš„uiç»„ä»¶</p></blockquote><ol type="1"><li><p>ICanvasElement</p><blockquote><p>ä¾èµ–Canves çš„uiå…ƒç´ æ¥å£ï¼Œ ä¸»è¦æ˜¯<code>rebuild</code>æ¥å£æ ‡è®°</p></blockquote><div class="sourceCode" id="cb1"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>      <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// Values of 'update' called on a Canvas update.</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">enum</span> CanvasUpdate</span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Called before layout.</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        Prelayout <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Called for layout.</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        Layout <span class="op">=</span> <span class="dv">1</span><span class="op">,</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Called after layout.</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        PostLayout <span class="op">=</span> <span class="dv">2</span><span class="op">,</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Called before rendering.</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        PreRender <span class="op">=</span> <span class="dv">3</span><span class="op">,</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Called late, before render.</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        LatePreRender <span class="op">=</span> <span class="dv">4</span><span class="op">,</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Max enum value. Always last.</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        MaxUpdateValue <span class="op">=</span> <span class="dv">5</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// This is an element that can live on a Canvas.</span></span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">interface</span> ICanvasElement</span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Rebuild the element for the given stage.</span></span><span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;param</span><span class="ot"> name=</span><span class="dt">"executing"</span><span class="kw">&gt;</span><span class="co">The current CanvasUpdate stage being rebuild.</span><span class="kw">&lt;/param&gt;</span></span><span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> <span class="fu">Rebuild</span><span class="op">(</span>CanvasUpdate executing<span class="op">);</span></span><span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Get the transform associated with the ICanvasElement.</span></span><span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        Transform transform <span class="op">{</span> <span class="kw">get</span><span class="op">;</span> <span class="op">}</span></span><span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Callback sent when this ICanvasElement has completed layout.</span></span><span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> <span class="fu">LayoutComplete</span><span class="op">();</span></span><span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Callback sent when this ICanvasElement has completed Graphic rebuild.</span></span><span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> <span class="fu">GraphicUpdateComplete</span><span class="op">();</span></span><span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Used if the native representation has been destroyed.</span></span><span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;returns&gt;</span><span class="co">Return true if the element is considered destroyed.</span><span class="kw">&lt;/returns&gt;</span></span><span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> <span class="fu">IsDestroyed</span><span class="op">();</span></span><span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li><li><p>ICanvesElement æ¥å£å®ç°</p></li><li><p>Rebuild</p></li></ol><pre><code>  &gt; canvasRenderer uiæ¸²æŸ“å…ƒç´ ä¾èµ–ç»„ä»¶çš„**render**ç»„ä»¶  &gt;  &gt; è¿™é‡Œåªå¯¹**æ¸²æŸ“å‰**è¿›è¡Œ`é¡¶ç‚¹`å’Œ`æè´¨`è¿›è¡Œæ›´æ–°ã€‚  ```csharp         public virtual void Rebuild(CanvasUpdate update)          {              if (canvasRenderer == null || canvasRenderer.cull)                  return;              switch (update)              {                  case CanvasUpdate.PreRender:                      if (m_VertsDirty)                      {                          UpdateGeometry();                          m_VertsDirty = false;                      }                      if (m_MaterialDirty)                      {                          UpdateMaterial();                          m_MaterialDirty = false;                      }                      break;              }          }  ```</code></pre><ol start="2" type="1"><li>transform</li></ol><pre><code>   â€‹ transform æ²¿ç”¨åŸºç±» `Component` çš„transform å±æ€§</code></pre><ol start="3" type="1"><li>LayoutComponent</li></ol><pre><code>   ```csharp   //æš‚æ—¶ä¸ºç©º          public virtual void LayoutComplete()   {}   ```</code></pre><ol start="4" type="1"><li><p>GraphicUpdateComplete</p><div class="sourceCode" id="cb5"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">//æš‚æ—¶ä¸ºç©º       </span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">GraphicUpdateComplete</span><span class="op">()</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="op">{}</span></span></code></pre></div></li><li><p>IsDestroyed</p><p>IsDestroyed æ²¿ç”¨ UIBehaviour çš„IsDestroyed å±æ€§</p></li><li><p>æ–°å¢å’Œå®ç°</p><blockquote><p>ä½œä¸ºéœ€è¦æ¸²æŸ“çš„æ§ä»¶ï¼Œ å¿…é¡»æœ‰ <code>Render</code>ã€æ¸²æŸ“çš„æ•°æ®<code>é¡¶ç‚¹æ•°æ®</code> ã€<code>æè´¨æ•°æ®</code></p></blockquote><ol type="1"><li><p>ç†è®ºéƒ¨åˆ†</p></li><li><p>Render ä½¿ç”¨ <code>CanvasRenderer</code></p></li><li><p>æè´¨ä»¥åŠæè´¨å±æ€§</p></li><li><p>ä»£ç éƒ¨åˆ†</p><ol type="1"><li>æè´¨ä»¥åŠæè´¨å±æ€§é™æ€å…¬å…±æ•°æ® &gt;s_WhiteTextureé™æ€é»˜è®¤è´´å›¾å±æ€§ä½œä¸ºå…±äº«çš„é»˜è®¤è´´å›¾ï¼ŒOnEnable è¿›è¡Œèµ‹å€¼</li></ol><div class="sourceCode" id="cb6"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">static</span> <span class="kw">protected</span> Texture2D s_WhiteTexture <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co">// è´´å›¾èµ‹å€¼</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="kw">protected</span> <span class="kw">override</span> <span class="dt">void</span> <span class="fu">OnEnable</span><span class="op">()</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ã€‚ã€‚ã€‚</span></span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if</span> <span class="op">(</span>s_WhiteTexture <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        s_WhiteTexture <span class="op">=</span> Texture2D<span class="op">.</span><span class="fu">whiteTexture</span><span class="op">;</span></span><span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ã€‚ã€‚ã€‚</span></span><span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><blockquote><p>s_DefaultUIé™æ€é»˜è®¤æè´¨å±æ€§ä½œä¸ºå…±äº«çš„é»˜è®¤è´´å›¾ï¼ŒGetè¿›è¡Œå•ä¾‹èµ‹å€¼</p><div class="sourceCode" id="cb7"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">static</span> <span class="kw">public</span> Material defaultGraphicMaterial</span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>get</span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(</span>s_DefaultUI <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>s_DefaultUI <span class="op">=</span> Canvas<span class="op">.</span><span class="fu">GetDefaultCanvasMaterial</span><span class="op">();</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="kw">return</span> s_DefaultUI<span class="op">;</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><p>s_VertexHelper é¡¶ç‚¹è¾…åŠ©å™¨</p><div class="sourceCode" id="cb8"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">[</span>NonSerialized<span class="op">]</span> <span class="kw">private</span> <span class="kw">static</span> <span class="kw">readonly</span> VertexHelper s_VertexHelper <span class="op">=</span> <span class="kw">new</span> <span class="fu">VertexHelper</span><span class="op">();</span></span></code></pre></div></blockquote><ol start="2" type="1"><li><p>æ¸²æŸ“æ§åˆ¶ç›¸å…³</p></li><li><p>æè´¨ä»¥åŠæè´¨å±æ€§</p></li></ol><pre><code>  ```csharp  //æè´¨å¯¹è±¡  [FormerlySerializedAs("m_Mat")]  [SerializeField] protected Material m_Material;    //æè´¨å±æ€§ é¢œè‰²  [SerializeField] private Color m_Color = Color.white;  ```</code></pre><ol start="2" type="1"><li><p>é¡¶ç‚¹ã€Mesh (è¾…åŠ©é¡¶ç‚¹meshç±» <code>VertexHelper</code>)</p><blockquote><p>Rebuildè°ƒç”¨<code>UpdateGeometry</code> è¿›è¡Œé¡¶ç‚¹ã€Meshè®¡ç®—ï¼Œé¡¶ç‚¹æ•ˆæœ<code>IMeshModifier</code>å›è°ƒè§¦å‘</p><p>åœ¨ <code>OnPopulateMesh</code> ä¸­è¿›è¡Œé¡¶ç‚¹å±æ€§å¤„ç†ï¼Œç®€å•çš„é¡¶ç‚¹å’Œincludies, ä»¥åŠ uv</p></blockquote><div class="sourceCode" id="cb10"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>     <span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">Rebuild</span><span class="op">(</span>CanvasUpdate update<span class="op">)</span></span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>          <span class="co">///...</span></span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">UpdateGeometry</span><span class="op">();</span></span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                 m_VertsDirty <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>              <span class="co">///...</span></span><span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> </span><span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Call to update the geometry of the Graphic onto the CanvasRenderer.</span></span><span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">UpdateGeometry</span><span class="op">()</span></span><span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>useLegacyMeshGeneration<span class="op">)</span></span><span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">DoLegacyMeshGeneration</span><span class="op">();</span></span><span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span><span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                <span class="fu">DoMeshGeneration</span><span class="op">();</span></span><span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">DoMeshGeneration</span><span class="op">()</span></span><span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>rectTransform <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> rectTransform<span class="op">.</span><span class="fu">rect</span><span class="op">.</span><span class="fu">width</span> <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> rectTransform<span class="op">.</span><span class="fu">rect</span><span class="op">.</span><span class="fu">height</span> <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>                <span class="fu">OnPopulateMesh</span><span class="op">(</span>s_VertexHelper<span class="op">);</span></span><span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span><span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>                s_VertexHelper<span class="op">.</span><span class="fu">Clear</span><span class="op">();</span> <span class="co">// clear the vertex helper so invalid graphics dont draw.</span></span><span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> components <span class="op">=</span> ListPool<span class="op">&lt;</span>Component<span class="op">&gt;.</span><span class="fu">Get</span><span class="op">();</span></span><span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">GetComponents</span><span class="op">(</span><span class="kw">typeof</span><span class="op">(</span>IMeshModifier<span class="op">),</span> components<span class="op">);</span></span><span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> components<span class="op">.</span><span class="fu">Count</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>                <span class="op">((</span>IMeshModifier<span class="op">)</span>components<span class="op">[</span>i<span class="op">]).</span><span class="fu">ModifyMesh</span><span class="op">(</span>s_VertexHelper<span class="op">);</span></span><span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>            ListPool<span class="op">&lt;</span>Component<span class="op">&gt;.</span><span class="fu">Release</span><span class="op">(</span>components<span class="op">);</span></span><span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>            s_VertexHelper<span class="op">.</span><span class="fu">FillMesh</span><span class="op">(</span>workerMesh<span class="op">);</span></span><span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>            canvasRenderer<span class="op">.</span><span class="fu">SetMesh</span><span class="op">(</span>workerMesh<span class="op">);</span></span><span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span> <span class="dt">void</span> <span class="fu">DoLegacyMeshGeneration</span><span class="op">()</span></span><span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(</span>rectTransform <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> rectTransform<span class="op">.</span><span class="fu">rect</span><span class="op">.</span><span class="fu">width</span> <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> rectTransform<span class="op">.</span><span class="fu">rect</span><span class="op">.</span><span class="fu">height</span> <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>#pragma warning disable <span class="dv">618</span></span><span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>                <span class="fu">OnPopulateMesh</span><span class="op">(</span>workerMesh<span class="op">);</span></span><span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>#pragma warning restore <span class="dv">618</span></span><span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>            <span class="kw">else</span></span><span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>                workerMesh<span class="op">.</span><span class="fu">Clear</span><span class="op">();</span></span><span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> components <span class="op">=</span> ListPool<span class="op">&lt;</span>Component<span class="op">&gt;.</span><span class="fu">Get</span><span class="op">();</span></span><span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>            <span class="fu">GetComponents</span><span class="op">(</span><span class="kw">typeof</span><span class="op">(</span>IMeshModifier<span class="op">),</span> components<span class="op">);</span></span><span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> components<span class="op">.</span><span class="fu">Count</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>#pragma warning disable <span class="dv">618</span></span><span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a>                <span class="op">((</span>IMeshModifier<span class="op">)</span>components<span class="op">[</span>i<span class="op">]).</span><span class="fu">ModifyMesh</span><span class="op">(</span>workerMesh<span class="op">);</span></span><span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a>#pragma warning restore <span class="dv">618</span></span><span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a>            ListPool<span class="op">&lt;</span>Component<span class="op">&gt;.</span><span class="fu">Release</span><span class="op">(</span>components<span class="op">);</span></span><span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a>            canvasRenderer<span class="op">.</span><span class="fu">SetMesh</span><span class="op">(</span>workerMesh<span class="op">);</span></span><span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a>     <span class="co">// æä¾›è™šå‡½æ•°ï¼Œæ”¹å˜é¡¶ç‚¹å±æ€§</span></span><span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnPopulateMesh</span><span class="op">(</span>VertexHelper vh<span class="op">)</span></span><span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> r <span class="op">=</span> <span class="fu">GetPixelAdjustedRect</span><span class="op">();</span></span><span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> v <span class="op">=</span> <span class="kw">new</span> <span class="fu">Vector4</span><span class="op">(</span>r<span class="op">.</span><span class="fu">x</span><span class="op">,</span> r<span class="op">.</span><span class="fu">y</span><span class="op">,</span> r<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> r<span class="op">.</span><span class="fu">width</span><span class="op">,</span> r<span class="op">.</span><span class="fu">y</span> <span class="op">+</span> r<span class="op">.</span><span class="fu">height</span><span class="op">);</span></span><span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a>            Color32 color32 <span class="op">=</span> color<span class="op">;</span></span><span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a>            vh<span class="op">.</span><span class="fu">Clear</span><span class="op">();</span></span><span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a>            vh<span class="op">.</span><span class="fu">AddVert</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>v<span class="op">.</span><span class="fu">x</span><span class="op">,</span> v<span class="op">.</span><span class="fu">y</span><span class="op">),</span> color32<span class="op">,</span> <span class="kw">new</span> <span class="fu">Vector2</span><span class="op">(</span>0f<span class="op">,</span> 0f<span class="op">));</span></span><span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a>            vh<span class="op">.</span><span class="fu">AddVert</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>v<span class="op">.</span><span class="fu">x</span><span class="op">,</span> v<span class="op">.</span><span class="fu">w</span><span class="op">),</span> color32<span class="op">,</span> <span class="kw">new</span> <span class="fu">Vector2</span><span class="op">(</span>0f<span class="op">,</span> 1f<span class="op">));</span></span><span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a>            vh<span class="op">.</span><span class="fu">AddVert</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>v<span class="op">.</span><span class="fu">z</span><span class="op">,</span> v<span class="op">.</span><span class="fu">w</span><span class="op">),</span> color32<span class="op">,</span> <span class="kw">new</span> <span class="fu">Vector2</span><span class="op">(</span>1f<span class="op">,</span> 1f<span class="op">));</span></span><span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a>            vh<span class="op">.</span><span class="fu">AddVert</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Vector3</span><span class="op">(</span>v<span class="op">.</span><span class="fu">z</span><span class="op">,</span> v<span class="op">.</span><span class="fu">y</span><span class="op">),</span> color32<span class="op">,</span> <span class="kw">new</span> <span class="fu">Vector2</span><span class="op">(</span>1f<span class="op">,</span> 0f<span class="op">));</span></span><span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a>            vh<span class="op">.</span><span class="fu">AddTriangle</span><span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span><span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a>            vh<span class="op">.</span><span class="fu">AddTriangle</span><span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div></li><li><p>è®¾ç½®Renderçš„è´´å›¾å’Œæè´¨å±æ€§</p><div class="sourceCode" id="cb11"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">UpdateMaterial</span><span class="op">()</span></span><span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(!</span><span class="fu">IsActive</span><span class="op">())</span></span><span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span><span class="op">;</span></span><span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>            canvasRenderer<span class="op">.</span><span class="fu">materialCount</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            canvasRenderer<span class="op">.</span><span class="fu">SetMaterial</span><span class="op">(</span>materialForRendering<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>            canvasRenderer<span class="op">.</span><span class="fu">SetTexture</span><span class="op">(</span>mainTexture<span class="op">);</span></span><span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div></li><li><p>Rebuild</p></li></ol><pre><code>  1. GraphicRegistry æŒ‰é¡ºåºæ³¨å†Œç¼“å­˜     &gt; å‚¨å­˜æ¸²æŸ“å…ƒç´ ï¼Œ ä»¥`Canvas`ä¸ºKeyï¼ŒIndexedSet&lt;Graphic&gt; ä¸ºvalue çš„å­—å…¸     &gt;     &gt; è¿™ä¸ªCanvas æ˜¯çˆ¶èŠ‚ç‚¹éå†çš„ç¬¬ä¸€ä¸ªCanvas     ```csharp     private readonly Dictionary&lt;Canvas, IndexedSet&lt;Graphic&gt;&gt; m_Graphics = new Dictionary&lt;Canvas, IndexedSet&lt;Graphic&gt;&gt;();     ```     1. æ³¨å†Œ GraphicRegistry.RegisterGraphicForCanvasï¼Œ é™æ€æ–¹æ³•å†…éƒ¨å¤„ç†ä½¿ç”¨ å†…éƒ¨é™æ€å¯¹è±¡ s_Instance        &gt; æŒ‰é¡ºåºæ·»åŠ åˆ° Canvas å¯¹åº”çš„Graphic åˆ—è¡¨ä¸­        1. void RegisterGraphicForCanvas(Canvas c, Graphic graphic)     2. GetGraphicsForCanvas(Canvas c)        &gt; æˆ–è€…å¯¹åº”çš„Canvas çš„Graphic çš„å…ƒç´ åˆ—è¡¨  2. CanvasUpdateRegistry     &gt; åˆ†ä¸ºä¸¤å¤§ç±» ï¼š     &gt;     &gt; 1. IndexedSet&lt;ICanvasElement&gt; m_LayoutRebuildQueue     &gt;     &gt; 2. IndexedSet&lt;ICanvasElement&gt; m_GraphicRebuildQueue      &gt;     &gt;    ä¸»è¦æä¾›æ³¨å†Œå’Œç§»é™¤æ¥å£ï¼Œ å†…éƒ¨å¤„ç†ä½¿ç”¨ Canvas.willRenderCanvases += PerformUpdate; å›è°ƒå¤„ç†     &gt;     &gt;    ~~ï¼Œå› æ­¤æµç¨‹æ—¶åºå¾ˆé‡è¦~~ã€‚     1. RegisterCanvasElementForGraphicRebuild      2. RegisterCanvasElementForLayoutRebuild     3. UnRegisterCanvasElementForRebuild, ç§»é™¤layoutå’Œgraphicé˜Ÿåˆ—     4. PerformUpdate        &gt; ä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š        ```csharp        public enum CanvasUpdate            {                /// &lt;summary&gt;                /// Called before layout.                /// &lt;/summary&gt;                Prelayout = 0,                /// &lt;summary&gt;                /// Called for layout.                /// &lt;/summary&gt;                Layout = 1,                /// &lt;summary&gt;                /// Called after layout.                /// &lt;/summary&gt;                PostLayout = 2,                /// &lt;summary&gt;                /// Called before rendering.                /// &lt;/summary&gt;                PreRender = 3,                /// &lt;summary&gt;                /// Called late, before render.                /// &lt;/summary&gt;                LatePreRender = 4,                /// &lt;summary&gt;                /// Max enum value. Always last.                /// &lt;/summary&gt;                MaxUpdateValue = 5            }        ```        éªŒè¯énullçš„UnityObject        ```csharp         private bool ObjectValidForUpdate(ICanvasElement element)                {                    var valid = element != null;                    var isUnityObject = element is Object;                    if (isUnityObject)                        valid = (element as Object) != null; //Here we make use of the overloaded UnityEngine.Object == null, that checks if the native object is alive.                    return valid;                }        ```        1. CleanInvalidItems ç§»é™¤é‡å¤§é˜Ÿåˆ—çš„null å…ƒç´ å’Œæ ‡è®°ä¸ºé”€æ¯çš„å…ƒç´ ï¼Œ **æ ‡è®°é”€æ¯æ˜¯å› ä¸ºå¼•æ“è®¾è®¡é”€æ¯æ“ä½œåœ¨ä¸‹ä¸€å¸§çš„ç¼˜æ•…**        2.  layouté˜Ÿåˆ— æ ¹æ®transformå±‚çº§æ’åº(çˆ¶èŠ‚ç‚¹æ•°ä½œä¸ºçš„å±‚çº§)ã€‚è¿›è¡Œä¸¤æ¬¡è¿­ä»£éªŒè¯énullçš„UnityObjectå¹¶ æ‰§è¡Œ Rebuildå›è°ƒçš„ Prelayoutï¼Œ å’ŒRebuildå›è°ƒçš„ Layout. æœ€åéå†å›è°ƒ LayoutCompleteã€‚ æ¸…ç†Layout ä¸´æ—¶å¼•ç”¨ã€‚           ```csharp           m_PerformingLayoutUpdate = true;           m_LayoutRebuildQueue.Sort(s_SortLayoutFunction);           ```                               ```csharp                   private static int ParentCount(Transform child)                   {                       if (child == null)                           return 0;                       var parent = child.parent;                       int count = 0;                       while (parent != null)                       {                           count++;                           parent = parent.parent;                       }                       return count;                   }           ```           ```csharp                 private bool ObjectValidForUpdate(ICanvasElement element)                   {                       var valid = element != null;                       var isUnityObject = element is Object;                       if (isUnityObject)                           valid = (element as Object) != null; //Here we make use of the overloaded UnityEngine.Object == null, that checks if the native object is alive.                       return valid;                   }           ```           ```csharp            m_LayoutRebuildQueue.Sort(s_SortLayoutFunction);                       for (int i = 0; i &lt;= (int)CanvasUpdate.PostLayout; i++)                       {                           for (int j = 0; j &lt; m_LayoutRebuildQueue.Count; j++)                           {                               var rebuild = instance.m_LayoutRebuildQueue[j];                               try                               {                                   if (ObjectValidForUpdate(rebuild))                                       rebuild.Rebuild((CanvasUpdate)i);                               }                               catch (Exception e)                               {                                   Debug.LogException(e, rebuild.transform);                               }                           }                       }           ```           ```csharp           for (int i = 0; i &lt; m_LayoutRebuildQueue.Count; ++i)                m_LayoutRebuildQueue[i].LayoutComplete();           ```           ```csharp           instance.m_LayoutRebuildQueue.Clear();           m_PerformingLayoutUpdate = false;           ```        3.  æ‰§è¡Œ Cull           ```csharp           // now layout is complete do culling...           ClipperRegistry.instance.Cull();           ```        4. Graphicé˜Ÿåˆ— ,è¿›è¡Œä¸¤æ¬¡è¿­ä»£éªŒè¯énullçš„UnityObjectå¹¶ æ‰§è¡Œ Rebuildå›è°ƒçš„ PreRenderï¼Œ å’ŒRebuildå›è°ƒçš„ LatePreRender. æœ€åéå†å›è°ƒ GraphicUpdateCompleteã€‚ æ¸…ç†Graphicä¸´æ—¶å¼•ç”¨ã€‚           ```csharp           m_PerformingGraphicUpdate = true;                       for (var i = (int)CanvasUpdate.PreRender; i &lt; (int)CanvasUpdate.MaxUpdateValue; i++)                       {                           for (var k = 0; k &lt; instance.m_GraphicRebuildQueue.Count; k++)                           {                               try                               {                                   var element = instance.m_GraphicRebuildQueue[k];                                   if (ObjectValidForUpdate(element))                                       element.Rebuild((CanvasUpdate)i);                               }                               catch (Exception e)                               {                                   Debug.LogException(e, instance.m_GraphicRebuildQueue[k].transform);                               }                           }                       }           ```           ```csharp           for (int i = 0; i &lt; m_GraphicRebuildQueue.Count; ++i)                           m_GraphicRebuildQueue[i].GraphicUpdateComplete();           ```           ```csharp           instance.m_GraphicRebuildQueue.Clear();            m_PerformingGraphicUpdate = false;           ```  3. LayoutRebuilderï¼Œ Layouté›†ä¸­çš„ Rebuildå¤„ç†     &gt; CanvasElement åŒ…è£…å™¨ï¼Œä¸“é—¨å¤„ç†Layoutçš„rebuildï¼Œ     &gt;     &gt; ä¸»è¦æ¥å£ `MarkLayoutForRebuild`, è¿™ä¸ªåŒ…è£…åªå¤„ç†åŒ…å«å¹¶æ¿€æ´»ILayoutGroupçš„RectTransform     &gt;     &gt; æœ€åè°ƒç”¨ `TryRegisterCanvasElementForLayoutRebuild` å¤„ç†     1. è¢«è§¦å‘çš„æ–¹æ³•        ```csharp        protected override void OnBeforeTransformParentChanged()        {           GraphicRegistry.UnregisterGraphicForCanvas(canvas, this);            LayoutRebuilder.MarkLayoutForRebuild(rectTransform);        }        ```        ```csharp        public virtual void SetLayoutDirty()        {           if (!IsActive())               return;           LayoutRebuilder.MarkLayoutForRebuild(rectTransform);           if (m_OnDirtyLayoutCallback != null)               m_OnDirtyLayoutCallback();        }        ```        ```csharp           protected override void OnDisable()           {               //ã€‚ã€‚ã€‚               LayoutRebuilder.MarkLayoutForRebuild(rectTransform);               //ã€‚ã€‚ã€‚           }        ```     2. æ³¨å†Œçš„å›è°ƒäº‹ä»¶        ```csharp        static LayoutRebuilder()        {           RectTransform.reapplyDrivenProperties += ReapplyDrivenProperties;        }        //...        static void ReapplyDrivenProperties(RectTransform driven)        {           MarkLayoutForRebuild(driven);        }        ```     3.  MarkLayoutForRebuild å®ç°ç»†èŠ‚        ```csharp        public static void MarkLayoutForRebuild(RectTransform rect)        {           if (rect == null || rect.gameObject == null)               return;           var comps = ListPool&lt;Component&gt;.Get();            bool validLayoutGroup = true;            RectTransform layoutRoot = rect;            var parent = layoutRoot.parent as RectTransform;            //å¦‚æœçˆ¶èŠ‚ç‚¹å«æœ‰ ILayoutGroupï¼Œ åˆ™ layoutRoot = parent,            //parent = parent'parent            while (validLayoutGroup &amp;&amp; !(parent == null || parent.gameObject == null))            {               validLayoutGroup = false;               parent.GetComponents(typeof(ILayoutGroup), comps);                for (int i = 0; i &lt; comps.Count; ++i)                {                     var cur = comps[i];                     if (cur != null &amp;&amp; cur is Behaviour &amp;&amp; ((Behaviour)cur).isActiveAndEnabled)                     {                          validLayoutGroup = true;                          layoutRoot = parent;                          break;                      }                   }                   parent = parent.parent as RectTransform;            }                    // We know the layout root is valid if it's not the same as the rect,                    // since we checked that above. But if they're the same we still need to check.            //1. ä¸å«æœ‰ ILayoutGroupç»„ä»¶çš„æƒ…å†µï¼Œ æˆ–è€…ILayoutGroupæ²¡æœ‰æ¿€æ´»çš„æƒ…å†µ           if (layoutRoot == rect &amp;&amp; !ValidController(layoutRoot, comps))            {               ListPool&lt;Component&gt;.Release(comps);                return;             }            //2. åŒ…å« ILayoutGroupä¸”æ§ä»¶æ¿€æ´»             MarkLayoutRootForRebuild(layoutRoot);             ListPool&lt;Component&gt;.Release(comps);        }        ```        ```csharp           private static void MarkLayoutRootForRebuild(RectTransform controller)                {                    if (controller == null)                        return;                    var rebuilder = s_Rebuilders.Get();                    rebuilder.Initialize(controller);                    if (!CanvasUpdateRegistry.TryRegisterCanvasElementForLayoutRebuild(rebuilder))                        s_Rebuilders.Release(rebuilder);                }        ```     4. è®¾ç½®å›è°ƒï¼Œ å¯¹åº”è®¾ç½®å¾ç„¶æ•°æ®æ”¹å˜æœ€åçš„å›è°ƒæ–¹æ³•        1. RegisterDirtyLayoutCallback        2. UnregisterDirtyLayoutCallback        3. RegisterDirtyVerticesCallback        4. UnregisterDirtyVerticesCallback        5. RegisterDirtyMaterialCallback        6. UnregisterDirtyMaterialCallback  4. ~~GraphicRebuildTracker.TrackGraphic~~(this);</code></pre><ol start="3" type="1"><li>ç‰©ç†ä»¥åŠäº‹ä»¶</li></ol><blockquote><p>Raycastã€</p></blockquote><ol type="1"><li><p>m_RaycastTargetï¼Œå¯åŠ¨inputäº‹ä»¶æ£€æµ‹</p></li><li><p>Raycast æ–¹æ³•ï¼Œç”¨äºäº‹ä»¶ç›‘æµ‹ï¼Œ<code>Canvas ï¼Œeventsystem</code></p><div class="sourceCode" id="cb13"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">bool</span> <span class="fu">Raycast</span><span class="op">(</span>Vector2 sp<span class="op">,</span> Camera eventCamera<span class="op">)</span></span><span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>            <span class="kw">if</span> <span class="op">(!</span>isActiveAndEnabled<span class="op">)</span></span><span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                <span class="kw">return</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> t <span class="op">=</span> transform<span class="op">;</span></span><span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">var</span> components <span class="op">=</span> ListPool<span class="op">&lt;</span>Component<span class="op">&gt;.</span><span class="fu">Get</span><span class="op">();</span></span><span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">bool</span> ignoreParentGroups <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">bool</span> continueTraversal <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">while</span> <span class="op">(</span>t <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>                t<span class="op">.</span><span class="fu">GetComponents</span><span class="op">(</span>components<span class="op">);</span></span><span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                <span class="kw">for</span> <span class="op">(</span><span class="dt">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> components<span class="op">.</span><span class="fu">Count</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span><span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">var</span> canvas <span class="op">=</span> components<span class="op">[</span>i<span class="op">]</span> <span class="kw">as</span> Canvas<span class="op">;</span></span><span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>canvas <span class="op">!=</span> <span class="kw">null</span> <span class="op">&amp;&amp;</span> canvas<span class="op">.</span><span class="fu">overrideSorting</span><span class="op">)</span></span><span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                        continueTraversal <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">var</span> filter <span class="op">=</span> components<span class="op">[</span>i<span class="op">]</span> <span class="kw">as</span> ICanvasRaycastFilter<span class="op">;</span></span><span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>filter <span class="op">==</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">continue</span><span class="op">;</span></span><span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">var</span> raycastValid <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">var</span> group <span class="op">=</span> components<span class="op">[</span>i<span class="op">]</span> <span class="kw">as</span> CanvasGroup<span class="op">;</span></span><span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(</span>group <span class="op">!=</span> <span class="kw">null</span><span class="op">)</span></span><span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span><span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">if</span> <span class="op">(</span>ignoreParentGroups <span class="op">==</span> <span class="kw">false</span> <span class="op">&amp;&amp;</span> group<span class="op">.</span><span class="fu">ignoreParentGroups</span><span class="op">)</span></span><span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>                        <span class="op">{</span></span><span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>                            ignoreParentGroups <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>                            raycastValid <span class="op">=</span> filter<span class="op">.</span><span class="fu">IsRaycastLocationValid</span><span class="op">(</span>sp<span class="op">,</span> eventCamera<span class="op">);</span></span><span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>                        <span class="op">}</span></span><span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">else</span> <span class="kw">if</span> <span class="op">(!</span>ignoreParentGroups<span class="op">)</span></span><span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>                            raycastValid <span class="op">=</span> filter<span class="op">.</span><span class="fu">IsRaycastLocationValid</span><span class="op">(</span>sp<span class="op">,</span> eventCamera<span class="op">);</span></span><span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span><span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">else</span></span><span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span><span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>                        raycastValid <span class="op">=</span> filter<span class="op">.</span><span class="fu">IsRaycastLocationValid</span><span class="op">(</span>sp<span class="op">,</span> eventCamera<span class="op">);</span></span><span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span><span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">if</span> <span class="op">(!</span>raycastValid<span class="op">)</span></span><span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span><span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>                        ListPool<span class="op">&lt;</span>Component<span class="op">&gt;.</span><span class="fu">Release</span><span class="op">(</span>components<span class="op">);</span></span><span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>                        <span class="kw">return</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span><span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span><span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>                t <span class="op">=</span> continueTraversal <span class="op">?</span> t<span class="op">.</span><span class="fu">parent</span> <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span><span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>            ListPool<span class="op">&lt;</span>Component<span class="op">&gt;.</span><span class="fu">Release</span><span class="op">(</span>components<span class="op">);</span></span><span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div></li><li><p>åŸºç¡€TweenåŠ¨ç”»</p><ol type="1"><li>CrossFadeColorã€</li><li>CrossFadeColorã€</li><li>CreateColorFromAlphaã€</li><li>CrossFadeAlpha</li></ol></li><li><p>ç›¸å¯¹åæ ‡åƒç´ è®¡ç®—</p><ol type="1"><li>PixelAdjustPointã€</li><li>GetPixelAdjustedRect</li></ol></li><li><p><a href="">è¾…åŠ©ç±» Pool, IndexedSet</a></p></li></ol></li></ol></li></ol></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/ugui-yuan-ma-ji-lu/2.ugui-ji-cheng-jie-gou/"/>
      <url>/2022/08/10/unity/ugui-yuan-ma-ji-lu/2.ugui-ji-cheng-jie-gou/</url>
      
        <content type="html"><![CDATA[<h2 id="uguiä¹‹ç»§æ‰¿ç»“æ„">uGUIä¹‹ç»§æ‰¿ç»“æ„</h2><ol type="1"><li><p>UIBehaviour</p><blockquote><p>ç»§æ‰¿è‡ªMonoBehaviour ï¼Œä»£è¡¨ui ç»„ä»¶ï¼ˆåŒºåˆ†æ¸²æŸ“çš„uiç»„ä»¶ï¼‰</p></blockquote><ol type="1"><li>ç»„ä»¶æµç¨‹æ–¹æ³•</li></ol><div class="sourceCode" id="cb1"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>      <span class="co">//æµç¨‹æ–¹æ³•</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">Awake</span><span class="op">()</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnEnable</span><span class="op">()</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">Start</span><span class="op">()</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnDisable</span><span class="op">()</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnDestroy</span><span class="op">()</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span></code></pre></div><ol start="2" type="1"><li><p>ui ç»„ä»¶ç»“æ„å˜åŠ¨å›è°ƒå‡½æ•°</p><div class="sourceCode" id="cb2"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnRectTransformDimensionsChange</span><span class="op">()</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnBeforeTransformParentChanged</span><span class="op">()</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnTransformParentChanged</span><span class="op">()</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnDidApplyAnimationProperties</span><span class="op">()</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnCanvasGroupChanged</span><span class="op">()</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Called when the state of the parent Canvas is changed.</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnCanvasHierarchyChanged</span><span class="op">()</span></span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span></code></pre></div></li><li><p>æ·»åŠ  IsActive æ–¹æ³•</p></li></ol><div class="sourceCode" id="cb3"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>      <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Returns true if the GameObject and the Component are active. </span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// isActiveAndEnabled å˜é‡å­˜åœ¨äº Behaviourä¸­ï¼Œç»„ä»¶éƒ½æœ‰çš„ä¸¤ä¸ªå˜é‡ï¼Œå‘½åè§„åˆ™ isxx éƒ½æ˜¯åªè¯»å˜é‡ </span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// 1. enabled  2. isActiveAndEnabled</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">bool</span> <span class="fu">IsActive</span><span class="op">()</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> isActiveAndEnabled<span class="op">;</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div><ol start="4" type="1"><li><p>æ·»åŠ  IsDestory æ–¹æ³•ï¼ˆtodoï¼‰</p><div class="sourceCode" id="cb4"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Returns true if the native representation of the behaviour has been destroyed.</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;remarks&gt;</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// When a parent canvas is either enabled, disabled or a nested canvas's OverrideSorting is changed this function is called. You can for example use this to modify objects below a canvas that may depend on a parent canvas - for example, if a canvas is disabled you may want to halt some processing of a UI element.</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/remarks&gt;</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">bool</span> <span class="fu">IsDestroyed</span><span class="op">()</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Workaround for Unity native side of the object</span></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            <span class="co">// having been destroyed but accessing via interface</span></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">// won't call the overloaded ==</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">this</span> <span class="op">==</span> <span class="kw">null</span><span class="op">;</span></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div></li><li><p>å®Œæ•´ä»£ç </p></li></ol><div class="sourceCode" id="cb5"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>     <span class="kw">public</span> <span class="kw">abstract</span> <span class="kw">class</span> UIBehaviour <span class="op">:</span> MonoBehaviour</span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">//æµç¨‹æ–¹æ³•</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">Awake</span><span class="op">()</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnEnable</span><span class="op">()</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">Start</span><span class="op">()</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnDisable</span><span class="op">()</span></span><span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnDestroy</span><span class="op">()</span></span><span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Returns true if the GameObject and the Component are active. </span></span><span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// isActiveAndEnabled å˜é‡å­˜åœ¨äº Behaviourä¸­ï¼Œç»„ä»¶éƒ½æœ‰çš„ä¸¤ä¸ªå˜é‡ï¼Œå‘½åè§„åˆ™ isxx éƒ½æ˜¯åªè¯»å˜é‡ </span></span><span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// 1. enabled  2. isActiveAndEnabled</span></span><span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="kw">virtual</span> <span class="dt">bool</span> <span class="fu">IsActive</span><span class="op">()</span></span><span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> isActiveAndEnabled<span class="op">;</span></span><span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="kw">#if</span> UNITY_EDITOR</span><span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnValidate</span><span class="op">()</span></span><span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">Reset</span><span class="op">()</span></span><span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="kw">#endif</span></span><span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// This callback is called if an associated RectTransform has its dimensions changed. The call is also made to all child rect transforms, even if the child transform itself doesn't change - as it could have, depending on its anchoring.</span></span><span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnRectTransformDimensionsChange</span><span class="op">()</span></span><span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnBeforeTransformParentChanged</span><span class="op">()</span></span><span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnTransformParentChanged</span><span class="op">()</span></span><span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnDidApplyAnimationProperties</span><span class="op">()</span></span><span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnCanvasGroupChanged</span><span class="op">()</span></span><span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Called when the state of the parent Canvas is changed.</span></span><span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>        <span class="kw">protected</span> <span class="kw">virtual</span> <span class="dt">void</span> <span class="fu">OnCanvasHierarchyChanged</span><span class="op">()</span></span><span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>        <span class="op">{}</span></span><span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;summary&gt;</span></span><span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// Returns true if the native representation of the behaviour has been destroyed.</span></span><span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/summary&gt;</span></span><span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;remarks&gt;</span></span><span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// When a parent canvas is either enabled, disabled or a nested canvas's OverrideSorting is changed this function is called. You can for example use this to modify objects below a canvas that may depend on a parent canvas - for example, if a canvas is disabled you may want to halt some processing of a UI element.</span></span><span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>        <span class="co">/// </span><span class="kw">&lt;/remarks&gt;</span></span><span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">bool</span> <span class="fu">IsDestroyed</span><span class="op">()</span></span><span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Workaround for Unity native side of the object</span></span><span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>            <span class="co">// having been destroyed but accessing via interface</span></span><span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>            <span class="co">// won't call the overloaded ==</span></span><span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">this</span> <span class="op">==</span> <span class="kw">null</span><span class="op">;</span></span><span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/ugui-yuan-ma-ji-lu/1.ugui-yuan-ma-ban-ben/"/>
      <url>/2022/08/10/unity/ugui-yuan-ma-ji-lu/1.ugui-yuan-ma-ban-ben/</url>
      
        <content type="html"><![CDATA[<h2 id="uguiç‰ˆæœ¬è¯´æ˜">uGUIç‰ˆæœ¬è¯´æ˜</h2><blockquote><p>https://github.com/one2world/Graphics, ä¸»è¦åˆ†æ<code>UnityEngine.UI</code> è¿è¡Œæ—¶</p></blockquote><ol type="1"><li>æ•´ä½“æ¡†æ¶<ol type="1"><li>UnityEditor.UI ç¼–è¾‘å™¨gui<ol start="2" type="1"><li>UnityEngine.UI è¿è¡Œæ—¶gui</li><li>UnityEngine.UI-Editor ç¼–è¾‘å™¨æ ·å¼åŠŸèƒ½ç­‰gui</li></ol></li></ol></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/shader/9.you-hua-tu-xing-xing-neng/"/>
      <url>/2022/08/10/unity/shader/9.you-hua-tu-xing-xing-neng/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¼˜åŒ–å›¾å½¢æ€§èƒ½">ä¼˜åŒ–å›¾å½¢æ€§èƒ½</h1><blockquote><p>é˜´å½±æŠ•å°„ç‰©??</p></blockquote><h2 id="ç»˜åˆ¶è°ƒç”¨æ‰¹å¤„ç†">ç»˜åˆ¶è°ƒç”¨æ‰¹å¤„ç†</h2><p>è¦åœ¨å±å¹•ä¸Šç»˜åˆ¶æ¸¸æˆå¯¹è±¡ï¼Œå¼•æ“å¿…é¡»å‘å›¾å½¢ APIï¼ˆä¾‹å¦‚ OpenGL æˆ–Direct3Dï¼‰<code>å‘å‡ºç»˜åˆ¶è°ƒç”¨</code>ã€‚ç»˜åˆ¶è°ƒç”¨é€šå¸¸ä¸º<code>èµ„æºå¯†é›†å‹æ“ä½œ</code>ï¼Œå›¾å½¢API ä¸ºæ¯æ¬¡ç»˜åˆ¶è°ƒç”¨æ‰§è¡Œå¤§é‡å·¥ä½œï¼Œä»è€Œå¯¼è‡´ <strong>CPUç«¯çš„æ€§èƒ½å¼€é”€</strong>ã€‚æ­¤å¼€é”€çš„ä¸»è¦åŸå› æ˜¯ç»˜åˆ¶è°ƒç”¨ä¹‹é—´çš„çŠ¶æ€å˜åŒ–ï¼ˆä¾‹å¦‚åˆ‡æ¢åˆ°ä¸åŒæè´¨ï¼‰ï¼Œè€Œè¿™ç§æƒ…å†µä¼šå¯¼è‡´å›¾å½¢é©±åŠ¨ç¨‹åºä¸­æ‰§è¡Œèµ„æºå¯†é›†å‹éªŒè¯å’Œè½¬æ¢æ­¥éª¤ã€‚</p><ul><li>åŠ¨æ€æ‰¹å¤„ç†ï¼šå¯¹äºè¶³å¤Ÿå°çš„ç½‘æ ¼ï¼Œæ­¤æ–¹æ³•ä¼šåœ¨ CPUä¸Šè½¬æ¢ç½‘æ ¼çš„é¡¶ç‚¹ï¼Œå°†è®¸å¤š<strong>ç›¸ä¼¼é¡¶ç‚¹</strong><code>ç»„åˆåœ¨ä¸€èµ·</code>ï¼Œå¹¶ä¸€æ¬¡æ€§ç»˜åˆ¶å®ƒä»¬ã€‚</li><li>é™æ€æ‰¹å¤„ç†ï¼š<strong>å°†é™æ€ï¼ˆä¸ç§»åŠ¨</strong>æ¸¸æˆå¯¹è±¡<code>ç»„åˆæˆå¤§ç½‘æ ¼</code>ï¼Œå¹¶ä»¥è¾ƒå¿«çš„é€Ÿåº¦æ¸²æŸ“å®ƒä»¬ã€‚</li></ul><p>ä¸æ‰‹åŠ¨åˆå¹¶æ¸¸æˆå¯¹è±¡ç›¸æ¯”ï¼Œå†…ç½®æ‰¹å¤„ç†æœ‰å‡ ä¸ªå¥½å¤„ï¼›æœ€å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä»ç„¶å¯ä»¥å•ç‹¬å‰”é™¤æ¸¸æˆå¯¹è±¡ã€‚ä½†æ˜¯ï¼Œä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼›<strong>é™æ€æ‰¹å¤„ç†ä¼šå¯¼è‡´å†…å­˜å’Œå­˜å‚¨å¼€é”€ï¼ŒåŠ¨æ€æ‰¹å¤„ç†ä¼šäº§ç”Ÿä¸€äº›CPU å¼€é”€</strong>ã€‚</p><h3 id="æ‰¹å¤„ç†çš„æè´¨è®¾ç½®">æ‰¹å¤„ç†çš„æè´¨è®¾ç½®</h3><p><strong>åªæœ‰å…±äº«ç›¸åŒæè´¨çš„æ¸¸æˆå¯¹è±¡æ‰å¯ä¸€èµ·æ¥å—æ‰¹å¤„ç†</strong>ã€‚å› æ­¤ï¼Œå¦‚æœæƒ³è¦å®ç°è‰¯å¥½æ‰¹å¤„ç†ï¼Œåº”åœ¨å°½å¯èƒ½å¤šçš„ä¸åŒæ¸¸æˆå¯¹è±¡ä¹‹é—´å…±äº«æè´¨ã€‚</p><ul><li><p>å¦‚æœä¸¤ç§ç›¸åŒæè´¨ä»…åœ¨çº¹ç†ä¸Šä¸åŒï¼Œ<code>å¯å°†è¿™äº›çº¹ç†ç»„åˆæˆå•ä¸ªå¤§çº¹ç†</code>ã€‚æ­¤è¿‡ç¨‹é€šå¸¸ç§°ä¸ºçº¹ç†é•¶åµŒï¼ˆçº¹ç†å›¾é›†Textureatlasesï¼‰ã€‚ä¸€æ—¦çº¹ç†ä½äºç›¸åŒå›¾é›†ä¸­ï¼Œå³å¯ä½¿ç”¨å•ä¸ªæè´¨ã€‚</p></li><li><p>å¦‚æœéœ€è¦ä»è„šæœ¬è®¿é—®å…±äº«æè´¨å±æ€§ï¼Œå¿…é¡»æ³¨æ„ï¼Œä¿®æ”¹ Renderer.material<code>å°†åˆ›å»ºè¯¥æè´¨çš„å‰¯æœ¬</code>ã€‚<strong>åº”æ”¹ç”¨ Renderer.sharedMaterialæ¥ä¿ç•™å…±äº«çš„æè´¨</strong>ã€‚</p></li><li><p>é˜´å½±æŠ•å°„ç‰©å³ä½¿æè´¨ä¸åŒï¼Œé€šå¸¸ä¹Ÿå¯ä»¥åœ¨æ¸²æŸ“æ—¶æ¥å—æ‰¹å¤„ç†ã€‚Unityä¸­çš„é˜´å½±æŠ•å°„ç‰©å³ä½¿å…·æœ‰ä¸åŒæè´¨ä¹Ÿå¯ä»¥ä½¿ç”¨åŠ¨æ€æ‰¹å¤„ç†ï¼Œåªè¦é˜´å½± passæ‰€éœ€æè´¨ä¸­çš„å€¼ç›¸åŒå³å¯ã€‚ä¾‹å¦‚ï¼Œè®¸å¤šæ¿æ¡ç®±å¯èƒ½ä½¿ç”¨å…·æœ‰ä¸åŒçº¹ç†çš„æè´¨ï¼Œä½†æ˜¯ç”±äºæ¸²æŸ“çº¹ç†çš„é˜´å½±æŠ•å°„ç‰©ä¸ç›¸å…³ï¼Œæ‰€ä»¥åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬å¯ä»¥ä¸€èµ·æ¥å—æ‰¹å¤„ç†ã€‚</p></li></ul><h3 id="åŠ¨æ€æ‰¹å¤„ç†ç½‘æ ¼">åŠ¨æ€æ‰¹å¤„ç†ï¼ˆç½‘æ ¼ï¼‰</h3><p>å¦‚æœç§»åŠ¨çš„æ¸¸æˆå¯¹è±¡å…±äº«ç›¸åŒæè´¨å¹¶æ»¡è¶³å…¶ä»–æ¡ä»¶ï¼Œåˆ™ Unityå¯è‡ªåŠ¨åœ¨åŒä¸€ç»˜åˆ¶è°ƒç”¨ä¸­æ‰¹å¤„ç†è¿™äº›æ¸¸æˆå¯¹è±¡ã€‚åŠ¨æ€æ‰¹å¤„ç†æ˜¯è‡ªåŠ¨å®Œæˆçš„ï¼Œæ— éœ€æ‚¨è¿›è¡Œä»»ä½•é¢å¤–å·¥ä½œã€‚</p><ul><li>æ‰¹å¤„ç†åŠ¨æ€æ¸¸æˆå¯¹è±¡åœ¨æ¯ä¸ªé¡¶ç‚¹éƒ½æœ‰ä¸€å®šå¼€é”€ï¼Œå› æ­¤æ‰¹å¤„ç†ä»…ä¼šåº”ç”¨äºæ€»å…±åŒ…å«<strong>ä¸è¶…è¿‡900 ä¸ªé¡¶ç‚¹å±æ€§</strong>ä¸”<strong>ä¸è¶…è¿‡ 300 ä¸ªé¡¶ç‚¹</strong>çš„ç½‘æ ¼ã€‚<ul><li>å¦‚æœç€è‰²å™¨ä½¿ç”¨é¡¶ç‚¹ä½ç½®ã€æ³•çº¿å’Œå•ä¸ª UVï¼Œæœ€å¤šå¯ä»¥æ‰¹å¤„ç† 300ä¸ªé¡¶ç‚¹ï¼Œè€Œå¦‚æœç€è‰²å™¨ä½¿ç”¨é¡¶ç‚¹ä½ç½®ã€æ³•çº¿ã€UV0ã€UV1 å’Œåˆ‡çº¿ï¼Œåˆ™åªèƒ½æ‰¹å¤„ç†180 ä¸ªé¡¶ç‚¹ã€‚</li><li><strong>æ³¨æ„</strong>ï¼šå°†æ¥å¯èƒ½ä¼šæ›´æ”¹å±æ€§æ•°é‡é™åˆ¶ã€‚</li></ul></li><li>å¦‚æœæ¸¸æˆå¯¹è±¡åœ¨å˜æ¢ä¸­åŒ…å«é•œåƒï¼Œåˆ™ä¸ä¼šå¯¹è¿™äº›å¯¹è±¡è¿›è¡Œæ‰¹å¤„ç†ï¼ˆ<strong>ä¾‹å¦‚ï¼Œå…·æœ‰+1 ç¼©æ”¾çš„æ¸¸æˆå¯¹è±¡ A å’Œå…·æœ‰ â€“1 ç¼©æ”¾çš„æ¸¸æˆå¯¹è±¡ Bæ— æ³•ä¸€èµ·æ¥å—æ‰¹å¤„ç†</strong>ï¼‰ã€‚</li><li>å³ä½¿æ¸¸æˆå¯¹è±¡åŸºæœ¬ç›¸åŒï¼Œä½¿ç”¨ä¸åŒçš„æè´¨å®ä¾‹ä¹Ÿä¼šå¯¼è‡´æ¸¸æˆå¯¹è±¡ä¸èƒ½ä¸€èµ·æ¥å—æ‰¹å¤„ç†ã€‚<strong>ä¾‹å¤–æƒ…å†µæ˜¯é˜´å½±æŠ•å°„ç‰©æ¸²æŸ“</strong>ã€‚</li><li>å¸¦æœ‰å…‰ç…§è´´å›¾çš„æ¸¸æˆå¯¹è±¡å…·æœ‰å…¶ä»–æ¸²æŸ“å™¨å‚æ•°ï¼šå…‰ç…§è´´å›¾ç´¢å¼•å’Œå…‰ç…§è´´å›¾åç§»/ç¼©æ”¾ã€‚é€šå¸¸ï¼ŒåŠ¨æ€å…‰ç…§è´´å›¾çš„æ¸¸æˆå¯¹è±¡åº”æŒ‡å‘è¦æ‰¹å¤„ç†çš„å®Œå…¨ç›¸åŒçš„å…‰ç…§è´´å›¾ä½ç½®ã€‚</li><li>å¤š pass ç€è‰²å™¨ä¼šä¸­æ–­æ‰¹å¤„ç†ã€‚<ul><li>å‡ ä¹æ‰€æœ‰çš„ Unityç€è‰²å™¨éƒ½æ”¯æŒå‰å‘æ¸²æŸ“ä¸­çš„å¤šä¸ªå…‰ç…§ï¼Œæœ‰æ•ˆåœ°ä¸ºå®ƒä»¬æ‰§è¡Œé¢å¤–passã€‚â€œå…¶ä»–æ¯åƒç´ å…‰ç…§â€çš„ç»˜åˆ¶è°ƒç”¨ä¸è¿›è¡Œæ‰¹å¤„ç†ã€‚</li><li>æ—§ç‰ˆå»¶è¿Ÿï¼ˆå…‰ç…§pre-passï¼‰æ¸²æŸ“è·¯å¾„ä¼šç¦ç”¨åŠ¨æ€æ‰¹å¤„ç†ï¼Œå› ä¸ºå®ƒå¿…é¡»ç»˜åˆ¶ä¸¤æ¬¡æ¸¸æˆå¯¹è±¡ã€‚</li></ul></li></ul><p>å› ä¸ºåŠ¨æ€æ‰¹å¤„ç†çš„å·¥ä½œåŸç†æ˜¯<strong>å°†æ‰€æœ‰æ¸¸æˆå¯¹è±¡é¡¶ç‚¹</strong>è½¬æ¢åˆ°<strong>CPUä¸Šçš„ä¸–ç•Œç©ºé—´</strong>ï¼Œæ‰€ä»¥ä»…åœ¨è¯¥å·¥ä½œå°äºè¿›è¡Œç»˜åˆ¶è°ƒç”¨çš„æƒ…å†µä¸‹ï¼Œæ‰æœ‰ä¼˜åŠ¿ã€‚ç»˜åˆ¶è°ƒç”¨çš„èµ„æºéœ€æ±‚å–å†³äºè®¸å¤šå› ç´ ï¼Œä¸»è¦æ˜¯ä½¿ç”¨çš„å›¾å½¢APIã€‚ä¾‹å¦‚ï¼Œå¯¹äºæ¸¸æˆä¸»æœºæˆ–è¯¸å¦‚ Apple Metal ä¹‹ç±»çš„ç°ä»£APIï¼Œ<strong>ç»˜åˆ¶è°ƒç”¨çš„å¼€é”€é€šå¸¸ä½å¾—å¤šï¼Œé€šå¸¸åŠ¨æ€æ‰¹å¤„ç†æ ¹æœ¬æ²¡æœ‰ä¼˜åŠ¿</strong>ã€‚</p><h3 id="åŠ¨æ€æ‰¹å¤„ç†ç²’å­ç³»ç»Ÿçº¿æ¸²æŸ“å™¨è½¨è¿¹æ¸²æŸ“å™¨">åŠ¨æ€æ‰¹å¤„ç†ï¼ˆç²’å­ç³»ç»Ÿã€çº¿æ¸²æŸ“å™¨ã€è½¨è¿¹æ¸²æŸ“å™¨ï¼‰</h3><p>åŠ¨æ€æ‰¹å¤„ç†åœ¨ç”¨äºå…·æœ‰ UnityåŠ¨æ€ç”Ÿæˆçš„å‡ ä½•ä½“çš„ç»„ä»¶æ—¶ï¼Œå…¶å·¥ä½œæ–¹å¼ä¸ç”¨äºç½‘æ ¼æ—¶ä¸åŒã€‚</p><ul><li><ol type="1"><li>å¯¹äºæ¯ä¸ªå…¼å®¹çš„æ¸²æŸ“å™¨ç±»å‹ï¼ŒUnity å°†æ‰€æœ‰å¯æ‰¹å¤„ç†çš„å†…å®¹æ„å»ºä¸º 1ä¸ªå¤§å‹é¡¶ç‚¹ç¼“å†²åŒºã€‚</li></ol></li><li><ol start="2" type="1"><li>æ¸²æŸ“å™¨è®¾ç½®æè´¨çŠ¶æ€ä»¥ç”¨äºæ‰¹å¤„ç†ã€‚</li></ol></li><li><ol start="3" type="1"><li>Unity å°†é¡¶ç‚¹ç¼“å†²åŒºç»‘å®šåˆ°å›¾å½¢è®¾å¤‡ã€‚</li></ol></li><li><ol start="4" type="1"><li>å¯¹äºæ‰¹å¤„ç†ä¸­çš„æ¯ä¸ªæ¸²æŸ“å™¨ï¼ŒUnityå°†åç§»æ›´æ–°åˆ°é¡¶ç‚¹ç¼“å†²åŒºä¸­ï¼Œç„¶åæäº¤æ–°çš„ç»˜åˆ¶è°ƒç”¨ã€‚</li></ol></li></ul><p>åœ¨è¡¡é‡å›¾å½¢è®¾å¤‡è°ƒç”¨çš„æˆæœ¬æ—¶ï¼Œ<strong>æ¸²æŸ“ç»„ä»¶æ—¶çš„æœ€æ…¢éƒ¨åˆ†æ˜¯æè´¨çŠ¶æ€çš„è®¾ç½®</strong>ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå°†ä¸åŒåç§»å¤„çš„ç»˜åˆ¶è°ƒç”¨æäº¤åˆ°å…±äº«é¡¶ç‚¹ç¼“å†²åŒºä¸­çš„é€Ÿåº¦éå¸¸å¿«ã€‚è¿™ç§æ–¹æ³•ä¸ Unity åœ¨ä½¿ç”¨é™æ€æ‰¹å¤„ç†æ—¶æäº¤ç»˜åˆ¶è°ƒç”¨çš„æ–¹å¼éå¸¸ç›¸ä¼¼ã€‚</p><h3 id="é™æ€æ‰¹å¤„ç†">é™æ€æ‰¹å¤„ç†</h3><p>ä½¿ç”¨é™æ€æ‰¹å¤„ç†ï¼Œå¼•æ“å¯å‡å°‘ä»»ä½•å¤§å°çš„å‡ ä½•ä½“çš„ç»˜åˆ¶è°ƒç”¨ï¼Œä½†å‰ææ˜¯å®ƒ<strong>å…±äº«ç›¸åŒæè´¨å¹¶ä¸”ä¸ç§»åŠ¨</strong>ã€‚<strong>è¿™ç§å¤„ç†æ–¹å¼é€šå¸¸æ¯”åŠ¨æ€æ‰¹å¤„ç†æ›´é«˜æ•ˆ</strong>ï¼ˆå®ƒä¸ä¼šåœ¨CPU ä¸Šè½¬æ¢é¡¶ç‚¹ï¼‰ï¼Œ<strong>ä½†æ˜¯ä½¿ç”¨æ›´å¤šå†…å­˜</strong>ã€‚ä¸ºäº†åˆ©ç”¨é™æ€æ‰¹å¤„ç†ï¼Œæ‚¨éœ€è¦æ˜¾å¼æŒ‡å®šæŸäº›æ¸¸æˆå¯¹è±¡æ˜¯é™æ€å¯¹è±¡ä¸”ä¸ä¼šåœ¨æ¸¸æˆä¸­ç§»åŠ¨ã€æ—‹è½¬æˆ–ç¼©æ”¾ã€‚ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨Inspector ä¸­çš„ Static å¤é€‰æ¡†ï¼Œå°†æ¸¸æˆå¯¹è±¡æ ‡è®°ä¸ºé™æ€ï¼š</p><p>ä½¿ç”¨é™æ€æ‰¹å¤„ç†<strong>éœ€è¦é¢å¤–çš„å†…å­˜æ¥å­˜å‚¨ç»„åˆçš„å‡ ä½•ä½“</strong>ã€‚å¦‚æœå¤šä¸ªæ¸¸æˆå¯¹è±¡åœ¨é™æ€æ‰¹å¤„ç†ä¹‹å‰å…±äº«ç›¸åŒå‡ ä½•ä½“ï¼Œåˆ™ä¼šåœ¨<strong>Editorä¸­æˆ–è¿è¡Œæ—¶ä¸ºæ¯ä¸ªæ¸¸æˆå¯¹è±¡åˆ›å»ºå‡ ä½•ä½“çš„å‰¯æœ¬</strong>ã€‚è¿™å¯èƒ½å¹¶éæ€»æ˜¯å¥½åŠæ³•ï¼›æœ‰æ—¶æ‚¨å¿…é¡»é¿å…ä¸ºæŸäº›æ¸¸æˆå¯¹è±¡è¿›è¡Œé™æ€æ‰¹å¤„ç†ï¼Œè¿™æ ·ä¼šç‰ºç‰²æ¸²æŸ“æ€§èƒ½ï¼Œä½†å¯ä¿æŒè¾ƒå°çš„å†…å­˜å ç”¨é‡ã€‚<strong>ä¾‹å¦‚ï¼Œåœ¨èŒ‚å¯†æ£®æ—å…³å¡ä¸­ï¼Œå°†æ ‘æ ‡è®°ä¸ºé™æ€å¯èƒ½ä¼šäº§ç”Ÿä¸¥é‡çš„å†…å­˜å½±å“</strong>ã€‚åœ¨å†…éƒ¨ï¼Œé™æ€æ‰¹å¤„ç†çš„<strong>å·¥ä½œåŸç†æ˜¯å°†é™æ€æ¸¸æˆå¯¹è±¡è½¬æ¢åˆ°ä¸–ç•Œç©ºé—´å¹¶ä¸ºå®ƒä»¬æ„å»ºä¸€ä¸ªå…±äº«çš„é¡¶ç‚¹å’Œç´¢å¼•ç¼“å†²åŒº</strong>ã€‚å¦‚æœå·²å¯ç”¨Optimized Mesh Data__ï¼ˆåœ¨ Player__ è®¾ç½®ä¸­ï¼‰ï¼Œåˆ™ Unityä¼šåœ¨æ„å»ºé¡¶ç‚¹ç¼“å†²åŒºæ—¶åˆ é™¤ä»»ä½•ç€è‰²å™¨å˜ä½“æœªä½¿ç”¨çš„ä»»ä½•é¡¶ç‚¹å…ƒç´ ã€‚ä¸ºäº†æ‰§è¡Œæ­¤æ“ä½œï¼Œç³»ç»Ÿä¼šè¿›è¡Œä¸€äº›ç‰¹æ®Šçš„å…³é”®å­—æ£€æŸ¥ï¼›ä¾‹å¦‚ï¼Œå¦‚æœUnity æœªæ£€æµ‹åˆ° LIGHTMAP_ON å…³é”®å­—ï¼Œåˆ™ä¼šä»æ‰¹å¤„ç†ä¸­åˆ é™¤å…‰ç…§è´´å›¾UVã€‚ç„¶åï¼Œé’ˆå¯¹åŒä¸€æ‰¹æ¬¡ä¸­çš„å¯è§æ¸¸æˆå¯¹è±¡ï¼ŒUnityä¼šæ‰§è¡Œä¸€ç³»åˆ—ç®€å•çš„ç»˜åˆ¶è°ƒç”¨ï¼Œæ¯æ¬¡è°ƒç”¨ä¹‹é—´å‡ ä¹æ²¡æœ‰çŠ¶æ€å˜åŒ–ã€‚åœ¨æŠ€æœ¯ä¸Šï¼ŒUnityä¸ä¼šå‡å°‘ APIç»˜åˆ¶è°ƒç”¨ï¼Œè€Œæ˜¯å‡å°‘å®ƒä»¬ä¹‹é—´çš„çŠ¶æ€å˜åŒ–ï¼ˆè¿™æ­£æ˜¯æ¶ˆè€—å¤§é‡èµ„æºçš„éƒ¨åˆ†ï¼‰ã€‚åœ¨å¤§å¤šæ•°å¹³å°ä¸Šï¼Œæ‰¹å¤„ç†é™åˆ¶ä¸º64k ä¸ªé¡¶ç‚¹å’Œ 64k ä¸ªç´¢å¼•ï¼ˆOpenGLES ä¸Šä¸º 48k ä¸ªç´¢å¼•ï¼Œåœ¨ macOS ä¸Šä¸º 32kä¸ªç´¢å¼•ï¼‰ã€‚</p><p><strong>å½“å‰ï¼Œä»…å¯¹ç½‘æ ¼æ¸²æŸ“å™¨ã€è½¨è¿¹æ¸²æŸ“å™¨ã€çº¿æ¸²æŸ“å™¨ã€ç²’å­ç³»ç»Ÿå’Œç²¾çµæ¸²æŸ“å™¨è¿›è¡Œæ‰¹å¤„ç†ã€‚è¿™æ„å‘³ç€<code>ä¸ä¼šå¯¹è’™çš®ç½‘æ ¼ã€å¸ƒæ–™å’Œå…¶ä»–ç±»å‹çš„æ¸²æŸ“ç»„ä»¶</code>è¿›è¡Œæ‰¹å¤„ç†ã€‚</strong></p><p>æ¸²æŸ“å™¨ä»…ä¸å…¶ä»–ç›¸åŒç±»å‹çš„æ¸²æŸ“å™¨ä¸€èµ·æ¥å—æ‰¹å¤„ç†ã€‚åŠé€æ˜ç€è‰²å™¨é€šå¸¸è¦æ±‚æ¸¸æˆå¯¹è±¡æŒ‰ç…§ä»ååˆ°å‰çš„é¡ºåºè¿›è¡Œæ¸²æŸ“ï¼Œä»è€Œå®ç°é€æ˜æ€§ã€‚Unityé¦–å…ˆæŒ‰æ­¤é¡ºåºå¯¹æ¸¸æˆå¯¹è±¡æ’åºï¼Œç„¶åå°è¯•å¯¹å®ƒä»¬è¿›è¡Œæ‰¹å¤„ç†ï¼Œä½†æ˜¯å› ä¸ºå¿…é¡»ä¸¥æ ¼æ»¡è¶³é¡ºåºï¼Œæ‰€ä»¥è¿™é€šå¸¸æ„å‘³ç€å¯ä»¥å®ç°æ¯”ä¸é€æ˜æ¸¸æˆå¯¹è±¡æ›´å°‘çš„æ‰¹å¤„ç†ã€‚æ‰‹åŠ¨ç»„åˆå½¼æ­¤æ¥è¿‘çš„æ¸¸æˆå¯¹è±¡å¯ä»¥æ˜¯ç»˜åˆ¶è°ƒç”¨æ‰¹å¤„ç†çš„æå¥½æ›¿ä»£æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¸¦æœ‰å¤§é‡æŠ½å±‰çš„é™æ€æ©±æŸœé€šå¸¸åªéœ€åœ¨3D å»ºæ¨¡åº”ç”¨ç¨‹åºä¸­æˆ–è€…ä½¿ç”¨ <code>Mesh.CombineMeshes</code>æ¥ç»„åˆæˆä¸€ä¸ªç½‘æ ¼ã€‚</p><h2 id="è§’è‰²å»ºæ¨¡çš„ä¼˜åŒ–">è§’è‰²å»ºæ¨¡çš„ä¼˜åŒ–</h2><h2 id="statistics-çª—å£">Statistics çª—å£</h2><table><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr class="header"><th style="text-align: left;">é€‰é¡¹</th><th style="text-align: left;">å«ä¹‰</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">Time per frame and FPS</td><td style="text-align: left;">å¤„ç†å’Œæ¸²æŸ“ä¸€ä¸ªæ¸¸æˆå¸§æ‰€èŠ±è´¹çš„æ—¶é—´ï¼ˆåŠå…¶å€’æ•°ï¼Œå³æ¯ç§’å¸§æ•°ï¼‰ã€‚è¯·æ³¨æ„ï¼Œæ­¤æ•°å­—ä»…åŒ…æ‹¬è¿›è¡Œå¸§æ›´æ–°å’Œæ¸²æŸ“Game è§†å›¾æ‰€ç”¨çš„æ—¶é—´ï¼›ä¸åŒ…æ‹¬åœ¨ Editor ä¸­ç»˜åˆ¶ Sceneè§†å›¾ã€æ£€è§†é¢æ¿å¤„ç†å’Œå…¶ä»–ä»…é™äº</td></tr><tr class="even"><td style="text-align: left;">Batches</td><td style="text-align: left;">â€œæ‰¹å¤„ç†(Batching)â€å¯è®©å¼•æ“å°è¯•å°†å¤šä¸ªå¯¹è±¡çš„æ¸²æŸ“ç»„åˆåˆ°ä¸€ä¸ªå†…å­˜å—ä¸­ä»¥ä¾¿å‡å°‘ç”±äºèµ„æºåˆ‡æ¢è€Œå¯¼è‡´çš„CPU å¼€é”€ã€‚</td></tr><tr class="odd"><td style="text-align: left;">Saved by batching</td><td style="text-align: left;">åˆå¹¶çš„æ‰¹æ¬¡æ•°ã€‚ä¸ºç¡®ä¿è‰¯å¥½çš„æ‰¹å¤„ç†ï¼Œåº”å°½å¯èƒ½åœ¨ä¸åŒå¯¹è±¡ä¹‹é—´å…±äº«æè´¨ã€‚æ›´æ”¹æ¸²æŸ“çŠ¶æ€ä¼šå°†æ‰¹æ¬¡åˆ†æˆå…·æœ‰ç›¸åŒçŠ¶æ€çš„ç»„ã€‚</td></tr><tr class="even"><td style="text-align: left;">Tris å’Œ Verts</td><td style="text-align: left;">ç»˜åˆ¶çš„ä¸‰è§’å½¢å’Œé¡¶ç‚¹çš„æ•°é‡ã€‚åœ¨é’ˆå¯¹ä½ç«¯ç¡¬ä»¶è¿›è¡Œä¼˜åŒ–æ—¶ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦</td></tr><tr class="odd"><td style="text-align: left;">Screen</td><td style="text-align: left;">å±å¹•å¤§å°ä»¥åŠæŠ—é”¯é½¿çº§åˆ«å’Œå†…å­˜ä½¿ç”¨æƒ…å†µã€‚</td></tr><tr class="even"><td style="text-align: left;">SetPass</td><td style="text-align: left;">æ¸²æŸ“ pass çš„æ•°é‡ã€‚æ¯ä¸ª pass éƒ½éœ€è¦ Unityè¿è¡Œæ—¶ç»‘å®šä¸€ä¸ªæ–°çš„ç€è‰²å™¨ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥ CPU å¼€é”€ã€‚</td></tr><tr class="odd"><td style="text-align: left;">Visible Skinned Meshes</td><td style="text-align: left;">æ¸²æŸ“çš„è’™çš®ç½‘æ ¼çš„æ•°é‡ã€‚</td></tr><tr class="even"><td style="text-align: left;">Animations</td><td style="text-align: left;">æ’­æ”¾çš„åŠ¨ç”»çš„æ•°é‡ã€‚</td></tr></tbody></table><h2 id="ä¼˜åŒ–ç€è‰²å™¨åŠ è½½æ—¶é—´">ä¼˜åŒ–ç€è‰²å™¨åŠ è½½æ—¶é—´</h2><p>ç€è‰²å™¨æ˜¯åœ¨ GPU ä¸Šæ‰§è¡Œçš„å°ç¨‹åºï¼ŒåŠ è½½å®ƒä»¬å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚æ¯ä¸ªå•ç‹¬çš„GPUç¨‹åºé€šå¸¸ä¸ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´æ¥åŠ è½½ï¼Œ<strong>ä½†ç€è‰²å™¨é€šå¸¸åœ¨å†…éƒ¨æœ‰å¾ˆå¤šâ€œå˜ä½“â€</strong>ã€‚</p><p>ä¾‹å¦‚ï¼Œæ ‡å‡†ç€è‰²å™¨åœ¨å®Œå…¨ç¼–è¯‘åï¼Œæœ€ç»ˆå°†æˆä¸ºæ•°åƒä¸ªç•¥å¾®ä¸åŒçš„ GPUç¨‹åºã€‚è¿™ç§æƒ…å†µå¯äº§ç”Ÿä¸¤ä¸ªæ½œåœ¨é—®é¢˜ï¼š</p><ul><li>å¤§é‡çš„è¿™äº›ç€è‰²å™¨å˜ä½“å°†<strong>å¢åŠ æ¸¸æˆæ„å»ºæ—¶é—´å’Œæ¸¸æˆæ•°æ®å¤§å°</strong>ã€‚</li><li>åœ¨æ¸¸æˆè¿‡ç¨‹ä¸­åŠ è½½å¤§é‡ç€è‰²å™¨å˜ä½“<strong>å°†å¾ˆæ…¢å¹¶å ç”¨å†…å­˜</strong>ã€‚</li></ul><h3 id="ç€è‰²å™¨æ„å»ºæ—¶å‰¥ç¦»">ç€è‰²å™¨æ„å»ºæ—¶å‰¥ç¦»</h3><p>åœ¨æ„å»ºæ¸¸æˆæ—¶ï¼ŒUnityå¯èƒ½æ£€æµ‹åˆ°æ¸¸æˆä¸ä½¿ç”¨æŸäº›å†…éƒ¨ç€è‰²å™¨å˜ä½“ï¼Œå¹¶ä»æ„å»ºæ•°æ®ä¸­è·³è¿‡å®ƒä»¬ã€‚æ„å»ºæ—¶å‰¥ç¦»å°†ç”¨äºä»¥ä¸‹å„é¡¹ï¼š</p><ul><li>å„ä¸ªç€è‰²å™¨åŠŸèƒ½ï¼ˆé’ˆå¯¹ä½¿ç”¨ #pragma shader_featureçš„ç€è‰²å™¨ï¼‰ã€‚å¦‚æœæ‰€ä½¿ç”¨çš„æè´¨éƒ½ä¸ä½¿ç”¨ç‰¹å®šå˜ä½“ï¼Œåˆ™è¯¥å˜ä½“ä¸ä¼šåŒ…å«åœ¨æ„å»ºä¸­ã€‚è¯·å‚é˜…å†…éƒ¨ç€è‰²å™¨å˜ä½“æ–‡æ¡£ã€‚åœ¨å†…ç½®ç€è‰²å™¨ä¸­ï¼Œæ ‡å‡†ç€è‰²å™¨ä¼šä½¿ç”¨æ„å»ºæ—¶å‰¥ç¦»ã€‚</li><li>ä»»ä½•åœºæ™¯æœªä½¿ç”¨çš„å¯å¤„ç†é›¾æ•ˆå’Œå…‰ç…§è´´å›¾æ¨¡å¼çš„ç€è‰²å™¨å˜ä½“ä¸ä¼šåŒ…å«åœ¨æ¸¸æˆæ•°æ®ä¸­ã€‚å¦‚æœè¦è¦†ç›–æ­¤è¡Œä¸ºï¼Œè¯·å‚é˜…Graphics çª—å£ã€‚</li></ul><p>ä¸Šè¿°çš„ç»„åˆé€šå¸¸ä¼šå¤§å¤§å‡å°ç€è‰²å™¨æ•°æ®å¤§å°ã€‚ä¾‹å¦‚ï¼Œå®Œå…¨ç¼–è¯‘åçš„æ ‡å‡†ç€è‰²å™¨å°†å ç”¨å‡ ç™¾å…†å­—èŠ‚ï¼Œä½†åœ¨å…¸å‹çš„é¡¹ç›®ä¸­ï¼Œé€šå¸¸æœ€ç»ˆä»…å ç”¨å‡ å…†å­—èŠ‚ï¼ˆå¹¶ä¸”é€šå¸¸ä¼šç”±åº”ç”¨ç¨‹åºæ‰“åŒ…è¿‡ç¨‹è¿›ä¸€æ­¥å‹ç¼©ï¼‰ã€‚</p><h3 id="é»˜è®¤çš„-unity-ç€è‰²å™¨åŠ è½½è¡Œä¸º">é»˜è®¤çš„ Unity ç€è‰²å™¨åŠ è½½è¡Œä¸º</h3><p>åœ¨æ‰€æœ‰é»˜è®¤è®¾ç½®ä¸‹ï¼ŒUnity å°† shaderlabç€è‰²å™¨å¯¹è±¡åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä½†åœ¨å®é™…éœ€è¦ä¹‹å‰ä¸ä¼šåˆ›å»ºå†…éƒ¨ç€è‰²å™¨å˜ä½“ã€‚</p><p>è¿™æ„å‘³ç€ä»ç„¶å¯ä»¥ä½¿ç”¨åŒ…å«åœ¨æ¸¸æˆæ„å»ºä¸­çš„ç€è‰²å™¨å˜ä½“ï¼Œä½†æ˜¯åœ¨éœ€è¦å®ƒä»¬ä¹‹å‰ä¸ä¼šæœ‰å†…å­˜æˆ–åŠ è½½æ—¶é—´æˆæœ¬ã€‚ä¾‹å¦‚ï¼Œç€è‰²å™¨æ€»æ˜¯åŒ…å«ä¸€ä¸ªå˜ä½“ç”¨äºå¤„ç†å¸¦é˜´å½±çš„ç‚¹å…‰æºï¼Œä½†æ˜¯å¦‚æœä¸€ç›´æœªèƒ½åœ¨æ¸¸æˆä¸­ä½¿ç”¨å¸¦é˜´å½±çš„ç‚¹å…‰æºï¼Œé‚£ä¹ˆåŠ è½½è¿™ä¸ªç‰¹å®šçš„å˜ä½“æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</p><p>ç„¶è€Œï¼Œè¿™ç§é»˜è®¤è¡Œä¸ºæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå³ç¬¬ä¸€æ¬¡éœ€è¦æŸä¸ªç€è‰²å™¨å˜ä½“æ—¶å¯èƒ½ä¼šå‡ºç°æš‚æ—¶æ€§ä¸­æ–­é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºå¿…é¡»å°†æ–°çš„GPUç¨‹åºä»£ç åŠ è½½åˆ°å›¾å½¢é©±åŠ¨ç¨‹åºä¸­ã€‚åœ¨æ¸¸æˆè¿‡ç¨‹ä¸­é€šå¸¸ä¸å¸Œæœ›å‘ç”Ÿè¿™ç§é—®é¢˜ï¼Œå› æ­¤Unity æä¾›äº† ShaderVariantCollection èµ„æºæ¥å¸®åŠ©è§£å†³è¯¥é—®é¢˜ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/shader/8.gao-jie-shader-zhu-ti/"/>
      <url>/2022/08/10/unity/shader/8.gao-jie-shader-zhu-ti/</url>
      
        <content type="html"><![CDATA[<h1 id="é«˜é˜¶shader">é«˜é˜¶Shader</h1><h2 id="unityçš„æ¸²æŸ“ç®¡çº¿">Unityçš„æ¸²æŸ“ç®¡çº¿</h2><p>ç€è‰²å™¨å®šä¹‰äº†ä¸¤ç‚¹ï¼š<strong>1.å¯¹è±¡è‡ªèº«çš„å¤–è§‚ï¼ˆå…¶æè´¨å±æ€§ï¼‰</strong>ï¼›<strong>2.å¯¹è±¡å¯¹å…‰ç…§çš„ååº”</strong>ã€‚ç”±äºå…‰ç…§è®¡ç®—å¿…é¡»å†…ç½®åœ¨ç€è‰²å™¨ä¸­ï¼Œå¹¶ä¸”æœ‰å¾ˆå¤šå¯èƒ½çš„å…‰æºå’Œé˜´å½±ç±»å‹ï¼Œå› æ­¤ç¼–å†™â€œå¥½ç”¨â€çš„é«˜è´¨é‡ç€è‰²å™¨å°†æ˜¯ä¸€é¡¹å¤æ‚çš„ä»»åŠ¡ã€‚ä¸ºäº†ç®€åŒ–è¿™ä¸€ä»»åŠ¡ï¼ŒUnityæä¾›äº†è¡¨é¢ç€è‰²å™¨ï¼›åœ¨è¡¨é¢ç€è‰²å™¨ä¸­ï¼Œæ‰€æœ‰å…‰ç…§ã€é˜´å½±ã€å…‰ç…§è´´å›¾ã€å‰å‘æ¸²æŸ“å’Œå»¶è¿Ÿæ¸²æŸ“ä»»åŠ¡å‡è‡ªåŠ¨å®Œæˆã€‚</p><h2 id="æ¸²æŸ“è·¯å¾„">æ¸²æŸ“è·¯å¾„</h2><p>å¦‚ä½•åº”ç”¨å…‰ç…§ä»¥åŠä½¿ç”¨ç€è‰²å™¨çš„å“ªäº›é€šé“å–å†³äºä½¿ç”¨çš„<strong>æ¸²æŸ“è·¯å¾„</strong>ã€‚ç€è‰²å™¨ä¸­çš„æ¯ä¸ªé€šé“å‡é€šè¿‡<strong>é€šé“æ ‡ç­¾</strong>æ¥è¡¨è¾¾å…¶<strong>å…‰ç…§ç±»å‹</strong>ã€‚</p><ul><li><p>åœ¨å‰å‘æ¸²æŸ“ä¸­ï¼Œå°†ä½¿ç”¨ ForwardBase å’Œ ForwardAdd é€šé“ã€‚</p></li><li><p>åœ¨å»¶è¿Ÿç€è‰²ä¸­ï¼Œå°†ä½¿ç”¨ Deferred é€šé“ã€‚</p></li><li><p>åœ¨æ—§ç‰ˆå»¶è¿Ÿå…‰ç…§ä¸­ï¼Œå°†ä½¿ç”¨ PrepassBase å’Œ PrepassFinalé€šé“ã€‚</p></li><li><p>åœ¨æ—§ç‰ˆé¡¶ç‚¹å…‰ç…§ä¸­ï¼Œå°†ä½¿ç”¨ Vertexã€VertexLMRGBM å’Œ VertexLMé€šé“ã€‚</p></li><li><p>åœ¨ä¸Šè¿°ä»»ä½•æƒ…å†µä¸­ï¼Œè¦æ¸²æŸ“é˜´å½±æˆ–æ·±åº¦çº¹ç†ï¼Œéƒ½å°†ä½¿ç”¨ ShadowCasteré€šé“ã€‚</p></li><li><p>å‰é¡¹æ¸²æŸ“ ForwardBaseé€šé“å¯ä¸€æ¬¡æ€§æ¸²æŸ“ç¯å¢ƒå…‰ã€å…‰ç…§è´´å›¾ã€ä¸»æ–¹å‘å…‰å’Œä¸é‡è¦çš„ï¼ˆé¡¶ç‚¹/SHï¼‰å…‰æºã€‚ForwardAddé€šé“ç”¨äºä»»ä½•é™„åŠ çš„æ¯åƒç´ å…‰æºï¼›é’ˆå¯¹æ­¤ç±»å…‰æºç…§äº®çš„æ¯ä¸ªå¯¹è±¡è¿›è¡Œä¸€æ¬¡è°ƒç”¨ã€‚è¯·å‚é˜…å‰å‘æ¸²æŸ“ä»¥äº†è§£è¯¦ç»†ä¿¡æ¯ã€‚</p></li></ul><p>å¦‚æœä½¿ç”¨å‰å‘æ¸²æŸ“ï¼Œ<strong>ä½†ç€è‰²å™¨æ²¡æœ‰é€‚åˆå‰å‘æ¸²æŸ“çš„é€šé“ï¼ˆå³ï¼ŒForwardBaseå’Œ ForwardAddé€šé“ç±»å‹å‡ä¸å­˜åœ¨ï¼‰ï¼Œåˆ™ä¼šæŒ‰ç…§åœ¨é¡¶ç‚¹å…‰ç…§é€šé“ä¸­çš„æ–¹å¼æ¥æ¸²æŸ“è¯¥å¯¹è±¡</strong></p><ul><li>å»¶è¿Ÿç€è‰²è·¯å¾„ Deferredé€šé“å°†æ¸²æŸ“å…‰ç…§<strong>éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯</strong>ï¼ˆåœ¨å†…ç½®ç€è‰²å™¨ä¸­ï¼šæ¼«å°„é¢œè‰²ã€é•œé¢åå°„é¢œè‰²ã€å¹³æ»‘åº¦ã€ä¸–ç•Œç©ºé—´æ³•çº¿ã€å‘å…‰ï¼‰ã€‚å®ƒè¿˜åœ¨å‘å…‰é€šé“ä¸­å¢åŠ å…‰ç…§è´´å›¾ã€åå°„æ¢é’ˆå’Œç¯å¢ƒå…‰ç…§ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å»¶è¿Ÿç€è‰²ã€‚</li></ul><h2 id="ç€è‰²å™¨æ€§èƒ½">ç€è‰²å™¨æ€§èƒ½</h2><ul><li>ç€è‰²å™¨ä»£ç éœ€è¦æ‰§è¡Œçš„è®¡ç®—å’Œå¤„ç†è¶Šå¤šï¼Œå®ƒå¯¹æ¸¸æˆæ€§èƒ½çš„å½±å“å°±è¶Šå¤§ã€‚</li><li>è®¡ç®—çš„é¢‘ç‡ä¹Ÿä¼šå½±å“æ¸¸æˆçš„æ€§èƒ½ã€‚é€šå¸¸ï¼Œä¸é¡¶ç‚¹æ•°ï¼ˆé¡¶ç‚¹ç€è‰²å™¨æ‰§è¡Œæ¬¡æ•°ï¼‰ç›¸æ¯”ï¼Œæ¸²æŸ“çš„åƒç´ æ•°ä¼šæ›´å¤šï¼ˆå› æ­¤åƒç´ ç€è‰²å™¨æ‰§è¡Œæ¬¡æ•°ä¹Ÿæ›´å¤šï¼‰ï¼Œè€Œæ¸²æŸ“çš„é¡¶ç‚¹æ•°æ¯”æ¸²æŸ“çš„å¯¹è±¡æ›´å¤šã€‚åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œå¯å°†è®¡ç®—ä»åƒç´ ç€è‰²å™¨ä»£ç ç§»åŠ¨åˆ°é¡¶ç‚¹ç€è‰²å™¨ä»£ç ä¸­ï¼Œæˆ–è€…å°†å®ƒä»¬å®Œå…¨ç§»å‡ºç€è‰²å™¨å¹¶åœ¨è„šæœ¬ä¸­è®¾ç½®å€¼ã€‚</li></ul><h3 id="ä¼˜åŒ–çš„è¡¨é¢ç€è‰²å™¨">ä¼˜åŒ–çš„è¡¨é¢ç€è‰²å™¨</h3><p>è¡¨é¢ç€è‰²å™¨éå¸¸é€‚åˆç¼–å†™ä¸å…‰ç…§äº¤äº’çš„ç€è‰²å™¨ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬çš„é»˜è®¤é€‰é¡¹å·²è°ƒæ•´ä¸ºæ¶µç›–å¤§é‡çš„ä¸€èˆ¬æƒ…å†µã€‚å¯é’ˆå¯¹ç‰¹å®šæƒ…å†µè°ƒæ•´è¿™äº›é€‰é¡¹ä»¥ä½¿ç€è‰²å™¨è¿è¡Œé€Ÿåº¦æ›´å¿«ï¼Œæˆ–è‡³å°‘è®©ç€è‰²å™¨å˜å¾—æ›´å°å·§ï¼š</p><ul><li>ä½¿ç”¨è§†å›¾æ–¹å‘ï¼ˆå³é•œé¢åå°„ï¼‰çš„ç€è‰²å™¨çš„ <code>approxview</code>æŒ‡ä»¤ä½¿è§†å›¾æ–¹å‘æŒ‰ç…§é¡¶ç‚¹ï¼ˆè€Œä¸æ˜¯æŒ‰åƒç´ ï¼‰è¿›è¡Œæ ‡å‡†åŒ–ã€‚è¿™æ˜¯è¿‘ä¼¼å€¼ï¼Œä½†é€šå¸¸è¶³å¤Ÿå¥½ã€‚</li><li>é€‚ç”¨äºé•œé¢åå°„ç€è‰²å™¨ç±»å‹çš„ <code>halfasview</code>é€Ÿåº¦æ›´å¿«ã€‚åŠçŸ¢é‡ï¼ˆå…‰ç…§æ–¹å‘å’Œè§†å›¾çŸ¢é‡ä¹‹é—´ï¼‰æŒ‰ç…§é¡¶ç‚¹è¿›è¡Œè®¡ç®—å’Œæ ‡å‡†åŒ–ï¼Œå¹¶ä¸”å…‰ç…§å‡½æ•°æ¥å—åŠçŸ¢é‡ä½œä¸ºå‚æ•°ï¼Œè€Œä¸æ˜¯è§†å›¾çŸ¢é‡ã€‚</li><li><code>noforwardadd</code>ä½¿ç€è‰²å™¨ä»…å®Œå…¨æ”¯æŒå‰å‘æ¸²æŸ“ä¸­çš„å•æ–¹å‘å…‰ã€‚å…¶ä½™çš„å…‰æºä»ç„¶å¯æä¾›æ¯é¡¶ç‚¹å…‰æºæˆ–çƒè°å‡½æ•°å…‰æºçš„æ•ˆæœã€‚è¿™æ ·å¯ä»¥ä½¿ç€è‰²å™¨æ›´å°å¹¶ç¡®ä¿å®ƒå§‹ç»ˆåœ¨ä¸€ä¸ªé€šé“ä¸­æ¸²æŸ“ï¼Œå³ä½¿å­˜åœ¨å¤šä¸ªå…‰æºä¹Ÿæ˜¯å¦‚æ­¤ã€‚</li><li><code>noambient</code>åœ¨ç€è‰²å™¨ä¸­ç¦ç”¨ç¯å¢ƒå…‰ç…§å’Œçƒè°å‡½æ•°å…‰æºã€‚è¿™æ ·å¯ä»¥ç¨ç¨æé«˜æ€§èƒ½ã€‚</li></ul><h3 id="è®¡ç®—ç²¾åº¦">è®¡ç®—ç²¾åº¦</h3><p>ç”¨ Cg/HLSL ç¼–å†™ç€è‰²å™¨æ—¶ï¼Œæœ‰ä¸‰ç§åŸºæœ¬æ•°å­—ç±»å‹ï¼šfloatã€half å’Œfixedï¼ˆè¯·å‚é˜…æ•°æ®ç±»å‹å’Œç²¾åº¦ï¼‰ã€‚</p><p>ä¸ºè·å¾—è‰¯å¥½æ€§èƒ½ï¼Œè¯·å§‹ç»ˆä½¿ç”¨å°½å¯èƒ½ä½çš„ç²¾åº¦ã€‚è¿™åœ¨ç§»åŠ¨å¹³å°ï¼ˆå¦‚ iOS å’ŒAndroidï¼‰ä¸Šå°¤ä¸ºé‡è¦ã€‚é‡è¦çš„ç»éªŒæ³•åˆ™å¦‚ä¸‹ï¼š</p><ul><li>å¯¹äºä¸–ç•Œç©ºé—´ä½ç½®å’Œçº¹ç†åæ ‡ï¼Œè¯·ä½¿ç”¨ float ç²¾åº¦ã€‚</li><li>å¯¹äºæ‰€æœ‰å…¶ä»–æƒ…å†µï¼ˆçŸ¢é‡ã€HDR é¢œè‰²ç­‰ï¼‰ï¼Œè¯·é¦–å…ˆå°è¯• halfç²¾åº¦ã€‚ä»…åœ¨å¿…è¦çš„æƒ…å†µä¸‹å†æé«˜ç²¾åº¦ã€‚</li><li>è¦å¯¹çº¹ç†æ•°æ®è¿›è¡Œéå¸¸ç®€å•çš„è¿ç®—ï¼Œè¯·ä½¿ç”¨ fixed ç²¾åº¦ã€‚</li></ul><p>å®é™…ä¸Šï¼Œå…·ä½“åº”è¯¥ä½¿ç”¨å“ªç§æ•°å­—ç±»å‹å–å†³äºå¹³å°å’Œ GPUã€‚</p><h3 id="alpha-æµ‹è¯•">Alpha æµ‹è¯•</h3><p>å›ºå®šå‡½æ•° AlphaTestï¼ˆæˆ–è€…å…¶å¯ç¼–ç¨‹çš„ç­‰æ•ˆå‡½æ•°clip()ï¼‰åœ¨ä¸åŒå¹³å°ä¸Šå…·æœ‰ä¸åŒçš„æ€§èƒ½ç‰¹å¾ï¼š</p><ul><li>é€šå¸¸ï¼Œåœ¨ä½¿ç”¨è¯¥å‡½æ•°æ¥ç§»é™¤å¤§å¤šæ•°å¹³å°ä¸Šçš„å®Œå…¨é€æ˜åƒç´ æ—¶ï¼Œå¯è·å¾—å°‘é‡ä¼˜åŠ¿ã€‚</li><li>ä½†æ˜¯ï¼Œåœ¨ iOS å’ŒæŸäº› Android è®¾å¤‡çš„ PowerVR GPU ä¸Šï¼ŒAlphaæµ‹è¯•æ˜¯èµ„æºå¯†é›†å‹ä»»åŠ¡ã€‚ä¸è¦è¯•å›¾åœ¨è¿™äº›å¹³å°ä¸Šä½¿ç”¨è¿™ç§æµ‹è¯•è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´æ¸¸æˆè¿è¡Œé€Ÿåº¦æ¯”å¹³å¸¸æ…¢ã€‚</li></ul><h3 id="é¢œè‰²é®ç½©-color-mask">é¢œè‰²é®ç½© (Color Mask)</h3><p>åœ¨æŸäº›å¹³å°ï¼ˆä¸»è¦æ˜¯ iOS å’Œ Android è®¾å¤‡çš„ç§»åŠ¨ç«¯ GPUï¼‰ä¸Šï¼Œä½¿ç”¨ColorMask çœç•¥ä¸€äº›é€šé“ï¼ˆä¾‹å¦‚ ColorMaskRGBï¼‰<strong>å¯èƒ½æ˜¯èµ„æºå¯†é›†å‹çš„æ“ä½œï¼Œæ‰€ä»¥é™¤éç»å¯¹éœ€è¦ï¼Œå¦åˆ™è¯·ä¸è¦ä½¿ç”¨</strong>ã€‚</p><h3 id="ä½¿ç”¨æ›¿æ¢çš„ç€è‰²å™¨è¿›è¡Œæ¸²æŸ“">ä½¿ç”¨æ›¿æ¢çš„ç€è‰²å™¨è¿›è¡Œæ¸²æŸ“</h3><p>æœ‰äº›æ¸²æŸ“æ•ˆæœéœ€è¦ä½¿ç”¨ä¸€ç»„ä¸åŒçš„ç€è‰²å™¨æ¥æ¸²æŸ“åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œè‰¯å¥½çš„è¾¹ç¼˜æ£€æµ‹è¦æ±‚çº¹ç†å…·æœ‰åœºæ™¯æ³•çº¿ï¼Œè¿™æ ·æ‰èƒ½æ£€æµ‹å‡ºè¡¨é¢æ–¹å‘ä¸åŒçš„è¾¹ç¼˜ã€‚å…¶ä»–æ•ˆæœå¯èƒ½è¦æ±‚çº¹ç†å…·æœ‰åœºæ™¯æ·±åº¦ï¼Œè¯¸å¦‚æ­¤ç±»ã€‚ä¸ºæ­¤ï¼Œå¯ä½¿ç”¨æ‰€æœ‰å¯¹è±¡çš„æ›¿æ¢ç€è‰²å™¨æ¥æ¸²æŸ“åœºæ™¯ã€‚</p><p>åº”é€šè¿‡è„šæœ¬ä½¿ç”¨å‡½æ•° Camera.RenderWithShader æˆ–Camera.SetReplacementShader æ¥å®ç°ç€è‰²å™¨æ›¿æ¢ã€‚è¿™ä¸¤ä¸ªå‡½æ•°å‡é‡‡ç”¨ shader å’ŒreplacementTagã€‚</p><p>å·¥ä½œæ–¹å¼å¦‚ä¸‹ï¼šæ‘„åƒæœºæŒ‰æ­£å¸¸æ–¹å¼æ¸²æŸ“åœºæ™¯ï¼Œå¯¹è±¡ä»ä½¿ç”¨è‡ªå·±çš„æè´¨ï¼Œä½†è¦æ›´æ”¹æœ€ç»ˆä½¿ç”¨çš„å®é™…ç€è‰²å™¨ï¼š</p><ul><li>å¦‚æœ replacementTagä¸ºç©ºï¼Œåˆ™ä½¿ç”¨æŒ‡å®šçš„æ›¿æ¢ç€è‰²å™¨æ¥æ¸²æŸ“åœºæ™¯ä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‚</li><li>å¦‚æœ replacementTag ä¸ä¸ºç©ºï¼Œåˆ™å¯¹äºå°†è¦æ¸²æŸ“çš„æ¯ä¸ªå¯¹è±¡ï¼š<ul><li>æŸ¥è¯¢çœŸå®å¯¹è±¡çš„ç€è‰²å™¨ä»¥è·å–æ ‡ç­¾å€¼ã€‚</li><li>å¦‚æœæ²¡æœ‰è¯¥æ ‡ç­¾ï¼Œåˆ™ä¸æ¸²æŸ“å¯¹è±¡ã€‚</li><li>åœ¨æ›¿æ¢ç€è‰²å™¨ä¸­æ‰¾åˆ°ä¸€ä¸ªå­ç€è‰²å™¨ï¼Œå¹¶ä¸”è¯¥å­ç€è‰²å™¨çš„ä¸€ä¸ªç»™å®šæ ‡ç­¾å…·æœ‰æ‰¾åˆ°çš„å€¼ã€‚å¦‚æœæ‰¾ä¸åˆ°æ­¤ç±»å­ç€è‰²å™¨ï¼Œåˆ™ä¸æ¸²æŸ“å¯¹è±¡ã€‚</li><li>ç°åœ¨ï¼Œä½¿ç”¨è¯¥å­ç€è‰²å™¨æ¥æ¸²æŸ“å¯¹è±¡ã€‚</li></ul></li></ul><p>å› æ­¤ï¼Œæ¯”å¦‚è¯´ï¼Œå¦‚æœæ‰€æœ‰ç€è‰²å™¨éƒ½è¦æœ‰ä¸€ä¸ªå€¼ä¸ºâ€œOpaqueâ€ã€â€œTransparentâ€ã€â€œBackgroundâ€æˆ–â€œOverlayâ€çš„â€œRenderTypeâ€æ ‡ç­¾ï¼Œåˆ™å¯ç¼–å†™ä¸€ä¸ªæ›¿æ¢ç€è‰²å™¨ï¼Œè¯¥ç€è‰²å™¨åªä½¿ç”¨ä¸€ä¸ªå…·æœ‰RenderType = Solidæ ‡ç­¾çš„å­ç€è‰²å™¨æ¥æ¸²æŸ“å®ä½“å¯¹è±¡ã€‚åœ¨æ›¿æ¢ç€è‰²å™¨ä¸­æ‰¾ä¸åˆ°å…¶ä»–æ ‡ç­¾ç±»å‹ï¼Œå› æ­¤ä¸ä¼šæ¸²æŸ“å¯¹è±¡ã€‚æˆ–è€…æ‚¨ä¹Ÿå¯ä»¥ä¸ºä¸åŒâ€œRenderTypeâ€æ ‡ç­¾å€¼ç¼–å†™è‹¥å¹²å­ç€è‰²å™¨ã€‚é¡ºä¾¿æä¸€ä¸‹ï¼ŒUnityçš„æ‰€æœ‰å†…ç½®ç€è‰²å™¨éƒ½è®¾ç½®äº†ä¸€ä¸ªâ€œRenderTypeâ€æ ‡ç­¾ã€‚</p><h3 id="å…‰ç…§ç€è‰²å™¨æ›¿æ¢">å…‰ç…§ç€è‰²å™¨æ›¿æ¢</h3><p>ä½¿ç”¨ç€è‰²å™¨æ›¿æ¢æ—¶ï¼Œå°†ä½¿ç”¨æ‘„åƒæœºä¸Šé…ç½®çš„æ¸²æŸ“è·¯å¾„æ¥æ¸²æŸ“åœºæ™¯ã€‚è¿™æ„å‘³ç€ç”¨äºæ›¿æ¢çš„ç€è‰²å™¨å¯ä»¥åŒ…å«é˜´å½±å’Œå…‰ç…§é€šé“ï¼ˆæ‚¨å¯ä»¥ä½¿ç”¨è¡¨é¢ç€è‰²å™¨è¿›è¡Œç€è‰²å™¨æ›¿æ¢ï¼‰ã€‚è¿™å¯¹äºæ¸²æŸ“ç‰¹æ®Šæ•ˆæœå’Œåœºæ™¯è°ƒè¯•å¾ˆæœ‰ç”¨ã€‚</p><h3 id="unity-å†…ç½®ç€è‰²å™¨ä¸­çš„ç€è‰²å™¨æ›¿æ¢æ ‡ç­¾">Unityå†…ç½®ç€è‰²å™¨ä¸­çš„ç€è‰²å™¨æ›¿æ¢æ ‡ç­¾</h3><p>Unityçš„æ‰€æœ‰å†…ç½®ç€è‰²å™¨éƒ½è®¾ç½®äº†ä¸€ä¸ªâ€œRenderTypeâ€æ ‡ç­¾ï¼Œå¯ä»¥åœ¨ä½¿ç”¨æ›¿æ¢ç€è‰²å™¨è¿›è¡Œæ¸²æŸ“æ—¶ä½¿ç”¨æ­¤æ ‡ç­¾ã€‚æ ‡ç­¾å€¼å¦‚ä¸‹ï¼š</p><ul><li>Opaqueï¼šå¤§éƒ¨åˆ†ç€è‰²å™¨ï¼ˆæ³•çº¿ã€è‡ªå‘å…‰ã€åå°„å’Œåœ°å½¢ç€è‰²å™¨ï¼‰ã€‚</li><li>Transparentï¼šå¤§éƒ¨åˆ†åŠé€æ˜ç€è‰²å™¨ï¼ˆé€æ˜ã€ç²’å­ã€å­—ä½“å’Œåœ°å½¢é™„åŠ é€šé“ç€è‰²å™¨ï¼‰ã€‚</li><li>TransparentCutoutï¼šé®ç½©é€æ˜åº¦ç€è‰²å™¨ï¼ˆé€æ˜é•‚ç©ºã€ä¸¤ä¸ªé€šé“æ¤è¢«ç€è‰²å™¨ï¼‰ã€‚</li><li>Backgroundï¼šå¤©ç©ºç›’ç€è‰²å™¨ã€‚</li><li>Overlayï¼šGUI çº¹ç†ã€å…‰ç¯ã€å…‰æ™•ç€è‰²å™¨ã€‚</li><li>TreeOpaqueï¼šåœ°å½¢å¼•æ“æ ‘çš®ã€‚</li><li>TreeTransparentCutoutï¼šåœ°å½¢å¼•æ“æ ‘å¶ã€‚</li><li>TreeBillboardï¼šåœ°å½¢å¼•æ“å…¬å‘Šç‰Œæ ‘ã€‚</li><li>Grassï¼šåœ°å½¢å¼•æ“è‰ã€‚</li><li>GrassBillboardï¼šåœ°å½¢å¼•æ“å…¬å‘Šç‰Œè‰ã€‚</li></ul><h3 id="å†…ç½®åœºæ™¯æ·±åº¦æ³•çº¿çº¹ç†">å†…ç½®åœºæ™¯æ·±åº¦/æ³•çº¿çº¹ç†</h3><p>æ‘„åƒæœºå†…ç½®äº†æ¸²æŸ“æ·±åº¦æˆ–æ·±åº¦+æ³•çº¿çº¹ç†çš„åŠŸèƒ½ï¼ˆå¯èƒ½åœ¨æŸäº›æ•ˆæœä¸­éœ€è¦è¯¥åŠŸèƒ½ï¼‰ã€‚è¯·å‚é˜…æ‘„åƒæœºæ·±åº¦çº¹ç†é¡µé¢ã€‚è¯·æ³¨æ„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼ˆå–å†³äºç¡¬ä»¶ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ç€è‰²å™¨æ›¿æ¢æ–¹æ³•åœ¨å†…éƒ¨æ¸²æŸ“æ·±åº¦å’Œæ·±åº¦+æ³•çº¿çº¹ç†ã€‚å› æ­¤ï¼ŒåŠ¡å¿…åœ¨ç€è‰²å™¨ä¸­è®¾ç½®æ­£ç¡®çš„â€œRenderTypeâ€æ ‡ç­¾ã€‚</p><h3 id="è‡ªå®šä¹‰ç€è‰²å™¨-gui">è‡ªå®šä¹‰ç€è‰²å™¨ GUI</h3><h3 id="ä½¿ç”¨æ·±åº¦çº¹ç†">ä½¿ç”¨æ·±åº¦çº¹ç†</h3><p>æ·±åº¦çº¹ç†ä¸­çš„åƒç´ å€¼ä»‹äº 0 å’Œ 1 ä¹‹é—´ï¼Œå…·æœ‰éçº¿æ€§åˆ†å¸ƒã€‚ç²¾åº¦é€šå¸¸ä¸º 32 æˆ–16 ä½ï¼Œå…·ä½“å–å†³äºæ‰€ä½¿ç”¨çš„é…ç½®å’Œå¹³å°ã€‚ä»æ·±åº¦çº¹ç†è¯»å–æ—¶ï¼Œå°†è¿”å› 0 åˆ°1èŒƒå›´å†…çš„é«˜ç²¾åº¦å€¼ã€‚å¦‚æœæ‚¨éœ€è¦è·å–ä¸æ‘„åƒæœºä¹‹é—´çš„è·ç¦»æˆ–å…¶ä»– 0 åˆ° 1ä¹‹é—´çš„çº¿æ€§å€¼ï¼Œ</p><pre><code>Shader "Render Depth" {    SubShader {        Tags { "RenderType"="Opaque" }        Pass {            CGPROGRAM            #pragma vertex vert            #pragma fragment frag            #include "UnityCG.cginc"            struct v2f {                float4 pos : SV_POSITION;                float2 depth : TEXCOORD0;            };            v2f vert (appdata_base v) {                v2f o;                o.pos = UnityObjectToClipPos(v.vertex);                UNITY_TRANSFER_DEPTH(o.depth);                return o;            }            half4 frag(v2f i) : SV_Target {                UNITY_OUTPUT_DEPTH(i.depth);            }            ENDCG        }    }}</code></pre><h3 id="æ‘„åƒæœºçš„æ·±åº¦çº¹ç†">æ‘„åƒæœºçš„æ·±åº¦çº¹ç†</h3><p><strong>TODO</strong></p><h3 id="å¹³å°ç‰¹å®šçš„æ¸²æŸ“å·®å¼‚">å¹³å°ç‰¹å®šçš„æ¸²æŸ“å·®å¼‚</h3><h4 id="æ¸²æŸ“çº¹ç†åæ ‡">æ¸²æŸ“çº¹ç†åæ ‡</h4><ul><li>Direct3D ç±»ï¼šé¡¶éƒ¨åæ ‡ä¸º 0 å¹¶å‘ä¸‹å¢åŠ ã€‚æ­¤ç±»å‹é€‚ç”¨äº Direct3Dã€Metalå’Œæ¸¸æˆä¸»æœºã€‚</li><li>OpenGL ç±»ï¼šåº•éƒ¨åæ ‡ä¸º 0 å¹¶å‘ä¸Šå¢åŠ ã€‚æ­¤ç±»é€‚ç”¨äº OpenGL å’Œ OpenGLESã€‚</li></ul><h4 id="å›¾åƒæ•ˆæœ">å›¾åƒæ•ˆæœ</h4><pre><code>// ç¿»è½¬çº¹ç†çš„é‡‡æ ·ï¼š// ä¸»çº¹ç†çš„// çº¹ç†åƒç´ å¤§å°å°†å…·æœ‰è´Ÿ Yã€‚# if UNITY_UV_STARTS_AT_TOPif (_MainTex_TexelSize.y &lt; 0)        uv.y = 1-uv.y;# endif</code></pre><h4 id="åœ¨-uv-ç©ºé—´ä¸­æ¸²æŸ“">åœ¨ UV ç©ºé—´ä¸­æ¸²æŸ“</h4><p>åœ¨çº¹ç†åæ ‡ (UV)ç©ºé—´ä¸­æ¸²æŸ“ç‰¹æ®Šæ•ˆæœæˆ–å·¥å…·æ—¶ï¼Œæ‚¨å¯èƒ½éœ€è¦è°ƒæ•´ç€è‰²å™¨ï¼Œä»¥ä¾¿åœ¨ Direct3D ç±»å’ŒOpenGLç±»ç³»ç»Ÿä¹‹é—´è¿›è¡Œä¸€è‡´æ¸²æŸ“ã€‚æ‚¨è¿˜å¯èƒ½éœ€è¦åœ¨æ¸²æŸ“åˆ°å±å¹•å’Œæ¸²æŸ“åˆ°çº¹ç†ä¹‹é—´è¿›è¡Œæ¸²æŸ“è°ƒæ•´ã€‚ä¸ºè¿›è¡Œæ­¤ç±»è°ƒæ•´ï¼Œåº”ä¸Šä¸‹ç¿»è½¬Direct3D ç±»æŠ•å½±ï¼Œä½¿å…¶åæ ‡ä¸ OpenGL ç±»æŠ•å½±åæ ‡ç›¸åŒ¹é…ã€‚</p><p>å†…ç½®å˜é‡ ProjectionParams.x åŒ…å«å€¼ +1 æˆ– â€“1ã€‚-1è¡¨ç¤ºæŠ•å½±å·²ä¸Šä¸‹ç¿»è½¬ä»¥åŒ¹é… OpenGL ç±»æŠ•å½±åæ ‡ï¼Œè€Œ +1 è¡¨ç¤ºå°šæœªç¿»è½¬ã€‚æ‚¨å¯ä»¥åœ¨ç€è‰²å™¨ä¸­æ£€æŸ¥æ­¤å€¼ï¼Œç„¶åæ‰§è¡Œä¸åŒçš„æ“ä½œã€‚ä¸‹é¢çš„ç¤ºä¾‹å°†æ£€æŸ¥æ˜¯å¦å·²ç¿»è½¬æŠ•å½±ï¼Œå¦‚æœå·²ç¿»è½¬ï¼Œåˆ™å†æ¬¡è¿›è¡Œç¿»è½¬ï¼Œç„¶åè¿”å›UV åæ ‡ä»¥ä¾¿åŒ¹é…ã€‚</p><pre><code>float4 vert(float2 uv : TEXCOORD0) : SV_POSITION{    float4 pos;    pos.xy = uv;    // æ­¤ç¤ºä¾‹ä½¿ç”¨ä¸Šä¸‹ç¿»è½¬çš„æŠ•å½±è¿›è¡Œæ¸²æŸ“ï¼Œ    // å› æ­¤ä¹Ÿç¿»è½¬å‚ç›´ UV åæ ‡    if (_ProjectionParams.x &lt; 0)        pos.y = 1 - pos.y;    pos.z = 0;    pos.w = 1;    return pos;}</code></pre><h4 id="è£å‰ªç©ºé—´åæ ‡">è£å‰ªç©ºé—´åæ ‡</h4><p>ä¸çº¹ç†åæ ‡ç±»ä¼¼ï¼Œè£å‰ªç©ºé—´åæ ‡ï¼ˆä¹Ÿç§°ä¸ºæŠ•å½±åç©ºé—´åæ ‡ï¼‰åœ¨ Direct3D ç±»å’ŒOpenGL ç±»å¹³å°ä¹‹é—´æœ‰æ‰€ä¸åŒï¼š</p><ul><li><p>Direct3D ç±»ï¼šè£å‰ªç©ºé—´æ·±åº¦ä»è¿‘å¹³é¢çš„ 0.0 åˆ°è¿œå¹³é¢çš„+1.0ã€‚æ­¤ç±»å‹é€‚ç”¨äº Direct3Dã€Metal å’Œæ¸¸æˆä¸»æœºã€‚</p></li><li><p>OpenGL ç±»ï¼šè£å‰ªç©ºé—´æ·±åº¦ä»è¿‘å¹³é¢çš„ â€“1.0 åˆ°è¿œå¹³é¢çš„+1.0ã€‚æ­¤ç±»é€‚ç”¨äº OpenGL å’Œ OpenGL ESã€‚</p></li></ul><p>åœ¨ç€è‰²å™¨ä»£ç å†…ï¼Œå¯ä½¿ç”¨å†…ç½®å® UNITY_NEAR_CLIP_VALUEæ¥è·å–åŸºäºå¹³å°çš„è¿‘å¹³é¢å€¼ã€‚</p><h4 id="ç€è‰²å™¨è®¡ç®—çš„ç²¾åº¦">ç€è‰²å™¨è®¡ç®—çš„ç²¾åº¦</h4><p>è¦é¿å…ç²¾åº¦é—®é¢˜ï¼Œ<strong>è¯·ç¡®ä¿åœ¨ç›®æ ‡å¹³å°ä¸Šæµ‹è¯•ç€è‰²å™¨</strong>ã€‚ç§»åŠ¨è®¾å¤‡å’ŒPC ä¸­çš„ GPU åœ¨å¤„ç†æµ®ç‚¹ç±»å‹æ–¹é¢æœ‰æ‰€ä¸åŒã€‚</p><h4 id="ç€è‰²å™¨ä¸­çš„-const-å£°æ˜">ç€è‰²å™¨ä¸­çš„ const å£°æ˜</h4><p>const çš„ä½¿ç”¨åœ¨ Microsoft HSLï¼ˆè¯·å‚é˜… msdn.microsoft.comï¼‰å’Œ OpenGL çš„GLSLï¼ˆè¯·å‚é˜… Wikipediaï¼‰ç€è‰²å™¨è¯­è¨€ä¹‹é—´æœ‰æ‰€ä¸åŒã€‚</p><ul><li><p>Microsoft çš„ HLSL const ä¸ C# å’Œ C++ä¸­çš„å«ä¹‰å¤§è‡´ç›¸åŒï¼šå£°æ˜çš„å˜é‡åœ¨å…¶ä½œç”¨åŸŸå†…æ˜¯åªè¯»çš„ï¼Œä½†å¯æŒ‰ä»»ä½•æ–¹å¼åˆå§‹åŒ–ã€‚</p></li><li><p>OpenGL çš„ GLSL constè¡¨ç¤ºå˜é‡å®é™…ä¸Šæ˜¯<strong>ç¼–è¯‘æ—¶å¸¸é‡</strong>ï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨ç¼–è¯‘æ—¶çº¦æŸï¼ˆæ–‡å­—å€¼æˆ–å…¶ä»–å¯¹äºconst çš„è®¡ç®—ï¼‰è¿›è¡Œåˆå§‹åŒ–ã€‚</p></li></ul><p>æœ€å¥½æ˜¯éµå¾ª OpenGL çš„ GLSLè¯­ä¹‰ï¼Œå¹¶ä¸”åªæœ‰å½“å˜é‡çœŸæ­£ä¸å˜æ—¶æ‰å°†å˜é‡å£°æ˜ä¸ºconstã€‚é¿å…ä½¿ç”¨å…¶ä»–ä¸€äº›å¯å˜å€¼åˆå§‹åŒ– constå˜é‡ï¼ˆä¾‹å¦‚ï¼Œä½œä¸ºå‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡ï¼‰ã€‚è¿™ä¸€åŸåˆ™ä¹Ÿé€‚ç”¨äº Microsoft çš„HLSLï¼Œå› æ­¤ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨ const å¯ä»¥é¿å…åœ¨æŸäº›å¹³å°ä¸Šæ··æ·†é”™è¯¯</p><h3 id="æå–æ·±åº¦ç¼“å†²åŒº">æå–æ·±åº¦ç¼“å†²åŒº</h3><p>å¦‚æœè¦æ‰‹åŠ¨æå–æ·±åº¦ (Z)ç¼“å†²åŒºå€¼ï¼Œåˆ™å¯èƒ½éœ€è¦æ£€æŸ¥ç¼“å†²åŒºæ–¹å‘ã€‚ä»¥ä¸‹æ˜¯æ‰§è¡Œæ­¤æ“ä½œçš„ç¤ºä¾‹ï¼š</p><pre><code>float z = tex2D(_CameraDepthTexture, uv);# if defined(UNITY_REVERSED_Z)    z = 1.0f - z;# endif</code></pre><h3 id="ä½¿ç”¨è£å‰ªç©ºé—´">ä½¿ç”¨è£å‰ªç©ºé—´</h3><p>å¦‚æœè¦æ‰‹åŠ¨ä½¿ç”¨è£å‰ªç©ºé—´ (Z)æ·±åº¦ï¼Œåˆ™å¯èƒ½è¿˜éœ€è¦ä½¿ç”¨ä»¥ä¸‹å®æ¥æŠ½è±¡åŒ–å¹³å°å·®å¼‚ï¼š</p><pre><code>float clipSpaceRange01 = UNITY_Z_0_FAR_FROM_CLIPSPACE(rawClipSpace);</code></pre><p>æ³¨æ„ï¼šæ­¤å®ä¸ä¼šæ”¹å˜ OpenGL æˆ– OpenGL ESå¹³å°ä¸Šçš„è£å‰ªç©ºé—´ï¼Œå› æ­¤åœ¨è¿™äº›å¹³å°ä¸Šï¼Œæ­¤å®è¿”å›â€œ-nearâ€1ï¼ˆè¿‘å¹³é¢ï¼‰åˆ°farï¼ˆè¿œå¹³é¢ï¼‰ä¹‹é—´çš„å€¼ã€‚</p><h3 id="æŠ•å½±çŸ©é˜µ">æŠ•å½±çŸ©é˜µ</h3><p>å¦‚æœå¤„äºæ·±åº¦ (Z) å‘ç”Ÿåè½¬çš„å¹³å°ä¸Šï¼Œåˆ™ GL.GetGPUProjectionMatrix()è¿”å›ä¸€ä¸ªè¿˜åŸäº† z çš„çŸ©é˜µã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦æ‰‹åŠ¨ä»æŠ•å½±çŸ©é˜µä¸­è¿›è¡Œåˆæˆï¼ˆä¾‹å¦‚ï¼Œå¯¹äºè‡ªå®šä¹‰é˜´å½±æˆ–æ·±åº¦æ¸²æŸ“ï¼‰ï¼Œæ‚¨éœ€è¦é€šè¿‡è„šæœ¬æŒ‰éœ€è‡ªè¡Œè¿˜åŸæ·±åº¦(Z) æ–¹å‘ã€‚</p><p>ä»¥ä¸‹æ˜¯æ‰§è¡Œæ­¤æ“ä½œçš„ç¤ºä¾‹ï¼š</p><pre><code>var shadowProjection = Matrix4x4.Ortho(...); //é˜´å½±æ‘„åƒæœºæŠ•å½±çŸ©é˜µvar shadowViewMat = ...     //é˜´å½±æ‘„åƒæœºè§†å›¾çŸ©é˜µvar shadowSpaceMatrix = ... //ä»è£å‰ªç©ºé—´åˆ°é˜´å½±è´´å›¾çº¹ç†ç©ºé—´    //å½“å¼•æ“é€šè¿‡æ‘„åƒæœºæŠ•å½±è®¡ç®—è®¾å¤‡æŠ•å½±çŸ©é˜µæ—¶ï¼Œ//"m_shadowCamera.projectionMatrix"è¢«éšå¼åè½¬m_shadowCamera.projectionMatrix = shadowProjection; //"shadowProjection"åœ¨è¿æ¥åˆ°"m_shadowMatrix"ä¹‹å‰è¢«æ‰‹åŠ¨ç¿»è½¬ï¼Œ//å› ä¸ºå®ƒè¢«è§†ä¸ºç€è‰²å™¨çš„å…¶ä»–çŸ©é˜µã€‚if(SystemInfo.usesReversedZBuffer) {    shadowProjection[2, 0] = -shadowProjection[2, 0];    shadowProjection[2, 1] = -shadowProjection[2, 1];    shadowProjection[2, 2] = -shadowProjection[2, 2];    shadowProjection[2, 3] = -shadowProjection[2, 3];}m_shadowMatrix = shadowSpaceMatrix * shadowProjection * shadowViewMat;</code></pre><h3 id="æ·±åº¦-z-åå·®">æ·±åº¦ (Z) åå·®</h3><p>Unity è‡ªåŠ¨å¤„ç†æ·±åº¦ (Z) åå·®ï¼Œä»¥ç¡®ä¿å…¶ä¸ Unity çš„æ·±åº¦ (Z)æ–¹å‘åŒ¹é…ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦ä½¿ç”¨æœ¬æœºä»£ç æ¸²æŸ“æ’ä»¶ï¼Œåˆ™éœ€è¦åœ¨ C æˆ– C++ä»£ç ä¸­æ¶ˆé™¤ï¼ˆåè½¬ï¼‰æ·±åº¦ (Z) åå·®ã€‚</p><h3 id="æ·±åº¦-z-æ–¹å‘æ£€æŸ¥å·¥å…·">æ·±åº¦ (Z) æ–¹å‘æ£€æŸ¥å·¥å…·</h3><ul><li>ä½¿ç”¨ SystemInfo.usesReversedZBuffer å¯ç¡®è®¤æ‰€åœ¨å¹³å°æ˜¯å¦ä½¿ç”¨åè½¬æ·±åº¦(Z)ã€‚</li></ul><h2 id="ç€è‰²å™¨ç»†èŠ‚çº§åˆ«">ç€è‰²å™¨ç»†èŠ‚çº§åˆ«</h2><p>ä»…å½“ä½¿ç”¨çš„ç€è‰²å™¨æˆ–å­ç€è‰²å™¨çš„ç»†èŠ‚çº§åˆ« (LOD) å€¼ä½äºæŒ‡å®šæ•°å­—æ—¶ï¼Œç€è‰²å™¨LOD æ‰æœ‰æ•ˆã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå…è®¸çš„ LODçº§åˆ«æ— é™å¤§ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ç”¨æˆ·ç¡¬ä»¶æ”¯æŒçš„æ‰€æœ‰ç€è‰²å™¨ã€‚ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå³ä½¿ç¡¬ä»¶å¯ä»¥æ”¯æŒæ›´é«˜çš„ç€è‰²å™¨ç»†èŠ‚çº§åˆ«ï¼Œæ‚¨ä¹Ÿå¯èƒ½å¸Œæœ›é™ä½ç»†èŠ‚çº§åˆ«ã€‚ä¾‹å¦‚ï¼Œä¸€äº›å»‰ä»·çš„æ˜¾å¡å¯èƒ½æ”¯æŒæ‰€æœ‰åŠŸèƒ½ï¼Œä½†ä½¿ç”¨èµ·æ¥ä¼šå¯¼è‡´å“åº”è¿‡æ…¢ã€‚å› æ­¤ï¼Œæ‚¨å¯èƒ½ä¸å¸Œæœ›åœ¨è¿™äº›æ˜¾å¡ä¸Šä½¿ç”¨è§†å·®æ³•çº¿è´´å›¾ã€‚</p><p>å¯ä¸ºå„ä¸ªç€è‰²å™¨åˆ†åˆ«è®¾ç½®ç€è‰²å™¨ LODï¼ˆä½¿ç”¨Shader.maximumLODï¼‰ï¼Œä¹Ÿå¯ä¸ºæ‰€æœ‰ç€è‰²å™¨è¿›è¡Œå…¨å±€è®¾ç½®ï¼ˆä½¿ç”¨Shader.globalMaximumLODï¼‰ã€‚</p><p>Unity ä¸­çš„å†…ç½®ç€è‰²å™¨æŒ‰ä»¥ä¸‹æ–¹å¼è®¾ç½® LODï¼š</p><ul><li>é¡¶ç‚¹å…‰ç…§ (VertexLit) ç±»å‹ç€è‰²å™¨ = 100</li><li>è´´èŠ±ã€åå…‰é¡¶ç‚¹å…‰ç…§ = 150</li><li>æ¼«å°„ = 200</li><li>æ¼«å°„ç»†èŠ‚ã€åå…‰å‡¹å‡¸æ— å…‰ç…§ã€åå…‰å‡¹å‡¸é¡¶ç‚¹å…‰ç…§ = 250</li><li>å‡¹å‡¸ã€é•œé¢åå°„ = 300</li><li>å‡¹å‡¸é•œé¢åå°„ = 400</li><li>è§†å·® = 500</li><li>è§†å·®é•œé¢åå°„ = 600</li></ul><h2 id="çº¹ç†æ•°ç»„">çº¹ç†æ•°ç»„</h2><p>ç±»ä¼¼äºå¸¸è§„ 2D çº¹ç†ï¼ˆTexture2D ç±»ï¼Œç€è‰²å™¨ä¸­çš„sampler2D__ï¼‰ã€ç«‹æ–¹ä½“è´´å›¾ï¼ˆCubemap ç±»ï¼Œç€è‰²å™¨ä¸­çš„ samplerCUBE__ï¼‰å’Œ 3Dçº¹ç†ï¼ˆTexture3D ç±»ï¼Œç€è‰²å™¨ä¸­çš„ <strong>sampler3D</strong>ï¼‰ï¼ŒUnityä¹Ÿæ”¯æŒ 2D çº¹ç†æ•°ç»„ã€‚</p><p>çº¹ç†æ•°ç»„æ˜¯å…·æœ‰ç›¸åŒå¤§å°/æ ¼å¼/æ ‡è®°çš„ 2Dçº¹ç†çš„<strong>é›†åˆ</strong>ï¼Œè¿™äº›çº¹ç†å¯¹äº GPUè€Œè¨€åƒæ˜¯å•ä¸ªå¯¹è±¡ï¼Œå¹¶å¯åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨çº¹ç†å…ƒç´ ç´¢å¼•è¿›è¡Œé‡‡æ ·ã€‚å®ƒä»¬å¯ä»¥ç”¨äºå®ç°è‡ªå®šä¹‰åœ°å½¢æ¸²æŸ“ç³»ç»Ÿæˆ–å…¶ä»–ç‰¹æ®Šæ•ˆæœï¼Œè®©æ‚¨é«˜æ•ˆè®¿é—®å¤§é‡ç›¸åŒå¤§å°å’Œæ ¼å¼çš„çº¹ç†ã€‚2Dçº¹ç†æ•°ç»„çš„å…ƒç´ ä¹Ÿç§°ä¸º<strong>åˆ‡ç‰‡æˆ–å›¾å±‚</strong>ã€‚</p><h3 id="å¹³å°æ”¯æŒ">å¹³å°æ”¯æŒ</h3><p>çº¹ç†æ•°ç»„éœ€è¦å—åˆ°åº•å±‚å›¾å½¢ API å’Œ GPUçš„æ”¯æŒã€‚çº¹ç†æ•°ç»„åœ¨ä»¥ä¸‹å¹³å°ä¸Šå¯ç”¨ï¼š</p><ul><li>Direct3D 11/12ï¼ˆWindowsã€Xbox Oneï¼‰</li><li>OpenGL Coreï¼ˆMac OS Xã€Linuxï¼‰</li><li>Metalï¼ˆiOSã€Mac OS Xï¼‰</li><li>OpenGL ES 3.0ï¼ˆAndroidã€iOSã€WebGL 2.0ï¼‰</li><li>PlayStation 4</li></ul><p>å…¶ä»–å¹³å°ï¼ˆOpenGL ES 2.0 æˆ– WebGL 1.0ï¼‰ä¸æ”¯æŒçº¹ç†æ•°ç»„ã€‚å¯ä½¿ç”¨<code>SystemInfo.supports2DArrayTextures</code>åœ¨è¿è¡Œæ—¶ç¡®å®šçº¹ç†æ•°ç»„æ”¯æŒæƒ…å†µã€‚</p><h3 id="åˆ›å»ºå’Œå¡«å……çº¹ç†æ•°ç»„">åˆ›å»ºå’Œå¡«å……çº¹ç†æ•°ç»„</h3><p>ç”±äºçº¹ç†æ•°ç»„æ²¡æœ‰çº¹ç†å¯¼å…¥ç®¡çº¿ï¼Œå¿…é¡»åœ¨è„šæœ¬ä¸­åˆ›å»ºçº¹ç†æ•°ç»„ã€‚å¯ä½¿ç”¨Texture2DArrayç±»æ¥åˆ›å»ºå’Œå¡«å……çº¹ç†æ•°ç»„ã€‚è¯·æ³¨æ„ï¼Œçº¹ç†æ•°ç»„å¯åºåˆ—åŒ–ä¸ºèµ„æºï¼Œå› æ­¤å¯ä»¥å€ŸåŠ©Editor è„šæœ¬ä¸­çš„æ•°æ®åˆ›å»ºå’Œå¡«å……çº¹ç†æ•°ç»„ã€‚</p><p>é€šå¸¸ï¼Œçº¹ç†æ•°ç»„å®Œå…¨æ˜¯åœ¨ GPU å†…å­˜ä¸­ä½¿ç”¨ï¼Œä½†æ‚¨å¯ä»¥ä½¿ç”¨Graphics.CopyTextureã€Texture2DArray.GetPixels å’ŒTexture2DArray.SetPixels ä¸ç³»ç»Ÿå†…å­˜ä¹‹é—´åŒå‘ä¼ è¾“åƒç´ ã€‚</p><h3 id="å°†çº¹ç†æ•°ç»„ç”¨ä½œæ¸²æŸ“ç›®æ ‡">å°†çº¹ç†æ•°ç»„ç”¨ä½œæ¸²æŸ“ç›®æ ‡</h3><p>çº¹ç†æ•°ç»„å…ƒç´ ä¹Ÿå¯ç”¨ä½œæ¸²æŸ“ç›®æ ‡ã€‚ä½¿ç”¨ RenderTexture.dimensionæå‰æŒ‡å®šæ¸²æŸ“ç›®æ ‡æ˜¯å¦æ˜¯ 2D çº¹ç†æ•°ç»„ã€‚Graphics.SetRenderTarget çš„depthSlice å‚æ•°å¯æŒ‡å®šè¦æ¸²æŸ“åˆ°çš„ Mipmapçº§åˆ«æˆ–ç«‹æ–¹ä½“è´´å›¾é¢ã€‚åœ¨æ”¯æŒâ€œåˆ†å±‚æ¸²æŸ“â€ï¼ˆä¾‹å¦‚ï¼Œå‡ ä½•ç€è‰²å™¨ï¼‰çš„å¹³å°ä¸Šï¼Œå¯å°†depthSlice å‚æ•°è®¾ç½®ä¸º â€“1ä»¥ä¾¿å°†æ•´ä¸ªçº¹ç†æ•°ç»„è®¾ç½®ä¸ºæ¸²æŸ“ç›®æ ‡ã€‚æ­¤å¤–è¿˜å¯ä½¿ç”¨å‡ ä½•ç€è‰²å™¨æ¥æ¸²æŸ“åˆ°ä¸ªåˆ«å…ƒç´ ä¸­ã€‚</p><h3 id="åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨çº¹ç†æ•°ç»„">åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨çº¹ç†æ•°ç»„</h3><p>ç”±äºçº¹ç†æ•°ç»„å¹¶éé€‚ç”¨äºæ‰€æœ‰å¹³å°ï¼Œå› æ­¤ç€è‰²å™¨éœ€è¦ä½¿ç”¨é€‚å½“çš„ç¼–è¯‘ç›®æ ‡æˆ–åŠŸèƒ½è¦æ±‚æ¥è®¿é—®çº¹ç†æ•°ç»„ã€‚æ”¯æŒçº¹ç†æ•°ç»„çš„æœ€ä½ç€è‰²å™¨æ¨¡å‹<strong>ç¼–è¯‘ç›®æ ‡ä¸º3.5ï¼ŒåŠŸèƒ½åç§°ä¸º 2darray</strong>ã€‚</p><p>ä½¿ç”¨ä»¥ä¸‹å®å¯å£°æ˜å’Œé‡‡æ ·çº¹ç†æ•°ç»„ï¼š</p><ul><li>UNITY_DECLARE_TEX2DARRAY(name) åœ¨ HLSLä»£ç ä¸­å£°æ˜çº¹ç†æ•°ç»„é‡‡æ ·å™¨å˜é‡ã€‚</li><li>UNITY_SAMPLE_TEX2DARRAY(name,uv) ä½¿ç”¨ float3 UV é‡‡æ ·çº¹ç†æ•°ç»„ï¼›åæ ‡çš„z åˆ†é‡æ˜¯æ•°ç»„å…ƒç´ ç´¢å¼•ã€‚</li><li>UNITY_SAMPLE_TEX2DARRAY_LOD(name,uv,lod) ä½¿ç”¨æ˜¾å¼ Mipmapçº§åˆ«é‡‡æ ·çº¹ç†æ•°ç»„ã€‚</li></ul><pre><code>Shader "Example/Sample2DArrayTexture"{    Properties    {        _MyArr ("Tex", 2DArray) = "" {}        _SliceRange ("Slices", Range(0,16)) = 6        _UVScale ("UVScale", Float) = 1.0    }    SubShader    {        Pass        {            CGPROGRAM            #pragma vertex vert            #pragma fragment frag            // çº¹ç†æ•°ç»„å¹¶éåœ¨ä»»ä½•åœ°æ–¹éƒ½å¯ç”¨ï¼Œ            // åªèƒ½åœ¨å®ƒä»¬æ‰€åœ¨çš„å¹³å°ä¸Šç¼–è¯‘ç€è‰²å™¨            #pragma require 2darray                        #include "UnityCG.cginc"            struct v2f            {                float3 uv : TEXCOORD0;                float4 vertex : SV_POSITION;            };            float _SliceRange;            float _UVScale;            v2f vert (float4 vertex : POSITION)            {                v2f o;                o.vertex = mul(UNITY_MATRIX_MVP, vertex);                o.uv.xy = (vertex.xy + 0.5) * _UVScale;                o.uv.z = (vertex.z + 0.5) * _SliceRange;                return o;            }                        UNITY_DECLARE_TEX2DARRAY(_MyArr);            half4 frag (v2f i) : SV_Target            {                return UNITY_SAMPLE_TEX2DARRAY(_MyArr, i.uv);            }            ENDCG        }    }}</code></pre><h2 id="ä½¿ç”¨-visual-studio-æ¥è°ƒè¯•-directx-1112-ç€è‰²å™¨">ä½¿ç”¨ VisualStudio æ¥è°ƒè¯• DirectX 11/12 ç€è‰²å™¨</h2><h2 id="ä½¿ç”¨-pix-æ¥è°ƒè¯•-directx-12-ç€è‰²å™¨">ä½¿ç”¨ PIX æ¥è°ƒè¯• DirectX 12ç€è‰²å™¨</h2><h2 id="åœ¨ç€è‰²å™¨ä¸­å®ç°å›ºå®šå‡½æ•°-texgen">åœ¨ç€è‰²å™¨ä¸­å®ç°å›ºå®šå‡½æ•°TexGen</h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/shader/7.shaderlab-yu-fa/"/>
      <url>/2022/08/10/unity/shader/7.shaderlab-yu-fa/</url>
      
        <content type="html"><![CDATA[<h1 id="shaderlab-è¯­æ³•">ShaderLab è¯­æ³•</h1><h2 id="è¯­æ³•">è¯­æ³•</h2><pre><code>Shader "name" { [Properties] Subshaders [Fallback] [CustomEditor] }</code></pre><h2 id="å±æ€§">å±æ€§</h2><h3 id="æ•°å­—">æ•°å­—</h3><p>Rangeã€ Floatã€Int</p><pre><code>name ("display name", Range (min, max)) = numbername ("display name", Float) = numbername ("display name", Int) = number</code></pre><p><code>Range å’Œ Float</code>é»˜è®¤å€¼ä»…ä»…æ˜¯å•ä¸ªæ•°å­—ï¼Œä¾‹å¦‚â€œ13.37â€ã€‚<strong><code>Int</code> é»˜è®¤å€¼ä»…ä»…æ˜¯å•ä¸ªæ•°å­—ï¼Œä¾‹å¦‚ "13.5"?</strong></p><h3 id="é¢œè‰²å’ŒçŸ¢é‡">é¢œè‰²å’ŒçŸ¢é‡</h3><p>Colorã€ Vector</p><pre><code>name ("display name", Color) = (number,number,number,number)name ("display name", Vector) = (number,number,number,number)</code></pre><p><code>Color å’Œ Vector</code>å±æ€§ï¼Œé»˜è®¤å€¼æ˜¯æ‹¬åœ¨<code>åœ†æ‹¬å·</code>ä¸­çš„<code>å››ä¸ªæ•°å­—</code>ï¼Œä¾‹å¦‚â€œ(1,0.5,0.2,1)â€ã€‚### çº¹ç†</p><pre><code>name ("display name", 2D) = "defaulttexture" {}name ("display name", Cube) = "defaulttexture" {}name ("display name", 3D) = "defaulttexture" {}</code></pre><p><code>2D çº¹ç†</code>ï¼Œé»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²æˆ–å†…ç½®é»˜è®¤çº¹ç†ä¹‹ä¸€ï¼šâ€œwhiteâ€ï¼ˆRGBAï¼š1,1,1,1ï¼‰ã€â€œblackâ€ï¼ˆRGBAï¼š0,0,0,0ï¼‰ã€â€œgrayâ€ï¼ˆRGBAï¼š0.5,0.5,0.5,0.5ï¼‰ã€â€œbumpâ€ï¼ˆRGBAï¼š0.5,0.5,1,0.5ï¼‰æˆ–â€œredâ€ï¼ˆRGBAï¼š1,0,0,0ï¼‰ã€‚</p><p>é 2D çº¹ç†ï¼ˆç«‹æ–¹ä½“ã€3D æˆ– 2Dæ•°ç»„ï¼‰ï¼Œé»˜è®¤å€¼ä¸ºç©ºå­—ç¬¦ä¸²ã€‚å¦‚æœæè´¨æœªæŒ‡å®šç«‹æ–¹ä½“è´´å›¾/3D/æ•°ç»„çº¹ç†ï¼Œåˆ™ä½¿ç”¨ç°è‰²ï¼ˆRGBAï¼š0.5,0.5,0.5,0.5ï¼‰ã€‚</p><h3 id="å±æ€§ç‰¹æ€§å’Œç»˜åˆ¶å™¨">å±æ€§ç‰¹æ€§å’Œç»˜åˆ¶å™¨</h3><p>åœ¨å±æ€§å‰é¢ï¼Œå¯æŒ‡å®šå¯é€‰çš„ç‰¹æ€§ï¼ˆç”¨æ–¹æ‹¬å·æ‹¬èµ·ï¼‰ã€‚è¿™äº›æ˜¯ Unityå¯ä»¥è¯†åˆ«çš„ç‰¹æ€§ï¼Œæˆ–è€…å®ƒä»¬å¯ä»¥æŒ‡ç¤ºæ‚¨è‡ªå·±çš„ MaterialPropertyDrawer ç±»æ¥æ§åˆ¶å®ƒä»¬åœ¨æè´¨æ£€è§†é¢æ¿ä¸­çš„å‘ˆç°æ–¹å¼ã€‚Unity å¯ä»¥è¯†åˆ«çš„ç‰¹æ€§åŒ…æ‹¬ï¼š</p><ul><li>[HideInInspector] - ä¸åœ¨æè´¨æ£€è§†é¢æ¿ä¸­æ˜¾ç¤ºå±æ€§å€¼ã€‚</li><li>[NoScaleOffset] -å¯¹äºå…·æœ‰æ­¤ç‰¹æ€§çš„çº¹ç†å±æ€§ï¼Œæè´¨æ£€è§†é¢æ¿ä¸ä¼šæ˜¾ç¤ºçº¹ç†å¹³é“º/åç§»å­—æ®µã€‚</li><li>[Normal] - è¡¨ç¤ºçº¹ç†å±æ€§éœ€è¦æ³•çº¿è´´å›¾ã€‚</li><li>[HDR] - è¡¨ç¤ºçº¹ç†å±æ€§éœ€è¦é«˜åŠ¨æ€èŒƒå›´ (HDR) çº¹ç†ã€‚</li><li>[Gamma] - è¡¨ç¤ºåœ¨ UI ä¸­å°†æµ®ç‚¹/çŸ¢é‡å±æ€§æŒ‡å®šä¸º sRGBå€¼ï¼ˆå°±åƒé¢œè‰²ä¸€æ ·ï¼‰ï¼Œå¹¶ä¸”å¯èƒ½éœ€è¦æ ¹æ®ä½¿ç”¨çš„é¢œè‰²ç©ºé—´è¿›è¡Œè½¬æ¢ã€‚è¯·å‚é˜…ç€è‰²å™¨ç¨‹åºä¸­çš„å±æ€§ã€‚</li><li>[PerRendererData] - è¡¨ç¤ºçº¹ç†å±æ€§å°†ä»¥ MaterialPropertyBlockçš„å½¢å¼æ¥è‡ªæ¯æ¸²æŸ“å™¨æ•°æ®ã€‚æè´¨æ£€è§†é¢æ¿ä¼šæ›´æ”¹è¿™äº›å±æ€§çš„çº¹ç†å­—æ®µ UIã€‚</li></ul><h2 id="subshader">SubShader</h2><p>å­ç€è‰²å™¨å®šä¹‰æ¸²æŸ“é€šé“çš„åˆ—è¡¨ï¼Œå¹¶ä¸”å¯é€‰æ‹©æ€§åœ°è®¾ç½®æ‰€æœ‰é€šé“å…±åŒçš„ä»»æ„çŠ¶æ€ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥è®¾ç½®å­ç€è‰²å™¨ä¸“ç”¨çš„æ ‡ç­¾ã€‚</p><p>å½“ Unity é€‰æ‹©è¦ç”¨äºæ¸²æŸ“çš„å­ç€è‰²å™¨æ—¶ï¼Œå®ƒä¼šä¸ºæ¯ä¸ªå®šä¹‰çš„é€šé“ (Pass)æ¸²æŸ“ä¸€æ¬¡å¯¹è±¡ï¼ˆå¹¶ä¸”æ•°é‡å¯èƒ½ç”±äºå…‰äº¤äº’è€Œå¢åŠ ï¼‰ã€‚ç”±äºå¯¹è±¡çš„æ¯æ¬¡æ¸²æŸ“æˆæœ¬éƒ½å¾ˆé«˜ï¼Œå› æ­¤åº”ä»¥å°½å¯èƒ½å°‘çš„é€šé“æ•°é‡å®šä¹‰ç€è‰²å™¨ã€‚å½“ç„¶ï¼Œæœ‰æ—¶åœ¨æŸäº›å›¾å½¢ç¡¬ä»¶ä¸Šï¼Œæ‰€éœ€çš„æ•ˆæœä¸èƒ½åœ¨å•ä¸ªé€šé“ä¸­å®Œæˆï¼›é‚£ä¹ˆæ‚¨åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½ä½¿ç”¨å¤šä¸ªé€šé“ã€‚</p><p>æ¯ä¸ªé€šé“å®šä¹‰å¯ä»¥æ˜¯å¸¸è§„ Passã€Use Pass æˆ– Grab Passã€‚</p><p>Pass å®šä¹‰ä¸­å…è®¸çš„ä»»ä½•è¯­å¥ä¹Ÿå¯èƒ½å‡ºç°åœ¨å­ Subshaderä»£ç å—ä¸­ã€‚è¿™å°†ä½¿æ‰€æœ‰é€šé“éƒ½ä½¿ç”¨è¿™ä¸€â€œå…±äº«â€çŠ¶æ€ã€‚</p><h3 id="pass">Pass</h3><p><strong>Pass ä»£ç å—å°†ä½¿æ¸¸æˆå¯¹è±¡çš„å‡ ä½•ä½“è¢«æ¸²æŸ“ä¸€æ¬¡ã€‚</strong></p><h4 id="è¯­æ³•-1">è¯­æ³•</h4><p>Pass { [Name and Tags] [RenderSetup] }</p><h4 id="åç§°å’Œæ ‡ç­¾">åç§°å’Œæ ‡ç­¾</h4><p>ä¸€ä¸ªé€šé“ (Pass) å¯ä»¥å®šä¹‰ä¸€ä¸ªåç§° (Name) å’Œä»»æ„æ•°é‡çš„æ ‡ç­¾(Tags)ã€‚è¿™äº›åç§°/å€¼å­—ç¬¦ä¸²ç”¨äºå°†é€šé“çš„æ„å›¾ä¼ è¾¾ç»™æ¸²æŸ“å¼•æ“ã€‚</p><h4 id="æ¸²æŸ“çŠ¶æ€è®¾ç½®">æ¸²æŸ“çŠ¶æ€è®¾ç½®</h4><p>ä¸€ä¸ªé€šé“å°†è®¾ç½®å›¾å½¢ç¡¬ä»¶çš„å„ç§çŠ¶æ€ï¼Œä¾‹å¦‚æ˜¯å¦åº”å¼€å¯ Alphaæ··åˆæˆ–æ˜¯å¦åº”ä½¿ç”¨æ·±åº¦æµ‹è¯•ã€‚</p><h4 id="å‰”é™¤å’Œæ·±åº¦æµ‹è¯•">å‰”é™¤å’Œæ·±åº¦æµ‹è¯•</h4><p><img src="imgs/PipelineCullDepth.png"></p><p>å‰”é™¤æ˜¯ä¸€ç§ä¼˜åŒ–æ–¹å¼ï¼Œå³ä¸æ¸²æŸ“èƒŒç¦»è§‚å¯Ÿè€…çš„å¤šè¾¹å½¢ã€‚æ‰€æœ‰å¤šè¾¹å½¢éƒ½æœ‰æ­£é¢å’ŒèƒŒé¢ã€‚å‰”é™¤åˆ©ç”¨å¤§å¤šæ•°å¯¹è±¡å‡ä¸ºå°é—­ä½“è¿™ä¸€äº‹å®ï¼›å¦‚æœæ‚¨æœ‰ä¸€ä¸ªç«‹æ–¹ä½“ï¼Œæ‚¨å°†æ°¸è¿œä¸ä¼šçœ‹åˆ°èƒŒç¦»æ‚¨çš„é¢ï¼ˆå‰æ–¹å§‹ç»ˆåªæœ‰ä¸€é¢æœå‘æ‚¨ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ç»˜åˆ¶èƒŒç¦»çš„é¢ã€‚å› æ­¤æœ‰äº†â€œèƒŒé¢å‰”é™¤â€ä¸€è¯ã€‚</p><p>è®©æ¸²æŸ“çœ‹èµ·æ¥æ­£ç¡®çš„å¦ä¸€ä¸ªåŠŸèƒ½æ˜¯â€œæ·±åº¦æµ‹è¯•â€ã€‚æ·±åº¦æµ‹è¯•ç¡®ä¿åœ¨åœºæ™¯ä¸­ä»…ç»˜åˆ¶è·ç¦»æœ€è¿‘çš„è¡¨é¢å¯¹è±¡ã€‚</p><ul><li>è®¾ç½®å¤šè¾¹å½¢å‰”é™¤æ¨¡å¼ã€‚ Cull</li></ul><pre><code>Cull Back | Front | Off</code></pre><p>æ§åˆ¶åº”è¯¥å‰”é™¤å¤šè¾¹å½¢çš„å“ªäº›é¢ï¼ˆä¸ç»˜åˆ¶ï¼‰</p><pre><code>*   Back ä¸æ¸²æŸ“èƒŒç¦»è§‚å¯Ÿè€…çš„å¤šè¾¹å½¢**ï¼ˆé»˜è®¤å€¼ï¼‰**ã€‚*   Front ä¸æ¸²æŸ“é¢å‘è§‚å¯Ÿè€…çš„å¤šè¾¹å½¢ã€‚ç”¨äºä»é‡Œåˆ°å¤–ç¿»è½¬å¯¹è±¡ã€‚*   Off ç¦ç”¨å‰”é™¤ - ç»˜åˆ¶æ‰€æœ‰é¢ã€‚**ç”¨äºç‰¹æ®Šæ•ˆæœ**ã€‚</code></pre><ul><li>è®¾ç½®æ·±åº¦ç¼“å†²åŒºå†™å…¥æ¨¡å¼ã€‚ ZWrite</li></ul><pre><code>ZWrite On | Off</code></pre><p>æ§åˆ¶æ˜¯å¦å°†æ­¤å¯¹è±¡çš„åƒç´ å†™å…¥æ·±åº¦ç¼“å†²åŒºï¼ˆé»˜è®¤å€¼ä¸º<em>On</em>ï¼‰ã€‚å¦‚æœè¦ç»˜åˆ¶å®ä½“å¯¹è±¡ï¼Œè¯·å°†å…¶ä¿ç•™ä¸ºonã€‚å¦‚æœè¦ç»˜åˆ¶åŠé€æ˜æ•ˆæœï¼Œè¯·åˆ‡æ¢åˆ° ZWrite Offã€‚</p><ul><li>è®¾ç½®æ·±åº¦ç¼“å†²åŒºæµ‹è¯•æ¨¡å¼ã€‚</li></ul><p>ZTest</p><pre><code>ZTest (Less | Greater | LEqual | GEqual | Equal | NotEqual | Always)</code></pre><p>åº”å¦‚ä½•æ‰§è¡Œæ·±åº¦æµ‹è¯•ã€‚é»˜è®¤å€¼ä¸º<code>LEqual</code>ï¼ˆå°†å‰æ–¹æˆ–è¿œå¤„çš„å¯¹è±¡ä½œä¸ºç°æœ‰å¯¹è±¡ç»˜åˆ¶ï¼›éšè—å…¶åé¢çš„å¯¹è±¡ï¼‰ã€‚</p><ul><li>è®¾ç½® Z ç¼“å†²åŒºæ·±åº¦åç§»ã€‚ Offset</li></ul><pre><code>Offset Factor, Units</code></pre><p>å…è®¸ä½¿ç”¨ä¸¤ä¸ªå‚æ•°æŒ‡å®šæ·±åº¦åç§»ï¼šfactor å’Œ unitsã€‚Factor ç›¸å¯¹äºå¤šè¾¹å½¢çš„X æˆ– Y ç¼©æ”¾æœ€å¤§ Z æ–œç‡ï¼Œè€Œ unitsç¼©æ”¾æœ€å°å¯åˆ†è¾¨æ·±åº¦ç¼“å†²åŒºå€¼ã€‚å› æ­¤å¯å¼ºåˆ¶å°†ä¸€ä¸ªå¤šè¾¹å½¢ç»˜åˆ¶åœ¨å¦ä¸€ä¸ªå¤šè¾¹å½¢ä¸Šï¼Œå°½ç®¡å®ƒä»¬å®é™…ä¸Šä½äºç›¸åŒä½ç½®ã€‚ä¾‹å¦‚ï¼ŒOffset0, -1 å°†å¤šè¾¹å½¢æ‹‰è¿‘æ‘„åƒæœºå¹¶å¿½ç•¥å¤šè¾¹å½¢çš„æ–œç‡ï¼Œè€Œ Offset -1, -1åœ¨è§‚å¯Ÿæ å°„è§’æ—¶è¿›ä¸€æ­¥æ‹‰è¿‘å¤šè¾¹å½¢ã€‚</p><h4 id="è®¾ç½®-alpha-æ··åˆalpha-æ“ä½œå’Œ-alpha-to-coverage-æ¨¡å¼">è®¾ç½® Alphaæ··åˆã€Alpha æ“ä½œå’Œ alpha-to-coverage æ¨¡å¼ã€‚</h4><pre><code>Blend sourceBlendMode destBlendModeBlend sourceBlendMode destBlendMode, alphaSourceBlendMode alphaDestBlendModeBlendOp colorOpBlendOp colorOp, alphaOpAlphaToMask On | Off</code></pre><h4 id="è®¾ç½®é¢œè‰²é€šé“å†™å…¥é®ç½©">è®¾ç½®é¢œè‰²é€šé“å†™å…¥é®ç½©</h4><p>è®¾ç½®é¢œè‰²é€šé“å†™å…¥é®ç½©ã€‚å†™å…¥ ColorMask 0å¯å…³é—­å¯¹æ‰€æœ‰é¢œè‰²é€šé“çš„æ¸²æŸ“ã€‚é»˜è®¤æ¨¡å¼æ˜¯ å†™å…¥æ‰€æœ‰é€šé“(RGBA)ï¼Œä½†æ˜¯å¯¹äºæŸäº›ç‰¹æ®Šæ•ˆæœï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä¸ä¿®æ”¹æŸäº›é€šé“ï¼Œæˆ–å®Œå…¨ç¦ç”¨é¢œè‰²å†™å…¥ã€‚</p><p>ä½¿ç”¨å¤šæ¸²æŸ“ç›®æ ‡ (MRT) æ¸²æŸ“æ—¶ï¼Œå¯é€šè¿‡åœ¨æœ«å°¾æ·»åŠ ç´¢å¼•ï¼ˆ0 åˆ°7ï¼‰æ¥ä¸ºæ¯ä¸ªæ¸²æŸ“ç›®æ ‡è®¾ç½®ä¸åŒçš„é¢œè‰²é®ç½©ã€‚ä¾‹å¦‚ï¼Œ<strong><code>ColorMask RGB 3</code></strong>å°†ä½¿æ¸²æŸ“ç›®æ ‡ #3 ä»…å†™å…¥åˆ° RGB é€šé“ã€‚</p><pre><code>ColorMask RGB | A | 0 | Rã€Gã€Bã€A çš„ä»»æ„ç»„åˆ</code></pre><h4 id="æ—§ç‰ˆå›ºå®šå‡½æ•°ç€è‰²å™¨å‘½ä»¤">æ—§ç‰ˆå›ºå®šå‡½æ•°ç€è‰²å™¨å‘½ä»¤</h4><p>ä¸€äº›å‘½ä»¤ç”¨äºç¼–å†™æ—§ç‰ˆâ€œå›ºå®šå‡½æ•°æ ·å¼â€ç€è‰²å™¨ã€‚è¿™æ˜¯è§†ä¸ºå·²å¼ƒç”¨çš„åŠŸèƒ½ï¼Œå› ä¸ºç¼–å†™è¡¨é¢ç€è‰²å™¨æˆ–ç€è‰²å™¨ç¨‹åºå¯å¸¦æ¥æ›´å¤§çš„çµæ´»æ€§ã€‚ä½†æ˜¯ï¼Œå¯¹äºéå¸¸ç®€å•çš„ç€è‰²å™¨ï¼Œä»¥å›ºå®šå‡½æ•°æ ·å¼ç¼–å†™ç€è‰²å™¨æœ‰æ—¶ä¼šæ›´å®¹æ˜“ï¼Œå› æ­¤è¿™é‡Œæä¾›äº†å‘½ä»¤ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœä¸ä½¿ç”¨å›ºå®šå‡½æ•°ç€è‰²å™¨ï¼Œåˆ™ä¼šå¿½ç•¥ä»¥ä¸‹æ‰€æœ‰å‘½ä»¤ã€‚##### å›ºå®šå‡½æ•° Lighting å’Œ Material</p><pre><code>Lighting On | OffMaterial { Material Block }SeparateSpecular On | OffColor Color-valueColorMaterial AmbientAndDiffuse | Emission</code></pre><p>æ‰€æœ‰è¿™äº›å‡æ§åˆ¶å›ºå®šå‡½æ•°æ¯é¡¶ç‚¹å…‰ç…§ï¼šå®ƒä»¬å°†å…¶å¼€å¯ï¼Œè®¾ç½®æè´¨é¢œè‰²ï¼Œå¼€å¯é•œé¢é«˜å…‰ï¼Œæä¾›é»˜è®¤é¢œè‰²ï¼ˆå¦‚æœé¡¶ç‚¹å…‰ç…§å…³é—­ï¼‰ï¼Œå¹¶æ§åˆ¶ç½‘æ ¼é¡¶ç‚¹é¢œè‰²å¦‚ä½•å½±å“å…‰ç…§ã€‚</p><h5 id="å›ºå®šå‡½æ•°-fog">å›ºå®šå‡½æ•° Fog</h5><pre><code>Fog { Fog Block }</code></pre><h5 id="å›ºå®šå‡½æ•°-alphatest">å›ºå®šå‡½æ•° AlphaTest</h5><pre><code>AlphaTest (Less | Greater | LEqual | GEqual | Equal | NotEqual | Always) CutoffValue</code></pre><h5 id="å›ºå®šå‡½æ•°çº¹ç†ç»„åˆå™¨">å›ºå®šå‡½æ•°çº¹ç†ç»„åˆå™¨</h5><pre><code>SetTexture textureProperty { combine options }</code></pre><h4 id="æ··åˆ">æ··åˆ</h4><h4 id="shaderlabé€šé“æ ‡ç­¾">ShaderLabï¼šé€šé“æ ‡ç­¾</h4><pre><code> Tags { "TagName1" = "Value1" "TagName2" = "Value2" }</code></pre><h5 id="lightmode-æ ‡ç­¾å®šä¹‰é€šé“åœ¨å…‰ç…§ç®¡çº¿ä¸­çš„è§’è‰²">LightModeæ ‡ç­¾å®šä¹‰é€šé“åœ¨å…‰ç…§ç®¡çº¿ä¸­çš„è§’è‰²ã€‚</h5><p>LightMode æ ‡ç­¾çš„å¯èƒ½å€¼ï¼š</p><ul><li>Alwaysï¼šå§‹ç»ˆæ¸²æŸ“ï¼›ä¸åº”ç”¨å…‰ç…§ã€‚</li><li>ForwardBaseï¼šåœ¨å‰å‘æ¸²æŸ“ä¸­ä½¿ç”¨ï¼›åº”ç”¨ç¯å¢ƒå…‰ã€ä¸»æ–¹å‘å…‰ã€é¡¶ç‚¹/SHå…‰æºå’Œå…‰ç…§è´´å›¾ã€‚</li><li>ForwardAddï¼šåœ¨å‰å‘æ¸²æŸ“ä¸­ä½¿ç”¨ï¼›åº”ç”¨é™„åŠ çš„æ¯åƒç´ å…‰æºï¼ˆæ¯ä¸ªå…‰æºæœ‰ä¸€ä¸ªé€šé“ï¼‰ã€‚</li><li>Deferredï¼šåœ¨å»¶è¿Ÿæ¸²æŸ“ä¸­ä½¿ç”¨ï¼›æ¸²æŸ“ G ç¼“å†²åŒºã€‚</li><li>ShadowCasterï¼šå°†å¯¹è±¡æ·±åº¦æ¸²æŸ“åˆ°é˜´å½±è´´å›¾æˆ–æ·±åº¦çº¹ç†ä¸­ã€‚</li><li>MotionVectorsï¼šç”¨äºè®¡ç®—æ¯å¯¹è±¡è¿åŠ¨çŸ¢é‡ã€‚</li><li>PrepassBaseï¼šåœ¨æ—§ç‰ˆå»¶è¿Ÿå…‰ç…§ä¸­ä½¿ç”¨ï¼›æ¸²æŸ“æ³•çº¿å’Œé•œé¢åå°„æŒ‡æ•°ã€‚</li><li>PrepassFinalï¼šåœ¨æ—§ç‰ˆå»¶è¿Ÿå…‰ç…§ä¸­ä½¿ç”¨ï¼›é€šè¿‡ç»„åˆçº¹ç†ã€å…‰ç…§å’Œåå…‰æ¥æ¸²æŸ“æœ€ç»ˆé¢œè‰²ã€‚</li><li>Vertexï¼šå½“å¯¹è±¡ä¸è¿›è¡Œå…‰ç…§è´´å›¾æ—¶åœ¨æ—§ç‰ˆé¡¶ç‚¹å…‰ç…§æ¸²æŸ“ä¸­ä½¿ç”¨ï¼›åº”ç”¨æ‰€æœ‰é¡¶ç‚¹å…‰æºã€‚</li><li>VertexLMRGBMï¼šå½“å¯¹è±¡ä¸è¿›è¡Œå…‰ç…§è´´å›¾æ—¶åœ¨æ—§ç‰ˆé¡¶ç‚¹å…‰ç…§æ¸²æŸ“ä¸­ä½¿ç”¨ï¼›åœ¨å…‰ç…§è´´å›¾ä¸ºRGBM ç¼–ç çš„å¹³å°ä¸Šï¼ˆPC å’Œæ¸¸æˆä¸»æœºï¼‰ã€‚</li><li>VertexLMï¼šå½“å¯¹è±¡ä¸è¿›è¡Œå…‰ç…§è´´å›¾æ—¶åœ¨æ—§ç‰ˆé¡¶ç‚¹å…‰ç…§æ¸²æŸ“ä¸­ä½¿ç”¨ï¼›åœ¨å…‰ç…§è´´å›¾ä¸ºåŒLDR ç¼–ç çš„å¹³å°ä¸Šï¼ˆç§»åŠ¨å¹³å°ï¼‰ã€‚</li></ul><p>#####PassFlags æ ‡ç­¾</p><p>ä¸€ä¸ªé€šé“å¯æŒ‡ç¤ºä¸€äº›æ ‡å¿—æ¥æ›´æ”¹æ¸²æŸ“ç®¡çº¿å‘é€šé“ä¼ é€’æ•°æ®çš„æ–¹å¼ã€‚è¿™å¯é€šè¿‡ä½¿ç”¨PassFlagsæ ‡ç­¾æ¥å®ç°ï¼Œè¯¥æ ‡ç­¾çš„å€¼ä¸ºç©ºæ ¼åˆ†éš”çš„æ ‡å¿—åç§°ã€‚ç›®å‰æ”¯æŒä»¥ä¸‹æ ‡å¿—ï¼š</p><ul><li>OnlyDirectionalï¼šåœ¨ ForwardBaseé€šé“ç±»å‹ä¸­ä½¿ç”¨æ—¶ï¼Œæ­¤æ ‡å¿—çš„ä½œç”¨æ˜¯ä»…å…è®¸ä¸»æ–¹å‘å…‰å’Œç¯å¢ƒå…‰/å…‰ç…§æ¢é’ˆæ•°æ®ä¼ é€’åˆ°ç€è‰²å™¨ã€‚è¿™æ„å‘³ç€éé‡è¦å…‰æºçš„æ•°æ®å°†ä¸ä¼šä¼ é€’åˆ°é¡¶ç‚¹å…‰æºæˆ–çƒè°å‡½æ•°ç€è‰²å™¨å˜é‡ã€‚è¯·å‚é˜…å‰å‘æ¸²æŸ“ä»¥äº†è§£è¯¦ç»†ä¿¡æ¯ã€‚</li></ul><p>#####RequireOptions æ ‡ç­¾</p><p>ä¸€ä¸ªé€šé“å¯æŒ‡ç¤ºä»…å½“æ»¡è¶³æŸäº›å¤–éƒ¨æ¡ä»¶æ—¶æ‰æ¸²æŸ“è¯¥é€šé“ã€‚è¿™å¯é€šè¿‡ä½¿ç”¨RequireOptions æ ‡ç­¾æ¥å®ç°ï¼Œè¯¥æ ‡ç­¾çš„å€¼ä¸ºç©ºæ ¼åˆ†éš”çš„é€‰é¡¹å­—ç¬¦ä¸²ã€‚ç›®å‰ï¼ŒUnityæ”¯æŒä»¥ä¸‹é€‰é¡¹ï¼š</p><ul><li>SoftVegetationï¼šä»…å½“ Quality çª—å£ä¸­å¼€å¯äº† Soft Vegetationæ—¶æ‰æ¸²æŸ“æ­¤é€šé“ã€‚</li></ul><h4 id="æ¨¡æ¿ç¼“å†²">æ¨¡æ¿ç¼“å†²</h4><p>æ¨¡æ¿ç¼“å†²åŒºå¯ç”¨ä½œä¸€èˆ¬ç›®çš„çš„æ¯åƒç´ é®ç½©ï¼Œä»¥ä¾¿ä¿å­˜æˆ–ä¸¢å¼ƒåƒç´ ã€‚</p><p>æ¨¡æ¿ç¼“å†²åŒºé€šå¸¸æ˜¯æ¯åƒç´  8ä½æ•´æ•°ã€‚è¯¥å€¼å¯ä»¥å†™å…¥ã€é€’å¢æˆ–é€’å‡ã€‚åç»­ç»˜åˆ¶è°ƒç”¨å¯ä»¥æ ¹æ®è¯¥å€¼è¿›è¡Œæµ‹è¯•ï¼Œä»¥ç¡®å®šåœ¨è¿è¡Œåƒç´ ç€è‰²å™¨ä¹‹å‰æ˜¯å¦åº”ä¸¢å¼ƒåƒç´ ã€‚</p><p>Ref</p><pre><code>    Ref referenceValue</code></pre><p>è¦æ¯”è¾ƒçš„å‚è€ƒå€¼ï¼ˆå¦‚æœ Comp æ˜¯ alwaysä»¥å¤–çš„ä»»ä½•å€¼ï¼‰å’Œ/æˆ–è¦å†™å…¥ç¼“å†²åŒºçš„å€¼ï¼ˆå¦‚æœ Passã€Fail æˆ– ZFailè®¾ç½®ä¸ºæ›¿æ¢ï¼‰ã€‚å€¼ä¸º 0 åˆ° 255 ä¹‹é—´çš„æ•´æ•°ã€‚</p><p>ReadMaskã€WriteMaskã€Compã€Passã€Failã€ZFail</p><pre><code>    ReadMask readMask</code></pre><p>è¿™æ˜¯ä¸€ä¸ª 8 ä½æ©ç ï¼Œå€¼ä¸º 0 åˆ° 255ä¹‹é—´çš„æ•´æ•°ï¼Œç”¨äºæ¯”è¾ƒå‚è€ƒå€¼å’Œç¼“å†²åŒºçš„å†…å®¹ (referenceValue &amp; readMask)comparisonFunction (stencilBufferValue &amp;readMask)ã€‚é»˜è®¤å€¼ï¼š<em>255</em>ã€‚</p><pre><code>    WriteMask writeMask</code></pre><p>è¿™æ˜¯ä¸€ä¸ª 8 ä½æ©ç ï¼Œå€¼ä¸º 0 åˆ° 255ä¹‹é—´æ•´æ•°ï¼Œå†™å…¥ç¼“å†²åŒºæ—¶ä½¿ç”¨ã€‚è¯·æ³¨æ„ï¼Œä¸å…¶ä»–å†™æ©ç ä¸€æ ·ï¼Œå®ƒæŒ‡å®šå†™æ“ä½œå°†å½±å“æ¨¡æ¿ç¼“å†²åŒºçš„å“ªäº›ä½ï¼ˆä¾‹å¦‚WriteMask 0 è¡¨ç¤ºä¸ä¼šå½±å“ä»»ä½•ä½ï¼Œä¹Ÿä¸ä¼šå†™å…¥0ï¼‰ã€‚é»˜è®¤å€¼ï¼š<em>255</em>ã€‚</p><pre><code>    Comp comparisonFunction</code></pre><p>ç”¨äºå°†å‚è€ƒå€¼ä¸ç¼“å†²åŒºçš„å½“å‰å†…å®¹è¿›è¡Œæ¯”è¾ƒçš„å‡½æ•°ã€‚é»˜è®¤å€¼ï¼š<em>always</em>ã€‚</p><pre><code>    Pass stencilOperation</code></pre><p>å¦‚æœæ¨¡æ¿æµ‹è¯•ï¼ˆå’Œæ·±åº¦æµ‹è¯•ï¼‰é€šè¿‡ï¼Œå¦‚ä½•å¤„ç†ç¼“å†²åŒºçš„å†…å®¹ã€‚é»˜è®¤å€¼ï¼š<em>keep</em>ã€‚</p><pre><code>    Fail stencilOperation</code></pre><p>å¦‚æœæ¨¡æ¿æµ‹è¯•ï¼ˆå’Œæ·±åº¦æµ‹è¯•ï¼‰å¤±è´¥ï¼Œå¦‚ä½•å¤„ç†ç¼“å†²åŒºçš„å†…å®¹ã€‚é»˜è®¤å€¼ï¼š<em>keep</em>ã€‚</p><pre><code>    ZFail stencilOperation</code></pre><p>å¦‚æœæ¨¡æ¿æµ‹è¯•é€šè¿‡ä½†æ·±åº¦æµ‹è¯•å¤±è´¥ï¼Œå¦‚ä½•å¤„ç†ç¼“å†²åŒºçš„å†…å®¹ã€‚é»˜è®¤å€¼ï¼š<em>keep</em>ã€‚</p><p>Compã€Passã€Fail å’Œ ZFail å°†åº”ç”¨äºæ­£é¢å‡ ä½•ä½“ï¼Œé™¤éæŒ‡å®šäº† <em>CullFront</em>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å°†åº”ç”¨äºèƒŒé¢å‡ ä½•ä½“ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡å®šä¹‰CompFrontã€PassFrontã€FailFront æˆ– ZFailFrontï¼ˆç”¨äºæ­£é¢å‡ ä½•ä½“ï¼‰ä»¥åŠCompBackã€PassBackã€FailBack æˆ–ZFailBackï¼ˆç”¨äºèƒŒé¢å‡ ä½•ä½“ï¼‰æ¥æ˜¾å¼æŒ‡å®šåŒé¢æ¨¡æ¿çŠ¶æ€ã€‚</p><h5 id="æ¯”è¾ƒå‡½æ•°">æ¯”è¾ƒå‡½æ•°</h5><table><thead><tr class="header"><th style="text-align: left;">å‡½æ•°</th><th style="text-align: left;">è§£é‡Š</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">Greater</td><td style="text-align: left;">ä»…æ¸²æŸ“å‚è€ƒå€¼å¤§äºç¼“å†²åŒºå€¼çš„åƒç´ ã€‚</td></tr><tr class="even"><td style="text-align: left;">GEqual</td><td style="text-align: left;">ä»…æ¸²æŸ“å‚è€ƒå€¼å¤§äºæˆ–ç­‰äºç¼“å†²åŒºå€¼çš„åƒç´ ã€‚</td></tr><tr class="odd"><td style="text-align: left;">Less</td><td style="text-align: left;">ä»…æ¸²æŸ“å‚è€ƒå€¼å°äºç¼“å†²åŒºå€¼çš„åƒç´ ã€‚</td></tr><tr class="even"><td style="text-align: left;">LEqual</td><td style="text-align: left;">ä»…æ¸²æŸ“å‚è€ƒå€¼å°äºæˆ–ç­‰äºç¼“å†²åŒºå€¼çš„åƒç´ ã€‚</td></tr><tr class="odd"><td style="text-align: left;">Equal</td><td style="text-align: left;">ä»…æ¸²æŸ“å‚è€ƒå€¼ç­‰äºç¼“å†²åŒºå€¼çš„åƒç´ ã€‚</td></tr><tr class="even"><td style="text-align: left;">NotEqual</td><td style="text-align: left;">ä»…æ¸²æŸ“å‚è€ƒå€¼ä¸åŒäºç¼“å†²åŒºå€¼çš„åƒç´ ã€‚</td></tr><tr class="odd"><td style="text-align: left;">Always</td><td style="text-align: left;">ä½¿æ¨¡æ¿æµ‹è¯•å§‹ç»ˆé€šè¿‡ã€‚</td></tr><tr class="even"><td style="text-align: left;">Never</td><td style="text-align: left;">ä½¿æ¨¡æ¿æµ‹è¯•å§‹ç»ˆå¤±è´¥ã€‚</td></tr></tbody></table><h5 id="æ¨¡æ¿æ“ä½œ">æ¨¡æ¿æ“ä½œ</h5><table><thead><tr class="header"><th style="text-align: left;">å‡½æ•°</th><th style="text-align: left;">è§£é‡Š</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">Keep</td><td style="text-align: left;">ä¿æŒç¼“å†²åŒºçš„å½“å‰å†…å®¹ã€‚</td></tr><tr class="even"><td style="text-align: left;">Zero</td><td style="text-align: left;">å°† 0 å†™å…¥ç¼“å†²åŒºã€‚</td></tr><tr class="odd"><td style="text-align: left;">Replace</td><td style="text-align: left;">å°†å‚è€ƒå€¼å†™å…¥ç¼“å†²åŒºã€‚</td></tr><tr class="even"><td style="text-align: left;">IncrSat</td><td style="text-align: left;">é€’å¢ç¼“å†²åŒºä¸­çš„å½“å‰å€¼ã€‚å¦‚æœè¯¥å€¼å·²ç»æ˜¯255ï¼Œåˆ™ä¿æŒä¸º 255ã€‚</td></tr><tr class="odd"><td style="text-align: left;">DecrSat</td><td style="text-align: left;">é€’å‡ç¼“å†²åŒºä¸­çš„å½“å‰å€¼ã€‚å¦‚æœè¯¥å€¼å·²ç»æ˜¯0ï¼Œåˆ™ä¿æŒä¸º 0ã€‚</td></tr><tr class="even"><td style="text-align: left;">Invert</td><td style="text-align: left;">å°†æ‰€æœ‰ä½æ±‚åã€‚</td></tr><tr class="odd"><td style="text-align: left;">IncrWrap</td><td style="text-align: left;">é€’å¢ç¼“å†²åŒºä¸­çš„å½“å‰å€¼ã€‚å¦‚æœè¯¥å€¼å·²ç»æ˜¯255ï¼Œåˆ™å˜ä¸º 0ã€‚</td></tr><tr class="even"><td style="text-align: left;">DecrWrap</td><td style="text-align: left;">é€’å‡ç¼“å†²åŒºä¸­çš„å½“å‰å€¼ã€‚å¦‚æœè¯¥å€¼å·²ç»æ˜¯0ï¼Œåˆ™å˜ä¸º 255ã€‚</td></tr></tbody></table><h5 id="å»¶è¿Ÿæ¸²æŸ“è·¯å¾„">å»¶è¿Ÿæ¸²æŸ“è·¯å¾„</h5><p>åœ¨å»¶è¿Ÿæ¸²æŸ“è·¯å¾„ä¸­æ¸²æŸ“çš„å¯¹è±¡çš„æ¨¡æ¿åŠŸèƒ½åœ¨æŸç§ç¨‹åº¦ä¸Šå—åˆ°é™åˆ¶ï¼Œå› ä¸ºåœ¨åŸºç¡€é€šé“å’Œå…‰ç…§é€šé“æœŸé—´ï¼Œæ¨¡æ¿ç¼“å†²åŒºç”¨äºå…¶ä»–ç›®çš„ã€‚<strong>åœ¨è¿™ä¸¤ä¸ªé˜¶æ®µä¸­ï¼Œç€è‰²å™¨ä¸­å®šä¹‰çš„æ¨¡æ¿çŠ¶æ€å°†è¢«å¿½ç•¥ï¼Œè€Œä»…åœ¨æœ€ç»ˆé€šé“æœŸé—´è€ƒè™‘ã€‚å› æ­¤ï¼Œä¸å¯èƒ½åŸºäºæ¨¡æ¿æµ‹è¯•æ¥å±è”½è¿™äº›å¯¹è±¡ï¼Œä½†æ˜¯å®ƒä»¬ä»ç„¶å¯ä»¥ä¿®æ”¹ç¼“å†²åŒºå†…å®¹ï¼Œä»¥ä¾›ç¨ååœ¨å¸§ä¸­æ¸²æŸ“çš„å¯¹è±¡ä½¿ç”¨</strong>ã€‚åœ¨å»¶è¿Ÿè·¯å¾„ä¹‹ååœ¨å‰å‘æ¸²æŸ“è·¯å¾„ä¸­æ¸²æŸ“çš„å¯¹è±¡ï¼ˆä¾‹å¦‚é€æ˜å¯¹è±¡æˆ–æ²¡æœ‰è¡¨é¢ç€è‰²å™¨çš„å¯¹è±¡ï¼‰å°†å†æ¬¡æ­£å¸¸è®¾ç½®å…¶æ¨¡æ¿çŠ¶æ€ã€‚</p><p>å»¶è¿Ÿæ¸²æŸ“è·¯å¾„ä½¿ç”¨æ¨¡æ¿ç¼“å†²åŒºçš„ä¸‰ä¸ªæœ€é«˜ä½ï¼ŒåŠ ä¸Šæœ€å¤šå››ä¸ªæœ€é«˜ä½ï¼ˆå…·ä½“å–å†³äºåœºæ™¯ä¸­ä½¿ç”¨çš„å…‰é®ç½©å±‚æ•°ï¼‰ã€‚å¯ä»¥ä½¿ç”¨æ¨¡æ¿è¯»å†™æ©ç åœ¨â€œå¹²å‡€â€çš„ä½èŒƒå›´å†…æ“ä½œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Camera.clearStencilAfterLightingPasså¼ºåˆ¶æ‘„åƒæœºåœ¨å…‰ç…§é€šé“åæ¸…ç†æ¨¡æ¿ç¼“å†²åŒºã€‚</p><h4 id="shaderlabname">ShaderLabï¼šName</h4><pre><code>Name "PassName"</code></pre><p>ä¸ºå½“å‰é€šé“æä¾› PassNameåç§°ã€‚<strong>è¯·æ³¨æ„ï¼Œåœ¨å†…éƒ¨ï¼Œåç§°å°†è½¬æ¢ä¸ºå¤§å†™</strong>ã€‚</p><h4 id="shaderlabusepass">ShaderLabï¼šUsePass</h4><pre><code>UsePass "Shader/Name"</code></pre><p>æ’å…¥æ¥è‡ªç»™å®šç€è‰²å™¨çš„å…·æœ‰ç»™å®šåç§°çš„æ‰€æœ‰é€šé“ã€‚Shader/NameåŒ…å«ç€è‰²å™¨åç§°å’Œé€šé“åç§°ï¼Œä»¥æ–œæ å­—ç¬¦åˆ†éš”ã€‚è¯·æ³¨æ„ï¼Œç³»ç»Ÿåªä¼šè€ƒè™‘ç¬¬ä¸€ä¸ªå—æ”¯æŒçš„å­ç€è‰²å™¨ã€‚</p><h4 id="shaderlabgrabpass">ShaderLabï¼šGrabPass</h4><p>GrabPassæ˜¯ä¸€ç§ç‰¹æ®Šé€šé“ç±»å‹ï¼Œå®ƒæŠŠå³å°†ç»˜åˆ¶å¯¹è±¡æ—¶çš„å±å¹•å†…å®¹æŠ“å–åˆ°çº¹ç†ä¸­ã€‚åœ¨åç»­é€šé“ä¸­å³å¯ä½¿ç”¨æ­¤çº¹ç†ï¼Œä»è€Œæ‰§è¡ŒåŸºäºå›¾åƒçš„é«˜çº§æ•ˆæœã€‚</p><p>GrabPass åŒ…å«åœ¨å­ç€è‰²å™¨å†…éƒ¨ã€‚å®ƒå¯é‡‡ç”¨ä¸¤ç§å½¢å¼ï¼š</p><ul><li>ç®€å•çš„ GrabPass { }å¯å°†å½“å‰å±å¹•å†…å®¹æŠ“å–åˆ°æŸä¸ªçº¹ç†ä¸­ã€‚åœ¨éšåçš„é€šé“ä¸­å¯é€šè¿‡ _GrabTextureåç§°è®¿é—®è¯¥çº¹ç†ã€‚æ³¨æ„ï¼šè¿™ç§æŠ“å–é€šé“çš„å½¢å¼å°†ä¸ºä½¿ç”¨å®ƒçš„æ¯ä¸ªå¯¹è±¡æ‰§è¡Œè€—æ—¶çš„å±å¹•æŠ“å–æ“ä½œã€‚</li><li>GrabPass { "TextureName" }å¯å°†å½“å‰å±å¹•å†…å®¹æŠ“å–åˆ°çº¹ç†ä¸­ï¼Œä½†ä»…ä¸ºä½¿ç”¨ç»™å®šçº¹ç†åç§°çš„ç¬¬ä¸€ä¸ªå¯¹è±¡åœ¨æ¯ä¸€å¸§æ‰§è¡Œä¸€æ¬¡è¯¥æ“ä½œã€‚åœ¨åç»­é€šé“ä¸­å¯é€šè¿‡ç»™å®šçº¹ç†åç§°è®¿é—®è¯¥çº¹ç†ã€‚åœºæ™¯ä¸­æœ‰å¤šä¸ªå¯¹è±¡åœ¨ä½¿ç”¨GrabPass æ—¶ï¼Œè¿™ç§æ–¹æ³•æ›´é«˜æ•ˆã€‚</li></ul><h4 id="shaderlabå­ç€è‰²å™¨æ ‡ç­¾-subshader-tags">ShaderLabï¼šå­ç€è‰²å™¨æ ‡ç­¾(SubShader Tags)</h4><p>æ ‡ç­¾ç”¨äºç¡®å®šå­ç€è‰²å™¨çš„æ¸²æŸ“é¡ºåºå’Œå…¶ä»–å‚æ•°ã€‚<strong>è¯·æ³¨æ„ï¼Œä»¥ä¸‹ç”±Unity è¯†åˆ«çš„æ ‡ç­¾å¿…é¡»ä½äº SubShader éƒ¨åˆ†ä¸­ï¼Œä¸èƒ½åœ¨ Pass ä¸­ï¼</strong></p><p>é™¤äº† Unity å¯ä»¥è¯†åˆ«çš„å†…ç½®æ ‡ç­¾å¤–ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨è‡ªå·±çš„æ ‡ç­¾å¹¶ä½¿ç”¨Material.GetTag å‡½æ•°æ¥æŸ¥è¯¢è¿™äº›æ ‡ç­¾ã€‚</p><ul><li>æ¸²æŸ“é¡ºåº - Queue æ ‡ç­¾</li></ul><p>æœ‰å››ä¸ªé¢„å®šä¹‰çš„æ¸²æŸ“é˜Ÿåˆ—ï¼Œä½†é¢„å®šä¹‰çš„æ¸²æŸ“é˜Ÿåˆ—ä¹‹é—´å¯ä»¥æœ‰æ›´å¤šçš„é˜Ÿåˆ—ã€‚é¢„å®šä¹‰é˜Ÿåˆ—åŒ…æ‹¬ï¼š</p><ul><li>Background -æ­¤æ¸²æŸ“é˜Ÿåˆ—åœ¨ä»»ä½•å…¶ä»–æ¸²æŸ“é˜Ÿåˆ—ä¹‹å‰æ¸²æŸ“ã€‚é€šå¸¸ä¼šå¯¹éœ€è¦å¤„äºèƒŒæ™¯ä¸­çš„å¯¹è±¡ä½¿ç”¨æ­¤æ¸²æŸ“é˜Ÿåˆ—ã€‚</li><li>Geometryï¼ˆé»˜è®¤å€¼ï¼‰-æ­¤é˜Ÿåˆ—ç”¨äºå¤§éƒ¨åˆ†å¯¹è±¡ã€‚ä¸é€æ˜å‡ ä½•ä½“ä½¿ç”¨æ­¤é˜Ÿåˆ—ã€‚</li><li>AlphaTest - è¿›è¡Œ Alpha æµ‹è¯•çš„å‡ ä½•ä½“å°†ä½¿ç”¨æ­¤é˜Ÿåˆ—ã€‚è¿™æ˜¯ä¸åŒäº Geometryé˜Ÿåˆ—çš„å•ç‹¬é˜Ÿåˆ—ï¼Œå› ä¸ºåœ¨ç»˜åˆ¶å®Œæ‰€æœ‰å®ä½“å¯¹è±¡ä¹‹åå†æ¸²æŸ“ç»è¿‡ Alphaæµ‹è¯•çš„å¯¹è±¡ä¼šæ›´æœ‰æ•ˆã€‚</li><li>Transparent - æ­¤æ¸²æŸ“é˜Ÿåˆ—åœ¨ Geometry å’Œ AlphaTestä¹‹åæ¸²æŸ“ï¼ŒæŒ‰ç…§ä»ååˆ°å‰çš„é¡ºåºã€‚<strong>ä»»ä½•ç»è¿‡ Alphaæ··åˆè€…ï¼ˆå³ä¸å†™å…¥æ·±åº¦ç¼“å†²åŒºçš„ç€è‰²å™¨ï¼‰éƒ½åº”è¯¥æ”¾åœ¨è¿™é‡Œ</strong>ï¼ˆç»ç’ƒã€ç²’å­æ•ˆæœï¼‰ã€‚</li><li>Overlay -æ­¤æ¸²æŸ“é˜Ÿåˆ—æ—¨åœ¨è·å¾—è¦†ç›–æ•ˆæœã€‚<strong>æœ€åæ¸²æŸ“çš„ä»»ä½•å†…å®¹éƒ½åº”è¯¥æ”¾åœ¨æ­¤å¤„</strong>ï¼ˆä¾‹å¦‚ï¼Œé•œå¤´å…‰æ™•ï¼‰ã€‚</li></ul><p>å¯¹äºç‰¹æ®Šç”¨ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨ä¸­é—´é˜Ÿåˆ—ã€‚åœ¨å†…éƒ¨ï¼Œæ¯ä¸ªé˜Ÿåˆ—ç”±æ•´æ•°ç´¢å¼•è¡¨ç¤ºï¼›<strong>Backgroundæ˜¯ 1000ï¼ŒGeometry æ˜¯ 2000ï¼ŒAlphaTest æ˜¯ 2450ï¼ŒTransparent æ˜¯3000ï¼ŒOverlay æ˜¯ 4000</strong>ã€‚å¦‚æœç€è‰²å™¨ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„é˜Ÿåˆ—ï¼š</p><pre><code>Tags { "Queue" = "Geometry+1" }</code></pre><p>è¿™å°†ä½¿å¯¹è±¡åœ¨æ‰€æœ‰ä¸é€æ˜å¯¹è±¡ä¹‹åæ¸²æŸ“ï¼Œä½†åœ¨é€æ˜å¯¹è±¡ä¹‹å‰æ¸²æŸ“ï¼Œå› ä¸ºæ¸²æŸ“é˜Ÿåˆ—ç´¢å¼•å€¼å°†æ˜¯2001ï¼ˆå‡ ä½•ä½“ç´¢å¼•å€¼åŠ ä¸€ï¼‰ã€‚å¦‚æœæ‚¨å¸Œæœ›å§‹ç»ˆåœ¨å…¶ä»–å¯¹è±¡é›†ä¹‹é—´ç»˜åˆ¶æŸäº›å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé€æ˜çš„æ°´åº”è¯¥åœ¨ä¸é€æ˜å¯¹è±¡ä¹‹åç»˜åˆ¶ï¼Œä½†åˆè¦åœ¨é€æ˜å¯¹è±¡ä¹‹å‰ç»˜åˆ¶ã€‚</p><p>ç´¢å¼•å€¼é«˜è¾¾ 2500çš„é˜Ÿåˆ—ï¼ˆâ€œGeometry+500â€ï¼‰è§†ä¸ºâ€œä¸é€æ˜â€ï¼Œå¹¶ä¸”ä¼šä¼˜åŒ–å¯¹è±¡çš„ç»˜åˆ¶é¡ºåºä»¥è·å¾—æœ€ä½³æ€§èƒ½ã€‚è¾ƒé«˜ç´¢å¼•çš„æ¸²æŸ“é˜Ÿåˆ—è¢«è®¤ä¸ºæ˜¯â€œé€æ˜å¯¹è±¡â€å¹¶æŒ‰è·ç¦»å°†å¯¹è±¡è¿›è¡Œæ’åºï¼Œä»è·ç¦»æœ€è¿œçš„å¯¹è±¡å¼€å§‹æ¸²æŸ“ï¼Œæœ€åæ¸²æŸ“è·ç¦»æœ€è¿‘çš„å¯¹è±¡ã€‚å¤©ç©ºç›’åœ¨æ‰€æœ‰ä¸é€æ˜å¯¹è±¡å’Œæ‰€æœ‰é€æ˜å¯¹è±¡ä¹‹é—´ç»˜åˆ¶ã€‚</p><ul><li><p>RenderType æ ‡ç­¾ RenderTypeæ ‡ç­¾å°†ç€è‰²å™¨åˆ†ä¸ºå‡ ä¸ªé¢„å®šä¹‰çš„ç»„ï¼Œä¾‹å¦‚ï¼Œä¸é€æ˜çš„ç€è‰²å™¨ï¼Œæˆ–ç»è¿‡ Alphaæµ‹è¯•çš„ç€è‰²å™¨ç­‰ç­‰ã€‚ç€è‰²å™¨æ›¿æ¢å°†ä½¿ç”¨è¯¥æ ‡ç­¾ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹è¿˜ç”¨äºäº§ç”Ÿæ‘„åƒæœºçš„æ·±åº¦çº¹ç†ã€‚</p></li><li><p>DisableBatching æ ‡ç­¾</p></li></ul><p>ä½¿ç”¨ç»˜åˆ¶è°ƒç”¨æ‰¹å¤„ç†æ—¶ï¼Œä¸€äº›ç€è‰²å™¨ï¼ˆä¸»è¦æ˜¯è¿›è¡Œå¯¹è±¡ç©ºé—´é¡¶ç‚¹å˜å½¢çš„ç€è‰²å™¨ï¼‰ä¸èµ·ä½œç”¨ï¼Œè¿™æ˜¯å› ä¸ºæ‰¹å¤„ç†ä¼šå°†æ‰€æœ‰å‡ ä½•ä½“è½¬æ¢ä¸ºä¸–ç•Œç©ºé—´ï¼Œæ‰€ä»¥â€œå¯¹è±¡ç©ºé—´â€ä¸¢å¤±ã€‚</p><p>å¯ä½¿ç”¨ DisableBatchingæ ‡ç­¾æ¥æŒ‡ç¤ºè¿™ä¸€æƒ…å†µã€‚æœ‰ä¸‰ä¸ªå¯èƒ½çš„å€¼ï¼šâ€œTrueâ€ï¼ˆå§‹ç»ˆå¯¹æ­¤ç€è‰²å™¨ç¦ç”¨æ‰¹å¤„ç†ï¼‰ã€â€œFalseâ€ï¼ˆä¸ç¦ç”¨æ‰¹å¤„ç†ï¼›è¿™æ˜¯é»˜è®¤å€¼ï¼‰å’Œâ€œLODFadingâ€ï¼ˆå½“LOD æ·¡åŒ–å¤„äºæ¿€æ´»çŠ¶æ€æ—¶ç¦ç”¨æ‰¹å¤„ç†ï¼›ä¸»è¦ç”¨äºæ ‘ï¼‰ã€‚</p><p><strong>ä¸èµ·ä½œç”¨çš„æƒ…å†µä¸‹ï¼Œç¦ç”¨æé«˜æ€§èƒ½ï¼Ÿ</strong></p><ul><li><p>ForceNoShadowCasting æ ‡ç­¾ å¦‚æœæä¾›äº† ForceNoShadowCastingæ ‡ç­¾å¹¶ä¸”å€¼ä¸ºâ€œTrueâ€ï¼Œåˆ™ä½¿ç”¨è¯¥å­ç€è‰²å™¨æ¸²æŸ“çš„å¯¹è±¡ç»ä¸ä¼šæŠ•å°„é˜´å½±ã€‚å¯¹é€æ˜å¯¹è±¡ä½¿ç”¨ç€è‰²å™¨æ›¿æ¢å¹¶ä¸”ä¸å¸Œæœ›ä»å…¶ä»–å­ç€è‰²å™¨ç»§æ‰¿é˜´å½±é€šé“æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚</p></li><li><p>IgnoreProjector æ ‡ç­¾</p></li></ul><p>å¦‚æœæä¾›äº† IgnoreProjectoræ ‡ç­¾å¹¶ä¸”å€¼ä¸ºâ€œTrueâ€ï¼Œåˆ™ä½¿ç”¨æ­¤ç€è‰²å™¨çš„å¯¹è±¡ä¸ä¼šå—åˆ°æŠ•å½±å™¨çš„å½±å“ã€‚è¿™å¯¹åŠé€æ˜å¯¹è±¡éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºæŠ•å½±å™¨æ— æ³•å½±å“å®ƒä»¬ã€‚</p><ul><li>CanUseSpriteAtlas æ ‡ç­¾</li></ul><p>å¦‚æœç€è‰²å™¨ç”¨äºç²¾çµï¼Œè¯·å°† CanUseSpriteAtlasæ ‡ç­¾è®¾ç½®ä¸ºâ€œFalseâ€ï¼Œè¿™æ ·åœ¨ç²¾çµæ‰“åŒ…åˆ°å›¾é›†å†…æ—¶ï¼Œè¯¥æ ‡ç­¾å°†ä¸èµ·ä½œç”¨ã€‚ï¼ˆç²¾çµæ‰“åŒ…å™¨(Sprite Packer)ã€‚</p><ul><li>PreviewType æ ‡ç­¾</li></ul><p>PreviewTypeæŒ‡ç¤ºæè´¨æ£€è§†é¢æ¿é¢„è§ˆåº”å¦‚ä½•æ˜¾ç¤ºæè´¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæè´¨æ˜¾ç¤ºä¸ºçƒä½“ï¼Œä½†ä¹Ÿå¯ä»¥å°†PreviewType è®¾ç½®ä¸ºâ€œPlaneâ€ï¼ˆå°†æ˜¾ç¤ºä¸º2Dï¼‰æˆ–â€œSkyboxâ€ï¼ˆå°†æ˜¾ç¤ºä¸ºå¤©ç©ºç›’ï¼‰ã€‚</p><h3 id="fallback">Fallback</h3><p>åœ¨æ‰€æœ‰å­ç€è‰²å™¨çš„åé¢å¯å®šä¹‰Fallbackã€‚åŸºæœ¬ä¸Šå°±æ˜¯è¯´ï¼Œâ€œå¦‚æœæ²¡æœ‰ä»»ä½•å­ç€è‰²å™¨èƒ½å¤Ÿåœ¨æ­¤ç¡¬ä»¶ä¸Šè¿è¡Œï¼Œåˆ™å°è¯•ä½¿ç”¨å¦ä¸€ä¸ªç€è‰²å™¨ä¸­çš„å­ç€è‰²å™¨â€ã€‚</p><pre><code> Fallback "name" //æˆ–è€… // Fallback Off</code></pre><h3 id="customeditor">CustomEditor</h3><h3 id="shaderlabå…¶ä»–å‘½ä»¤">ShaderLabï¼šå…¶ä»–å‘½ä»¤</h3><p>Categoryæ˜¯ä¸€ç§é€»è¾‘åˆ†ç»„ï¼Œå…¶ä¸­åŒ…å«å±äºè¯¥åˆ†ç»„çš„æ‰€æœ‰å‘½ä»¤ã€‚è¿™ä¸»è¦ç”¨äºâ€œç»§æ‰¿â€æ¸²æŸ“çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œæ‚¨çš„ç€è‰²å™¨å¯èƒ½æœ‰å¤šä¸ªå­ç€è‰²å™¨ï¼Œå¹¶ä¸”å…¶ä¸­æ¯ä¸ªå­ç€è‰²å™¨éƒ½éœ€è¦å…³é—­é›¾æ•ˆã€å°†æ··åˆè®¾ç½®ä¸ºé™„åŠ ç­‰ï¼Œä¾¿å¯ä¸ºæ­¤ä½¿ç”¨Categoryï¼š</p><pre><code>Shader "example" {Category {    Fog { Mode Off }    Blend One One    SubShader {        // ...    }    SubShader {        // ...    }    // ...}}</code></pre><p><strong>Category ä»£ç å—ä»…å½±å“ç€è‰²å™¨è§£æï¼Œæ•ˆæœå®Œå…¨ç­‰åŒäºå°† Categoryä¸­è®¾ç½®çš„ä»»æ„çŠ¶æ€â€œç²˜è´´â€åˆ° Categoryä¸‹é¢çš„æ‰€æœ‰ä»£ç å—ä¸­ã€‚è¿™å®Œå…¨ä¸ä¼šå½±å“ç€è‰²å™¨æ‰§è¡Œé€Ÿåº¦ã€‚</strong></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/shader/6.zhao-se-qi-lei-xing-de-jing-du/"/>
      <url>/2022/08/10/unity/shader/6.zhao-se-qi-lei-xing-de-jing-du/</url>
      
        <content type="html"><![CDATA[<h1 id="ç€è‰²å™¨æ•°æ®ç±»å‹å’Œç²¾åº¦">ç€è‰²å™¨æ•°æ®ç±»å‹å’Œç²¾åº¦</h1><p>Unity ä¸­çš„æ ‡å‡†ç€è‰²å™¨è¯­è¨€ä¸º HLSLï¼Œæ”¯æŒä¸€èˆ¬ HLSL æ•°æ®ç±»å‹ã€‚ä½†æ˜¯ï¼ŒUnityå¯¹ HLSL ç±»å‹æœ‰ä¸€äº›è¡¥å……ï¼Œç‰¹åˆ«æ˜¯ä¸ºäº†åœ¨ç§»åŠ¨å¹³å°ä¸Šæä¾›æ›´å¥½çš„æ”¯æŒã€‚</p><h2 id="åŸºæœ¬æ•°æ®ç±»å‹">åŸºæœ¬æ•°æ®ç±»å‹</h2><p>ç€è‰²å™¨ä¸­çš„å¤§å¤šæ•°è®¡ç®—æ˜¯å¯¹æµ®ç‚¹æ•°ï¼ˆåœ¨ C# ç­‰å¸¸è§„ç¼–ç¨‹è¯­è¨€ä¸­ä¸ºfloatï¼‰è¿›è¡Œçš„ã€‚æµ®ç‚¹ç±»å‹æœ‰å‡ ç§å˜ä½“ï¼šfloatã€half å’Œfixedï¼ˆä»¥åŠå®ƒä»¬çš„çŸ¢é‡/çŸ©é˜µå˜ä½“ï¼Œæ¯”å¦‚ half3 å’Œfloat4x4ï¼‰ã€‚è¿™äº›ç±»å‹çš„ç²¾åº¦ä¸åŒï¼ˆå› æ­¤æ€§èƒ½æˆ–åŠŸè€—ä¹Ÿä¸åŒï¼‰ï¼š</p><h3 id="é«˜ç²¾åº¦float">é«˜ç²¾åº¦ï¼šfloat</h3><p>æœ€é«˜ç²¾åº¦æµ®ç‚¹å€¼ï¼›ä¸€èˆ¬æ˜¯ 32 ä½ï¼ˆå°±åƒå¸¸è§„ç¼–ç¨‹è¯­è¨€ä¸­çš„ floatï¼‰ã€‚ å®Œæ•´çš„floatç²¾åº¦é€šå¸¸ç”¨äºä¸–ç•Œç©ºé—´ä½ç½®ã€çº¹ç†åæ ‡æˆ–æ¶‰åŠå¤æ‚å‡½æ•°ï¼ˆå¦‚ä¸‰è§’å‡½æ•°æˆ–å¹‚/å–å¹‚ï¼‰çš„æ ‡é‡è®¡ç®—ã€‚</p><h3 id="ä¸­ç­‰ç²¾åº¦half">ä¸­ç­‰ç²¾åº¦ï¼šhalf</h3><p>ä¸­ç­‰ç²¾åº¦æµ®ç‚¹å€¼ï¼›é€šå¸¸ä¸º 16 ä½ï¼ˆèŒƒå›´ä¸º â€“60000 è‡³ +60000ï¼Œç²¾åº¦çº¦ä¸º 3ä½å°æ•°ï¼‰ã€‚åŠç²¾åº¦å¯¹äºçŸ­çŸ¢é‡ã€æ–¹å‘ã€å¯¹è±¡ç©ºé—´ä½ç½®ã€é«˜åŠ¨æ€èŒƒå›´é¢œè‰²éå¸¸æœ‰ç”¨ã€‚</p><h3 id="ä½ç²¾åº¦fixed">ä½ç²¾åº¦ï¼šfixed</h3><p>æœ€ä½ç²¾åº¦çš„å®šç‚¹å€¼ã€‚é€šå¸¸æ˜¯ 11 ä½ï¼Œ<strong>èŒƒå›´ä» â€“2.0 åˆ° +2.0ï¼Œç²¾åº¦ä¸º1/256</strong>ã€‚å›ºå®šç²¾åº¦å¯¹äºå¸¸è§„é¢œè‰²ï¼ˆé€šå¸¸å­˜å‚¨åœ¨å¸¸è§„çº¹ç†ä¸­ï¼‰ä»¥åŠå¯¹å®ƒä»¬æ‰§è¡Œç®€å•è¿ç®—éå¸¸æœ‰ç”¨ã€‚</p><h3 id="æ•´æ•°æ•°æ®ç±»å‹">æ•´æ•°æ•°æ®ç±»å‹</h3><p>æ•´æ•°ï¼ˆintæ•°æ®ç±»å‹ï¼‰é€šå¸¸ç”¨ä½œå¾ªç¯è®¡æ•°å™¨æˆ–æ•°ç»„ç´¢å¼•ã€‚ä¸ºæ­¤ï¼Œå®ƒä»¬é€šå¸¸å¯ä»¥åœ¨å„ç§å¹³å°ä¸Šæ­£å¸¸å·¥ä½œã€‚</p><p>æ ¹æ®å¹³å°çš„ä¸åŒï¼ŒGPU å¯èƒ½ä¸æ”¯æŒæ•´æ•°ç±»å‹ã€‚ä¾‹å¦‚ï¼ŒDirect3D 9 å’Œ OpenGL ES2.0 GPUä»…å¯¹æµ®ç‚¹æ•°æ®è¿›è¡Œè¿ç®—ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ç›¸å½“å¤æ‚çš„æµ®ç‚¹æ•°å­¦æŒ‡ä»¤æ¥æ¨¡æ‹Ÿç®€å•çš„æ•´æ•°è¡¨è¾¾å¼ï¼ˆæ¶‰åŠä½è¿ç®—æˆ–é€»è¾‘è¿ç®—ï¼‰ã€‚Direct3D 11ã€OpenGL ES 3ã€Metalå’Œå…¶ä»–ç°ä»£å¹³å°éƒ½å¯¹æ•´æ•°æ•°æ®ç±»å‹æœ‰é€‚å½“çš„æ”¯æŒï¼Œå› æ­¤ä½¿ç”¨ä½ç§»ä½å’Œä½å±è”½å¯ä»¥æŒ‰é¢„æœŸå·¥ä½œã€‚</p><h3 id="å¤åˆçŸ¢é‡çŸ©é˜µç±»å‹">å¤åˆçŸ¢é‡/çŸ©é˜µç±»å‹</h3><p>HLSL å…·æœ‰ä»åŸºæœ¬ç±»å‹åˆ›å»ºçš„å†…ç½®çŸ¢é‡å’ŒçŸ©é˜µç±»å‹ã€‚ä¾‹å¦‚ï¼Œfloat3 æ˜¯ä¸€ä¸ª 3DçŸ¢é‡ï¼Œå…·æœ‰åˆ†é‡ .xã€.y å’Œ .zï¼Œè€Œ half4 æ˜¯ä¸€ä¸ªä¸­ç­‰ç²¾åº¦ 4D çŸ¢é‡ï¼Œå…·æœ‰åˆ†é‡.xã€.yã€.z å’Œ .wã€‚æˆ–è€…ï¼Œå¯ä½¿ç”¨ .rã€.gã€.b å’Œ .aåˆ†é‡æ¥å¯¹çŸ¢é‡ç¼–åˆ¶ç´¢å¼•ï¼Œè¿™åœ¨å¤„ç†é¢œè‰²æ—¶å¾ˆæœ‰ç”¨ã€‚</p><p>çŸ©é˜µç±»å‹ä»¥ç±»ä¼¼çš„æ–¹å¼æ„å»ºï¼›ä¾‹å¦‚ float4x4 æ˜¯ä¸€ä¸ª 4x4å˜æ¢çŸ©é˜µã€‚<strong>è¯·æ³¨æ„ï¼ŒæŸäº›å¹³å°ä»…æ”¯æŒæ–¹å½¢çŸ©é˜µï¼Œæœ€ä¸»è¦çš„æ˜¯ OpenGL ES2.0</strong>ã€‚</p><h3 id="çº¹ç†é‡‡æ ·å™¨ç±»å‹">çº¹ç†/é‡‡æ ·å™¨ç±»å‹</h3><p>é€šå¸¸æŒ‰ç…§å¦‚ä¸‹æ–¹å¼åœ¨ HLSL ä»£ç ä¸­å£°æ˜çº¹ç†ï¼š</p><pre><code>sampler2D _MainTex;samplerCUBE _Cubemap;</code></pre><p>å¯¹äºç§»åŠ¨å¹³å°ï¼Œè¿™äº›å°†è½¬æ¢ä¸ºâ€œä½ç²¾åº¦é‡‡æ ·å™¨â€ï¼Œå³é¢„æœŸçº¹ç†åº”å…·æœ‰ä½ç²¾åº¦æ•°æ®ã€‚å¦‚æœæ‚¨çŸ¥é“çº¹ç†åŒ…å«HDR é¢œè‰²ï¼Œåˆ™å¯èƒ½éœ€è¦ä½¿ç”¨åŠç²¾åº¦é‡‡æ ·å™¨ï¼š</p><pre><code>sampler2D_half _MainTex;samplerCUBE_half _Cubemap;</code></pre><p>æˆ–è€…ï¼Œå¦‚æœçº¹ç†åŒ…å«å®Œæ•´æµ®ç‚¹ç²¾åº¦æ•°æ®ï¼ˆä¾‹å¦‚<code>æ·±åº¦çº¹ç†</code>ï¼‰ï¼Œè¯·ä½¿ç”¨å®Œæ•´ç²¾åº¦é‡‡æ ·å™¨ï¼š</p><pre><code>sampler2D_float _MainTex;samplerCUBE_float _Cubemap;</code></pre><h3 id="ç²¾åº¦ç¡¬ä»¶æ”¯æŒå’Œæ€§èƒ½">ç²¾åº¦ã€ç¡¬ä»¶æ”¯æŒå’Œæ€§èƒ½</h3><p>ä½¿ç”¨ <code>float/half/fixed</code> æ•°æ®ç±»å‹çš„ä¸€ä¸ªéš¾é¢˜æ˜¯ï¼š<strong>PCGPU å§‹ç»ˆä¸ºé«˜ç²¾åº¦</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºæ‰€æœ‰ PC (Windows/Mac/Linux)GPUï¼Œåœ¨ç€è‰²å™¨ä¸­ç¼–å†™ floatã€half è¿˜æ˜¯ fixed æ•°æ®ç±»å‹éƒ½æ— å…³ç´§è¦ã€‚è¿™äº› GPUå°†å§‹ç»ˆä»¥ 32 ä½æµ®ç‚¹ç²¾åº¦æ¥è®¡ç®—æ‰€æœ‰æ•°æ®ã€‚</p><p>ä»…å½“ç›®æ ‡å¹³å°æ˜¯ç§»åŠ¨ç«¯ GPU æ—¶ï¼Œhalf å’Œ fixedç±»å‹æ‰å˜å¾—é‡è¦ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™äº›ç±»å‹ä¸»è¦é¢ä¸´åŠŸè€—ï¼ˆæœ‰æ—¶å€™æ˜¯æ€§èƒ½ï¼‰çº¦æŸã€‚<strong>è¯·è®°ä½ï¼Œè¦ç¡®è®¤æ˜¯å¦é‡åˆ°ç²¾åº¦/æ•°å€¼é—®é¢˜ï¼Œå¿…é¡»åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæµ‹è¯•ç€è‰²å™¨</strong>ã€‚</p><p>å³ä½¿åœ¨ç§»åŠ¨ç«¯ GPU ä¸Šï¼Œä¸åŒçš„ç²¾åº¦æ”¯æŒä¹Ÿä¼šå›  GPUäº§å“ç³»åˆ—è€Œå¼‚ã€‚ä¸‹é¢æ¦‚è¿°äº†ä¸ª<strong>æ¯ä¸ªç§»åŠ¨ç«¯ GPUäº§å“ç³»åˆ—</strong>å¦‚ä½•å¤„ç†æ¯ä¸ªæµ®ç‚¹ç±»å‹ï¼ˆä»¥ç”¨äºè¯¥äº§å“ç³»åˆ—çš„ä½æ•°æ¥è¡¨ç¤ºï¼‰ï¼š</p><h2 id="ä½¿ç”¨é‡‡æ ·å™¨çŠ¶æ€">ä½¿ç”¨é‡‡æ ·å™¨çŠ¶æ€</h2><h3 id="è€¦åˆçš„çº¹ç†å’Œé‡‡æ ·å™¨">è€¦åˆçš„çº¹ç†å’Œé‡‡æ ·å™¨</h3><p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåœ¨ç€è‰²å™¨é‡‡æ ·çº¹ç†æ—¶ï¼Œçº¹ç†é‡‡æ ·çŠ¶æ€æ¥è‡ªçº¹ç†è®¾ç½®ï¼›æœ¬è´¨ä¸Šã€‚çº¹ç†å’Œé‡‡æ ·å™¨è€¦åˆåœ¨ä¸€èµ·ã€‚ä½¿ç”¨ DX9 é£æ ¼çš„ç€è‰²å™¨è¯­æ³•æ—¶ï¼Œè¿™æ˜¯é»˜è®¤è¡Œä¸ºï¼š</p><pre><code>sampler2D _MainTex;// ...half4 color = tex2D(_MainTex, uv);</code></pre><p>ä½¿ç”¨ HLSL å…³é”®å­— sampler2Dã€sampler3D å’Œ samplerCUBEå¯å£°æ˜çº¹ç†å’Œé‡‡æ ·å™¨ã€‚ å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¿™æ˜¯æ‚¨æƒ³è¦çš„ç»“æœï¼Œè€Œä¸”åœ¨è¾ƒæ—§çš„å›¾å½¢API (OpenGL ES) ä¸­ï¼Œè¿™æ˜¯å”¯ä¸€å—æ”¯æŒçš„é€‰é¡¹ã€‚</p><h3 id="å•ç‹¬çš„çº¹ç†å’Œé‡‡æ ·å™¨">å•ç‹¬çš„çº¹ç†å’Œé‡‡æ ·å™¨</h3><p>å¾ˆå¤šå›¾å½¢ API å’Œ GPUéƒ½å…è®¸ä½¿ç”¨çš„é‡‡æ ·å™¨æ•°é‡å°‘äºçº¹ç†ï¼Œè€Œè€¦åˆçš„çº¹ç†+é‡‡æ ·å™¨è¯­æ³•å¯èƒ½ä¸å…è®¸ç¼–å†™æ›´å¤æ‚çš„ç€è‰²å™¨ã€‚ä¾‹å¦‚ï¼ŒDirect3D11 å…è®¸åœ¨å•ä¸ªç€è‰²å™¨ä¸­æœ€å¤šä½¿ç”¨ 128 ä¸ªçº¹ç†ï¼Œä½†æœ€å¤šä»…å…è®¸ä½¿ç”¨ 16 ä¸ªé‡‡æ ·å™¨ã€‚Unity å…è®¸ä½¿ç”¨ DX11 é£æ ¼çš„ HLSLè¯­æ³•æ¥å£°æ˜çº¹ç†å’Œé‡‡æ ·å™¨ï¼Œä½†éœ€è¦é€šè¿‡ä¸€ä¸ªç‰¹æ®Šçš„å‘½åçº¦å®šæ¥è®©å®ƒä»¬åŒ¹é…ï¼šåç§°ä¸ºâ€œsamplerâ€+TextureNameæ ¼å¼çš„é‡‡æ ·å™¨å°†ä»è¯¥çº¹ç†ä¸­è·å–é‡‡æ ·çŠ¶æ€ã€‚ ä»¥ä¸Šéƒ¨åˆ†ä¸­çš„ç€è‰²å™¨ä»£ç ç‰‡æ®µå¯ä»¥ç”¨DX11 é£æ ¼çš„ HLSL è¯­æ³•é‡å†™ï¼Œå¹¶ä¸”ä¹Ÿä¼šæ‰§è¡Œç›¸åŒçš„æ“ä½œï¼š</p><pre><code>Texture2D _MainTex;SamplerState sampler_MainTex; //"sampler"+"_MainTex"// ...half4 color = _MainTex.Sample(sampler_MainTex, uv);</code></pre><p>ä½†è¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥ç¼–å†™ç€è‰²å™¨æ¥é‡å¤ä½¿ç”¨å…¶ä»–çº¹ç†ä¸­çš„é‡‡æ ·å™¨ï¼ŒåŒæ—¶é‡‡æ ·å¤šä¸ªçº¹ç†ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œé‡‡æ ·äº†ä¸‰ä¸ªçº¹ç†ï¼Œä½†ä»…ä¸€ä¸ªé‡‡æ ·å™¨ç”¨äºæ‰€æœ‰è¿™äº›çº¹ç†ï¼š</p><pre><code>Texture2D _MainTex;Texture2D _SecondTex;Texture2D _ThirdTex;SamplerState sampler_MainTex; //"sampler"+"_MainTex"// ...half4 color = _MainTex.Sample(sampler_MainTex, uv);color += _SecondTex.Sample(sampler_MainTex, uv);color += _ThirdTex.Sample(sampler_MainTex, uv);</code></pre><p>ä½†æ˜¯è¯·æ³¨æ„ï¼ŒDX11 é£æ ¼çš„ HLSL è¯­æ³•åœ¨æŸäº›è¾ƒæ—§çš„å¹³å°ï¼ˆä¾‹å¦‚ï¼ŒOpenGL ES2.0ï¼‰ä¸Šæ— æ•ˆï¼Œè¯·å‚é˜…ç€è‰²è¯­è¨€ä»¥äº†è§£è¯¦ç»†ä¿¡æ¯ã€‚æ‚¨å¯èƒ½å¸Œæœ›æŒ‡å®š #pragma target3.5ï¼ˆè¯·å‚é˜…ç€è‰²å™¨ç¼–è¯‘ç›®æ ‡ï¼‰ä»¥é¿å…è¾ƒæ—§çš„å¹³å°ä½¿ç”¨ç€è‰²å™¨ã€‚ Unityæä¾›äº†ä¸€äº›ç€è‰²å™¨å®å¸®åŠ©æ‚¨ä½¿ç”¨è¿™ç§â€œå•ç‹¬é‡‡æ ·å™¨â€æ–¹æ³•æ¥å£°æ˜å’Œé‡‡æ ·çº¹ç†ï¼Œè¯·å‚é˜…å†…ç½®å®ã€‚ä»¥ä¸Šç¤ºä¾‹å¯ä»¥é‡‡ç”¨æ‰€è¿°çš„å®é‡å†™ä¸ºä¸‹åˆ—å½¢å¼ï¼š</p><pre><code>UNITY_DECLARE_TEX2D(_MainTex);UNITY_DECLARE_TEX2D_NOSAMPLER(_SecondTex);UNITY_DECLARE_TEX2D_NOSAMPLER(_ThirdTex);// ...half4 color = UNITY_SAMPLE_TEX2D(_MainTex, uv);color += UNITY_SAMPLE_TEX2D_SAMPLER(_SecondTex, _MainTex, uv);color += UNITY_SAMPLE_TEX2D_SAMPLER(_ThirdTex, _MainTex, uv);</code></pre><p><strong>ä»¥ä¸Šä»£ç å°†åœ¨ Unity æ”¯æŒçš„æ‰€æœ‰å¹³å°ä¸Šè¿›è¡Œç¼–è¯‘ï¼Œä½†ä¼šåœ¨ DX9ç­‰æ—§å¹³å°ä¸Šå›é€€åˆ°ä½¿ç”¨ä¸‰ä¸ªé‡‡æ ·å™¨ã€‚</strong></p><h3 id="å†…è”é‡‡æ ·å™¨çŠ¶æ€">å†…è”é‡‡æ ·å™¨çŠ¶æ€</h3><p>é™¤äº†èƒ½è¯†åˆ«åä¸ºâ€œsamplerâ€+TextureName çš„ HLSL SamplerState å¯¹è±¡ï¼ŒUnityè¿˜èƒ½è¯†åˆ«é‡‡æ ·å™¨åç§°ä¸­çš„æŸäº›å…¶ä»–æ¨¡å¼ã€‚è¿™å¯¹äºç›´æ¥åœ¨ç€è‰²å™¨ä¸­å£°æ˜ç®€å•ç¡¬ç¼–ç é‡‡æ ·çŠ¶æ€å¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼š</p><pre><code>Texture2D _MainTex;SamplerState my_point_clamp_sampler;// ...half4 color = _MainTex.Sample(my_point_clamp_sampler, uv);</code></pre><p>åç§°â€œmy_point_clamp_samplerâ€å°†è¢«è¯†åˆ«ä¸ºåº”è¯¥ä½¿ç”¨ç‚¹ï¼ˆè·ç¦»æœ€è¿‘ï¼‰çº¹ç†è¿‡æ»¤å’Œé’³åˆ¶çº¹ç†åŒ…è£¹æ¨¡å¼çš„é‡‡æ ·å™¨ã€‚</p><p>é‡‡æ ·å™¨åç§°è¢«è¯†åˆ«ä¸ºâ€œå†…è”â€é‡‡æ ·å™¨çŠ¶æ€ï¼ˆå…¨éƒ½ä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼š</p><ul><li><p>â€œPointâ€ã€â€œLinearâ€æˆ–â€œTrilinearâ€ï¼ˆå¿…éœ€ï¼‰è®¾ç½®çº¹ç†è¿‡æ»¤æ¨¡å¼ã€‚</p></li><li><p>â€œClampâ€ã€â€œRepeatâ€ã€â€œMirrorâ€æˆ–â€œMirrorOnceâ€ï¼ˆå¿…éœ€ï¼‰è®¾ç½®çº¹ç†åŒ…è£¹æ¨¡å¼ã€‚</p></li><li><p>å¯æ ¹æ®æ¯ä¸ªè½´ (UVW)æ¥æŒ‡å®šåŒ…è£¹æ¨¡å¼ï¼Œä¾‹å¦‚"ClampU_RepeatV"ã€‚</p></li><li><p>â€œCompareâ€ï¼ˆå¯é€‰ï¼‰è®¾ç½®ç”¨äºæ·±åº¦æ¯”è¾ƒçš„é‡‡æ ·å™¨ï¼›ä¸ HLSLSamplerComparisonState ç±»å‹å’Œ SampleCmp/SampleCmpLevelZeroå‡½æ•°é…åˆä½¿ç”¨ã€‚</p></li></ul><p>ä»¥ä¸‹æ˜¯åˆ†åˆ«ä½¿ç”¨ sampler_linear_repeat å’Œ sampler_point_repeaté‡‡æ ·å™¨çŠ¶æ€è¿›è¡Œçº¹ç†é‡‡æ ·çš„ç¤ºä¾‹ï¼Œè¯´æ˜äº†å¦‚ä½•é€šè¿‡åç§°æ§åˆ¶è¿‡æ»¤æ¨¡å¼ï¼š</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/shader/5.nei-zhi-zhao-se-qi-de-include-wen-jian/"/>
      <url>/2022/08/10/unity/shader/5.nei-zhi-zhao-se-qi-de-include-wen-jian/</url>
      
        <content type="html"><![CDATA[<h1 id="unityå†…ç½®çš„åŒ…å«æ–‡ä»¶">Unityå†…ç½®çš„åŒ…å«æ–‡ä»¶</h1><blockquote><p>appdata_full?</p></blockquote><p>é€šè¿‡åœ¨ <code>Cg/HLSL</code>ä»£ç å—ä¸­ï¼Œä½¿ç”¨<code>#include</code>æŒ‡ä»¤æ¥å®ŒæˆåŒ…å«ã€‚</p><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>CGPROGRAM</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">"UnityCG.cginc"</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>ENDCG</span></code></pre></div><p>Unity ä¸­ç€è‰²å™¨<code>include æ–‡ä»¶</code> é‡‡ç”¨ <code>.cginc</code>æ‹“å±•åï¼Œ å†…ç½®çš„ç€è‰²å™¨ includeæ–‡ä»¶åŒ…æ‹¬ï¼š</p><ul><li>HLSLSupport.cginc -_ï¼ˆè‡ªåŠ¨åŒ…å«ï¼‰_ç”¨äºè·¨å¹³å°ç€è‰²å™¨ç¼–è¯‘çš„ helperå®å’Œå®šä¹‰ã€‚</li><li>UnityShaderVariables.cginc -_ï¼ˆè‡ªåŠ¨åŒ…å«ï¼‰_å¸¸ç”¨çš„å…¨å±€å˜é‡ã€‚</li><li>UnityCG.cginc - å¸¸ç”¨çš„ helper å‡½æ•°ã€‚</li><li>AutoLight.cginc -å…‰ç…§å’Œé˜´å½±åŠŸèƒ½ï¼Œä¾‹å¦‚è¡¨é¢ç€è‰²å™¨åœ¨å†…éƒ¨ä½¿ç”¨æ­¤æ–‡ä»¶ã€‚</li><li>Lighting.cginc -æ ‡å‡†è¡¨é¢ç€è‰²å™¨å…‰ç…§æ¨¡å‹ï¼›å½“æ‚¨ç¼–å†™è¡¨é¢ç€è‰²å™¨æ—¶ä¼šè‡ªåŠ¨åŒ…å«ã€‚</li><li>TerrainEngine.cginc - åœ°å½¢å’Œæ¤è¢«ç€è‰²å™¨çš„ helper å‡½æ•°ã€‚</li></ul><h2 id="hlslsupport.cginc">HLSLSupport.cginc</h2><p>ç¼–è¯‘ CGPROGRAM ç€è‰²å™¨æ—¶ä¼šè‡ªåŠ¨åŒ…å«æ­¤æ–‡ä»¶ï¼ˆä½†ä¸ä¼šå¯¹ HLSLPROGRAMç€è‰²å™¨åŒ…å«æ­¤æ–‡ä»¶ï¼‰ã€‚æ­¤æ–‡ä»¶å£°æ˜å„ç§é¢„å¤„ç†å™¨å®ä»¥å¸®åŠ©è¿›è¡Œå¤šå¹³å°ç€è‰²å™¨å¼€å‘ã€‚</p><h2 id="unityshadervariables.cginc">UnityShaderVariables.cginc</h2><p>ç¼–è¯‘ CGPROGRAM ç€è‰²å™¨æ—¶ä¼šè‡ªåŠ¨åŒ…å«æ­¤æ–‡ä»¶ï¼ˆä½†ä¸ä¼šå¯¹ HLSLPROGRAMç€è‰²å™¨åŒ…å«æ­¤æ–‡ä»¶ï¼‰ã€‚æ­¤æ–‡ä»¶å£°æ˜ç€è‰²å™¨ä¸­å¸¸ç”¨çš„å„ç§å†…ç½®å…¨å±€å˜é‡ã€‚</p><h2 id="unitycg.cginc">UnityCG.cginc</h2><p>Unity ç€è‰²å™¨ä¸­é€šå¸¸ä¼šåŒ…å«æ­¤æ–‡ä»¶ã€‚æ­¤æ–‡ä»¶å£°æ˜å¤§é‡å†…ç½® helperå‡½æ•°å’Œæ•°æ®ç»“æ„ã€‚</p><h3 id="unitycg.cginc-ä¸­çš„æ•°æ®ç»“æ„">UnityCG.cginc ä¸­çš„æ•°æ®ç»“æ„</h3><ul><li>structappdata_baseï¼šé¡¶ç‚¹ç€è‰²å™¨è¾“å…¥ï¼ŒåŒ…å«ä½ç½®ã€æ³•çº¿å’Œä¸€ä¸ªçº¹ç†åæ ‡ã€‚</li><li>structappdata_tanï¼šé¡¶ç‚¹ç€è‰²å™¨è¾“å…¥ï¼ŒåŒ…å«ä½ç½®ã€æ³•çº¿ã€åˆ‡çº¿å’Œä¸€ä¸ªçº¹ç†åæ ‡ã€‚</li><li>structappdata_fullï¼šé¡¶ç‚¹ç€è‰²å™¨è¾“å…¥ï¼ŒåŒ…å«ä½ç½®ã€æ³•çº¿ã€åˆ‡çº¿ã€é¡¶ç‚¹é¢œè‰²å’Œä¸¤ä¸ªçº¹ç†åæ ‡ã€‚</li><li>struct appdata_img: é¡¶ç‚¹ç€è‰²å™¨è¾“å…¥ï¼ŒåŒ…å«ä½ç½®å’Œä¸€ä¸ªçº¹ç†åæ ‡ã€‚</li></ul><h2 id="é¢„å®šä¹‰çš„ç€è‰²å™¨é¢„å¤„ç†å™¨å®">é¢„å®šä¹‰çš„ç€è‰²å™¨é¢„å¤„ç†å™¨å®</h2><p>ç›®æ ‡å¹³å°</p><table><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr class="header"><th style="text-align: left;">å®ï¼š</th><th style="text-align: left;">ç›®æ ‡å¹³å°ï¼š</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">SHADER_API_D3D11</td><td style="text-align: left;">Direct3D 11</td></tr><tr class="even"><td style="text-align: left;">SHADER_API_GLCORE</td><td style="text-align: left;">æ¡Œé¢ç«¯ OpenGLâ€œæ ¸å¿ƒâ€(GL 3/4)</td></tr><tr class="odd"><td style="text-align: left;">SHADER_API_GLES</td><td style="text-align: left;">OpenGL ES 2.0</td></tr><tr class="even"><td style="text-align: left;">SHADER_API_GLES3</td><td style="text-align: left;">OpenGL ES 3.0/3.1</td></tr><tr class="odd"><td style="text-align: left;">SHADER_API_METAL</td><td style="text-align: left;">iOS/Mac Metal</td></tr><tr class="even"><td style="text-align: left;">SHADER_API_VULKAN</td><td style="text-align: left;">Vulkan</td></tr><tr class="odd"><td style="text-align: left;">SHADER_API_D3D11_9X</td><td style="text-align: left;">é€‚ç”¨äºé€šç”¨ Windows å¹³å°çš„ Direct3D11â€œåŠŸèƒ½çº§åˆ« 9.xâ€ç›®æ ‡</td></tr><tr class="even"><td style="text-align: left;">SHADER_API_PS4</td><td style="text-align: left;">PlayStation 4ã€‚ä¹Ÿå®šä¹‰äº†SHADER_API_PSSLã€‚</td></tr><tr class="odd"><td style="text-align: left;">SHADER_API_XBOXONE</td><td style="text-align: left;">Xbox One</td></tr></tbody></table><p><strong>SHADER_API_MOBILE</strong>æ˜¯é’ˆå¯¹æ‰€æœ‰å¸¸è§„ç§»åŠ¨å¹³å°ï¼ˆGLESã€GLES3ã€METALï¼‰å®šä¹‰çš„ã€‚</p><p>æ­¤å¤–ï¼Œå½“ç›®æ ‡ç€è‰²è¯­è¨€ä¸º GLSL æ—¶ï¼Œè¿˜ä¼šå®šä¹‰ SHADER_TARGET_GLSLï¼ˆå¯¹äºOpenGL/GLES å¹³å°æ¥è¯´å§‹ç»ˆä¼šå®šä¹‰ï¼‰ã€‚</p><h3 id="ç€è‰²å™¨ç›®æ ‡æ¨¡å‹">ç€è‰²å™¨ç›®æ ‡æ¨¡å‹</h3><p>SHADER_TARGET è¢«å®šä¹‰ä¸ºä¸ç€è‰²å™¨ç›®æ ‡ç¼–è¯‘æ¨¡å‹åŒ¹é…çš„æ•°å€¼ï¼ˆå³åŒ¹é… #pragmatarget æŒ‡ä»¤ï¼‰ã€‚ä¾‹å¦‚ï¼Œå½“ç¼–è¯‘åˆ°ç€è‰²å™¨æ¨¡å‹ 3.0 æ—¶ï¼ŒSHADER_TARGET ä¸º30ã€‚æ‚¨å¯ä»¥åœ¨ç€è‰²å™¨ä»£ç ä¸­ä½¿ç”¨æ­¤å®æ¥è¿›è¡Œæ¡ä»¶æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼š</p><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp"># if SHADER_TARGET &lt; 30</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ä½äºç€è‰²å™¨æ¨¡å‹ 3.0ï¼š</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ç€è‰²å™¨åŠŸèƒ½éå¸¸æœ‰é™ï¼Œæ‰§è¡Œè¿‘ä¼¼æ“ä½œ</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="pp"># else</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ä¸é”™çš„åŠŸèƒ½ï¼Œæ‰§è¡Œæ›´é«˜çº§çš„ä»»åŠ¡</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="pp"># endif</span></span></code></pre></div><h3 id="unity-ç‰ˆæœ¬">Unity ç‰ˆæœ¬</h3><p>UNITY_VERSION åŒ…å« Unity ç‰ˆæœ¬çš„æ•°å€¼ã€‚ä¾‹å¦‚ï¼Œå¯¹äº Unity5.0.1ï¼ŒUNITY_VERSION ä¸º501ã€‚å¦‚æœæ‚¨éœ€è¦ç¼–å†™ä½¿ç”¨ä¸åŒç€è‰²å™¨å†…ç½®åŠŸèƒ½çš„ç€è‰²å™¨ï¼Œåˆ™å¯ä»¥å°†å…¶ç”¨äºç‰ˆæœ¬æ¯”è¾ƒã€‚ä¾‹å¦‚ï¼Œ#ifUNITY_VERSION &gt;= 500 é¢„å¤„ç†å™¨æ£€æŸ¥ä»…åœ¨ç‰ˆæœ¬ä¸º 5.0.0æˆ–æ›´é«˜æ—¶å¯ä»¥é€šè¿‡</p><h3 id="ç¼–è¯‘çš„ç€è‰²å™¨é˜¶æ®µ">ç¼–è¯‘çš„ç€è‰²å™¨é˜¶æ®µ</h3><p>ç¼–è¯‘æ¯ä¸ªç€è‰²å™¨é˜¶æ®µæ—¶ä¼šå®šä¹‰é¢„å¤„ç†å™¨å®SHADER_STAGE_VERTEXã€SHADER_STAGE_FRAGMENTã€SHADER_STAGE_DOMAINã€SHADER_STAGE_HULLã€SHADER_STAGE_GEOMETRYæˆ–SHADER_STAGE_COMPUTEã€‚<strong>é€šå¸¸ï¼Œåœ¨åƒç´ ç€è‰²å™¨å’Œè®¡ç®—ç€è‰²å™¨ä¹‹é—´å…±äº«ç€è‰²å™¨ä»£ç æ—¶ï¼Œè¿™äº›å®éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥è§£å†³æŸäº›å·¥ä½œå¿…é¡»ä»¥ç•¥æœ‰ä¸åŒçš„æ–¹å¼æ¥å®Œæˆçš„æƒ…å†µ</strong>ã€‚</p><h3 id="å¹³å°å·®å¼‚-helper">å¹³å°å·®å¼‚ helper</h3><p><strong>ä¸é¼“åŠ±ç›´æ¥ä½¿ç”¨è¿™äº›å¹³å°å®ï¼Œå› ä¸ºå®ƒä»¬å¹¶éå§‹ç»ˆæœ‰åŠ©äºä»£ç çš„æœªæ¥éªŒè¯</strong>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨ç¼–å†™ä¸€ä¸ªæ£€æŸ¥D3D11 çš„ç€è‰²å™¨ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ç¡®ä¿åœ¨å°†æ¥å°†è¿™é¡¹æ£€æŸ¥æ‰©å±•ä¸ºåŒ…å« Vulkanã€‚åº”æ”¹ç”¨Unity å®šä¹‰çš„å‡ ä¸ª helper å®ï¼ˆåœ¨ HLSLSupport.cginc ä¸­ï¼‰ï¼š</p><table><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr class="header"><th style="text-align: left;">å®ï¼š</th><th style="text-align: left;">ç”¨é€”ï¼š</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">UNITY_BRANCH</td><td style="text-align: left;">åœ¨æ¡ä»¶è¯­å¥ä¹‹å‰æ·»åŠ æ­¤å®ï¼Œå‘ŠçŸ¥ç¼–è¯‘å™¨åº”å°†å…¶ç¼–è¯‘ä¸ºå®é™…åˆ†æ”¯ã€‚åœ¨HLSL å¹³å°ä¸Šæ‰©å±•ä¸º [branch]ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_FLATTEN</td><td style="text-align: left;">åœ¨æ¡ä»¶è¯­å¥ä¹‹å‰æ·»åŠ æ­¤å®ï¼Œå‘ŠçŸ¥ç¼–è¯‘å™¨åº”è¯¥å°†å…¶å±•å¹³ä»¥é¿å…å®é™…çš„åˆ†æ”¯æŒ‡ä»¤ã€‚åœ¨HLSL å¹³å°ä¸Šæ‰©å±•ä¸º [flatten]ã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_NO_SCREENSPACE_SHADOWS</td><td style="text-align: left;">åœ¨ä¸ä½¿ç”¨çº§è”å±å¹•ç©ºé—´é˜´å½±è´´å›¾çš„å¹³å°ï¼ˆç§»åŠ¨å¹³å°ï¼‰ä¸Šå®šä¹‰ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_NO_LINEAR_COLORSPACE</td><td style="text-align: left;">åœ¨ä¸æ”¯æŒçº¿æ€§é¢œè‰²ç©ºé—´çš„å¹³å°ï¼ˆç§»åŠ¨å¹³å°ï¼‰ä¸Šå®šä¹‰ã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_NO_RGBM</td><td style="text-align: left;">åœ¨ä¸ä½¿ç”¨å…‰ç…§è´´å›¾ RGBMå‹ç¼©çš„å¹³å°ï¼ˆç§»åŠ¨å¹³å°ï¼‰ä¸Šå®šä¹‰ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_NO_DXT5nm</td><td style="text-align: left;">åœ¨ä¸ä½¿ç”¨ DXT5nmæ³•çº¿è´´å›¾å‹ç¼©çš„å¹³å°ï¼ˆç§»åŠ¨å¹³å°ï¼‰ä¸Šå®šä¹‰ã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_FRAMEBUFFER_FETCH_AVAILABLE</td><td style="text-align: left;">åœ¨å¯ä½¿ç”¨â€œå¸§ç¼“å†²é¢œè‰²æå–â€åŠŸèƒ½çš„å¹³å°ï¼ˆé€šå¸¸ä¸ºiOS å¹³å° - OpenGL ES 2.0ã€3.0 å’Œ Metalï¼‰ä¸Šå®šä¹‰ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_USE_RGBA_FOR_POINT_SHADOWS</td><td style="text-align: left;">åœ¨ç‚¹å…‰æºé˜´å½±è´´å›¾ä½¿ç”¨å…·æœ‰ç¼–ç æ·±åº¦çš„ RGBAçº¹ç†çš„å¹³å°ï¼ˆå…¶ä»–å¹³å°ä½¿ç”¨å•é€šé“æµ®ç‚¹çº¹ç†ï¼‰ä¸Šå®šä¹‰ã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_ATTEN_CHANNEL</td><td style="text-align: left;">å®šä¹‰å…‰æºè¡°å‡çº¹ç†çš„å“ªä¸ªé€šé“åŒ…å«æ•°æ®ï¼›ç”¨äºæ¯åƒç´ å…‰ç…§ä»£ç ã€‚å®šä¹‰ä¸ºâ€œrâ€æˆ–â€œaâ€ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_HALF_TEXEL_OFFSET</td><td style="text-align: left;">åœ¨å°†çº¹ç†åƒç´ æ˜ å°„åˆ°åƒç´ æ—¶éœ€è¦è¿›è¡ŒåŠçº¹ç´ åç§»è°ƒæ•´çš„å¹³å°ï¼ˆä¾‹å¦‚Direct3D 9ï¼‰ä¸Šå®šä¹‰ã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_UV_STARTS_AT_TOP</td><td style="text-align: left;">å§‹ç»ˆå®šä¹‰å€¼ä¸º 1 æˆ– 0ã€‚å€¼ä¸º 1è¡¨ç¤ºåœ¨å¹³å°ä¸Šçš„çº¹ç†ä¹‹ä¸Šçš„çº¹ç† V åæ ‡ä¸º 0ã€‚Direct3D ç±»å¹³å°ä½¿ç”¨å€¼ 1ï¼›OpenGLç±»å¹³å°ä½¿ç”¨å€¼ 0ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_MIGHT_NOT_HAVE_DEPTH_Texture</td><td style="text-align: left;">å¦‚æœå¹³å°å¯ä»¥é€šè¿‡æ‰‹åŠ¨å°†æ·±åº¦æ¸²æŸ“åˆ°çº¹ç†ä¸­æ¥æ¨¡æ‹Ÿé˜´å½±è´´å›¾æˆ–æ·±åº¦çº¹ç†ï¼Œåˆ™å®šä¹‰æ­¤å®ã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_PROJ_COORD(a)</td><td style="text-align: left;">ç»™å®šä¸€ä¸ª 4åˆ†é‡çŸ¢é‡ï¼Œæ­¤å®è¿”å›ä¸€ä¸ªé€‚åˆæŠ•å½±çº¹ç†è¯»å–çš„çº¹ç†åæ ‡ã€‚åœ¨å¤§å¤šæ•°å¹³å°ä¸Šï¼Œå®ƒç›´æ¥è¿”å›ç»™å®šå€¼ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_NEAR_CLIP_VALUE</td><td style="text-align: left;">å®šä¹‰ä¸ºè¿‘è£å‰ªé¢çš„å€¼ã€‚Direct3D ç±»å¹³å°ä½¿ç”¨0.0ï¼Œè€Œ OpenGL ç±»å¹³å°ä½¿ç”¨ â€“1.0ã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_VPOS_TYPE</td><td style="text-align: left;">å®šä¹‰åƒç´ ä½ç½®è¾“å…¥ (VPOS)æ‰€éœ€çš„æ•°æ®ç±»å‹ï¼šD3D9 ä¸Šä¸º float2ï¼Œå…¶ä»–ä¸º float4ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_CAN_COMPILE_TESSELLATION</td><td style="text-align: left;">åœ¨ç€è‰²å™¨ç¼–è¯‘å™¨â€œç†è§£â€æ›²é¢ç»†åˆ†ç€è‰²å™¨ HLSLè¯­æ³•æ—¶å®šä¹‰ï¼ˆå½“å‰ä»…é™ D3D11ï¼‰ã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_INITIALIZE_OUTPUT(type,name)</td><td style="text-align: left;">å°†ç»™å®š_ç±»å‹_çš„å˜é‡_åç§°_åˆå§‹åŒ–ä¸ºé›¶ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_COMPILER_HLSL,UNITY_COMPILER_HLSL2GLSL, UNITY_COMPILER_CG</td><td style="text-align: left;">æŒ‡ç¤ºæ­£åœ¨ä½¿ç”¨å“ªä¸ªç€è‰²å™¨ç¼–è¯‘å™¨æ¥ç¼–è¯‘ç€è‰²å™¨ -åˆ†åˆ«ä¸ºï¼šMicrosoft çš„ HLSLã€HLSL åˆ° GLSL è½¬æ¢å™¨å’Œ NVIDIA çš„</td></tr></tbody></table><p>UNITY_REVERSED_Z - åœ¨ä½¿ç”¨åè½¬ Z ç¼“å†²åŒºçš„å¹³å°ä¸Šå®šä¹‰ã€‚å­˜å‚¨çš„ Zå€¼çš„èŒƒå›´æ˜¯ 1 åˆ° 0ï¼Œè€Œä¸æ˜¯ 0 åˆ° 1ã€‚</p><h3 id="é˜´å½±è´´å›¾å®">é˜´å½±è´´å›¾å®</h3><p>æ ¹æ®å¹³å°çš„ä¸åŒï¼Œå£°æ˜å’Œé‡‡æ ·é˜´å½±è´´å›¾å¯èƒ½ä¼šæœ‰å¾ˆå¤§å·®å¼‚ã€‚Unityæœ‰å‡ ä¸ªå®å¯å¸®åŠ©è§£å†³è¿™ä¸ªé—®é¢˜ï¼š |å®ï¼š |ç”¨é€”ï¼š | |:-- |:-- ||UNITY_DECLARE_SHADOWMAP(tex)| å£°æ˜ä¸€ä¸ªåä¸ºâ€œtexâ€çš„é˜´å½±è´´å›¾çº¹ç†å˜é‡ã€‚ ||UNITY_SAMPLE_SHADOW(tex,uv)|åœ¨ç»™å®šçš„â€œuvâ€åæ ‡å¤„é‡‡æ ·é˜´å½±è´´å›¾çº¹ç†â€œtexâ€ï¼ˆXY åˆ†é‡æ˜¯çº¹ç†ä½ç½®ï¼ŒZåˆ†é‡æ˜¯è¦æ¯”è¾ƒçš„æ·±åº¦ï¼‰ã€‚è¿”å›å•ä¸ªæµ®ç‚¹å€¼ï¼Œé˜´å½±é¡¹çš„èŒƒå›´åœ¨ 0 åˆ° 1 ä¹‹é—´ã€‚ ||UNITY_SAMPLE_SHADOW_PROJ(tex,uv)|ä¸ä¸Šé¢ç±»ä¼¼ï¼Œä½†æ˜¯ä¼šè¯»å–æŠ•å½±é˜´å½±è´´å›¾ã€‚â€œuvâ€æ˜¯ä¸€ä¸ª float4ï¼Œæ‰€æœ‰å…¶ä»–åˆ†é‡é™¤ä»¥.w æ¥æ‰§è¡ŒæŸ¥æ‰¾ã€‚ |</p><p><strong>æ³¨æ„ï¼šå¹¶éæ‰€æœ‰æ˜¾å¡éƒ½æ”¯æŒé˜´å½±è´´å›¾ã€‚è¯·ä½¿ç”¨SystemInfo.SupportsRenderTextureFormat æ£€æŸ¥æ˜¯å¦æ”¯æŒã€‚</strong></p><h3 id="å¸¸é‡ç¼“å†²åŒºå®">å¸¸é‡ç¼“å†²åŒºå®</h3><p>Direct3D 11 å°†æ‰€æœ‰ç€è‰²å™¨å˜é‡åˆ†ç»„ä¸ºâ€œå¸¸é‡ç¼“å†²åŒºâ€ã€‚Unityçš„å¤§å¤šæ•°å†…ç½®å˜é‡å·²ç»åˆ†ç»„ï¼Œä½†å¯¹äºæ‚¨è‡ªå·±çš„ç€è‰²å™¨ä¸­çš„å˜é‡ï¼Œæ›´åŠ ç†æƒ³çš„åšæ³•æ˜¯ï¼Œæ ¹æ®é¢„æœŸçš„æ›´æ–°é¢‘ç‡å°†å®ƒä»¬æ”¾å…¥å•ç‹¬çš„å¸¸é‡ç¼“å†²åŒºã€‚å¯¹æ­¤ï¼Œè¯·ä½¿ç”¨ CBUFFER_START(name) å’Œ CBUFFER_END å®ï¼š</p><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>CBUFFER_START<span class="op">(</span>MyRarelyUpdatedVariables<span class="op">)</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    float4 _SomeGlobalValue<span class="op">;</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>CBUFFER_END</span></code></pre></div><h3 id="çº¹ç†é‡‡æ ·å™¨å£°æ˜å®">çº¹ç†/é‡‡æ ·å™¨å£°æ˜å®</h3><p>é€šå¸¸ï¼Œåœ¨ç€è‰²å™¨ä»£ç ä¸­ä½¿ç”¨ texture2D æ¥å£°æ˜çº¹ç†å’Œé‡‡æ ·å™¨å¯¹ã€‚ä½†æ˜¯åœ¨æŸäº›å¹³å°ï¼ˆä¾‹å¦‚ DX11ï¼‰ä¸Šï¼Œçº¹ç†å’Œé‡‡æ ·å™¨æ˜¯å•ç‹¬çš„æ¸¸æˆå¯¹è±¡ï¼Œå¹¶ä¸”å¯èƒ½çš„é‡‡æ ·å™¨æœ€å¤§æ•°é‡éå¸¸æœ‰é™ã€‚Unity æœ‰ä¸€äº›å®æ¥å£°æ˜æ²¡æœ‰é‡‡æ ·å™¨çš„çº¹ç†ï¼Œå¹¶ä½¿ç”¨å¦ä¸€ä¸ªçº¹ç†ä¸­çš„é‡‡æ ·å™¨å¯¹çº¹ç†è¿›è¡Œé‡‡æ ·ã€‚å¦‚æœæ‚¨é‡åˆ°é‡‡æ ·å™¨é™åˆ¶ï¼Œå¹¶ä¸”çŸ¥é“å‡ ä¸ªçº¹ç†å®é™…ä¸Šå¯ä»¥å…±äº«åŒä¸€ä¸ªé‡‡æ ·å™¨ï¼ˆé‡‡æ ·å™¨å®šä¹‰çº¹ç†è¿‡æ»¤å’ŒåŒ…è£¹æ¨¡å¼ï¼‰ï¼Œè¯·ä½¿ç”¨è¿™äº›å®ã€‚</p><table><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr class="header"><th style="text-align: left;">å®ï¼š</th><th style="text-align: left;">ç”¨é€”ï¼š</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">UNITY_DECLARE_TEX2D(name)</td><td style="text-align: left;">å£°æ˜çº¹ç†å’Œé‡‡æ ·å™¨å¯¹ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_DECLARE_TEX2D_NOSAMPLER(name)</td><td style="text-align: left;">å£°æ˜ä¸å«é‡‡æ ·å™¨çš„çº¹ç†ã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_DECLARE_TEX2DARRAY(name)</td><td style="text-align: left;">å£°æ˜çº¹ç†æ•°ç»„é‡‡æ ·å™¨å˜é‡ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_SAMPLE_TEX2D(name,uv)</td><td style="text-align: left;">ä½¿ç”¨ç»™å®šçš„çº¹ç†åæ ‡ä»çº¹ç†å’Œé‡‡æ ·å™¨å¯¹ä¸­é‡‡æ ·ã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_SAMPLE_TEX2D_SAMPLER(name,samplername,uv)</td><td style="text-align: left;">ä½¿ç”¨å¦ä¸€ä¸ªçº¹ç†ä¸­çš„é‡‡æ ·å™¨(samplername)ï¼Œä»çº¹ç† (name) ä¸­é‡‡æ ·ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_SAMPLE_TEX2DARRAY(name,uv)</td><td style="text-align: left;">ä»å…·æœ‰ float3 UV çš„çº¹ç†æ•°ç»„ä¸­é‡‡æ ·ï¼›åæ ‡çš„z åˆ†é‡æ˜¯æ•°ç»„å…ƒç´ ç´¢å¼•ã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_SAMPLE_TEX2DARRAY_LOD(name,uv,lod)</td><td style="text-align: left;">ä»å…·æœ‰æ˜¾å¼ Mipmapçº§åˆ«çš„çº¹ç†æ•°ç»„ä¸­é‡‡æ ·ã€‚</td></tr></tbody></table><h3 id="è¡¨é¢ç€è‰²å™¨é€šé“æŒ‡ç¤ºç¬¦">è¡¨é¢ç€è‰²å™¨é€šé“æŒ‡ç¤ºç¬¦</h3><p>ç¼–è¯‘è¡¨é¢ç€è‰²å™¨æ—¶ï¼Œè¡¨é¢ç€è‰²å™¨ä¼šä¸ºå„ç§é€šé“ç”Ÿæˆå¤§é‡ä»£ç ä»¥äº§ç”Ÿå…‰ç…§ã€‚ç¼–è¯‘æ¯ä¸ªé€šé“æ—¶ï¼Œå°†å®šä¹‰ä»¥ä¸‹å®ä¹‹ä¸€ï¼š</p><table><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr class="header"><th style="text-align: left;">å®ï¼š</th><th style="text-align: left;">ç”¨é€”ï¼š</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">UNITY_PASS_FORWARDBASE</td><td style="text-align: left;">å‰å‘æ¸²æŸ“åŸºç¡€é€šé“ï¼ˆä¸»æ–¹å‘å…‰ã€å…‰ç…§è´´å›¾å’ŒSHï¼‰ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_PASS_FORWARDADD</td><td style="text-align: left;">å‰å‘æ¸²æŸ“é™„åŠ é€šé“ï¼ˆæ¯ä¸ªé€šé“ä¸€ä¸ªå…‰æºï¼‰ã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_PASS_DEFERRED</td><td style="text-align: left;">å»¶è¿Ÿç€è‰²é€šé“ï¼ˆæ¸²æŸ“ G ç¼“å†²åŒºï¼‰ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_PASS_SHADOWCASTER</td><td style="text-align: left;">é˜´å½±æŠ•å°„ç‰©å’Œæ·±åº¦çº¹ç†æ¸²æŸ“é€šé“ã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_PASS_PREPASSBASE</td><td style="text-align: left;">æ—§ç‰ˆå»¶è¿Ÿå…‰ç…§åŸºç¡€é€šé“ï¼ˆæ¸²æŸ“æ³•çº¿å’Œé•œé¢åå°„æŒ‡æ•°ï¼‰ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_PASS_PREPASSFINAL</td><td style="text-align: left;">æ—§ç‰ˆå»¶è¿Ÿå…‰ç…§æœ€ç»ˆé€šé“ï¼ˆåº”ç”¨å…‰ç…§å’Œçº¹ç†ï¼‰ã€‚</td></tr></tbody></table><h3 id="ç¦ç”¨è‡ªåŠ¨å‡çº§">ç¦ç”¨è‡ªåŠ¨å‡çº§</h3><p>UNITY_SHADER_NO_UPGRADE å…è®¸æ‚¨ç¦æ­¢ Unityè‡ªåŠ¨å‡çº§æˆ–ä¿®æ”¹ç€è‰²å™¨æ–‡ä»¶ã€‚</p><h2 id="å†…ç½®ç€è‰²å™¨-helper-å‡½æ•°">å†…ç½®ç€è‰²å™¨ helper å‡½æ•°</h2><h3 id="é¡¶ç‚¹å˜æ¢å‡½æ•°">é¡¶ç‚¹å˜æ¢å‡½æ•°</h3><table><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr class="header"><th style="text-align: left;">åŠŸèƒ½ï¼š</th><th style="text-align: left;">æè¿°ï¼š</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">float4 UnityObjectToClipPos(float3pos)</td><td style="text-align: left;">å°†å¯¹è±¡ç©ºé—´ä¸­çš„ç‚¹å˜æ¢åˆ°é½æ¬¡åæ ‡ä¸­çš„æ‘„åƒæœºè£å‰ªç©ºé—´ã€‚è¿™ç­‰æ•ˆäºmul(UNITY_MATRIX_MVP, float4(pos, 1.0))ï¼Œåº”è¯¥åœ¨é€‚å½“çš„ä½ç½®ä½¿ç”¨ã€‚</td></tr><tr class="even"><td style="text-align: left;">float3 UnityObjectToViewPos(float3pos)</td><td style="text-align: left;">å°†å¯¹è±¡ç©ºé—´ä¸­çš„ç‚¹å˜æ¢åˆ°è§†å›¾ç©ºé—´ã€‚è¿™ç­‰æ•ˆäº<strong>mul(UNITY_MATRIX_MV, float4(pos,1.0)).xyz</strong>ï¼Œåº”è¯¥åœ¨é€‚å½“çš„ä½ç½®ä½¿ç”¨ã€‚</td></tr></tbody></table><h3 id="unitycg.cginc-ä¸­çš„é€šç”¨-helper-å‡½æ•°">UnityCG.cginc ä¸­çš„é€šç”¨helper å‡½æ•°</h3><table><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr class="header"><th style="text-align: left;">åŠŸèƒ½ï¼š</th><th style="text-align: left;">æè¿°ï¼š</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">float3 WorldSpaceViewDir (float4 v)</td><td style="text-align: left;">è¿”å›ä»ç»™å®šå¯¹è±¡ç©ºé—´é¡¶ç‚¹ä½ç½®æœå‘æ‘„åƒæœºçš„ä¸–ç•Œç©ºé—´æ–¹å‘ï¼ˆ<strong>æœªæ ‡å‡†åŒ–</strong>ï¼‰ã€‚</td></tr><tr class="even"><td style="text-align: left;">float3 ObjSpaceViewDir (float4 v)</td><td style="text-align: left;">è¿”å›ä»ç»™å®šå¯¹è±¡ç©ºé—´é¡¶ç‚¹ä½ç½®æœå‘æ‘„åƒæœºçš„å¯¹è±¡ç©ºé—´æ–¹å‘ï¼ˆ<strong>æœªæ ‡å‡†åŒ–</strong>ï¼‰ã€‚</td></tr><tr class="odd"><td style="text-align: left;">float2 ParallaxOffset (half h, halfheight, half3 viewDir)</td><td style="text-align: left;">è®¡ç®—è§†å·®æ³•çº¿è´´å›¾çš„ UV åç§»ã€‚</td></tr><tr class="even"><td style="text-align: left;">fixed Luminance (fixed3 c)</td><td style="text-align: left;">å°†é¢œè‰²è½¬æ¢ä¸ºäº®åº¦ï¼ˆç°é˜¶ï¼‰ã€‚</td></tr><tr class="odd"><td style="text-align: left;">fixed3 DecodeLightmap (fixed4 color)</td><td style="text-align: left;">ä» Unity å…‰ç…§è´´å›¾ï¼ˆRGBM æˆ–dLDRï¼Œå…·ä½“å–å†³äºå¹³å°ï¼‰è§£ç é¢œè‰²ã€‚</td></tr><tr class="even"><td style="text-align: left;">float4 EncodeFloatRGBA (float v)</td><td style="text-align: left;">å°† [0..1) èŒƒå›´æµ®ç‚¹æ•°ç¼–ç ä¸º RGBAé¢œè‰²ï¼Œç”¨äºå­˜å‚¨åœ¨ä½ç²¾åº¦æ¸²æŸ“ç›®æ ‡ä¸­ã€‚</td></tr><tr class="odd"><td style="text-align: left;">float DecodeFloatRGBA (float4 enc)</td><td style="text-align: left;">å°† RGBA é¢œè‰²è§£ç ä¸ºæµ®ç‚¹æ•°ã€‚</td></tr><tr class="even"><td style="text-align: left;">float2 EncodeFloatRG (float v)</td><td style="text-align: left;">å°† [0..1) èŒƒå›´æµ®ç‚¹æ•°ç¼–ç ä¸º float2ã€‚</td></tr><tr class="odd"><td style="text-align: left;">float DecodeFloatRG (float2 enc)</td><td style="text-align: left;">è§£ç å…ˆå‰ç¼–ç çš„ RG æµ®ç‚¹æ•°ã€‚</td></tr><tr class="even"><td style="text-align: left;">float2 EncodeViewNormalStereo (float3n)</td><td style="text-align: left;">å°†è§†å›¾ç©ºé—´æ³•çº¿ç¼–ç ä¸º 0 åˆ° 1èŒƒå›´å†…çš„ä¸¤ä¸ªæ•°å­—ã€‚</td></tr><tr class="odd"><td style="text-align: left;">float3 DecodeViewNormalStereo (float4enc4)</td><td style="text-align: left;">ä» enc4.xy è§£ç è§†å›¾ç©ºé—´æ³•çº¿ã€‚</td></tr></tbody></table><h3 id="unitycg.cginc-ä¸­çš„å‰å‘æ¸²æŸ“-helper-å‡½æ•°">UnityCG.cgincä¸­çš„å‰å‘æ¸²æŸ“ helper å‡½æ•°</h3><p><strong>ä»…å½“ä½¿ç”¨å‰å‘æ¸²æŸ“ï¼ˆForwardBase æˆ– ForwardAddé€šé“ç±»å‹ï¼‰æ—¶ï¼Œè¿™äº›å‡½æ•°æ‰æœ‰ç”¨ã€‚</strong> |åŠŸèƒ½ï¼š |æè¿°ï¼š | |:-- |:-- ||float3 WorldSpaceLightDir (float4 v)|æ ¹æ®ç»™å®šçš„å¯¹è±¡ç©ºé—´é¡¶ç‚¹ä½ç½®è®¡ç®—æœå‘å…‰æºçš„ä¸–ç•Œç©ºé—´æ–¹å‘ï¼ˆ<strong>æœªæ ‡å‡†åŒ–</strong>ï¼‰ã€‚| |float3 ObjSpaceLightDir (float4 v)|æ ¹æ®ç»™å®šå¯¹è±¡ç©ºé—´é¡¶ç‚¹ä½ç½®è®¡ç®—æœå‘å…‰æºçš„å¯¹è±¡ç©ºé—´æ–¹å‘ï¼ˆ<strong>æœªæ ‡å‡†åŒ–</strong>ï¼‰ã€‚| |float3 Shade4PointLights (...)|è®¡ç®—å››ä¸ªç‚¹å…‰æºçš„å…‰ç…§ï¼Œå°†å…‰æºæ•°æ®ç´§å¯†æ‰“åŒ…åˆ°çŸ¢é‡ä¸­ã€‚å‰å‘æ¸²æŸ“ä½¿ç”¨å®ƒæ¥è®¡ç®—æ¯é¡¶ç‚¹å…‰ç…§ã€‚|</p><h3 id="unitycg.cginc-ä¸­çš„å±å¹•ç©ºé—´-helper-å‡½æ•°">UnityCG.cgincä¸­çš„å±å¹•ç©ºé—´ helper å‡½æ•°</h3><p>ä»¥ä¸‹ helper å‡½æ•°å¯è®¡ç®—ç”¨äºé‡‡æ ·å±å¹•ç©ºé—´çº¹ç†çš„åæ ‡ã€‚å®ƒä»¬è¿”å›float4ï¼Œå…¶ä¸­ç”¨äºçº¹ç†é‡‡æ ·çš„æœ€ç»ˆåæ ‡å¯ä»¥é€šè¿‡é€è§†é™¤æ³•ï¼ˆä¾‹å¦‚xy/wï¼‰è®¡ç®—å¾—å‡ºã€‚</p><p>è¿™äº›å‡½æ•°è¿˜å¤„ç†æ¸²æŸ“çº¹ç†åæ ‡ä¸­çš„å¹³å°å·®å¼‚ã€‚</p><table><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr class="header"><th style="text-align: left;">åŠŸèƒ½ï¼š</th><th style="text-align: left;">æè¿°ï¼š</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">float4 ComputeScreenPos (float4clipPos)</td><td style="text-align: left;">è®¡ç®—ç”¨äºæ‰§è¡Œå±å¹•ç©ºé—´è´´å›¾çº¹ç†é‡‡æ ·çš„çº¹ç†åæ ‡ã€‚è¾“å…¥æ˜¯è£å‰ªç©ºé—´ä½ç½®ã€‚</td></tr><tr class="even"><td style="text-align: left;">float4 ComputeGrabScreenPos (float4clipPos)</td><td style="text-align: left;">è®¡ç®—ç”¨äº <code>GrabPass</code>çº¹ç†é‡‡æ ·çš„çº¹ç†åæ ‡ã€‚è¾“å…¥æ˜¯è£å‰ªç©ºé—´ä½ç½®ã€‚</td></tr></tbody></table><h3 id="unitycg.cginc-ä¸­çš„é¡¶ç‚¹å…‰ç…§-helper-å‡½æ•°">UnityCG.cgincä¸­çš„é¡¶ç‚¹å…‰ç…§ helper å‡½æ•°</h3><p><strong>ä»…å½“ä½¿ç”¨æ¯é¡¶ç‚¹å…‰ç…§ç€è‰²å™¨ï¼ˆâ€œVertexâ€é€šé“ç±»å‹ï¼‰æ—¶ï¼Œè¿™äº›å‡½æ•°æ‰æœ‰ç”¨ã€‚</strong></p><p>float3 ShadeVertexLights (float4 vertex, float3 normal) :æ ¹æ®ç»™å®šçš„å¯¹è±¡ç©ºé—´ä½ç½®å’Œæ³•çº¿è®¡ç®—å››ä¸ªæ¯é¡¶ç‚¹å…‰æºå’Œç¯å¢ƒå…‰çš„å…‰ç…§ã€‚</p><h2 id="å†…ç½®ç€è‰²å™¨å˜é‡">å†…ç½®ç€è‰²å™¨å˜é‡</h2><p>Unityä¸ºç€è‰²å™¨æä¾›äº†ä¸€äº›å†…ç½®çš„å…¨å±€å˜é‡ï¼šå½“å‰å¯¹è±¡çš„å˜æ¢çŸ©é˜µã€å…‰æºå‚æ•°ã€å½“å‰æ—¶é—´ç­‰ç­‰ã€‚å°±åƒä»»ä½•å…¶ä»–å˜é‡ä¸€æ ·ï¼Œå¯åœ¨ç€è‰²å™¨ç¨‹åºä¸­ä½¿ç”¨è¿™äº›å˜é‡ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ä¸å¿…å£°æ˜å®ƒä»¬ï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯åœ¨è‡ªåŠ¨åŒ…å«çš„UnityShaderVariables.cginc include æ–‡ä»¶ä¸­å£°æ˜çš„ã€‚</p><h3 id="å˜æ¢">å˜æ¢</h3><p>æ‰€æœ‰è¿™äº›çŸ©é˜µéƒ½æ˜¯ float4x4 ç±»å‹ã€‚</p><table><thead><tr class="header"><th style="text-align: left;">åç§°</th><th style="text-align: left;">å€¼</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">UNITY_MATRIX_MVP</td><td style="text-align: left;">å½“å‰æ¨¡å‹ * è§†å›¾ * æŠ•å½±çŸ©é˜µã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_MATRIX_MV</td><td style="text-align: left;">å½“å‰æ¨¡å‹ * è§†å›¾çŸ©é˜µã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_MATRIX_V</td><td style="text-align: left;">å½“å‰è§†å›¾çŸ©é˜µã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_MATRIX_P</td><td style="text-align: left;">å½“å‰æŠ•å½±çŸ©é˜µã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_MATRIX_VP</td><td style="text-align: left;">å½“å‰è§†å›¾ * æŠ•å½±çŸ©é˜µã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_MATRIX_T_MV</td><td style="text-align: left;">æ¨¡å‹è½¬ç½® * è§†å›¾çŸ©é˜µã€‚</td></tr><tr class="odd"><td style="text-align: left;">UNITY_MATRIX_IT_MV</td><td style="text-align: left;">æ¨¡å‹é€†è½¬ç½® * è§†å›¾çŸ©é˜µã€‚</td></tr><tr class="even"><td style="text-align: left;"><strong>unity_ObjectToWorld</strong></td><td style="text-align: left;">å½“å‰æ¨¡å‹çŸ©é˜µã€‚</td></tr><tr class="odd"><td style="text-align: left;"><strong>unity_WorldToObject</strong></td><td style="text-align: left;">å½“å‰ä¸–ç•ŒçŸ©é˜µçš„é€†çŸ©é˜µã€‚</td></tr></tbody></table><h3 id="æ‘„åƒæœºå’Œå±å¹•">æ‘„åƒæœºå’Œå±å¹•</h3><p>è¿™äº›å˜é‡å°†å¯¹åº”äºæ­£åœ¨æ¸²æŸ“çš„æ‘„åƒæœºã€‚ä¾‹å¦‚ï¼Œåœ¨é˜´å½±è´´å›¾æ¸²æŸ“ä¸­ï¼Œå®ƒä»¬ä»å°†å¼•ç”¨æ‘„åƒæœºç»„ä»¶å€¼ï¼Œè€Œä¸æ˜¯ç”¨äºé˜´å½±è´´å›¾æŠ•å½±çš„â€œè™šæ‹Ÿæ‘„åƒæœºâ€ã€‚</p><table><colgroup><col style="width: 33%"><col style="width: 33%"><col style="width: 33%"></colgroup><thead><tr class="header"><th style="text-align: left;">åç§°</th><th style="text-align: left;">ç±»å‹</th><th style="text-align: left;">å€¼</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">_WorldSpaceCameraPos</td><td style="text-align: left;">float3</td><td style="text-align: left;">æ‘„åƒæœºçš„ä¸–ç•Œç©ºé—´ä½ç½®ã€‚</td></tr><tr class="even"><td style="text-align: left;">_ProjectionParams</td><td style="text-align: left;">float4</td><td style="text-align: left;">x æ˜¯1.0ï¼ˆå¦‚æœå½“å‰ä½¿ç”¨<code>ç¿»è½¬æŠ•å½±çŸ©é˜µ</code>è¿›è¡Œæ¸²æŸ“ï¼Œåˆ™ä¸º â€“1.0ï¼‰ï¼Œyæ˜¯æ‘„åƒæœºçš„è¿‘å¹³é¢ï¼Œz æ˜¯æ‘„åƒæœºçš„è¿œå¹³é¢ï¼Œw æ˜¯è¿œå¹³é¢çš„å€’æ•°ã€‚</td></tr><tr class="odd"><td style="text-align: left;">_ScreenParams</td><td style="text-align: left;">float4</td><td style="text-align: left;">xæ˜¯æ‘„åƒæœºç›®æ ‡çº¹ç†çš„å®½åº¦ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰ï¼Œyæ˜¯æ‘„åƒæœºç›®æ ‡çº¹ç†çš„é«˜åº¦ï¼ˆä»¥åƒç´ ä¸ºå•ä½ï¼‰ï¼Œz æ˜¯ 1.0 + 1.0/å®½åº¦ï¼Œw ä¸º 1.0 +1.0/é«˜åº¦ã€‚</td></tr><tr class="even"><td style="text-align: left;">_ZBufferParams</td><td style="text-align: left;">float4</td><td style="text-align: left;">ç”¨äºçº¿æ€§åŒ– Z ç¼“å†²åŒºå€¼ã€‚x æ˜¯ (1-è¿œ/è¿‘)ï¼Œyæ˜¯ (è¿œ/è¿‘)ï¼Œz æ˜¯ (x/è¿œ)ï¼Œw æ˜¯ (y/è¿œ)ã€‚</td></tr><tr class="odd"><td style="text-align: left;">unity_OrthoParams</td><td style="text-align: left;">float4</td><td style="text-align: left;">x æ˜¯æ­£äº¤æ‘„åƒæœºçš„å®½åº¦ï¼Œyæ˜¯æ­£äº¤æ‘„åƒæœºçš„é«˜åº¦ï¼Œz æœªä½¿ç”¨ï¼Œ<strong>w åœ¨æ‘„åƒæœºä¸ºæ­£äº¤æ¨¡å¼æ—¶æ˜¯1.0ï¼Œè€Œåœ¨æ‘„åƒæœºä¸ºé€è§†æ¨¡å¼æ—¶æ˜¯ 0.0ã€‚</strong></td></tr><tr class="even"><td style="text-align: left;">unity_CameraProjection</td><td style="text-align: left;">float4x4</td><td style="text-align: left;">æ‘„åƒæœºçš„æŠ•å½±çŸ©é˜µã€‚</td></tr><tr class="odd"><td style="text-align: left;">unity_CameraInvProjection</td><td style="text-align: left;">float4x4</td><td style="text-align: left;">æ‘„åƒæœºæŠ•å½±çŸ©é˜µçš„é€†çŸ©é˜µã€‚</td></tr><tr class="even"><td style="text-align: left;">unity_CameraWorldClipPlanes[6]</td><td style="text-align: left;">float4</td><td style="text-align: left;">æ‘„åƒæœºè§†é”¥ä½“å¹³é¢ä¸–ç•Œç©ºé—´æ–¹ç¨‹ï¼ŒæŒ‰ä»¥ä¸‹é¡ºåºï¼šå·¦ã€å³ã€åº•ã€é¡¶ã€è¿‘ã€è¿œã€‚</td></tr></tbody></table><h3 id="æ—¶é—´">æ—¶é—´</h3><table><colgroup><col style="width: 33%"><col style="width: 33%"><col style="width: 33%"></colgroup><thead><tr class="header"><th style="text-align: left;">åç§°</th><th style="text-align: left;">ç±»å‹</th><th style="text-align: left;">å€¼</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">_Time</td><td style="text-align: left;">float4</td><td style="text-align: left;">è‡ªå…³å¡åŠ è½½ä»¥æ¥çš„æ—¶é—´ (t/20, t, t<em>2,t</em>3)ï¼Œç”¨äºå°†ç€è‰²å™¨ä¸­çš„å†…å®¹åŠ¨ç”»åŒ–ã€‚</td></tr><tr class="even"><td style="text-align: left;">_SinTime</td><td style="text-align: left;">float4</td><td style="text-align: left;">æ—¶é—´æ­£å¼¦ï¼š(t/8, t/4, t/2, t)ã€‚</td></tr><tr class="odd"><td style="text-align: left;">_CosTime</td><td style="text-align: left;">float4</td><td style="text-align: left;">æ—¶é—´ä½™å¼¦ï¼š(t/8, t/4, t/2, t)ã€‚</td></tr><tr class="even"><td style="text-align: left;">unity_DeltaTime</td><td style="text-align: left;">float4</td><td style="text-align: left;">å¢é‡æ—¶é—´ï¼š(dt, 1/dt, smoothDt,1/smoothDt)ã€‚</td></tr></tbody></table><h3 id="å…‰ç…§">å…‰ç…§</h3><p>å…‰æºå‚æ•°ä»¥ä¸åŒçš„æ–¹å¼ä¼ é€’ç»™ç€è‰²å™¨ï¼Œå…·ä½“å–å†³äºä½¿ç”¨å“ªä¸ª<strong>æ¸²æŸ“è·¯å¾„</strong>ï¼Œä»¥åŠç€è‰²å™¨ä¸­ä½¿ç”¨å“ªç§<strong>å…‰æºæ¨¡å¼é€šé“æ ‡ç­¾</strong>ã€‚</p><h4 id="å‰å‘æ¸²æŸ“forwardbase-å’Œ-forwardadd-é€šé“ç±»å‹">å‰å‘æ¸²æŸ“ï¼ˆForwardBase å’ŒForwardAdd é€šé“ç±»å‹ï¼‰ï¼š</h4><table><colgroup><col style="width: 33%"><col style="width: 33%"><col style="width: 33%"></colgroup><thead><tr class="header"><th style="text-align: left;">åç§°</th><th style="text-align: left;">ç±»å‹</th><th style="text-align: left;">å€¼</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">_LightColor0ï¼ˆåœ¨ Lighting.cgincä¸­å£°æ˜ï¼‰</td><td style="text-align: left;">fixed4</td><td style="text-align: left;">å…‰æºé¢œè‰²ã€‚</td></tr><tr class="even"><td style="text-align: left;">_WorldSpaceLightPos0</td><td style="text-align: left;">float4</td><td style="text-align: left;">æ–¹å‘å…‰ï¼šï¼ˆä¸–ç•Œç©ºé—´æ–¹å‘ï¼Œ0ï¼‰ã€‚å…¶ä»–å…‰æºï¼šï¼ˆä¸–ç•Œç©ºé—´ä½ç½®ï¼Œ1ï¼‰ã€‚</td></tr><tr class="odd"><td style="text-align: left;">_LightMatrix0ï¼ˆåœ¨ AutoLight.cgincä¸­å£°æ˜ï¼‰</td><td style="text-align: left;">float4x4</td><td style="text-align: left;">ä¸–ç•Œ/å…‰æºçŸ©é˜µã€‚ç”¨äºå¯¹å‰ªå½±å’Œè¡°å‡çº¹ç†è¿›è¡Œé‡‡æ ·ã€‚</td></tr><tr class="even"><td style="text-align: left;">unity_4LightPosX0ã€unity_4LightPosY0ã€unity_4LightPosZ0</td><td style="text-align: left;">float4</td><td style="text-align: left;">ï¼ˆä»…é™ ForwardBaseé€šé“ï¼‰å‰å››ä¸ªéé‡è¦ç‚¹å…‰æºçš„ä¸–ç•Œç©ºé—´ä½ç½®ã€‚</td></tr><tr class="odd"><td style="text-align: left;">unity_4LightAtten0</td><td style="text-align: left;">float4</td><td style="text-align: left;">ï¼ˆä»…é™ ForwardBaseé€šé“ï¼‰å‰å››ä¸ªéé‡è¦ç‚¹å…‰æºçš„è¡°å‡å› å­ã€‚</td></tr><tr class="even"><td style="text-align: left;">unity_LightColor</td><td style="text-align: left;">half4[4]</td><td style="text-align: left;">ï¼ˆä»…é™ ForwardBaseé€šé“ï¼‰å‰å››ä¸ªéé‡è¦ç‚¹å…‰æºçš„é¢œè‰²ã€‚</td></tr><tr class="odd"><td style="text-align: left;">unity_WorldToShadow</td><td style="text-align: left;">float4x4[4]</td><td style="text-align: left;">ä¸–ç•Œ/é˜´å½±çŸ©é˜µã€‚èšå…‰ç¯çš„ä¸€ä¸ªçŸ©é˜µï¼Œæ–¹å‘å…‰çº§è”æœ€å¤šæœ‰å››ä¸ªçŸ©é˜µã€‚</td></tr></tbody></table><h4 id="å»¶è¿Ÿç€è‰²å’Œå»¶è¿Ÿå…‰ç…§åœ¨å…‰ç…§é€šé“ç€è‰²å™¨ä¸­ä½¿ç”¨å…¨éƒ¨åœ¨-unitydeferredlibrary.cginc-ä¸­å£°æ˜">å»¶è¿Ÿç€è‰²å’Œå»¶è¿Ÿå…‰ç…§ï¼Œåœ¨å…‰ç…§é€šé“ç€è‰²å™¨ä¸­ä½¿ç”¨ï¼ˆå…¨éƒ¨åœ¨UnityDeferredLibrary.cginc ä¸­å£°æ˜ï¼‰ï¼š</h4><table><colgroup><col style="width: 33%"><col style="width: 33%"><col style="width: 33%"></colgroup><thead><tr class="header"><th style="text-align: left;">åç§°</th><th style="text-align: left;">ç±»å‹</th><th style="text-align: left;">å€¼</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">_LightColor</td><td style="text-align: left;">float4</td><td style="text-align: left;">å…‰æºé¢œè‰²ã€‚</td></tr><tr class="even"><td style="text-align: left;">_LightMatrix0</td><td style="text-align: left;">float4x4</td><td style="text-align: left;">ä¸–ç•Œ/å…‰æºçŸ©é˜µã€‚ç”¨äºå¯¹å‰ªå½±å’Œè¡°å‡çº¹ç†è¿›è¡Œé‡‡æ ·ã€‚</td></tr><tr class="odd"><td style="text-align: left;">unity_WorldToShadow</td><td style="text-align: left;">float4x4[4]</td><td style="text-align: left;">ä¸–ç•Œ/é˜´å½±çŸ©é˜µã€‚èšå…‰ç¯çš„ä¸€ä¸ªçŸ©é˜µï¼Œæ–¹å‘å…‰çº§è”æœ€å¤šæœ‰å››ä¸ªçŸ©é˜µã€‚</td></tr></tbody></table><p>ä¸º ForwardBaseã€PrePassFinal å’Œ Deferred é€šé“ç±»å‹è®¾ç½®äº†çƒè°å‡½æ•°ç³»æ•°ï¼ˆç”±ç¯å¢ƒå…‰å’Œå…‰ç…§æ¢é’ˆä½¿ç”¨ï¼‰ã€‚è¿™äº›ç³»æ•°åŒ…å«ç”±ä¸–ç•Œç©ºé—´æ³•çº¿æ±‚å€¼çš„ä¸‰é˜¶ SHå‡½æ•°ï¼ˆè¯·å‚é˜… UnityCG.cginc ä¸­çš„ ShadeSH9ï¼‰ã€‚ è¿™äº›å˜é‡éƒ½æ˜¯ half4ç±»å‹ã€unity_SHAr å’Œç±»ä¼¼åç§°ã€‚</p><h4 id="é¡¶ç‚¹å…‰ç…§æ¸²æŸ“vertex-é€šé“ç±»å‹">é¡¶ç‚¹å…‰ç…§æ¸²æŸ“ï¼ˆVertexé€šé“ç±»å‹ï¼‰ï¼š</h4><p>æœ€å¤šå¯ä¸º Vertex é€šé“ç±»å‹è®¾ç½® 8ä¸ªå…‰æºï¼›å§‹ç»ˆä»æœ€äº®çš„å…‰æºå¼€å§‹æ’åºã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨å¸Œæœ›ä¸€æ¬¡æ¸²æŸ“å—ä¸¤ä¸ªå…‰æºå½±å“çš„å¯¹è±¡ï¼Œå¯ç›´æ¥é‡‡ç”¨æ•°ç»„ä¸­å‰ä¸¤ä¸ªæ¡ç›®ã€‚å¦‚æœå½±å“å¯¹è±¡çš„å…‰æºæ•°é‡å°‘äº 8ï¼Œåˆ™å…¶ä½™å…‰æºçš„é¢œè‰²å°†è®¾ç½®ä¸ºé»‘è‰²ã€‚</p><table><colgroup><col style="width: 33%"><col style="width: 33%"><col style="width: 33%"></colgroup><thead><tr class="header"><th style="text-align: left;">åç§°</th><th style="text-align: left;">ç±»å‹</th><th style="text-align: left;">å€¼</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">unity_LightColor</td><td style="text-align: left;">half4[8]</td><td style="text-align: left;">å…‰æºé¢œè‰²ã€‚</td></tr><tr class="even"><td style="text-align: left;">unity_LightPosition</td><td style="text-align: left;">float4[8]</td><td style="text-align: left;">è§†å›¾ç©ºé—´å…‰æºä½ç½®ã€‚æ–¹å‘å…‰ä¸º(-direction,0)ï¼›ç‚¹å…‰æº/èšå…‰ç¯ä¸º (position,1)ã€‚</td></tr><tr class="odd"><td style="text-align: left;">unity_LightAtten</td><td style="text-align: left;">half4[8]</td><td style="text-align: left;">å…‰æºè¡°å‡å› å­ã€‚x æ˜¯ cos(spotAngle/2) æˆ–â€“1ï¼ˆéèšå…‰ç¯ï¼‰ï¼›<em>y</em> æ˜¯1/cos(spotAngle/4) æˆ–1ï¼ˆéèšå…‰ç¯ï¼‰ï¼›<em>z</em> æ˜¯äºŒæ¬¡è¡°å‡ï¼›<em>w</em> æ˜¯å¹³æ–¹å…‰æºèŒƒå›´ã€‚</td></tr><tr class="even"><td style="text-align: left;">unity_SpotDirection</td><td style="text-align: left;">float4[8]</td><td style="text-align: left;">è§†å›¾ç©ºé—´èšå…‰ç¯ä½ç½®ï¼›éèšå…‰ç¯ä¸º(0,0,1,0)ã€‚</td></tr></tbody></table><h3 id="é›¾æ•ˆå’Œç¯å¢ƒå…‰">é›¾æ•ˆå’Œç¯å¢ƒå…‰</h3><table><colgroup><col style="width: 33%"><col style="width: 33%"><col style="width: 33%"></colgroup><thead><tr class="header"><th style="text-align: left;">åç§°</th><th style="text-align: left;">ç±»å‹</th><th style="text-align: left;">å€¼</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">unity_AmbientSky</td><td style="text-align: left;">fixed4</td><td style="text-align: left;">æ¢¯åº¦ç¯å¢ƒå…‰ç…§æƒ…å†µä¸‹çš„å¤©ç©ºç¯å¢ƒå…‰ç…§é¢œè‰²ã€‚</td></tr><tr class="even"><td style="text-align: left;">unity_AmbientEquator</td><td style="text-align: left;">fixed4</td><td style="text-align: left;">æ¢¯åº¦ç¯å¢ƒå…‰ç…§æƒ…å†µä¸‹çš„èµ¤é“ç¯å¢ƒå…‰ç…§é¢œè‰²ã€‚</td></tr><tr class="odd"><td style="text-align: left;">unity_AmbientGround</td><td style="text-align: left;">fixed4</td><td style="text-align: left;">æ¢¯åº¦ç¯å¢ƒå…‰ç…§æƒ…å†µä¸‹çš„åœ°é¢ç¯å¢ƒå…‰ç…§é¢œè‰²ã€‚</td></tr><tr class="even"><td style="text-align: left;">UNITY_LIGHTMODEL_AMBIENT</td><td style="text-align: left;">fixed4</td><td style="text-align: left;">ç¯å¢ƒå…‰ç…§é¢œè‰²ï¼ˆæ¢¯åº¦ç¯å¢ƒæƒ…å†µä¸‹çš„å¤©ç©ºé¢œè‰²ï¼‰ã€‚æ—§ç‰ˆå˜é‡ã€‚</td></tr><tr class="odd"><td style="text-align: left;">unity_FogColor</td><td style="text-align: left;">fixed4</td><td style="text-align: left;">é›¾æ•ˆé¢œè‰²ã€‚</td></tr><tr class="even"><td style="text-align: left;">unity_FogParams</td><td style="text-align: left;">float4</td><td style="text-align: left;">ç”¨äºé›¾æ•ˆè®¡ç®—çš„å‚æ•°ï¼š(density /sqrt(ln(2))ã€density / ln(2)ã€â€“1/(end-start) å’Œ end/(end-start))ã€‚x å¯¹äºExp2 é›¾æ¨¡å¼å¾ˆæœ‰ç”¨ï¼›<em>y</em> å¯¹äº Exp æ¨¡å¼å¾ˆæœ‰ç”¨ï¼Œ<em>z</em> å’Œ w å¯¹äºLinear æ¨¡å¼å¾ˆæœ‰ç”¨ã€‚</td></tr></tbody></table><h3 id="å…¶ä»–">å…¶ä»–</h3><table><colgroup><col style="width: 33%"><col style="width: 33%"><col style="width: 33%"></colgroup><thead><tr class="header"><th style="text-align: left;">åç§°</th><th style="text-align: left;">ç±»å‹</th><th style="text-align: left;">å€¼</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">unity_LODFade</td><td style="text-align: left;">float4</td><td style="text-align: left;">ä½¿ç”¨ LODGroup æ—¶çš„ç»†èŠ‚çº§åˆ«æ·¡å…¥æ·¡å‡ºã€‚xä¸ºæ·¡å…¥æ·¡å‡ºï¼ˆ0 åˆ° 1ï¼‰ï¼Œ<em>y</em> ä¸ºé‡åŒ–ä¸º 16 çº§çš„æ·¡å…¥æ·¡å‡ºï¼Œ<em>z</em> å’Œw æœªä½¿ç”¨ã€‚</td></tr><tr class="even"><td style="text-align: left;">_TextureSampleAdd</td><td style="text-align: left;">float4</td><td style="text-align: left;">æ ¹æ®æ‰€ä½¿ç”¨çš„çº¹ç†æ˜¯ Alpha8 æ ¼å¼ï¼ˆå€¼è®¾ç½®ä¸º(1,1,1,0)ï¼‰è¿˜æ˜¯ä¸æ˜¯è¯¥æ ¼å¼ï¼ˆå€¼è®¾ç½®ä¸º (0,0,0,0)ï¼‰ç”± Unity ä»…é’ˆå¯¹ UIè‡ªåŠ¨è®¾ç½®ã€‚</td></tr></tbody></table><h2 id="å¤šä¸ªç€è‰²å™¨ç¨‹åºå˜ä½“">å¤šä¸ªç€è‰²å™¨ç¨‹åºå˜ä½“</h2><p>é€šå¸¸æ–¹ä¾¿çš„åšæ³•æ˜¯ä¿æŒå¤§éƒ¨åˆ†ç€è‰²å™¨ä»£ç å›ºå®šï¼Œä½†ä¹Ÿå…è®¸ç”Ÿæˆç¨å¾®ä¸åŒçš„ç€è‰²å™¨â€œå˜ä½“â€ã€‚è¿™ç§å˜ä½“é€šå¸¸ç§°ä¸ºâ€œå¤§å‹ç€è‰²å™¨â€æˆ–â€œè¶…çº§ç€è‰²å™¨â€ï¼Œå®ç°çš„æ–¹å¼æ˜¯é’ˆå¯¹æ¯ç§æƒ…å†µä½¿ç”¨ä¸åŒçš„é¢„å¤„ç†å™¨æŒ‡ä»¤å¤šæ¬¡ç¼–è¯‘ç€è‰²å™¨ä»£ç ã€‚åœ¨ Unity ä¸­ï¼Œå¯é€šè¿‡å‘ç€è‰²å™¨ä»£ç ç‰‡æ®µä¸­æ·»åŠ <code>#pragma multi_compile æˆ– #pragma shader_feature</code>æŒ‡ä»¤æ¥å®ç°ç›®çš„ã€‚è¿™åœ¨è¡¨é¢ç€è‰²å™¨ä¸­ä¹Ÿæœ‰æ•ˆã€‚ åœ¨è¿è¡Œæ—¶å°†ä» Materialå…³é”®å­—<code>ï¼ˆMaterial.EnableKeyword å’Œ DisableKeywordï¼‰</code>æˆ–å…¨å±€ç€è‰²å™¨å…³é”®å­—<code>ï¼ˆShader.EnableKeyword å’Œ DisableKeywordï¼‰</code>ä¸­é€‰å–é€‚å½“çš„ç€è‰²å™¨å˜ä½“ã€‚</p><h3 id="multi_compile-çš„å·¥ä½œæ–¹å¼">multi_compile çš„å·¥ä½œæ–¹å¼</h3><p>å¦‚ä¸‹æŒ‡ä»¤ï¼š</p><pre><code># pragma multi_compile FANCY_STUFF_OFF FANCY_STUFF_ON</code></pre><p>å°†ç”Ÿæˆä¸¤ä¸ªç€è‰²å™¨å˜ä½“ï¼Œä¸€ä¸ªå®šä¹‰äº† FANCY_STUFF_OFFï¼Œå¦ä¸€ä¸ªå®šä¹‰äº†FANCY_STUFF_ONã€‚åœ¨è¿è¡Œæ—¶ï¼Œå°†æ ¹æ®â€œMaterialâ€æˆ–å…¨å±€ç€è‰²å™¨å…³é”®å­—æ¿€æ´»å…¶ä¸­ä¸€ä¸ªå˜ä½“ã€‚å¦‚æœè¿™ä¸¤ä¸ªå…³é”®å­—å‡æœªå¯ç”¨ï¼Œåˆ™å°†ä½¿ç”¨ç¬¬ä¸€ä¸ªï¼ˆâ€œoffâ€ï¼‰ã€‚</p><p>ä¸€è¡Œ multi_compileä¸­å¯ä»¥æœ‰ä¸¤ä¸ªä»¥ä¸Šçš„å…³é”®å­—ï¼Œä¾‹å¦‚ï¼Œä»¥ä¸‹æŒ‡ä»¤å°†ç”Ÿæˆå››ä¸ªç€è‰²å™¨å˜ä½“ï¼š</p><pre><code># pragma multi_compile SIMPLE_SHADING BETTER_SHADING GOOD_SHADING BEST_SHADING</code></pre><p>å½“ä»»ä½•åç§°ä¸ºå…¨ä¸‹åˆ’çº¿æ—¶ï¼Œå°†ç”Ÿæˆæœªå®šä¹‰é¢„å¤„ç†å™¨å®çš„ç€è‰²å™¨å˜ä½“ã€‚è¿™é€šå¸¸ç”¨äºç€è‰²å™¨åŠŸèƒ½ï¼Œä»¥é¿å…ä½¿ç”¨å¤šè¾¾ä¸¤ä¸ªå…³é”®å­—ï¼ˆè¯·å‚é˜…ä¸‹é¢çš„å…³é”®å­—é™åˆ¶è¯´æ˜ï¼‰ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„æŒ‡ä»¤å°†ç”Ÿæˆä¸¤ä¸ªç€è‰²å™¨å˜ä½“ï¼›ç¬¬ä¸€ä¸ªå˜ä½“æœªå®šä¹‰ä»»ä½•å†…å®¹ï¼Œç¬¬äºŒä¸ªå˜ä½“å®šä¹‰äº†FOO_ONï¼š</p><h1 id="pragma-multi_compile-__-foo_on">pragma multi_compile __FOO_ON</h1><h3 id="shader_feature-ä¸-multi_compile-ä¹‹é—´çš„åŒºåˆ«">shader_feature ä¸multi_compile ä¹‹é—´çš„åŒºåˆ«</h3><p><code>#pragma shader_feature</code> ä¸<code>#pragma multi_compile</code> éå¸¸ç±»ä¼¼ï¼Œ<strong>å”¯ä¸€çš„åŒºåˆ«æ˜¯shader_featureç€è‰²å™¨çš„æœªä½¿ç”¨å˜ä½“ä¸ä¼šåŒ…å«åœ¨æ¸¸æˆæ„å»ºä¸­ã€‚å› æ­¤ï¼Œ<code>shader_feature</code>å¯¹äºå°†åœ¨æè´¨ä¸Šè®¾ç½®çš„å…³é”®å­—æœ€åˆé€‚ï¼Œè€Œ <code>multi_compile</code>å¯¹äºå°†é€šè¿‡ä»£ç è¿›è¡Œå…¨å±€è®¾ç½®çš„å…³é”®å­—æœ€åˆé€‚ã€‚</strong></p><p>æ­¤å¤–ï¼Œå®ƒæœ‰ä¸€ä¸ªåªåŒ…å«ä¸€ä¸ªå…³é”®å­—çš„é€Ÿè®°ç¬¦å·ï¼š</p><pre><code># pragma shader_feature FANCY_STUFF</code></pre><p>è¿™åªæ˜¯ #pragma shader_feature _ FANCY_STUFFçš„å¿«æ·æ–¹å¼ï¼Œå³å®ƒä¼šæ‰©å±•ä¸ºä¸¤ä¸ªç€è‰²å™¨å˜ä½“ï¼ˆç¬¬ä¸€ä¸ªæ²¡æœ‰å®šä¹‰ï¼›ç¬¬äºŒä¸ªæœ‰å®šä¹‰ï¼‰ã€‚</p><h3 id="åˆå¹¶å¤šä¸ª-multi_compile-è¡Œ">åˆå¹¶å¤šä¸ª multi_compile è¡Œ</h3><p>å¯æä¾›å¤šä¸ª multi_compileè¡Œï¼Œæ­¤æƒ…å†µä¸‹å°†é’ˆå¯¹æ‰€æœ‰å¯èƒ½çš„è¡Œç»„åˆæ¥ç¼–è¯‘ç”Ÿæˆçš„ç€è‰²å™¨ï¼š</p><pre><code># pragma multi_compile A B C# pragma multi_compile D E</code></pre><p>æ­¤æŒ‡ä»¤å°†ä¸ºç¬¬ä¸€è¡Œäº§ç”Ÿä¸‰ç§å˜ä½“ï¼Œä¸ºç¬¬äºŒè¡Œäº§ç”Ÿä¸¤ç§å˜ä½“ï¼Œæˆ–è€…æ€»å…±äº§ç”Ÿå…­ç§ç€è‰²å™¨å˜ä½“ï¼ˆA+Dã€B+Dã€C+Dã€A+Eã€B+Eå’Œ C+Eï¼‰ã€‚</p><p>æœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†æ¯ä¸ª multi_compileè¡Œè§†ä¸ºæ§åˆ¶å•ä¸ªç€è‰²å™¨â€œåŠŸèƒ½â€ã€‚<strong>è¯·è®°ä½ï¼Œç€è‰²å™¨å˜ä½“çš„æ€»æ•°ä¼šä»¥è¿™ç§æ–¹å¼æ€¥é€Ÿå¢é•¿</strong>ã€‚ä¾‹å¦‚ï¼Œåä¸ªå¸¦æœ‰ä¸¤ä¸ªé€‰é¡¹çš„multi_compileâ€œåŠŸèƒ½â€æ€»å…±å°†ç”Ÿæˆ 1024 ä¸ªç€è‰²å™¨å˜ä½“ï¼</p><h3 id="å…³é”®å­—é™åˆ¶">å…³é”®å­—é™åˆ¶</h3><p>ä½¿ç”¨ç€è‰²å™¨å˜ä½“æ—¶ï¼Œè¯·è®°ä½ Unity ä¸­<strong>å…³é”®å­—æ•°é‡ä¸Šé™æ˜¯256ï¼Œå…¶ä¸­å¤§çº¦ 60ä¸ªä¿ç•™ä¾›å†…éƒ¨ä½¿ç”¨ï¼ˆå› æ­¤é™ä½äº†å¯ç”¨ä¸Šé™ï¼‰</strong>ã€‚æ­¤å¤–ï¼Œå…³é”®å­—ä¼šåœ¨æ•´ä¸ªç‰¹å®šUnityé¡¹ç›®ä¸­å…¨å±€å¯ç”¨ï¼Œå› æ­¤åœ¨å¤šä¸ªä¸åŒç€è‰²å™¨ä¸­å®šä¹‰å¤šä¸ªå…³é”®å­—æ—¶ï¼Œè¯·æ³¨æ„ä¸è¦è¶…è¿‡é™åˆ¶ã€‚</p><h3 id="å†…ç½®-multi_compile-å¿«æ·æ–¹å¼">å†…ç½® multi_compile å¿«æ·æ–¹å¼</h3><p>æœ‰å‡ ä¸ªâ€œå¿«æ·æ–¹å¼â€ç¬¦å·ç”¨äºç¼–è¯‘å¤šä¸ªç€è‰²å™¨å˜ä½“ï¼›å®ƒä»¬ä¸»è¦ç”¨äºå¤„ç† Unityä¸­ä¸åŒçš„å…‰ç…§ã€é˜´å½±å’Œå…‰ç…§è´´å›¾ç±»å‹ã€‚è¯·å‚é˜…æ¸²æŸ“ç®¡çº¿ä»¥äº†è§£è¯¦ç»†ä¿¡æ¯ã€‚</p><pre><code>multi_compile_fwdbase å°†ç¼–è¯‘ ForwardBaseï¼ˆå‰å‘æ¸²æŸ“åŸºç¡€ï¼‰é€šé“ç±»å‹éœ€è¦çš„æ‰€æœ‰å˜ä½“ã€‚è¿™äº›å˜ä½“å¤„ç†ä¸åŒçš„å…‰ç…§è´´å›¾ç±»å‹ä»¥åŠå¼€å¯æˆ–å…³é—­é˜´å½±çš„ä¸»æ–¹å‘å…‰ã€‚multi_compile_fwdadd å°†ç¼–è¯‘ ForwardAddï¼ˆå‰å‘æ¸²æŸ“é™„åŠ ï¼‰é€šé“ç±»å‹çš„å˜ä½“ã€‚è¿™å°†ç¼–è¯‘å˜ä½“æ¥å¤„ç†æ–¹å‘å…‰ã€èšå…‰ç¯æˆ–ç‚¹å…‰æºç±»å‹ï¼Œä»¥åŠå®ƒä»¬å¸¦æœ‰å‰ªå½±çº¹ç†çš„å˜ä½“ã€‚multi_compile_fwdadd_fullshadows - åŒä¸Šï¼Œä½†è¿˜èƒ½å¤Ÿè®©å…‰æºå…·æœ‰å®æ—¶é˜´å½±ã€‚multi_compile_fog æ‰©å±•ä¸ºå¤šä¸ªå˜ä½“ä»¥å¤„ç†ä¸åŒçš„é›¾æ•ˆç±»å‹ (off/linear/exp/exp2)ã€‚</code></pre><p>å¤§å¤šæ•°å†…ç½®å¿«æ·æ–¹å¼éƒ½ä¼šäº§ç”Ÿè®¸å¤šç€è‰²å™¨å˜ä½“ã€‚å¦‚æœæ‚¨çŸ¥é“ä¸éœ€è¦æŸäº›å˜ä½“ï¼Œå¯é€šè¿‡ä½¿ç”¨#pragma skip_variants æ¥è·³è¿‡è¿™äº›å˜ä½“çš„ç¼–è¯‘ã€‚ä¾‹å¦‚ï¼š</p><pre><code># pragma multi_compile_fwdadd// å°†è·³è¿‡åŒ…å«// "POINT" æˆ– "POINT_COOKIE" çš„æ‰€æœ‰å˜ä½“# pragma skip_variants POINT POINT_COOKIE</code></pre><p>ç€è‰²å™¨ç¡¬ä»¶å˜ä½“</p><p>ä½¿ç”¨ç€è‰²å™¨å˜ä½“çš„ä¸€ä¸ªå¸¸è§åŸå› æ˜¯åˆ›å»ºå¯åŒæ—¶åœ¨å•ä¸ªç›®æ ‡å¹³å°ï¼ˆä¾‹å¦‚ OpenGLESï¼‰å†…çš„é«˜ç«¯å’Œä½ç«¯ç¡¬ä»¶ä¸Šé«˜æ•ˆè¿è¡Œçš„åå¤‡ç€è‰²å™¨æˆ–ç®€åŒ–ç€è‰²å™¨ã€‚è¦ä¸ºä¸åŒçš„ç¡¬ä»¶åŠŸèƒ½çº§åˆ«æä¾›ç‰¹åˆ«ä¼˜åŒ–çš„å˜ä½“é›†ï¼Œå¯ä»¥ä½¿ç”¨ç€è‰²å™¨ç¡¬ä»¶å˜ä½“ã€‚</p><p>è¦å¯ç”¨ç€è‰²å™¨ç¡¬ä»¶å˜ä½“çš„ç”Ÿæˆï¼Œè¯·æ·»åŠ  #pragma hardware_tier_variantsrendererï¼Œå…¶ä¸­ renderer æ˜¯ç€è‰²å™¨ç¨‹åºæ‚æ³¨çš„å¯ç”¨æ¸²æŸ“å¹³å°ä¹‹ä¸€ã€‚ä½¿ç”¨æ­¤#pragmaï¼Œå°†ä¸ºæ¯ä¸ªç€è‰²å™¨ç”Ÿæˆ 3ä¸ªç€è‰²å™¨å˜ä½“ï¼Œå¹¶å¿½ç•¥å…¶ä»–æ‰€æœ‰å…³é”®å­—ã€‚æ¯ä¸ªå˜ä½“å°†å®šä¹‰ä»¥ä¸‹æŒ‡ä»¤ä¹‹ä¸€ï¼š</p><pre><code>UNITY_HARDWARE_TIER1UNITY_HARDWARE_TIER2UNITY_HARDWARE_TIER3</code></pre><p>æ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬ä¸ºæ›´ä½ç«¯æˆ–æ›´é«˜ç«¯ç¡¬ä»¶ç¼–å†™æ¡ä»¶æ€§å›é€€æˆ–é¢å¤–åŠŸèƒ½ã€‚åœ¨ Editorä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Graphics Emulationèœå•æµ‹è¯•ä»»ä½•å±‚ï¼ˆå…è®¸æ‚¨åœ¨æ¯ä¸ªå±‚ä¹‹é—´è¿›è¡Œæ›´æ”¹ï¼‰ã€‚ä¸ºäº†å¸®åŠ©å°½å¯èƒ½é™ä½è¿™äº›å˜ä½“çš„å½±å“ï¼Œæ’­æ”¾å™¨ä¸­åªåŠ è½½äº†ä¸€ç»„ç€è‰²å™¨ã€‚æ­¤å¤–ï¼Œä»»ä½•æœ€ç»ˆç›¸åŒçš„ç€è‰²å™¨ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åªä¸ºTIER1 ç¼–å†™ä¸“ç”¨ç‰ˆæœ¬è€Œå…¶ä»–æ‰€æœ‰ç‰ˆæœ¬éƒ½ç›¸åŒï¼‰å°†ä¸å ç”¨ç£ç›˜ä¸Šçš„ä»»ä½•é¢å¤–ç©ºé—´ã€‚åœ¨åŠ è½½æ—¶ï¼ŒUnity å°†æ£€æŸ¥å…¶æ­£åœ¨ä½¿ç”¨çš„ GPU å¹¶è‡ªåŠ¨æ£€æµ‹å±‚å€¼ï¼›å¦‚æœæœªè‡ªåŠ¨æ£€æµ‹åˆ°GPUï¼Œå®ƒå°†é»˜è®¤ä¸ºæœ€é«˜å±‚ã€‚æ‚¨å¯ä»¥é€šè¿‡è®¾ç½® Shader.globalShaderHardwareTieræ¥è¦†ç›–æ­¤å±‚å€¼ï¼Œä½†å¿…é¡»åœ¨åŠ è½½è¦æ›´æ”¹çš„ä»»ä½•ç€è‰²å™¨ä¹‹å‰å®Œæˆæ­¤æ“ä½œã€‚åŠ è½½ç€è‰²å™¨åï¼Œç€è‰²å™¨å°†é€‰æ‹©ä¸€ç»„å˜ä½“ï¼Œæ­¤å€¼å°†æ— æ•ˆã€‚ä¸€ä¸ªè‰¯å¥½çš„è®¾ç½®ä½ç½®æ˜¯åœ¨åŠ è½½ä¸»åœºæ™¯ä¹‹å‰çš„é¢„åŠ è½½åœºæ™¯ä¸­ã€‚</p><p><strong>è¯·æ³¨æ„ï¼Œè¿™äº›ç€è‰²å™¨ç¡¬ä»¶å±‚ä¸æ’­æ”¾å™¨çš„ Qualityè®¾ç½®æ— å…³ï¼Œå®ƒä»¬çº¯ç²¹æ˜¯ä»è¿è¡Œæ’­æ”¾å™¨çš„ GPUçš„ç›¸å¯¹åŠŸèƒ½ä¸­æ£€æµ‹åˆ°çš„ã€‚</strong></p><p>å¹³å°ç€è‰²å™¨è®¾ç½®</p><p>é™¤äº†è°ƒæ•´ä¸åŒç¡¬ä»¶å±‚çš„ç€è‰²å™¨ä»£ç ä¹‹å¤–ï¼Œæ‚¨å¯èƒ½è¿˜éœ€è¦è°ƒæ•´ Unityå†…éƒ¨å®šä¹‰ï¼ˆä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¼ºåˆ¶ä½¿ç”¨çº§è”é˜´å½±è´´å›¾ï¼‰ã€‚æ‚¨å¯ä»¥åœ¨<code>UnityEditor.Rendering.PlatformShaderSettings</code>æ–‡æ¡£ä¸­æ‰¾åˆ°ä¸æ­¤ç›¸å…³çš„è¯¦ç»†ä¿¡æ¯ï¼Œå…¶ä¸­æä¾›äº†æŒ‰å±‚è¦†ç›–çš„æœ€æ–°æ”¯æŒåŠŸèƒ½çš„åˆ—è¡¨ã€‚ä½¿ç”¨<code>UnityEditor.Rendering.EditorGraphicsSettings.SetShaderSettingsForPlatform</code>å¯æ ¹æ®å¹³å°æŒ‰å±‚è°ƒæ•´ç¡¬ä»¶ç€è‰²å™¨è®¾ç½®ã€‚ <strong>è¯·æ³¨æ„ï¼Œå¦‚æœè®¾ç½®ä¸ºä¸åŒå±‚çš„<code>PlatformShaderSetting</code> ä¸ç›¸åŒï¼Œåˆ™å³ä½¿ç¼ºå°‘<code>#pragma hardware_tier_variants</code>ï¼Œä¹Ÿä¼šä¸ºç€è‰²å™¨ç”Ÿæˆå±‚å˜ä½“ã€‚</strong></p><h2 id="glsl-ç€è‰²å™¨ç¨‹åº">GLSL ç€è‰²å™¨ç¨‹åº</h2><h2 id="ç€è‰²å™¨ç¼–è¯‘å™¨">ç€è‰²å™¨ç¼–è¯‘å™¨</h2><p>åœ¨ Unity ä¸­ï¼Œç€è‰²å™¨ç¨‹åºæ˜¯ç”¨ HLSL è¯­è¨€çš„ä¸€ä¸ªå˜ç§ï¼ˆä¹Ÿç§°ä¸ºCgï¼Œä½†å¯¹äºå¤§éƒ¨åˆ†å®é™…ä½¿ç”¨æƒ…å†µï¼Œè¿™ä¸¤ç§è¯­è¨€æ²¡æœ‰åŒºåˆ«ï¼‰ç¼–å†™çš„ã€‚ç›®å‰ï¼Œä¸ºäº†åœ¨ä¸åŒå¹³å°ä¹‹é—´å®ç°æœ€å¤§ç¨‹åº¦çš„å¯ç§»æ¤æ€§ï¼Œè¯·ä½¿ç”¨ DX9 é£æ ¼çš„ HLSLç¼–å†™ç¨‹åºï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ DX9 é£æ ¼çš„ sampler2D å’Œ tex2Dè¿›è¡Œçº¹ç†é‡‡æ ·ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ DX10 é£æ ¼çš„ Texture2Dã€SamplerState å’Œtex.Sampleï¼‰ã€‚</p><p>åœ¨å†…éƒ¨å°†ä½¿ç”¨ä¸åŒçš„ç€è‰²å™¨ç¼–è¯‘å™¨æ¥ç¼–è¯‘ç€è‰²å™¨ç¨‹åºï¼š</p><ul><li>Windows å’Œ Microsoft å¹³å°ï¼ˆDX11ã€DX12 å’Œ Xbox Oneï¼‰å…¨éƒ¨ä½¿ç”¨Microsoft çš„ HLSL ç¼–è¯‘å™¨ï¼ˆæœ€æ–°ç‰ˆæœ¬ä¸º d3dcompiler_47ï¼‰ã€‚</li><li>OpenGL Coreã€OpenGL ES 3ã€OpenGL ES 2.0 å’Œ Metal <strong>ä½¿ç”¨Microsoft çš„ HLSLï¼Œç„¶åä½¿ç”¨ HLSLcc æŒ‰å­—èŠ‚ä»£ç è½¬æ¢ä¸º GLSL æˆ–Metal</strong>ã€‚</li><li>OpenGL ES 2.0 å¯ä»¥é€šè¿‡ hlsl2glslfork å’Œ glslä¼˜åŒ–å™¨è¿›è¡Œæºä»£ç çº§åˆ«è½¬æ¢ã€‚è¿™æ˜¯é€šè¿‡æ·»åŠ  #pragma prefer_hlsl2glsl gleså®ç°çš„</li><li>å…¶ä»–æ¸¸æˆä¸»æœºå¹³å°ä½¿ç”¨å…¶å„è‡ªçš„ç¼–è¯‘å™¨ï¼ˆä¾‹å¦‚ï¼ŒPS4 ä½¿ç”¨ PSSLï¼‰ã€‚</li><li>è¡¨é¢ç€è‰²å™¨ä½¿ç”¨ Cg 2.2 å’Œ MojoShader æ¥å®Œæˆä»£ç ç”Ÿæˆåˆ†ææ­¥éª¤ã€‚</li></ul><p>å¦‚æœç¡®å®éœ€è¦ç¡®å®šæ­£åœ¨ä½¿ç”¨å“ªä¸ªç¼–è¯‘å™¨ï¼ˆä¸ºäº†ä½¿ç”¨ä»…ä¸€ç§ç¼–è¯‘å™¨æ”¯æŒçš„ HLSLè¯­æ³•ï¼Œæˆ–è§£å†³ç¼–è¯‘å™¨é”™è¯¯ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨é¢„å®šä¹‰çš„ç€è‰²å™¨å®ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ HLSLç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘æ—¶è®¾ç½® UNITY_COMPILER_HLSLï¼ˆé’ˆå¯¹ D3D æˆ– GLCore/GLES3/GLESå¹³å°ï¼‰ï¼›é€šè¿‡ hlsl2glsl è¿›è¡Œç¼–è¯‘æ—¶è®¾ç½® UNITY_COMPILER_HLSL2GLSLã€‚</p><h2 id="ç€è‰²å™¨ç›®æ ‡">ç€è‰²å™¨ç›®æ ‡</h2><p>ç¼–å†™è¡¨é¢ç€è‰²å™¨æˆ–å¸¸è§„ ç€è‰²å™¨ç¨‹åºæ—¶ï¼ŒHLSL æºä»£ç å¯ä»¥ç¼–è¯‘åˆ°ä¸åŒâ€œç€è‰²å™¨æ¨¡å‹â€ä¸­ã€‚ ä¸ºäº†æ”¯æŒä½¿ç”¨æ›´ç°ä»£çš„ GPIåŠŸèƒ½ï¼Œå¿…é¡»ä½¿ç”¨æ›´é«˜çš„ç€è‰²å™¨ç¼–è¯‘ç›®æ ‡ã€‚<strong>æ³¨æ„ï¼šä½¿ç”¨æ›´é«˜çš„ç€è‰²å™¨ç¼–è¯‘ç›®æ ‡å¯èƒ½ä¼šé˜»æ­¢ç€è‰²å™¨åœ¨è¾ƒæ—§çš„ GPUæˆ–å¹³å°ä¸Šè¿è¡Œã€‚</strong> åº”ä½¿ç”¨ #pragma target åç§° æŒ‡ä»¤æˆ–æ›´å…·ä½“çš„#pragma require åŠŸèƒ½ â€¦ æŒ‡ä»¤æ¥æŒ‡ç¤ºç¼–è¯‘ç›®æ ‡ã€‚ä¾‹å¦‚ï¼š</p><pre><code># pragma target 3.5# pragma require integers 2darray instancing</code></pre><h3 id="é»˜è®¤ç¼–è¯‘ç›®æ ‡">é»˜è®¤ç¼–è¯‘ç›®æ ‡</h3><h3 id="æ”¯æŒçš„pragma-targetåç§°">æ”¯æŒçš„â€œ#pragma targetâ€åç§°</h3><h3 id="æ”¯æŒçš„pragma-requireåç§°">æ”¯æŒçš„â€œ#pragma requireâ€åç§°</h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/shader/4.xiang-ding-dian-cheng-xu-ti-gong-ding-dian-shu-ju/"/>
      <url>/2022/08/10/unity/shader/4.xiang-ding-dian-cheng-xu-ti-gong-ding-dian-shu-ju/</url>
      
        <content type="html"><![CDATA[<h1 id="å‘é¡¶ç‚¹ç¨‹åºæä¾›é¡¶ç‚¹æ•°æ®">å‘é¡¶ç‚¹ç¨‹åºæä¾›é¡¶ç‚¹æ•°æ®</h1><blockquote><p>åˆ‡çº¿ w åˆ†é‡å«ä¹‰ï¼Ÿ</p></blockquote><p>å¯¹äº <code>Cg/HLSL</code> é¡¶ç‚¹ç¨‹åºï¼Œç½‘æ ¼é¡¶ç‚¹æ•°æ®ä½œä¸ºè¾“å…¥ä¼ é€’ç»™é¡¶ç‚¹ç€è‰²å™¨å‡½æ•°ã€‚æ¯ä¸ªè¾“å…¥éƒ½éœ€è¦æœ‰æŒ‡å®šçš„<code>è¯­ä¹‰</code>ï¼šä¾‹å¦‚ï¼Œ <code>POSITION</code> è¾“å…¥è¡¨ç¤ºé¡¶ç‚¹ä½ç½®ï¼Œ<code>NORMAL</code>è¡¨ç¤ºé¡¶ç‚¹æ³•çº¿ã€‚ é€šå¸¸ï¼Œé¡¶ç‚¹æ•°æ®è¾“å…¥åœ¨ç»“æ„ä¸­å£°æ˜ï¼Œè€Œä¸æ˜¯é€ä¸ªåˆ—å‡ºã€‚<code>UnityCG.cginc</code>æ–‡ä»¶ä¸­å®šä¹‰äº†å‡ ä¸ªå¸¸ç”¨çš„é¡¶ç‚¹ç»“æ„ï¼š</p><ul><li><code>appdata_base</code> ï¼š ä½ç½®ã€æ³•çº¿ å’Œä¸€ä¸ªçº¹ç†åæ ‡ã€‚</li><li><code>appdata_tan</code> ï¼š ä½ç½®ã€åˆ‡çº¿ã€æ³•çº¿ å’Œä¸€ä¸ªçº¹ç†åæ ‡ã€‚</li><li><code>appdata_full</code> ï¼š ä½ç½®ã€åˆ‡çº¿ã€æ³•çº¿ å’Œå››ä¸ªçº¹ç†åæ ‡ã€‚</li></ul><p>è¦è®¿é—®ä¸åŒçš„é¡¶ç‚¹æ•°æ®ï¼Œæ‚¨éœ€è¦è‡ªå·±å£°æ˜ é¡¶ç‚¹ç»“æ„ï¼Œæˆ–è€…å°†è¾“å…¥å‚æ•°æ·»åŠ åˆ°é¡¶ç‚¹ç€è‰²å™¨ã€‚é¡¶ç‚¹æ•°æ®ç”± Cg/HLSL è¯­ä¹‰æ ‡è¯†ï¼Œå¹¶ä¸”å¿…é¡»æ¥è‡ª ä»¥ä¸‹åˆ—è¡¨ï¼š</p><ul><li>POSITION æ˜¯é¡¶ç‚¹ä½ç½®ï¼Œé€šå¸¸ä¸º float3 æˆ– float4ã€‚</li><li>NORMAL æ˜¯é¡¶ç‚¹æ³•çº¿ï¼Œé€šå¸¸ä¸º float3ã€‚</li><li>TEXCOORD0 æ˜¯ç¬¬ä¸€ä¸ª UV åæ ‡ï¼Œé€šå¸¸ä¸º float2ã€float3 æˆ– float4ã€‚</li><li>TEXCOORD1ã€TEXCOORD2 å’Œ TEXCOORD3 åˆ†åˆ«æ˜¯ç¬¬ 2ã€ç¬¬ 3 å’Œç¬¬ 4 ä¸ª UVåæ ‡ã€‚</li><li><strong>TANGENT æ˜¯åˆ‡çº¿çŸ¢é‡ï¼ˆç”¨äºæ³•çº¿è´´å›¾ï¼‰ï¼Œé€šå¸¸ä¸ºfloat4</strong>ã€‚</li><li>COLOR æ˜¯æ¯é¡¶ç‚¹é¢œè‰²ï¼Œé€šå¸¸ä¸º float4ã€‚</li></ul><p>å½“ç½‘æ ¼æ•°æ®åŒ…å«çš„åˆ†é‡å°‘äºé¡¶ç‚¹ç€è‰²å™¨è¾“å…¥æ‰€éœ€çš„åˆ†é‡æ—¶ï¼Œå…¶ä½™éƒ¨åˆ†ç”¨é›¶å¡«å……ï¼Œä½†é»˜è®¤å€¼ä¸º 1 çš„ .wåˆ†é‡é™¤å¤–ã€‚ä¾‹å¦‚ï¼Œç½‘æ ¼çº¹ç†åæ ‡ é€šå¸¸æ˜¯ä»…åŒ…å« x å’Œ y åˆ†é‡çš„ 2D çŸ¢é‡ã€‚å¦‚æœé¡¶ç‚¹ç€è‰²å™¨ä½¿ç”¨ TEXCOORD0 è¯­ä¹‰å£°æ˜ä¸€ä¸ª float4 è¾“å…¥ï¼Œåˆ™é¡¶ç‚¹ç€è‰²å™¨æ¥æ”¶çš„å€¼å°†åŒ…å« (x,y,0,1)ã€‚</p><h3 id="å¯è§†åŒ–-uv">å¯è§†åŒ– uv</h3><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Shader <span class="st">"Debug/UV 1"</span> <span class="op">{</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>SubShader <span class="op">{</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    Pass <span class="op">{</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        CGPROGRAM</span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#pragma vertex vert</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#pragma fragment frag</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"UnityCG.cginc"</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é¡¶ç‚¹è¾“å…¥ï¼šä½ç½®ã€UV</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> appdata <span class="op">{</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            float4 vertex <span class="op">:</span> POSITION<span class="op">;</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>            float4 texcoord <span class="op">:</span> TEXCOORD0<span class="op">;</span> <span class="co">//ç¬¬ä¸€ç»„uv</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> v2f <span class="op">{</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            float4 pos <span class="op">:</span> SV_POSITION<span class="op">;</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>            float4 uv <span class="op">:</span> TEXCOORD0<span class="op">;</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        v2f vert <span class="op">(</span>appdata v<span class="op">)</span> <span class="op">{</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>            v2f o<span class="op">;</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>            o<span class="op">.</span>pos <span class="op">=</span> UnityObjectToClipPos<span class="op">(</span>v<span class="op">.</span>vertex <span class="op">);</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            o<span class="op">.</span>uv <span class="op">=</span> float4<span class="op">(</span> v<span class="op">.</span>texcoord<span class="op">.</span>xy<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span> <span class="op">);</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> o<span class="op">;</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        half4 frag<span class="op">(</span> v2f i <span class="op">)</span> <span class="op">:</span> SV_Target <span class="op">{</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>            half4 c <span class="op">=</span> frac<span class="op">(</span> i<span class="op">.</span>uv <span class="op">);</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>any<span class="op">(</span>saturate<span class="op">(</span>i<span class="op">.</span>uv<span class="op">)</span> <span class="op">-</span> i<span class="op">.</span>uv<span class="op">))</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>                c<span class="op">.</span>b <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> c<span class="op">;</span></span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        ENDCG</span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><h3 id="å¯è§†åŒ–é¡¶ç‚¹é¢œè‰²ç›´æ¥è¾“å‡ºé¡¶ç‚¹çš„é¢œè‰²">å¯è§†åŒ–é¡¶ç‚¹é¢œè‰²(ç›´æ¥è¾“å‡ºé¡¶ç‚¹çš„é¢œè‰²)</h3><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Shader <span class="st">"Debug/Vertex color"</span> <span class="op">{</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>SubShader <span class="op">{</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    Pass <span class="op">{</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        CGPROGRAM</span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#pragma vertex vert</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#pragma fragment frag</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"UnityCG.cginc"</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é¡¶ç‚¹è¾“å…¥ï¼šä½ç½®ã€é¢œè‰²</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> appdata <span class="op">{</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            float4 vertex <span class="op">:</span> POSITION<span class="op">;</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>            fixed4 color <span class="op">:</span> COLOR<span class="op">;</span>  <span class="co">// é¡¶ç‚¹çš„é¢œè‰²</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> v2f <span class="op">{</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>            float4 pos <span class="op">:</span> SV_POSITION<span class="op">;</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>            fixed4 color <span class="op">:</span> COLOR<span class="op">;</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        v2f vert <span class="op">(</span>appdata v<span class="op">)</span> <span class="op">{</span></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>            v2f o<span class="op">;</span></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>            o<span class="op">.</span>pos <span class="op">=</span> UnityObjectToClipPos<span class="op">(</span>v<span class="op">.</span>vertex <span class="op">);</span></span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>            o<span class="op">.</span>color <span class="op">=</span> v<span class="op">.</span>color<span class="op">;</span></span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> o<span class="op">;</span></span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        fixed4 frag <span class="op">(</span>v2f i<span class="op">)</span> <span class="op">:</span> SV_Target <span class="op">{</span> <span class="cf">return</span> i<span class="op">.</span>color<span class="op">;</span> <span class="op">}</span></span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        ENDCG</span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><h3 id="å¯è§†åŒ–æ³•çº¿">å¯è§†åŒ–æ³•çº¿</h3><p>ä»¥ä¸‹ç€è‰²å™¨ä½¿ç”¨é¡¶ç‚¹ä½ç½®å’Œæ³•çº¿ä½œä¸ºé¡¶ç‚¹ç€è‰²å™¨è¾“å…¥ï¼ˆåœ¨ç»“æ„ appdataä¸­å®šä¹‰ï¼‰ã€‚æ³•çº¿çš„ Xã€Y å’Œ Z åˆ†é‡å¯è§†åŒ–ä¸º RGB é¢œè‰²ã€‚ç”±äºæ³•çº¿åˆ†é‡åœ¨ â€“1 åˆ° 1èŒƒå›´å†…ï¼Œæˆ‘ä»¬å¯¹è¿™äº›åˆ†é‡è¿›è¡Œç¼©æ”¾å’Œåç½®ï¼Œä½¿è¾“å‡ºé¢œè‰²å¯åœ¨ 0 åˆ° 1èŒƒå›´å†…æ˜¾ç¤ºã€‚</p><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Shader <span class="st">"Debug/Normals"</span> <span class="op">{</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>SubShader <span class="op">{</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    Pass <span class="op">{</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        CGPROGRAM</span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#pragma vertex vert</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#pragma fragment frag</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"UnityCG.cginc"</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é¡¶ç‚¹è¾“å…¥ï¼šä½ç½®ã€æ³•çº¿</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> appdata <span class="op">{</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>            float4 vertex <span class="op">:</span> POSITION<span class="op">;</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>            float3 normal <span class="op">:</span> NORMAL<span class="op">;</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> v2f <span class="op">{</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>            float4 pos <span class="op">:</span> SV_POSITION<span class="op">;</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>            fixed4 color <span class="op">:</span> COLOR<span class="op">;</span></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        v2f vert <span class="op">(</span>appdata v<span class="op">)</span> <span class="op">{</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>            v2f o<span class="op">;</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>            o<span class="op">.</span>pos <span class="op">=</span> UnityObjectToClipPos<span class="op">(</span>v<span class="op">.</span>vertex <span class="op">);</span></span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>            <span class="co">// (-1, 1) è½¬æ¢åˆ° ï¼ˆ0ï¼Œ 1ï¼‰</span></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>            o<span class="op">.</span>color<span class="op">.</span>xyz <span class="op">=</span> v<span class="op">.</span>normal <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">;</span></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>            o<span class="op">.</span>color<span class="op">.</span>w <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> o<span class="op">;</span></span><span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        fixed4 frag <span class="op">(</span>v2f i<span class="op">)</span> <span class="op">:</span> SV_Target <span class="op">{</span> <span class="cf">return</span> i<span class="op">.</span>color<span class="op">;</span> <span class="op">}</span></span><span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>        ENDCG</span><span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><h3 id="å¯è§†åŒ–åˆ‡çº¿å’Œå‰¯æ³•çº¿">å¯è§†åŒ–åˆ‡çº¿å’Œå‰¯æ³•çº¿</h3><p>åˆ‡çº¿å’Œå‰¯æ³•çº¿çŸ¢é‡ç”¨äºæ³•çº¿è´´å›¾ã€‚åœ¨ Unityä¸­ï¼Œåªæœ‰åˆ‡çº¿çŸ¢é‡å­˜å‚¨åœ¨é¡¶ç‚¹ä¸­ï¼Œè€Œå‰¯æ³•çº¿æ˜¯ä»æ³•çº¿å€¼å’Œåˆ‡çº¿å€¼ä¸­æ¨å¯¼å‡ºçš„ã€‚</p><div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Shader <span class="st">"Debug/Tangents"</span> <span class="op">{</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>SubShader <span class="op">{</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    Pass <span class="op">{</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        CGPROGRAM</span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#pragma vertex vert</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#pragma fragment frag</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"UnityCG.cginc"</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é¡¶ç‚¹è¾“å…¥ï¼šä½ç½®ã€åˆ‡çº¿</span></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> appdata <span class="op">{</span></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            float4 vertex <span class="op">:</span> POSITION<span class="op">;</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>            float4 tangent <span class="op">:</span> TANGENT<span class="op">;</span></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> v2f <span class="op">{</span></span><span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>            float4 pos <span class="op">:</span> SV_POSITION<span class="op">;</span></span><span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>            fixed4 color <span class="op">:</span> COLOR<span class="op">;</span></span><span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span><span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        v2f vert <span class="op">(</span>appdata v<span class="op">)</span> <span class="op">{</span></span><span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>            v2f o<span class="op">;</span></span><span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>            o<span class="op">.</span>pos <span class="op">=</span> UnityObjectToClipPos<span class="op">(</span>v<span class="op">.</span>vertex <span class="op">);</span></span><span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>            o<span class="op">.</span>color <span class="op">=</span> v<span class="op">.</span>tangent <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">;</span></span><span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> o<span class="op">;</span></span><span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>        fixed4 frag <span class="op">(</span>v2f i<span class="op">)</span> <span class="op">:</span> SV_Target <span class="op">{</span> <span class="cf">return</span> i<span class="op">.</span>color<span class="op">;</span> <span class="op">}</span></span><span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        ENDCG</span><span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>Shader <span class="st">"Debug/Bitangents"</span> <span class="op">{</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>SubShader <span class="op">{</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    Pass <span class="op">{</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        Fog <span class="op">{</span> Mode Off <span class="op">}</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        CGPROGRAM</span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#pragma vertex vert</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#pragma fragment frag</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"UnityCG.cginc"</span></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é¡¶ç‚¹è¾“å…¥ï¼šä½ç½®ã€æ³•çº¿ã€åˆ‡çº¿</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> appdata <span class="op">{</span></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            float4 vertex <span class="op">:</span> POSITION<span class="op">;</span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>            float3 normal <span class="op">:</span> NORMAL<span class="op">;</span></span><span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            float4 tangent <span class="op">:</span> TANGENT<span class="op">;</span></span><span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span><span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">struct</span> v2f <span class="op">{</span></span><span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            float4 pos <span class="op">:</span> SV_POSITION<span class="op">;</span></span><span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>            float4 color <span class="op">:</span> COLOR<span class="op">;</span></span><span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span><span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        v2f vert <span class="op">(</span>appdata v<span class="op">)</span> <span class="op">{</span></span><span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>            v2f o<span class="op">;</span></span><span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>            o<span class="op">.</span>pos <span class="op">=</span> UnityObjectToClipPos<span class="op">(</span>v<span class="op">.</span>vertex <span class="op">);</span></span><span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ä¸‰è€…å‚ç›´ï¼Œè®¡ç®—åŒåˆ‡çº¿,</span></span><span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>            float3 bitangent <span class="op">=</span> cross<span class="op">(</span> v<span class="op">.</span>normal<span class="op">,</span> v<span class="op">.</span>tangent<span class="op">.</span>xyz <span class="op">)</span> <span class="op">*</span> v<span class="op">.</span>tangent<span class="op">.</span>w<span class="op">;</span></span><span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>            o<span class="op">.</span>color<span class="op">.</span>xyz <span class="op">=</span> bitangent <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">;</span></span><span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>            o<span class="op">.</span>color<span class="op">.</span>w <span class="op">=</span> <span class="fl">1.0</span><span class="op">;</span></span><span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> o<span class="op">;</span></span><span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>        fixed4 frag <span class="op">(</span>v2f i<span class="op">)</span> <span class="op">:</span> SV_Target <span class="op">{</span> <span class="cf">return</span> i<span class="op">.</span>color<span class="op">;</span> <span class="op">}</span></span><span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>        ENDCG</span><span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/shader/3.zhao-se-qi-shu-xing/"/>
      <url>/2022/08/10/unity/shader/3.zhao-se-qi-shu-xing/</url>
      
        <content type="html"><![CDATA[<h1 id="ç€è‰²å™¨å±æ€§">ç€è‰²å™¨å±æ€§</h1><h2 id="ä½¿ç”¨cghlsl-è®¿é—®ç€è‰²å™¨å±æ€§">ä½¿ç”¨Cg/HLSL è®¿é—®ç€è‰²å™¨å±æ€§</h2><p>ç€è‰²å™¨åœ¨<code>Properties</code>ä»£ç å—ä¸­å£°æ˜æè´¨å±æ€§ã€‚å¦‚æœè¦åœ¨ç€è‰²å™¨ç¨‹åºä¸­è®¿é—®å…¶ä¸­ä¸€äº›å±æ€§ï¼Œåˆ™éœ€è¦å£°æ˜å…·æœ‰ç›¸åŒåç§°å’ŒåŒ¹é…ç±»å‹çš„<code>Cg/HLSL</code>å˜é‡ã€‚</p><p>ç€è‰²å™¨å±æ€§ï¼š</p><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">//å½¢å¼ï¼š</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Cg/HLSLå˜é‡åç§° ï¼ˆ"Inspectorä¸­æ˜¾ç¤ºçš„åç§°", ç±»å‹ï¼‰= é»˜è®¤å€¼</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>_MyColor <span class="op">(</span><span class="st">"Some Color"</span><span class="op">,</span> Color<span class="op">)</span> <span class="op">=</span> <span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="dv">1</span><span class="op">)</span> </span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>_MyVector <span class="op">(</span><span class="st">"Some Vector"</span><span class="op">,</span> Vector<span class="op">)</span> <span class="op">=</span> <span class="op">(</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">,</span><span class="dv">0</span><span class="op">)</span> </span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>_MyFloat <span class="op">(</span><span class="st">"My float"</span><span class="op">,</span> Float<span class="op">)</span> <span class="op">=</span> <span class="fl">0.5</span> </span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>_MyTexture <span class="op">(</span><span class="st">"Texture"</span><span class="op">,</span> <span class="dv">2</span><span class="er">D</span><span class="op">)</span> <span class="op">=</span> <span class="st">"white"</span> <span class="op">{}</span> </span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>_MyCubemap <span class="op">(</span><span class="st">"Cubemap"</span><span class="op">,</span> CUBE<span class="op">)</span> <span class="op">=</span> <span class="st">""</span> <span class="op">{}</span></span></code></pre></div><p>Cg/HLSL ä»£ç è¿›è¡Œå£°æ˜ä»¥ä¾›è®¿é—®:</p><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>fixed4 _MyColor<span class="op">;</span> <span class="co">// ä½ç²¾åº¦ç±»å‹å¯¹äºé¢œè‰²è€Œè¨€é€šå¸¸å·²ç»è¶³å¤Ÿ</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>float4 _MyVector<span class="op">;</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> _MyFloat<span class="op">;</span> </span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>sampler2D _MyTexture<span class="op">;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>samplerCUBE _MyCubemap<span class="op">;</span></span></code></pre></div><p>åŒæ—¶ Cg/HLSL è¿˜å¯ä»¥æ¥å— <strong>uniform</strong> å…³é”®å­—ï¼Œä½†è¯¥å…³é”®å­—ä¸æ˜¯å¿…é¡»çš„ï¼š</p><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>uniform float4 _MyColor<span class="op">;</span></span></code></pre></div><p>ShaderLab ä¸­çš„å±æ€§ç±»å‹ä»¥å¦‚ä¸‹æ–¹å¼æ˜ å°„åˆ° Cg/HLSL å˜é‡ç±»å‹ï¼š</p><ul><li>Color å’Œ Vector å±æ€§æ˜ å°„åˆ°<strong>float4</strong>ã€<strong>half4</strong> æˆ–<strong>fixed4</strong> å˜é‡ã€‚</li><li>Range å’Œ Float å±æ€§æ˜ å°„åˆ°<strong>float</strong>ã€<strong>half</strong> æˆ– <strong>fixed</strong>å˜é‡ã€‚</li><li>å¯¹äºæ™®é€š (2D) çº¹ç†ï¼ŒTexture å±æ€§æ˜ å°„åˆ° <strong>sampler2D</strong>å˜é‡ï¼›ç«‹æ–¹ä½“è´´å›¾ (Cubemap) æ˜ å°„åˆ° <strong>samplerCUBE__</strong>ï¼›3Dçº¹ç†æ˜ å°„åˆ° <strong>sampler3D__</strong>ã€‚</li></ul><h2 id="å‘ç€è‰²å™¨æä¾›å±æ€§å€¼">å‘ç€è‰²å™¨æä¾›å±æ€§å€¼</h2><p>åœ¨ä¸‹åˆ—ä½ç½®ä¸­æŸ¥æ‰¾ç€è‰²å™¨å±æ€§å€¼å¹¶æä¾›ç»™ç€è‰²å™¨ï¼š</p><ul><li>MaterialPropertyBlockä¸­è®¾ç½®çš„æ¯æ¸²æŸ“å™¨å€¼ã€‚è¿™é€šå¸¸æ˜¯â€œæ¯å®ä¾‹â€æ•°æ®ï¼ˆä¾‹å¦‚ï¼Œå…¨éƒ¨å…±äº«ç›¸åŒæè´¨çš„è®¸å¤šå¯¹è±¡çš„è‡ªå®šä¹‰ç€è‰²é¢œè‰²ï¼‰ã€‚</li><li>åœ¨æ¸²æŸ“çš„å¯¹è±¡ä¸Šä½¿ç”¨çš„æè´¨ä¸­è®¾ç½®çš„å€¼ã€‚</li><li>å…¨å±€ç€è‰²å™¨å±æ€§ï¼Œé€šè¿‡ Unityæ¸²æŸ“ä»£ç è‡ªèº«è®¾ç½®ï¼ˆè¯·å‚é˜…å†…ç½®ç€è‰²å™¨å˜é‡ï¼‰ï¼Œæˆ–é€šè¿‡æ‚¨è‡ªå·±çš„è„šæœ¬æ¥è®¾ç½®ï¼ˆä¾‹å¦‚Shader.SetGlobalTextureï¼‰ã€‚</li></ul><p>ä¼˜å…ˆé¡ºåºå¦‚ä¸Šæ‰€è¿°ï¼šæ¯å®ä¾‹æ•°æ®è¦†ç›–æ‰€æœ‰å†…å®¹ï¼›ç„¶åä½¿ç”¨æè´¨æ•°æ®ï¼›æœ€åï¼Œå¦‚æœè¿™ä¸¤ä¸ªåœ°æ–¹ä¸å­˜åœ¨ç€è‰²å™¨å±æ€§ï¼Œåˆ™ä½¿ç”¨å…¨å±€å±æ€§å€¼ã€‚æœ€ç»ˆï¼Œå¦‚æœåœ¨ä»»ä½•åœ°æ–¹éƒ½æ²¡æœ‰å®šä¹‰ç€è‰²å™¨å±æ€§å€¼ï¼Œåˆ™å°†æä¾›â€œé»˜è®¤å€¼â€ï¼ˆæµ®ç‚¹æ•°çš„é»˜è®¤å€¼ä¸ºé›¶ï¼Œé¢œè‰²çš„é»˜è®¤å€¼ä¸ºé»‘è‰²ï¼Œçº¹ç†çš„é»˜è®¤å€¼ä¸ºç©ºçš„ç™½è‰²çº¹ç†ï¼‰ã€‚</p><h2 id="åºåˆ—åŒ–å’Œè¿è¡Œæ—¶æè´¨å±æ€§">åºåˆ—åŒ–å’Œè¿è¡Œæ—¶æè´¨å±æ€§</h2><p>æè´¨å¯ä»¥åŒæ—¶åŒ…å«åºåˆ—åŒ–å±æ€§å€¼å’Œè¿è¡Œæ—¶è®¾ç½®çš„å±æ€§å€¼ã€‚</p><ul><li><p>åºåˆ—åŒ–çš„æ•°æ®æ˜¯åœ¨ç€è‰²å™¨çš„<code>Properties</code>ä»£ç ä¸­å®šä¹‰çš„æ‰€æœ‰å±æ€§ã€‚é€šå¸¸ï¼Œè¿™äº›æ˜¯éœ€è¦å‚¨å­˜åœ¨æè´¨çš„å€¼ï¼Œå¹¶ä¸”å¯ç”±ç”¨æˆ·åœ¨æè´¨çš„<code>Inspector</code>é¢æ¿ä¸­è¿›è¡Œè°ƒæ•´ã€‚</p></li><li><p>æè´¨ä¹Ÿå¯ä»¥å…·æœ‰ç€è‰²å™¨ä½¿ç”¨çš„ä¸€äº›å±æ€§ï¼Œä½†ä¸åœ¨ç€è‰²å™¨çš„<code>Properties</code>ä»£ç å—ä¸­å£°æ˜ã€‚é€šå¸¸ï¼Œè¿™é€‚ç”¨äºè¿è¡Œæ—¶ä»è„šæœ¬ä»£ç (egï¼Œ<code>Material.SetColor</code>)è®¾ç½®çš„å±æ€§ã€‚<strong>çŸ©é˜µå’Œæ•°ç»„åªèƒ½ä½œä¸ºéåºåˆ—åŒ–çš„è¿è¡Œæ—¶å±æ€§å­˜åœ¨(å› ä¸ºæ— æ³•åœ¨Propertiesä»£ç å—ä¸­å®šä¹‰ä»–ä»¬)ã€‚</strong></p></li></ul><h2 id="ç‰¹æ®Šçº¹ç†å±æ€§">ç‰¹æ®Šçº¹ç†å±æ€§</h2><p>å¯¹äºè®¾ç½®ä¸ºç§è‰²å™¨/æè´¨å±æ€§çš„æ¯ä¸ªçº¹ç†ï¼ŒUnityè¿˜ä¼šåœ¨å…¶ä»–çŸ¢é‡å±æ€§ä¸­è®¾ç½®ä¸€äº›é¢å¤–ä¿¡æ¯ã€‚</p><h3 id="çº¹ç†å¹³é“ºå’Œåç§»">çº¹ç†å¹³é“ºå’Œåç§»</h3><p>æè´¨é€šå¸¸å…·æœ‰çº¹ç†å±æ€§çš„ <code>Tiling</code> å’Œ<code>Offset</code>å­—æ®µã€‚ <strong>æ­¤ä¿¡æ¯å°†ä¼ é€’åˆ°ç€è‰²å™¨çš„ float4{TextureName}_ST å±æ€§</strong>ï¼š</p><ul><li><code>x</code> åŒ…å« Xå¹³é“ºå€¼</li><li><code>y</code> åŒ…å« Yå¹³é“ºå€¼</li><li><code>z</code> åŒ…å« Xåç§»å€¼</li><li><code>w</code> åŒ…å« Yåç§»å€¼</li></ul><p>ä¾‹å¦‚ï¼Œç€è‰²å™¨åŒ…å«åä¸º <code>_MainTex</code>çš„çº¹ç†ï¼Œåˆ™å¹³é“ºä¿¡æ¯ä¸º<code>_MainTex_ST</code> ä¸­ã€‚</p><h3 id="çº¹ç†å¤§å°">çº¹ç†å¤§å°</h3><p>{TextureName}_TexelSize -float4å±æ€§,åŒ…å«çº¹ç†å¤§å°ä¿¡æ¯ã€‚</p><ul><li><code>x</code> åŒ…å« 1.0/å®½åº¦</li><li><code>y</code> åŒ…å« 1.0/é«˜åº¦</li><li><code>z</code> åŒ…å« å®½åº¦</li><li><code>w</code> åŒ…å« é«˜åº¦</li></ul><h3 id="çº¹ç†-hdr-å‚æ•°">çº¹ç† HDR å‚æ•°</h3><p>{TextureName}_HDR-float4å±æ€§,åŒ…å«æœ‰å…³å¦‚ä½•æ ¹æ®æ‰€ä½¿ç”¨çš„<code>é¢œè‰²ç©ºé—´</code> è§£ç æ½œåœ¨<code>HDR</code>(ä¾‹å¦‚ RGBM ç¼–ç ) çº¹ç†ä¿¡æ¯ã€‚å‚è§<code>DecodeHDR å‡½æ•°</code></p><h3 id="é¢œè‰²ç©ºé—´å’Œé¢œè‰²çŸ¢é‡ç€è‰²å™¨æ•°æ®"><strong>é¢œè‰²ç©ºé—´å’Œé¢œè‰²/çŸ¢é‡ç€è‰²å™¨æ•°æ®</strong></h3><p>ä½¿ç”¨<code>çº¿æ€§é¢œè‰²ç©ºé—´</code>æ—¶ï¼Œæ‰€æœ‰æè´¨é¢œè‰²å±æ€§å‡ä»¥<code>sRGB</code>é¢œè‰²æä¾›ï¼Œä½†åœ¨ä¼ é€’åˆ°ç€è‰²å™¨æ—¶ä¼šè½¬æ¢ä¸ºçº¿æ€§å€¼ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœ Properties ç€è‰²å™¨ä»£ç å—åŒ…å«åä¸ºâ€œMyColorâ€œçš„ Colorå±æ€§ï¼Œåˆ™ç›¸åº”çš„â€MyColorâ€HLSL å˜é‡å°†è·å¾—çº¿æ€§é¢œè‰²å€¼ã€‚</p><p>å¯¹äºæ ‡è®°ä¸º Float æˆ– Vectorç±»å‹çš„å±æ€§ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸è¿›è¡Œé¢œè‰²ç©ºé—´è½¬æ¢ï¼›è€Œæ˜¯å‡è®¾å®ƒä»¬åŒ…å«éé¢œè‰²æ•°æ®ã€‚å¯ä¸ºæµ®ç‚¹/çŸ¢é‡å±æ€§æ·»åŠ [Gamma] ç‰¹æ€§ï¼Œä»¥è¡¨ç¤ºå®ƒä»¬æ˜¯ä»¥ sRGBç©ºé—´æŒ‡å®šï¼Œå°±åƒé¢œè‰²ä¸€æ ·ï¼ˆè¯·å‚é˜…å±æ€§ï¼‰ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/shader/2.unlitshader/"/>
      <url>/2022/08/10/unity/shader/2.unlitshader/</url>
      
        <content type="html"><![CDATA[<h1 id="unlitshaderç€è‰²å™¨">UnlitShaderç€è‰²å™¨</h1><blockquote><p>Unityçš„ShaderLabæœ€å—æ¬¢è¿çš„Shaderæ–¹å¼ã€‚ç€è‰²å™¨ä»£ç æ˜¯ç”¨<code>HLSLè¯­è¨€</code>ç¼–å†™ï¼Œåœ¨ç€è‰²å™¨æ–‡æœ¬çš„<code>Passå‘½ä»¤</code>ä¸­åµŒå…¥<code>ä»£ç ç‰‡æ®µ</code>eg:</p></blockquote><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a> Pass <span class="op">{</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ...å¸¸è§„é€šé“çŠ¶æ€è®¾ç½® ...</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>      </span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        CGPROGRAM</span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// æ­¤ä»£ç ç‰‡æ®µçš„ç¼–è¯‘æŒ‡ä»¤ï¼Œä¾‹å¦‚ï¼š</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#pragma vertex vert</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="pp">#pragma fragment frag</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>      </span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Cg/HLSL ä»£ç æœ¬èº«</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>      </span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        ENDCG</span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ...é€šé“è®¾ç½®çš„å‰©ä½™éƒ¨åˆ† ...</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><h2 id="hlsl-ä»£ç ç‰‡æ®µ">HLSL ä»£ç ç‰‡æ®µ</h2><p>HLSL ç¨‹åºä»£ç å†™å…¥åˆ° <strong>CGPROGRAM</strong> å’Œ<strong>ENDCG</strong> å…³é”®å­—ä¹‹é—´ã€‚æˆ–è€…<strong>HLSLPROGRAM</strong>å’Œ<strong>ENDHLSL</strong>ä¹‹é—´ï¼Œåä¸€ç§å½¢å¼ä¸ä¼šè‡ªåŠ¨åŒ…å«<code>HLSLSupport</code>å’Œ<code>UnityShaderVariables</code>å†…ç½®å¤´æ–‡ä»¶ã€‚</p><p>åœ¨ä»£ç ç‰‡æ®µçš„å¼€å¤´ï¼Œå¯ä½¿ç”¨<strong>#pragma</strong>è¯­å¥çš„å½¢å¼æä¾›ç¼–è¯‘æŒ‡ä»¤ã€‚ æŒ‡å®šç¼–è¯‘çš„ç€è‰²å™¨å‡½æ•°: *#pragma vertex name-ä½œä¸ºé¡¶ç‚¹ç€è‰²å™¨æ¥ç¼–è¯‘å‡½æ•°name * #pragma fragmentname-ä½œä¸ºç‰‡å…ƒç€è‰²å™¨æ¥ç¼–è¯‘å‡½æ•°name</p><ul><li>#pragma geometryname-ä½œä¸º<strong>DX10</strong>å‡ ä½•ç€è‰²å™¨æ¥ç¼–è¯‘å‡½æ•°nameã€‚å¦‚ä¸‹æ‰€è¿°ï¼Œè®¾ç½®æ­¤é€‰é¡¹ä¼šè‡ªåŠ¨å¼€å¯#pragma taeget 4.0ã€‚</li><li>#pragma hullname-ä½œä¸º<strong>DX11</strong>å¤–å£³ç€è‰²å™¨æ¥ç¼–è¯‘å‡½æ•°nameã€‚å¦‚ä¸‹æ‰€è¿°ï¼Œè®¾ç½®æ­¤é€‰é¡¹ä¼šè‡ªåŠ¨å¼€å¯#pragma taeget 5.0ã€‚</li><li>#pragma domainname-ä½œä¸º<strong>DX11</strong>åŸŸç€è‰²å™¨æ¥ç¼–è¯‘å‡½æ•°nameã€‚å¦‚ä¸‹æ‰€è¿°ï¼Œè®¾ç½®æ­¤é€‰é¡¹ä¼šè‡ªåŠ¨å¼€å¯#pragma taeget 5.0ã€‚</li></ul><p>å…¶ä»–ç¼–è¯‘æŒ‡ä»¤ï¼š</p><ul><li><p>#pragma targetname-è¦ç¼–è¯‘åˆ°çš„ç€è‰²å™¨<code>Unity GPI</code>ç›®æ ‡ã€‚</p></li><li><p>#pragma require featureâ€¦-å¯¹ç€è‰²å™¨éœ€è¦çš„GPUåŠŸèƒ½è¿›è¡Œ<strong>ç²¾ç»†æ§åˆ¶</strong>ã€‚</p></li><li><p>#pragma only_renderers ç©ºæ ¼åˆ†éš”çš„åç§° -ä»…ä¸ºç»™å®šçš„æ¸²æŸ“å™¨ç¼–è¯‘ç€è‰²å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ä¸ºæ‰€æœ‰æ¸²æŸ“å™¨ç¼–è¯‘ç€è‰²å™¨ã€‚</p></li><li><p>#pragma exclude_renderers ç©ºæ ¼åˆ†éš”çš„åç§° -ä¸ä¸ºç»™å®šæ¸²æŸ“å™¨ç¼–è¯‘ç€è‰²å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ä¸ºæ‰€æœ‰æ¸²æŸ“å™¨ç¼–è¯‘ç€è‰²å™¨ã€‚</p></li><li><p>#pragma multi_compile â€¦ - ç”¨äºå¤„ç†å¤šä¸ªç€è‰²å™¨å˜ä½“ã€‚</p></li><li><p>#pragma enable_d3d11_debug_symbols - ä¸ºé’ˆå¯¹ <strong>DirectX11</strong> ç¼–è¯‘çš„ç€è‰²å™¨ç”Ÿæˆè°ƒè¯•ä¿¡æ¯ï¼Œè¿™å°†å…è®¸æ‚¨é€šè¿‡ <strong>VisualStudio 2012ï¼ˆæˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰å›¾å½¢è°ƒè¯•å™¨</strong>æ¥è°ƒè¯•ç€è‰²å™¨ã€‚</p></li><li><p>#pragma hardware_tier_variants æ¸²æŸ“å™¨åç§° -ä¸ºæ¯ä¸ªå¯ä»¥è¿è¡Œæ‰€é€‰æ¸²æŸ“å™¨çš„ç¡¬ä»¶å±‚ç”Ÿæˆæ¯ä¸ªç¼–è¯‘ç€è‰²å™¨çš„å¤šä¸ªç€è‰²å™¨ç¡¬ä»¶å˜ä½“ã€‚</p></li><li><p>#pragmahlslcc_bytecode_disassembly-å°†åˆ†è§£çš„HLSLccå­—èŠ‚ç åµŒå…¥ç¿»è¯‘çš„ç€è‰²å™¨ä¸­ã€‚</p></li><li><p>#pragma disable_fastmath - å¯ç”¨ç²¾ç¡®çš„IEEE754è§„åˆ™ï¼Œä¸»è¦æ¶‰åŠNaNå¤„ç†(ç›®å‰åªå½±å“<strong>Metal</strong>å¹³å°)ã€‚</p></li><li><p>#pragma glsl_es2 - å½“åœ¨ä¸€ä¸ªGLSLç€è‰²å™¨ä¸­è®¾ç½®ï¼Œç”Ÿæˆä¸€ä¸ªGLSL ES1.0(OpenGL ES 2.0)ï¼Œå³ä½¿ç€è‰²å™¨ç›®æ ‡æ˜¯OpenGL ES 3</p></li></ul><p><strong>æ¯ä¸ªä»£ç ç‰‡æ®µå¿…é¡»è‡³å°‘åŒ…å«ä¸€ä¸ªé¡¶ç‚¹ç¨‹åºå’Œä¸€ä¸ªç‰‡å…ƒç¨‹åºã€‚å› æ­¤ï¼Œ#pragmavertex å’Œ #pragma fragment æŒ‡ä»¤æ˜¯å¿…éœ€çš„ã€‚</strong> ä» Unity 5.0å¼€å§‹ä¸æ‰§è¡Œä»»ä½•æ“ä½œå¹¶ä¸”å¯ä»¥å®‰å…¨åˆ é™¤çš„ç¼–è¯‘æŒ‡ä»¤ï¼š#pragma glslã€#pragmaglsl_no_auto_normalizationã€#pragma profileoption å’Œ #pragmafragmentoptionã€‚ Unity ä»…æ”¯æŒç€è‰²å™¨æ–‡ä»¶ä¸­çš„ <code>#pragma</code>æŒ‡ä»¤ï¼Œè€Œä¸æ”¯æŒ <code>include</code> ä¸­çš„æŒ‡ä»¤ã€‚</p><h2 id="æ¸²æŸ“å¹³å°">æ¸²æŸ“å¹³å°</h2><p>Unity æ”¯æŒå¤šç§æ¸²æŸ“ APIï¼ˆä¾‹å¦‚ Direct3D 11 å’ŒOpenGLï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç€è‰²å™¨ç¨‹åºéƒ½ç¼–è¯‘åˆ°æ‰€æœ‰æ”¯æŒçš„æ¸²æŸ“å™¨ä¸­ã€‚æ‚¨å¯ä»¥ä½¿ç”¨#pragma only_renderers æˆ– #pragma exclude_renderersæŒ‡ä»¤æŒ‡ç¤ºè¦ç¼–è¯‘åˆ°çš„æ¸²æŸ“å™¨ã€‚å¦‚æœæ‚¨ç¡®ä¿¡è‡ªå·±æ˜¾å¼ä½¿ç”¨çš„ä¸€äº›ç€è‰²å™¨è¯­è¨€åŠŸèƒ½åœ¨æŸäº›å¹³å°ä¸Šæ— æ³•å®ç°ï¼Œè¿™æ ·åšå°†éå¸¸æœ‰ç”¨ã€‚</p><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">//ä»…ä¼šå°†ç€è‰²å™¨ç¼–è¯‘åˆ° D3D11 æ¨¡å¼</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma only_renderers d3d11</span></span></code></pre></div><p>æ”¯æŒçš„æ¸²æŸ“å™¨åç§°åŒ…æ‹¬ï¼š</p><ul><li>d3d11 - Direct3D 11/12</li><li>glcore - OpenGL 3.x/4.x</li><li>gles - OpenGL ES 2.0</li><li>gles3 - OpenGL ES 3.x</li><li>metal - iOS/Mac Metal</li><li>vulkan - Vulkan</li><li>d3d11_9x - Direct3D 11 9.x åŠŸèƒ½çº§åˆ«ï¼Œé€šå¸¸åœ¨ WSA å¹³å°ä¸Šä½¿ç”¨</li><li>xboxone - Xbox One</li><li>ps4 - PlayStation 4</li><li>n3ds - Nintendo 3DS</li><li>wiiu - Nintendo Wii U</li></ul><h2 id="unlitshader">UnlitShader</h2><ul><li><ol type="1"><li>Shaderå‘½ä»¤åŒ…å«ä¸€ä¸ªç€è‰²å™¨åç§°çš„å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨æ­£æ–œæ <code>/</code>å°†ç€è‰²å™¨æ”¾åœ¨å­èœå•ä¸­æ˜¾ç¤ºã€‚</li></ol></li></ul><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>Shader <span class="st">"ç±»åˆ«åç§°/å­ç±»åˆ«åç§°/Shaderåç§°"</span></span></code></pre></div><ul><li><ol start="2" type="1"><li>Properties ä»£ç å—åŒ…å«ç€è‰²å™¨å˜é‡(çº¹ç†ã€é¢œè‰²ç­‰)ï¼Œè¿™äº›å˜é‡ä¿å­˜ä¸ºæè´¨çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”æ˜¾ç¤ºåœ¨æè´¨çš„<code>Inspector</code>é¢æ¿ä¸­</li></ol></li><li><ol start="3" type="1"><li>SubShader.ä¸€ä¸ªShaderå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªSubShader,<strong>ä¸»è¦ç”¨äºå®ç°ä¸åŒçš„GPUåŠŸèƒ½çš„ç€è‰²å™¨</strong>ã€‚</li></ol></li><li><ol start="4" type="1"><li>Pass.æ¯ä¸ªSubShaderç”±å¤šä¸ª<code>Pass</code>é€šé“ç»„æˆï¼Œæ¯ä¸ª<code>Pass</code>é€šé“ä»£è¡¨ä¸ºä½¿ç”¨ç€è‰²å™¨æè´¨æ¸²æŸ“çš„åŒä¸€å¯¹è±¡æ‰§è¡Œ é¡¶ç‚¹å’Œç‰‡å…ƒä»£ç ã€‚è®¸å¤šç®€å•çš„ç€è‰²å™¨åªä½¿ç”¨ä¸€ä¸ªé€šé“ï¼Œä½†ä¸å…‰ç…§äº¤äº’çš„ç€è‰²å™¨å¯èƒ½éœ€è¦æ›´å¤šé€šé“.é€šé“å†…éƒ¨çš„å‘½ä»¤é€šå¸¸è®¾ç½®<code>fixed function</code>çŠ¶æ€ï¼Œä¾‹å¦‚ æ··åˆæ¨¡å¼ã€‚ ä½¿ç”¨<code>CGPROGRAM ..ENDCG</code>å…³é”®å­—åŒ…å«çš„<code>HLSL</code>ä»£ç ã€‚</li></ol></li></ul><p>é¡¶ç‚¹ç€è‰²å™¨æ˜¯å¯¹3Dæ¨¡å‹çš„æ¯ä¸ªé¡¶ç‚¹è¿è¡Œçš„ç¨‹åºã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå®ƒå¹¶ä¸åšä»»ä½•ç‰¹åˆ«æœ‰è¶£çš„äº‹æƒ…ã€‚è¿™é‡Œæˆ‘ä»¬åªæ˜¯å°†é¡¶ç‚¹ä½ç½®ä»å¯¹è±¡ç©ºé—´è½¬æ¢ä¸ºæ‰€è°“çš„â€œè£å‰ªç©ºé—´â€ï¼ˆç”±GPUç”¨äºæ …æ ¼åŒ–å±å¹•ä¸Šçš„å¯¹è±¡ï¼‰ã€‚æˆ‘ä»¬è¿˜ä¼ é€’æœªä¿®æ”¹çš„è¾“å…¥çº¹ç†åæ ‡ï¼›æˆ‘ä»¬éœ€è¦è¯¥åæ ‡æ¥å¯¹ç‰‡å…ƒç€è‰²å™¨ä¸­çš„çº¹ç†è¿›è¡Œé‡‡æ ·ã€‚</p><p>ç‰‡å…ƒç€è‰²å™¨æ˜¯å¯¹å±å¹•ä¸Šå¯¹è±¡å æ®çš„æ¯ä¸ªåƒç´ è¿è¡Œçš„ç¨‹åºï¼Œé€šå¸¸ç”¨äºè®¡ç®—å’Œè¾“å‡ºæ¯ä¸ªåƒç´ çš„é¢œè‰²ã€‚é€šå¸¸ï¼Œå±å¹•ä¸Šæœ‰æ•°ç™¾ä¸‡ä¸ªåƒç´ ï¼Œå¹¶ä¸”ç‰‡å…ƒç€è‰²å™¨å°†é’ˆå¯¹æ‰€æœ‰åƒç´ æ‰§è¡Œï¼ä¼˜åŒ–ç‰‡å…ƒç€è‰²å™¨æ˜¯æ•´ä½“æ¸¸æˆæ€§èƒ½ä¼˜åŒ–å·¥ä½œçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚ä¸€äº›å˜é‡æˆ–å‡½æ•°å®šä¹‰åè·Ÿä¸€ä¸ªè¯­ä¹‰æŒ‡ç¤ºç¬¦ï¼Œä¾‹å¦‚ : POSITION æˆ– :SV_Targetã€‚è¿™äº›è¯­ä¹‰æŒ‡ç¤ºç¬¦å°†è¿™äº›å˜é‡çš„â€œå«ä¹‰â€ä¼ è¾¾ç»™ GPUã€‚</p><h2 id="ç€è‰²å™¨è¯­ä¹‰">ç€è‰²å™¨è¯­ä¹‰</h2><p>ç¼–å†™ HLSL ç€è‰²å™¨ç¨‹åºæ—¶ï¼Œ è¾“å…¥å’Œè¾“å‡ºå˜é‡éœ€è¦é€šè¿‡è¯­ä¹‰æ¥è¡¨æ˜å…¶â€œæ„å›¾â€ã€‚è¿™æ˜¯ HLSL ç€è‰²å™¨è¯­è¨€ä¸­çš„ æ ‡å‡†æ¦‚å¿µï¼›</p><h3 id="é¡¶ç‚¹ç€è‰²å™¨è¾“å…¥è¯­ä¹‰">é¡¶ç‚¹ç€è‰²å™¨<code>è¾“å…¥è¯­ä¹‰</code></h3><p>ä¸»é¡¶ç‚¹ç€è‰²å™¨å‡½æ•°(ç”±<code>#pragma vertex</code> æŒ‡ä»¤è¡¨ç¤º)éœ€è¦åœ¨æ‰€æœ‰è¾“å…¥å‚æ•°ä¸Šéƒ½æœ‰è¯­ä¹‰ã€‚è¿™äº›å¯¹åº”å„ä¸ª<code>ç½‘æ ¼æ•°æ®å…ƒç´ </code>,å¦‚é¡¶ç‚¹ä½ç½®ã€æ³•çº¿ç½‘æ ¼å’Œçº¹ç†åæ ‡ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹ç›´æ¥ä½¿ç”¨å‚æ•°å½¢å¼ã€‚</p><div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>Shader <span class="st">"Unlit/Show UVs"</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    SubShader</span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        Pass</span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>            CGPROGRAM</span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma vertex vert</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma fragment frag</span></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">struct</span> v2f <span class="op">{</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                float2 uv <span class="op">:</span> TEXCOORD0<span class="op">;</span></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                float4 pos <span class="op">:</span> SV_POSITION<span class="op">;</span></span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>            v2f vert <span class="op">(</span></span><span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                float4 vertex <span class="op">:</span> POSITION<span class="op">,</span> <span class="co">// é¡¶ç‚¹ä½ç½®è¾“å…¥</span></span><span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                float2 uv <span class="op">:</span> TEXCOORD0 <span class="co">// ç¬¬ä¸€ä¸ªçº¹ç†åæ ‡è¾“å…¥</span></span><span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                <span class="op">)</span></span><span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                v2f o<span class="op">;</span></span><span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                o<span class="op">.</span>pos <span class="op">=</span> UnityObjectToClipPos<span class="op">(</span>vertex<span class="op">);</span></span><span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                o<span class="op">.</span>uv <span class="op">=</span> uv<span class="op">;</span></span><span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> o<span class="op">;</span></span><span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            </span><span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            fixed4 frag <span class="op">(</span>v2f i<span class="op">)</span> <span class="op">:</span> SV_Target</span><span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> fixed4<span class="op">(</span>i<span class="op">.</span>uv<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>            ENDCG</span><span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><p>ä¸å¿…é€ä¸ªæ‹¼å†™å‡ºæ‰€æœ‰çš„æ¯ä¸ªè¾“å…¥ï¼Œ å¯ä»¥å£°æ˜ä¸€ä¸ªè¾“å…¥ç»“æ„ï¼Œå¹¶åœ¨è¯¥ç»“æ„çš„æ¯ä¸ªå•ç‹¬æˆå‘˜å˜é‡ä¸ŠæŒ‡ç¤ºè¯­ä¹‰ã€‚ä¾‹å¦‚ï¼š</p><div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// ....çœç•¥</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> a2v <span class="op">{</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    float4 vertex <span class="op">:</span> POSITION<span class="op">;</span> <span class="co">// é¡¶ç‚¹ä½ç½®è¾“å…¥</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    float2 uv <span class="op">:</span> TEXCOORD0<span class="op">;</span> <span class="co">// ç¬¬ä¸€ä¸ªçº¹ç†åæ ‡è¾“å…¥</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>v2f vert <span class="op">(</span>a2v i<span class="op">)</span></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    v2f o<span class="op">;</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    o<span class="op">.</span>pos <span class="op">=</span> UnityObjectToClipPos<span class="op">(</span>i<span class="op">.</span>vertex<span class="op">);</span></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    o<span class="op">.</span>uv <span class="op">=</span> i<span class="op">.</span>uv<span class="op">;</span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> o<span class="op">;</span></span><span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">// ....çœç•¥</span></span></code></pre></div><h3 id="ç‰‡å…ƒç€è‰²å™¨è¾“å‡ºè¯­ä¹‰">ç‰‡å…ƒç€è‰²å™¨<code>è¾“å‡ºè¯­ä¹‰</code></h3><p>é€šå¸¸ï¼Œç‰‡å…ƒç€è‰²å™¨ä¼šè¾“å‡ºé¢œè‰²ï¼Œå¹¶å…·æœ‰ <code>SV_Target</code>è¯­ä¹‰ã€‚</p><div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    fixed4 frag<span class="op">(</span>v2f i<span class="op">):</span> SV_Target</span></code></pre></div><p>å‡½æ•° <code>frag</code> çš„è¿”å›ç±»å‹ä¸º<code>fixed4</code>ï¼ˆä½ç²¾åº¦RGBAé¢œè‰²)ã€‚å› ä¸ºå®ƒåªè¿”å›ä¸€ä¸ªå€¼ï¼Œæ‰€ä»¥è¯­ä¹‰ç”±å‡½æ•°è‡ªèº«æŒ‡ç¤º<code>: SV_target</code>ã€‚ ä¹Ÿå¯ä»¥è¿”å›ç»“æ„ä½“å½¢å¼ã€‚</p><div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> fragOutput <span class="op">{</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    fixed4 color <span class="op">:</span> SV_Target<span class="op">;</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="op">};</span>            </span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>fragOutput frag <span class="op">(</span>v2f i<span class="op">)</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    fragOutput o<span class="op">;</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    o<span class="op">.</span>color <span class="op">=</span> fixed4<span class="op">(</span>i<span class="op">.</span>uv<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> o<span class="op">;</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><p>ä»ç‰‡å…ƒç€è‰²å™¨è¿”å›ç»“æ„å¯¹äºä¸æ­¢è¿”å›å•ä¸ªé¢œè‰²çš„ ç€è‰²å™¨éå¸¸æœ‰ç”¨ã€‚ç‰‡å…ƒç€è‰²å™¨è¾“å‡ºæ”¯æŒçš„å…¶ä»–è¯­ä¹‰å¦‚ä¸‹ã€‚</p><ul><li><p>SV_TargetNï¼šå¤šä¸ªæ¸²æŸ“ç›®æ ‡<code>SV_Target1</code>ã€<code>SV_Target2</code>ç­‰ç­‰ï¼šè¿™äº›æ˜¯ç€è‰²å™¨å†™å…¥çš„é™„åŠ é¢œè‰²ã€‚è¿™åœ¨ä¸€æ¬¡æ¸²æŸ“åˆ°å¤šä¸ªæ¸²æŸ“ç›®æ ‡ï¼ˆç§°ä¸ºâ€œå¤šæ¸²æŸ“ç›®æ ‡â€æ¸²æŸ“æŠ€æœ¯ï¼Œç®€ç§°MRTï¼‰æ—¶ä½¿ç”¨ã€‚<strong>SV_Target0 ç­‰åŒäº SV_Target</strong>ã€‚</p></li><li><p>SV_Depthï¼šåƒç´ ç€è‰²å™¨æ·±åº¦è¾“å‡º é€šå¸¸æƒ…å†µä¸‹ï¼Œ ç‰‡å…ƒç€è‰²å™¨ä¸ä¼šè¦†ç›– Zç¼“å†²åŒºå€¼ï¼Œå¹¶ä½¿ç”¨å¸¸è§„ä¸‰è§’å½¢æ …æ ¼åŒ–ä¸­çš„é»˜è®¤å€¼ã€‚ä½†æ˜¯ï¼Œå¯¹äºæŸäº›æ•ˆæœï¼Œè¾“å‡ºæ¯ä¸ªåƒç´ çš„è‡ªå®šä¹‰Z ç¼“å†²åŒºæ·±åº¦å€¼å¾ˆæœ‰ç”¨ã€‚</p></li></ul><p>è¯·æ³¨æ„ï¼Œåœ¨è®¸å¤š GPUä¸Šï¼Œè¿™ä¼šå…³é—­ä¸€äº›æ·±åº¦ç¼“å†²åŒºä¼˜åŒ–ï¼Œå› æ­¤å¦‚æœæ²¡æœ‰å……åˆ†çš„ç†ç”±ï¼Œè¯·ä¸è¦è¦†ç›– Zç¼“å†²åŒºå€¼ã€‚SV_Depth äº§ç”Ÿçš„æˆæœ¬å–å†³äº GPU æ¶æ„ï¼Œä½†æ€»ä½“ä¸Šä¸ Alphaæµ‹è¯•ï¼ˆä½¿ç”¨ HLSL ä¸­çš„å†…ç½® clip()å‡½æ•°ï¼‰çš„æˆæœ¬éå¸¸ç›¸ä¼¼ã€‚é€šè¿‡æ¸²æŸ“ç€è‰²å™¨åœ¨æ‰€æœ‰å¸¸è§„ä¸é€æ˜ç€è‰²å™¨ä¹‹åä¿®æ”¹æ·±åº¦ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨AlphaTest æ¸²æŸ“é˜Ÿåˆ—ï¼‰ã€‚<strong>æ·±åº¦è¾“å‡ºå€¼å¿…é¡»ä¸ºå•ä¸ª floatã€‚</strong></p><h3 id="é¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºå’Œç‰‡å…ƒç€è‰²å™¨è¾“å…¥">é¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºå’Œç‰‡å…ƒç€è‰²å™¨è¾“å…¥</h3><p>é¡¶ç‚¹ç€è‰²å™¨éœ€è¦è¾“å‡ºé¡¶ç‚¹çš„æœ€<strong>ç»ˆè£å‰ªç©ºé—´</strong>ä½ç½®ï¼Œä»¥ä¾¿ GPUçŸ¥é“å±å¹•ä¸Šçš„æ …æ ¼åŒ–ä½ç½®ä»¥åŠæ·±åº¦ã€‚æ­¤è¾“å‡ºéœ€è¦å…·æœ‰ <code>SV_POSITION</code>è¯­ä¹‰ï¼Œ<strong>å¹¶ä¸º float4 ç±»å‹</strong>ã€‚é¡¶ç‚¹ç€è‰²å™¨ç”Ÿæˆçš„æ‰€æœ‰å…¶ä»–è¾“å‡ºï¼ˆâ€œæ’å€¼å™¨â€æˆ–â€œå˜åŒ–â€ï¼‰éƒ½æ˜¯æ‚¨çš„ç‰¹å®šç€è‰²å™¨éœ€è¦çš„ã€‚ä»é¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºçš„å€¼å°†åœ¨æ¸²æŸ“ä¸‰è§’å½¢çš„é¢ä¸Šè¿›è¡Œæ’å€¼ï¼Œå¹¶ä¸”æ¯ä¸ªåƒç´ çš„å€¼å°†ä½œä¸ºè¾“å…¥ä¼ é€’ç»™ç‰‡å…ƒç€è‰²å™¨ã€‚</p><p>è®¸å¤šç°ä»£ GPU å¹¶ä¸çœŸæ­£å…³å¿ƒè¿™äº›å˜é‡çš„è¯­ä¹‰ï¼›ç„¶è€Œï¼Œä¸€äº›æ—§ç³»ç»Ÿï¼ˆæœ€ä¸»è¦çš„æ˜¯Direct3D 9 ä¸Šçš„ç€è‰²å™¨æ¨¡å‹ 2 GPUï¼‰å­˜åœ¨å…³äºè¯­ä¹‰çš„ç‰¹æ®Šè§„åˆ™ï¼š</p><ul><li>TEXCOORD0ã€TEXCOORD1ç­‰è¯­ä¹‰ç”¨äºæŒ‡ç¤º<strong>ä»»æ„é«˜ç²¾åº¦æ•°æ®</strong>ï¼Œå¦‚çº¹ç†åæ ‡å’Œä½ç½®ã€‚</li><li>é¡¶ç‚¹è¾“å‡ºå’Œç‰‡å…ƒè¾“å…¥çš„ COLOR0 å’Œ COLOR1 è¯­ä¹‰ç”¨äº<strong>ä½ç²¾åº¦ 0 åˆ° 1èŒƒå›´çš„æ•°æ®</strong>ï¼ˆå¦‚ç®€å•çš„é¢œè‰²å€¼ï¼‰ã€‚</li></ul><p><strong>ä¸ºäº†è·å¾—æœ€ä½³çš„è·¨å¹³å°æ”¯æŒï¼Œåº”å°†é¡¶ç‚¹è¾“å‡ºå’Œ ç‰‡å…ƒè¾“å…¥æ ‡è®°ä¸ºTEXCOORDn è¯­ä¹‰ã€‚</strong></p><h4 id="æ’å€¼å™¨æ•°é‡é™åˆ¶">æ’å€¼å™¨æ•°é‡é™åˆ¶</h4><p>å¯¹äºæ€»å…±å¯ä»¥ä½¿ç”¨å¤šå°‘ä¸ªæ’å€¼å™¨å˜é‡å°†ä¿¡æ¯ä»é¡¶ç‚¹ä¼ é€’åˆ°ç‰‡å…ƒç€è‰²å™¨ï¼Œå­˜åœ¨ä¸€äº›é™åˆ¶ã€‚è¯¥é™åˆ¶ å–å†³äºå¹³å°å’ŒGPUï¼Œä¸€èˆ¬å‡†åˆ™å¦‚ä¸‹ï¼š</p><ul><li>æœ€å¤š 8 ä¸ªæ’å€¼å™¨ï¼šOpenGL ES 2.0 (iOS/Android)ã€Direct3D 11 9.x çº§åˆ«(Windows Phone) å’Œ Direct3 9 ç€è‰²å™¨æ¨¡å‹ 2.0ï¼ˆè€æ—§ PCï¼‰ã€‚ç”±äºæ’å€¼å™¨æ•°é‡å—åˆ°é™åˆ¶ï¼Œä½†æ¯ä¸ªæ’å€¼å™¨å¯ä»¥æ˜¯ä¸€ä¸ª 4 åˆ†é‡çŸ¢é‡ï¼Œæ‰€ä»¥ä¸€äº›ç€è‰²å™¨å°†å†…å®¹æ‰“åŒ…åœ¨ä¸€èµ·ä»¥ä¾¿ä¸ä¼šè¶…è¿‡é™åˆ¶ã€‚ä¾‹å¦‚ï¼Œä¸¤ä¸ªçº¹ç†åæ ‡å¯ä»¥åœ¨ä¸€ä¸ª float4 å˜é‡ä¸­ä¼ é€’ï¼ˆ.xy è¡¨ç¤ºä¸€ä¸ªåæ ‡ï¼Œ.zwè¡¨ç¤ºç¬¬äºŒä¸ªåæ ‡ï¼‰ã€‚</li><li>æœ€å¤š 10 ä¸ªæ’å€¼å™¨ï¼šDirect3D 9 ç€è‰²å™¨æ¨¡å‹ 3.0 (#pragma target3.0)ã€‚</li><li>æœ€å¤š 16 ä¸ªæ’å€¼å™¨ï¼šOpenGL ES 3.0 (iOS/Android) å’Œ Metal (iOS)ã€‚</li><li>æœ€å¤š 32 ä¸ªæ’å€¼å™¨ï¼šDirect3D 10 ç€è‰²å™¨æ¨¡å‹ 4.0 (#pragma target4.0)ã€‚</li></ul><p><strong>æ— è®ºç‰¹å®šç›®æ ‡ç¡¬ä»¶å¦‚ä½•ï¼Œå‡ºäºæ€§èƒ½åŸå› ï¼Œé€šå¸¸æœ€å¥½ä½¿ç”¨å°½å¯èƒ½å°‘çš„æ’å€¼å™¨ã€‚</strong></p><h3 id="å…¶ä»–ç‰¹æ®Šè¯­ä¹‰">å…¶ä»–ç‰¹æ®Šè¯­ä¹‰</h3><h4 id="å±å¹•ç©ºé—´åƒç´ ä½ç½®vpos">å±å¹•ç©ºé—´åƒç´ ä½ç½®ï¼šVPOS</h4><p>ç‰‡å…ƒç€è‰²å™¨å¯ä»¥æ¥æ”¶æ¸²æŸ“ä¸ºç‰¹æ®Š VPOS è¯­ä¹‰çš„åƒç´ çš„ä½ç½®ã€‚æ­¤åŠŸèƒ½ä»…ä»ç€è‰²å™¨æ¨¡å‹ <strong>3.0</strong> å¼€å§‹å­˜åœ¨ï¼Œå› æ­¤ç€è‰²å™¨éœ€è¦å…·æœ‰<code>#pragma target 3.0</code> ç¼–è¯‘æŒ‡ä»¤ã€‚åœ¨ä¸åŒçš„å¹³å°ä¸Šï¼Œå±å¹•ç©ºé—´ä½ç½®è¾“å…¥çš„åŸºç¡€ç±»å‹ä¼šæœ‰æ‰€ä¸åŒï¼Œå› æ­¤ä¸ºäº†è·å¾—æœ€å¤§çš„å¯ç§»æ¤æ€§ï¼Œè¯·å¯¹å…¶ä½¿ç”¨<code>UNITY_VPOS_TYPE</code>ç±»å‹ï¼ˆåœ¨å¤§å¤šæ•°å¹³å°ä¸Šå°†æ˜¯<code>float4</code>ï¼Œåœ¨ <strong>Direct3D 9 ä¸Šå°†æ˜¯<code>float2</code></strong>ï¼‰ã€‚å¦å¤–ï¼Œä½¿ç”¨åƒç´ ä½ç½®è¯­ä¹‰å°†å¯¼è‡´éš¾ä»¥è®©è£å‰ªç©ºé—´ä½ç½® (SV_POSITION) å’Œ VPOSå¤„äºç›¸åŒçš„é¡¶ç‚¹åˆ°ç‰‡å…ƒç»“æ„ä¸­ã€‚å› æ­¤é¡¶ç‚¹ç€è‰²å™¨åº”<strong>å°†è£å‰ªç©ºé—´ä½ç½®è¾“å‡ºä¸ºå•ç‹¬çš„â€œoutâ€å˜é‡</strong>ã€‚</p><div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>Shader <span class="st">"Unlit/Screen Position"</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    Properties</span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        _MainTex <span class="op">(</span><span class="st">"Texture"</span><span class="op">,</span> <span class="dv">2</span><span class="er">D</span><span class="op">)</span> <span class="op">=</span> <span class="st">"white"</span> <span class="op">{}</span></span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    SubShader</span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        Pass</span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>            CGPROGRAM</span><span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma vertex vert</span></span><span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma fragment frag</span></span><span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma target 3.0</span></span><span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>            <span class="co">// æ³¨æ„ï¼šæ­¤ç»“æ„ä¸­æ²¡æœ‰ SV_POSITION</span></span><span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>            <span class="kw">struct</span> v2f <span class="op">{</span></span><span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>                float2 uv <span class="op">:</span> TEXCOORD0<span class="op">;</span></span><span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span><span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>            v2f vert <span class="op">(</span></span><span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                float4 vertex <span class="op">:</span> POSITION<span class="op">,</span> <span class="co">// é¡¶ç‚¹ä½ç½®è¾“å…¥</span></span><span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>                float2 uv <span class="op">:</span> TEXCOORD0<span class="op">,</span> <span class="co">// çº¹ç†åæ ‡è¾“å…¥</span></span><span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>                out float4 outpos <span class="op">:</span> SV_POSITION <span class="co">// è£å‰ªç©ºé—´ä½ç½®è¾“å‡º</span></span><span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>                <span class="op">)</span></span><span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>                v2f o<span class="op">;</span></span><span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>                o<span class="op">.</span>uv <span class="op">=</span> uv<span class="op">;</span></span><span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>                outpos <span class="op">=</span> UnityObjectToClipPos<span class="op">(</span>vertex<span class="op">);</span></span><span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> o<span class="op">;</span></span><span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>            sampler2D _MainTex<span class="op">;</span></span><span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>            fixed4 frag <span class="op">(</span>v2f i<span class="op">,</span> UNITY_VPOS_TYPE screenPos <span class="op">:</span> VPOS<span class="op">)</span> <span class="op">:</span> SV_Target</span><span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>                <span class="co">// screenPos.xy å°†åŒ…å«åƒç´ æ•´æ•°åæ ‡ã€‚</span></span><span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>                <span class="co">// ä½¿ç”¨å®ƒä»¬æ¥å®ç°ä¸€ä¸ªè·³è¿‡æ¸²æŸ“ 4x4 åƒç´ å—çš„</span></span><span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>                <span class="co">// æ£‹ç›˜å›¾æ¡ˆ</span></span><span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>                <span class="co">// æ£‹ç›˜å›¾æ¡ˆä¸­ 4x4 åƒç´ å—çš„ checker å€¼</span></span><span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>                <span class="co">// ä¸ºè´Ÿ</span></span><span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>                screenPos<span class="op">.</span>xy <span class="op">=</span> floor<span class="op">(</span>screenPos<span class="op">.</span>xy <span class="op">*</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.5</span><span class="op">;</span></span><span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>                <span class="dt">float</span> checker <span class="op">=</span> <span class="op">-</span>frac<span class="op">(</span>screenPos<span class="op">.</span>r <span class="op">+</span> screenPos<span class="op">.</span>g<span class="op">);</span></span><span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>                <span class="co">// å¦‚æœå€¼ä¸ºè´Ÿï¼Œåˆ™ clip HLSL æŒ‡ä»¤åœæ­¢æ¸²æŸ“åƒç´ </span></span><span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>                clip<span class="op">(</span>checker<span class="op">);</span></span><span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>                <span class="co">// å¯¹äºä¿ç•™çš„åƒç´ ï¼Œè¯»å–çº¹ç†å¹¶å°†å…¶è¾“å‡º</span></span><span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>                fixed4 c <span class="op">=</span> tex2D <span class="op">(</span>_MainTex<span class="op">,</span> i<span class="op">.</span>uv<span class="op">);</span></span><span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> c<span class="op">;</span></span><span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>            ENDCG</span><span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><h4 id="é¢å¯¹æ–¹å‘vface">é¢å¯¹æ–¹å‘ï¼šVFACE</h4><p>ç‰‡å…ƒç€è‰²å™¨å¯ä»¥æ¥æ”¶ä¸€ç§æŒ‡ç¤ºæ¸²æŸ“è¡¨é¢æ˜¯é¢å‘æ‘„åƒæœºè¿˜æ˜¯èƒŒå¯¹æ‘„åƒæœºçš„å˜é‡ã€‚è¿™åœ¨æ¸²æŸ“åº”ä»ä¸¤ä¾§å¯è§çš„å‡ ä½•ä½“æ—¶éå¸¸æœ‰ç”¨- é€šå¸¸ç”¨äºæ ‘å¶å’Œç±»ä¼¼çš„è–„å‹ç‰©ä½“ã€‚VFACEè¯­ä¹‰è¾“å…¥å˜é‡å°†åŒ…å«è¡¨ç¤ºæ­£é¢ä¸‰è§’å½¢çš„æ­£å€¼ï¼Œä»¥åŠè¡¨ç¤ºèƒŒé¢ä¸‰è§’å½¢çš„è´Ÿå€¼ã€‚</p><p>æ­¤åŠŸèƒ½ä»ç€è‰²å™¨æ¨¡å‹ <strong>3.0</strong>å¼€å§‹æ‰å­˜åœ¨ï¼Œå› æ­¤ç€è‰²å™¨éœ€è¦å…·æœ‰ <code>#pragma target 3.0</code>ç¼–è¯‘æŒ‡ä»¤ã€‚</p><div class="sourceCode" id="cb9"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>Shader <span class="st">"Unlit/Face Orientation"</span></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    Properties</span><span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        _ColorFront <span class="op">(</span><span class="st">"Front Color"</span><span class="op">,</span> Color<span class="op">)</span> <span class="op">=</span> <span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="fl">0.7</span><span class="op">,</span><span class="fl">0.7</span><span class="op">,</span><span class="dv">1</span><span class="op">)</span></span><span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        _ColorBack <span class="op">(</span><span class="st">"Back Color"</span><span class="op">,</span> Color<span class="op">)</span> <span class="op">=</span> <span class="op">(</span><span class="fl">0.7</span><span class="op">,</span><span class="dv">1</span><span class="op">,</span><span class="fl">0.7</span><span class="op">,</span><span class="dv">1</span><span class="op">)</span></span><span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    SubShader</span><span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        Pass</span><span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            Cull Off <span class="co">// å…³é—­èƒŒé¢å‰”é™¤</span></span><span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>            CGPROGRAM</span><span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma vertex vert</span></span><span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma fragment frag</span></span><span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma target 3.0</span></span><span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>            float4 vert <span class="op">(</span>float4 vertex <span class="op">:</span> POSITION<span class="op">)</span> <span class="op">:</span> SV_POSITION</span><span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> UnityObjectToClipPos<span class="op">(</span>vertex<span class="op">);</span></span><span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>            fixed4 _ColorFront<span class="op">;</span></span><span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>            fixed4 _ColorBack<span class="op">;</span></span><span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>            fixed4 frag <span class="op">(</span>fixed facing <span class="op">:</span> VFACE<span class="op">)</span> <span class="op">:</span> SV_Target</span><span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>                <span class="co">// æ­£é¢çš„ VFACE è¾“å…¥ä¸ºæ­£ï¼Œ</span></span><span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>                <span class="co">// èƒŒé¢çš„ä¸ºè´Ÿã€‚æ ¹æ®è¿™ç§æƒ…å†µ</span></span><span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>                <span class="co">// è¾“å‡ºä¸¤ç§é¢œè‰²ä¸­çš„ä¸€ç§ã€‚</span></span><span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> facing <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span>_ColorFront <span class="op">:</span> _ColorBack<span class="op">;</span></span><span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>            ENDCG</span><span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><h4 id="é¡¶ç‚¹-idsv_vertexid">é¡¶ç‚¹ IDï¼šSV_VertexID</h4><p>é¡¶ç‚¹ç€è‰²å™¨å¯ä»¥æ¥æ”¶å…·æœ‰â€œé¡¶ç‚¹ç¼–å·â€ï¼ˆä¸ºæ— ç¬¦å·æ•´æ•°ï¼‰çš„å˜é‡ã€‚å½“æ‚¨æƒ³è¦ä»çº¹ç†æˆ–ComputeBuffers ä¸­ è·å–é¢å¤–çš„æ¯é¡¶ç‚¹æ•°æ®æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚ æ­¤åŠŸèƒ½ä»DX10ï¼ˆç€è‰²å™¨æ¨¡å‹ 4.0ï¼‰å’Œ GLCore/OpenGL ES 3å¼€å§‹æ‰å­˜åœ¨ï¼Œå› æ­¤ç€è‰²å™¨éœ€è¦å…·æœ‰ #pragma target 3.5 ç¼–è¯‘æŒ‡ä»¤ã€‚</p><div class="sourceCode" id="cb10"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Shader <span class="st">"Unlit/VertexID"</span></span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    SubShader</span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        Pass</span><span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>            CGPROGRAM</span><span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma vertex vert</span></span><span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma fragment frag</span></span><span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>            <span class="pp">#pragma target 3.5</span></span><span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>            <span class="kw">struct</span> v2f <span class="op">{</span></span><span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    fixed4 color <span class="op">:</span> TEXCOORD0<span class="op">;</span></span><span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                float4 pos <span class="op">:</span> SV_POSITION<span class="op">;</span></span><span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">};</span></span><span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>            v2f vert <span class="op">(</span></span><span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>                float4 vertex <span class="op">:</span> POSITION<span class="op">,</span> <span class="co">// é¡¶ç‚¹ä½ç½®è¾“å…¥</span></span><span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>                uint vid <span class="op">:</span> SV_VertexID <span class="co">// é¡¶ç‚¹ IDï¼Œå¿…é¡»ä¸º uint</span></span><span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>                <span class="op">)</span></span><span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>                v2f o<span class="op">;</span></span><span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>                o<span class="op">.</span>pos <span class="op">=</span> UnityObjectToClipPos<span class="op">(</span>vertex<span class="op">);</span></span><span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>                <span class="co">// åŸºäºé¡¶ç‚¹ ID è¾“å‡ºæ—¶é«¦é¢œè‰²</span></span><span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>                <span class="dt">float</span> f <span class="op">=</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>vid<span class="op">;</span></span><span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>                o<span class="op">.</span>color <span class="op">=</span> half4<span class="op">(</span>sin<span class="op">(</span>f<span class="op">/</span><span class="dv">10</span><span class="op">),</span>sin<span class="op">(</span>f<span class="op">/</span><span class="dv">100</span><span class="op">),</span>sin<span class="op">(</span>f<span class="op">/</span><span class="dv">1000</span><span class="op">),</span><span class="dv">0</span><span class="op">)</span> <span class="op">*</span> <span class="fl">0.5</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">;</span></span><span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> o<span class="op">;</span></span><span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a></span><span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>            fixed4 frag <span class="op">(</span>v2f i<span class="op">)</span> <span class="op">:</span> SV_Target</span><span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> i<span class="op">.</span>color<span class="op">;</span></span><span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>            ENDCG</span><span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/shader/10.computeshader/"/>
      <url>/2022/08/10/unity/shader/10.computeshader/</url>
      
        <content type="html"><![CDATA[<h1 id="computeshader">ComputeShader</h1>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/shader/10.commandbuffer/"/>
      <url>/2022/08/10/unity/shader/10.commandbuffer/</url>
      
        <content type="html"><![CDATA[<h1 id="commandbuffer">CommandBuffer</h1><h2 id="åº”ç”¨ä¸€-å±å¹•æˆªå›¾">åº”ç”¨ä¸€ã€ å±å¹•æˆªå›¾</h2><pre><code>CommandBuffer buf = new CommandBuffer();buf.name = "Grab Screen Texture";// åç§°ä»»æ„èµ·screenCopyID = Shader.PropertyToID("_ScreenCopyTexture");// åˆ›å»ºä¸´æ—¶ RTã€‚// åƒç´ å®½åº¦ï¼Œæˆ–ä¸º -1ï¼Œè¡¨ç¤ºâ€œæ‘„åƒæœºåƒç´ å®½åº¦â€ã€‚// åƒç´ é«˜åº¦ï¼Œæˆ–ä¸º -1ï¼Œè¡¨ç¤ºâ€œæ‘„åƒæœºåƒç´ é«˜åº¦â€ã€‚buf.GetTemporaryRT(screenCopyID, -1, -1, 0, FilterMode.Bilinear);// å¤åˆ¶å½“å‰å±å¹•åˆ° RTbuf.Blit(BuiltinRenderTextureType.CurrentActive, screenCopyID);// å¦‚ä½•ä½¿ç”¨è¿™ä¸ª rtï¼Œ è¿™é‡Œæµ‹è¯•ï¼Œèµ‹å€¼ç»™Shader è´´å›¾ã€‚//buf.SetGlobalTexture("_CustomMainTex", screenCopyID);m_camera.AddCommandBuffer(_cameraEvent, buf);</code></pre><p>æ¥ä¸‹æ¥ä½¿ç”¨ RawImage ä½œä¸ºè¾“å‡ºå®éªŒã€‚</p><h3 id="shader-1">Shader 1</h3><pre><code>Shader "Unlit/GrabScreenTexture"{    SubShader    {        Tags { "RenderType"="Overlay" }        LOD 100        Pass        {            CGPROGRAM            #pragma vertex vert            #pragma fragment frag            // make fog work            #pragma multi_compile_fog            #include "UnityCG.cginc"            struct appdata            {                float4 vertex : POSITION;                float2 uvgrab : TEXCOORD0;            };            struct v2f            {                float2 uvgrab : TEXCOORD0;                UNITY_FOG_COORDS(1)                float4 vertex : SV_POSITION;            };            // 1. ä½œä¸ºæ™®é€šå›¾ä½¿ç”¨            sampler2D _CustomMainTex;            float4 _CustomMainTex_ST;            v2f vert (appdata v)            {                v2f o;                o.vertex = UnityObjectToClipPos(v.vertex);                //o.uvgrab = TRANSFORM_TEX(v.uvgrab, _CustomMainTex);                o.uvgrab = v.uvgrab.xy *  _CustomMainTex_ST.xy + _CustomMainTex_ST.zw;                UNITY_TRANSFER_FOG(o,o.vertex);                return o;            }            fixed4 frag (v2f i) : SV_Target            {                // sample the texture                fixed4 col = tex2D(_CustomMainTex, i.uvgrab);                // apply fog                UNITY_APPLY_FOG(i.fogCoord, col);                return col;            }            ENDCG        }    }}</code></pre><p><img src="/imgs/CommandBuffer_GrabScreen1.png"></p><p>ä½œä¸ºæ™®é€šå›¾ä½¿ç”¨ï¼Œè¿™æ ·å‡ºæ¥çš„æ•ˆæœï¼š 1. å›¾åƒä¸ºå…¨å±å›¾ 2. Dxå’Œ OpenGLåæ ‡æ²¡æœ‰é€‚åº”ï¼Œ å¯¼è‡´é¢ å€’å›¾ã€‚</p><h3 id="shader-2">Shader 2</h3><pre><code>Shader "Unlit/GrabScreenTextureFinal"{    // è°ƒè¯•ä½œç”¨    Properties{        _Color("Color", Color) = (1, 1, 1, 1)        _OffetX("OffetX", Range(-0.5, 0.5)) = 0    }    SubShader    {        Tags { "RenderType" = "Overlay" }        LOD 100        Pass        {            CGPROGRAM            #pragma vertex vert            #pragma fragment frag            // make fog work            #pragma multi_compile_fog            #include "UnityCG.cginc"            struct appdata            {                float4 vertex : POSITION;                float2 texcoord: TEXCOORD0;            };            struct v2f            {                float4 vertex : SV_POSITION;                float4 uvgrab : TEXCOORD0;                UNITY_FOG_COORDS(1)            };            half _OffetX;            v2f vert(appdata v)            {                v2f o;                o.vertex = UnityObjectToClipPos(v.vertex);                //1ã€‚ OpenGL /DX åæ ‡é€‚åº”#if UNITY_UV_STARTS_AT_TOP                float scale = -1.0;#else                float scale = 1.0;#endif                //2. é½æ¬¡åæ ‡ è½¬æ¢ä¸º å±å¹•åæ ‡                // é½æ¬¡åæ ‡ï¼ŒåŸç‚¹åœ¨ä¸­é—´ï¼Œ (-wï¼Œ w)                // å±å¹•åæ ‡, åŸç‚¹å·¦ä¸‹è§’ï¼ˆç»Ÿä¸€OpenGLç³»ï¼‰                o.uvgrab.xy = (float2(o.vertex.x, o.vertex.y*scale) + o.vertex.w) * 0.5;                o.uvgrab.zw = o.vertex.zw;                // æ·»åŠ è°ƒè¯•  _OffetX                o.uvgrab.x = o.uvgrab.x+ _OffetX;                UNITY_TRANSFER_FOG(o,o.vertex);                return o;            }            sampler2D _CustomMainTex;            float4 _CustomMainTex_TexelSize;            half4 _Color;            fixed4 frag(v2f i) : SV_Target            {                // å±å¹•æ¯”ä¾‹ï¼Œ è½¬æ¢ä¸ºå›¾åƒæ¯”ä¾‹ï¼Œ æŠŠè¿™ä¸ªæ¯”ä¾‹ä½œä¸º uvé‡‡æ ·ã€‚                i.uvgrab.xy = _CustomMainTex_TexelSize.xy * i.uvgrab.z + i.uvgrab.xy;                // sample the texture                // æ·»åŠ è°ƒè¯•  _Color                half4 col = tex2Dproj(_CustomMainTex, UNITY_PROJ_COORD(i.uvgrab)) * _Color;                UNITY_APPLY_FOG(i.fogCoord, col);                col.a = 1.0;                return col;            }            ENDCG        }    }}</code></pre><p><img src="imgs/CommandBuffer_GrabScreen2.png"></p><p>ä¿®æ­£åï¼š 1. å›¾åƒä¸ºæ¸²æŸ“ç‰©ä½“åŒºåŸŸå›¾ 2. Dxå’Œ OpenGL åæ ‡é€‚åº”ã€‚</p><p>ä»æ•ˆæœä¸Šçœ‹åˆ°å’Œæ²¡æœ‰æ¸²æŸ“ä¸€æ ·ï¼Œé‚£æ˜¯å› ä¸ºä¸€æ¨¡ä¸€æ ·çš„å®Œå…¨é‡åˆã€‚ è°ƒæ•´ OffsetXå’ŒColor å°±èƒ½çœ‹åˆ°äº†ã€‚</p><h3 id="å…³äºåæ ‡å¾è½¬æ¢">å…³äºåæ ‡å¾è½¬æ¢</h3><p><img src="imgs/TEXCOORD0.png"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/shader/1.surfaceshader/"/>
      <url>/2022/08/10/unity/shader/1.surfaceshader/</url>
      
        <content type="html"><![CDATA[<h1 id="surfaceshaderå¤„ç†æ–¹å¼">SurfaceShaderå¤„ç†æ–¹å¼</h1><blockquote><p>ä½œä¸ºUnityæ”¯æŒçš„ShaderLab ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯<code>Standard Shader</code>é‡‡ç”¨çš„å½¢å¼ã€‚ SurfaceShaderå®é™…ä¸Šæ˜¯<code>UnlitShader</code>çš„é€ç‰‡å…ƒå¤„ç†</p></blockquote><p>æ­¤ç³»åˆ—éœ€è¦ä¸€ç‚¹ShaderLabçŸ¥è¯†,ä¸»è¦è®¨è®º<code>ä¸ºä»€ä¹ˆ</code>ã€‚æ¥ä¸‹æ¥ä¼šç”±æµ…å…¥æ·±ä»<strong>ç”Ÿæˆçš„æºä»£ç </strong>åˆ†æã€‚</p><h2 id="ä¸€åŸºæœ¬ä»£ç ç»“æ„">ä¸€ã€åŸºæœ¬ä»£ç ç»“æ„</h2><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>Shader <span class="st">"Custom/SampleSurfaceShader"</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    SubShader</span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    Tags <span class="op">{</span> <span class="st">"RenderType"</span> <span class="op">=</span> <span class="st">"Opaque"</span> <span class="op">}</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    CGPROGRAM</span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">//1. surface å¤„ç†å‡½æ•° å…‰ç…§å¤„ç†å‡½æ•°</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#pragma surface surf Lambert</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    </span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">//2. è¾“å…¥ç»“æ„</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Input <span class="op">{</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>      float4 color <span class="op">:</span> COLOR<span class="op">;</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">//3. å¤„ç†å‡½æ•°</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> surf<span class="op">(</span>Input IN<span class="op">,</span> inout SurfaceOutput o<span class="op">)</span> <span class="op">{</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>      o<span class="op">.</span>Albedo <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        ENDCG</span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ä¸æ”¯æŒçš„æƒ…å†µè¢«ä½¿ç”¨</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    FallBack FallBackShaderName</span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><p>ä»¥ä¸Šç»“æ„æ˜¯æ¯”è¾ƒç®€å•çš„ç»“æ„ã€‚æ¥ä¸‹æ¥é€æ¡è§£é‡Š:</p><ul><li><ol type="1"><li>surf å¤„ç†å‡½æ•° <code>surf</code> å¯¹åº”<code>void surf(Input IN, inout SurfaceOutput o)</code></li></ol></li><li><ol start="2" type="1"><li>Lambert å…‰ç…§å¤„ç†å‡½æ•° <code>Lambert</code> å¯¹åº”<code>inline fixed4 LightingLambert (SurfaceOutput s, UnityGI gi)</code>,æ­¤å‡½æ•°åœ¨ <code>Lighting.cginc</code>æ–‡ä»¶ä¸­å¯æ‰¾åˆ°ã€‚</li></ol></li><li><ol start="3" type="1"><li>è¾“å…¥æ•°æ®ç»“æ„ æ ¹æ®éœ€è¦æ·»åŠ ï¼Œä¸»è¦æ˜¯ç»è¿‡<code>surf</code>å¤„ç†å‡½æ•°ç»™è¾“å‡ºç»“æ„SurfaceOutput èµ‹å€¼ã€‚</li></ol></li><li><ol start="4" type="1"><li>è¾“å‡ºæ•°æ®ç»“æ„æ ¹æ®éœ€è¦æ·»åŠ ï¼Œä¸»è¦æ˜¯ç»è¿‡å…‰ç…§å¤„ç†å‡½æ•°<code>Lambert</code>å‡½æ•°ç¡®å®šfragment çš„è¾“å‡ºã€‚</li></ol></li></ul><p>** è¿™é‡Œé¢å‡ ä¸ªç‚¹(å¤„ç†å‡½æ•°surfã€ å…‰ç…§å‡½æ•°ã€è¾“å…¥ç»“æ„ã€è¾“å‡ºç»“æ„)éœ€è¦ç»†è¯´ï¼Œåœ¨ä¸‹é¢å±•å¼€è®¨è®º.**</p><h2 id="äºŒä»ä»£ç æ·±ç©¶åŸºæœ¬ç»“æ„">äºŒã€ä»ä»£ç æ·±ç©¶åŸºæœ¬ç»“æ„</h2><p>é¦–å…ˆæ¡†æ¶æ˜¯Unityå®šçš„ï¼Œæ‰€ä»¥å°±ä»UnityShader æµç¨‹å…¥æ‰‹ã€‚Unityå†…ç½®è¾…åŠ©å‡½æ•°æ–‡ä»¶ï¼š Unityå®‰è£…ç›®å½• Unityçš„Shaderç¼–è¯‘å·¥å…·ï¼šUnityå®‰è£…ç›®å½•.exe Unity ä¸¤ä¸ªå†…ç½®å…‰ç…§æ¨¡å‹ï¼š * Lambertï¼š ç”¨äºæ¼«å°„å…‰ç…§ *BlinnPhong ï¼š ç”¨äºé•œé¢åå°„å…‰ç…§ã€‚</p><p>å…ˆçœ‹è§„åˆ™ï¼š</p><ul><li><ol type="1"><li>é€šè¿‡ <code>#pragma surface a b</code>æŒ‡å®š å¤„ç†å‡½æ•°a å’Œå…‰ç…§å‡½æ•°b</li></ol></li><li><ol start="2" type="1"><li>å¤„ç†å‡½æ•°çš„å½¢å¼ç»“æ„<code>void surf (è¾“å…¥ç»“æ„ç±»å‹ IN, inout è¾“å‡ºç»“æ„ç±»å‹ o) { /*ä¸€äº›ä»£ç */ }</code></li></ol></li><li><ol start="3" type="1"><li>å…‰ç…§å‡½æ•°ï¼Œå…‰ç…§å‡½æ•°æ˜¯ä»¥ <code>half4 Lighting</code>å¼€å¤´çš„å¸¸è§„å‡½æ•°ï¼Œæ¯”å¦‚ LightingSample, ä½¿ç”¨æ—¶åªéœ€è¦å†™<code>#pragma surface surf Sample</code></li></ol><ul><li><ol type="1"><li>half4 Lighting<name> (SurfaceOutput s, UnityGI gi);åœ¨<strong>ä¸ä¾èµ–äºè§†å›¾æ–¹å‘</strong>çš„å…‰ç…§æ¨¡å‹çš„<strong>å‰å‘æ¸²æŸ“è·¯å¾„</strong>ä¸­ä½¿ç”¨æ­¤å‡½æ•°ã€‚</name></li></ol></li><li><ol start="2" type="1"><li>half4 Lighting<name> (SurfaceOutput s, half3 viewDir, UnityGI gi);åœ¨<strong>ä¾èµ–äºè§†å›¾æ–¹å‘</strong>çš„å…‰ç…§æ¨¡å‹çš„<strong>å‰å‘æ¸²æŸ“è·¯å¾„</strong>ä¸­ä½¿ç”¨æ­¤å‡½æ•°ã€‚</name></li></ol></li><li><ol start="3" type="1"><li>half4 Lighting<name>_Deferred (SurfaceOutput s, UnityGI gi, outhalf4 outDiffuseOcclusion, out half4 outSpecSmoothness, out half4outNormal); åœ¨<strong>å»¶è¿Ÿå…‰ç…§è·¯å¾„</strong>ä¸­ä½¿ç”¨æ­¤å‡½æ•°ã€‚</name></li></ol></li><li><ol start="4" type="1"><li>half4 Lighting<name>_PrePass (SurfaceOutput s, half4 light);åœ¨<strong>å…‰ç…§é¢„é€šé“ï¼ˆæ—§ç‰ˆå»¶è¿Ÿï¼‰å…‰ç…§è·¯å¾„</strong>ä¸­ä½¿ç”¨æ­¤å‡½æ•°ã€‚</name></li></ol></li></ul><p>è¯·æ³¨æ„æ— éœ€å£°æ˜æ‰€æœ‰å‡½æ•°ã€‚å…‰ç…§æ¨¡å‹ä¸ä¸€å®šä¼šä½¿ç”¨è§†å›¾æ–¹å‘ã€‚åŒæ ·ï¼Œ<strong>å¦‚æœä»…åœ¨å‰å‘æ¸²æŸ“ä¸­ä½¿ç”¨å…‰ç…§æ¨¡å‹ï¼Œè¯·å‹¿å£°æ˜_Deferred å’Œ _Prepasså‡½æ•°ã€‚</strong>è¿™ç¡®ä¿äº†ä½¿ç”¨è§†å›¾æ–¹å‘çš„ç€è‰²å™¨ä»…ç¼–è¯‘åˆ°å‰å‘æ¸²æŸ“ã€‚</p></li><li><ol start="4" type="1"><li>è¾“å…¥ç»“æ„éœ€è¦å¯¹åº”å¤„ç†å‡½æ•°<code>surf</code> è¾“å…¥å‚æ•°</li></ol></li><li><ol start="5" type="1"><li>è¾“å‡ºç»“æ„éœ€è¦å¯¹åº”å¤„ç†å‡½æ•°<code>surf</code>ä¼ å‡ºå‚æ•°ï¼Œå¹¶ä¸”éœ€è¦å¯¹åº”å…‰ç…§å‡½æ•°çš„è¾“å…¥å‚æ•°</li></ol></li></ul><p>å¦å¤–æä¸€ç‚¹ï¼ŒæŸ¥çœ‹ShaderLabç¼–è¯‘æ–‡ä»¶çš„æ–¹æ³•: ShaderLabæœ€ç»ˆä¼š ç¼–è¯‘ä¸ºå¹³å°çš„<code>vert</code> å’Œ <code>fragment</code> Shader å¹³å°ç”Ÿæˆä»£ç ï¼šå¼•æ“ä¸­é€‰ä¸­ShaderLab--&gt; Inspectoré¢æ¿çš„<code>Compile and show code</code>çš„ä¸‹æ‹‰èœå•é€‰æ‹©ç¼–è¯‘å¹³å°çš„é€‰é¡¹--&gt;ç‚¹å‡»<code>Compile and show code</code>å¯æŸ¥çœ‹ç”Ÿæˆä»£ç ã€‚ ShaderLabç”Ÿæˆï¼šå¼•æ“ä¸­é€‰ä¸­ShaderLab--&gt; ç‚¹å‡» Inspectoré¢æ¿çš„<code>Show genterated code</code> å¯æŸ¥çœ‹ShaderLabç”Ÿæˆä»£ç </p><h3 id="ç”Ÿæˆä»£ç åˆ†æ">ç”Ÿæˆä»£ç åˆ†æ</h3><p>SurfaceShader</p><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>Shader <span class="st">"Custom/SampleSurfaceShader"</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    SubShader</span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    Tags <span class="op">{</span> <span class="st">"RenderType"</span> <span class="op">=</span> <span class="st">"Opaque"</span> <span class="op">}</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    CGPROGRAM</span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#pragma surface surf Lambert</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Input <span class="op">{</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>      float4 color <span class="op">:</span> COLOR<span class="op">;</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> surf<span class="op">(</span>Input IN<span class="op">,</span> inout SurfaceOutput o<span class="op">)</span> <span class="op">{</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>      o<span class="op">.</span>Albedo <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        ENDCG</span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    FallBack <span class="st">"Diffuse"</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><ul><li><p>ç”Ÿæˆä»£ç å¯¹ä¸åŒRendering mode ç”Ÿæˆä¸€ä¸ª passã€‚ <img src="images/SurfShaderGenerated.png" alt="ç”Ÿæˆä»£ç ç»“æ„"></p></li><li><p>Pass ç¼–è¯‘ä¸º Unlitå½¢å¼, å†æ ¹æ® <code>INSTANCING_ON</code> å’Œé<code>INSTANCING_ON</code> å†ç”Ÿæˆä»£ç  å¯¹åº”çš„ <code>vert</code> å’Œ<code>fragment</code> ä»£ç  <img src="images/BasePass.png" alt="Passç»“æ„"></p></li><li><p>ç”±äºä»£ç æ¯”è¾ƒé•¿ï¼Œåªåˆ†æ é <code>INSTANCING_ON</code> <img src="images/Pass_NInstance.png" alt="Passå­ç»“æ„"></p></li><li><p>è¾“å…¥è¾“å‡ºç»“æ„æ ¹æ® <code>LIGHTMAP_ON</code> å’Œ é<code>LIGHTMAP_ON</code> é€‰é¡¹å†ç”Ÿæˆä»£ç ã€‚ å¦å¤–å®ç°äº† æ­¤æ¨¡å¼ä¸‹å¯¹åº”çš„<code>vert_surf</code> å’Œ <code>frag_surf</code>å¯¹åº”Passçš„<code>#pragma vertex vert_surf</code>å’Œ<code>#pragma fragment frag_surf</code><img src="images/real_pass_funcs.png" alt="Pass funcs"></p></li></ul><p>æ­¤æ—¶ä»£ç è¿˜æ˜¯æŒºå¤šã€‚</p><p>vert_surf</p><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">// vertex shader</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>v2f_surf vert_surf <span class="op">(</span>appdata_full v<span class="op">)</span> <span class="op">{</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  </span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  v2f_surf o<span class="op">;</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> o<span class="op">;</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef LIGHTMAP_ON</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// half-precision fragment shader registers:</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#ifdef UNITY_HALF_PRECISION_FRAGMENT_SHADER_REGISTERS</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define FOG_COMBINED_WITH_WORLD_POS</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> v2f_surf <span class="op">{</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>      UNITY_POSITION<span class="op">(</span>pos<span class="op">);</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>      float3 worldNormal <span class="op">:</span> TEXCOORD0<span class="op">;</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>      float4 worldPos <span class="op">:</span> TEXCOORD1<span class="op">;</span></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>      <span class="pp">#if UNITY_SHOULD_SAMPLE_SH</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>      half3 sh <span class="op">:</span> TEXCOORD2<span class="op">;</span> <span class="co">// SH</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>      <span class="pp">#endif</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>      UNITY_LIGHTING_COORDS<span class="op">(</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">)</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>      <span class="pp">#if SHADER_TARGET &gt;= 30</span></span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>      float4 lmap <span class="op">:</span> TEXCOORD5<span class="op">;</span></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>      <span class="pp">#endif</span></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>      UNITY_VERTEX_INPUT_INSTANCE_ID</span><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>      UNITY_VERTEX_OUTPUT_STEREO</span><span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span><span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// high-precision fragment shader registers:</span></span><span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#ifndef UNITY_HALF_PRECISION_FRAGMENT_SHADER_REGISTERS</span></span><span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span><span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span><span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="pp">#endif</span></span></code></pre></div><p>frag_surf</p><div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// fragment shader</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>fixed4 frag_surf <span class="op">(</span>v2f_surf IN<span class="op">)</span> <span class="op">:</span> SV_Target <span class="op">{</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// prepare and unpack data</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 1. è¿™ä¸ªInput å°±æ˜¯æˆ‘ä»¬ä»£ç å£°æ˜çš„Inputç»“æ„ç±»å‹</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  Input surfIN<span class="op">;</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="pp">#ifdef FOG_COMBINED_WITH_TSPACE</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  UNITY_EXTRACT_FOG_FROM_TSPACE<span class="op">(</span>IN<span class="op">);</span></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="pp">#elif defined FOG_COMBINED_WITH_WORLD_POS</span></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  UNITY_EXTRACT_FOG_FROM_WORLD_POS<span class="op">(</span>IN<span class="op">);</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="pp">#else</span></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  UNITY_EXTRACT_FOG<span class="op">(</span>IN<span class="op">);</span></span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="pp">#endif</span></span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 2. ç»™surfINé»˜è®¤å€¼åˆå§‹åŒ–ã€‚ surfIN = (Input)0;</span></span><span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  UNITY_INITIALIZE_OUTPUT<span class="op">(</span>Input<span class="op">,</span>surfIN<span class="op">);</span></span><span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span><span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="pp">#ifdef UNITY_COMPILER_HLSL</span></span><span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  SurfaceOutput o <span class="op">=</span> <span class="op">(</span>SurfaceOutput<span class="op">)</span><span class="dv">0</span><span class="op">;</span></span><span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="pp">#else</span></span><span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  SurfaceOutput o<span class="op">;</span></span><span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="pp">#endif</span></span><span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span><span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 3. </span></span><span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  o<span class="op">.</span>Normal <span class="op">=</span> IN<span class="op">.</span>worldNormal<span class="op">;</span></span><span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  normalWorldVertex <span class="op">=</span> IN<span class="op">.</span>worldNormal<span class="op">;</span></span><span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 4. è°ƒç”¨æˆ‘ä»¬SurfaceShaderçš„ surfå‡½æ•°ã€‚</span></span><span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">// call surface function</span></span><span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  surf <span class="op">(</span>surfIN<span class="op">,</span> o<span class="op">);</span></span><span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  <span class="co">// UNITY_LIGHT_ATTENUATION æ‹¥æœ‰ä¸åŒç±»å‹çš„å®šä¹‰</span></span><span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="co">//#ifdef DIRECTIONAL</span></span><span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="co">//#   define UNITY_LIGHT_ATTENUATION(destName, input, worldPos) fixed destName = UNITY_SHADOW_ATTENUATION(input, worldPos);</span></span><span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">//#endif</span></span><span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ã€‚ã€‚ã€‚</span></span><span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>  <span class="co">// compute lighting &amp; shadowing factor</span></span><span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  UNITY_LIGHT_ATTENUATION<span class="op">(</span>atten<span class="op">,</span> IN<span class="op">,</span> worldPos<span class="op">)</span></span><span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  fixed4 c <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Setup lighting environment</span></span><span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>  UnityGI gi<span class="op">;</span></span><span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>  UNITY_INITIALIZE_OUTPUT<span class="op">(</span>UnityGI<span class="op">,</span> gi<span class="op">);</span></span><span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>  </span><span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>  <span class="co">//...</span></span><span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>  </span><span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Call GI (lightmaps/SH/reflections) lighting function</span></span><span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  UnityGIInput giInput<span class="op">;</span></span><span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  UNITY_INITIALIZE_OUTPUT<span class="op">(</span>UnityGIInput<span class="op">,</span> giInput<span class="op">);</span></span><span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  </span><span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>  <span class="co">//...</span></span><span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 5. lightmapå¤„ç†</span></span><span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  LightingLambert_GI<span class="op">(</span>o<span class="op">,</span> giInput<span class="op">,</span> gi<span class="op">);</span></span><span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>  <span class="co">// 6. æˆ‘ä»¬ShaderLabä½¿ç”¨çš„å…‰ç…§å‡½æ•°</span></span><span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  <span class="co">// realtime lighting: call lighting function</span></span><span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  c <span class="op">+=</span> LightingLambert <span class="op">(</span>o<span class="op">,</span> gi<span class="op">);</span></span><span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ...</span></span><span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> c<span class="op">;</span></span><span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><h2 id="ä¸‰å°èŠ‚">ä¸‰ã€å°èŠ‚ï¼š</h2><ul><li>SurfaceShader ä¼šç¼–è¯‘ä¸º UnlitShaderå½¢å¼ <code>vert</code> å’Œ<code>fragment</code></li><li>ç¼–è¯‘åçš„<code>vert</code>çš„è¾“å…¥ç»“æ„ä¸º appdata_fullç±»å‹</li><li>SurfaceShader çš„å¤„ç†å‡½æ•°<code>surf</code>å’Œå…‰ç…§å‡½æ•°éƒ½åœ¨<code>fragment</code>ä¸­è¿›è¡Œã€‚</li><li><strong>å…‰ç…§å‡½æ•°ä¼ å…¥å‚æ•°</strong>æ˜¯ SurfaceShaderçš„<code>outä¼ å‡ºç»“æ„</code>, æ‰€ä»¥ç±»å‹éœ€è¦ä¸€è‡´ã€‚</li></ul><h2 id="å››è‡ªå®šä¹‰å…‰ç…§å‡½æ•°">å››ã€è‡ªå®šä¹‰å…‰ç…§å‡½æ•°</h2><p>å‡½æ•°éœ€è¦ä»¥ <code>half4 Lighting</code>å¼€å¤´ï¼Œå¹¶ä¸”<code>ä¼ å‡ºç»“æ„</code>ä¸­<code>fixed3 Albedo;</code>ã€<code>fixed3 Normal;</code>ã€<code>fixed3 Emission;</code>ã€<code>fixed Alpha;</code>æ˜¯å¿…é¡»çš„æˆå‘˜ã€‚</p><ul><li><p>half4 Lighting<name> (ä¼ å‡ºç»“æ„ç±»å‹ s, half3 lightDir, halfatten)</name></p></li><li><p>half4 Lighting<name> (ä¼ å‡ºç»“æ„ç±»å‹ s, half3 lightDir, half3viewDir, half atten)</name></p></li><li><p>inline half4 Lighting<name>(ä¼ å‡ºç»“æ„ç±»å‹ s, half3 viewDir,UnityGI gi)</name></p></li><li><p>inline half4 Lighting<name>(ä¼ å‡ºç»“æ„ç±»å‹ s, half3 viewDir,UnityGI gi)</name></p></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/shader/0.shader-shou-cang/"/>
      <url>/2022/08/10/unity/shader/0.shader-shou-cang/</url>
      
        <content type="html"><![CDATA[<h2 id="unityshaderæ”¶è—">UnityShaderæ”¶è—</h2><ol type="1"><li><a href="https://blog.csdn.net/puppet_master/article/details/52975666">å±å¹•æ°´æ³¢æ•ˆæœ</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/math/2.xuan-zhuan-tui-dao/"/>
      <url>/2022/08/10/unity/math/2.xuan-zhuan-tui-dao/</url>
      
        <content type="html"><![CDATA[<h1 id="æ—‹è½¬æ¨å¯¼">æ—‹è½¬æ¨å¯¼</h1><blockquote><p>é»˜è®¤ç»•åŸç‚¹æ—‹è½¬ï¼Œ é€†æ—¶é’ˆæ—‹è½¬ã€‚</p></blockquote><p><img src="imgs/Snipaste_2021-03-17_21-57-42.png" alt="æ—‹è½¬æ¨å¯¼"><img src="imgs/Snipaste_2021-03-17_21-59-02.png" alt="æ—‹è½¬æ¨å¯¼"></p><h2 id="éœ€è¦ç”¨åˆ°çš„ä¸‰è§’å…¬å¼">éœ€è¦ç”¨åˆ°çš„ä¸‰è§’å…¬å¼</h2><ul><li>å’Œå·®åŒ–ç§¯</li></ul><p><span class="math display">\[    \sinÎ± + \sin\beta = 2\sin\frac{Î± + \beta}{2}\cos\frac{Î± - \beta}{2}\]</span></p><p><span class="math display">\[      \sinÎ± - \sin\beta = 2\cos\frac{Î± + \beta}{2}\sin\frac{Î± - \beta}{2}\]</span></p><p><span class="math display">\[    \cosÎ± + \cos\beta = 2\cos\frac{Î± + \beta}{2}\cos\frac{Î± - \beta}{2}\]</span></p><p><span class="math display">\[      \cosÎ± - \cos\beta = 2\sin\frac{Î± + \beta}{2}\sin\frac{Î± - \beta}{2}\]</span></p><p><span class="math display">\[    \tanÎ± \pm \tan\beta = \frac{\sin(Î± \pm\beta)}{\cosÎ±. \cos\beta}     \]</span></p><p><span class="math display">\[    \cotÎ± \pm \cot\beta = `-` \pm \frac{\sin(Î± \pm \beta)}{\sinÎ±.\sin\beta}        \]</span></p><ul><li>ç§¯åŒ–å’Œå·®</li></ul><p><span class="math display">\[    \sinÎ±\cos\beta = \frac{1}{2}[\sin(Î± + \beta) + \sin(Î± - \beta)]\]</span></p><p><span class="math display">\[    \cosÎ±\sin\beta = \frac{1}{2}[\sin(Î± + \beta) - \sin(Î± - \beta)]\]</span></p><p><span class="math display">\[    \cosÎ±\cos\beta = \frac{1}{2}[\cos(Î± + \beta) + \cos(Î± - \beta)]\]</span></p><p><span class="math display">\[    \sinÎ±\sin\beta = \frac{1}{2}[\cos(Î± + \beta) - \cos(Î± - \beta)]\]</span></p><h2 id="æ—‹è½¬">æ—‹è½¬</h2><h3 id="d-æ—‹è½¬æ¨å¯¼">2d æ—‹è½¬æ¨å¯¼</h3><figure><img src="/Sources/imgs/æ—‹è½¬æ¨å¯¼1.png" alt="æ—‹è½¬æ¨å¯¼1"><figcaption aria-hidden="true">æ—‹è½¬æ¨å¯¼1</figcaption></figure><p>å·²çŸ¥:</p><p><span class="math display">\[å•ä½åœ†ä¸Šç‚¹ A åæ ‡ä¸º(x, y), ä¸xè½´å¤¹è§’ä¸º Î±, ç‚¹B ä¸ç‚¹ Aå¤¹è§’ä¸º \]</span><span class="math display">\[ã€‚ æ±‚ç‚¹B åæ ‡ã€‚\]</span></p><p>æ¨å¯¼ï¼š</p><p><span class="math display">\[    è®¾å®š B åæ ‡ä¸º(x_{b}, y_{b}),  é‚£ä¹ˆ x_{b} = \cos( Î± - \beta), \\    ç”±ç§¯åŒ–å’Œå·®å…¬å¼ 3 4 å¾—ï¼Œ \cos(Î± - \beta) = \cosÎ±\cos\beta -\sinÎ±\sin\beta  \\    æ‰€ä»¥ x_{b} = x\cos\beta - y\sin\beta \\    åŒç† y_{b} = y\cos\beta + x\sin\beta \\\]</span></p><p>å…¬å¼å†™æˆçŸ©é˜µçš„å½¢å¼ï¼š</p>$$<span class="math display">\[\begin{bmatrix}        \cos\beta &amp; -\sin\beta \\        \sin\beta &amp; \cos\beta    \end{bmatrix}    \begin{bmatrix}        x\\y    \end{bmatrix}\]</span><p>=</p><pre><code>\begin{bmatrix}    x\cos\beta &amp; -y\sin\beta \\    x\sin\beta &amp; y\cos\beta\end{bmatrix}</code></pre><p>$$</p><h3 id="d-æ—‹è½¬æ¨å¯¼-1">3d æ—‹è½¬æ¨å¯¼</h3><p>åŒ 2d æ¨å¯¼, å¢åŠ z è½´ã€‚ ç»•x æ—‹è½¬æ—¶ï¼Œ ä¸å½±å“xï¼Œç»•yæ—¶ï¼Œä¸å½±å“yï¼Œç»•zæ—¶ä¸å½±å“zã€‚ <strong>ä½†æ˜¯æ¯ä¸ªæ‰°åŠ¨éƒ½æ˜¯ä¾èµ–ä¸Šä¸ªæ‰°åŠ¨çš„ç»“æœ</strong></p><p>æ­¤æ¨å¯¼æŒ‰ç…§ zã€yã€x å…ˆåé¡ºåºæ—‹è½¬ã€‚ <span class="math display">\[    x_{rx} ä»£è¡¨ç»• x æ—‹è½¬çš„ xåˆ†é‡å€¼ã€‚y_{rx} ç»•x æ—‹è½¬çš„ yåˆ†é‡å€¼ã€‚æ—‹è½¬è§’åº¦åˆ†é‡ä¸º \beta_{x}ã€\beta_{y}ã€\beta_{z} \\    å…ˆç»•zæ—‹è½¬ã€‚ \\    x_{rz} = x\cos\beta_{z}  -  y\sin\beta_{z}  \\    y_{rz} = x\cos\beta_{z}  +  y\sin\beta_{z}  \\    z_{rz} = z  \\    å†ç»•yæ—‹è½¬   \\    x_{ry} = x_{rx}\cos\beta_{y}  -  y_{rx}\sin\beta_{y} \\    x_{ry} = y_{rx} \\    x_{ry} = x_{rx}\cos\beta_{y}  +  y_{rx}\sin\beta_{y}    \\    æœ€åç»•xæ—‹è½¬  \\    x_{rx} = x_{ry} \\    x_{rx} = y_{ry}\cos\beta_{x}  -  y_{ry}\sin\beta_{x}    \\    x_{rx} = x_{ry}\cos\beta_{x}  +  y_{ry}\sin\beta_{x}    \\\]</span></p><p>å…¬å¼å†™æˆçŸ©é˜µçš„å½¢å¼ï¼š ç»• z æ—‹è½¬</p>$$<span class="math display">\[\begin{bmatrix}        \cos\beta_{z}   &amp; -\sin\beta_{z} &amp;0     \\        \sin\beta_{z}   &amp; \cos\beta_{z} &amp;0      \\        0           &amp; 0         &amp; 1     \\    \end{bmatrix}    \begin{bmatrix}        x\\y \\z    \end{bmatrix}\]</span><p>=</p><pre><code>\begin{bmatrix}    x\cos\beta_{z} - y\sin\beta_{z} \\    x\sin\beta_{z} + y\cos\beta_{z}    z   \\\end{bmatrix}</code></pre><p>$$</p><p>ç»• y æ—‹è½¬</p>$$<span class="math display">\[\begin{bmatrix}        \cos\beta_{y}   &amp;0      &amp; \sin\beta_{y} \\        0           &amp; 1     &amp; 0 \\        -\sin\beta_{y}  &amp;0      &amp; \cos\beta_{y}    \end{bmatrix}    \begin{bmatrix}        x\\y \\z    \end{bmatrix}\]</span><p>=</p><pre><code>\begin{bmatrix}    x\cos\beta_{y} + z\sin\beta_{y} \\    y   \\    -x\sin\beta_{y} + z\cos\beta_{y}\end{bmatrix}</code></pre><p>$$</p><p>ç»•x æ—‹è½¬</p>$$<span class="math display">\[\begin{bmatrix}        1 &amp; 0           &amp; 0 \\        0 &amp; \cos\beta_{x}   &amp; -\sin\beta_{x} \\        0 &amp; \sin\beta_{x}   &amp; \cos\beta_{x}    \end{bmatrix}    \begin{bmatrix}        x\\y \\z    \end{bmatrix}\]</span><p>=</p><pre><code>\begin{bmatrix}    x   \\    y\cos\beta_{x} - z\sin\beta_{x} \\    y\sin\beta_{x} + z\cos\beta_{x}\end{bmatrix}</code></pre><p>$$</p><p>æŒ‰ç…§ zã€yã€x å…ˆåé¡ºåºæ—‹è½¬çš„çŸ©é˜µã€‚</p>$$<span class="math display">\[\begin{bmatrix}        \cos\beta_{y}\cos\beta_{z}  &amp; -\cos\beta_{y}\sin\beta_{z}&amp; \sin\beta_{y}   \\        \cos\beta_{x}\sin\beta_{z} +\sin\beta_{x}\sin\beta_{y}\cos\beta_{z}    &amp;\cos\beta_{x}\cos\beta_{z} -\sin\beta_{x}\sin\beta_{y}\sin\beta_{z}  &amp;  \sin\beta_{x}\cos\beta_{y}   \\        \sin\beta_{x}\sin\beta_{z} -\cos\beta_{x}\sin\beta_{y}\cos\beta_{z}    &amp;\sin\beta_{x}\cos\beta_{z} +\cos\beta_{x}\sin\beta_{y}\sin\beta_{z}  &amp;  \cos\beta_{x}\cos\beta_{y}   \\    \end{bmatrix}    \begin{bmatrix}        x\\y \\z    \end{bmatrix}\]</span><p>=</p><pre><code>\begin{bmatrix}    x\cos\beta - y\sin\beta \\    x\sin\beta + y\cos\beta    z   \\\end{bmatrix}</code></pre><p>$$</p><h2 id="å¹³ç§»">å¹³ç§»</h2><p>é€šè¿‡å¢å¹¿çŸ©é˜µ å¢åŠ ä¸€åˆ—æ„æˆ 3x4 çŸ©é˜µï¼Œæ‹¼å‡‘æˆ 4x4 çŸ©é˜µï¼Œ åˆ™å¢åŠ  ä¸€è¡Œ [0,0, 0, w], æ­£äº¤ç›¸æœº w = 1.</p><h2 id="ç¼©æ”¾">ç¼©æ”¾</h2><p>å•ä½çŸ©é˜µå¯¹è§’çº¿ ä½œä¸ºç¼©æ”¾å‚æ•°</p><h2 id="unity-çŸ©é˜µ">Unity çŸ©é˜µ</h2><p><code>Matrix4x4.MultiplyPoint</code>è¿ç®—çŸ©é˜µï¼Œå½“è¿ç®—æ–¹å‘è€Œä¸æ˜¯ç‚¹çš„æ—¶å€™ä½¿ç”¨<code>Matrix4x4.MultiplyVector.</code>.éœ€è¦è·³è¿‡è¿ç®—[0,0,0,1] æ—¶ä½¿ç”¨<code>The Matrix4x4.MultiplyPoint4x3</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/math/1.matrix4x4/"/>
      <url>/2022/08/10/unity/math/1.matrix4x4/</url>
      
        <content type="html"><![CDATA[<h1 id="matrix4x4">Matrix4x4</h1><blockquote><p>ä¸»è¦ç”¨é€”å˜æ¢</p></blockquote><h2 id="api">API</h2><ol type="1"><li>public Matrix4x4(Vector4 column0, Vector4 column1, Vector4 column2,Vector4 column3); æ„é€ å‡½æ•°ï¼ŒUnityçŸ©é˜µæŒ‰åˆ—å¡«å…….</li></ol><div class="sourceCode" id="cb1"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    Matrix4x4 mat4x4 <span class="op">=</span> <span class="kw">new</span> <span class="fu">Matrix4x4</span><span class="op">(</span><span class="kw">new</span> <span class="fu">Vector4</span><span class="op">(</span>m00<span class="op">,</span> m10<span class="op">,</span> m20<span class="op">,</span> m30<span class="op">),</span><span class="kw">new</span> <span class="fu">Vector4</span><span class="op">(</span>m01<span class="op">,</span> m11<span class="op">,</span> m21<span class="op">,</span> m31<span class="op">),</span><span class="kw">new</span> <span class="fu">Vector4</span><span class="op">(</span>m02<span class="op">,</span> m12<span class="op">,</span> m22<span class="op">,</span> m32<span class="op">),</span><span class="kw">new</span> <span class="fu">Vector4</span><span class="op">(</span>m03<span class="op">,</span> m13<span class="op">,</span> m23<span class="op">,</span> m33<span class="op">))</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// m00 m01 m02 m03</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// m10 m11 m12 m13</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// m20 m21 m22 m23</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// m30 m31 m32 m33</span></span></code></pre></div><ol start="2" type="1"><li><p>public float this[int index] { get; set; }ã€ public floatthis[int row, int column] { get; set; } ç”±äºæŒ‰åˆ—å¡«å……ï¼Œåˆ™ index ä¸º 00ï¼Œ10 ï¼Œ20ï¼Œ30ï¼Œ 01ã€‚ã€‚ã€‚é¡ºåº, æ‰€ä»¥ this[1] == this[1, 0]</p></li><li><p>public static Matrix4x4 zero { get; } oçŸ©é˜µã€ public staticMatrix4x4 identity { get; } å•ä½çŸ©é˜µ</p></li><li><p>public Matrix4x4 transpose { get; } è½¬ç½®çŸ©é˜µ, é€†å˜æ¢çŸ©é˜µ, m[i,j]= m'[j, i]</p><ol type="1"><li>public static Matrix4x4 Transpose(Matrix4x4 m);</li></ol></li></ol><p><img src="/Sources/imgs/matrix4x4.png"></p><ol start="5" type="1"><li>å˜æ¢<ol type="1"><li>public Quaternion rotation { get; } æ—‹è½¬ã€‚<br></li><li>public Vector3 lossyScale { get; } ç¼©æ”¾.</li><li>public bool isIdentity { get; }æ˜¯å¦ä¸ºå•ä½<code>Identity</code>çŸ©é˜µ,</li><li>GetColumn(3)æˆ–è€… transpose.GetRow(3) ä½ç½®</li><li>public static Matrix4x4 Rotate(Quaternion q);</li><li>public static Matrix4x4 Scale(Vector3 vector);</li><li>public static Matrix4x4 Translate(Vector3 vector);</li></ol></li><li>public float determinant { get; } çŸ©é˜µçš„'é¢ç§¯/ä½“ç§¯/è¶…ä½“ç§¯'ç›¸äº’å‚ç›´çš„è¯ ç­‰äº<code>scalex * scaley * scalez</code><ol type="1"><li>public static float Determinant(Matrix4x4 m);</li></ol></li><li>public FrustumPlanes decomposeProjection { get; }, çŸ©é˜µè§†æ¤ä½“,<ol type="1"><li>public static Matrix4x4 Frustum(float left, float right, floatbottom, float top, float zNear, float zFar);</li><li>public static Matrix4x4 Frustum(FrustumPlanes fp);</li><li>public static Matrix4x4 Ortho(float left, float right, float bottom,float top, float zNear, float zFar); æ­£äº¤</li><li>public static Matrix4x4 Perspective(float fov, float aspect, floatzNear, float zFar); é€è§†</li></ol><div class="sourceCode" id="cb2"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a> <span class="kw">public</span> <span class="kw">struct</span> FrustumPlanes</span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>     <span class="kw">public</span> <span class="dt">float</span> left<span class="op">;</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>     <span class="kw">public</span> <span class="dt">float</span> right<span class="op">;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>     <span class="kw">public</span> <span class="dt">float</span> bottom<span class="op">;</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>     <span class="kw">public</span> <span class="dt">float</span> top<span class="op">;</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>     <span class="kw">public</span> <span class="dt">float</span> zNear<span class="op">;</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>     <span class="kw">public</span> <span class="dt">float</span> zFar<span class="op">;</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span></code></pre></div></li><li>public Matrix4x4 inverse { get; } é€†çŸ©é˜µ.<ol type="1"><li>public static Matrix4x4 Inverse(Matrix4x4 m);</li><li>public static bool Inverse3DAffine(Matrix4x4 input, ref Matrix4x4result);</li></ol></li><li>public static Matrix4x4 LookAt(Vector3 from, Vector3 to, Vector3up);</li><li>public static Matrix4x4 LookAt(Vector3 from, Vector3 to, Vector3up);</li><li>public static Matrix4x4 TRS(Vector3 pos, Quaternion q, Vector3 s);æ„é€ å¹³ç§»æ—‹è½¬ç¼©æ”¾çŸ©é˜µã€‚<ol type="1"><li>ç­‰åŒ Matrix4x4.Translate(transform.position) *Matrix4x4.Rotate(transform.rotation) *Matrix4x4.Scale(transform.lossyScale) =Matrix4x4.TRS(transform.position, transform.rotation,transform.lossyScale)</li><li>public void SetTRS(Vector3 pos, Quaternion q, Vector3 s);</li></ol></li><li>æ“ä½œå…ƒç´ <ol type="1"><li>public Vector4 GetColumn(int index); è·å–åˆ—ï¼ŒUnityæŒ‰åˆ—å¡«å……ï¼Œä¹Ÿç­‰åŒäºä¼ ç»Ÿæ„ä¹‰çš„è¡Œ</li><li>public Vector4 GetRow(int index); è·å–è¡Œï¼ŒUnityæŒ‰åˆ—å¡«å……ï¼Œä¹Ÿç­‰åŒäºä¼ ç»Ÿæ„ä¹‰çš„åˆ—</li><li>public void SetColumn(int index, Vector4 column); å¡«å……åˆ—ï¼Œä¹Ÿç­‰åŒäºä¼ ç»Ÿæ„ä¹‰çš„è¡Œ</li><li>public void SetRow(int index, Vector4 row); å¡«å……è¡Œï¼Œä¹Ÿç­‰åŒäºä¼ ç»Ÿæ„ä¹‰çš„åˆ—</li></ol></li><li>ä¹˜, å®éªŒæ•ˆæœä¸€æ ·ï¼Ÿï¼Ÿï¼Ÿ<ol type="1"><li>public Vector3 MultiplyPoint(Vector3 point);//è¿”å›ç”±ä»»æ„çŸ©é˜µå˜åŒ–å¾—åˆ°çš„ä½ç½®vã€‚å¦‚æœè¿™ä¸ªçŸ©é˜µæ˜¯ä¸€ä¸ªæ­£è§„çš„3Då˜æ¢çŸ©é˜µï¼Œä½¿ç”¨MultiplyPoint3x4æ¯”å®ƒæ›´å¿«ã€‚MultiplyPointæ¯”è¾ƒæ…¢ï¼Œä½†æ˜¯èƒ½å¤„ç†æŠ•å½±å˜æ¢ã€‚</li><li>public Vector3 MultiplyPoint3x4(Vector3 point); //ä¸åŒ…å«æŠ•å½±</li><li>public Vector3 MultiplyVector(Vector3 vector);//åªå˜æ¢æ–¹å‘ï¼ˆæ—‹è½¬ï¼‰ï¼Œä»…è€ƒè™‘çŸ©é˜µçš„æ—‹è½¬éƒ¨åˆ†ã€‚</li></ol></li><li>public Plane TransformPlane(Plane plane); å¹³é¢è½¬æ¢</li><li>public bool ValidTRS(); //æ˜¯å¦ä¸ºæœ‰æ•ˆçŸ©é˜µ.</li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/entities/5.summy/"/>
      <url>/2022/08/10/unity/entities/5.summy/</url>
      
        <content type="html"><![CDATA[<h1 id="æ€»ç»“">æ€»ç»“</h1><h2 id="object-components">object components</h2><pre><code>public class DemoScript_1 : MonoBehaviour{    // Start is called before the first frame update    void Start()    {        var entityManager = World.DefaultGameObjectInjectionWorld.EntityManager;        var dog = new Dog();        var entity1 = entityManager.CreateEntity();        entityManager.AddComponentObject(entity1, dog);        var entity2 = entityManager.CreateEntity();        entityManager.AddComponentObject(entity2, dog);        dog.x = 10;        dog = entityManager.GetComponentObject&lt;Dog&gt;(entity1);        print(dog.x);               // 10        dog = entityManager.GetComponentObject&lt;Dog&gt;(entity2);        print(dog.x);               // 10        entityManager.RemoveComponent&lt;Dog&gt;(entity1);    }}public class Dog : IComponentData{      public int x;}</code></pre><p>AddComponentObjectéœ€è¦æ˜¯classç±»å‹ã€‚<code>m_ManagedComponentData[iManagedComponent] = value;</code>æ›´æ–°ã€‚</p><h2 id="chunk-components">chunk components</h2><h2 id="shared-components">shared components</h2><h2 id="system-state-components">system state components</h2><h2 id="entityquery">EntityQuery</h2><h2 id="blob-assets">blob assets</h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/entities/4.com-unity-rendering-hybrid/"/>
      <url>/2022/08/10/unity/entities/4.com-unity-rendering-hybrid/</url>
      
        <content type="html"><![CDATA[<h1 id="com.unity.rendering.hybrid">com.unity.rendering.hybrid</h1><blockquote><p>ecs æ¸²æŸ“æ’ä»¶</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/entities/3.entityandcomponent/"/>
      <url>/2022/08/10/unity/entities/3.entityandcomponent/</url>
      
        <content type="html"><![CDATA[<h1 id="entity-and-component">Entity And Component</h1><h2 id="entity">Entity</h2><h2 id="component">Component</h2><h2 id="generateauthoringcomponent">GenerateAuthoringComponent</h2><h2 id="entityquerybuilder">EntityQueryBuilder</h2><h2 id="converttoentity">ConvertToEntity</h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/entities/2.systems/"/>
      <url>/2022/08/10/unity/entities/2.systems/</url>
      
        <content type="html"><![CDATA[<h1 id="systems">Systems</h1><blockquote><p>ComponentSystemBaseã€SystemBaseã€ISystemBaseã€SystemStateã€Update</p></blockquote><h2 id="ç»§æ‰¿å…³ç³»">ç»§æ‰¿å…³ç³»</h2><ul><li>ComponentSystemBase<ul><li>SystemBase</li><li>JobComponentSystem</li><li>ComponentSystem<ul><li>EntityPatcherBlobAssetSystem</li><li>RetainBlobAssetSystem</li><li>ComponentSystemGroup<ul><li>InitializationSystemGroup</li><li>FixedStepSimulationSystemGroup</li><li>LateSimulationSystemGroup</li><li>SimulationSystemGroup</li><li>PresentationSystemGroup</li></ul></li><li>EntityCommandBufferSystem<ul><li>BeginInitializationEntityCommandBufferSystem</li><li>EndInitializationEntityCommandBufferSystem</li><li>BeginFixedStepSimulationEntityCommandBufferSystem</li><li>EndFixedStepSimulationEntityCommandBufferSystem</li><li>BeginSimulationEntityCommandBufferSystem</li><li>EndSimulationEntityCommandBufferSystem</li><li>BeginPresentationEntityCommandBufferSystem</li></ul></li></ul></li></ul></li></ul><h2 id="ç”Ÿå‘½å‘¨æœŸ">ç”Ÿå‘½å‘¨æœŸ</h2><h3 id="create">1.Create</h3><ul><li>OnCreateForCompiler(); è¢«è°ƒç”¨äºCreateInstanceï¼Œè¢«è°ƒç”¨äºWorld.CreateSystemInternal</li><li>OnCreate è¢«è°ƒç”¨äºCreateInstanceï¼Œè¢«è°ƒç”¨äºWorld.CreateSystemInternal</li></ul><pre><code>internal void CreateInstance(World world){    m_StatePtr = SystemState.Allocate();    m_StatePtr-&gt;InitManaged(world, GetType());    OnBeforeCreateInternal(world);    try    {        OnCreateForCompiler();        OnCreate();    }    catch    {        OnBeforeDestroyInternal();        OnAfterDestroyInternal();        throw;    }}</code></pre><h3 id="ondestroy">2.OnDestroy</h3><h3 id="update-ä¸»è¦">3. Update (ä¸»è¦)</h3><ul><li>ComponentSystem.Update</li></ul><pre><code>public sealed override void Update(){    var state = CheckedState();#if ENABLE_PROFILER    using (state-&gt;m_ProfilerMarker.Auto())#endif    {        state-&gt;BeforeUpdateResetRunTracker();        if (Enabled &amp;&amp; ShouldRunSystem())        {            if (!state-&gt;m_PreviouslyEnabled)            {                state-&gt;m_PreviouslyEnabled = true;                OnStartRunning();            }            BeforeOnUpdate();            var oldExecutingSystem = ms_ExecutingSystem;            ms_ExecutingSystem = this;            try            {                OnUpdate();            }            finally            {                ms_ExecutingSystem = oldExecutingSystem;                AfterOnUpdate();            }        }        else if (state-&gt;m_PreviouslyEnabled)        {            state-&gt;m_PreviouslyEnabled = false;            OnStopRunningInternal();        }    }}</code></pre><ul><li>JobComponentSystem.Update</li></ul><pre><code>public sealed override void Update(){    var state = CheckedState();#if ENABLE_PROFILER    using (state-&gt;m_ProfilerMarker.Auto())#endif    {        if (Enabled &amp;&amp; ShouldRunSystem())        {            if (!state-&gt;m_PreviouslyEnabled)            {                state-&gt;m_PreviouslyEnabled = true;                OnStartRunning();            }            var inputJob = BeforeOnUpdate();            JobHandle outputJob = new JobHandle();            var oldExecutingSystem = ms_ExecutingSystem;            ms_ExecutingSystem = this;            try            {                outputJob = OnUpdate(inputJob);            }            catch            {                ms_ExecutingSystem = oldExecutingSystem;                AfterOnUpdate(outputJob, false);                throw;            }            ms_ExecutingSystem = oldExecutingSystem;            AfterOnUpdate(outputJob, true);        }        else if (state-&gt;m_PreviouslyEnabled)        {            state-&gt;m_PreviouslyEnabled = false;            OnStopRunning();        }    }}</code></pre><ul><li>SystemBase</li></ul><pre><code>public sealed override void Update(){    var state = CheckedState();#if ENABLE_PROFILER    using (state-&gt;m_ProfilerMarker.Auto())#endif    {        state-&gt;BeforeUpdateResetRunTracker();        if (Enabled &amp;&amp; ShouldRunSystem())        {            if (!state-&gt;m_PreviouslyEnabled)            {                state-&gt;m_PreviouslyEnabled = true;                OnStartRunning();            }            state-&gt;BeforeOnUpdate();            var oldExecutingSystem = ms_ExecutingSystem;            ms_ExecutingSystem = this;            try            {                OnUpdate();            }            catch            {                ms_ExecutingSystem = oldExecutingSystem;                state-&gt;AfterOnUpdate();#if ENABLE_UNITY_COLLECTIONS_CHECKS                var hasSafetyError = false;                var details = default(SystemDependencySafetyUtility.SafetyErrorDetails);                state-&gt;CheckSafety(ref details, ref hasSafetyError);#endif                throw;            }            ms_ExecutingSystem = oldExecutingSystem;            state-&gt;AfterOnUpdate();#if ENABLE_UNITY_COLLECTIONS_CHECKS            {                var hasSafetyError = false;                var details = default(SystemDependencySafetyUtility.SafetyErrorDetails);                state-&gt;CheckSafety(ref details, ref hasSafetyError);                if (hasSafetyError)                {                    throw new InvalidOperationException(details.FormatToString(GetType()));                }            }#endif        }        else if (state-&gt;m_PreviouslyEnabled)        {            state-&gt;m_PreviouslyEnabled = false;            OnStopRunning();        }    }}</code></pre><h2 id="åŒ…å«é‡è¦å¯¹è±¡">åŒ…å«é‡è¦å¯¹è±¡</h2><ul><li>SystemState</li></ul><h2 id="å…¶ä»–åˆ†ç»„å±æ€§">å…¶ä»–åˆ†ç»„å±æ€§</h2><h3 id="updateingroup">UpdateInGroup</h3><h3 id="updateafter">UpdateAfter</h3><h3 id="updatebefore">UpdateBefore</h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/entities/1.addsystemtoplayerloop/"/>
      <url>/2022/08/10/unity/entities/1.addsystemtoplayerloop/</url>
      
        <content type="html"><![CDATA[<h1 id="æ·»åŠ systemåˆ°å¼•æ“çš„playerloop">æ·»åŠ Systemåˆ°å¼•æ“çš„PlayerLoop</h1><p>todo: SystemStateã€</p><p>åªæ”¯æŒç»§æ‰¿è‡ª<code>ComponentSystemBase</code>å’Œ<code>ISystemBase</code>.</p><h2 id="æ·»åŠ è‡³world-ç¼“å­˜">æ·»åŠ è‡³World ç¼“å­˜</h2><h3 id="è·å–æ‰€æœ‰system">è·å–æ‰€æœ‰System</h3><p>åå°„è·å–ç»§æ‰¿è‡ª<code>ComponentSystemBase</code>/<code>ISystemBase</code>çš„æ‰€æœ‰ç±»å‹ã€‚ ï¼ˆTypeManager ç¼“å­˜ï¼‰</p><h3 id="æ·»åŠ system-addsystemtorootlevelsystemgroupsinternal">æ·»åŠ Systemï¼ˆAddSystemToRootLevelSystemGroupsInternalï¼‰</h3><p><strong>æ·»åŠ è‡³ World.m_Systems</strong></p><ul><li><p>1.åˆ›å»º<code>InitializationSystemGroup</code>ã€<code>SimulationSystemGroup</code>ã€<code>PresentationSystemGroup</code>è¿›è¡Œåˆ†ç±»ã€‚</p></li><li><p>2.è¿›è¡Œåˆ†ç±»ã€‚ç»§æ‰¿è‡ª<code>ComponentSystemBase</code>çš„åˆ†ä¸º<code>managedTypes</code>ç±»ï¼Œç»§æ‰¿è‡ª<code>ISystemBase</code>çš„åˆ†ä¸º<code>unmanagedTypes</code>ç±»ï¼Œ</p></li></ul><h4 id="ç»§æ‰¿è‡ªcomponentsystembaseçš„managedtypesç±»">ç»§æ‰¿è‡ª<code>ComponentSystemBase</code>çš„<code>managedTypes</code>ç±»ï¼Œ</h4><p><code>AddSystemToUpdateList</code></p><ul><li><p>1.åˆ›å»ºç±»å‹å¯¹è±¡ï¼Œæ·»åŠ è‡³<code>World.m_Systems</code>ã€‚å¹¶å°†<code>ComponentSystemBase</code> ä»¥ä¸‹çš„type å’Œsystemå¯¹è±¡æ·»åŠ è‡³<code>World.m_SystemLookup</code>ç¼“å­˜ã€‚</p></li><li><p>2.è°ƒç”¨<code>system.CreateInstance</code> ï¼Œ<strong>åˆ›å»º<code>SystemState</code>æˆå‘˜ã€‚</strong>ï¼Œ å¹¶è°ƒç”¨å‘¨æœŸå‡½æ•°OnBeforeCreateInternalã€OnCreateForCompilerã€OnCreate/OnBeforeDestroyInternalã€OnAfterDestroyInternal(å¼‚å¸¸æ—¶è°ƒç”¨).++Version.</p></li><li><p>3.å¾—åˆ°æ­£ç¡®æ·»åŠ çš„typesçš„System ã€‚</p></li><li><p>4.æ·»åŠ updateç³»ç»Ÿã€‚æ’é™¤ç›´æ¥ç­‰äº<code>InitializationSystemGroup</code>ã€<code>SimulationSystemGroup</code>ã€<code>PresentationSystemGroup</code>çš„ç±»å‹ã€‚(è¿™ä¸‰ä¸ªå¼€å§‹ç‹¬ç«‹æ·»åŠ äº†)ã€‚</p><ul><li>1.ä¸åŒ…å«UpdateInGroupAttributeå±æ€§çš„æ·»åŠ è‡³<code>simulationSystemGroup.AddSystemToUpdateList(system);</code></li><li>2.åŒ…å«UpdateInGroupAttributeå±æ€§çš„ï¼Œéå†<code>UpdateInGroupAttributeå±æ€§</code>ã€‚å±æ€§çš„Group å¿…é¡»ç»§æ‰¿è‡ª<code>ComponentSystemGroup</code>ï¼Œå¹¶ä¸”<code>OrderFirst</code>/<code>OrderLast</code>åªèƒ½é€‰ä¸€ä¸ªã€‚å¦‚æœgroupå­˜åœ¨ï¼Œæ·»åŠ è‡³groupã€‚<code>group.AddSystemToUpdateList(system)</code></li></ul></li></ul><h4 id="ç»§æ‰¿è‡ªisystembaseçš„unmanagedtypesç±»">ç»§æ‰¿è‡ª<code>ISystemBase</code>çš„<code>unmanagedTypes</code>ç±»ï¼Œ</h4><p><code>AddUnmanagedSystemToUpdateList</code></p><ul><li>1.è°ƒç”¨<code>world.CreateUnmanagedSystem(type);</code> åˆ›å»º</li><li>2.ä¸å«UpdateInGroupAttributeå±æ€§çš„æ·»åŠ è‡³<code>simulationSystemGroup.AddUnmanagedSystemToUpdateList(system);</code></li><li>3.ä¸å«UpdateInGroupAttributeå±æ€§.éå†<code>UpdateInGroupAttributeå±æ€§</code>ã€‚å±æ€§çš„Group å¿…é¡»ç»§æ‰¿è‡ª<code>ComponentSystemGroup</code>ï¼Œå¹¶ä¸”<code>OrderFirst</code>/<code>OrderLast</code>åªèƒ½é€‰ä¸€ä¸ªã€‚å¦‚æœgroupå­˜åœ¨ï¼Œæ·»åŠ è‡³groupã€‚<code>group.AddUnmanagedSystemToUpdateList(system)</code></li></ul><h3 id="update-player-loop">Update player loop</h3><pre><code>// Update player loopinitializationSystemGroup.SortSystems();simulationSystemGroup.SortSystems();presentationSystemGroup.SortSystems();</code></pre><h2 id="æ·»åŠ system-scriptbehaviourupdateorder.addworldtocurrentplayerloopworld">æ·»åŠ System(ScriptBehaviourUpdateOrder.AddWorldToCurrentPlayerLoop(world)ï¼‰</h2><p>æ·»åŠ è‡³å¼•æ“<code>PlayerLoopSystem</code> æ‰§è¡Œã€‚</p><ul><li>1.ä¸»è¦é€šè¿‡æ¡†æ¶çš„ <code>ScriptBehaviourUpdateOrder</code>è¾…åŠ©å‡½æ•°,å°†<code>InitializationSystemGroup</code>ã€<code>SimulationSystemGroup</code>ã€<code>PresentationSystemGroup</code>çš„ç±»å‹çš„Groupè¿›è¡Œ<code>Append</code>æ·»åŠ è‡³PlayerLoopSystem.å¯¹åº”çš„<code>UnityEngine.PlayerLoop.Initialization</code>ã€<code>UnityEngine.PlayerLoop.Update</code>ã€<code>UnityEngine.PlayerLoop.PreLateUpdate</code>ã€‚</li><li><ol start="2" type="1"><li><h3 id="scriptbehaviourupdateorder">ScriptBehaviourUpdateOrder</h3></li></ol></li></ul><pre><code>[AttributeUsage(AttributeTargets.Class|AttributeTargets.Struct)]public class UpdateInGroupAttribute : Attribute{    public bool OrderFirst = false;    public bool OrderLast = false;    public UpdateInGroupAttribute(Type groupType)    {        if (groupType == null)            throw new ArgumentNullException(nameof(groupType));        GroupType = groupType;    }    public Type GroupType { get; }}</code></pre><h3 id="æ·»åŠ è‡³playerloopsystemå¯¹åº”çš„delegateåŒ…è£…">æ·»åŠ è‡³PlayerLoopSystemå¯¹åº”çš„delegateåŒ…è£…</h3><pre><code> // FIXME: HACK! - mono 4.6 has problems invoking virtual methods as delegates from native, so wrap the invocation in a non-virtual classinternal class DummyDelegateWrapper{    internal ComponentSystemBase System =&gt; m_System;    private readonly ComponentSystemBase m_System;    public DummyDelegateWrapper(ComponentSystemBase sys)    {        m_System = sys;    }    public unsafe void TriggerUpdate()    {        if (m_System.m_StatePtr != null)        {            m_System.Update();        }    }}</code></pre><pre><code>[AttributeUsage(AttributeTargets.Class|AttributeTargets.Struct, AllowMultiple = true)]public class UpdateBeforeAttribute : Attribute{    public UpdateBeforeAttribute(Type systemType)    {        if (systemType == null)            throw new ArgumentNullException(nameof(systemType));        SystemType = systemType;    }    public Type SystemType { get; }}[AttributeUsage(AttributeTargets.Class|AttributeTargets.Struct)]    public class UpdateInGroupAttribute : Attribute    {        public bool OrderFirst = false;        public bool OrderLast = false;        public UpdateInGroupAttribute(Type groupType)        {            if (groupType == null)                throw new ArgumentNullException(nameof(groupType));            GroupType = groupType;        }        public Type GroupType { get; }    }</code></pre><h2 id="section"></h2>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/entities/0.entities-jie-gou/"/>
      <url>/2022/08/10/unity/entities/0.entities-jie-gou/</url>
      
        <content type="html"><![CDATA[<h1 id="entities-ç»“æ„">Entities ç»“æ„</h1><h2 id="playerloop">PlayerLoop</h2><p>å‘½åç©ºé—´:<code>UnityEngine.LowLevel</code>dll:UnityEngine.CoreModule.dll</p><h3 id="å¼•æ“é»˜è®¤playerloopsystem">å¼•æ“é»˜è®¤<code>PlayerLoopSystem</code>ï¼š</h3><ul><li>1.UnityEngine.PlayerLoop.TimeUpdate</li><li>2.UnityEngine.PlayerLoop.Initialization</li><li>3.UnityEngine.PlayerLoop.EarlyUpdate</li><li>4.UnityEngine.PlayerLoop.FixedUpdate</li><li>5.UnityEngine.PlayerLoop.PreUpdate</li><li>6.UnityEngine.PlayerLoop.Update</li><li>7.UnityEngine.PlayerLoop.PreLateUpdate</li><li>8.UnityEngine.PlayerLoop.PostLateUpdate</li></ul><h3 id="å¯¹æ¯”monobehaviouræ‰§è¡Œé¡ºåº"><strong>å¯¹æ¯”MonoBehaviouræ‰§è¡Œé¡ºåº</strong></h3><p>MonoBehaviour.Awake/OnEnable æ†ç»‘ç«‹å³æ‰§è¡Œã€‚</p><ul><li><p>1.UnityEngine.PlayerLoop.Initialization</p></li><li><p>2.UnityEngine.PlayerLoop.EarlyUpdate</p></li><li><p>a.MonoBehaviour.Start // æˆ–æ— </p></li><li><p>3.UnityEngine.PlayerLoop.FixedUpdate</p></li><li><p>b.MonoBehaviour.FixedUpdate // æˆ–æ— </p></li><li><p>4.UnityEngine.PlayerLoop.PreUpdate</p></li><li><p>5.UnityEngine.PlayerLoop.Update</p></li><li><p>c.MonoBehaviour.Update // æˆ–æ— </p></li><li><p>6.UnityEngine.PlayerLoop.PreLateUpdate</p></li><li><p>d.MonoBehaviour.PlayerLoop.LateUpdate// æˆ–æ— </p></li><li><p>7.UnityEngine.PlayerLoop.PostLateUpdate</p></li><li><p>8.UnityEngine.PlayerLoop.TimeUpdate</p></li></ul><p>å¯ä»¥çœ‹å‡ºå¯¹åº”çš„ç›¸åŒå‡½æ•°éƒ½ä¼˜å…ˆäºmonoçš„å¯¹åº”å‡½æ•°ã€‚å¸¸ç”¨çš„Systemç±»å‹ï¼šInitializationï¼ŒUpdateï¼ŒPreLateUpdate</p><h3 id="playerloopsystem-åŸå‹">PlayerLoopSystem åŸå‹ï¼š</h3><pre><code>namespace UnityEngine.LowLevel{    //    // æ‘˜è¦:    //     The representation of a single system being updated by the player loop in Unity.    [MovedFrom("UnityEngine.Experimental.LowLevel")]    public struct PlayerLoopSystem    {        public Type type;        public PlayerLoopSystem[] subSystemList;        public UpdateFunction updateDelegate;        public IntPtr updateFunction;        public IntPtr loopConditionFunction;        public override string ToString();        public delegate void UpdateFunction();    }}</code></pre><h3 id="playerloop-çš„ç®€å•æµ‹è¯•ä½¿ç”¨">PlayerLoop çš„ç®€å•æµ‹è¯•ä½¿ç”¨</h3><h4 id="ç›´æ¥æ³¨å†Œæ–¹æ³•">1.ç›´æ¥æ³¨å†Œæ–¹æ³•</h4><pre><code>internal class PlayerLoopSystemFunctionTest{     internal void UnityEngine_PlayerLoop_TimeUpdate(){        Debug.Log("UnityEngine_PlayerLoop_TimeUpdate  excuted" + ",Frame:"+Time.frameCount);    }    internal void UnityEngine_PlayerLoop_Initialization(){        Debug.Log("UnityEngine_PlayerLoop_Initialization  excuted" + ",Frame:"+Time.frameCount);    }    internal void UnityEngine_PlayerLoop_EarlyUpdate(){        Debug.Log("UnityEngine_PlayerLoop_EarlyUpdate  excuted" + ",Frame:"+Time.frameCount);    }    internal void UnityEngine_PlayerLoop_FixedUpdate(){        Debug.Log("UnityEngine_PlayerLoop_FixedUpdate  excuted" + ",Frame:"+Time.frameCount);    }    internal void UnityEngine_PlayerLoop_PreUpdate(){        Debug.Log("UnityEngine_PlayerLoop_PreUpdate  excuted" + ",Frame:"+Time.frameCount);    }    internal void UnityEngine_PlayerLoop_Update(){        Debug.Log("UnityEngine_PlayerLoop_Update  excuted" + ",Frame:"+Time.frameCount);    }    internal void UnityEngine_PlayerLoop_PreLateUpdate(){        Debug.Log("UnityEngine_PlayerLoop_PreLateUpdate  excuted" + ",Frame:"+Time.frameCount);    }        internal void UnityEngine_PlayerLoop_PostLateUpdate(){        Debug.Log("UnityEngine_PlayerLoop_PostLateUpdate  excuted" + ",Frame:"+Time.frameCount);    }}</code></pre><p>æ³¨å†Œæ·»åŠ ä»£ç </p><pre><code>PlayerLoopSystem rootPlayerLoopSystem = PlayerLoop.GetDefaultPlayerLoop();rootPlayerLoopSystem.subSystemList[0].updateDelegate = functionTest.UnityEngine_PlayerLoop_TimeUpdate;rootPlayerLoopSystem.subSystemList[1].updateDelegate = functionTest.UnityEngine_PlayerLoop_Initialization;rootPlayerLoopSystem.subSystemList[2].updateDelegate = functionTest.UnityEngine_PlayerLoop_EarlyUpdate;rootPlayerLoopSystem.subSystemList[3].updateDelegate = functionTest.UnityEngine_PlayerLoop_FixedUpdate;rootPlayerLoopSystem.subSystemList[4].updateDelegate = functionTest.UnityEngine_PlayerLoop_PreUpdate;rootPlayerLoopSystem.subSystemList[5].updateDelegate = functionTest.UnityEngine_PlayerLoop_Update;rootPlayerLoopSystem.subSystemList[6].updateDelegate = functionTest.UnityEngine_PlayerLoop_PreLateUpdate;rootPlayerLoopSystem.subSystemList[7].updateDelegate = functionTest.UnityEngine_PlayerLoop_PostLateUpdate;PlayerLoop.SetPlayerLoop(rootPlayerLoopSystem);</code></pre><h4 id="æ³¨å†Œubsystem">2.æ³¨å†ŒubSystem</h4><pre><code>// **rootPlayerLoopSystem çš„type ä¸ºnullã€‚**//playerLoopSystemType ä¸ºå¼•æ“é»˜è®¤`PlayerLoopSystem`çš„ç±»å‹ä¹‹ä¸€ã€‚static bool AppendSystemToPlayerLoopListImpl(ComponentSystemBase system, ref PlayerLoopSystem playerLoop,    Type playerLoopSystemType){    if (playerLoop.type == playerLoopSystemType)    {        var del = new DummyDelegateWrapper(system);        int oldListLength = (playerLoop.subSystemList != null) ? playerLoop.subSystemList.Length : 0;        var newSubsystemList = new PlayerLoopSystem[oldListLength + 1];        for (var i = 0; i &lt; oldListLength; ++i)            newSubsystemList[i] = playerLoop.subSystemList[i];        newSubsystemList[oldListLength].type = system.GetType();        newSubsystemList[oldListLength].updateDelegate = del.TriggerUpdate;        playerLoop.subSystemList = newSubsystemList;        return true;    }    if (playerLoop.subSystemList != null)    {        for(int i=0; i&lt;playerLoop.subSystemList.Length; ++i)        {            if (AppendSystemToPlayerLoopListImpl(system, ref playerLoop.subSystemList[i], playerLoopSystemType))                return true;        }    }    return false;}</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/engine/5.skinnedmesh-yuan-li/"/>
      <url>/2022/08/10/unity/engine/5.skinnedmesh-yuan-li/</url>
      
        <content type="html"><![CDATA[<h2 id="skinned-meshåŸç†è§£æ">Skinned MeshåŸç†è§£æ</h2><ol type="1"><li><a href="https://blog.csdn.net/gamemonkey/article/details/44058291">åŸç†è§£æ</a></li><li><a href="https://blog.csdn.net/tangcat123/article/details/72391645">åŸç†ä»¥åŠåº”ç”¨</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/engine/4.wang-ge-you-hua/"/>
      <url>/2022/08/10/unity/engine/4.wang-ge-you-hua/</url>
      
        <content type="html"><![CDATA[<h2 id="meshyä¼˜åŒ–">Meshyä¼˜åŒ–</h2><ol type="1"><li><a href="http://www.skywind.me/blog/topics/network">meshä¼˜åŒ–</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/engine/3.ecs/"/>
      <url>/2022/08/10/unity/engine/3.ecs/</url>
      
        <content type="html"><![CDATA[<h2 id="ecsç³»ç»Ÿ-ä¸å¸§åŒæ­¥">ECSç³»ç»Ÿ ä¸å¸§åŒæ­¥</h2><ol type="1"><li><a href="https://connect.unity.com/p/zhi-bo-hui-gu-shi-yong-unity-ecskai-fa-wo-de-shi-jie">untiyecs</a></li><li><a href="http://www.skywind.me/blog/archives/131">å¸§åŒæ­¥</a></li><li><a href="https://www.cnblogs.com/blueberryzzz/p/10957921.html">EntitasECS</a></li><li><a href="https://github.com/sschmid/Entitas-CSharp">EntitasECS</a></li><li><a href="https://blog.uwa4d.com/archives/USparkle_ECS1.html">ECSè®¾è®¡æ€æƒ³</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/engine/2.yu-dao-wen-ti-yi-ji-fang-an/"/>
      <url>/2022/08/10/unity/engine/2.yu-dao-wen-ti-yi-ji-fang-an/</url>
      
        <content type="html"><![CDATA[<h2 id="é‡åˆ°é—®é¢˜ä»¥åŠæ–¹æ¡ˆ">é‡åˆ°é—®é¢˜ä»¥åŠæ–¹æ¡ˆ</h2><ol type="1"><li><a href="https://answer.uwa4d.com/question/5a55838dd79fbe3a4aafc508">å˜å½¢</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/engine/1.yin-qing-xiang-guan/"/>
      <url>/2022/08/10/unity/engine/1.yin-qing-xiang-guan/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•æ“ç›¸å…³">å¼•æ“ç›¸å…³</h2><ol type="1"><li><a href="https://blog.csdn.net/cyf649669121/article/details/82117638">è¡€æ¡æ ¼å­çš„å¦ç±»åˆ¶ä½œæ–¹æ³•</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/engine/0.unity-qian-duan-ji-zhu/"/>
      <url>/2022/08/10/unity/engine/0.unity-qian-duan-ji-zhu/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><a href="http://www.luzexi.com/%E5%89%8D%E7%AB%AF%E6%8A%80%E6%9C%AF/index.html">ç›®å½•</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/csharp/3.stringbuilder/"/>
      <url>/2022/08/10/unity/csharp/3.stringbuilder/</url>
      
        <content type="html"><![CDATA[<h1 id="stringbuilderæµ‹è¯„">StringBuilderæµ‹è¯„</h1><h2 id="ä¸€ä¸»è¦æ¥å£">ä¸€ã€ä¸»è¦æ¥å£</h2><ul><li><ol type="1"><li>Append</li></ol><ul><li>è¿™ä¸ªæ¥å£, é™¤äº†å‚æ•°<code>stringç±»å‹</code> å’Œ <code>char[]</code>ç±»å‹éƒ½ä¼šè°ƒç”¨å‚æ•°çš„ <code>ToString</code></li><li><code>unsafe fixed</code> æ‹·è´ã€‚Buffer.Memcpy((byte<em>)dmem,(byte</em>)smem, charCount * 2); // 2 used everywhere instead ofsizeof(char)</li></ul></li><li><ol start="2" type="1"><li>AppendFormat å®ç°æ–¹å¼é€šè¿‡ format é€å­—èŠ‚è§£æ è¿›è¡ŒAppend,å‚æ•°é€šè¿‡å‚æ•°çš„IFormattableæ¥å£<code>ToString</code>ã€æˆ–è€…ç±»å‹çš„ToStringã€‚ æ‰€ä»¥é <code>stringç±»å‹</code> å’Œ<code>char[]</code>ç±»å‹éƒ½ä¼šè°ƒç”¨å‚æ•°çš„ <code>ToString</code>ã€‚</li></ol></li><li><ol start="3" type="1"><li>AppendLine ç­‰äº Append <code>"\r\n"</code>ã€‚</li></ol></li><li><ol start="4" type="1"><li>ToString <code>string.FastAllocateString(Length);</code><code>unsafe fixed</code> æ‹·è´ã€‚</li></ol></li><li><ol start="5" type="1"><li>Clear <code>~=</code> Length = 0</li></ol></li><li><ol start="6" type="1"><li>å…¶ä»–è¾…åŠ©æ–¹æ³• Insertã€Removeã€Replace</li></ol></li></ul><h2 id="äºŒ-valuetype-ç±»å‹çš„tostring">äºŒã€ ValueType ç±»å‹çš„ToString</h2><h3 id="tostring">ToString</h3><pre><code>1. (System.SByte)       æ— gc2. (System.Int16)       æ— gc3. (System.Int32)       æ— gc5. (System.Int64)       æ— gc6. (System.Single)          æœ‰gcã€ 28b7. (System.Double)          æœ‰gcã€ 56bã€ ä¸¤æ¬¡gc8. (System.Byte)        æ— gc 9. (System.UInt16)      æ— gc10. (System.UInt32)     æ— gc11. (System.UInt64)     æ— gc12. (System.Boolean)        æœ‰gcã€ é¦–æ¬¡70bï¼Œåé¢æ— gc14. (System.Decimal)        æœ‰gcã€ 76b15. (System.Enum)           æœ‰gcã€ é¦–æ¬¡gcå’Œenum åç§°å­—èŠ‚æ•°æœ‰å…³ã€‚åé¢å›ºå®š 20b16. (System.Char)           æœ‰gcã€ 28b</code></pre><p>ç±»å‹<code>IFormattable</code>çš„ToStringæ–¹æ³•é»˜è®¤ç­‰åŒäºç±»å‹çš„ToStringï¼Œé™¤éè®¾ç½®IFormatProvider <code>char</code>ã€<code>Boolean</code>æ²¡æœ‰IFormattableæ¥å£</p><h2 id="ä¸‰æ€»ç»“">ä¸‰ã€æ€»ç»“</h2><ul><li><ol type="1"><li>æ— è®ºæ˜¯StringBuilderçš„Appendï¼Œè¿˜æ˜¯StringBuilderçš„AppendFormatï¼Œå‚æ•°ç±»å‹ä¸º<code>String</code> å’Œ <code>char[]</code>ï¼Œåˆ™æ— gc</li></ol></li><li><ol start="2" type="1"><li>å€¼ç±»å‹ ä½¿ç”¨StringBuilder æ˜¯å¦æœ‰gcä¾æ® ç±»å‹ToString()</li></ol></li><li><ol start="3" type="1"><li>æµ®ç‚¹å‹çš„gcï¼Œä¸»è¦æ¥è‡ªå†…å­˜å‚¨å­˜æ–¹å¼ã€‚</li></ol></li><li>Int32.ToString</li></ul><pre><code>    [SecuritySafeCritical]    public string ToString()    {        return Number.FormatInt32(this, null, NumberFormatInfo.CurrentInfo);    }        public static NumberFormatInfo CurrentInfo        {            get            {                CultureInfo currentCulture = Thread.CurrentThread.CurrentCulture;                if (!currentCulture.m_isInherited)                {                    NumberFormatInfo numInfo = currentCulture.numInfo;                    if (numInfo != null)                    {                        return numInfo;                    }                }                return (NumberFormatInfo)currentCulture.GetFormat(typeof(NumberFormatInfo));            }        }        // Token: 0x060011BA RID: 4538 RVA: 0x00048649 File Offset: 0x00046849        public static string FormatInt32(int value, string format, NumberFormatInfo info)        {            return NumberFormatter.NumberToString(format, value, info);        }                public static string NumberToString(string format, int value, IFormatProvider fp)                {                    NumberFormatter instance = NumberFormatter.GetInstance(fp);                    instance.Init(format, value, 10);                    string result = instance.IntegerToString(format, fp);                    instance.Release();                    return result;                }                    // Token: 0x06001A02 RID: 6658 RVA: 0x00060C24 File Offset: 0x0005EE24                    private void Init(string format, int value, int defPrecision)                    {                        this.Init(format);                        this._defPrecision = defPrecision;                        this._positive = (value &gt;= 0);                        if (value == 0 || this._specifier == 'X')                        {                            this.InitHex((ulong)((long)value));                            return;                        }                        if (value &lt; 0)                        {                            value = -value;                        }                        this.InitDecHexDigits((uint)value);                        this._decPointPos = (this._digitsLen = this.DecHexLen());                    }                    case 'G':                    if (this._precision &lt;= 0)                    {                        return this.FormatDecimal(-1, numberFormatInstance);                    }                    return this.FormatGeneral(this._precision, numberFormatInstance);</code></pre><h2 id="åŒºåˆ†ç¬¦">åŒºåˆ†ç¬¦</h2><ol type="1"><li>format == null|| format.Length == 0 <code>G</code></li><li>format é¦–å­—ç¬¦å°å†™ Upper =false <code>é¦–å­—ç¬¦ - Â·aÂ· + Â·AÂ·</code></li><li>format é¦–å­—ç¬¦å¤§å†™ <code>0</code></li></ol><p><a href="https://referencesource.microsoft.com/#mscorlib/system/text/stringbuilder.cs,e8eaef3c361184bc">StringBuilderæºç å‚è€ƒ</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/csharp/2.tong-bu-ji-yuan/"/>
      <url>/2022/08/10/unity/csharp/2.tong-bu-ji-yuan/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><a href="https://www.cnblogs.com/zgq0/p/8780893.html">donetåŒæ­¥åŸºå…ƒ</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/csharp/1.wu-gc-zi-fu-chuan-pin-jie/"/>
      <url>/2022/08/10/unity/csharp/1.wu-gc-zi-fu-chuan-pin-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="æ— gcå­—ç¬¦ä¸²æ‹¼æ¥">æ— GCå­—ç¬¦ä¸²æ‹¼æ¥</h2><p><a href="https://www.xuanyusong.com/archives/4601">https://www.xuanyusong.com/archives/4601</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/unity/android/1.unity-bian-yi-dao-android-yuan-li/"/>
      <url>/2022/08/10/unity/android/1.unity-bian-yi-dao-android-yuan-li/</url>
      
        <content type="html"><![CDATA[<h2 id="unityç¼–è¯‘åˆ°android">Unityç¼–è¯‘åˆ°Android</h2><ol type="1"><li><a href="https://cloud.tencent.com/developer/article/1004543">å¯åŠ¨æµç¨‹</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/python/3.qi-ta/"/>
      <url>/2022/08/10/python/3.qi-ta/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><a href="https://blog.csdn.net/weixin_42124234/article/details/92799133?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.add_param_isCf&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.add_param_isCf">pipæ”¹ä¸ºå›½å†…é•œåƒ</a></li><li></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/python/2.ji-qi-xue-xi/"/>
      <url>/2022/08/10/python/2.ji-qi-xue-xi/</url>
      
        <content type="html"><![CDATA[<h2 id="æœºå™¨å­¦ä¹ ">æœºå™¨å­¦ä¹ </h2><ol type="1"><li><a href="https://cuijiahua.com/blog/ml/">æœºå™¨å­¦ä¹ æ•™ç¨‹</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/python/1.cha-jian/"/>
      <url>/2022/08/10/python/1.cha-jian/</url>
      
        <content type="html"><![CDATA[<h2 id="æ’ä»¶">æ’ä»¶</h2><ol type="1"><li>pysvn</li><li><a href="https://matplotlib.org/">Matplotlib</a></li><li><a href="https://blog.csdn.net/u014070279/article/details/53292366">å›¾åƒå˜ç´ æ</a></li><li><a href="https://scikit-image.org/docs">scikit-image</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/05pbr/01.pbr-jie-shao/"/>
      <url>/2022/08/10/opengl/05pbr/01.pbr-jie-shao/</url>
      
        <content type="html"><![CDATA[<h1 id="pbrä»‹ç»">PBRä»‹ç»</h1><h2 id="ä»‹ç»">ä»‹ç»</h2><blockquote><p>PBRï¼Œæˆ–è€…ç”¨æ›´é€šä¿—ä¸€äº›çš„ç§°å‘¼æ˜¯æŒ‡åŸºäºç‰©ç†çš„æ¸²æŸ“(Physically BasedRendering)ï¼Œå®ƒæŒ‡çš„æ˜¯ä¸€äº›åœ¨ä¸åŒç¨‹åº¦ä¸Šéƒ½åŸºäºä¸ç°å®ä¸–ç•Œçš„ç‰©ç†åŸç†æ›´ç›¸ç¬¦çš„åŸºæœ¬ç†è®ºæ‰€æ„æˆçš„æ¸²æŸ“æŠ€æœ¯çš„é›†åˆã€‚</p></blockquote><ul><li>åˆ¤æ–­ä¸€ç§PBRå…‰ç…§æ¨¡å‹æ˜¯å¦æ˜¯åŸºäºç‰©ç†çš„ï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼ˆä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬å¾ˆå¿«å°±ä¼šäº†è§£å®ƒä»¬çš„ï¼‰ï¼š<ol type="1"><li>åŸºäºå¾®å¹³é¢(Microfacet)çš„è¡¨é¢æ¨¡å‹ã€‚</li><li>èƒ½é‡å®ˆæ’</li><li>åº”ç”¨åŸºäºç‰©ç†çš„BRDFã€‚</li></ol></li></ul><h2 id="å¾®å¹³é¢æ¨¡å‹">å¾®å¹³é¢æ¨¡å‹</h2><p>æ‰€æœ‰çš„PBRæŠ€æœ¯éƒ½åŸºäºå¾®å¹³é¢ç†è®ºã€‚è¿™é¡¹ç†è®ºè®¤ä¸ºï¼Œè¾¾åˆ°å¾®è§‚å°ºåº¦ä¹‹åä»»ä½•å¹³é¢éƒ½å¯ä»¥ç”¨è¢«ç§°ä¸ºå¾®å¹³é¢(Microfacets)çš„ç»†å°é•œé¢æ¥è¿›è¡Œæç»˜ã€‚æ ¹æ®å¹³é¢ç²—ç³™ç¨‹åº¦çš„ä¸åŒï¼Œè¿™äº›ç»†å°é•œé¢çš„å–å‘æ’åˆ—å¯ä»¥ç›¸å½“ä¸ä¸€è‡´ã€‚</p><p>äº§ç”Ÿçš„æ•ˆæœå°±æ˜¯ï¼šä¸€ä¸ªå¹³é¢è¶Šæ˜¯ç²—ç³™ï¼Œè¿™ä¸ªå¹³é¢ä¸Šçš„å¾®å¹³é¢çš„æ’åˆ—å°±è¶Šæ··ä¹±ã€‚è¿™äº›å¾®å°é•œé¢è¿™æ ·æ— åºå–å‘æ’åˆ—çš„å½±å“å°±æ˜¯ï¼Œå½“æˆ‘ä»¬ç‰¹æŒ‡é•œé¢å…‰/é•œé¢åå°„æ—¶ï¼Œå…¥å°„å…‰çº¿æ›´è¶‹å‘äºå‘å®Œå…¨ä¸åŒçš„æ–¹å‘å‘æ•£(Scatter)å¼€æ¥ï¼Œè¿›è€Œäº§ç”Ÿå‡ºåˆ†å¸ƒèŒƒå›´æ›´å¹¿æ³›çš„é•œé¢åå°„ã€‚è€Œä¸ä¹‹ç›¸åçš„æ˜¯ï¼Œå¯¹äºä¸€ä¸ªå…‰æ»‘çš„å¹³é¢ï¼Œå…‰çº¿å¤§ä½“ä¸Šä¼šæ›´è¶‹å‘äºå‘åŒä¸€ä¸ªæ–¹å‘åå°„ï¼Œé€ æˆæ›´å°æ›´é”åˆ©çš„åå°„ã€‚å¾®å¹³é¢çš„å–å‘æ–¹å‘ä¸ä¸­é—´å‘é‡çš„æ–¹å‘è¶Šæ˜¯ä¸€è‡´ï¼Œé•œé¢åå°„çš„æ•ˆæœå°±è¶Šæ˜¯å¼ºçƒˆè¶Šæ˜¯é”åˆ©ã€‚ç„¶åå†åŠ ä¸Šä¸€ä¸ªä»‹äº0åˆ°1ä¹‹é—´çš„ç²—ç³™åº¦å‚æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½æ¦‚ç•¥çš„ä¼°ç®—å¾®å¹³é¢çš„å–å‘æƒ…å†µäº†ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¾ƒé«˜çš„ç²—ç³™åº¦å€¼æ˜¾ç¤ºå‡ºæ¥çš„é•œé¢åå°„çš„è½®å»“è¦æ›´å¤§ä¸€äº›ã€‚ä¸ä¹‹ç›¸ååœ°ï¼Œè¾ƒå°çš„ç²—ç³™å€¼æ˜¾ç¤ºå‡ºçš„é•œé¢åå°„è½®å»“åˆ™æ›´å°æ›´é”åˆ©ã€‚</p><h2 id="èƒ½é‡å®ˆæ’">èƒ½é‡å®ˆæ’</h2><p>å¾®å¹³é¢è¿‘ä¼¼æ³•ä½¿ç”¨äº†è¿™æ ·ä¸€ç§å½¢å¼çš„èƒ½é‡å®ˆæ’(EnergyConservation)ï¼šå‡ºå°„å…‰çº¿çš„èƒ½é‡æ°¸è¿œä¸èƒ½è¶…è¿‡å…¥å°„å…‰çº¿çš„èƒ½é‡ï¼ˆå‘å…‰é¢é™¤å¤–ï¼‰ã€‚ä¸ºäº†éµå®ˆèƒ½é‡å®ˆæ’å®šå¾‹ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¼«åå°„å…‰å’Œé•œé¢åå°„å…‰ä¹‹é—´åšå‡ºæ˜ç¡®çš„åŒºåˆ†ã€‚å½“ä¸€æŸå…‰çº¿ç¢°æ’åˆ°ä¸€ä¸ªè¡¨é¢çš„æ—¶å€™ï¼Œå®ƒå°±ä¼šåˆ†ç¦»æˆä¸€ä¸ªæŠ˜å°„éƒ¨åˆ†å’Œä¸€ä¸ªåå°„éƒ¨åˆ†ã€‚åå°„éƒ¨åˆ†å°±æ˜¯ä¼šç›´æ¥åå°„å¼€æ¥è€Œä¸ä¼šè¿›å…¥å¹³é¢çš„é‚£éƒ¨åˆ†å…‰çº¿ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„é•œé¢å…‰ç…§ã€‚è€ŒæŠ˜å°„éƒ¨åˆ†å°±æ˜¯ä½™ä¸‹çš„ä¼šè¿›å…¥è¡¨é¢å¹¶è¢«å¸æ”¶çš„é‚£éƒ¨åˆ†å…‰çº¿ï¼Œè¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æ¼«åå°„å…‰ç…§ã€‚è¿™é‡Œè¿˜æœ‰ä¸€äº›ç»†èŠ‚éœ€è¦å¤„ç†ï¼Œå› ä¸ºå½“å…‰çº¿æ¥è§¦åˆ°ä¸€ä¸ªè¡¨é¢çš„æ—¶å€™æŠ˜å°„å…‰æ˜¯ä¸ä¼šç«‹å³å°±è¢«å¸æ”¶çš„ã€‚é€šè¿‡ç‰©ç†å­¦æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œå…‰çº¿å®é™…ä¸Šå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€æŸæ²¡æœ‰è€—å°½å°±ä¸åœå‘å‰è¿åŠ¨çš„èƒ½é‡ï¼Œè€Œå…‰æŸæ˜¯é€šè¿‡ç¢°æ’çš„æ–¹å¼æ¥æ¶ˆè€—èƒ½é‡ã€‚æ¯ä¸€ç§ææ–™éƒ½æ˜¯ç”±æ— æ•°å¾®å°çš„ç²’å­æ‰€ç»„æˆï¼Œè¿™äº›ç²’å­éƒ½èƒ½å¦‚ä¸‹å›¾æ‰€ç¤ºä¸€æ ·ä¸å…‰çº¿å‘ç”Ÿç¢°æ’ã€‚è¿™äº›ç²’å­åœ¨æ¯æ¬¡çš„ç¢°æ’ä¸­éƒ½å¯ä»¥å¸æ”¶å…‰çº¿æ‰€æºå¸¦çš„ä¸€éƒ¨åˆ†æˆ–è€…æ˜¯å…¨éƒ¨çš„èƒ½é‡è€Œåè½¬å˜æˆä¸ºçƒ­é‡ã€‚</p><p>æˆ‘ä»¬æŒ‰ç…§èƒ½é‡å®ˆæ’çš„å…³ç³»ï¼Œé¦–å…ˆè®¡ç®—é•œé¢åå°„éƒ¨åˆ†ï¼Œå®ƒçš„å€¼ç­‰äºå…¥å°„å…‰çº¿è¢«åå°„çš„èƒ½é‡æ‰€å çš„ç™¾åˆ†æ¯”ã€‚ç„¶åæŠ˜å°„å…‰éƒ¨åˆ†å°±å¯ä»¥ç›´æ¥ç”±é•œé¢åå°„éƒ¨åˆ†è®¡ç®—å¾—å‡ºï¼š</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> kS <span class="op">=</span> calculateSpecularComponent<span class="op">(...);</span> <span class="co">// åå°„/é•œé¢ éƒ¨åˆ†</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> kD <span class="op">=</span> <span class="fl">1.0</span> <span class="op">-</span> ks<span class="op">;</span>                        <span class="co">// æŠ˜å°„/æ¼«åå°„ éƒ¨åˆ†</span></span></code></pre></div><h2 id="åå°„ç‡æ–¹ç¨‹">åå°„ç‡æ–¹ç¨‹</h2><p>åœ¨è¿™é‡Œæˆ‘ä»¬å¼•å…¥äº†ä¸€ç§è¢«ç§°ä¸ºæ¸²æŸ“æ–¹ç¨‹(RenderEquation)çš„ä¸œè¥¿ã€‚å®ƒæ˜¯æŸäº›èªæ˜ç»é¡¶äººæ‰€æ„æƒ³å‡ºæ¥çš„ä¸€ä¸ªç²¾å¦™çš„æ–¹ç¨‹å¼ï¼Œæ˜¯å¦‚ä»Šæˆ‘ä»¬æ‰€æ‹¥æœ‰çš„ç”¨æ¥æ¨¡æ‹Ÿå…‰çš„è§†è§‰æ•ˆæœæœ€å¥½çš„æ¨¡å‹ã€‚åŸºäºç‰©ç†çš„æ¸²æŸ“æ‰€åšå®šçš„éµå¾ªçš„æ˜¯ä¸€ç§è¢«ç§°ä¸ºåå°„ç‡æ–¹ç¨‹(TheReflectance Equation)çš„æ¸²æŸ“æ–¹ç¨‹çš„<code>ç‰¹åŒ–ç‰ˆæœ¬</code>ã€‚è¦æ­£ç¡®çš„ç†è§£PBRå¾ˆé‡è¦çš„ä¸€ç‚¹å°±æ˜¯è¦é¦–å…ˆé€å½»çš„ç†è§£åå°„ç‡æ–¹ç¨‹ï¼š <span class="math display">\[L_{0}(p, w_{0}) = \int_{\Omega}{f_r(p, w_i, w_0)L_i(p,w_i)n*w_{i}dw_{i}}  , d ä»£è¡¨åˆ°å…‰æºè·ç¦»ï¼ŒK_cã€K_lã€K_q å¯æŸ¥è¡¨ã€‚\]</span></p><p><strong>//TODO</strong></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/04-gao-ji-opengl/11.kang-ju-chi/"/>
      <url>/2022/08/10/opengl/04-gao-ji-opengl/11.kang-ju-chi/</url>
      
        <content type="html"><![CDATA[<h1 id="æŠ—é”¯é½¿">æŠ—é”¯é½¿</h1><blockquote><p>å¯¹å½¢æˆè¾¹ç¼˜çš„åƒç´ ã€‚è¿™ç§ç°è±¡è¢«ç§°ä¹‹ä¸ºèµ°æ ·(Aliasing)ã€‚æœ‰å¾ˆå¤šç§æŠ—é”¯é½¿ï¼ˆAnti-aliasingï¼Œä¹Ÿè¢«ç§°ä¸ºåèµ°æ ·ï¼‰çš„æŠ€æœ¯èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ç¼“è§£è¿™ç§ç°è±¡ï¼Œä»è€Œäº§ç”Ÿæ›´å¹³æ»‘çš„è¾¹ç¼˜ã€‚</p></blockquote><blockquote><p>æœ€å¼€å§‹æˆ‘ä»¬æœ‰ä¸€ç§å«åš<code>è¶…é‡‡æ ·æŠ—é”¯é½¿(Super Sample Anti-aliasing, SSAA)</code>çš„æŠ€æœ¯ï¼Œå®ƒä¼šä½¿ç”¨æ¯”æ­£å¸¸åˆ†è¾¨ç‡æ›´é«˜çš„åˆ†è¾¨ç‡ï¼ˆå³è¶…é‡‡æ ·ï¼‰æ¥æ¸²æŸ“åœºæ™¯ï¼Œå½“å›¾åƒè¾“å‡ºåœ¨å¸§ç¼“å†²ä¸­æ›´æ–°æ—¶ï¼Œåˆ†è¾¨ç‡ä¼šè¢«ä¸‹é‡‡æ ·(Downsample)è‡³æ­£å¸¸çš„åˆ†è¾¨ç‡ã€‚è¿™äº›é¢å¤–çš„åˆ†è¾¨ç‡ä¼šè¢«ç”¨æ¥é˜²æ­¢é”¯é½¿è¾¹ç¼˜çš„äº§ç”Ÿã€‚è™½ç„¶å®ƒç¡®å®èƒ½å¤Ÿè§£å†³èµ°æ ·çš„é—®é¢˜ï¼Œä½†æ˜¯ç”±äºè¿™æ ·æ¯”å¹³æ—¶è¦ç»˜åˆ¶æ›´å¤šçš„ç‰‡æ®µï¼Œå®ƒä¹Ÿä¼šå¸¦æ¥å¾ˆå¤§çš„æ€§èƒ½å¼€é”€ã€‚æ‰€ä»¥è¿™é¡¹æŠ€æœ¯åªæ‹¥æœ‰äº†çŸ­æš‚çš„è¾‰ç…Œã€‚</p></blockquote><blockquote><p>ç„¶è€Œï¼Œåœ¨è¿™é¡¹æŠ€æœ¯çš„åŸºç¡€ä¸Šä¹Ÿè¯ç”Ÿäº†æ›´ä¸ºç°ä»£çš„æŠ€æœ¯ï¼Œå«åš<code>å¤šé‡é‡‡æ ·æŠ—é”¯é½¿(Multisample Anti-aliasing, MSAA)</code>ã€‚å®ƒå€Ÿé‰´äº†SSAAèƒŒåçš„ç†å¿µï¼Œä½†å´ä»¥æ›´åŠ é«˜æ•ˆçš„æ–¹å¼å®ç°äº†æŠ—é”¯é½¿ã€‚</p></blockquote><h2 id="å¤šé‡é‡‡æ ·-msaa">å¤šé‡é‡‡æ · MSAA</h2><h3 id="å…‰æ …å™¨">å…‰æ …å™¨</h3><p>å…‰æ …å™¨æ˜¯ä½äºæœ€ç»ˆå¤„ç†è¿‡çš„é¡¶ç‚¹ä¹‹ååˆ°ç‰‡æ®µç€è‰²å™¨ä¹‹å‰æ‰€ç»è¿‡çš„æ‰€æœ‰çš„ç®—æ³•ä¸è¿‡ç¨‹çš„æ€»å’Œã€‚å…‰æ …å™¨ä¼šå°†ä¸€ä¸ªå›¾å…ƒçš„æ‰€æœ‰é¡¶ç‚¹ä½œä¸ºè¾“å…¥ï¼Œå¹¶å°†å®ƒè½¬æ¢ä¸ºä¸€ç³»åˆ—çš„ç‰‡æ®µã€‚é¡¶ç‚¹åæ ‡ç†è®ºä¸Šå¯ä»¥å–ä»»æ„å€¼ï¼Œä½†ç‰‡æ®µä¸è¡Œï¼Œå› ä¸ºå®ƒä»¬å—é™äºä½ çª—å£çš„åˆ†è¾¨ç‡ã€‚é¡¶ç‚¹åæ ‡ä¸ç‰‡æ®µä¹‹é—´å‡ ä¹æ°¸è¿œä¹Ÿä¸ä¼šæœ‰ä¸€å¯¹ä¸€çš„æ˜ å°„ï¼Œæ‰€ä»¥å…‰æ …å™¨å¿…é¡»ä»¥æŸç§æ–¹å¼æ¥å†³å®šæ¯ä¸ªé¡¶ç‚¹æœ€ç»ˆæ‰€åœ¨çš„ç‰‡æ®µ/å±å¹•åæ ‡ã€‚</p><p>æ¯ä¸ªåƒç´ çš„ä¸­å¿ƒåŒ…å«æœ‰ä¸€ä¸ªé‡‡æ ·ç‚¹(SamplePoint)ï¼Œå®ƒä¼šè¢«ç”¨æ¥å†³å®šè¿™ä¸ªä¸‰è§’å½¢æ˜¯å¦é®ç›–äº†æŸä¸ªåƒç´ ã€‚å›¾ä¸­çº¢è‰²çš„é‡‡æ ·ç‚¹è¢«ä¸‰è§’å½¢æ‰€é®ç›–ï¼Œåœ¨æ¯ä¸€ä¸ªé®ä½çš„åƒç´ å¤„éƒ½ä¼šç”Ÿæˆä¸€ä¸ªç‰‡æ®µã€‚è™½ç„¶ä¸‰è§’å½¢è¾¹ç¼˜çš„ä¸€äº›éƒ¨åˆ†ä¹Ÿé®ä½äº†æŸäº›å±å¹•åƒç´ ï¼Œä½†æ˜¯è¿™äº›åƒç´ çš„é‡‡æ ·ç‚¹å¹¶æ²¡æœ‰è¢«ä¸‰è§’å½¢å†…éƒ¨æ‰€é®ç›–ï¼Œæ‰€ä»¥å®ƒä»¬ä¸ä¼šå—åˆ°ç‰‡æ®µç€è‰²å™¨çš„å½±å“ã€‚</p><p>ç”±äºå±å¹•åƒç´ æ€»é‡çš„é™åˆ¶ï¼Œæœ‰äº›è¾¹ç¼˜çš„åƒç´ èƒ½å¤Ÿè¢«æ¸²æŸ“å‡ºæ¥ï¼Œè€Œæœ‰äº›åˆ™ä¸ä¼šã€‚ç»“æœå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨äº†ä¸å…‰æ»‘çš„è¾¹ç¼˜æ¥æ¸²æŸ“å›¾å…ƒï¼Œå¯¼è‡´ä¹‹å‰è®¨è®ºåˆ°çš„é”¯é½¿è¾¹ç¼˜ã€‚</p><h3 id="å¤šé‡é‡‡æ ·">å¤šé‡é‡‡æ ·</h3><p>å¤šé‡é‡‡æ ·æ‰€åšçš„æ­£æ˜¯å°†å•ä¸€çš„é‡‡æ ·ç‚¹å˜ä¸ºå¤šä¸ªé‡‡æ ·ç‚¹ï¼ˆè¿™ä¹Ÿæ˜¯å®ƒåç§°çš„ç”±æ¥ï¼‰ã€‚æˆ‘ä»¬ä¸å†ä½¿ç”¨åƒç´ ä¸­å¿ƒçš„å•ä¸€é‡‡æ ·ç‚¹ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä»¥ç‰¹å®šå›¾æ¡ˆæ’åˆ—çš„4ä¸ªå­é‡‡æ ·ç‚¹(Subsample)ã€‚æˆ‘ä»¬å°†ç”¨è¿™äº›å­é‡‡æ ·ç‚¹æ¥å†³å®šåƒç´ çš„é®ç›–åº¦ã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€é¢œè‰²ç¼“å†²çš„å¤§å°ä¼šéšç€å­é‡‡æ ·ç‚¹çš„å¢åŠ è€Œå¢åŠ ã€‚<code>é‡‡æ ·ç‚¹çš„æ•°é‡å¯ä»¥æ˜¯ä»»æ„çš„ï¼Œæ›´å¤šçš„é‡‡æ ·ç‚¹èƒ½å¸¦æ¥æ›´ç²¾ç¡®çš„é®ç›–ç‡ã€‚</code></p><p>MSAAçœŸæ­£çš„å·¥ä½œæ–¹å¼æ˜¯ï¼Œæ— è®ºä¸‰è§’å½¢é®ç›–äº†å¤šå°‘ä¸ªå­é‡‡æ ·ç‚¹ï¼Œï¼ˆæ¯ä¸ªå›¾å…ƒä¸­ï¼‰æ¯ä¸ªåƒç´ åªè¿è¡Œä¸€æ¬¡ç‰‡æ®µç€è‰²å™¨ã€‚ç‰‡æ®µç€è‰²å™¨æ‰€ä½¿ç”¨çš„é¡¶ç‚¹æ•°æ®ä¼šæ’å€¼åˆ°æ¯ä¸ªåƒç´ çš„ä¸­å¿ƒï¼Œæ‰€å¾—åˆ°çš„ç»“æœé¢œè‰²ä¼šè¢«å‚¨å­˜åœ¨æ¯ä¸ªè¢«é®ç›–ä½çš„å­é‡‡æ ·ç‚¹ä¸­ã€‚å½“é¢œè‰²ç¼“å†²çš„å­æ ·æœ¬è¢«å›¾å…ƒçš„æ‰€æœ‰é¢œè‰²å¡«æ»¡æ—¶ï¼Œæ‰€æœ‰çš„è¿™äº›é¢œè‰²å°†ä¼šåœ¨æ¯ä¸ªåƒç´ å†…éƒ¨å¹³å‡åŒ–ã€‚å› ä¸ºä¸Šå›¾çš„4ä¸ªé‡‡æ ·ç‚¹ä¸­åªæœ‰2ä¸ªè¢«é®ç›–ä½äº†ï¼Œè¿™ä¸ªåƒç´ çš„é¢œè‰²å°†ä¼šæ˜¯ä¸‰è§’å½¢é¢œè‰²ä¸å…¶ä»–ä¸¤ä¸ªé‡‡æ ·ç‚¹çš„é¢œè‰²ï¼ˆåœ¨è¿™é‡Œæ˜¯æ— è‰²ï¼‰çš„å¹³å‡å€¼ï¼Œæœ€ç»ˆå½¢æˆä¸€ç§æ·¡è“è‰²ã€‚</p><h2 id="opengl-ä¸­çš„msaa">OpenGL ä¸­çš„MSAA</h2><p>æˆ‘ä»¬æƒ³è¦åœ¨OpenGLä¸­ä½¿ç”¨MSAAï¼Œæˆ‘ä»¬å¿…é¡»è¦ä½¿ç”¨ä¸€ä¸ªèƒ½åœ¨æ¯ä¸ªåƒç´ ä¸­å­˜å‚¨å¤§äº1ä¸ªé¢œè‰²å€¼çš„é¢œè‰²ç¼“å†²ï¼ˆå› ä¸ºå¤šé‡é‡‡æ ·éœ€è¦æˆ‘ä»¬ä¸ºæ¯ä¸ªé‡‡æ ·ç‚¹éƒ½å‚¨å­˜ä¸€ä¸ªé¢œè‰²ï¼‰ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„ç¼“å†²ç±»å‹ï¼Œæ¥å­˜å‚¨ç‰¹å®šæ•°é‡çš„å¤šé‡é‡‡æ ·æ ·æœ¬ï¼Œå®ƒå«åšå¤šé‡é‡‡æ ·ç¼“å†²(MultisampleBuffer)ã€‚</p><p>å¤§å¤šæ•°çš„çª—å£ç³»ç»Ÿéƒ½åº”è¯¥æä¾›äº†ä¸€ä¸ªå¤šé‡é‡‡æ ·ç¼“å†²ï¼Œç”¨ä»¥ä»£æ›¿é»˜è®¤çš„é¢œè‰²ç¼“å†²ã€‚GLFWåŒæ ·ç»™äº†æˆ‘ä»¬è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„åªæ˜¯æç¤º(Hint)GLFWï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ä¸€ä¸ªåŒ…å«Nä¸ªæ ·æœ¬çš„å¤šé‡é‡‡æ ·ç¼“å†²ã€‚è¿™å¯ä»¥åœ¨åˆ›å»ºçª—å£ä¹‹å‰è°ƒç”¨glfwWindowHintæ¥å®Œæˆã€‚</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_SAMPLES<span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span></code></pre></div><p>ç°åœ¨å†è°ƒç”¨glfwCreateWindowåˆ›å»ºæ¸²æŸ“çª—å£æ—¶ï¼Œæ¯ä¸ªå±å¹•åæ ‡å°±ä¼šä½¿ç”¨ä¸€ä¸ªåŒ…å«4ä¸ªå­é‡‡æ ·ç‚¹çš„é¢œè‰²ç¼“å†²äº†ã€‚GLFWä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ¯åƒç´ 4ä¸ªå­é‡‡æ ·ç‚¹çš„æ·±åº¦å’Œæ ·æœ¬ç¼“å†²ã€‚è¿™ä¹Ÿæ„å‘³ç€æ‰€æœ‰ç¼“å†²çš„å¤§å°éƒ½å¢é•¿äº†4å€ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å·²ç»å‘GLFWè¯·æ±‚äº†å¤šé‡é‡‡æ ·ç¼“å†²ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è°ƒç”¨glEnableå¹¶å¯ç”¨GL_MULTISAMPLEï¼Œæ¥å¯ç”¨å¤šé‡é‡‡æ ·ã€‚åœ¨å¤§å¤šæ•°OpenGLçš„é©±åŠ¨ä¸Šï¼Œå¤šé‡é‡‡æ ·éƒ½æ˜¯é»˜è®¤å¯ç”¨çš„ï¼Œæ‰€ä»¥è¿™ä¸ªè°ƒç”¨å¯èƒ½ä¼šæœ‰ç‚¹å¤šä½™ï¼Œä½†æ˜¾å¼åœ°è°ƒç”¨ä¸€ä¸‹ä¼šæ›´ä¿é™©ä¸€ç‚¹ã€‚è¿™æ ·å­ä¸è®ºæ˜¯ä»€ä¹ˆOpenGLçš„å®ç°éƒ½èƒ½å¤Ÿæ­£å¸¸å¯ç”¨å¤šé‡é‡‡æ ·äº†ã€‚</p><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    glEnable<span class="op">(</span>GL_MULTISAMPLE<span class="op">);</span></span></code></pre></div><p>åªè¦é»˜è®¤çš„å¸§ç¼“å†²æœ‰äº†å¤šé‡é‡‡æ ·ç¼“å†²çš„é™„ä»¶ï¼Œæˆ‘ä»¬æ‰€è¦åšçš„åªæ˜¯è°ƒç”¨glEnableæ¥å¯ç”¨å¤šé‡é‡‡æ ·ã€‚å› ä¸ºå¤šé‡é‡‡æ ·çš„ç®—æ³•éƒ½åœ¨OpenGLé©±åŠ¨çš„å…‰æ …å™¨ä¸­å®ç°äº†ï¼Œæˆ‘ä»¬ä¸éœ€è¦å†å¤šåšä»€ä¹ˆã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/04-gao-ji-opengl/10.shi-li-hua/"/>
      <url>/2022/08/10/opengl/04-gao-ji-opengl/10.shi-li-hua/</url>
      
        <content type="html"><![CDATA[<h1 id="å®ä¾‹åŒ–">å®ä¾‹åŒ–</h1><blockquote><p>å¯¹äºç»˜åˆ¶å¾ˆå¤šç›¸åŒé¡¶ç‚¹å±æ€§çš„ç‰©ä½“,ä»…ä»…æ˜¯mvpä¸åŒã€‚é€šå¸¸çš„ç»˜åˆ¶æ–¹å¼æ˜¯ä½¿ç”¨å¾ªç¯è°ƒç”¨<code>glDrawArrays</code>/<code>glDrawElements</code>æ¥ç»˜åˆ¶ã€‚å¯¼è‡´cpuè°ƒåº¦gpuæˆä¸ºç“¶é¢ˆã€‚ä¸ç»˜åˆ¶é¡¶ç‚¹æœ¬èº«ç›¸æ¯”ï¼Œä½¿ç”¨glDrawArraysæˆ–glDrawElementså‡½æ•°å‘Šè¯‰GPUå»ç»˜åˆ¶ä½ çš„é¡¶ç‚¹æ•°æ®ä¼šæ¶ˆè€—æ›´å¤šçš„æ€§èƒ½ï¼Œå› ä¸ºOpenGLåœ¨ç»˜åˆ¶é¡¶ç‚¹æ•°æ®ä¹‹å‰éœ€è¦åšå¾ˆå¤šå‡†å¤‡å·¥ä½œï¼ˆæ¯”å¦‚å‘Šè¯‰GPUè¯¥ä»å“ªä¸ªç¼“å†²è¯»å–æ•°æ®ï¼Œä»å“ªå¯»æ‰¾é¡¶ç‚¹å±æ€§ï¼Œè€Œä¸”è¿™äº›éƒ½æ˜¯åœ¨ç›¸å¯¹ç¼“æ…¢çš„CPUåˆ°GPUæ€»çº¿(CPUto GPU Bus)ä¸Šè¿›è¡Œçš„ï¼‰ã€‚æ‰€ä»¥ï¼Œå³ä¾¿æ¸²æŸ“é¡¶ç‚¹éå¸¸å¿«ï¼Œå‘½ä»¤GPUå»æ¸²æŸ“å´æœªå¿…ã€‚<code>glDrawArraysInstanced</code>/<code>glDrawElementsInstanced</code>ã€‚</p></blockquote><h2 id="å®è·µä¸€ç»˜åˆ¶100ä¸ªquad">å®è·µä¸€,ç»˜åˆ¶100ä¸ªquad</h2><blockquote><p>è¿™100ä¸ªquadä½¿ç”¨çš„å˜é‡éƒ½ç›¸åŒï¼Œ é™¤äº†ä½ç½®ï¼Œä½ç½®ä½¿ç”¨<code>ç›¸åŒçš„ä½ç½® + åç§»</code>ã€‚</p></blockquote><h3 id="æ•°æ®å‡†å¤‡">æ•°æ®å‡†å¤‡</h3><ol type="1"><li>é¡¶ç‚¹</li></ol><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> quadVertices<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ä½ç½®          // é¢œè‰²</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div><ol start="2" type="1"><li>åç§»å€¼çš„ç”Ÿæˆ</li></ol><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ç”Ÿæˆ 100ä¸ªåç§»å€¼</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    glm<span class="op">::</span>vec2 translations<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> offset <span class="op">=</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> y <span class="op">=</span> <span class="op">-</span><span class="dv">10</span><span class="op">;</span> y <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> y <span class="op">+=</span> <span class="dv">2</span><span class="op">)</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> x <span class="op">=</span> <span class="op">-</span><span class="dv">10</span><span class="op">;</span> x <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> x <span class="op">+=</span> <span class="dv">2</span><span class="op">)</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>            glm<span class="op">::</span>vec2 translation<span class="op">;</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>            translation<span class="op">.</span>x <span class="op">=</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>x <span class="op">/</span> <span class="fl">10.0</span><span class="bu">f</span> <span class="op">+</span> offset<span class="op">;</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>            translation<span class="op">.</span>y <span class="op">=</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>y <span class="op">/</span> <span class="fl">10.0</span><span class="bu">f</span> <span class="op">+</span> offset<span class="op">;</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>            translations<span class="op">[</span>index<span class="op">++]</span> <span class="op">=</span> translation<span class="op">;</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><ol start="3" type="1"><li>bufferå‡†å¤‡</li></ol><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">//åç§»å€¼buffer</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> instanceVBO<span class="op">;</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>instanceVBO<span class="op">);</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> instanceVBO<span class="op">);</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>glm<span class="op">::</span>vec2<span class="op">)</span> <span class="op">*</span> <span class="dv">100</span><span class="op">,</span> <span class="op">&amp;</span>translations<span class="op">[</span><span class="dv">0</span><span class="op">],</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> quadVAO<span class="op">,</span> quadVBO<span class="op">;</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>quadVAO<span class="op">);</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>quadVBO<span class="op">);</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>quadVAO<span class="op">);</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> quadVBO<span class="op">);</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>quadVertices<span class="op">),</span> quadVertices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    </span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">//é¡¶ç‚¹å’Œé¢œè‰²</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">5</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">5</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">2</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">//é¡¶ç‚¹å±æ€§2 ä½¿ç”¨instanceVBOï¼Œçš„vec2</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> instanceVBO<span class="op">);</span> <span class="op">/</span></span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>glm<span class="op">::</span>vec2<span class="op">)</span> <span class="co">/*2 * sizeof(float)*/</span><span class="op">,</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    glVertexAttribDivisor<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span> </span></code></pre></div><ol start="4" type="1"><li>ç»˜åˆ¶</li></ol><div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    shader<span class="op">.</span>use<span class="op">();</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>quadVAO<span class="op">);</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ä¸€ä¸ªquadä¸¤ä¸ªä¸‰è§’å½¢6ä¸ªé¡¶ç‚¹ï¼Œ ç»˜åˆ¶100 ä¸ª</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    glDrawArraysInstanced<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">100</span><span class="op">);</span> </span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span></code></pre></div><h3 id="ç€è‰²å™¨">ç€è‰²å™¨</h3><ol type="1"><li>é¡¶ç‚¹ç€è‰²å™¨</li></ol><div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">0</span><span class="op">)</span> in vec2 aPos<span class="op">;</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">1</span><span class="op">)</span> in vec3 aColor<span class="op">;</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ä½¿ç”¨ä¸åŒçš„åç§»æ¥è®¡ç®—ä½ç½®</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">2</span><span class="op">)</span> in vec2 aOffset<span class="op">;</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    out vec3 fColor<span class="op">;</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        fColor <span class="op">=</span> aColor<span class="op">;</span></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        gl_Position <span class="op">=</span> vec4<span class="op">(</span>aPos <span class="op">+</span> aOffset<span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><ol start="2" type="1"><li>ç‰‡å…ƒç€è‰²å™¨</li></ol><div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>out vec4 FragColor<span class="op">;</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>in vec3 fColor<span class="op">;</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> main<span class="op">()</span></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    FragColor <span class="op">=</span> vec4<span class="op">(</span>fColor<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><h2 id="å®è·µäºŒä½¿ç”¨æ¨¡å‹å¹¶ä¸”æ‹¥æœ‰ä¸åŒçš„ä½ç½®å’Œç¼©æ”¾">å®è·µäºŒï¼Œä½¿ç”¨æ¨¡å‹ï¼Œå¹¶ä¸”æ‹¥æœ‰ä¸åŒçš„ä½ç½®å’Œç¼©æ”¾ã€‚</h2><h3 id="æ•°æ®å‡†å¤‡-1">æ•°æ®å‡†å¤‡</h3><ol type="1"><li>modelçŸ©é˜µç”Ÿæˆ</li></ol><div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> amount <span class="op">=</span> <span class="dv">100000</span><span class="op">;</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    glm<span class="op">::</span>mat4<span class="op">*</span> modelMatrices<span class="op">;</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    modelMatrices <span class="op">=</span> <span class="kw">new</span> glm<span class="op">::</span>mat4<span class="op">[</span>amount<span class="op">];</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    </span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">//è®¾ç½®éšæœºæ•°ç§å­</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    srand<span class="op">(</span>glfwGetTime<span class="op">());</span> </span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> radius <span class="op">=</span> <span class="fl">150.0</span><span class="op">;</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> offset <span class="op">=</span> <span class="fl">25.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">//éšæœºä½ç½®ã€ç¼©æ”¾ã€æ—‹è½¬çš„ modelçŸ©é˜µ</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> amount<span class="op">;</span> i<span class="op">++)</span></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>mat4 model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 1. translation: displace along circle with 'radius' in range [-offset, offset]</span></span><span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> angle <span class="op">=</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>i <span class="op">/</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>amount <span class="op">*</span> <span class="fl">360.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> displacement <span class="op">=</span> <span class="op">(</span>rand<span class="op">()</span> <span class="op">%</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span><span class="dv">2</span> <span class="op">*</span> offset <span class="op">*</span> <span class="dv">100</span><span class="op">))</span> <span class="op">/</span> <span class="fl">100.0</span><span class="bu">f</span> <span class="op">-</span> offset<span class="op">;</span></span><span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> x <span class="op">=</span> sin<span class="op">(</span>angle<span class="op">)</span> <span class="op">*</span> radius <span class="op">+</span> displacement<span class="op">;</span></span><span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        displacement <span class="op">=</span> <span class="op">(</span>rand<span class="op">()</span> <span class="op">%</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span><span class="dv">2</span> <span class="op">*</span> offset <span class="op">*</span> <span class="dv">100</span><span class="op">))</span> <span class="op">/</span> <span class="fl">100.0</span><span class="bu">f</span> <span class="op">-</span> offset<span class="op">;</span></span><span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> y <span class="op">=</span> displacement <span class="op">*</span> <span class="fl">0.4</span><span class="bu">f</span><span class="op">;</span> <span class="co">// keep height of asteroid field smaller compared to width of x and z</span></span><span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        displacement <span class="op">=</span> <span class="op">(</span>rand<span class="op">()</span> <span class="op">%</span> <span class="op">(</span><span class="dt">int</span><span class="op">)(</span><span class="dv">2</span> <span class="op">*</span> offset <span class="op">*</span> <span class="dv">100</span><span class="op">))</span> <span class="op">/</span> <span class="fl">100.0</span><span class="bu">f</span> <span class="op">-</span> offset<span class="op">;</span></span><span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> z <span class="op">=</span> cos<span class="op">(</span>angle<span class="op">)</span> <span class="op">*</span> radius <span class="op">+</span> displacement<span class="op">;</span></span><span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span>x<span class="op">,</span> y<span class="op">,</span> z<span class="op">));</span></span><span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 2. scale: Scale between 0.05 and 0.25f</span></span><span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> scale <span class="op">=</span> <span class="op">(</span>rand<span class="op">()</span> <span class="op">%</span> <span class="dv">20</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100.0</span><span class="bu">f</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">;</span></span><span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> glm<span class="op">::</span>scale<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span>scale<span class="op">));</span></span><span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 3. rotation: add random rotation around a (semi)randomly picked rotation axis vector</span></span><span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> rotAngle <span class="op">=</span> <span class="op">(</span>rand<span class="op">()</span> <span class="op">%</span> <span class="dv">360</span><span class="op">);</span></span><span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> glm<span class="op">::</span>rotate<span class="op">(</span>model<span class="op">,</span> rotAngle<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.4</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.6</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">));</span></span><span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 4. now add to list of matrices</span></span><span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>        modelMatrices<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> model<span class="op">;</span></span><span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><ol start="2" type="1"><li>bufferå‡†å¤‡</li></ol><blockquote><p>ç”Ÿæˆ modelçŸ©é˜µçš„buffer</p></blockquote><div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> buffer<span class="op">;</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>buffer<span class="op">);</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> buffer<span class="op">);</span></span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> amount <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span>glm<span class="op">::</span>mat4<span class="op">),</span> <span class="op">&amp;</span>modelMatrices<span class="op">[</span><span class="dv">0</span><span class="op">],</span> GL_STATIC_DRAW<span class="op">);</span></span></code></pre></div><blockquote><p>å¸ƒå±€é¡¶ç‚¹å±æ€§</p></blockquote><div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">//å½“æˆ‘ä»¬é¡¶ç‚¹å±æ€§çš„ç±»å‹å¤§äºvec4æ—¶ï¼Œå°±è¦å¤šè¿›è¡Œä¸€æ­¥å¤„ç†äº†ã€‚é¡¶ç‚¹å±æ€§æœ€å¤§å…è®¸çš„æ•°æ®å¤§å°ç­‰äºä¸€ä¸ªvec4ã€‚å› ä¸ºä¸€ä¸ªmat4æœ¬è´¨ä¸Šæ˜¯4ä¸ªvec4ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºè¿™ä¸ªçŸ©é˜µé¢„ç•™4ä¸ªé¡¶ç‚¹å±æ€§ã€‚å› ä¸ºæˆ‘ä»¬å°†å®ƒçš„ä½ç½®å€¼è®¾ç½®ä¸º3ï¼ŒçŸ©é˜µæ¯ä¸€åˆ—çš„é¡¶ç‚¹å±æ€§ä½ç½®å€¼å°±æ˜¯3ã€4ã€5å’Œ6ã€‚</span></span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> rock<span class="op">.</span>meshes<span class="op">.</span>size<span class="op">();</span> i<span class="op">++)</span></span><span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> VAO <span class="op">=</span> rock<span class="op">.</span>meshes<span class="op">[</span>i<span class="op">].</span>VAO<span class="op">;</span></span><span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// set attribute pointers for matrix (4 times vec4)</span></span><span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">3</span><span class="op">);</span></span><span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>glm<span class="op">::</span>mat4<span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">4</span><span class="op">);</span></span><span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>glm<span class="op">::</span>mat4<span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="kw">sizeof</span><span class="op">(</span>glm<span class="op">::</span>vec4<span class="op">)));</span></span><span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">5</span><span class="op">);</span></span><span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>glm<span class="op">::</span>mat4<span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">2</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span>glm<span class="op">::</span>vec4<span class="op">)));</span></span><span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">6</span><span class="op">);</span></span><span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">6</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>glm<span class="op">::</span>mat4<span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span>glm<span class="op">::</span>vec4<span class="op">)));</span></span><span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">//æ›´æ–°æ•°æ®</span></span><span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        glVertexAttribDivisor<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        glVertexAttribDivisor<span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>        glVertexAttribDivisor<span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>        glVertexAttribDivisor<span class="op">(</span><span class="dv">6</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><ol start="4" type="1"><li>ç»˜åˆ¶</li></ol><div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>    shader<span class="op">.</span>use<span class="op">();</span></span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>quadVAO<span class="op">);</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ä¸€ä¸ªquadä¸¤ä¸ªä¸‰è§’å½¢6ä¸ªé¡¶ç‚¹ï¼Œ ç»˜åˆ¶100 ä¸ª</span></span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    glDrawArraysInstanced<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">100</span><span class="op">);</span> </span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span></code></pre></div><h3 id="ç€è‰²å™¨-1">ç€è‰²å™¨</h3><ol type="1"><li>é¡¶ç‚¹ç€è‰²å™¨</li></ol><div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">0</span><span class="op">)</span> in vec2 aPos<span class="op">;</span></span><span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">1</span><span class="op">)</span> in vec3 aColor<span class="op">;</span></span><span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ä½¿ç”¨ä¸åŒçš„åç§»æ¥è®¡ç®—ä½ç½®</span></span><span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">2</span><span class="op">)</span> in vec2 aOffset<span class="op">;</span></span><span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    out vec3 fColor<span class="op">;</span></span><span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        fColor <span class="op">=</span> aColor<span class="op">;</span></span><span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        gl_Position <span class="op">=</span> vec4<span class="op">(</span>aPos <span class="op">+</span> aOffset<span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><ol start="2" type="1"><li>ç‰‡å…ƒç€è‰²å™¨</li></ol><div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    out vec4 FragColor<span class="op">;</span></span><span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    in vec3 fColor<span class="op">;</span></span><span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> vec4<span class="op">(</span>fColor<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/04-gao-ji-opengl/09.ji-he-zhao-se-qi/"/>
      <url>/2022/08/10/opengl/04-gao-ji-opengl/09.ji-he-zhao-se-qi/</url>
      
        <content type="html"><![CDATA[<h1 id="å‡ ä½•ç€è‰²å™¨">å‡ ä½•ç€è‰²å™¨</h1><blockquote><p>åœ¨é¡¶ç‚¹å’Œç‰‡æ®µç€è‰²å™¨ä¹‹é—´æœ‰ä¸€ä¸ªå¯é€‰çš„å‡ ä½•ç€è‰²å™¨(GeometryShader)ï¼Œå‡ ä½•ç€è‰²å™¨çš„è¾“å…¥æ˜¯ä¸€ä¸ªå›¾å…ƒï¼ˆå¦‚ç‚¹æˆ–ä¸‰è§’å½¢ï¼‰çš„ä¸€ç»„é¡¶ç‚¹ã€‚å‡ ä½•ç€è‰²å™¨å¯ä»¥åœ¨é¡¶ç‚¹å‘é€åˆ°ä¸‹ä¸€ç€è‰²å™¨é˜¶æ®µä¹‹å‰å¯¹å®ƒä»¬éšæ„å˜æ¢ã€‚ç„¶è€Œï¼Œå‡ ä½•ç€è‰²å™¨æœ€æœ‰è¶£çš„åœ°æ–¹åœ¨äºï¼Œå®ƒèƒ½å¤Ÿå°†ï¼ˆè¿™ä¸€ç»„ï¼‰é¡¶ç‚¹å˜æ¢ä¸ºå®Œå…¨ä¸åŒçš„å›¾å…ƒï¼Œå¹¶ä¸”è¿˜èƒ½ç”Ÿæˆæ¯”åŸæ¥æ›´å¤šçš„é¡¶ç‚¹ã€‚</p></blockquote><h2 id="å‡ ä½•ç€è‰²å™¨-1">å‡ ä½•ç€è‰²å™¨</h2><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">//å¯¹åº”glDrawArraysä¸€ç§ç»˜åˆ¶æ–¹å¼ï¼š pointsã€linesã€lines_adjacencyã€trianglesã€triangles_adjacency</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>points<span class="op">)</span> in<span class="op">;</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">//çº¿çš„æ–¹å¼è¾“å‡ºï¼Œå¹¶é™åˆ¶æœ€å¤§é¡¶ç‚¹æ•°ä¸º2</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>line_strip<span class="op">,</span> max_vertices <span class="op">=</span> <span class="dv">2</span><span class="op">)</span> out<span class="op">;</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span> <span class="op">{</span>    </span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        gl_Position <span class="op">=</span> gl_in<span class="op">[</span><span class="dv">0</span><span class="op">].</span>gl_Position <span class="op">+</span> vec4<span class="op">(-</span><span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span> </span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        EmitVertex<span class="op">();</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        gl_Position <span class="op">=</span> gl_in<span class="op">[</span><span class="dv">0</span><span class="op">].</span>gl_Position <span class="op">+</span> vec4<span class="op">(</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        EmitVertex<span class="op">();</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        EndPrimitive<span class="op">();</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><p>è¾“å…¥ï¼šåœ¨å‡ ä½•ç€è‰²å™¨çš„é¡¶éƒ¨ï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜ä»é¡¶ç‚¹ç€è‰²å™¨è¾“å…¥çš„å›¾å…ƒç±»å‹ã€‚è¿™éœ€è¦åœ¨inå…³é”®å­—å‰å£°æ˜ä¸€ä¸ªå¸ƒå±€ä¿®é¥°ç¬¦(LayoutQualifier)ã€‚è¿™ä¸ªè¾“å…¥å¸ƒå±€ä¿®é¥°ç¬¦å¯ä»¥ä»é¡¶ç‚¹ç€è‰²å™¨æ¥æ”¶ä¸‹åˆ—ä»»ä½•ä¸€ä¸ªå›¾å…ƒå€¼,å¯¹åº”äº†ä¸åŒçš„ç»˜åˆ¶æ–¹å¼ä¸‹çš„å›¾å…ƒå€¼: pointsï¼šç»˜åˆ¶GL_POINTSå›¾å…ƒæ—¶ï¼ˆ1ï¼‰ã€‚linesï¼šç»˜åˆ¶GL_LINESæˆ–GL_LINE_STRIPæ—¶ï¼ˆ2ï¼‰lines_adjacencyï¼šGL_LINES_ADJACENCYæˆ–GL_LINE_STRIP_ADJACENCYï¼ˆ4ï¼‰trianglesï¼šGL_TRIANGLESã€GL_TRIANGLE_STRIPæˆ–GL_TRIANGLE_FANï¼ˆ3ï¼‰triangles_adjacencyï¼šGL_TRIANGLES_ADJACENCYæˆ–GL_TRIANGLE_STRIP_ADJACENCYï¼ˆ6ï¼‰</p><pre><code>ä»¥ä¸Šæ˜¯èƒ½æä¾›ç»™glDrawArraysæ¸²æŸ“å‡½æ•°çš„å‡ ä¹æ‰€æœ‰å›¾å…ƒäº†ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦å°†é¡¶ç‚¹ç»˜åˆ¶ä¸ºGL_TRIANGLESï¼Œæˆ‘ä»¬å°±è¦å°†è¾“å…¥ä¿®é¥°ç¬¦è®¾ç½®ä¸ºtrianglesã€‚æ‹¬å·å†…çš„æ•°å­—è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªå›¾å…ƒæ‰€åŒ…å«çš„æœ€å°é¡¶ç‚¹æ•°ã€‚</code></pre><p>è¾“å‡º:æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŒ‡å®šå‡ ä½•ç€è‰²å™¨è¾“å‡ºçš„å›¾å…ƒç±»å‹ï¼Œè¿™éœ€è¦åœ¨outå…³é”®å­—å‰é¢åŠ ä¸€ä¸ªå¸ƒå±€ä¿®é¥°ç¬¦ã€‚å’Œè¾“å…¥å¸ƒå±€ä¿®é¥°ç¬¦ä¸€æ ·ï¼Œè¾“å‡ºå¸ƒå±€ä¿®é¥°ç¬¦ä¹Ÿå¯ä»¥æ¥å—å‡ ä¸ªå›¾å…ƒå€¼ï¼šç‚¹çº¿ä¸‰è§’å½¢points line_strip triangle_stripå‡ ä½•ç€è‰²å™¨åŒæ—¶å¸Œæœ›æˆ‘ä»¬è®¾ç½®ä¸€ä¸ªå®ƒæœ€å¤§èƒ½å¤Ÿè¾“å‡ºçš„é¡¶ç‚¹æ•°é‡ï¼ˆå¦‚æœä½ è¶…è¿‡äº†è¿™ä¸ªå€¼ï¼ŒOpenGLå°†ä¸ä¼šç»˜åˆ¶å¤šå‡ºçš„é¡¶ç‚¹ï¼‰ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥åœ¨outå…³é”®å­—çš„å¸ƒå±€ä¿®é¥°ç¬¦ä¸­è®¾ç½®</p><p>ä¸ºäº†ç”Ÿæˆæ›´æœ‰æ„ä¹‰çš„ç»“æœï¼Œæˆ‘ä»¬éœ€è¦æŸç§æ–¹å¼æ¥è·å–å‰ä¸€ç€è‰²å™¨é˜¶æ®µçš„è¾“å‡ºã€‚GLSLæä¾›ç»™æˆ‘ä»¬ä¸€ä¸ªå†…å»º(Built-in)å˜é‡ï¼Œåœ¨å†…éƒ¨çœ‹èµ·æ¥ï¼ˆå¯èƒ½ï¼‰æ˜¯è¿™æ ·çš„ï¼š</p><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    in gl_Vertex</span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        vec4  gl_Position<span class="op">;</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> gl_PointSize<span class="op">;</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> gl_ClipDistance<span class="op">[];</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> gl_in<span class="op">[];</span></span></code></pre></div><p>è¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒè¢«å£°æ˜ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå› ä¸ºå¤§å¤šæ•°çš„æ¸²æŸ“å›¾å…ƒåŒ…å«å¤šäº1ä¸ªçš„é¡¶ç‚¹ï¼Œè€Œå‡ ä½•ç€è‰²å™¨çš„è¾“å…¥æ˜¯ä¸€ä¸ªå›¾å…ƒçš„<code>æ‰€æœ‰é¡¶ç‚¹</code>ã€‚</p><p>æœ‰äº†ä¹‹å‰é¡¶ç‚¹ç€è‰²å™¨é˜¶æ®µçš„é¡¶ç‚¹æ•°æ®ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨2ä¸ªå‡ ä½•ç€è‰²å™¨å‡½æ•°ï¼ŒEmitVertexå’ŒEndPrimitiveï¼Œæ¥ç”Ÿæˆæ–°çš„æ•°æ®äº†ã€‚å‡ ä½•ç€è‰²å™¨å¸Œæœ›ä½ èƒ½å¤Ÿç”Ÿæˆå¹¶è¾“å‡ºè‡³å°‘ä¸€ä¸ªå®šä¹‰ä¸ºè¾“å‡ºçš„å›¾å…ƒã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è‡³å°‘ç”Ÿæˆä¸€ä¸ªçº¿æ¡å›¾å…ƒã€‚(æœ‰ç‚¹ç±»ä¼¼è®¾ç½®é¡¶ç‚¹å’Œå±æ€§æ—¶çš„æ“ä½œ)</p><div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span> <span class="op">{</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>        gl_Position <span class="op">=</span> gl_in<span class="op">[</span><span class="dv">0</span><span class="op">].</span>gl_Position <span class="op">+</span> vec4<span class="op">(-</span><span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span> </span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        EmitVertex<span class="op">();</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        gl_Position <span class="op">=</span> gl_in<span class="op">[</span><span class="dv">0</span><span class="op">].</span>gl_Position <span class="op">+</span> vec4<span class="op">(</span> <span class="fl">0.1</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        EmitVertex<span class="op">();</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        EndPrimitive<span class="op">();</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><p>æ¯æ¬¡æˆ‘ä»¬è°ƒç”¨EmitVertexæ—¶ï¼Œgl_Positionä¸­çš„å‘é‡ä¼šè¢«æ·»åŠ åˆ°å›¾å…ƒä¸­æ¥ã€‚å½“EndPrimitiveè¢«è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰å‘å°„å‡ºçš„(Emitted)é¡¶ç‚¹éƒ½ä¼šåˆæˆä¸ºæŒ‡å®šçš„è¾“å‡ºæ¸²æŸ“å›¾å…ƒã€‚åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªEmitVertexè°ƒç”¨ä¹‹åé‡å¤è°ƒç”¨EndPrimitiveèƒ½å¤Ÿç”Ÿæˆå¤šä¸ªå›¾å…ƒã€‚</p><h2 id="å®è·µä¸€åˆ›å»ºæ›´å¤šé¡¶ç‚¹">å®è·µä¸€ï¼Œåˆ›å»ºæ›´å¤šé¡¶ç‚¹</h2><ol type="1"><li>é¡¶ç‚¹</li></ol><div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>    </span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// 2dé¡¶ç‚¹ + é¡¶ç‚¹é¢œè‰²</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> points<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// top-left</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// top-right</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom-right</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span>  <span class="co">// bottom-left</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> VBO<span class="op">,</span> VAO<span class="op">;</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>points<span class="op">),</span> <span class="op">&amp;</span>points<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">5</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">5</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">2</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span></code></pre></div><ol start="2" type="1"><li>ç»˜åˆ¶</li></ol><div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ä½¿ç”¨ GL_POINTS ç»˜åˆ¶</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    shader<span class="op">.</span>use<span class="op">();</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    glDrawArrays<span class="op">(</span>GL_POINTS<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span></code></pre></div><ol start="3" type="1"><li>ç€è‰²å™¨<ol type="1"><li>å‡ ä½•ç€è‰²å™¨</li></ol><div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a> <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a> <span class="co">//1. å¯¹åº”glDrawArrays(GL_POINTS,</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a> layout <span class="op">(</span>points<span class="op">)</span> in<span class="op">;</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a> <span class="co">//2. triangle_stripè¾“å‡ºï¼Œ é™åˆ¶æœ€å¤š5ä¸ªé¡¶ç‚¹</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a> layout <span class="op">(</span>triangle_strip<span class="op">,</span> max_vertices <span class="op">=</span> <span class="dv">5</span><span class="op">)</span> out<span class="op">;</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a> <span class="co">//3. æ¥å—é¡¶ç‚¹çš„é¢œè‰²å€¼</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a> in VS_OUT <span class="op">{</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>     vec3 color<span class="op">;</span></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span> gs_in<span class="op">[];</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a> <span class="co">//4. ä¼ é€’é¢œè‰²å€¼</span></span><span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a> out vec3 fColor<span class="op">;</span></span><span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a> <span class="co">//5. `EmitVertex`åˆ›å»ºé¡¶ç‚¹ï¼Œ`EndPrimitive`åˆ›å»ºå›¾å…ƒã€‚åŸæœ¬æ˜¯gl_in[0].gl_Positionï¼Œ è¾“å‡ºåˆ›å»ºçš„é¡¶ç‚¹</span></span><span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a> <span class="dt">void</span> build_house<span class="op">(</span>vec4 position<span class="op">)</span></span><span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span>    </span><span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>     <span class="co">//5.1 æ¥æ”¶çš„é¢œè‰²å€¼</span></span><span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>     fColor <span class="op">=</span> gs_in<span class="op">[</span><span class="dv">0</span><span class="op">].</span>color<span class="op">;</span> <span class="co">// gs_in[0] since there's only one input vertex</span></span><span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>     <span class="co">//1. é¡¶ç‚¹1</span></span><span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>     gl_Position <span class="op">=</span> position <span class="op">+</span> vec4<span class="op">(-</span><span class="fl">0.2</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.2</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span> <span class="co">// 1:bottom-left   </span></span><span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>     EmitVertex<span class="op">();</span>   </span><span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>     <span class="co">//2. é¡¶ç‚¹2</span></span><span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>     gl_Position <span class="op">=</span> position <span class="op">+</span> vec4<span class="op">(</span> <span class="fl">0.2</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.2</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span> <span class="co">// 2:bottom-right</span></span><span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>     EmitVertex<span class="op">();</span></span><span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>     <span class="co">//3. é¡¶ç‚¹3</span></span><span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>     gl_Position <span class="op">=</span> position <span class="op">+</span> vec4<span class="op">(-</span><span class="fl">0.2</span><span class="op">,</span>  <span class="fl">0.2</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span> <span class="co">// 3:top-left</span></span><span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>     EmitVertex<span class="op">();</span></span><span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>     <span class="co">//4. é¡¶ç‚¹4</span></span><span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>     gl_Position <span class="op">=</span> position <span class="op">+</span> vec4<span class="op">(</span> <span class="fl">0.2</span><span class="op">,</span>  <span class="fl">0.2</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span> <span class="co">// 4:top-right</span></span><span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>     EmitVertex<span class="op">();</span></span><span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>     <span class="co">//5. é¡¶ç‚¹5</span></span><span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>     gl_Position <span class="op">=</span> position <span class="op">+</span> vec4<span class="op">(</span> <span class="fl">0.0</span><span class="op">,</span>  <span class="fl">0.4</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span> <span class="co">// 5:top</span></span><span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>     <span class="co">//è¿™é‡Œæ”¹å˜é¢œè‰²ï¼Œå°†ä¼šå½±å“åé¢çš„é¡¶ç‚¹é¢œè‰²ã€‚ä¹‹å‰çš„é¢œè‰²ä¸ºä¸Šæ¬¡çš„æ”¹å˜ã€‚</span></span><span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>     <span class="co">//æ¯”å¦‚åœ¨ç¬¬ä¸€ä¸ªé¡¶ç‚¹ç»“æŸï¼Œ ç¬¬äºŒä¸ªé¡¶ç‚¹å¼€å§‹è®¾ç½®é¢œè‰²ã€‚åˆ™åœ¨ä¸‹æ¬¡æ”¹å˜ä¹‹å‰éƒ½ä½¿ç”¨è¿™ä¸ªé¢œè‰²ï¼Œä½œä¸ºé¡¶ç‚¹é¢œè‰²ä¼ é€’ã€‚</span></span><span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>     <span class="co">//ä¹Ÿå¯ä»¥è¿™ä¹ˆç†è§£ï¼š ä¸€ä¸ª EmitVertexè°ƒç”¨å¯¹åº”ä¸€æ¬¡é¡¶ç‚¹ç€è‰²å™¨æ‰§è¡Œï¼Œè™½ç„¶ä¸å‡†ç¡®ï¼Œä½†æ˜¯ç›¸å¯¹æ¯”è¾ƒå¥½ç†è§£ã€‚</span></span><span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>     fColor <span class="op">=</span> vec3<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span><span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>     EmitVertex<span class="op">();</span></span><span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>     EndPrimitive<span class="op">();</span></span><span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span><span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a> <span class="dt">void</span> main<span class="op">()</span> <span class="op">{</span>    </span><span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>     build_house<span class="op">(</span>gl_in<span class="op">[</span><span class="dv">0</span><span class="op">].</span>gl_Position<span class="op">);</span></span><span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span></code></pre></div><ol start="2" type="1"><li>é¡¶ç‚¹ç€è‰²å™¨</li></ol><div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a> <span class="co">// ä¼ é€’é¡¶ç‚¹å’Œé¢œè‰²,2dé¡¶ç‚¹z=0</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a> <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a> layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">0</span><span class="op">)</span> in vec2 aPos<span class="op">;</span></span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a> layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">1</span><span class="op">)</span> in vec3 aColor<span class="op">;</span></span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a> out VS_OUT <span class="op">{</span></span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>     vec3 color<span class="op">;</span></span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span> vs_out<span class="op">;</span></span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a> <span class="dt">void</span> main<span class="op">()</span></span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span></span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>     vs_out<span class="op">.</span>color <span class="op">=</span> aColor<span class="op">;</span></span><span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>     gl_Position <span class="op">=</span> vec4<span class="op">(</span>aPos<span class="op">.</span>x<span class="op">,</span> aPos<span class="op">.</span>y<span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span> </span><span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span></code></pre></div><ol start="3" type="1"><li>ç‰‡å…ƒç€è‰²å™¨</li></ol><div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a> <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a> out vec4 FragColor<span class="op">;</span></span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a> in vec3 fColor<span class="op">;</span></span><span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a> <span class="dt">void</span> main<span class="op">()</span></span><span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span></span><span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>     FragColor <span class="op">=</span> vec4<span class="op">(</span>fColor<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span>   </span><span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span></code></pre></div></li></ol><h2 id="å®è·µäºŒçˆ†ç ´ç‰©ä½“">å®è·µäºŒ,çˆ†ç ´ç‰©ä½“</h2><blockquote><p>å½“æˆ‘ä»¬è¯´çˆ†ç ´ä¸€ä¸ªç‰©ä½“æ—¶ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯æŒ‡è¦å°†å®è´µçš„é¡¶ç‚¹é›†ç»™ç‚¸æ‰ï¼Œæˆ‘ä»¬æ˜¯è¦å°†æ¯ä¸ªä¸‰è§’å½¢æ²¿ç€æ³•å‘é‡çš„æ–¹å‘ç§»åŠ¨ä¸€å°æ®µæ—¶é—´ã€‚æ•ˆæœå°±æ˜¯ï¼Œæ•´ä¸ªç‰©ä½“çœ‹èµ·æ¥åƒæ˜¯æ²¿ç€æ¯ä¸ªä¸‰è§’å½¢çš„æ³•çº¿å‘é‡çˆ†ç‚¸ä¸€æ ·ã€‚çˆ†ç‚¸ä¸‰è§’å½¢çš„æ•ˆæœåœ¨çº³ç±³è£…æ¨¡å‹ä¸Šçœ‹èµ·æ¥åƒæ˜¯è¿™æ ·çš„ï¼š</p></blockquote><ol type="1"><li>é‡è¦ç‚¹<ol type="1"><li>æ³•å‘é‡, è¿™é‡Œä½¿ç”¨å‚ç›´äºä¸‰é¡¶ç‚¹ç»„æˆçš„å¹³é¢ï¼ˆé¡¶ç‚¹ä¸åœ¨ä¸€æ¡çº¿ï¼‰</li></ol><div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a> vec3 GetNormal<span class="op">()</span></span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    vec3 a <span class="op">=</span> vec3<span class="op">(</span>gl_in<span class="op">[</span><span class="dv">0</span><span class="op">].</span>gl_Position<span class="op">)</span> <span class="op">-</span> vec3<span class="op">(</span>gl_in<span class="op">[</span><span class="dv">1</span><span class="op">].</span>gl_Position<span class="op">);</span></span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    vec3 b <span class="op">=</span> vec3<span class="op">(</span>gl_in<span class="op">[</span><span class="dv">2</span><span class="op">].</span>gl_Position<span class="op">)</span> <span class="op">-</span> vec3<span class="op">(</span>gl_in<span class="op">[</span><span class="dv">1</span><span class="op">].</span>gl_Position<span class="op">);</span></span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// cross ä½œä¸ºæ³•å‘é‡ï¼Œ æ‰€ä»¥é¡ºåºå¾ˆé‡è¦</span></span><span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> normalize<span class="op">(</span>cross<span class="op">(</span>a<span class="op">,</span> b<span class="op">));</span></span><span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span></code></pre></div><ol start="2" type="1"><li>ç§»åŠ¨çš„çˆ†ç ´å‡½æ•°</li></ol><div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a> vec4 explode<span class="op">(</span>vec4 position<span class="op">,</span> vec3 normal<span class="op">)</span></span><span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a> <span class="op">{</span></span><span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>     <span class="dt">float</span> magnitude <span class="op">=</span> <span class="fl">2.0</span><span class="op">;</span></span><span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>     <span class="co">// time ä½œä¸ºå˜é‡ï¼Œä½¿ç”¨shaderä¼ é€’å‚æ•°</span></span><span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>     <span class="co">// æ³•å‘é‡ * magnitude çš„ 0-1 çš„sinå€¼ï¼Œä½œä¸ºç§»åŠ¨å‘é‡</span></span><span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>     vec3 direction <span class="op">=</span> normal <span class="op">*</span> <span class="op">((</span>sin<span class="op">(</span>time<span class="op">)</span> <span class="op">+</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2.0</span><span class="op">)</span> <span class="op">*</span> magnitude<span class="op">;</span> </span><span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>     <span class="cf">return</span> position <span class="op">+</span> vec4<span class="op">(</span>direction<span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span><span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a> <span class="op">}</span></span></code></pre></div></li><li>æ¨¡å‹å’Œå‚æ•°å‡†å¤‡</li></ol><div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>    Shader shader<span class="op">(</span><span class="st">"./res/shaders/09geometry/02geometry_shader.vs"</span><span class="op">,</span> <span class="st">"./res/shaders/09geometry/02geometry_shader.gs"</span><span class="op">,</span> <span class="st">"./res/shaders/09geometry/02geometry_shader.fs"</span><span class="op">);</span></span><span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    Model nanosuit<span class="op">(</span><span class="st">"./res/models/nanosuit/nanosuit.obj"</span><span class="op">);</span></span></code></pre></div><ol start="3" type="1"><li>ç»˜åˆ¶</li></ol><div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ã€‚ã€‚ã€‚</span></span><span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    </span><span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// è®¾ç½®shader çš„timeå˜é‡</span></span><span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    shader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"time"</span><span class="op">,</span> glfwGetTime<span class="op">());</span></span><span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ã€‚ã€‚ã€‚</span></span><span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> indices<span class="op">.</span>size<span class="op">(),</span> GL_UNSIGNED_INT<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span></code></pre></div><ol start="3" type="1"><li>å‡ ä½•ç€è‰²å™¨ï¼Œ é¡¶ç‚¹ç€è‰²å™¨ä½¿ç”¨mvpå’Œuvçš„é¡¶ç‚¹ç€è‰²å™¨, ç‰‡å…ƒç€è‰²å™¨ä½¿ç”¨è´´å›¾uvçš„ç‰‡å…ƒç€è‰²å™¨</li></ol><div class="sourceCode" id="cb14"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">//1. å¯¹åº”glDrawElements(GL_TRIANGLES</span></span><span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>triangles<span class="op">)</span> in<span class="op">;</span></span><span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">//2. é™åˆ¶ä¸ºæœ€å¤§3ä¸ªé¡¶ç‚¹</span></span><span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>triangle_strip<span class="op">,</span> max_vertices <span class="op">=</span> <span class="dv">3</span><span class="op">)</span> out<span class="op">;</span></span><span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">//3. æ¥å—ä¼ é€’uv</span></span><span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    in VS_OUT <span class="op">{</span></span><span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        vec2 texCoords<span class="op">;</span></span><span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> gs_in<span class="op">[];</span></span><span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">//4. ä¼ é€’uv</span></span><span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    out vec2 TexCoords<span class="op">;</span> </span><span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">//æ¥å— time è¾“å…¥</span></span><span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    uniform <span class="dt">float</span> time<span class="op">;</span></span><span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span><span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    vec4 explode<span class="op">(</span>vec4 position<span class="op">,</span> vec3 normal<span class="op">)</span></span><span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> magnitude <span class="op">=</span> <span class="fl">2.0</span><span class="op">;</span></span><span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>        vec3 direction <span class="op">=</span> normal <span class="op">*</span> <span class="op">((</span>sin<span class="op">(</span>time<span class="op">)</span> <span class="op">+</span> <span class="fl">1.0</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2.0</span><span class="op">)</span> <span class="op">*</span> magnitude<span class="op">;</span> </span><span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> position <span class="op">+</span> vec4<span class="op">(</span>direction<span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span><span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a></span><span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    vec3 GetNormal<span class="op">()</span></span><span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">//GL_TRIANGLES æ¨¡å¼ä¸‹ï¼Œ gl_in ä¸ºä¸‰ä¸ªå¤§å°çš„æ•°æ®ï¼Œ ä¸‰ä¸ªé¡¶ç‚¹</span></span><span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>        vec3 a <span class="op">=</span> vec3<span class="op">(</span>gl_in<span class="op">[</span><span class="dv">0</span><span class="op">].</span>gl_Position<span class="op">)</span> <span class="op">-</span> vec3<span class="op">(</span>gl_in<span class="op">[</span><span class="dv">1</span><span class="op">].</span>gl_Position<span class="op">);</span></span><span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>        vec3 b <span class="op">=</span> vec3<span class="op">(</span>gl_in<span class="op">[</span><span class="dv">2</span><span class="op">].</span>gl_Position<span class="op">)</span> <span class="op">-</span> vec3<span class="op">(</span>gl_in<span class="op">[</span><span class="dv">1</span><span class="op">].</span>gl_Position<span class="op">);</span></span><span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> normalize<span class="op">(</span>cross<span class="op">(</span>a<span class="op">,</span> b<span class="op">));</span></span><span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a></span><span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span> <span class="op">{</span>    </span><span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>        <span class="co">//è®¡ç®—ä¸‰è§’å½¢çš„å‚ç›´å‘é‡</span></span><span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>        vec3 normal <span class="op">=</span> GetNormal<span class="op">();</span></span><span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a></span><span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">//é‡æ–°è®¾ç½®ä½ç½®</span></span><span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>        gl_Position <span class="op">=</span> explode<span class="op">(</span>gl_in<span class="op">[</span><span class="dv">0</span><span class="op">].</span>gl_Position<span class="op">,</span> normal<span class="op">);</span></span><span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">//å¯¹åº”é¡¶ç‚¹çš„uv ä¸å˜</span></span><span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>        TexCoords <span class="op">=</span> gs_in<span class="op">[</span><span class="dv">0</span><span class="op">].</span>texCoords<span class="op">;</span></span><span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>        EmitVertex<span class="op">();</span></span><span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>        gl_Position <span class="op">=</span> explode<span class="op">(</span>gl_in<span class="op">[</span><span class="dv">1</span><span class="op">].</span>gl_Position<span class="op">,</span> normal<span class="op">);</span></span><span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>        TexCoords <span class="op">=</span> gs_in<span class="op">[</span><span class="dv">1</span><span class="op">].</span>texCoords<span class="op">;</span></span><span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>        EmitVertex<span class="op">();</span></span><span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a>        gl_Position <span class="op">=</span> explode<span class="op">(</span>gl_in<span class="op">[</span><span class="dv">2</span><span class="op">].</span>gl_Position<span class="op">,</span> normal<span class="op">);</span></span><span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a>        TexCoords <span class="op">=</span> gs_in<span class="op">[</span><span class="dv">2</span><span class="op">].</span>texCoords<span class="op">;</span></span><span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>        EmitVertex<span class="op">();</span></span><span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a>        EndPrimitive<span class="op">();</span></span><span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><h2 id="å®è·µä¸‰æ³•çº¿å¯è§†åŒ–">å®è·µä¸‰ï¼Œæ³•çº¿å¯è§†åŒ–</h2><ol type="1"><li>å‡ ä½•ç€è‰²å™¨</li></ol><div class="sourceCode" id="cb15"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">//1. å¯¹åº”glDrawElements(GL_TRIANGLES</span></span><span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>layout <span class="op">(</span>triangles<span class="op">)</span> in<span class="op">;</span></span><span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">//2. ä½¿ç”¨line_stripï¼Œ å› ä¸ºè¿™é‡Œåªç»˜åˆ¶æ³•çº¿çš„é¢œè‰²çº¿æ®µ</span></span><span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co">//max_vertices é™åˆ¶ä¸º6ï¼Œ æ˜¯å› ä¸ºéœ€è¦å¦å¤–å¤šåˆ›å»ºä¸€ç»„ã€‚</span></span><span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>layout <span class="op">(</span>line_strip<span class="op">,</span> max_vertices <span class="op">=</span> <span class="dv">6</span><span class="op">)</span> out<span class="op">;</span></span><span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">//3. æ¥æ”¶normal è¾“å…¥</span></span><span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>in VS_OUT <span class="op">{</span></span><span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    vec3 normal<span class="op">;</span></span><span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> gs_in<span class="op">[];</span></span><span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">float</span> MAGNITUDE <span class="op">=</span> <span class="fl">0.4</span><span class="op">;</span></span><span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">//4. ä¸ºæ³•çº¿ç”Ÿæˆå¯¹åº”çº¿æ®µçš„å¦ä¸€ä¸ªé¡¶ç‚¹ï¼Œ index ä¸ºä¸‰è§’å½¢çš„é¡¶ç‚¹indexï¼Œå‚¨å­˜äºgl_in[index]ä¸­</span></span><span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> GenerateLine<span class="op">(</span><span class="dt">int</span> index<span class="op">)</span></span><span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">//4.1 ç¬¬ä¸€ä¸ªé¡¶ç‚¹ä¸å˜</span></span><span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    gl_Position <span class="op">=</span> gl_in<span class="op">[</span>index<span class="op">].</span>gl_Position<span class="op">;</span></span><span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    EmitVertex<span class="op">();</span></span><span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a></span><span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">//2. ç¬¬äºŒä¸ªé¡¶ç‚¹ åç§»æ³•çº¿ *MAGNITUDE çš„è·ç¦»ã€‚</span></span><span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    gl_Position <span class="op">=</span> gl_in<span class="op">[</span>index<span class="op">].</span>gl_Position <span class="op">+</span> vec4<span class="op">(</span>gs_in<span class="op">[</span>index<span class="op">].</span>normal<span class="op">,</span> <span class="fl">0.0</span><span class="op">)</span> <span class="op">*</span> MAGNITUDE<span class="op">;</span></span><span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    EmitVertex<span class="op">();</span></span><span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    EndPrimitive<span class="op">();</span></span><span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span><span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> main<span class="op">()</span></span><span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    GenerateLine<span class="op">(</span><span class="dv">0</span><span class="op">);</span> <span class="co">// ç¬¬ä¸€ä¸ªé¡¶ç‚¹æ³•çº¿</span></span><span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    GenerateLine<span class="op">(</span><span class="dv">1</span><span class="op">);</span> <span class="co">// ç¬¬äºŒä¸ªé¡¶ç‚¹æ³•çº¿</span></span><span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    GenerateLine<span class="op">(</span><span class="dv">2</span><span class="op">);</span> <span class="co">// ç¬¬ä¸‰ä¸ªé¡¶ç‚¹æ³•çº¿</span></span><span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/04-gao-ji-opengl/08.gao-ji-glsl/"/>
      <url>/2022/08/10/opengl/04-gao-ji-opengl/08.gao-ji-glsl/</url>
      
        <content type="html"><![CDATA[<h2 id="é«˜çº§glsl">é«˜çº§GLSL</h2><blockquote><p>ä¸»è¦è®¨è®ºä¸€äº›æœ‰è¶£çš„å†…å»ºå˜é‡(Built-inVariable)ï¼Œç®¡ç†ç€è‰²å™¨è¾“å…¥å’Œè¾“å‡ºçš„æ–°æ–¹å¼ä»¥åŠä¸€ä¸ªå«åšUniformç¼“å†²å¯¹è±¡(UniformBuffer Object)çš„æœ‰ç”¨å·¥å…·ã€‚</p></blockquote><h3 id="glslå†…ç½®å˜é‡">GLSLå†…ç½®å˜é‡</h3><p>ç€è‰²å™¨éƒ½æ˜¯æœ€ç®€åŒ–çš„ï¼Œå¦‚æœéœ€è¦å½“å‰ç€è‰²å™¨ä»¥å¤–åœ°æ–¹çš„æ•°æ®çš„è¯ï¼Œæˆ‘ä»¬å¿…é¡»è¦å°†æ•°æ®ä¼ è¿›æ¥ã€‚æˆ‘ä»¬å·²ç»å­¦ä¼šä½¿ç”¨é¡¶ç‚¹å±æ€§ã€uniformå’Œé‡‡æ ·å™¨æ¥å®Œæˆè¿™ä¸€ä»»åŠ¡äº†ã€‚ç„¶è€Œï¼Œé™¤æ­¤ä¹‹å¤–ï¼ŒGLSLè¿˜å®šä¹‰äº†å¦å¤–å‡ ä¸ªä»¥gl_ä¸ºå‰ç¼€çš„å˜é‡ï¼Œå®ƒä»¬èƒ½æä¾›ç»™æˆ‘ä»¬æ›´å¤šçš„æ–¹å¼æ¥è¯»å–/å†™å…¥æ•°æ®ã€‚æˆ‘ä»¬å·²ç»åœ¨å‰é¢æ•™ç¨‹ä¸­æ¥è§¦è¿‡å…¶ä¸­çš„ä¸¤ä¸ªäº†ï¼šé¡¶ç‚¹ç€è‰²å™¨çš„è¾“å‡ºå‘é‡gl_Positionï¼Œå’Œç‰‡æ®µç€è‰²å™¨çš„gl_FragCoordã€‚</p><h4 id="é¡¶ç‚¹ç€è‰²å™¨å˜é‡">é¡¶ç‚¹ç€è‰²å™¨å˜é‡</h4><ol type="1"><li>gl_Positionæ˜¯å¿…é¡»çš„ã€‚</li><li>gl_PointSizeæˆ‘ä»¬èƒ½å¤Ÿé€‰ç”¨çš„å…¶ä¸­ä¸€ä¸ªå›¾å…ƒæ˜¯GL_POINTSï¼Œå¦‚æœä½¿ç”¨å®ƒçš„è¯ï¼Œæ¯ä¸€ä¸ªé¡¶ç‚¹éƒ½æ˜¯ä¸€ä¸ªå›¾å…ƒï¼Œéƒ½ä¼šè¢«æ¸²æŸ“ä¸ºä¸€ä¸ªç‚¹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡OpenGLçš„glPointSizeå‡½æ•°æ¥è®¾ç½®æ¸²æŸ“å‡ºæ¥çš„ç‚¹çš„å¤§å°ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ä¿®æ”¹è¿™ä¸ªå€¼ã€‚GLSLå®šä¹‰äº†ä¸€ä¸ªå«åšgl_PointSizeè¾“å‡ºå˜é‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªfloatå˜é‡ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥è®¾ç½®ç‚¹çš„å®½é«˜ï¼ˆåƒç´ ï¼‰ã€‚åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ä¿®æ”¹ç‚¹çš„å¤§å°çš„è¯ï¼Œä½ å°±èƒ½å¯¹æ¯ä¸ªé¡¶ç‚¹è®¾ç½®ä¸åŒçš„å€¼äº†ã€‚</li></ol><p>åœ¨é¡¶ç‚¹ç€è‰²å™¨ä¸­ä¿®æ”¹ç‚¹å¤§å°çš„åŠŸèƒ½é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œå¦‚æœä½ éœ€è¦å¯ç”¨å®ƒçš„è¯ï¼Œä½ éœ€è¦å¯ç”¨OpenGLçš„<code>GL_PROGRAM_POINT_SIZE</code>ï¼š</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    glEnable<span class="op">(</span>GL_PROGRAM_POINT_SIZE<span class="op">);</span></span></code></pre></div><p>æ¯”å¦‚ ä½¿è·ç¦»ä½œä¸ºç‚¹çš„size</p><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        gl_Position <span class="op">=</span> projection <span class="op">*</span> view <span class="op">*</span> model <span class="op">*</span> vec4<span class="op">(</span>aPos<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span>    </span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        gl_PointSize <span class="op">=</span> gl_Position<span class="op">.</span>z<span class="op">;</span>    </span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><ol start="3" type="1"><li>gl_VertexID</li></ol><p>gl_Positionå’Œgl_PointSizeéƒ½æ˜¯è¾“å‡ºå˜é‡ï¼Œå› ä¸ºå®ƒä»¬çš„å€¼æ˜¯ä½œä¸ºé¡¶ç‚¹ç€è‰²å™¨çš„è¾“å‡ºè¢«è¯»å–çš„ã€‚æˆ‘ä»¬å¯ä»¥å¯¹å®ƒä»¬è¿›è¡Œå†™å…¥ï¼Œæ¥æ”¹å˜ç»“æœã€‚é¡¶ç‚¹ç€è‰²å™¨è¿˜ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæœ‰è¶£çš„è¾“å…¥å˜é‡ï¼Œæˆ‘ä»¬åªèƒ½å¯¹å®ƒè¿›è¡Œè¯»å–ï¼Œå®ƒå«åšgl_VertexIDã€‚</p><p>æ•´å‹å˜é‡gl_VertexIDå‚¨å­˜äº†æ­£åœ¨ç»˜åˆ¶é¡¶ç‚¹çš„å½“å‰IDã€‚å½“ï¼ˆä½¿ç”¨glDrawElementsï¼‰è¿›è¡Œç´¢å¼•æ¸²æŸ“çš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡ä¼šå­˜å‚¨æ­£åœ¨ç»˜åˆ¶é¡¶ç‚¹çš„å½“å‰ç´¢å¼•ã€‚å½“ï¼ˆä½¿ç”¨glDrawArraysï¼‰ä¸ä½¿ç”¨ç´¢å¼•è¿›è¡Œç»˜åˆ¶çš„æ—¶å€™ï¼Œè¿™ä¸ªå˜é‡ä¼šå‚¨å­˜ä»æ¸²æŸ“è°ƒç”¨å¼€å§‹çš„å·²å¤„ç†é¡¶ç‚¹æ•°é‡ã€‚</p><h4 id="ç‰‡æ®µç€è‰²å™¨å˜é‡">ç‰‡æ®µç€è‰²å™¨å˜é‡</h4><p>GLSLæä¾›ç»™æˆ‘ä»¬ä¸¤ä¸ªæœ‰è¶£çš„è¾“å…¥å˜é‡ï¼šgl_FragCoordå’Œgl_FrontFacingã€‚</p><ol type="1"><li>gl_FragCoordçš„xå’Œyåˆ†é‡æ˜¯ç‰‡æ®µçš„çª—å£ç©ºé—´(Window-space)åæ ‡ï¼Œå…¶åŸç‚¹ä¸ºçª—å£çš„å·¦ä¸‹è§’ã€‚æˆ‘ä»¬å·²ç»ä½¿ç”¨glViewportè®¾å®šäº†ä¸€ä¸ª800x600çš„çª—å£äº†ï¼Œæ‰€ä»¥ç‰‡æ®µçª—å£ç©ºé—´åæ ‡çš„xåˆ†é‡å°†åœ¨0åˆ°800ä¹‹é—´ï¼Œyåˆ†é‡åœ¨0åˆ°600ä¹‹é—´ã€‚</li></ol><p>//ä¾‹å¦‚:</p><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span>             </span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>gl_FragCoord<span class="op">.</span>x <span class="op">&lt;</span> <span class="dv">400</span><span class="op">)</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>            FragColor <span class="op">=</span> vec4<span class="op">(</span><span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>            FragColor <span class="op">=</span> vec4<span class="op">(</span><span class="fl">0.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">,</span> <span class="fl">0.0</span><span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span>        </span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><p>ç‰‡æ®µç€è‰²å™¨å¦å¤–ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„è¾“å…¥å˜é‡æ˜¯gl_FrontFacingã€‚åœ¨é¢å‰”é™¤æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬æåˆ°OpenGLèƒ½å¤Ÿæ ¹æ®é¡¶ç‚¹çš„ç¯ç»•é¡ºåºæ¥å†³å®šä¸€ä¸ªé¢æ˜¯æ­£å‘è¿˜æ˜¯èƒŒå‘é¢ã€‚å¦‚æœæˆ‘ä»¬ä¸ï¼ˆå¯ç”¨GL_FACE_CULLæ¥ï¼‰ä½¿ç”¨é¢å‰”é™¤ï¼Œé‚£ä¹ˆgl_FrontFacingå°†ä¼šå‘Šè¯‰æˆ‘ä»¬å½“å‰ç‰‡æ®µæ˜¯å±äºæ­£å‘é¢çš„ä¸€éƒ¨åˆ†è¿˜æ˜¯èƒŒå‘é¢çš„ä¸€éƒ¨åˆ†ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¯¹æ­£å‘é¢è®¡ç®—å‡ºä¸åŒçš„é¢œè‰²ã€‚</p><ol start="2" type="1"><li>gl_FrontFacingå˜é‡æ˜¯ä¸€ä¸ªboolï¼Œå¦‚æœå½“å‰ç‰‡æ®µæ˜¯æ­£å‘é¢çš„ä¸€éƒ¨åˆ†é‚£ä¹ˆå°±æ˜¯trueï¼Œå¦åˆ™å°±æ˜¯falseã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å­åˆ›å»ºä¸€ä¸ªç«‹æ–¹ä½“ï¼Œåœ¨å†…éƒ¨å’Œå¤–éƒ¨ä½¿ç”¨ä¸åŒçš„çº¹ç†ï¼š</li></ol><p>//ä¾‹å¦‚</p><div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    out vec4 FragColor<span class="op">;</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    in vec2 TexCoords<span class="op">;</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    uniform sampler2D frontTexture<span class="op">;</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    uniform sampler2D backTexture<span class="op">;</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span>             </span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">(</span>gl_FrontFacing<span class="op">)</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>            FragColor <span class="op">=</span> texture<span class="op">(</span>frontTexture<span class="op">,</span> TexCoords<span class="op">);</span></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            FragColor <span class="op">=</span> texture<span class="op">(</span>backTexture<span class="op">,</span> TexCoords<span class="op">);</span></span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><ol start="3" type="1"><li>gl_FragDepthã€‚è¾“å…¥å˜é‡gl_FragCoordèƒ½è®©æˆ‘ä»¬è¯»å–å½“å‰ç‰‡æ®µçš„çª—å£ç©ºé—´åæ ‡ï¼Œå¹¶è·å–å®ƒçš„æ·±åº¦å€¼ï¼Œä½†æ˜¯å®ƒæ˜¯ä¸€ä¸ªåªè¯»(Read-only)å˜é‡ã€‚æˆ‘ä»¬ä¸èƒ½ä¿®æ”¹ç‰‡æ®µçš„çª—å£ç©ºé—´åæ ‡ï¼Œä½†å®é™…ä¸Šä¿®æ”¹ç‰‡æ®µçš„æ·±åº¦å€¼è¿˜æ˜¯å¯èƒ½çš„ã€‚GLSLæä¾›ç»™æˆ‘ä»¬ä¸€ä¸ªå«åšgl_FragDepthçš„è¾“å‡ºå˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥åœ¨ç€è‰²å™¨å†…è®¾ç½®ç‰‡æ®µçš„æ·±åº¦å€¼ã€‚</li></ol><p>è¦æƒ³è®¾ç½®æ·±åº¦å€¼ï¼Œæˆ‘ä»¬ç›´æ¥å†™å…¥ä¸€ä¸ª0.0åˆ°1.0ä¹‹é—´çš„floatå€¼åˆ°è¾“å‡ºå˜é‡å°±å¯ä»¥äº†ï¼š</p><div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>    gl_FragDepth <span class="op">=</span> <span class="fl">0.0</span><span class="op">;</span> <span class="co">// è¿™ä¸ªç‰‡æ®µç°åœ¨çš„æ·±åº¦å€¼ä¸º 0.0</span></span></code></pre></div><p>å¦‚æœç€è‰²å™¨æ²¡æœ‰å†™å…¥å€¼åˆ°gl_FragDepthï¼Œå®ƒä¼šè‡ªåŠ¨å–ç”¨gl_FragCoord.zçš„å€¼ã€‚</p><p>ç„¶è€Œï¼Œç”±æˆ‘ä»¬è‡ªå·±è®¾ç½®æ·±åº¦å€¼æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹ï¼Œåªè¦æˆ‘ä»¬åœ¨ç‰‡æ®µç€è‰²å™¨ä¸­å¯¹gl_FragDepthè¿›è¡Œå†™å…¥ï¼ŒOpenGLå°±ä¼šï¼ˆåƒæ·±åº¦æµ‹è¯•å°èŠ‚ä¸­è®¨è®ºçš„é‚£æ ·ï¼‰ç¦ç”¨æ‰€æœ‰çš„æå‰æ·±åº¦æµ‹è¯•(EarlyDepthTesting)ã€‚å®ƒè¢«ç¦ç”¨çš„åŸå› æ˜¯ï¼ŒOpenGLæ— æ³•åœ¨ç‰‡æ®µç€è‰²å™¨è¿è¡Œä¹‹å‰å¾—çŸ¥ç‰‡æ®µå°†æ‹¥æœ‰çš„æ·±åº¦å€¼ï¼Œå› ä¸ºç‰‡æ®µç€è‰²å™¨å¯èƒ½ä¼šå®Œå…¨ä¿®æ”¹è¿™ä¸ªæ·±åº¦å€¼ã€‚</p><p>åœ¨å†™å…¥gl_FragDepthæ—¶ï¼Œä½ å°±éœ€è¦è€ƒè™‘åˆ°å®ƒæ‰€å¸¦æ¥çš„æ€§èƒ½å½±å“ã€‚ç„¶è€Œï¼Œä»<code>OpenGL 4.2</code>èµ·ï¼Œæˆ‘ä»¬ä»å¯ä»¥å¯¹ä¸¤è€…è¿›è¡Œä¸€å®šçš„è°ƒå’Œï¼Œåœ¨ç‰‡æ®µç€è‰²å™¨çš„é¡¶éƒ¨ä½¿ç”¨æ·±åº¦æ¡ä»¶(DepthCondition)é‡æ–°å£°æ˜gl_FragDepthå˜é‡ï¼š</p><div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span><span class="va">depth_</span><span class="op">&lt;</span>condition<span class="op">&gt;)</span> out <span class="dt">float</span> gl_FragDepth<span class="op">;</span></span></code></pre></div><p><code>condition</code>å¯ä»¥ä¸ºä¸‹é¢çš„å€¼ï¼š |æ¡ä»¶ |æè¿°| |:- | :- | |any|é»˜è®¤å€¼ã€‚æå‰æ·±åº¦æµ‹è¯•æ˜¯ç¦ç”¨çš„ï¼Œä½ ä¼šæŸå¤±å¾ˆå¤šæ€§èƒ½| |greater |ä½ åªèƒ½è®©æ·±åº¦å€¼æ¯”gl_FragCoord.zæ›´å¤§| |less|ä½ åªèƒ½è®©æ·±åº¦å€¼æ¯”gl_FragCoord.zæ›´å°| |unchanged |å¦‚æœä½ è¦å†™å…¥gl_FragDepthï¼Œä½ å°†åªèƒ½å†™å…¥gl_FragCoord.zçš„å€¼|</p><h4 id="æ¥å£å—">æ¥å£å—</h4><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ¯å½“æˆ‘ä»¬å¸Œæœ›ä»é¡¶ç‚¹ç€è‰²å™¨å‘ç‰‡æ®µç€è‰²å™¨å‘é€æ•°æ®æ—¶ï¼Œæˆ‘ä»¬éƒ½å£°æ˜äº†å‡ ä¸ªå¯¹åº”çš„è¾“å…¥/è¾“å‡ºå˜é‡ã€‚å°†å®ƒä»¬ä¸€ä¸ªä¸€ä¸ªå£°æ˜æ˜¯ç€è‰²å™¨é—´å‘é€æ•°æ®æœ€ç®€å•çš„æ–¹å¼äº†ï¼Œä½†å½“ç¨‹åºå˜å¾—æ›´å¤§æ—¶ï¼Œä½ å¸Œæœ›å‘é€çš„å¯èƒ½å°±ä¸åªæ˜¯å‡ ä¸ªå˜é‡äº†ï¼Œå®ƒè¿˜å¯èƒ½åŒ…æ‹¬æ•°ç»„å’Œç»“æ„ä½“ã€‚</p><p>ä¸ºäº†å¸®åŠ©æˆ‘ä»¬ç®¡ç†è¿™äº›å˜é‡ï¼ŒGLSLä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå«åšæ¥å£å—(InterfaceBlock)çš„ä¸œè¥¿ï¼Œæ¥æ–¹ä¾¿æˆ‘ä»¬ç»„åˆè¿™äº›å˜é‡ã€‚æ¥å£å—çš„å£°æ˜å’Œstructçš„å£°æ˜æœ‰ç‚¹ç›¸åƒï¼Œä¸åŒçš„æ˜¯ï¼Œç°åœ¨æ ¹æ®å®ƒæ˜¯ä¸€ä¸ªè¾“å…¥è¿˜æ˜¯è¾“å‡ºå—(Block)ï¼Œä½¿ç”¨inæˆ–outå…³é”®å­—æ¥å®šä¹‰çš„</p><p>é¡¶ç‚¹ç€è‰²å™¨</p><div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">0</span><span class="op">)</span> in vec3 aPos<span class="op">;</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">1</span><span class="op">)</span> in vec2 aTexCoords<span class="op">;</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    uniform mat4 model<span class="op">;</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    uniform mat4 view<span class="op">;</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    uniform mat4 projection<span class="op">;</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    out VS_OUT</span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        vec2 TexCoords<span class="op">;</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> vs_out<span class="op">;</span></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        gl_Position <span class="op">=</span> projection <span class="op">*</span> view <span class="op">*</span> model <span class="op">*</span> vec4<span class="op">(</span>aPos<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span>    </span><span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        vs_out<span class="op">.</span>TexCoords <span class="op">=</span> aTexCoords<span class="op">;</span></span><span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  </span></code></pre></div><p>ä¹‹åï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨ä¸‹ä¸€ä¸ªç€è‰²å™¨ï¼Œå³ç‰‡æ®µç€è‰²å™¨ï¼Œä¸­å®šä¹‰ä¸€ä¸ªè¾“å…¥æ¥å£å—ã€‚å—å(BlockName)åº”è¯¥æ˜¯å’Œç€è‰²å™¨ä¸­ä¸€æ ·çš„ï¼ˆVS_OUTï¼‰ï¼Œä½†å®ä¾‹å(InstanceName)ï¼ˆé¡¶ç‚¹ç€è‰²å™¨ä¸­ç”¨çš„æ˜¯vs_outï¼‰å¯ä»¥æ˜¯éšæ„çš„ï¼Œä½†è¦é¿å…ä½¿ç”¨è¯¯å¯¼æ€§çš„åç§°ï¼Œæ¯”å¦‚å¯¹å®é™…ä¸ŠåŒ…å«è¾“å…¥å˜é‡çš„æ¥å£å—å‘½åä¸ºvs_outã€‚</p><div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    out vec4 FragColor<span class="op">;</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    in VS_OUT</span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        vec2 TexCoords<span class="op">;</span></span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> fs_in<span class="op">;</span></span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    uniform sampler2D texture<span class="op">;</span></span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span>             </span><span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> texture<span class="op">(</span>texture<span class="op">,</span> fs_in<span class="op">.</span>TexCoords<span class="op">);</span>   </span><span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><p>åªè¦ä¸¤ä¸ªæ¥å£å—çš„åå­—ä¸€æ ·ï¼Œå®ƒä»¬å¯¹åº”çš„è¾“å…¥å’Œè¾“å‡ºå°†ä¼šåŒ¹é…èµ·æ¥ã€‚è¿™æ˜¯å¸®åŠ©ä½ ç®¡ç†ä»£ç çš„åˆä¸€ä¸ªæœ‰ç”¨ç‰¹æ€§ï¼Œå®ƒåœ¨å‡ ä½•ç€è‰²å™¨è¿™æ ·ç©¿æ’ç‰¹å®šç€è‰²å™¨é˜¶æ®µçš„åœºæ™¯ä¸‹ä¼šå¾ˆæœ‰ç”¨ã€‚</p><h4 id="uniformç¼“å†²å¯¹è±¡">Uniformç¼“å†²å¯¹è±¡</h4><p>æˆ‘ä»¬å·²ç»ä½¿ç”¨OpenGLå¾ˆé•¿æ—¶é—´äº†ï¼Œå­¦ä¼šäº†ä¸€äº›å¾ˆé…·çš„æŠ€å·§ï¼Œä½†ä¹Ÿé‡åˆ°äº†ä¸€äº›å¾ˆéº»çƒ¦çš„åœ°æ–¹ã€‚æ¯”å¦‚è¯´ï¼Œå½“ä½¿ç”¨å¤šäºä¸€ä¸ªçš„ç€è‰²å™¨æ—¶ï¼Œå°½ç®¡å¤§éƒ¨åˆ†çš„uniformå˜é‡éƒ½æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦ä¸æ–­åœ°è®¾ç½®å®ƒä»¬ï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆéº»çƒ¦åœ°é‡OpenGLä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå«åšUniformç¼“å†²å¯¹è±¡(Uniform BufferObject)çš„å·¥å…·ï¼Œå®ƒå…è®¸æˆ‘ä»¬å®šä¹‰ä¸€ç³»åˆ—åœ¨å¤šä¸ªç€è‰²å™¨ä¸­ç›¸åŒçš„å…¨å±€Uniformå˜é‡ã€‚å½“ä½¿ç”¨Uniformç¼“å†²å¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦è®¾ç½®ç›¸å…³çš„uniformä¸€æ¬¡ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬ä»éœ€è¦æ‰‹åŠ¨è®¾ç½®æ¯ä¸ªç€è‰²å™¨ä¸­ä¸åŒçš„uniformã€‚å¹¶ä¸”åˆ›å»ºå’Œé…ç½®Uniformç¼“å†²å¯¹è±¡ä¼šæœ‰ä¸€ç‚¹ç¹çã€‚</p><p>å› ä¸ºUniformç¼“å†²å¯¹è±¡ä»æ˜¯ä¸€ä¸ªç¼“å†²ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨glGenBuffersæ¥åˆ›å»ºå®ƒï¼Œå°†å®ƒç»‘å®šåˆ°GL_UNIFORM_BUFFERç¼“å†²ç›®æ ‡ï¼Œå¹¶å°†æ‰€æœ‰ç›¸å…³çš„uniformæ•°æ®å­˜å…¥ç¼“å†²ã€‚åœ¨Uniformç¼“å†²å¯¹è±¡ä¸­å‚¨å­˜æ•°æ®æ˜¯æœ‰ä¸€äº›è§„åˆ™çš„ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨ä¹‹åè®¨è®ºå®ƒã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„é¡¶ç‚¹ç€è‰²å™¨ï¼Œå°†projectionå’ŒviewçŸ©é˜µå­˜å‚¨åˆ°æ‰€è°“çš„Uniformå—(UniformBlock)ä¸­ï¼š</p><div class="sourceCode" id="cb9"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">0</span><span class="op">)</span> in vec3 aPos<span class="op">;</span></span><span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>std140<span class="op">)</span> uniform Matrices</span><span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        mat4 projection<span class="op">;</span></span><span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>        mat4 view<span class="op">;</span></span><span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    uniform mat4 model<span class="op">;</span></span><span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        gl_Position <span class="op">=</span> projection <span class="op">*</span> view <span class="op">*</span> model <span class="op">*</span> vec4<span class="op">(</span>aPos<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><p>åœ¨æˆ‘ä»¬å¤§å¤šæ•°çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šåœ¨æ¯ä¸ªæ¸²æŸ“è¿­ä»£ä¸­ï¼Œå¯¹æ¯ä¸ªç€è‰²å™¨è®¾ç½®projectionå’ŒviewUniformçŸ©é˜µã€‚è¿™æ˜¯åˆ©ç”¨Uniformç¼“å†²å¯¹è±¡çš„ä¸€ä¸ªéå¸¸å®Œç¾çš„ä¾‹å­ï¼Œå› ä¸ºç°åœ¨æˆ‘ä»¬åªéœ€è¦å­˜å‚¨è¿™äº›çŸ©é˜µä¸€æ¬¡å°±å¯ä»¥äº†ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªå«åšMatricesçš„Uniformå—ï¼Œå®ƒå‚¨å­˜äº†ä¸¤ä¸ª4x4çŸ©é˜µã€‚Uniformå—ä¸­çš„å˜é‡å¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦åŠ å—åä½œä¸ºå‰ç¼€ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨OpenGLä»£ç ä¸­å°†è¿™äº›çŸ©é˜µå€¼å­˜å…¥ç¼“å†²ä¸­ï¼Œæ¯ä¸ªå£°æ˜äº†è¿™ä¸ªUniformå—çš„ç€è‰²å™¨éƒ½èƒ½å¤Ÿè®¿é—®è¿™äº›çŸ©é˜µã€‚</p><p>ä½ ç°åœ¨å¯èƒ½ä¼šåœ¨æƒ³layout(std140)è¿™ä¸ªè¯­å¥æ˜¯ä»€ä¹ˆæ„æ€ã€‚å®ƒçš„æ„æ€æ˜¯è¯´ï¼Œå½“å‰å®šä¹‰çš„Uniformå—å¯¹å®ƒçš„å†…å®¹ä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„å†…å­˜å¸ƒå±€ã€‚è¿™ä¸ªè¯­å¥è®¾ç½®äº†Uniformå—å¸ƒå±€(UniformBlock Layout)ã€‚</p><h4 id="uniformå—å¸ƒå±€">Uniformå—å¸ƒå±€</h4><p>Uniformå—çš„å†…å®¹æ˜¯å‚¨å­˜åœ¨ä¸€ä¸ªç¼“å†²å¯¹è±¡ä¸­çš„ï¼Œå®ƒå®é™…ä¸Šåªæ˜¯ä¸€å—é¢„ç•™å†…å­˜ã€‚å› ä¸ºè¿™å—å†…å­˜å¹¶ä¸ä¼šä¿å­˜å®ƒå…·ä½“ä¿å­˜çš„æ˜¯ä»€ä¹ˆç±»å‹çš„æ•°æ®ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å‘Šè¯‰OpenGLå†…å­˜çš„å“ªä¸€éƒ¨åˆ†å¯¹åº”ç€ç€è‰²å™¨ä¸­çš„å“ªä¸€ä¸ªuniformå˜é‡ã€‚</p><p>å‡è®¾ç€è‰²å™¨ä¸­æœ‰ä»¥ä¸‹çš„è¿™ä¸ªUniformå—ï¼š</p><div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>std140<span class="op">)</span> uniform ExampleBlock</span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> value<span class="op">;</span></span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>        vec3  vector<span class="op">;</span></span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>        mat4  matrix<span class="op">;</span></span><span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> values<span class="op">[</span><span class="dv">3</span><span class="op">];</span></span><span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span>  boolean<span class="op">;</span></span><span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span>   integer<span class="op">;</span></span><span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒGLSLä¼šä½¿ç”¨ä¸€ä¸ªå«åšå…±äº«(Shared)å¸ƒå±€çš„Uniformå†…å­˜å¸ƒå±€ï¼Œå…±äº«æ˜¯å› ä¸ºä¸€æ—¦ç¡¬ä»¶å®šä¹‰äº†åç§»é‡ï¼Œå®ƒä»¬åœ¨å¤šä¸ªç¨‹åºä¸­æ˜¯å…±äº«å¹¶ä¸€è‡´çš„ã€‚ä½¿ç”¨å…±äº«å¸ƒå±€æ—¶ï¼ŒGLSLæ˜¯å¯ä»¥ä¸ºäº†ä¼˜åŒ–è€Œå¯¹uniformå˜é‡çš„ä½ç½®è¿›è¡Œå˜åŠ¨çš„ï¼Œåªè¦å˜é‡çš„é¡ºåºä¿æŒä¸å˜ã€‚å› ä¸ºæˆ‘ä»¬æ— æ³•çŸ¥é“æ¯ä¸ªuniformå˜é‡çš„åç§»é‡ï¼Œæˆ‘ä»¬ä¹Ÿå°±ä¸çŸ¥é“å¦‚ä½•å‡†ç¡®åœ°å¡«å……æˆ‘ä»¬çš„Uniformç¼“å†²äº†ã€‚æˆ‘ä»¬èƒ½å¤Ÿä½¿ç”¨åƒæ˜¯glGetUniformIndicesè¿™æ ·çš„å‡½æ•°æ¥æŸ¥è¯¢è¿™ä¸ªä¿¡æ¯ï¼Œä½†è¿™è¶…å‡ºæœ¬èŠ‚çš„èŒƒå›´äº†ã€‚</p><p>è™½ç„¶å…±äº«å¸ƒå±€ç»™äº†æˆ‘ä»¬å¾ˆå¤šèŠ‚çœç©ºé—´çš„ä¼˜åŒ–ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦æŸ¥è¯¢æ¯ä¸ªuniformå˜é‡çš„åç§»é‡ï¼Œè¿™ä¼šäº§ç”Ÿéå¸¸å¤šçš„å·¥ä½œé‡ã€‚é€šå¸¸çš„åšæ³•æ˜¯ï¼Œä¸ä½¿ç”¨å…±äº«å¸ƒå±€ï¼Œè€Œæ˜¯ä½¿ç”¨std140å¸ƒå±€ã€‚std140å¸ƒå±€å£°æ˜äº†æ¯ä¸ªå˜é‡çš„åç§»é‡éƒ½æ˜¯ç”±ä¸€ç³»åˆ—è§„åˆ™æ‰€å†³å®šçš„ï¼Œè¿™æ˜¾å¼åœ°å£°æ˜äº†æ¯ä¸ªå˜é‡ç±»å‹çš„å†…å­˜å¸ƒå±€ã€‚ç”±äºè¿™æ˜¯æ˜¾å¼æåŠçš„ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è®¡ç®—å‡ºæ¯ä¸ªå˜é‡çš„åç§»é‡ã€‚</p><p>æ¯ä¸ªå˜é‡éƒ½æœ‰ä¸€ä¸ªåŸºå‡†å¯¹é½é‡(BaseAlignment)ï¼Œå®ƒç­‰äºä¸€ä¸ªå˜é‡åœ¨Uniformå—ä¸­æ‰€å æ®çš„ç©ºé—´ï¼ˆåŒ…æ‹¬å¡«å……é‡(Padding)ï¼‰ï¼Œè¿™ä¸ªåŸºå‡†å¯¹é½é‡æ˜¯ä½¿ç”¨std140å¸ƒå±€çš„è§„åˆ™è®¡ç®—å‡ºæ¥çš„ã€‚æ¥ä¸‹æ¥ï¼Œå¯¹æ¯ä¸ªå˜é‡ï¼Œæˆ‘ä»¬å†è®¡ç®—å®ƒçš„å¯¹é½åç§»é‡(AlignedOffset)ï¼Œå®ƒæ˜¯ä¸€ä¸ªå˜é‡ä»å—èµ·å§‹ä½ç½®çš„å­—èŠ‚åç§»é‡ã€‚ä¸€ä¸ªå˜é‡çš„å¯¹é½å­—èŠ‚åç§»é‡å¿…é¡»ç­‰äºåŸºå‡†å¯¹é½é‡çš„å€æ•°ã€‚</p><p>å¸ƒå±€è§„åˆ™çš„åŸæ–‡å¯ä»¥åœ¨OpenGLçš„Uniformç¼“å†²è§„èŒƒè¿™é‡Œæ‰¾åˆ°ï¼Œä½†æˆ‘ä»¬å°†ä¼šåœ¨ä¸‹é¢åˆ—å‡ºæœ€å¸¸è§çš„è§„åˆ™ã€‚GLSLä¸­çš„æ¯ä¸ªå˜é‡ï¼Œæ¯”å¦‚è¯´intã€floatå’Œboolï¼Œéƒ½è¢«å®šä¹‰ä¸º4å­—èŠ‚é‡ã€‚æ¯4ä¸ªå­—èŠ‚å°†ä¼šç”¨ä¸€ä¸ªNæ¥è¡¨ç¤ºã€‚</p><table><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr class="header"><th style="text-align: left;">ç±»å‹</th><th style="text-align: left;">å¸ƒå±€è§„åˆ™</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">æ ‡é‡ï¼Œæ¯”å¦‚intå’Œbool</td><td style="text-align: left;">æ¯ä¸ªæ ‡é‡çš„åŸºå‡†å¯¹é½é‡ä¸ºNã€‚</td></tr><tr class="even"><td style="text-align: left;">å‘é‡</td><td style="text-align: left;">2Næˆ–è€…4Nã€‚è¿™æ„å‘³ç€vec3çš„åŸºå‡†å¯¹é½é‡ä¸º4Nã€‚</td></tr><tr class="odd"><td style="text-align: left;">æ ‡é‡æˆ–å‘é‡çš„æ•°ç»„</td><td style="text-align: left;">æ¯ä¸ªå…ƒç´ çš„åŸºå‡†å¯¹é½é‡ä¸vec4çš„ç›¸åŒã€‚</td></tr><tr class="even"><td style="text-align: left;">çŸ©é˜µ</td><td style="text-align: left;">å‚¨å­˜ä¸ºåˆ—å‘é‡çš„æ•°ç»„ï¼Œæ¯ä¸ªå‘é‡çš„åŸºå‡†å¯¹é½é‡ä¸vec4çš„ç›¸åŒã€‚</td></tr><tr class="odd"><td style="text-align: left;">ç»“æ„ä½“</td><td style="text-align: left;">ç­‰äºæ‰€æœ‰å…ƒç´ æ ¹æ®è§„åˆ™è®¡ç®—åçš„å¤§å°ï¼Œä½†ä¼šå¡«å……åˆ°vec4å¤§å°çš„å€æ•°ã€‚</td></tr></tbody></table><p>å’ŒOpenGLå¤§å¤šæ•°çš„è§„èŒƒä¸€æ ·ï¼Œä½¿ç”¨ä¾‹å­å°±èƒ½æ›´å®¹æ˜“åœ°ç†è§£ã€‚æˆ‘ä»¬ä¼šä½¿ç”¨ä¹‹å‰å¼•å…¥çš„é‚£ä¸ªå«åšExampleBlockçš„Uniformå—ï¼Œå¹¶ä½¿ç”¨std140å¸ƒå±€è®¡ç®—å‡ºæ¯ä¸ªæˆå‘˜çš„å¯¹é½åç§»é‡ï¼š</p><div class="sourceCode" id="cb11"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>    layout <span class="op">(</span>std140<span class="op">)</span> uniform ExampleBlock</span><span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>                         <span class="co">// åŸºå‡†å¯¹é½é‡       // å¯¹é½åç§»é‡</span></span><span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> value<span class="op">;</span>     <span class="co">// 4               // 0 </span></span><span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        vec3 vector<span class="op">;</span>     <span class="co">// 16              // 16  (å¿…é¡»æ˜¯16çš„å€æ•°ï¼Œæ‰€ä»¥ 4-&gt;16)</span></span><span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        mat4 matrix<span class="op">;</span>     <span class="co">// 16              // 32  (åˆ— 0)</span></span><span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                         <span class="co">// 16              // 48  (åˆ— 1)</span></span><span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                         <span class="co">// 16              // 64  (åˆ— 2)</span></span><span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                         <span class="co">// 16              // 80  (åˆ— 3)</span></span><span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> values<span class="op">[</span><span class="dv">3</span><span class="op">];</span> <span class="co">// 16              // 96  (values[0])  //**`æ•°ç»„å’Œvec4ç›¸åŒ`**</span></span><span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>                         <span class="co">// 16              // 112 (values[1])</span></span><span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>                         <span class="co">// 16              // 128 (values[2])</span></span><span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> boolean<span class="op">;</span>    <span class="co">// 4               // 144</span></span><span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> integer<span class="op">;</span>     <span class="co">// 4               // 148</span></span><span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span> </span></code></pre></div><p>ä½¿ç”¨è®¡ç®—åçš„åç§»é‡å€¼ï¼Œæ ¹æ®std140å¸ƒå±€çš„è§„åˆ™ï¼Œæˆ‘ä»¬å°±èƒ½ä½¿ç”¨åƒæ˜¯glBufferSubDataçš„å‡½æ•°å°†å˜é‡æ•°æ®æŒ‰ç…§åç§»é‡å¡«å……è¿›ç¼“å†²ä¸­äº†ã€‚è™½ç„¶std140å¸ƒå±€ä¸æ˜¯æœ€é«˜æ•ˆçš„å¸ƒå±€ï¼Œä½†å®ƒä¿è¯äº†å†…å­˜å¸ƒå±€åœ¨æ¯ä¸ªå£°æ˜äº†è¿™ä¸ªUniformå—çš„ç¨‹åºä¸­æ˜¯ä¸€è‡´çš„ã€‚é€šè¿‡åœ¨Uniformå—å®šä¹‰ä¹‹å‰æ·»åŠ layout(std140)è¯­å¥ï¼Œæˆ‘ä»¬å‘Šè¯‰OpenGLè¿™ä¸ªUniformå—ä½¿ç”¨çš„æ˜¯std140å¸ƒå±€ã€‚é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥é€‰æ‹©ä¸¤ä¸ªå¸ƒå±€ï¼Œä½†å®ƒä»¬éƒ½éœ€è¦æˆ‘ä»¬åœ¨å¡«å……ç¼“å†²ä¹‹å‰å…ˆæŸ¥è¯¢æ¯ä¸ªåç§»é‡ã€‚æˆ‘ä»¬å·²ç»è§è¿‡sharedå¸ƒå±€äº†ï¼Œå‰©ä¸‹çš„ä¸€ä¸ªå¸ƒå±€æ˜¯packedã€‚å½“ä½¿ç”¨ç´§å‡‘(Packed)å¸ƒå±€æ—¶ï¼Œæ˜¯ä¸èƒ½ä¿è¯è¿™ä¸ªå¸ƒå±€åœ¨æ¯ä¸ªç¨‹åºä¸­ä¿æŒä¸å˜çš„ï¼ˆå³éå…±äº«ï¼‰ï¼Œå› ä¸ºå®ƒå…è®¸ç¼–è¯‘å™¨å»å°†uniformå˜é‡ä»Uniformå—ä¸­ä¼˜åŒ–æ‰ï¼Œè¿™åœ¨æ¯ä¸ªç€è‰²å™¨ä¸­éƒ½å¯èƒ½æ˜¯ä¸åŒçš„ã€‚</p><h4 id="ä½¿ç”¨uniformç¼“å†²">ä½¿ç”¨Uniformç¼“å†²</h4><blockquote><p>ä¸»è¦æ­¥éª¤ï¼š 1. åŸºæœ¬ä¿¡æ¯è®¾ç½®vao vboç­‰ï¼Œ2.è·å–shaderä¸­uniformå—idï¼Œå¹¶å°†idç»‘å®šåˆ°ç»‘å®šç‚¹ä¸Š3.åˆ›å»ºå—bufferå¯¹è±¡(GL_UNIFORM_BUFFERç±»å‹)ã€ç”³è¯·è¶³å¤Ÿå†…å­˜ï¼Œæš‚æ—¶ä¸èµ‹å€¼æ•°æ®ï¼ˆglBufferDataï¼‰ã€‚ã€‚4. å®šä¹‰ç»‘å®šç‚¹ï¼ˆglBindBufferRange/glBindBufferBaseï¼‰ 5. å¯¹bufferæ›´æ–°æ•°æ®ï¼ˆbindbufferã€glBufferSubDataï¼‰ã€‚</p></blockquote><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨glGenBuffersï¼Œåˆ›å»ºä¸€ä¸ªUniformç¼“å†²å¯¹è±¡ã€‚ä¸€æ—¦æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªç¼“å†²å¯¹è±¡ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒç»‘å®šåˆ°GL_UNIFORM_BUFFERç›®æ ‡ï¼Œå¹¶è°ƒç”¨glBufferDataï¼Œåˆ†é…è¶³å¤Ÿçš„å†…å­˜ã€‚</p><div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> uboExampleBlock<span class="op">;</span></span><span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>uboExampleBlock<span class="op">);</span></span><span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_UNIFORM_BUFFER<span class="op">,</span> uboExampleBlock<span class="op">);</span></span><span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    glBufferData<span class="op">(</span>GL_UNIFORM_BUFFER<span class="op">,</span> <span class="dv">152</span><span class="op">,</span> NULL<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span> <span class="co">// åˆ†é…152å­—èŠ‚çš„å†…å­˜</span></span><span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_UNIFORM_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span></code></pre></div><p>ç°åœ¨ï¼Œæ¯å½“æˆ‘ä»¬éœ€è¦å¯¹ç¼“å†²æ›´æ–°æˆ–è€…æ’å…¥æ•°æ®ï¼Œæˆ‘ä»¬éƒ½ä¼šç»‘å®šåˆ°uboExampleBlockï¼Œå¹¶ä½¿ç”¨glBufferSubDataæ¥æ›´æ–°å®ƒçš„å†…å­˜ã€‚æˆ‘ä»¬åªéœ€è¦æ›´æ–°è¿™ä¸ªUniformç¼“å†²ä¸€æ¬¡ï¼Œæ‰€æœ‰ä½¿ç”¨è¿™ä¸ªç¼“å†²çš„ç€è‰²å™¨å°±éƒ½ä½¿ç”¨çš„æ˜¯æ›´æ–°åçš„æ•°æ®äº†ã€‚ä½†æ˜¯ï¼Œå¦‚ä½•æ‰èƒ½è®©OpenGLçŸ¥é“å“ªä¸ªUniformç¼“å†²å¯¹åº”çš„æ˜¯å“ªä¸ªUniformå—å‘¢ï¼Ÿ</p><p>åœ¨OpenGLä¸Šä¸‹æ–‡ä¸­ï¼Œå®šä¹‰äº†ä¸€äº›ç»‘å®šç‚¹(BindingPoint)ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªUniformç¼“å†²é“¾æ¥è‡³å®ƒã€‚åœ¨åˆ›å»ºUniformç¼“å†²ä¹‹åï¼Œæˆ‘ä»¬å°†å®ƒç»‘å®šåˆ°å…¶ä¸­ä¸€ä¸ªç»‘å®šç‚¹ä¸Šï¼Œå¹¶å°†ç€è‰²å™¨ä¸­çš„Uniformå—ç»‘å®šåˆ°ç›¸åŒçš„ç»‘å®šç‚¹ï¼ŒæŠŠå®ƒä»¬è¿æ¥åˆ°ä¸€èµ·ã€‚ä¸‹é¢çš„è¿™ä¸ªå›¾ç¤ºå±•ç¤ºäº†è¿™ä¸ªï¼š</p><p>ï¼<a href="/Sources/imgs/advanced_glsl_binding_points.png"></a></p><p>ä¸ºäº†å°†Uniformå—ç»‘å®šåˆ°ä¸€ä¸ªç‰¹å®šçš„ç»‘å®šç‚¹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨glUniformBlockBindingå‡½æ•°ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªç¨‹åºå¯¹è±¡ï¼Œä¹‹åæ˜¯ä¸€ä¸ªUniformå—ç´¢å¼•å’Œé“¾æ¥åˆ°çš„ç»‘å®šç‚¹ã€‚Uniformå—ç´¢å¼•(UniformBlockIndex)æ˜¯ç€è‰²å™¨ä¸­å·²å®šä¹‰Uniformå—çš„ä½ç½®å€¼ç´¢å¼•ã€‚è¿™å¯ä»¥é€šè¿‡è°ƒç”¨glGetUniformBlockIndexæ¥è·å–ï¼Œå®ƒæ¥å—ä¸€ä¸ªç¨‹åºå¯¹è±¡å’ŒUniformå—çš„åç§°ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼å°†å›¾ç¤ºä¸­çš„LightsUniformå—é“¾æ¥åˆ°ç»‘å®šç‚¹2ï¼š</p><div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> lights_index <span class="op">=</span> glGetUniformBlockIndex<span class="op">(</span>shaderA<span class="op">.</span>ID<span class="op">,</span> <span class="st">"Lights"</span><span class="op">);</span>   </span><span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    glUniformBlockBinding<span class="op">(</span>shaderA<span class="op">.</span>ID<span class="op">,</span> lights_index<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span></code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç»‘å®šUniformç¼“å†²å¯¹è±¡åˆ°ç›¸åŒçš„ç»‘å®šç‚¹ä¸Šï¼Œè¿™å¯ä»¥ä½¿ç”¨glBindBufferBaseæˆ–glBindBufferRangeæ¥å®Œæˆã€‚</p><div class="sourceCode" id="cb14"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>    glBindBufferBase<span class="op">(</span>GL_UNIFORM_BUFFER<span class="op">,</span> <span class="dv">2</span><span class="op">,</span> uboExampleBlock<span class="op">);</span> </span><span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// æˆ– ç»‘å®šç‚¹ã€bufferï¼Œèµ·å§‹ä½ç½®ã€å¤§å°</span></span><span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    glBindBufferRange<span class="op">(</span>GL_UNIFORM_BUFFER<span class="op">,</span> <span class="dv">2</span><span class="op">,</span> uboExampleBlock<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">152</span><span class="op">);</span></span></code></pre></div><p>æ›´æ–°ç¼“å†²</p><div class="sourceCode" id="cb15"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_UNIFORM_BUFFER<span class="op">,</span> uboExampleBlock<span class="op">);</span></span><span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> b <span class="op">=</span> <span class="kw">true</span><span class="op">;</span> <span class="co">// GLSLä¸­çš„boolæ˜¯4å­—èŠ‚çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å®ƒå­˜ä¸ºä¸€ä¸ªinteger</span></span><span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    glBufferSubData<span class="op">(</span>GL_UNIFORM_BUFFER<span class="op">,</span> <span class="dv">144</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="op">&amp;</span>b<span class="op">);</span> </span><span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_UNIFORM_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span></code></pre></div><p>Uniformç¼“å†²å¯¹è±¡æ¯”èµ·ç‹¬ç«‹çš„uniformæœ‰å¾ˆå¤šå¥½å¤„ã€‚ç¬¬ä¸€ï¼Œä¸€æ¬¡è®¾ç½®å¾ˆå¤šuniformä¼šæ¯”ä¸€ä¸ªä¸€ä¸ªè®¾ç½®å¤šä¸ªuniformè¦å¿«å¾ˆå¤šã€‚ç¬¬äºŒï¼Œæ¯”èµ·åœ¨å¤šä¸ªç€è‰²å™¨ä¸­ä¿®æ”¹åŒæ ·çš„uniformï¼Œåœ¨Uniformç¼“å†²ä¸­ä¿®æ”¹ä¸€æ¬¡ä¼šæ›´å®¹æ˜“ä¸€äº›ã€‚æœ€åä¸€ä¸ªå¥½å¤„å¯èƒ½ä¸ä¼šç«‹å³æ˜¾ç°ï¼Œå¦‚æœä½¿ç”¨Uniformç¼“å†²å¯¹è±¡çš„è¯ï¼Œä½ å¯ä»¥åœ¨ç€è‰²å™¨ä¸­ä½¿ç”¨æ›´å¤šçš„uniformã€‚OpenGLé™åˆ¶äº†å®ƒèƒ½å¤Ÿå¤„ç†çš„uniformæ•°é‡ï¼Œè¿™å¯ä»¥é€šè¿‡GL_MAX_VERTEX_UNIFORM_COMPONENTSæ¥æŸ¥è¯¢ã€‚å½“ä½¿ç”¨Uniformç¼“å†²å¯¹è±¡æ—¶ï¼Œæœ€å¤§çš„æ•°é‡ä¼šæ›´é«˜ã€‚æ‰€ä»¥ï¼Œå½“ä½ è¾¾åˆ°äº†uniformçš„æœ€å¤§æ•°é‡æ—¶ï¼ˆæ¯”å¦‚å†åšéª¨éª¼åŠ¨ç”»(SkeletalAnimation)çš„æ—¶å€™ï¼‰ï¼Œä½ æ€»æ˜¯å¯ä»¥é€‰æ‹©ä½¿ç”¨Uniformç¼“å†²å¯¹è±¡ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/04-gao-ji-opengl/07.gao-ji-shu-ju/"/>
      <url>/2022/08/10/opengl/04-gao-ji-opengl/07.gao-ji-shu-ju/</url>
      
        <content type="html"><![CDATA[<h2 id="é«˜çº§æ•°æ®">é«˜çº§æ•°æ®</h2><h3 id="åŸºæœ¬ä»‹ç»">åŸºæœ¬ä»‹ç»</h3><p>OpenGLä¸­çš„ç¼“å†²åªæ˜¯ä¸€ä¸ªç®¡ç†ç‰¹å®šå†…å­˜å—çš„å¯¹è±¡ï¼Œæ²¡æœ‰å…¶å®ƒæ›´å¤šçš„åŠŸèƒ½äº†ã€‚åœ¨æˆ‘ä»¬å°†å®ƒç»‘å®šåˆ°ä¸€ä¸ªç¼“å†²ç›®æ ‡(BufferTarget)æ—¶ï¼Œæˆ‘ä»¬æ‰èµ‹äºˆäº†å…¶æ„ä¹‰ã€‚å½“æˆ‘ä»¬ç»‘å®šä¸€ä¸ªç¼“å†²åˆ°GL_ARRAY_BUFFERæ—¶ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªé¡¶ç‚¹æ•°ç»„ç¼“å†²ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°å°†å…¶ç»‘å®šåˆ°GL_ELEMENT_ARRAY_BUFFERã€‚OpenGLå†…éƒ¨ä¼šä¸ºæ¯ä¸ªç›®æ ‡å‚¨å­˜ä¸€ä¸ªç¼“å†²ï¼Œå¹¶ä¸”ä¼šæ ¹æ®ç›®æ ‡çš„ä¸åŒï¼Œä»¥ä¸åŒçš„æ–¹å¼å¤„ç†ç¼“å†²ã€‚</p><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´æ˜¯è°ƒç”¨glBufferDataå‡½æ•°æ¥å¡«å……ç¼“å†²å¯¹è±¡æ‰€ç®¡ç†çš„å†…å­˜ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåˆ†é…ä¸€å—å†…å­˜ï¼Œå¹¶å°†æ•°æ®æ·»åŠ åˆ°è¿™å—å†…å­˜ä¸­ã€‚å¦‚æœæˆ‘ä»¬å°†å®ƒçš„dataå‚æ•°è®¾ç½®ä¸ºNULLï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°†åªä¼šåˆ†é…å†…å­˜ï¼Œä½†ä¸è¿›è¡Œå¡«å……ã€‚è¿™åœ¨æˆ‘ä»¬éœ€è¦é¢„ç•™(Reserve)ç‰¹å®šå¤§å°çš„å†…å­˜ï¼Œä¹‹åå›åˆ°è¿™ä¸ªç¼“å†²ä¸€ç‚¹ä¸€ç‚¹å¡«å……çš„æ—¶å€™ä¼šå¾ˆæœ‰ç”¨ã€‚</p><p>é™¤äº†ä½¿ç”¨ä¸€æ¬¡å‡½æ•°è°ƒç”¨å¡«å……æ•´ä¸ªç¼“å†²ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨glBufferSubDataï¼Œå¡«å……ç¼“å†²çš„ç‰¹å®šåŒºåŸŸã€‚è¿™ä¸ªå‡½æ•°éœ€è¦ä¸€ä¸ªç¼“å†²ç›®æ ‡ã€ä¸€ä¸ªåç§»é‡ã€æ•°æ®çš„å¤§å°å’Œæ•°æ®æœ¬èº«ä½œä¸ºå®ƒçš„å‚æ•°ã€‚è¿™ä¸ªå‡½æ•°ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªåç§»é‡ï¼ŒæŒ‡å®šä»ä½•å¤„å¼€å§‹å¡«å……è¿™ä¸ªç¼“å†²ã€‚è¿™èƒ½å¤Ÿè®©æˆ‘ä»¬æ’å…¥æˆ–è€…æ›´æ–°ç¼“å†²å†…å­˜çš„æŸä¸€éƒ¨åˆ†ã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œç¼“å†²éœ€è¦æœ‰è¶³å¤Ÿçš„å·²åˆ†é…å†…å­˜ï¼Œæ‰€ä»¥å¯¹ä¸€ä¸ªç¼“å†²è°ƒç”¨glBufferSubDataä¹‹å‰å¿…é¡»è¦å…ˆè°ƒç”¨glBufferDataã€‚</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    glBufferSubData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">24</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>data<span class="op">),</span> <span class="op">&amp;</span>data<span class="op">);</span> <span class="co">// èŒƒå›´ï¼š [24, 24 + sizeof(data)]</span></span></code></pre></div><p>è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•:</p><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> data<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>      <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.35</span><span class="bu">f</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> buffer<span class="op">);</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// è·å–æŒ‡é’ˆ</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="op">*</span>ptr <span class="op">=</span> glMapBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> GL_WRITE_ONLY<span class="op">);</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// å¤åˆ¶æ•°æ®åˆ°å†…å­˜</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    memcpy<span class="op">(</span>ptr<span class="op">,</span> data<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>data<span class="op">));</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// è®°å¾—å‘Šè¯‰OpenGLæˆ‘ä»¬ä¸å†éœ€è¦è¿™ä¸ªæŒ‡é’ˆäº†</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    glUnmapBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">);</span></span></code></pre></div><p>å¦‚æœè¦ç›´æ¥æ˜ å°„æ•°æ®åˆ°ç¼“å†²ï¼Œè€Œä¸äº‹å…ˆå°†å…¶å­˜å‚¨åˆ°ä¸´æ—¶å†…å­˜ä¸­ï¼ŒglMapBufferè¿™ä¸ªå‡½æ•°ä¼šå¾ˆæœ‰ç”¨ã€‚æ¯”å¦‚è¯´ï¼Œä½ å¯ä»¥ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼Œå¹¶ç›´æ¥å°†å®ƒä»¬å¤åˆ¶åˆ°ç¼“å†²å†…å­˜ä¸­ã€‚</p><h3 id="åˆ†æ‰¹é¡¶ç‚¹å±æ€§">åˆ†æ‰¹é¡¶ç‚¹å±æ€§</h3><p>é€šè¿‡ä½¿ç”¨glVertexAttribPointerï¼Œæˆ‘ä»¬èƒ½å¤ŸæŒ‡å®šé¡¶ç‚¹æ•°ç»„ç¼“å†²å†…å®¹çš„å±æ€§å¸ƒå±€ã€‚åœ¨é¡¶ç‚¹æ•°ç»„ç¼“å†²ä¸­ï¼Œæˆ‘ä»¬å¯¹å±æ€§è¿›è¡Œäº†äº¤é”™(Interleave)å¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å°†æ¯ä¸€ä¸ªé¡¶ç‚¹çš„ä½ç½®ã€å‘ç°å’Œ/æˆ–çº¹ç†åæ ‡ç´§å¯†æ”¾ç½®åœ¨ä¸€èµ·ã€‚æ—¢ç„¶æˆ‘ä»¬ç°åœ¨å·²ç»å¯¹ç¼“å†²æœ‰äº†æ›´å¤šçš„äº†è§£ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡å–å¦ä¸€ç§æ–¹å¼ã€‚</p><p>æˆ‘ä»¬å¯ä»¥åšçš„æ˜¯ï¼Œå°†æ¯ä¸€ç§å±æ€§ç±»å‹çš„å‘é‡æ•°æ®æ‰“åŒ…(Batch)ä¸ºä¸€ä¸ªå¤§çš„åŒºå—ï¼Œè€Œä¸æ˜¯å¯¹å®ƒä»¬è¿›è¡Œäº¤é”™å‚¨å­˜ã€‚ä¸äº¤é”™å¸ƒå±€123123123123ä¸åŒï¼Œæˆ‘ä»¬å°†é‡‡ç”¨åˆ†æ‰¹(Batched)çš„æ–¹å¼111122223333ã€‚</p><p>å½“ä»æ–‡ä»¶ä¸­åŠ è½½é¡¶ç‚¹æ•°æ®çš„æ—¶å€™ï¼Œä½ é€šå¸¸è·å–åˆ°çš„æ˜¯ä¸€ä¸ªä½ç½®æ•°ç»„ã€ä¸€ä¸ªæ³•çº¿æ•°ç»„å’Œ/æˆ–ä¸€ä¸ªçº¹ç†åæ ‡æ•°ç»„ã€‚æˆ‘ä»¬éœ€è¦èŠ±ç‚¹åŠ›æ°”æ‰èƒ½å°†è¿™äº›æ•°ç»„è½¬åŒ–ä¸ºä¸€ä¸ªå¤§çš„äº¤é”™æ•°æ®æ•°ç»„ã€‚ä½¿ç”¨åˆ†æ‰¹çš„æ–¹å¼ä¼šæ˜¯æ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“ä½¿ç”¨glBufferSubDataå‡½æ•°å®ç°ï¼š</p><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> positions<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span> <span class="op">...</span> <span class="op">};</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> normals<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span> <span class="op">...</span> <span class="op">};</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> tex<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span> <span class="op">...</span> <span class="op">};</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// å¡«å……ç¼“å†²</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    glBufferSubData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>positions<span class="op">),</span> <span class="op">&amp;</span>positions<span class="op">);</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    glBufferSubData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>positions<span class="op">),</span> <span class="kw">sizeof</span><span class="op">(</span>normals<span class="op">),</span> <span class="op">&amp;</span>normals<span class="op">);</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    glBufferSubData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>positions<span class="op">)</span> <span class="op">+</span> <span class="kw">sizeof</span><span class="op">(</span>normals<span class="op">),</span> <span class="kw">sizeof</span><span class="op">(</span>tex<span class="op">),</span> <span class="op">&amp;</span>tex<span class="op">);</span></span></code></pre></div><p>è¿™æ ·å­æˆ‘ä»¬å°±èƒ½ç›´æ¥å°†å±æ€§æ•°ç»„ä½œä¸ºä¸€ä¸ªæ•´ä½“ä¼ é€’ç»™ç¼“å†²ï¼Œè€Œä¸éœ€è¦äº‹å…ˆå¤„ç†å®ƒä»¬äº†ã€‚æˆ‘ä»¬ä»å¯ä»¥å°†å®ƒä»¬åˆå¹¶ä¸ºä¸€ä¸ªå¤§çš„æ•°ç»„ï¼Œå†ä½¿ç”¨glBufferDataæ¥å¡«å……ç¼“å†²ï¼Œä½†å¯¹äºè¿™ç§å·¥ä½œï¼Œä½¿ç”¨glBufferSubDataä¼šæ›´åˆé€‚ä¸€ç‚¹ã€‚æˆ‘ä»¬è¿˜éœ€è¦æ›´æ–°é¡¶ç‚¹å±æ€§æŒ‡é’ˆæ¥åæ˜ è¿™äº›æ”¹å˜ï¼š</p><div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="dv">0</span><span class="op">);</span>  </span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="kw">sizeof</span><span class="op">(</span>positions<span class="op">)));</span>  </span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>      <span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">2</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="kw">sizeof</span><span class="op">(</span>positions<span class="op">)</span> <span class="op">+</span> <span class="kw">sizeof</span><span class="op">(</span>normals<span class="op">)))</span></span></code></pre></div><p>æ³¨æ„strideå‚æ•°ç­‰äºé¡¶ç‚¹å±æ€§çš„å¤§å°ï¼Œå› ä¸ºä¸‹ä¸€ä¸ªé¡¶ç‚¹å±æ€§å‘é‡èƒ½åœ¨3ä¸ªï¼ˆæˆ–2ä¸ªï¼‰åˆ†é‡ä¹‹åæ‰¾åˆ°ã€‚</p><p>è¿™ç»™äº†æˆ‘ä»¬è®¾ç½®é¡¶ç‚¹å±æ€§çš„å¦ä¸€ç§æ–¹æ³•ã€‚ä½¿ç”¨å“ªç§æ–¹æ³•éƒ½ä¸ä¼šå¯¹OpenGLæœ‰ä»€ä¹ˆç«‹åˆ»çš„å¥½å¤„ï¼Œå®ƒåªæ˜¯è®¾ç½®é¡¶ç‚¹å±æ€§çš„ä¸€ç§æ›´æ•´æ´çš„æ–¹å¼ã€‚å…·ä½“ä½¿ç”¨çš„æ–¹æ³•å°†å®Œå…¨å–å†³äºä½ çš„å–œå¥½ä¸ç¨‹åºç±»å‹ã€‚</p><h3 id="å¤åˆ¶ç¼“å†²">å¤åˆ¶ç¼“å†²</h3><p>å½“ä½ çš„ç¼“å†²å·²ç»å¡«å……å¥½æ•°æ®ä¹‹åï¼Œä½ å¯èƒ½ä¼šæƒ³ä¸å…¶å®ƒçš„ç¼“å†²å…±äº«å…¶ä¸­çš„æ•°æ®ï¼Œæˆ–è€…æƒ³è¦å°†ç¼“å†²çš„å†…å®¹å¤åˆ¶åˆ°å¦ä¸€ä¸ªç¼“å†²å½“ä¸­ã€‚glCopyBufferSubDataèƒ½å¤Ÿè®©æˆ‘ä»¬ç›¸å¯¹å®¹æ˜“åœ°ä»ä¸€ä¸ªç¼“å†²ä¸­å¤åˆ¶æ•°æ®åˆ°å¦ä¸€ä¸ªç¼“å†²ä¸­ã€‚è¿™ä¸ªå‡½æ•°çš„åŸå‹å¦‚ä¸‹ï¼š</p><div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> glCopyBufferSubData<span class="op">(</span>GLenum readtarget<span class="op">,</span> GLenum writetarget<span class="op">,</span> GLintptr readoffset<span class="op">,</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>                         GLintptr writeoffset<span class="op">,</span> GLsizeiptr size<span class="op">);</span></span></code></pre></div><p>readtargetå’Œwritetargetå‚æ•°éœ€è¦å¡«å…¥å¤åˆ¶æºå’Œå¤åˆ¶ç›®æ ‡çš„ç¼“å†²ç›®æ ‡ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å°†VERTEX_ARRAY_BUFFERç¼“å†²å¤åˆ¶åˆ°VERTEX_ELEMENT_ARRAY_BUFFERç¼“å†²ï¼Œåˆ†åˆ«å°†è¿™äº›ç¼“å†²ç›®æ ‡è®¾ç½®ä¸ºè¯»å’Œå†™çš„ç›®æ ‡ã€‚å½“å‰ç»‘å®šåˆ°è¿™äº›ç¼“å†²ç›®æ ‡çš„ç¼“å†²å°†ä¼šè¢«å½±å“åˆ°ã€‚</p><p>ä½†å¦‚æœæˆ‘ä»¬æƒ³è¯»å†™æ•°æ®çš„ä¸¤ä¸ªä¸åŒç¼“å†²éƒ½ä¸ºé¡¶ç‚¹æ•°ç»„ç¼“å†²è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬ä¸èƒ½åŒæ—¶å°†ä¸¤ä¸ªç¼“å†²ç»‘å®šåˆ°åŒä¸€ä¸ªç¼“å†²ç›®æ ‡ä¸Šã€‚æ­£æ˜¯å‡ºäºè¿™ä¸ªåŸå› ï¼ŒOpenGLæä¾›ç»™æˆ‘ä»¬å¦å¤–ä¸¤ä¸ªç¼“å†²ç›®æ ‡ï¼Œå«åšGL_COPY_READ_BUFFERå’ŒGL_COPY_WRITE_BUFFERã€‚æˆ‘ä»¬æ¥ä¸‹æ¥å°±å¯ä»¥å°†éœ€è¦çš„ç¼“å†²ç»‘å®šåˆ°è¿™ä¸¤ä¸ªç¼“å†²ç›®æ ‡ä¸Šï¼Œå¹¶å°†è¿™ä¸¤ä¸ªç›®æ ‡ä½œä¸ºreadtargetå’Œwritetargetå‚æ•°ã€‚</p><p>æ¥ä¸‹æ¥glCopyBufferSubDataä¼šä»readtargetä¸­è¯»å–sizeå¤§å°çš„æ•°æ®ï¼Œå¹¶å°†å…¶å†™å…¥writetargetç¼“å†²çš„writeoffsetåç§»é‡å¤„ã€‚ä¸‹é¢è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•å¤åˆ¶ä¸¤ä¸ªé¡¶ç‚¹æ•°ç»„ç¼“å†²ï¼š</p><div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> vertexData<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span> <span class="op">...</span> <span class="op">};</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_COPY_READ_BUFFER<span class="op">,</span> vbo1<span class="op">);</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_COPY_WRITE_BUFFER<span class="op">,</span> vbo2<span class="op">);</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    glCopyBufferSubData<span class="op">(</span>GL_COPY_READ_BUFFER<span class="op">,</span> GL_COPY_WRITE_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>vertexData<span class="op">));</span></span></code></pre></div><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åªå°†writetargetç¼“å†²ç»‘å®šä¸ºæ–°çš„ç¼“å†²ç›®æ ‡ç±»å‹ä¹‹ä¸€ï¼š</p><div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> vertexData<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span> <span class="op">...</span> <span class="op">};</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> vbo1<span class="op">);</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_COPY_WRITE_BUFFER<span class="op">,</span> vbo2<span class="op">);</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    glCopyBufferSubData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> GL_COPY_WRITE_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>vertexData<span class="op">));</span></span></code></pre></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/04-gao-ji-opengl/06.li-fang-ti-tie-tu/"/>
      <url>/2022/08/10/opengl/04-gao-ji-opengl/06.li-fang-ti-tie-tu/</url>
      
        <content type="html"><![CDATA[<h2 id="ç«‹æ–¹ä½“è´´å›¾">ç«‹æ–¹ä½“è´´å›¾</h2><blockquote><p>æˆ‘ä»¬å°†è®¨è®ºçš„æ˜¯å°†å¤šä¸ªçº¹ç†ç»„åˆèµ·æ¥æ˜ å°„åˆ°ä¸€å¼ çº¹ç†ä¸Šçš„ä¸€ç§çº¹ç†ç±»å‹ï¼šç«‹æ–¹ä½“è´´å›¾(CubeMap)ã€‚</p></blockquote><ol type="1"><li><p>åˆ›å»ºç«‹æ–¹ä½“è´´å›¾ &gt;ç«‹æ–¹ä½“è´´å›¾æ˜¯å’Œå…¶å®ƒçº¹ç†ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¦‚æœæƒ³åˆ›å»ºä¸€ä¸ªç«‹æ–¹ä½“è´´å›¾çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ªçº¹ç†ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°çº¹ç†ç›®æ ‡ä¸Šï¼Œä¹‹åå†åšå…¶å®ƒçš„çº¹ç†æ“ä½œã€‚è¿™æ¬¡è¦ç»‘å®šåˆ°GL_TEXTURE_CUBE_MAPï¼š</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> textureID<span class="op">;</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    glGenTextures<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>textureID<span class="op">);</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    glBindTexture<span class="op">(</span>GL_TEXTURE_CUBE_MAP<span class="op">,</span> textureID<span class="op">);</span></span></code></pre></div><p>å› ä¸ºç«‹æ–¹ä½“è´´å›¾åŒ…å«æœ‰6ä¸ªçº¹ç†ï¼Œæ¯ä¸ªé¢ä¸€ä¸ªï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨glTexImage2Då‡½æ•°6æ¬¡ï¼Œå‚æ•°å’Œä¹‹å‰æ•™ç¨‹ä¸­å¾ˆç±»ä¼¼ã€‚ä½†è¿™ä¸€æ¬¡æˆ‘ä»¬å°†çº¹ç†ç›®æ ‡(target)å‚æ•°è®¾ç½®ä¸ºç«‹æ–¹ä½“è´´å›¾çš„ä¸€ä¸ªç‰¹å®šçš„é¢ï¼Œå‘Šè¯‰OpenGLæˆ‘ä»¬åœ¨å¯¹ç«‹æ–¹ä½“è´´å›¾çš„å“ªä¸€ä¸ªé¢åˆ›å»ºçº¹ç†ã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬éœ€è¦å¯¹ç«‹æ–¹ä½“è´´å›¾çš„æ¯ä¸€ä¸ªé¢éƒ½è°ƒç”¨ä¸€æ¬¡glTexImage2Dã€‚</p><table><thead><tr class="header"><th style="text-align: left;">çº¹ç†ç›®æ ‡</th><th style="text-align: left;">æ–¹ä½</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">GL_TEXTURE_CUBE_MAP_POSITIVE_X</td><td style="text-align: left;">å³</td></tr><tr class="even"><td style="text-align: left;">GL_TEXTURE_CUBE_MAP_NEGATIVE_X</td><td style="text-align: left;">å·¦</td></tr><tr class="odd"><td style="text-align: left;">GL_TEXTURE_CUBE_MAP_POSITIVE_Y</td><td style="text-align: left;">ä¸Š</td></tr><tr class="even"><td style="text-align: left;">GL_TEXTURE_CUBE_MAP_NEGATIVE_Y</td><td style="text-align: left;">ä¸‹</td></tr><tr class="odd"><td style="text-align: left;">GL_TEXTURE_CUBE_MAP_POSITIVE_Z</td><td style="text-align: left;">å</td></tr><tr class="even"><td style="text-align: left;">GL_TEXTURE_CUBE_MAP_NEGATIVE_Z</td><td style="text-align: left;">å‰</td></tr></tbody></table><p>å’ŒOpenGLçš„å¾ˆå¤šæšä¸¾(Enum)ä¸€æ ·ï¼Œå®ƒä»¬èƒŒåçš„intå€¼æ˜¯çº¿æ€§é€’å¢çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªçº¹ç†ä½ç½®çš„æ•°ç»„æˆ–è€…vectorï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»GL_TEXTURE_CUBE_MAP_POSITIVE_Xå¼€å§‹éå†å®ƒä»¬ï¼Œåœ¨æ¯ä¸ªè¿­ä»£ä¸­å¯¹æšä¸¾å€¼åŠ 1ï¼Œéå†äº†æ•´ä¸ªçº¹ç†ç›®æ ‡ï¼š</p><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> width<span class="op">,</span> height<span class="op">,</span> nrChannels<span class="op">;</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>data<span class="op">;</span>  </span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//textures_faces è´´å›¾è·¯å¾„çš„ vector</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> textures_faces<span class="op">.</span>size<span class="op">();</span> i<span class="op">++)</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> stbi_load<span class="op">(</span>textures_faces<span class="op">[</span>i<span class="op">].</span>c_str<span class="op">(),</span> <span class="op">&amp;</span>width<span class="op">,</span> <span class="op">&amp;</span>height<span class="op">,</span> <span class="op">&amp;</span>nrChannels<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        glTexImage2D<span class="op">(</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>            GL_TEXTURE_CUBE_MAP_POSITIVE_X <span class="op">+</span> i<span class="op">,</span> </span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>            <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> GL_UNSIGNED_BYTE<span class="op">,</span> data</span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><p>å› ä¸ºç«‹æ–¹ä½“è´´å›¾å’Œå…¶å®ƒçº¹ç†æ²¡ä»€ä¹ˆä¸åŒï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è®¾å®šå®ƒçš„ç¯ç»•å’Œè¿‡æ»¤æ–¹å¼ï¼š<code>cpp      glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MAG_FILTER, GL_LINEAR);      glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER, GL_LINEAR);      glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);      glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);      //GL_TEXTURE_WRAP_R:çº¹ç†çš„Råæ ‡è®¾ç½®äº†ç¯ç»•æ–¹å¼ï¼Œå®ƒå¯¹åº”çš„æ˜¯çº¹ç†çš„ç¬¬ä¸‰ä¸ªç»´åº¦ï¼ˆå’Œä½ç½®çš„zä¸€æ ·ï¼‰      glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE);</code></p><p>ç«‹æ–¹ä½“è´´å›¾çš„Shader é‡‡æ ·å™¨æ•°æ®ç±»å‹<code>samplerCube</code>ï¼Œå¹¶ä¸”ä½¿ç”¨vec3çš„æ–¹å‘å‘é‡è¿›è¡Œé‡‡æ ·</p><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    in vec3 textureDir<span class="op">;</span> <span class="co">// ä»£è¡¨3Dçº¹ç†åæ ‡çš„æ–¹å‘å‘é‡</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    uniform samplerCube cubemap<span class="op">;</span> <span class="co">// ç«‹æ–¹ä½“è´´å›¾çš„çº¹ç†é‡‡æ ·å™¨</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span>             </span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> texture<span class="op">(</span>cubemap<span class="op">,</span> textureDir<span class="op">);</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><p>ç«‹æ–¹ä½“çš„ä¸€ä¸ªé‡è¦ç”¨é€”ï¼š<code>å¤©ç©ºç›’ï¼ˆSkyboxï¼‰</code></p></li><li><p>åŠ è½½å¤©ç©ºç›’å­ &gt; å’Œå…¶ä»–çº¹ç†ä¸€æ ·ï¼Œ åªæ˜¯å¯¹äº†ä¸€ä¸ªè½´å‘<code>R</code><code>cpp               unsigned int loadCubemap(vector&lt;std::string&gt; faces)         {             unsigned int textureID;             glGenTextures(1, &amp;textureID);             glBindTexture(GL_TEXTURE_CUBE_MAP, textureID);             int width, height, nrChannels;             for (unsigned int i = 0; i &lt; faces.size(); i++)             {                 unsigned char *data = stbi_load(faces[i].c_str(), &amp;width, &amp;height, &amp;nrChannels, 0);                 if (data)                 {                     glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X + i,                                   0, GL_RGB, width, height, 0, GL_RGB, GL_UNSIGNED_BYTE, data                     );                     stbi_image_free(data);                 }                 else                 {                     std::cout &lt;&lt; "Cubemap texture failed to load at path: " &lt;&lt; faces[i] &lt;&lt; std::endl;                     stbi_image_free(data);                 }             }             glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER, GL_LINEAR);             glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MAG_FILTER, GL_LINEAR);             glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);             glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);             glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE);             return textureID;         }         vector&lt;std::string&gt; faces         {             "right.jpg",             "left.jpg",             "top.jpg",             "bottom.jpg",             "front.jpg",             "back.jpg"         };         unsigned int cubemapTexture = loadCubemap(faces);</code></p></li><li><p>æ˜¾ç¤ºå¤©ç©ºç›’å­ &gt;å¤©ç©ºç›’å’Œä¸€èˆ¬çš„ç«‹æ–¹ä½“ä¸€æ ·ï¼Œåªæ˜¯æ¸²æŸ“åœ¨å¯¹åº•å±‚çš„èƒŒæ™¯ä¸Š</p><ol type="1"><li><p>é¡¶ç‚¹ç€è‰²å™¨<code>cpp          #version 330 core          layout (location = 0) in vec3 aPos;          //ç«‹æ–¹ä½“è´´å›¾çš„uvåæ ‡ `vec3`          out vec3 TexCoords;          uniform mat4 projection;          uniform mat4 view;          void main()          {              TexCoords = aPos;              gl_Position = projection * view * vec4(aPos, 1.0);          }</code></p></li><li><p>ç‰‡æ®µç€è‰²å™¨<code>cpp          #version 330 core          out vec4 FragColor;          in vec3 TexCoords;          //ç«‹æ–¹ä½“è´´å›¾çš„é‡‡æ ·å™¨          uniform samplerCube skybox;          void main()          {                  FragColor = texture(skybox, TexCoords);          }</code></p></li><li><p>ç»˜åˆ¶å¤©ç©ºç›’æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒå˜ä¸ºåœºæ™¯ä¸­çš„ç¬¬ä¸€ä¸ªæ¸²æŸ“çš„ç‰©ä½“ï¼Œå¹¶ä¸”ç¦ç”¨æ·±åº¦å†™å…¥ã€‚è¿™æ ·å­å¤©ç©ºç›’å°±ä¼šæ°¸è¿œè¢«ç»˜åˆ¶åœ¨å…¶å®ƒç‰©ä½“çš„èƒŒåäº†ã€‚<code>cpp          glDepthMask(GL_FALSE);          skyboxShader.use();          // ... è®¾ç½®è§‚å¯Ÿå’ŒæŠ•å½±çŸ©é˜µ          glBindVertexArray(skyboxVAO);          glBindTexture(GL_TEXTURE_CUBE_MAP, cubemapTexture);          glDrawArrays(GL_TRIANGLES, 0, 36);          glDepthMask(GL_TRUE);          // ... ç»˜åˆ¶å‰©ä¸‹çš„åœºæ™¯</code></p></li></ol></li><li><p>ä¼˜åŒ–ç‚¹ &gt;ç›®å‰æˆ‘ä»¬æ˜¯é¦–å…ˆæ¸²æŸ“å¤©ç©ºç›’ï¼Œä¹‹åå†æ¸²æŸ“åœºæ™¯ä¸­çš„å…¶å®ƒç‰©ä½“ã€‚è¿™æ ·å­èƒ½å¤Ÿå·¥ä½œï¼Œä½†ä¸æ˜¯éå¸¸é«˜æ•ˆã€‚å¦‚æœæˆ‘ä»¬å…ˆæ¸²æŸ“å¤©ç©ºç›’ï¼Œæˆ‘ä»¬å°±ä¼šå¯¹å±å¹•ä¸Šçš„æ¯ä¸€ä¸ªåƒç´ è¿è¡Œä¸€éç‰‡æ®µç€è‰²å™¨ï¼Œå³ä¾¿åªæœ‰ä¸€å°éƒ¨åˆ†çš„å¤©ç©ºç›’æœ€ç»ˆæ˜¯å¯è§çš„ã€‚å¯ä»¥ä½¿ç”¨æå‰æ·±åº¦æµ‹è¯•(EarlyDepth Testing)è½»æ¾ä¸¢å¼ƒæ‰çš„ç‰‡æ®µèƒ½å¤ŸèŠ‚çœæˆ‘ä»¬å¾ˆå¤šå®è´µçš„å¸¦å®½ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°†ä¼šæœ€åæ¸²æŸ“å¤©ç©ºç›’ï¼Œä»¥è·å¾—è½»å¾®çš„æ€§èƒ½æå‡ã€‚è¿™æ ·å­çš„è¯ï¼Œæ·±åº¦ç¼“å†²å°±ä¼šå¡«å……æ»¡æ‰€æœ‰ç‰©ä½“çš„æ·±åº¦å€¼äº†ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æå‰æ·±åº¦æµ‹è¯•é€šè¿‡çš„åœ°æ–¹æ¸²æŸ“å¤©ç©ºç›’çš„ç‰‡æ®µå°±å¯ä»¥äº†ï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå‡å°‘äº†ç‰‡æ®µç€è‰²å™¨çš„è°ƒç”¨ã€‚é—®é¢˜æ˜¯ï¼Œå¤©ç©ºç›’åªæ˜¯ä¸€ä¸ª1x1x1çš„ç«‹æ–¹ä½“ï¼Œå®ƒå¾ˆå¯èƒ½ä¼šä¸é€šè¿‡å¤§éƒ¨åˆ†çš„æ·±åº¦æµ‹è¯•ï¼Œå¯¼è‡´æ¸²æŸ“å¤±è´¥ã€‚ä¸ç”¨æ·±åº¦æµ‹è¯•æ¥è¿›è¡Œæ¸²æŸ“ä¸æ˜¯è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºå¤©ç©ºç›’å°†ä¼šå¤å†™åœºæ™¯ä¸­çš„å…¶å®ƒç‰©ä½“ã€‚æˆ‘ä»¬éœ€è¦æ¬ºéª—æ·±åº¦ç¼“å†²ï¼Œè®©å®ƒè®¤ä¸ºå¤©ç©ºç›’æœ‰ç€æœ€å¤§çš„æ·±åº¦å€¼1.0ï¼Œåªè¦å®ƒå‰é¢æœ‰ä¸€ä¸ªç‰©ä½“ï¼Œæ·±åº¦æµ‹è¯•å°±ä¼šå¤±è´¥ã€‚</p><p>åœ¨åæ ‡ç³»ç»Ÿå°èŠ‚ä¸­æˆ‘ä»¬è¯´è¿‡ï¼Œé€è§†é™¤æ³•æ˜¯åœ¨é¡¶ç‚¹ç€è‰²å™¨è¿è¡Œä¹‹åæ‰§è¡Œçš„ï¼Œå°†gl_Positionçš„xyzåæ ‡é™¤ä»¥wåˆ†é‡ã€‚æˆ‘ä»¬åˆä»æ·±åº¦æµ‹è¯•å°èŠ‚ä¸­çŸ¥é“ï¼Œç›¸é™¤ç»“æœçš„zåˆ†é‡ç­‰äºé¡¶ç‚¹çš„æ·±åº¦å€¼ã€‚ä½¿ç”¨è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¾“å‡ºä½ç½®çš„zåˆ†é‡ç­‰äºå®ƒçš„wåˆ†é‡ï¼Œè®©zåˆ†é‡æ°¸è¿œç­‰äº1.0ï¼Œè¿™æ ·å­çš„è¯ï¼Œå½“é€è§†é™¤æ³•æ‰§è¡Œä¹‹åï¼Œzåˆ†é‡ä¼šå˜ä¸ºw/ w = 1.0ã€‚</p><div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        TexCoords <span class="op">=</span> aPos<span class="op">;</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        vec4 pos <span class="op">=</span> projection <span class="op">*</span> view <span class="op">*</span> vec4<span class="op">(</span>aPos<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// w æ›¿ä»£zï¼Œ å¾—åˆ° 1.0 çš„æ·±åº¦å€¼ã€‚ å°†å®ƒä»é»˜è®¤çš„GL_LESSæ”¹ä¸ºGL_LEQUALã€‚æ·±åº¦ç¼“å†²å°†ä¼šå¡«å……ä¸Šå¤©ç©ºç›’çš„1.0å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¿è¯å¤©ç©ºç›’åœ¨å€¼å°äºæˆ–ç­‰äºæ·±åº¦ç¼“å†²è€Œä¸æ˜¯å°äºæ—¶é€šè¿‡æ·±åº¦æµ‹è¯•ã€‚</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        gl_Position <span class="op">=</span> pos<span class="op">.</span>xyww<span class="op">;</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><ol type="1"><li><p>åå‘,é¢œè‰²å–å</p><div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> vec4<span class="op">(</span>vec3<span class="op">(</span><span class="fl">1.0</span> <span class="op">-</span> texture<span class="op">(</span>screenTexture<span class="op">,</span> TexCoords<span class="op">)),</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li><li><p>ç°åº¦ rgb å¹³å‡å€¼</p><div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> texture<span class="op">(</span>screenTexture<span class="op">,</span> TexCoords<span class="op">);</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">//float average = (FragColor.r + FragColor.g + FragColor.b) / 3.0;</span></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> average <span class="op">=</span> <span class="op">(</span>FragColor<span class="op">.</span>r <span class="op">+</span> FragColor<span class="op">.</span>g <span class="op">+</span> FragColor<span class="op">.</span>b<span class="op">)</span> <span class="op">*</span> <span class="fl">0.333333</span><span class="op">;</span></span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> vec4<span class="op">(</span>average<span class="op">,</span> average<span class="op">,</span> average<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><p>è¿™å·²ç»èƒ½åˆ›é€ å¾ˆå¥½çš„ç»“æœäº†ï¼Œä½†äººçœ¼ä¼šå¯¹ç»¿è‰²æ›´åŠ æ•æ„Ÿä¸€äº›ï¼Œè€Œå¯¹è“è‰²ä¸é‚£ä¹ˆæ•æ„Ÿï¼Œæ‰€ä»¥ä¸ºäº†è·å–ç‰©ç†ä¸Šæ›´ç²¾ç¡®çš„æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åŠ æƒçš„(Weighted)é€šé“ï¼šr <code>0.2126</code>ã€ g <code>0.7152</code> ã€ b <code>0.0722</code><code>cpp      void main()      {          FragColor = texture(screenTexture, TexCoords);          float average = 0.2126 * FragColor.r + 0.7152 * FragColor.g + 0.0722 * FragColor.b;          FragColor = vec4(average, average, average, 1.0);      }</code></p></li><li><p>æ ¸æ•ˆæœ</p><div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        vec2 offsets<span class="op">[</span><span class="dv">9</span><span class="op">]</span> <span class="op">=</span> vec2<span class="op">[](</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(-</span>offset<span class="op">,</span>  offset<span class="op">),</span> <span class="co">// å·¦ä¸Š</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>    offset<span class="op">),</span> <span class="co">// æ­£ä¸Š</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(</span> offset<span class="op">,</span>  offset<span class="op">),</span> <span class="co">// å³ä¸Š</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(-</span>offset<span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">),</span>   <span class="co">// å·¦</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>    <span class="fl">0.0</span><span class="bu">f</span><span class="op">),</span>   <span class="co">// ä¸­</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(</span> offset<span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">),</span>   <span class="co">// å³</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(-</span>offset<span class="op">,</span> <span class="op">-</span>offset<span class="op">),</span> <span class="co">// å·¦ä¸‹</span></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="op">-</span>offset<span class="op">),</span> <span class="co">// æ­£ä¸‹</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(</span> offset<span class="op">,</span> <span class="op">-</span>offset<span class="op">)</span>  <span class="co">// å³ä¸‹</span></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span><span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> kernel<span class="op">[</span><span class="dv">9</span><span class="op">]</span> <span class="op">=</span> <span class="dt">float</span><span class="op">[](</span></span><span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span></span><span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="dv">1</span><span class="op">,</span>  <span class="dv">9</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span></span><span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span></span><span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span><span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        vec3 sampleTex<span class="op">[</span><span class="dv">9</span><span class="op">];</span></span><span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">9</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>            sampleTex<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> vec3<span class="op">(</span>texture<span class="op">(</span>screenTexture<span class="op">,</span> TexCoords<span class="op">.</span>st <span class="op">+</span> offsets<span class="op">[</span>i<span class="op">]));</span></span><span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        vec3 col <span class="op">=</span> vec3<span class="op">(</span><span class="fl">0.0</span><span class="op">);</span></span><span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">9</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>            col <span class="op">+=</span> sampleTex<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> kernel<span class="op">[</span>i<span class="op">];</span></span><span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> vec4<span class="op">(</span>col<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li><li><p>æ¨¡ç³Š<code>cpp          float kernel[9] = float[](              1.0 / 16, 2.0 / 16, 1.0 / 16,              2.0 / 16, 4.0 / 16, 2.0 / 16,              1.0 / 16, 2.0 / 16, 1.0 / 16            );</code></p></li><li><p>è¾¹ç¼˜æ£€æµ‹</p><div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> kernel<span class="op">[</span><span class="dv">9</span><span class="op">]</span> <span class="op">=</span> <span class="dt">float</span><span class="op">[](</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">8</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span></span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>  </span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span></code></pre></div></li></ol></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/04-gao-ji-opengl/05.zheng-huan-chong/"/>
      <url>/2022/08/10/opengl/04-gao-ji-opengl/05.zheng-huan-chong/</url>
      
        <content type="html"><![CDATA[<h2 id="å¸§ç¼“å†²">å¸§ç¼“å†²</h2><blockquote><p>æˆ‘ä»¬å·²ç»ä½¿ç”¨äº†å¾ˆå¤šå±å¹•ç¼“å†²äº†ï¼šç”¨äºå†™å…¥é¢œè‰²å€¼çš„é¢œè‰²ç¼“å†²ã€ç”¨äºå†™å…¥æ·±åº¦ä¿¡æ¯çš„æ·±åº¦ç¼“å†²å’Œå…è®¸æˆ‘ä»¬æ ¹æ®ä¸€äº›æ¡ä»¶ä¸¢å¼ƒç‰¹å®šç‰‡æ®µçš„æ¨¡æ¿ç¼“å†²ã€‚è¿™äº›ç¼“å†²ç»“åˆèµ·æ¥å«åšå¸§ç¼“å†²(Framebuffer)ï¼Œå®ƒè¢«å‚¨å­˜åœ¨å†…å­˜ä¸­ã€‚OpenGLå…è®¸æˆ‘ä»¬å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„å¸§ç¼“å†²ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬èƒ½å¤Ÿå®šä¹‰æˆ‘ä»¬è‡ªå·±çš„é¢œè‰²ç¼“å†²ï¼Œç”šè‡³æ˜¯æ·±åº¦ç¼“å†²å’Œæ¨¡æ¿ç¼“å†²ã€‚</p></blockquote><ol type="1"><li><p>åˆ›å»ºç¼“å†² &gt; å¸§ç¼“å†²å¯¹è±¡(Framebuffer Object, FBO)ï¼š</p><ul><li>åˆ›å»ºå¸§ç¼“å†²å¯¹è±¡</li></ul><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> fbo<span class="op">;</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    glGenFramebuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>fbo<span class="op">);</span></span></code></pre></div><ul><li>ç»‘å®šå¸§ç¼“å†²å¯¹è±¡</li></ul><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    glBindFramebuffer<span class="op">(</span>GL_FRAMEBUFFER<span class="op">,</span> fbo<span class="op">);</span></span></code></pre></div><p>åœ¨ç»‘å®šåˆ°GL_FRAMEBUFFERç›®æ ‡ä¹‹åï¼Œæ‰€æœ‰çš„è¯»å–å’Œå†™å…¥å¸§ç¼“å†²çš„æ“ä½œå°†ä¼šå½±å“å½“å‰ç»‘å®šçš„å¸§ç¼“å†²ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨GL_READ_FRAMEBUFFERæˆ–GL_DRAW_FRAMEBUFFERï¼Œå°†ä¸€ä¸ªå¸§ç¼“å†²åˆ†åˆ«ç»‘å®šåˆ°è¯»å–ç›®æ ‡æˆ–å†™å…¥ç›®æ ‡ã€‚ç»‘å®šåˆ°GL_READ_FRAMEBUFFERçš„å¸§ç¼“å†²å°†ä¼šä½¿ç”¨åœ¨æ‰€æœ‰åƒæ˜¯glReadPixelsçš„è¯»å–æ“ä½œä¸­ï¼Œè€Œç»‘å®šåˆ°GL_DRAW_FRAMEBUFFERçš„å¸§ç¼“å†²å°†ä¼šè¢«ç”¨ä½œæ¸²æŸ“ã€æ¸…é™¤ç­‰å†™å…¥æ“ä½œçš„ç›®æ ‡ã€‚å¤§éƒ¨åˆ†æƒ…å†µä½ éƒ½ä¸éœ€è¦åŒºåˆ†å®ƒä»¬ï¼Œé€šå¸¸éƒ½ä¼šä½¿ç”¨GL_FRAMEBUFFERï¼Œç»‘å®šåˆ°ä¸¤ä¸ªä¸Šã€‚</p><p>ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨è¿˜ä¸èƒ½ä½¿ç”¨æˆ‘ä»¬çš„å¸§ç¼“å†²ï¼Œå› ä¸ºå®ƒè¿˜ä¸å®Œæ•´(Complete)ï¼Œä¸€ä¸ªå®Œæ•´çš„å¸§ç¼“å†²éœ€è¦æ»¡è¶³ä»¥ä¸‹çš„æ¡ä»¶ï¼š</p><ul><li>é™„åŠ è‡³å°‘ä¸€ä¸ªç¼“å†²ï¼ˆé¢œè‰²ã€æ·±åº¦æˆ–æ¨¡æ¿ç¼“å†²ï¼‰ã€‚</li><li>è‡³å°‘æœ‰ä¸€ä¸ªé¢œè‰²é™„ä»¶(Attachment)ã€‚</li><li>æ‰€æœ‰çš„é™„ä»¶éƒ½å¿…é¡»æ˜¯å®Œæ•´çš„ï¼ˆä¿ç•™äº†å†…å­˜ï¼‰ã€‚</li><li>æ¯ä¸ªç¼“å†²éƒ½åº”è¯¥æœ‰ç›¸åŒçš„æ ·æœ¬æ•°ã€‚</li></ul><p>GL_FRAMEBUFFERä¸ºå‚æ•°è°ƒç”¨glCheckFramebufferStatusï¼Œæ£€æŸ¥å¸§ç¼“å†²æ˜¯å¦å®Œæ•´ã€‚å®ƒå°†ä¼šæ£€æµ‹å½“å‰ç»‘å®šçš„å¸§ç¼“å†²ï¼Œå¹¶è¿”å›è§„èŒƒä¸­è¿™äº›å€¼çš„å…¶ä¸­ä¹‹ä¸€ã€‚å¦‚æœå®ƒè¿”å›çš„æ˜¯GL_FRAMEBUFFER_COMPLETEï¼Œå¸§ç¼“å†²å°±æ˜¯å®Œæ•´çš„äº†ã€‚<code>cpp      if(glCheckFramebufferStatus(GL_FRAMEBUFFER) == GL_FRAMEBUFFER_COMPLETE)      {          // æ‰§è¡Œèƒœåˆ©çš„èˆè¹ˆ      }</code></p><p>æ“ä½œå®Œæˆåé‡æ–°è®¾ç½®ä¸ºé»˜è®¤å€¼<code>cpp      glBindFramebuffer(GL_FRAMEBUFFER, 0);</code></p><p>åœ¨æ‰€æœ‰ä½¿ç”¨å®Œæˆåéœ€è¦æ¸…ç†fboå¯¹è±¡<code>cpp      glDeleteFramebuffers(1, &amp;fbo);</code></p></li><li><p>çº¹ç†é™„ä»¶</p><ol type="1"><li><p>åˆ›å»ºä¸€ä¸ªæ¸²æŸ“ç¼“å†²å¯¹è±¡çš„ä»£ç å’Œå¸§ç¼“å†²çš„ä»£ç å¾ˆç±»ä¼¼ï¼š<code>cpp          unsigned int rbo;          glGenRenderbuffers(1, &amp;rbo);</code></p></li><li><p>ç±»ä¼¼ï¼Œæˆ‘ä»¬éœ€è¦ç»‘å®šè¿™ä¸ªæ¸²æŸ“ç¼“å†²å¯¹è±¡ï¼Œè®©ä¹‹åæ‰€æœ‰çš„æ¸²æŸ“ç¼“å†²æ“ä½œå½±å“å½“å‰çš„rboï¼š<code>cpp          glBindRenderbuffer(GL_RENDERBUFFER, rbo);</code></p></li><li><p>åˆ›å»ºä¸€ä¸ªæ·±åº¦å’Œæ¨¡æ¿æ¸²æŸ“ç¼“å†²å¯¹è±¡å¯ä»¥é€šè¿‡è°ƒç”¨glRenderbufferStorageå‡½æ•°æ¥å®Œæˆï¼š<code>cpp          glRenderbufferStorage(GL_RENDERBUFFER, GL_DEPTH24_STENCIL8, 800, 600);</code></p></li><li><p>æœ€åä¸€ä»¶äº‹å°±æ˜¯é™„åŠ è¿™ä¸ªæ¸²æŸ“ç¼“å†²å¯¹è±¡ï¼š<code>cpp          glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_DEPTH_STENCIL_ATTACHMENT, GL_RENDERBUFFER, rbo);</code></p></li></ol></li><li><p>æ¸²æŸ“åˆ°çº¹ç†æˆ‘ä»¬å°†ä¼šå°†åœºæ™¯æ¸²æŸ“åˆ°ä¸€ä¸ªé™„åŠ åˆ°å¸§ç¼“å†²å¯¹è±¡ä¸Šçš„é¢œè‰²çº¹ç†ä¸­ï¼Œä¹‹åå°†åœ¨ä¸€ä¸ªæ¨ªè·¨æ•´ä¸ªå±å¹•çš„å››è¾¹å½¢ä¸Šç»˜åˆ¶è¿™ä¸ªçº¹ç†ã€‚è¿™æ ·è§†è§‰è¾“å‡ºå’Œæ²¡ä½¿ç”¨å¸§ç¼“å†²æ—¶æ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œä½†è¿™æ¬¡æ˜¯æ‰“å°åˆ°äº†ä¸€ä¸ªå››è¾¹å½¢ä¸Šã€‚</p><ol type="1"><li><p>é¦–å…ˆè¦åˆ›å»ºä¸€ä¸ªå¸§ç¼“å†²å¯¹è±¡ï¼Œå¹¶ç»‘å®šå®ƒï¼Œè¿™äº›éƒ½å¾ˆç›´è§‚ï¼š<code>cpp          unsigned int framebuffer;          glGenFramebuffers(1, &amp;framebuffer);          glBindFramebuffer(GL_FRAMEBUFFER, framebuffer);</code></p></li><li><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªçº¹ç†å›¾åƒï¼Œæˆ‘ä»¬å°†å®ƒä½œä¸ºä¸€ä¸ªé¢œè‰²é™„ä»¶é™„åŠ åˆ°å¸§ç¼“å†²ä¸Šã€‚æˆ‘ä»¬å°†çº¹ç†çš„ç»´åº¦è®¾ç½®ä¸ºçª—å£çš„å®½åº¦å’Œé«˜åº¦ï¼Œå¹¶ä¸”ä¸åˆå§‹åŒ–å®ƒçš„æ•°æ®ï¼š<code>cpp          // ç”Ÿæˆçº¹ç†          unsigned int texColorBuffer;          glGenTextures(1, &amp;texColorBuffer);          glBindTexture(GL_TEXTURE_2D, texColorBuffer);          glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, 800, 600, 0, GL_RGB, GL_UNSIGNED_BYTE, NULL);          glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR );          glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);          glBindTexture(GL_TEXTURE_2D, 0);          // å°†å®ƒé™„åŠ åˆ°å½“å‰ç»‘å®šçš„å¸§ç¼“å†²å¯¹è±¡          glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_2D, texColorBuffer, 0);</code></p></li><li><p>åˆ›å»ºä¸€ä¸ªæ¸²æŸ“ç¼“å†²å¯¹è±¡ä¸æ˜¯éå¸¸å¤æ‚ã€‚æˆ‘ä»¬éœ€è¦è®°ä½çš„å”¯ä¸€äº‹æƒ…æ˜¯ï¼Œæˆ‘ä»¬å°†å®ƒåˆ›å»ºä¸ºä¸€ä¸ªæ·±åº¦å’Œæ¨¡æ¿é™„ä»¶æ¸²æŸ“ç¼“å†²å¯¹è±¡ã€‚æˆ‘ä»¬å°†å®ƒçš„å†…éƒ¨æ ¼å¼è®¾ç½®ä¸ºGL_DEPTH24_STENCIL8ï¼Œå¯¹æˆ‘ä»¬æ¥è¯´è¿™ä¸ªç²¾åº¦å·²ç»è¶³å¤Ÿäº†ã€‚<code>cpp          unsigned int rbo;          glGenRenderbuffers(1, &amp;rbo);          glBindRenderbuffer(GL_RENDERBUFFER, rbo);           glRenderbufferStorage(GL_RENDERBUFFER, GL_DEPTH24_STENCIL8, 800, 600);            glBindRenderbuffer(GL_RENDERBUFFER, 0);</code></p></li><li><p>æ¥ä¸‹æ¥ï¼Œä½œä¸ºå®Œæˆå¸§ç¼“å†²ä¹‹å‰çš„æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬å°†æ¸²æŸ“ç¼“å†²å¯¹è±¡é™„åŠ åˆ°å¸§ç¼“å†²çš„æ·±åº¦å’Œæ¨¡æ¿é™„ä»¶ä¸Šï¼š<code>cpp          glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_DEPTH_STENCIL_ATTACHMENT, GL_RENDERBUFFER, rbo);</code></p></li><li><p>æœ€åï¼Œæˆ‘ä»¬å¸Œæœ›æ£€æŸ¥å¸§ç¼“å†²æ˜¯å¦æ˜¯å®Œæ•´çš„ï¼Œå¦‚æœä¸æ˜¯ï¼Œæˆ‘ä»¬å°†æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚<code>cpp          if(glCheckFramebufferStatus(GL_FRAMEBUFFER) != GL_FRAMEBUFFER_COMPLETE)              std::cout &lt;&lt; "ERROR::FRAMEBUFFER:: Framebuffer is not complete!" &lt;&lt; std::endl;          glBindFramebuffer(GL_FRAMEBUFFER, 0);</code></p></li></ol><p>è®°å¾—è¦è§£ç»‘å¸§ç¼“å†²ï¼Œä¿è¯æˆ‘ä»¬ä¸ä¼šä¸å°å¿ƒæ¸²æŸ“åˆ°é”™è¯¯çš„å¸§ç¼“å†²ä¸Šã€‚</p></li><li><p>åå¤„ç† &gt; å•çº¯é‡å¤æ¸²æŸ“æ˜¯ä¸€ç§ï¼Œæ›´å¤šçš„ç”¨å›¾åœ¨<code>åå¤„ç†</code>&gt; å›¾å½¢æ•°å­¦ï¼Œ<code>å·ç§¯</code>ã€<code>å¾®ç§¯åˆ†</code>ã€<code>é«˜é˜¶æ•°å­¦ç®—å­</code></p><ol type="1"><li><p>åå‘,é¢œè‰²å–å</p><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> vec4<span class="op">(</span>vec3<span class="op">(</span><span class="fl">1.0</span> <span class="op">-</span> texture<span class="op">(</span>screenTexture<span class="op">,</span> TexCoords<span class="op">)),</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li><li><p>ç°åº¦ rgb å¹³å‡å€¼</p><div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> texture<span class="op">(</span>screenTexture<span class="op">,</span> TexCoords<span class="op">);</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">//float average = (FragColor.r + FragColor.g + FragColor.b) / 3.0;</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> average <span class="op">=</span> <span class="op">(</span>FragColor<span class="op">.</span>r <span class="op">+</span> FragColor<span class="op">.</span>g <span class="op">+</span> FragColor<span class="op">.</span>b<span class="op">)</span> <span class="op">*</span> <span class="fl">0.333333</span><span class="op">;</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> vec4<span class="op">(</span>average<span class="op">,</span> average<span class="op">,</span> average<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><p>è¿™å·²ç»èƒ½åˆ›é€ å¾ˆå¥½çš„ç»“æœäº†ï¼Œä½†äººçœ¼ä¼šå¯¹ç»¿è‰²æ›´åŠ æ•æ„Ÿä¸€äº›ï¼Œè€Œå¯¹è“è‰²ä¸é‚£ä¹ˆæ•æ„Ÿï¼Œæ‰€ä»¥ä¸ºäº†è·å–ç‰©ç†ä¸Šæ›´ç²¾ç¡®çš„æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åŠ æƒçš„(Weighted)é€šé“ï¼šr <code>0.2126</code>ã€ g <code>0.7152</code> ã€ b <code>0.0722</code><code>cpp      void main()      {          FragColor = texture(screenTexture, TexCoords);          float average = 0.2126 * FragColor.r + 0.7152 * FragColor.g + 0.0722 * FragColor.b;          FragColor = vec4(average, average, average, 1.0);      }</code></p></li><li><p>æ ¸æ•ˆæœ</p><div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        vec2 offsets<span class="op">[</span><span class="dv">9</span><span class="op">]</span> <span class="op">=</span> vec2<span class="op">[](</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(-</span>offset<span class="op">,</span>  offset<span class="op">),</span> <span class="co">// å·¦ä¸Š</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>    offset<span class="op">),</span> <span class="co">// æ­£ä¸Š</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(</span> offset<span class="op">,</span>  offset<span class="op">),</span> <span class="co">// å³ä¸Š</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(-</span>offset<span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">),</span>   <span class="co">// å·¦</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>    <span class="fl">0.0</span><span class="bu">f</span><span class="op">),</span>   <span class="co">// ä¸­</span></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(</span> offset<span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">),</span>   <span class="co">// å³</span></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(-</span>offset<span class="op">,</span> <span class="op">-</span>offset<span class="op">),</span> <span class="co">// å·¦ä¸‹</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="op">-</span>offset<span class="op">),</span> <span class="co">// æ­£ä¸‹</span></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>            vec2<span class="op">(</span> offset<span class="op">,</span> <span class="op">-</span>offset<span class="op">)</span>  <span class="co">// å³ä¸‹</span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span><span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> kernel<span class="op">[</span><span class="dv">9</span><span class="op">]</span> <span class="op">=</span> <span class="dt">float</span><span class="op">[](</span></span><span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span></span><span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="dv">1</span><span class="op">,</span>  <span class="dv">9</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span></span><span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span></span><span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span class="op">);</span></span><span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        vec3 sampleTex<span class="op">[</span><span class="dv">9</span><span class="op">];</span></span><span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">9</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>            sampleTex<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> vec3<span class="op">(</span>texture<span class="op">(</span>screenTexture<span class="op">,</span> TexCoords<span class="op">.</span>st <span class="op">+</span> offsets<span class="op">[</span>i<span class="op">]));</span></span><span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        vec3 col <span class="op">=</span> vec3<span class="op">(</span><span class="fl">0.0</span><span class="op">);</span></span><span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">9</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>            col <span class="op">+=</span> sampleTex<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> kernel<span class="op">[</span>i<span class="op">];</span></span><span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> vec4<span class="op">(</span>col<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li><li><p>æ¨¡ç³Š<code>cpp          float kernel[9] = float[](              1.0 / 16, 2.0 / 16, 1.0 / 16,              2.0 / 16, 4.0 / 16, 2.0 / 16,              1.0 / 16, 2.0 / 16, 1.0 / 16            );</code></p></li><li><p>è¾¹ç¼˜æ£€æµ‹</p><div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> kernel<span class="op">[</span><span class="dv">9</span><span class="op">]</span> <span class="op">=</span> <span class="dt">float</span><span class="op">[](</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">8</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span>  </span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">);</span></span></code></pre></div></li></ol></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/04-gao-ji-opengl/04.mian-ti-chu/"/>
      <url>/2022/08/10/opengl/04-gao-ji-opengl/04.mian-ti-chu/</url>
      
        <content type="html"><![CDATA[<h2 id="é¢å‰”é™¤">é¢å‰”é™¤</h2><blockquote><p>èƒ½å¤Ÿä»¥æŸç§æ–¹å¼ä¸¢å¼ƒè¿™å‡ ä¸ªçœ‹ä¸è§çš„é¢ï¼Œæˆ‘ä»¬èƒ½çœä¸‹è¶…è¿‡50%çš„ç‰‡æ®µç€è‰²å™¨æ‰§è¡Œæ•°ï¼OpenGLèƒ½å¤Ÿæ£€æŸ¥æ‰€æœ‰é¢å‘(FrontFacing)è§‚å¯Ÿè€…çš„é¢ï¼Œå¹¶æ¸²æŸ“å®ƒä»¬ï¼Œè€Œä¸¢å¼ƒé‚£äº›èƒŒå‘(BackFacing)çš„é¢ï¼ŒèŠ‚çœæˆ‘ä»¬å¾ˆå¤šçš„ç‰‡æ®µç€è‰²å™¨è°ƒç”¨ï¼ˆå®ƒä»¬çš„å¼€é”€å¾ˆå¤§ï¼ï¼‰ã€‚ä½†æˆ‘ä»¬ä»è¦å‘Šè¯‰OpenGLå“ªäº›é¢æ˜¯æ­£å‘é¢(FrontFace)ï¼Œå“ªäº›é¢æ˜¯èƒŒå‘é¢(BackFace)ã€‚OpenGLä½¿ç”¨äº†ä¸€ä¸ªå¾ˆèªæ˜çš„æŠ€å·§ï¼Œåˆ†æé¡¶ç‚¹æ•°æ®çš„ç¯ç»•é¡ºåº(WindingOrder)ã€‚</p></blockquote><ol type="1"><li><p>ç¯ç»•é¡ºåº &gt;æ¯ç»„ç»„æˆä¸‰è§’å½¢å›¾å…ƒçš„ä¸‰ä¸ªé¡¶ç‚¹å°±åŒ…å«äº†ä¸€ä¸ªç¯ç»•é¡ºåºã€‚OpenGLåœ¨æ¸²æŸ“å›¾å…ƒçš„æ—¶å€™å°†ä½¿ç”¨è¿™ä¸ªä¿¡æ¯æ¥å†³å®šä¸€ä¸ªä¸‰è§’å½¢æ˜¯ä¸€ä¸ªæ­£å‘ä¸‰è§’å½¢è¿˜æ˜¯èƒŒå‘ä¸‰è§’å½¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé€†æ—¶é’ˆé¡¶ç‚¹æ‰€å®šä¹‰çš„ä¸‰è§’å½¢å°†ä¼šè¢«å¤„ç†ä¸ºæ­£å‘ä¸‰è§’å½¢ã€‚&gt;å½“ä½ å®šä¹‰é¡¶ç‚¹é¡ºåºçš„æ—¶å€™ï¼Œä½ åº”è¯¥æƒ³è±¡å¯¹åº”çš„ä¸‰è§’å½¢æ˜¯é¢å‘ä½ çš„ï¼Œæ‰€ä»¥ä½ å®šä¹‰çš„ä¸‰è§’å½¢ä»æ­£é¢çœ‹å»åº”è¯¥æ˜¯é€†æ—¶é’ˆçš„ã€‚è¿™æ ·å®šä¹‰é¡¶ç‚¹å¾ˆæ£’çš„ä¸€ç‚¹æ˜¯ï¼Œå®é™…çš„ç¯ç»•é¡ºåºæ˜¯åœ¨å…‰æ …åŒ–é˜¶æ®µè¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯é¡¶ç‚¹ç€è‰²å™¨è¿è¡Œä¹‹åã€‚è¿™äº›é¡¶ç‚¹å°±æ˜¯ä»è§‚å¯Ÿè€…è§†è§’æ‰€è§çš„äº†</p></li><li><p>é¢å‰”é™¤OpenGLèƒ½å¤Ÿä¸¢å¼ƒé‚£äº›æ¸²æŸ“ä¸ºèƒŒå‘ä¸‰è§’å½¢çš„ä¸‰è§’å½¢å›¾å…ƒã€‚æ—¢ç„¶å·²ç»çŸ¥é“å¦‚ä½•è®¾ç½®é¡¶ç‚¹çš„ç¯ç»•é¡ºåºäº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨OpenGLçš„é¢å‰”é™¤é€‰é¡¹äº†ï¼Œå®ƒé»˜è®¤æ˜¯ç¦ç”¨çŠ¶æ€çš„ã€‚<code>cpp         glEnable(GL_CULL_FACE);</code>glCullFaceå‡½æ•°æœ‰ä¸‰ä¸ªå¯ç”¨çš„é€‰é¡¹ï¼š</p><ul><li>GL_BACKï¼šåªå‰”é™¤èƒŒå‘é¢ã€‚</li><li>GL_FRONTï¼šåªå‰”é™¤æ­£å‘é¢ã€‚</li><li>GL_FRONT_AND_BACKï¼šå‰”é™¤æ­£å‘é¢å’ŒèƒŒå‘é¢ã€‚</li></ul><p>é™¤äº†éœ€è¦å‰”é™¤çš„é¢ä¹‹å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨<code>glFrontFace</code>ï¼Œå‘Šè¯‰OpenGLæˆ‘ä»¬å¸Œæœ›å°†é¡ºæ—¶é’ˆçš„é¢ï¼ˆè€Œä¸æ˜¯é€†æ—¶é’ˆçš„é¢ï¼‰å®šä¹‰ä¸ºæ­£å‘é¢ï¼š<code>cpp      glFrontFace(GL_CCW);</code>é»˜è®¤å€¼æ˜¯GL_CCWï¼Œå®ƒä»£è¡¨çš„æ˜¯é€†æ—¶é’ˆçš„ç¯ç»•é¡ºåºï¼Œå¦ä¸€ä¸ªé€‰é¡¹æ˜¯GL_CWï¼Œå®ƒï¼ˆæ˜¾ç„¶ï¼‰ä»£è¡¨çš„æ˜¯é¡ºæ—¶é’ˆé¡ºåºã€‚</p></li><li><p>ä»£ç è§£é‡Š</p><ul><li><p>é¦–å…ˆå¯ç”¨é¢å‰”é™¤<code>cpp          glEnable(GL_CULL_FACE);</code></p></li><li><p>æŒ‡å®šç»•å‘é¡ºåºå’Œå‰”é™¤é¢<code>cpp          // é»˜è®¤æƒ…å†µä¸‹ï¼Œé€†æ—¶é’ˆé¡¶ç‚¹æ‰€å®šä¹‰çš„ä¸‰è§’å½¢å°†ä¼šè¢«å¤„ç†ä¸ºæ­£å‘ä¸‰è§’å½¢ï¼Œ          //1. æŒ‡å®šæ­£é¢ä¸ºé€†æ—¶é’ˆï¼Œå†å‰”é™¤æ­£é¢ï¼Œåˆ™å‰”é™¤æ­£é¢          //glCullFace(GL_FRONT);          //glFrontFace(GL_CCW);          //2. æŒ‡å®šæ­£é¢ä¸ºé¡ºæ—¶é’ˆ(å®é™…çš„æ­£é¢è¢«æŒ‡å®šä¸ºäº†èƒŒé¢)ï¼Œç„¶åå‰”é™¤èƒŒé¢ï¼Œåˆ™æ•ˆæœä¸Šæ­£é¢è¢«å‰”é™¤äº†ã€‚          glCullFace(GL_BACK);          glFrontFace(GL_CW);</code></p></li></ul></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/04-gao-ji-opengl/03.hun-he-blending/"/>
      <url>/2022/08/10/opengl/04-gao-ji-opengl/03.hun-he-blending/</url>
      
        <content type="html"><![CDATA[<h2 id="æ··åˆblending">æ··åˆBlending</h2><blockquote><p>OpenGLä¸­ï¼Œæ··åˆ(Blending)é€šå¸¸æ˜¯å®ç°ç‰©ä½“é€æ˜åº¦(Transparency)çš„ä¸€ç§æŠ€æœ¯ã€‚é€æ˜å°±æ˜¯è¯´ä¸€ä¸ªç‰©ä½“ï¼ˆæˆ–è€…å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼‰ä¸æ˜¯çº¯è‰²(SolidColor)çš„ï¼Œå®ƒçš„é¢œè‰²æ˜¯ç‰©ä½“æœ¬èº«çš„é¢œè‰²å’Œå®ƒèƒŒåå…¶å®ƒç‰©ä½“çš„é¢œè‰²çš„ä¸åŒå¼ºåº¦ç»“åˆã€‚ä¸€ä¸ªæœ‰è‰²ç»ç’ƒçª—æ˜¯ä¸€ä¸ªé€æ˜çš„ç‰©ä½“ï¼Œç»ç’ƒæœ‰å®ƒè‡ªå·±çš„é¢œè‰²ï¼Œä½†å®ƒæœ€ç»ˆçš„é¢œè‰²è¿˜åŒ…å«äº†ç»ç’ƒä¹‹åæ‰€æœ‰ç‰©ä½“çš„é¢œè‰²ã€‚è¿™ä¹Ÿæ˜¯æ··åˆè¿™ä¸€åå­—çš„å‡ºå¤„ï¼Œæˆ‘ä»¬æ··åˆ(Blend)ï¼ˆä¸åŒç‰©ä½“çš„ï¼‰å¤šç§é¢œè‰²ä¸ºä¸€ç§é¢œè‰²ã€‚æ‰€ä»¥é€æ˜åº¦èƒ½è®©æˆ‘ä»¬çœ‹ç©¿ç‰©ä½“ã€‚æˆ‘ä»¬ç›®å‰ä¸€ç›´ä½¿ç”¨çš„çº¹ç†æœ‰ä¸‰ä¸ªé¢œè‰²åˆ†é‡ï¼šçº¢ã€ç»¿ã€è“ã€‚ä½†ä¸€äº›æè´¨ä¼šæœ‰ä¸€ä¸ªå†…åµŒçš„alphaé€šé“ï¼Œå¯¹æ¯ä¸ªçº¹ç´ (Texel)éƒ½åŒ…å«äº†ä¸€ä¸ªalphaå€¼</p></blockquote><ol type="1"><li><p>ä¸¢å¼ƒç‰‡å…ƒ<code>cpp         vec4 texColor = texture(texture1, TexCoords);         //å¯¹äºé€æ˜å¤„çš„ä¸¢å¼ƒ         if(texColor.a &lt; 0.1)             discard;         FragColor = texColor;</code></p></li><li><p>æ··åˆ &gt;è™½ç„¶ç›´æ¥ä¸¢å¼ƒç‰‡æ®µå¾ˆå¥½ï¼Œä½†å®ƒä¸èƒ½è®©æˆ‘ä»¬æ¸²æŸ“åŠé€æ˜çš„å›¾åƒã€‚æˆ‘ä»¬è¦ä¹ˆæ¸²æŸ“ä¸€ä¸ªç‰‡æ®µï¼Œè¦ä¹ˆå®Œå…¨ä¸¢å¼ƒå®ƒã€‚è¦æƒ³æ¸²æŸ“æœ‰å¤šä¸ªé€æ˜åº¦çº§åˆ«çš„å›¾åƒï¼Œæˆ‘ä»¬éœ€è¦å¯ç”¨æ··åˆ(Blending)ã€‚å’ŒOpenGLå¤§å¤šæ•°çš„åŠŸèƒ½ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å¯ç”¨GL_BLENDæ¥å¯ç”¨æ··åˆï¼š<code>glEnable(GL_BLEND);</code>å¯ç”¨äº†æ··åˆä¹‹åï¼Œæˆ‘ä»¬éœ€è¦å‘Šè¯‰OpenGLå®ƒè¯¥å¦‚ä½•æ··åˆã€‚</p><p>OpenGLä¸­çš„æ··åˆæ˜¯é€šè¿‡ä¸‹é¢è¿™ä¸ªæ–¹ç¨‹æ¥å®ç°çš„ï¼š <span class="math display">\[     \overline{C_{result}} = \overline{C_{source}}*\overline{F_{source}}+ \overline{C_{destination}}*\overline{F_{destination}}     C_{source}ï¼šæºé¢œè‰²å‘é‡ã€‚è¿™æ˜¯æºè‡ªçº¹ç†çš„é¢œè‰²å‘é‡ã€‚     C_{destination}ï¼šç›®æ ‡é¢œè‰²å‘é‡ã€‚è¿™æ˜¯å½“å‰å‚¨å­˜åœ¨é¢œè‰²ç¼“å†²ä¸­çš„é¢œè‰²å‘é‡ã€‚     F_{source}ï¼šæºå› å­å€¼ã€‚æŒ‡å®šäº†alphaå€¼å¯¹æºé¢œè‰²çš„å½±å“ã€‚     F_{destination}ï¼šç›®æ ‡å› å­å€¼ã€‚æŒ‡å®šäº†alphaå€¼å¯¹ç›®æ ‡é¢œè‰²çš„å½±å“ã€‚\]</span></p><p>TODO</p><table><thead><tr class="header"><th>è¡Œä¸º</th><th>æè¿°</th></tr></thead><tbody><tr class="odd"><td>GL_KEEP</td><td>ä¿æŒå½“å‰å‚¨å­˜çš„æ¨¡æ¿å€¼</td></tr><tr class="even"><td>GL_ZERO</td><td>å°†æ¨¡æ¿å€¼è®¾ç½®ä¸º0</td></tr><tr class="odd"><td>GL_REPLACE</td><td>å°†æ¨¡æ¿å€¼è®¾ç½®ä¸ºglStencilFuncå‡½æ•°è®¾ç½®çš„refå€¼</td></tr><tr class="even"><td>GL_INCR</td><td>å¦‚æœæ¨¡æ¿å€¼å°äºæœ€å¤§å€¼åˆ™å°†æ¨¡æ¿å€¼åŠ 1</td></tr><tr class="odd"><td>GL_INCR_WRAP</td><td>ä¸GL_INCRä¸€æ ·ï¼Œä½†å¦‚æœæ¨¡æ¿å€¼è¶…è¿‡äº†æœ€å¤§å€¼åˆ™å½’é›¶</td></tr><tr class="even"><td>GL_DECR</td><td>å¦‚æœæ¨¡æ¿å€¼å¤§äºæœ€å°å€¼åˆ™å°†æ¨¡æ¿å€¼å‡1</td></tr><tr class="odd"><td>GL_DECR_WRAP ä¸GL_DECRä¸€æ ·ï¼Œä½†å¦‚æœæ¨¡æ¿å€¼å°äº0åˆ™å°†å…¶è®¾ç½®ä¸ºæœ€å¤§å€¼</td><td></td></tr><tr class="even"><td>GL_INVERT</td><td>æŒ‰ä½ç¿»è½¬å½“å‰çš„æ¨¡æ¿ç¼“å†²å€¼</td></tr></tbody></table></li><li><p>æ¸²æŸ“åŠé€æ˜çº¹ç† &gt;<code>glBlendFunc(GLenum sfactor, GLenum dfactor)å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œæ¥è®¾ç½®æºå’Œç›®æ ‡å› å­</code></p><table><thead><tr class="header"><th>é€‰é¡¹</th><th>å€¼</th></tr></thead><tbody><tr class="odd"><td>GL_ZERO</td><td>å› å­ç­‰äº0</td></tr><tr class="even"><td>GL_ONE</td><td>å› å­ç­‰äº1</td></tr><tr class="odd"><td>GL_SRC_COLOR</td><td>å› å­ç­‰äºæºé¢œè‰²å‘é‡CÂ¯source</td></tr><tr class="even"><td>GL_ONE_MINUS_SRC_COLOR</td><td>å› å­ç­‰äº1âˆ’CÂ¯source</td></tr><tr class="odd"><td>GL_DST_COLOR</td><td>å› å­ç­‰äºç›®æ ‡é¢œè‰²å‘é‡CÂ¯destination</td></tr><tr class="even"><td>GL_ONE_MINUS_DST_COLOR</td><td>å› å­ç­‰äº1âˆ’CÂ¯destination</td></tr><tr class="odd"><td>GL_SRC_ALPHA</td><td>å› å­ç­‰äºCÂ¯sourceçš„alpha åˆ†é‡</td></tr><tr class="even"><td>GL_ONE_MINUS_SRC_ALPHA</td><td>å› å­ç­‰äº1âˆ’CÂ¯sourceçš„alphaåˆ†é‡</td></tr><tr class="odd"><td>GL_DST_ALPHA</td><td>å› å­ç­‰äºCÂ¯destinationçš„alphaåˆ†é‡</td></tr><tr class="even"><td>GL_ONE_MINUS_DST_ALPHA</td><td>å› å­ç­‰äº1âˆ’CÂ¯destinationçš„alphaåˆ†é‡</td></tr><tr class="odd"><td>GL_CONSTANT_COLOR</td><td>å› å­ç­‰äºå¸¸æ•°é¢œè‰²å‘é‡CÂ¯constant</td></tr><tr class="even"><td>GL_ONE_MINUS_CONSTANT_COLOR</td><td>å› å­ç­‰äº1âˆ’CÂ¯constant</td></tr><tr class="odd"><td>GL_CONSTANT_ALPHA</td><td>å› å­ç­‰äºCÂ¯constantçš„alphaåˆ†é‡</td></tr><tr class="even"><td>GL_ONE_MINUS_CONSTANT_ALPHA</td><td>å› å­ç­‰äº1âˆ’CÂ¯constantçš„alphaåˆ†é‡</td></tr></tbody></table><p>ä¹Ÿå¯ä»¥ä½¿ç”¨glBlendFuncSeparateä¸ºRGBå’Œalphaé€šé“åˆ†åˆ«è®¾ç½®ä¸åŒçš„é€‰é¡¹ï¼š<code>glBlendFuncSeparate(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA, GL_ONE, GL_ZERO);</code>æˆ‘ä»¬ä¹Ÿå¯ä»¥è®©å®ƒä»¬ç›¸å‡ã€‚glBlendEquation(GLenummode)å…è®¸æˆ‘ä»¬è®¾ç½®è¿ç®—ç¬¦ï¼Œå®ƒæä¾›äº†ä¸‰ä¸ªé€‰é¡¹ï¼šGL_FUNC_ADDï¼šé»˜è®¤é€‰é¡¹ï¼Œå°†ä¸¤ä¸ªåˆ†é‡ç›¸åŠ ï¼šCÂ¯result=Src+Dstã€‚GL_FUNC_SUBTRACTï¼šå°†ä¸¤ä¸ªåˆ†é‡ç›¸å‡ï¼š CÂ¯result=Srcâˆ’Dstã€‚GL_FUNC_REVERSE_SUBTRACTï¼šå°†ä¸¤ä¸ªåˆ†é‡ç›¸å‡ï¼Œä½†é¡ºåºç›¸åï¼šCÂ¯result=Dstâˆ’Srcã€‚</p><ol type="1"><li>åŒå…¶ä»–å‚æ•°ä¸€æ ·ï¼Œ</li></ol><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    glEnable<span class="op">(</span>GL_BLEND<span class="op">);</span> <span class="co">//å¼€å¯æ··åˆé€‰é¡¹</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    glBlendFunc<span class="op">(</span>GL_SRC_ALPHA<span class="op">,</span> GL_ONE_MINUS_SRC_ALPHA<span class="op">);</span> <span class="co">//è®¾ç½®æ··åˆå‡½æ•°</span></span></code></pre></div></li><li><p>æ’åºå¦‚æœä½ ä»”ç»†çœ‹çš„è¯ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°æœ‰äº›ä¸å¯¹åŠ²ã€‚æœ€å‰é¢çª—æˆ·çš„é€æ˜éƒ¨åˆ†é®è”½äº†èƒŒåçš„çª—æˆ·ï¼Ÿè¿™ä¸ºä»€ä¹ˆä¼šå‘ç”Ÿå‘¢ï¼Ÿå‘ç”Ÿè¿™ä¸€ç°è±¡çš„åŸå› æ˜¯ï¼Œæ·±åº¦æµ‹è¯•å’Œæ··åˆä¸€èµ·ä½¿ç”¨çš„è¯ä¼šäº§ç”Ÿä¸€äº›éº»çƒ¦ã€‚å½“å†™å…¥æ·±åº¦ç¼“å†²æ—¶ï¼Œæ·±åº¦ç¼“å†²ä¸ä¼šæ£€æŸ¥ç‰‡æ®µæ˜¯å¦æ˜¯é€æ˜çš„ï¼Œæ‰€ä»¥é€æ˜çš„éƒ¨åˆ†ä¼šå’Œå…¶å®ƒå€¼ä¸€æ ·å†™å…¥åˆ°æ·±åº¦ç¼“å†²ä¸­ã€‚ç»“æœå°±æ˜¯çª—æˆ·çš„æ•´ä¸ªå››è¾¹å½¢ä¸è®ºé€æ˜åº¦éƒ½ä¼šè¿›è¡Œæ·±åº¦æµ‹è¯•ã€‚å³ä½¿é€æ˜çš„éƒ¨åˆ†åº”è¯¥æ˜¾ç¤ºèƒŒåçš„çª—æˆ·ï¼Œæ·±åº¦æµ‹è¯•ä»ç„¶ä¸¢å¼ƒäº†å®ƒä»¬ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½éšæ„åœ°å†³å®šå¦‚ä½•æ¸²æŸ“çª—æˆ·ï¼Œè®©æ·±åº¦ç¼“å†²è§£å†³æ‰€æœ‰çš„é—®é¢˜äº†ã€‚è¿™ä¹Ÿæ˜¯æ··åˆå˜å¾—æœ‰äº›éº»çƒ¦çš„éƒ¨åˆ†ã€‚è¦æƒ³ä¿è¯çª—æˆ·ä¸­èƒ½å¤Ÿæ˜¾ç¤ºå®ƒä»¬èƒŒåçš„çª—æˆ·ï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆç»˜åˆ¶èƒŒåçš„è¿™éƒ¨åˆ†çª—æˆ·ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´åœ¨ç»˜åˆ¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆæ‰‹åŠ¨å°†çª—æˆ·æŒ‰ç…§æœ€è¿œåˆ°æœ€è¿‘æ¥æ’åºï¼Œå†æŒ‰ç…§é¡ºåºæ¸²æŸ“ã€‚</p><p>è¦æƒ³è®©æ··åˆåœ¨å¤šä¸ªç‰©ä½“ä¸Šå·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦æœ€å…ˆç»˜åˆ¶æœ€è¿œçš„ç‰©ä½“ï¼Œæœ€åç»˜åˆ¶æœ€è¿‘çš„ç‰©ä½“ã€‚æ™®é€šä¸éœ€è¦æ··åˆçš„ç‰©ä½“ä»ç„¶å¯ä»¥ä½¿ç”¨æ·±åº¦ç¼“å†²æ­£å¸¸ç»˜åˆ¶ï¼Œæ‰€ä»¥å®ƒä»¬ä¸éœ€è¦æ’åºã€‚ä½†æˆ‘ä»¬ä»è¦ä¿è¯å®ƒä»¬åœ¨ç»˜åˆ¶ï¼ˆæ’åºçš„ï¼‰é€æ˜ç‰©ä½“ä¹‹å‰å·²ç»ç»˜åˆ¶å®Œæ¯•äº†ã€‚å½“ç»˜åˆ¶ä¸€ä¸ªæœ‰ä¸é€æ˜å’Œé€æ˜ç‰©ä½“çš„åœºæ™¯çš„æ—¶å€™ï¼Œå¤§ä½“çš„åŸåˆ™å¦‚ä¸‹ï¼š</p><ol type="1"><li>å…ˆç»˜åˆ¶æ‰€æœ‰ä¸é€æ˜çš„ç‰©ä½“ã€‚</li><li>å¯¹æ‰€æœ‰é€æ˜çš„ç‰©ä½“æ’åºã€‚</li><li>æŒ‰é¡ºåºç»˜åˆ¶æ‰€æœ‰é€æ˜çš„ç‰©ä½“ã€‚</li></ol><p>è¿™é‡Œä½¿ç”¨è·ç¦»ç›¸æœºè·ç¦»è¿›è¡Œæ’åº<code>cpp      std::map&lt;float, glm::vec3&gt; sorted;      for (unsigned int i = 0; i &lt; windows.size(); i++)      {          float distance = glm::length(camera.Position - windows[i]);          sorted[distance] = windows[i];      }</code></p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/04-gao-ji-opengl/02.mo-ban-ce-shi/"/>
      <url>/2022/08/10/opengl/04-gao-ji-opengl/02.mo-ban-ce-shi/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¨¡æ¿æµ‹è¯•">æ¨¡æ¿æµ‹è¯•</h2><blockquote><p>å½“ç‰‡æ®µç€è‰²å™¨å¤„ç†å®Œä¸€ä¸ªç‰‡æ®µä¹‹åï¼Œæ¨¡æ¿æµ‹è¯•(StencilTest)ä¼šå¼€å§‹æ‰§è¡Œï¼Œå’Œæ·±åº¦æµ‹è¯•ä¸€æ ·ï¼Œå®ƒä¹Ÿå¯èƒ½ä¼šä¸¢å¼ƒç‰‡æ®µã€‚æ¥ä¸‹æ¥ï¼Œè¢«ä¿ç•™çš„ç‰‡æ®µä¼šè¿›å…¥æ·±åº¦æµ‹è¯•ï¼Œå®ƒå¯èƒ½ä¼šä¸¢å¼ƒæ›´å¤šçš„ç‰‡æ®µã€‚æ¨¡æ¿æµ‹è¯•æ˜¯æ ¹æ®åˆä¸€ä¸ªç¼“å†²æ¥è¿›è¡Œçš„ï¼Œå®ƒå«åšæ¨¡æ¿ç¼“å†²(StencilBuffer)ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¸²æŸ“çš„æ—¶å€™æ›´æ–°å®ƒæ¥è·å¾—ä¸€äº›å¾ˆæœ‰æ„æ€çš„æ•ˆæœã€‚</p></blockquote><blockquote><p>æ¨¡æ¿ç¼“å†²ä¸­çš„æ¨¡æ¿å€¼(StencilValue)é€šå¸¸æ˜¯8ä½çš„ï¼Œå› æ­¤æ¯ä¸ªç‰‡æ®µ/åƒç´ å…±æœ‰256ç§ä¸åŒçš„æ¨¡æ¿å€¼ï¼ˆè¯‘æ³¨ï¼š8ä½å°±æ˜¯1å­—èŠ‚å¤§å°,å¯è¡¨ç¤º256ä¸ªä¸åŒçš„å€¼ï¼Œå› æ­¤å’Œcharçš„å®¹é‡ä¸€æ ·æ˜¯256ä¸ªä¸åŒå€¼ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™äº›æ¨¡æ¿å€¼è®¾ç½®ä¸ºæˆ‘ä»¬æƒ³è¦çš„å€¼ï¼Œç„¶åå½“æŸä¸€ä¸ªç‰‡æ®µæœ‰æŸä¸€ä¸ªæ¨¡æ¿å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€‰æ‹©ä¸¢å¼ƒæˆ–æ˜¯ä¿ç•™è¿™ä¸ªç‰‡æ®µäº†ã€‚</p></blockquote><ol type="1"><li><p>å·¥ä½œè¿‡ç¨‹ &gt; éœ€è¦æ¯æ¬¡è¿­ä»£å‰æ¸…é™¤æ¨¡æ¿ç¼“å†²<code>glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT | GL_STENCIL_BUFFER_BIT);</code></p><ol type="1"><li>å¯ç”¨æ¨¡æ¿ç¼“å†²çš„å†™å…¥ã€‚ <code>glEnable(GL_STENCIL_TEST);</code></li><li>æ¸²æŸ“ç‰©ä½“ï¼Œæ›´æ–°æ¨¡æ¿ç¼“å†²çš„å†…å®¹ã€‚ <code>glStencilMask</code>, eg:</li></ol><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>   glStencilMask<span class="op">(</span><span class="bn">0xFF</span><span class="op">);</span> <span class="co">// æ¯ä¸€ä½å†™å…¥æ¨¡æ¿ç¼“å†²æ—¶éƒ½ä¿æŒåŸæ ·</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>   glStencilMask<span class="op">(</span><span class="bn">0x00</span><span class="op">);</span> <span class="co">// æ¯ä¸€ä½åœ¨å†™å…¥æ¨¡æ¿ç¼“å†²æ—¶éƒ½ä¼šå˜æˆ0ï¼ˆç¦ç”¨å†™å…¥ï¼‰</span></span></code></pre></div><ol start="3" type="1"><li>ç¦ç”¨æ¨¡æ¿ç¼“å†²çš„å†™å…¥ã€‚</li><li>æ¸²æŸ“ï¼ˆå…¶å®ƒï¼‰ç‰©ä½“ï¼Œè¿™æ¬¡æ ¹æ®æ¨¡æ¿ç¼“å†²çš„å†…å®¹ä¸¢å¼ƒç‰¹å®šçš„ç‰‡æ®µã€‚</li></ol></li><li><p>æ¨¡æ¿å‡½æ•° &gt;å’Œæ·±åº¦æµ‹è¯•ä¸€æ ·ï¼Œæˆ‘ä»¬å¯¹æ¨¡æ¿ç¼“å†²åº”è¯¥é€šè¿‡è¿˜æ˜¯å¤±è´¥ï¼Œä»¥åŠå®ƒåº”è¯¥å¦‚ä½•å½±å“æ¨¡æ¿ç¼“å†²ï¼Œä¹Ÿæ˜¯æœ‰ä¸€å®šæ§åˆ¶çš„ã€‚ä¸€å…±æœ‰ä¸¤ä¸ªå‡½æ•°èƒ½å¤Ÿç”¨æ¥é…ç½®æ¨¡æ¿æµ‹è¯•ï¼š<code>glStencilFuncå’ŒglStencilOpã€‚</code></p><p>glStencilFunc(GLenum func, GLint ref, GLuint mask)ä¸€å…±åŒ…å«ä¸‰ä¸ªå‚æ•° *funcï¼šè®¾ç½®æ¨¡æ¿æµ‹è¯•å‡½æ•°(Stencil TestFunction)ã€‚è¿™ä¸ªæµ‹è¯•å‡½æ•°å°†ä¼šåº”ç”¨åˆ°å·²å‚¨å­˜çš„æ¨¡æ¿å€¼ä¸Šå’ŒglStencilFuncå‡½æ•°çš„refå€¼ä¸Šã€‚å¯ç”¨çš„é€‰é¡¹æœ‰ï¼šGL_NEVERã€GL_LESSã€GL_LEQUALã€GL_GREATERã€GL_GEQUALã€GL_EQUALã€GL_NOTEQUALå’ŒGL_ALWAYSã€‚å®ƒä»¬çš„è¯­ä¹‰å’Œæ·±åº¦ç¼“å†²çš„å‡½æ•°ç±»ä¼¼ã€‚* refï¼šè®¾ç½®äº†æ¨¡æ¿æµ‹è¯•çš„å‚è€ƒå€¼(ReferenceValue)ã€‚æ¨¡æ¿ç¼“å†²çš„å†…å®¹å°†ä¼šä¸è¿™ä¸ªå€¼è¿›è¡Œæ¯”è¾ƒã€‚ *maskï¼šè®¾ç½®ä¸€ä¸ªæ©ç ï¼Œå®ƒå°†ä¼šä¸å‚è€ƒå€¼å’Œå‚¨å­˜çš„æ¨¡æ¿å€¼åœ¨æµ‹è¯•æ¯”è¾ƒå®ƒä»¬ä¹‹å‰è¿›è¡Œä¸(AND)è¿ç®—ã€‚åˆå§‹æƒ…å†µä¸‹æ‰€æœ‰ä½éƒ½ä¸º1ã€‚</p><p>ä½†æ˜¯glStencilFuncä»…ä»…æè¿°äº†OpenGLåº”è¯¥å¯¹æ¨¡æ¿ç¼“å†²å†…å®¹åšä»€ä¹ˆï¼Œè€Œä¸æ˜¯æˆ‘ä»¬åº”è¯¥å¦‚ä½•æ›´æ–°ç¼“å†²ã€‚è¿™å°±éœ€è¦glStencilOpè¿™ä¸ªå‡½æ•°äº†ã€‚glStencilOp(GLenum sfail, GLenum dpfail, GLenumdppass)ä¸€å…±åŒ…å«ä¸‰ä¸ªé€‰é¡¹ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè®¾å®šæ¯ä¸ªé€‰é¡¹åº”è¯¥é‡‡å–çš„è¡Œä¸ºï¼š *sfailï¼šæ¨¡æ¿æµ‹è¯•å¤±è´¥æ—¶é‡‡å–çš„è¡Œä¸ºã€‚ *dpfailï¼šæ¨¡æ¿æµ‹è¯•é€šè¿‡ï¼Œä½†æ·±åº¦æµ‹è¯•å¤±è´¥æ—¶é‡‡å–çš„è¡Œä¸ºã€‚ *dppassï¼šæ¨¡æ¿æµ‹è¯•å’Œæ·±åº¦æµ‹è¯•éƒ½é€šè¿‡æ—¶é‡‡å–çš„è¡Œä¸ºã€‚ * ä¸€èˆ¬å‚æ•°é»˜è®¤å€¼glStencilOp(GL_KEEP, GL_KEEP, GL_REPLACE);</p><table><thead><tr class="header"><th style="text-align: left;">è¡Œä¸º</th><th style="text-align: left;">æè¿°</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">GL_KEEP</td><td style="text-align: left;">ä¿æŒå½“å‰å‚¨å­˜çš„æ¨¡æ¿å€¼</td></tr><tr class="even"><td style="text-align: left;">GL_ZERO</td><td style="text-align: left;">å°†æ¨¡æ¿å€¼è®¾ç½®ä¸º0</td></tr><tr class="odd"><td style="text-align: left;">GL_REPLACE</td><td style="text-align: left;">å°†æ¨¡æ¿å€¼è®¾ç½®ä¸ºglStencilFuncå‡½æ•°è®¾ç½®çš„refå€¼</td></tr><tr class="even"><td style="text-align: left;">GL_INCR</td><td style="text-align: left;">å¦‚æœæ¨¡æ¿å€¼å°äºæœ€å¤§å€¼åˆ™å°†æ¨¡æ¿å€¼åŠ 1</td></tr><tr class="odd"><td style="text-align: left;">GL_INCR_WRAP</td><td style="text-align: left;">ä¸GL_INCRä¸€æ ·ï¼Œä½†å¦‚æœæ¨¡æ¿å€¼è¶…è¿‡äº†æœ€å¤§å€¼åˆ™å½’é›¶</td></tr><tr class="even"><td style="text-align: left;">GL_DECR</td><td style="text-align: left;">å¦‚æœæ¨¡æ¿å€¼å¤§äºæœ€å°å€¼åˆ™å°†æ¨¡æ¿å€¼å‡1</td></tr><tr class="odd"><td style="text-align: left;">GL_DECR_WRAPä¸GL_DECRä¸€æ ·ï¼Œä½†å¦‚æœæ¨¡æ¿å€¼å°äº0åˆ™å°†å…¶è®¾ç½®ä¸ºæœ€å¤§å€¼</td><td style="text-align: left;"></td></tr><tr class="even"><td style="text-align: left;">GL_INVERT</td><td style="text-align: left;">æŒ‰ä½ç¿»è½¬å½“å‰çš„æ¨¡æ¿ç¼“å†²å€¼</td></tr></tbody></table></li><li><p>ç‰©ä½“è½®å»“, ä¸ºç‰©ä½“åˆ›å»ºè½®å»“çš„æ­¥éª¤å¦‚ä¸‹ï¼š &gt;OpenGLçš„æŒ‡ä»¤å¼€å¯æˆ–å…³é—­ï¼Œç›´åˆ°ä¸‹æ¬¡æ”¹å˜å‰çš„æ¸²æŸ“éƒ½æ˜¯åŒä¸€ä¸ªçŠ¶æ€å€¼ã€‚</p><ol type="1"><li>åœ¨ç»˜åˆ¶ï¼ˆéœ€è¦æ·»åŠ è½®å»“çš„ï¼‰ç‰©ä½“ä¹‹å‰ï¼Œå°†æ¨¡æ¿å‡½æ•°è®¾ç½®ä¸ºGL_ALWAYSï¼Œæ­¤åç‰©ä½“çš„ç‰‡æ®µè¢«æ¸²æŸ“æ—¶ï¼Œå°†æ¨¡æ¿ç¼“å†²æ›´æ–°ä¸º1ã€‚<code>cpp          glStencilFunc(GL_ALWAYS, 1, 0xFF);          glStencilMask(0xFF);</code></li><li>æ¸²æŸ“ç‰©ä½“ã€‚ æ­¤æ—¶ä¼šå¾—åˆ°ä¹‹å‰ç‰©ä½“ä½œä¸ºæ¨¡æ¿ç¼“å†²ã€‚<code>cpp          //....          glDrawArrays(GL_TRIANGLES, 0, 36);</code></li><li>ç¦ç”¨æ¨¡æ¿å†™å…¥ä»¥åŠæ·±åº¦æµ‹è¯•ã€‚ <code>GL_NOTEQUAL</code>åªç»˜åˆ¶æ¨¡æ¿ä¹‹å¤–çš„åœ°æ–¹<code>cpp          glStencilFunc(GL_NOTEQUAL, 1, 0xFF);          glStencilMask(0x00);          //é¦–å…ˆæ·±åº¦æµ‹è¯•ä¸éœ€è¦ï¼Œå¦å¤–å¼€å¯çš„è¯ä¼šé€ æˆ`æ·±åº¦å†²çª`          glDisable(GL_DEPTH_TEST);</code></li><li>å°†æ¯ä¸ªç‰©ä½“ç¼©æ”¾ä¸€ç‚¹ç‚¹ã€‚ ç»˜åˆ¶çº¯è‰²çš„ç‰©ä½“ã€‚<code>cpp          glDrawArrays(GL_TRIANGLES, 0, 36);</code></li><li>ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„ç‰‡æ®µç€è‰²å™¨å†æ¬¡ç»˜åˆ¶ç‰©ä½“ï¼Œè¾“å‡ºä¸€ä¸ªå•ç‹¬çš„ï¼ˆè¾¹æ¡†ï¼‰é¢œè‰²ã€‚ä½†åªåœ¨å®ƒä»¬ç‰‡æ®µçš„æ¨¡æ¿å€¼ä¸ç­‰äº1æ—¶æ‰ç»˜åˆ¶ã€‚'ç»˜åˆ¶çš„çº¯è‰²ç‰©ä½“å’Œæ¨¡æ¿è¿›è¡Œæµ‹è¯•'</li><li>å†æ¬¡å¯ç”¨æ¨¡æ¿å†™å…¥å’Œæ·±åº¦æµ‹è¯•ã€‚</li></ol></li><li><p>ä¸»è¦ä»£ç <code>cpp         //1. æ¸…é™¤æ·±åº¦ç¼“å†²å’Œæ¨¡æ¿ç¼“å†²         {             glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT | GL_STENCIL_BUFFER_BIT); // don't forget to clear the stencil buffer!         }         outlineShader.use();         glm::mat4 model = glm::mat4(1.0f);         glm::mat4 view = camera.GetViewMatrix();         glm::mat4 projection = glm::perspective(glm::radians(camera.Zoom), (float)wWidth / (float)wHeight, 0.1f, 100.0f);         // ---- åŸºç¡€è®¾ç½®         {             //è®¾ç½®outlineShaderçš„VPçŸ©é˜µ             {                 outlineShader.setMat4("view", view);                 outlineShader.setMat4("projection", projection);             }             //è®¾ç½®shaderçš„VPçŸ©é˜µ             {                 shader.use();                 shader.setMat4("view", view);                 shader.setMat4("projection", projection);             }         }                //2. ç»˜åˆ¶Planï¼Œå¹¶è®¾ç½®ä¸ºä¸å½±å“æ¨¡æ¿(ç¦ç”¨æ¨¡æ¿å†™å…¥)         {             glStencilMask(0x00);             glBindVertexArray(planeVAO);             glBindTexture(GL_TEXTURE_2D, floorTexture);             shader.setMat4("model", glm::mat4(1.0f));             glDrawArrays(GL_TRIANGLES, 0, 6);             glBindVertexArray(0);         }         //3.ç»˜åˆ¶ä¸¤ä¸ªç®±å­ï¼Œå¹¶ä¸”å°†ç®±å­æ›´æ–°è¦†ç›–ä¸ºæ¨¡æ¿ç¼“å†²(å¼€å¯æ¨¡æ¿ï¼Œå¹¶æ¨¡æ¿æµ‹è¯•è®¾ç½®ä¸ºGL_ALWAYS)         {             glStencilFunc(GL_ALWAYS, 1, 0xFF);             glStencilMask(0xFF);                         glBindVertexArray(cubeVAO);             glActiveTexture(GL_TEXTURE0);             glBindTexture(GL_TEXTURE_2D, cubeTexture);             model = glm::translate(model, glm::vec3(-1.0f, 0.0f, -1.0f));             shader.setMat4("model", model);             glDrawArrays(GL_TRIANGLES, 0, 36);             model = glm::mat4(1.0f);             model = glm::translate(model, glm::vec3(2.0f, 0.0f, 0.0f));             shader.setMat4("model", model);             glDrawArrays(GL_TRIANGLES, 0, 36);         }            //4. ç»˜åˆ¶æ”¾å¤§åçš„ç®±å­,ä¸ç»˜åˆ¶åŸæœ‰ç®±å­çš„ä½ç½®,å¹¶ä¸”ä¸åˆ·æ–°æ¨¡æ¿ç¼“å†²,"å…³é—­æ·±åº¦æµ‹è¯•"(å…³é—­æ¨¡æ¿å†™å…¥ï¼Œå¹¶æ¨¡æ¿æµ‹è¯•è®¾ç½®ä¸ºGL_NOTEQUAL,æ·±åº¦æµ‹è¯•æ²¡æœ‰ç”¨æ­¤æ—¶å…³é—­å®ƒ)         {             glStencilFunc(GL_NOTEQUAL, 1, 0xFF);             glStencilMask(0x00);             glDisable(GL_DEPTH_TEST);             outlineShader.use();             float scale = 1.1;             // cubes             glBindVertexArray(cubeVAO);             glBindTexture(GL_TEXTURE_2D, cubeTexture);             model = glm::mat4(1.0f);             model = glm::translate(model, glm::vec3(-1.0f, 0.0f, -1.0f));             model = glm::scale(model, glm::vec3(scale, scale, scale));             outlineShader.setMat4("model", model);             glDrawArrays(GL_TRIANGLES, 0, 36);             model = glm::mat4(1.0f);             model = glm::translate(model, glm::vec3(2.0f, 0.0f, 0.0f));             model = glm::scale(model, glm::vec3(scale, scale, scale));             outlineShader.setMat4("model", model);             glDrawArrays(GL_TRIANGLES, 0, 36);         }         //5. æœ€åé‡ç½®é€‰é¡¹         {             glBindVertexArray(0);             glStencilMask(0xFF);             glStencilFunc(GL_ALWAYS, 0, 0xFF);             glEnable(GL_DEPTH_TEST);         }</code></p></li><li><p>UnityShader å¦ç±»æè¾¹å®ç° (ä¸ä½¿ç”¨æ¨¡æ¿å’Œnormal) &gt;ä¸¤æ¬¡ç»˜åˆ¶ï¼Œçº¯è‰²ç»˜åˆ¶ <code>æ”¾å¤§+ åç§»</code><code>cpp         Shader "Unlit/StencilTest"         {             Properties             {                 _MainTex ("Texture", 2D) = "white" {}             }             SubShader             {                 Tags { "RenderType"="Opaque" }                 LOD 100                              pass {                     CGPROGRAM                     #pragma vertex vert                     #pragma fragment frag                     // make fog work                     #pragma multi_compile_fog                     #include "UnityCG.cginc"                     struct appdata                     {                         float4 vertex : POSITION;                         float2 uv : TEXCOORD0;                     };                     struct v2f                     {                         float2 uv : TEXCOORD0;                         UNITY_FOG_COORDS(1)                         float4 vertex : SV_POSITION;                     };                     sampler2D _MainTex;                     float4 _MainTex_ST;                     v2f vert (appdata v)                     {                         v2f o;                         o.vertex = UnityObjectToClipPos(v.vertex);                         o.uv = TRANSFORM_TEX(v.uv, _MainTex);                         UNITY_TRANSFER_FOG(o,o.vertex);                         return o;                     }                     fixed4 frag (v2f i) : SV_Target                     {                         // sample the texture                         fixed4 col = tex2D(_MainTex, i.uv);                         // apply fog                         UNITY_APPLY_FOG(i.fogCoord, col);                         return col;                     }                     ENDCG                 }                 //Outline pass                 Pass                 {                     name "Outline"                     CGPROGRAM                     #pragma vertex vert                     #pragma fragment frag                     // make fog work                     #pragma multi_compile_fog                     #include "UnityCG.cginc"                                                             struct v2f                     {                         UNITY_FOG_COORDS(1)                         float4 vertex : SV_POSITION;                     };                     v2f vert (float4 vertex : POSITION)                     {                         v2f o;                         // ç¼©æ”¾ç³»æ•°`1.2`å¯è°ƒ                         float3 vvertex = vertex.xyz*1.2 - (ObjSpaceViewDir(vertex).xyz);                         o.vertex = UnityObjectToClipPos(float4(vvertex, vertex.w));                         UNITY_TRANSFER_FOG(o,o.vertex);                         return o;                     }                     fixed4 frag (v2f i) : SV_Target                     {                         return fixed4(0.7, 0.85, 0.3, 1);                     }                     ENDCG                 }             }         }</code></p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/04-gao-ji-opengl/01.shen-du-ce-shi/"/>
      <url>/2022/08/10/opengl/04-gao-ji-opengl/01.shen-du-ce-shi/</url>
      
        <content type="html"><![CDATA[<h2 id="æ·±åº¦æµ‹è¯•">æ·±åº¦æµ‹è¯•</h2><blockquote><p>è®¨è®ºè¿™äº›å‚¨å­˜åœ¨æ·±åº¦ç¼“å†²ï¼ˆæˆ–zç¼“å†²(z-buffer)ï¼‰ä¸­çš„æ·±åº¦å€¼(DepthValue)ï¼Œä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•ç¡®å®šä¸€ä¸ªç‰‡æ®µæ˜¯å¤„äºå…¶å®ƒç‰‡æ®µåæ–¹çš„ã€‚æ·±åº¦ç¼“å†²å°±åƒé¢œè‰²ç¼“å†²(ColorBuffer)ï¼ˆå‚¨å­˜æ‰€æœ‰çš„ç‰‡æ®µé¢œè‰²ï¼šè§†è§‰è¾“å‡ºï¼‰ä¸€æ ·ï¼Œåœ¨æ¯ä¸ªç‰‡æ®µä¸­å‚¨å­˜äº†ä¿¡æ¯ï¼Œå¹¶ä¸”ï¼ˆé€šå¸¸ï¼‰å’Œé¢œè‰²ç¼“å†²æœ‰ç€ä¸€æ ·çš„å®½åº¦å’Œé«˜åº¦ã€‚æ·±åº¦ç¼“å†²æ˜¯ç”±çª—å£ç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºçš„ï¼Œå®ƒä¼šä»¥16ã€24æˆ–32ä½floatçš„å½¢å¼å‚¨å­˜å®ƒçš„æ·±åº¦å€¼ã€‚åœ¨å¤§éƒ¨åˆ†çš„ç³»ç»Ÿä¸­ï¼Œæ·±åº¦ç¼“å†²çš„ç²¾åº¦éƒ½æ˜¯24ä½çš„ã€‚1. å·¥ä½œè¿‡ç¨‹</p></blockquote><p>å½“æ·±åº¦æµ‹è¯•(DepthTesting)è¢«å¯ç”¨çš„æ—¶å€™ï¼ŒOpenGLä¼šå°†ä¸€ä¸ªç‰‡æ®µçš„çš„æ·±åº¦å€¼ä¸æ·±åº¦ç¼“å†²çš„å†…å®¹è¿›è¡Œå¯¹æ¯”ã€‚OpenGLä¼šæ‰§è¡Œä¸€ä¸ªæ·±åº¦æµ‹è¯•ï¼Œå¦‚æœè¿™ä¸ªæµ‹è¯•é€šè¿‡äº†çš„è¯ï¼Œæ·±åº¦ç¼“å†²å°†ä¼šæ›´æ–°ä¸ºæ–°çš„æ·±åº¦å€¼ã€‚å¦‚æœæ·±åº¦æµ‹è¯•å¤±è´¥äº†ï¼Œç‰‡æ®µå°†ä¼šè¢«ä¸¢å¼ƒã€‚</p><ol start="2" type="1"><li>å·¥ä½œé˜¶æ®µ</li></ol><p>æ·±åº¦ç¼“å†²æ˜¯åœ¨ç‰‡æ®µç€è‰²å™¨è¿è¡Œä¹‹åï¼ˆä»¥åŠæ¨¡æ¿æµ‹è¯•(StencilTesting)è¿è¡Œä¹‹åï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­è®¨è®ºï¼‰åœ¨å±å¹•ç©ºé—´ä¸­è¿è¡Œçš„ã€‚å±å¹•ç©ºé—´åæ ‡ä¸é€šè¿‡OpenGLçš„glViewportæ‰€å®šä¹‰çš„è§†å£å¯†åˆ‡ç›¸å…³ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥ä½¿ç”¨GLSLå†…å»ºå˜é‡gl_FragCoordä»ç‰‡æ®µç€è‰²å™¨ä¸­ç›´æ¥è®¿é—®ã€‚gl_FragCoordçš„xå’Œyåˆ†é‡ä»£è¡¨äº†ç‰‡æ®µçš„å±å¹•ç©ºé—´åæ ‡ï¼ˆå…¶ä¸­(0,0)ä½äºå·¦ä¸‹è§’ï¼‰ã€‚gl_FragCoordä¸­ä¹ŸåŒ…å«äº†ä¸€ä¸ªzåˆ†é‡ï¼Œå®ƒåŒ…å«äº†ç‰‡æ®µçœŸæ­£çš„æ·±åº¦å€¼ã€‚zå€¼å°±æ˜¯éœ€è¦ä¸æ·±åº¦ç¼“å†²å†…å®¹æ‰€å¯¹æ¯”çš„é‚£ä¸ªå€¼ã€‚</p><ol start="3" type="1"><li>é™„åŠ é˜¶æ®µ</li></ol><p>ç°åœ¨å¤§éƒ¨åˆ†çš„GPUéƒ½æä¾›ä¸€ä¸ªå«åšæå‰æ·±åº¦æµ‹è¯•(Early DepthTesting)çš„ç¡¬ä»¶ç‰¹æ€§ã€‚æå‰æ·±åº¦æµ‹è¯•å…è®¸æ·±åº¦æµ‹è¯•åœ¨ç‰‡æ®µç€è‰²å™¨ä¹‹å‰è¿è¡Œã€‚åªè¦æˆ‘ä»¬æ¸…æ¥šä¸€ä¸ªç‰‡æ®µæ°¸è¿œä¸ä¼šæ˜¯å¯è§çš„ï¼ˆå®ƒåœ¨å…¶ä»–ç‰©ä½“ä¹‹åï¼‰ï¼Œæˆ‘ä»¬å°±èƒ½æå‰ä¸¢å¼ƒè¿™ä¸ªç‰‡æ®µã€‚</p><ol start="4" type="1"><li><p>ä½¿ç”¨ &gt;æ·±åº¦æµ‹è¯•é»˜è®¤æ˜¯ç¦ç”¨çš„ï¼Œæ‰€ä»¥å¦‚æœè¦å¯ç”¨æ·±åº¦æµ‹è¯•çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦ç”¨GL_DEPTH_TESTé€‰é¡¹æ¥å¯ç”¨å®ƒï¼š<code>cpp         glEnable(GL_DEPTH_TEST);</code></p><p>å› ä¸ºå‚¨å­˜äº†æ·±åº¦å€¼ï¼Œæ‰€ä»¥æ¯æ¬¡å¾ªç¯å‰éœ€è¦ä½¿ç”¨<code>GL_DEPTH_BUFFER_BIT</code>æ¥æ¸…é™¤æ·±åº¦ç¼“å†²,å¦åˆ™ä½ ä¼šä»åœ¨ä½¿ç”¨ä¸Šä¸€æ¬¡æ¸²æŸ“è¿­ä»£ä¸­çš„å†™å…¥çš„æ·±åº¦å€¼<code>cpp      glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</code></p><p>ä»…è¿›è¡Œæ·±åº¦æµ‹è¯•ï¼Œä¸æ›´æ–°æ·±åº¦å€¼ã€‚ä¹Ÿå°±æ˜¯å¸Œæœ›ä½¿ç”¨ä¸€ä¸ªåªè¯»çš„(Read-only)æ·±åº¦ç¼“å†²ï¼Œåˆ™å¯ä»¥è®¾ç½®æ·±åº¦æ©ç ä¸º<code>false</code><code>cpp      glDepthMask(GL_FALSE);</code></p><p>è®¾ç½®æ·±åº¦æµ‹è¯•çš„è¿ç®—ç¬¦ <code>æ·±åº¦æµ‹è¯•å‡½æ•°glDepthFunc</code><code>cpp      glDepthFunc(GL_LESS);</code> |å‡½æ•° | æè¿° | |:- | :- ||GL_ALWAYS |æ°¸è¿œé€šè¿‡æ·±åº¦æµ‹è¯•| |GL_NEVER |æ°¸è¿œä¸é€šè¿‡æ·±åº¦æµ‹è¯•| |GL_LESS|åœ¨ç‰‡æ®µæ·±åº¦å€¼å°äºç¼“å†²çš„æ·±åº¦å€¼æ—¶é€šè¿‡æµ‹è¯•| |GL_EQUAL|åœ¨ç‰‡æ®µæ·±åº¦å€¼ç­‰äºç¼“å†²åŒºçš„æ·±åº¦å€¼æ—¶é€šè¿‡æµ‹è¯•| |GL_LEQUAL|åœ¨ç‰‡æ®µæ·±åº¦å€¼å°äºç­‰äºç¼“å†²åŒºçš„æ·±åº¦å€¼æ—¶é€šè¿‡æµ‹è¯•| |GL_GREATER|åœ¨ç‰‡æ®µæ·±åº¦å€¼å¤§äºç¼“å†²åŒºçš„æ·±åº¦å€¼æ—¶é€šè¿‡æµ‹è¯•||GL_NOTEQUAL|åœ¨ç‰‡æ®µæ·±åº¦å€¼ä¸ç­‰äºç¼“å†²åŒºçš„æ·±åº¦å€¼æ—¶é€šè¿‡æµ‹è¯•| |GL_GEQUAL|åœ¨ç‰‡æ®µæ·±åº¦å€¼å¤§äºç­‰äºç¼“å†²åŒºçš„æ·±åº¦å€¼æ—¶é€šè¿‡æµ‹è¯•|</p></li><li><p>æ·±åº¦å€¼ç²¾åº¦ &gt;æ·±åº¦ç¼“å†²åŒ…å«äº†ä¸€ä¸ªä»‹äº0.0å’Œ1.0ä¹‹é—´çš„æ·±åº¦å€¼ï¼Œå®ƒå°†ä¼šä¸è§‚å¯Ÿè€…è§†è§’æ‰€çœ‹è§çš„åœºæ™¯ä¸­æ‰€æœ‰ç‰©ä½“çš„zå€¼è¿›è¡Œæ¯”è¾ƒã€‚è§‚å¯Ÿç©ºé—´çš„zå€¼å¯èƒ½æ˜¯æŠ•å½±å¹³æˆªå¤´ä½“çš„è¿‘å¹³é¢(Near)å’Œè¿œå¹³é¢(Far)ä¹‹é—´çš„ä»»ä½•å€¼ã€‚æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼æ¥å°†è¿™äº›è§‚å¯Ÿç©ºé—´çš„zå€¼å˜æ¢åˆ°[0,1]èŒƒå›´ä¹‹é—´ï¼Œå…¶ä¸­çš„ä¸€ç§æ–¹å¼å°±æ˜¯å°†å®ƒä»¬çº¿æ€§å˜æ¢åˆ°[0,1]èŒƒå›´ä¹‹é—´ã€‚ä¸‹é¢è¿™ä¸ªï¼ˆçº¿æ€§ï¼‰æ–¹ç¨‹å°†zå€¼å˜æ¢åˆ°äº†0.0åˆ°1.0ä¹‹é—´çš„æ·±åº¦å€¼ï¼š</p><p><span class="math display">\[F_{depth} = \frac{z - near}{far - near}, ä»è¿‘åˆ°è¿œæ’å€¼ã€‚\]</span></p><p>å®é™…åº”ç”¨ä¸­ä¸é€‚ç”¨çº¿æ€§æ·±åº¦ç¼“å†²ï¼Œè€Œæ˜¯ä½¿ç”¨ å€’æ•°ï¼Œç”±äºéçº¿æ€§æ–¹ç¨‹ä¸ 1/zæˆæ­£æ¯”ï¼Œåœ¨1.0å’Œ2.0ä¹‹é—´çš„zå€¼å°†ä¼šå˜æ¢è‡³1.0åˆ°0.5ä¹‹é—´çš„æ·±åº¦å€¼ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªfloatæä¾›ç»™æˆ‘ä»¬çš„ä¸€åŠç²¾åº¦äº†ï¼Œè¿™åœ¨zå€¼å¾ˆå°çš„æƒ…å†µä¸‹æä¾›äº†éå¸¸å¤§çš„ç²¾åº¦ã€‚åœ¨50.0å’Œ100.0ä¹‹é—´çš„zå€¼å°†ä¼šåªå 2%çš„floatç²¾åº¦ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ã€‚è¿™æ ·çš„ä¸€ä¸ªè€ƒè™‘äº†è¿œè¿‘è·ç¦»çš„æ–¹ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><p><span class="math display">\[F_{depth} = \frac{\frac{1}{z} - \frac{1}{near}}{\frac{1}{far} -\frac{1}{near}}, ä»è¿‘åˆ°è¿œæ’å€¼ã€‚\]</span></p></li><li><p>æ·±åº¦å¯è§†åŒ–&gt;å†…å»ºgl_FragCoordå‘é‡çš„<code>zå€¼</code>åŒ…å«äº†é‚£ä¸ªç‰¹å®šç‰‡æ®µçš„æ·±åº¦å€¼&gt;é¢œè‰²å¤§éƒ¨åˆ†éƒ½æ˜¯é»‘è‰²ï¼Œå› ä¸ºæ·±åº¦å€¼çš„èŒƒå›´æ˜¯0.1çš„è¿‘å¹³é¢åˆ°100çš„è¿œå¹³é¢ï¼Œå®ƒç¦»æˆ‘ä»¬è¿˜æ˜¯éå¸¸è¿œçš„ã€‚ç»“æœå°±æ˜¯ï¼Œæˆ‘ä»¬ç›¸å¯¹é è¿‘è¿‘å¹³é¢ï¼Œæ‰€ä»¥ä¼šå¾—åˆ°æ›´ä½çš„ï¼ˆæ›´æš—çš„ï¼‰æ·±åº¦å€¼ã€‚</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> vec4<span class="op">(</span>vec3<span class="op">(</span>gl_FragCoord<span class="op">.</span>z<span class="op">),</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><p>ç”±äº<code>gl_FragCoord.z</code>éçº¿æ€§çš„ï¼Œæ‰€ä»¥è½¬æ¢ä¸ºçº¿æ€§çš„ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦é¦–å…ˆå°†æ·±åº¦å€¼ä»[0,1]èŒƒå›´é‡æ–°å˜æ¢åˆ°[-1, 1]èŒƒå›´çš„æ ‡å‡†åŒ–è®¾å¤‡åæ ‡ï¼ˆè£å‰ªç©ºé—´ï¼‰</p><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> z <span class="op">=</span> depth <span class="op">*</span> <span class="fl">2.0</span> <span class="op">-</span> <span class="fl">1.0</span><span class="op">;</span></span></code></pre></div><p>æ¥ä¸‹æ¥ä½¿ç”¨è·å–åˆ°çš„zå€¼ï¼Œåº”ç”¨é€†å˜æ¢æ¥è·å–çº¿æ€§çš„æ·±åº¦å€¼,è¿™ä¸ªæ–¹ç¨‹æ˜¯ç”¨æŠ•å½±çŸ©é˜µæ¨å¯¼å¾—å‡ºçš„<code>cpp      float linearDepth = (2.0 * near * far) / (far + near - z * (far - near));</code></p></li><li><p>æ·±åº¦å†²çª &gt;ä¸€ä¸ªå¾ˆå¸¸è§çš„è§†è§‰é”™è¯¯ä¼šåœ¨ä¸¤ä¸ªå¹³é¢æˆ–è€…ä¸‰è§’å½¢éå¸¸ç´§å¯†åœ°å¹³è¡Œæ’åˆ—åœ¨ä¸€èµ·æ—¶ä¼šå‘ç”Ÿï¼Œæ·±åº¦ç¼“å†²æ²¡æœ‰è¶³å¤Ÿçš„ç²¾åº¦æ¥å†³å®šä¸¤ä¸ªå½¢çŠ¶å“ªä¸ªåœ¨å‰é¢ã€‚ç»“æœå°±æ˜¯è¿™ä¸¤ä¸ªå½¢çŠ¶ä¸æ–­åœ°åœ¨åˆ‡æ¢å‰åé¡ºåºï¼Œè¿™ä¼šå¯¼è‡´å¾ˆå¥‡æ€ªçš„èŠ±çº¹ã€‚è¿™ä¸ªç°è±¡å«åšæ·±åº¦å†²çª(Z-fighting)ï¼Œå› ä¸ºå®ƒçœ‹èµ·æ¥åƒæ˜¯è¿™ä¸¤ä¸ªå½¢çŠ¶åœ¨äº‰å¤º(Fight)è°è¯¥å¤„äºé¡¶ç«¯ã€‚</p><ol type="1"><li>é˜²æ­¢æ·±åº¦å†²çª<ul><li>ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯æœ€é‡è¦çš„æŠ€å·§æ˜¯æ°¸è¿œä¸è¦æŠŠå¤šä¸ªç‰©ä½“æ‘†å¾—å¤ªé è¿‘ï¼Œä»¥è‡³äºå®ƒä»¬çš„ä¸€äº›ä¸‰è§’å½¢ä¼šé‡å ã€‚</li><li>ç¬¬äºŒä¸ªæŠ€å·§æ˜¯å°½å¯èƒ½å°†è¿‘å¹³é¢è®¾ç½®è¿œä¸€äº›ã€‚åœ¨å‰é¢æˆ‘ä»¬æåˆ°äº†ç²¾åº¦åœ¨é è¿‘è¿‘å¹³é¢æ—¶æ˜¯éå¸¸é«˜çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬å°†è¿‘å¹³é¢è¿œç¦»è§‚å¯Ÿè€…ï¼Œæˆ‘ä»¬å°†ä¼šå¯¹æ•´ä¸ªå¹³æˆªå¤´ä½“æœ‰ç€æ›´å¤§çš„ç²¾åº¦ã€‚</li><li>å¦å¤–ä¸€ä¸ªå¾ˆå¥½çš„æŠ€å·§æ˜¯ç‰ºç‰²ä¸€äº›æ€§èƒ½ï¼Œä½¿ç”¨æ›´é«˜ç²¾åº¦çš„æ·±åº¦ç¼“å†²ã€‚å¤§éƒ¨åˆ†æ·±åº¦ç¼“å†²çš„ç²¾åº¦éƒ½æ˜¯24ä½çš„ï¼Œä½†ç°åœ¨å¤§éƒ¨åˆ†çš„æ˜¾å¡éƒ½æ”¯æŒ32ä½çš„æ·±åº¦ç¼“å†²ï¼Œè¿™å°†ä¼šæå¤§åœ°æé«˜ç²¾åº¦ã€‚æ‰€ä»¥ï¼Œç‰ºç‰²æ‰ä¸€äº›æ€§èƒ½ï¼Œä½ å°±èƒ½è·å¾—æ›´é«˜ç²¾åº¦çš„æ·±åº¦æµ‹è¯•ï¼Œå‡å°‘æ·±åº¦å†²çªã€‚</li></ul></li></ol></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/03-mo-xing-jia-zai/3.mo-xing-model/"/>
      <url>/2022/08/10/opengl/03-mo-xing-jia-zai/3.mo-xing-model/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¨¡å‹model">æ¨¡å‹model</h2><blockquote><p>æ¨¡å‹model, å°è£…ä¸€ä¸ªåŒ…å«æ¸²æŸ“çš„åŸºç¡€æ•°æ®</p></blockquote><ol type="1"><li><p>æ¨¡å‹</p><blockquote><p>æ‹¥æœ‰çš„åŠŸèƒ½ï¼š1.ä»æ¨¡å‹æ–‡ä»¶åŠ è½½ã€2.è§£ææ¨¡å‹æ–‡ä»¶ï¼ˆé¡¶ç‚¹æ•°æ®ï¼Œè´´å›¾æ•°æ®ç­‰ï¼‰3.ç»˜åˆ¶åŠŸèƒ½çš„å°è£…ã€‚</p></blockquote><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Model </span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span><span class="op">:</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>            <span class="co">/*  å‡½æ•°   */</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>            Model<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>path<span class="op">)</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                loadModel<span class="op">(</span>path<span class="op">);</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">void</span> Draw<span class="op">(</span>Shader shader<span class="op">);</span>   </span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span><span class="op">:</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">/*  æ¨¡å‹æ•°æ®  */</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>            vector<span class="op">&lt;</span>Mesh<span class="op">&gt;</span> meshes<span class="op">;</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>            string directory<span class="op">;</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            <span class="co">/*  å‡½æ•°   */</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            <span class="dt">void</span> loadModel<span class="op">(</span>string path<span class="op">);</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">void</span> processNode<span class="op">(</span>aiNode <span class="op">*</span>node<span class="op">,</span> <span class="at">const</span> aiScene <span class="op">*</span>scene<span class="op">);</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>            Mesh processMesh<span class="op">(</span>aiMesh <span class="op">*</span>mesh<span class="op">,</span> <span class="at">const</span> aiScene <span class="op">*</span>scene<span class="op">);</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            vector<span class="op">&lt;</span>Texture<span class="op">&gt;</span> loadMaterialTextures<span class="op">(</span>aiMaterial <span class="op">*</span>mat<span class="op">,</span> aiTextureType type<span class="op">,</span> </span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                                                 string typeName<span class="op">);</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div><ol type="1"><li><p>ä»æ–‡ä»¶å¯¼å…¥</p><blockquote><p>å€ŸåŠ©<code>assimp</code>æ’ä»¶</p><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assimp/Importer.hpp&gt;</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assimp/scene.h&gt;</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assimp/postprocess.h&gt;</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>Assimp<span class="op">::</span>Importer importer<span class="op">;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> aiScene <span class="op">*</span>scene <span class="op">=</span> importer<span class="op">.</span>ReadFile<span class="op">(</span>path<span class="op">,</span> aiProcess_Triangulate <span class="op">|</span> aiProcess_FlipUVs<span class="op">);</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>ã€‚ã€‚ã€‚</span></code></pre></div></blockquote></li><li><p>è§£ææ•°æ®</p><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>glm<span class="op">::</span>vec3 vector<span class="op">;</span> </span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co">//position</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>vector<span class="op">.</span>x <span class="op">=</span> mesh<span class="op">-&gt;</span>mVertices<span class="op">[</span>i<span class="op">].</span>x<span class="op">;</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>vector<span class="op">.</span>y <span class="op">=</span> mesh<span class="op">-&gt;</span>mVertices<span class="op">[</span>i<span class="op">].</span>y<span class="op">;</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>vector<span class="op">.</span>z <span class="op">=</span> mesh<span class="op">-&gt;</span>mVertices<span class="op">[</span>i<span class="op">].</span>z<span class="op">;</span> </span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>vertex<span class="op">.</span>Position <span class="op">=</span> vector<span class="op">;</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">//normal</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>vector<span class="op">.</span>x <span class="op">=</span> mesh<span class="op">-&gt;</span>mNormals<span class="op">[</span>i<span class="op">].</span>x<span class="op">;</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>vector<span class="op">.</span>y <span class="op">=</span> mesh<span class="op">-&gt;</span>mNormals<span class="op">[</span>i<span class="op">].</span>y<span class="op">;</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>vector<span class="op">.</span>z <span class="op">=</span> mesh<span class="op">-&gt;</span>mNormals<span class="op">[</span>i<span class="op">].</span>z<span class="op">;</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>vertex<span class="op">.</span>Normal <span class="op">=</span> vector<span class="op">;</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">//TextureCoord</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>mesh<span class="op">-&gt;</span>mTextureCoords<span class="op">[</span><span class="dv">0</span><span class="op">])</span> <span class="co">// ç½‘æ ¼æ˜¯å¦æœ‰çº¹ç†åæ ‡ï¼Ÿ</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    glm<span class="op">::</span>vec2 vec<span class="op">;</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    vec<span class="op">.</span>x <span class="op">=</span> mesh<span class="op">-&gt;</span>mTextureCoords<span class="op">[</span><span class="dv">0</span><span class="op">][</span>i<span class="op">].</span>x<span class="op">;</span> </span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    vec<span class="op">.</span>y <span class="op">=</span> mesh<span class="op">-&gt;</span>mTextureCoords<span class="op">[</span><span class="dv">0</span><span class="op">][</span>i<span class="op">].</span>y<span class="op">;</span></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    vertex<span class="op">.</span>TexCoords <span class="op">=</span> vec<span class="op">;</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    vertex<span class="op">.</span>TexCoords <span class="op">=</span> glm<span class="op">::</span>vec2<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">// ã€‚ã€‚ã€‚ã€‚</span></span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">//ä¸‰è§’å½¢</span></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> mesh<span class="op">-&gt;</span>mNumFaces<span class="op">;</span> i<span class="op">++)</span></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    aiFace face <span class="op">=</span> mesh<span class="op">-&gt;</span>mFaces<span class="op">[</span>i<span class="op">];</span></span><span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> face<span class="op">.</span>mNumIndices<span class="op">;</span> j<span class="op">++)</span></span><span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>        indices<span class="op">.</span>push_back<span class="op">(</span>face<span class="op">.</span>mIndices<span class="op">[</span>j<span class="op">]);</span></span><span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co">//çº¹ç†</span></span><span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span><span class="op">(</span>mesh<span class="op">-&gt;</span>mMaterialIndex <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">)</span></span><span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    aiMaterial <span class="op">*</span>material <span class="op">=</span> scene<span class="op">-&gt;</span>mMaterials<span class="op">[</span>mesh<span class="op">-&gt;</span>mMaterialIndex<span class="op">];</span></span><span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">&lt;</span>Texture<span class="op">&gt;</span> diffuseMaps <span class="op">=</span> loadMaterialTextures<span class="op">(</span>material<span class="op">,</span> </span><span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>                                        aiTextureType_DIFFUSE<span class="op">,</span> <span class="st">"texture_diffuse"</span><span class="op">);</span></span><span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    textures<span class="op">.</span>insert<span class="op">(</span>textures<span class="op">.</span>end<span class="op">(),</span> diffuseMaps<span class="op">.</span>begin<span class="op">(),</span> diffuseMaps<span class="op">.</span>end<span class="op">());</span></span><span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>    vector<span class="op">&lt;</span>Texture<span class="op">&gt;</span> specularMaps <span class="op">=</span> loadMaterialTextures<span class="op">(</span>material<span class="op">,</span> </span><span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>                                        aiTextureType_SPECULAR<span class="op">,</span> <span class="st">"texture_specular"</span><span class="op">);</span></span><span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>    textures<span class="op">.</span>insert<span class="op">(</span>textures<span class="op">.</span>end<span class="op">(),</span> specularMaps<span class="op">.</span>begin<span class="op">(),</span> specularMaps<span class="op">.</span>end<span class="op">());</span></span><span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li><li><p>ç»˜åˆ¶åŠŸèƒ½<code>cpp          void Draw(Shader shader)          {              for(unsigned int i = 0; i &lt; meshes.size(); i++)                  meshes[i].Draw(shader);          }</code></p></li></ol></li><li><p>çº¹ç†ç»“æ„<code>cpp         struct Texture {             unsigned int id; //çº¹ç†id             string type;    //çº¹ç†ç±»å‹         };</code></p></li><li><p>ç½‘æ ¼Mesh &gt; å‡†å¤‡å¥½é¡¶ç‚¹å’Œçº¹ç†ç»“æ„ï¼Œåˆ™å¯ä»¥å‡†å¤‡meshç»“æ„äº†</p><div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Mesh <span class="op">{</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span><span class="op">:</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>            <span class="co">/*  ç½‘æ ¼æ•°æ®  */</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>            vector<span class="op">&lt;</span>Vertex<span class="op">&gt;</span> vertices<span class="op">;</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>            vector<span class="op">&lt;</span><span class="dt">unsigned</span> <span class="dt">int</span><span class="op">&gt;</span> indices<span class="op">;</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>            vector<span class="op">&lt;</span>Texture<span class="op">&gt;</span> textures<span class="op">;</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>            <span class="co">/*  å‡½æ•°  */</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            Mesh<span class="op">(</span>vector<span class="op">&lt;</span>Vertex<span class="op">&gt;</span> vertices<span class="op">,</span> vector<span class="op">&lt;</span><span class="dt">unsigned</span> <span class="dt">int</span><span class="op">&gt;</span> indices<span class="op">,</span> vector<span class="op">&lt;</span>Texture<span class="op">&gt;</span> textures<span class="op">);</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">void</span> Draw<span class="op">(</span>Shader shader<span class="op">);</span></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span><span class="op">:</span></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">/*  æ¸²æŸ“æ•°æ®  */</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">unsigned</span> <span class="dt">int</span> VAO<span class="op">,</span> VBO<span class="op">,</span> EBO<span class="op">;</span></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>            <span class="co">/*  å‡½æ•°  */</span></span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">void</span> setupMesh<span class="op">();</span></span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span>  </span></code></pre></div><div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>    Mesh<span class="op">(</span>vector<span class="op">&lt;</span>Vertex<span class="op">&gt;</span> vertices<span class="op">,</span> vector<span class="op">&lt;</span><span class="dt">unsigned</span> <span class="dt">int</span><span class="op">&gt;</span> indices<span class="op">,</span> vector<span class="op">&lt;</span>Texture<span class="op">&gt;</span> textures<span class="op">)</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">-&gt;</span>vertices <span class="op">=</span> vertices<span class="op">;</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">-&gt;</span>indices <span class="op">=</span> indices<span class="op">;</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">-&gt;</span>textures <span class="op">=</span> textures<span class="op">;</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">//åˆ›å»ºç»‘å®šè®¾ç½®æ¸²æŸ“æ•°æ®ã€‚</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        setupMesh<span class="op">();</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setupMesh<span class="op">()</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>        glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>EBO<span class="op">);</span></span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">//bind</span></span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">//set vertex datas</span></span><span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>        glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> vertices<span class="op">.</span>size<span class="op">()</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span>Vertex<span class="op">),</span> <span class="op">&amp;</span>vertices<span class="op">[</span><span class="dv">0</span><span class="op">],</span> GL_STATIC_DRAW<span class="op">);</span>  </span><span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">//set includies datas</span></span><span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> EBO<span class="op">);</span></span><span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        glBufferData<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> indices<span class="op">.</span>size<span class="op">()</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span><span class="op">),</span> </span><span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                     <span class="op">&amp;</span>indices<span class="op">[</span><span class="dv">0</span><span class="op">],</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é¡¶ç‚¹ä½ç½®</span></span><span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span>   </span><span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Vertex<span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é¡¶ç‚¹æ³•çº¿</span></span><span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span>   </span><span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Vertex<span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span>offsetof<span class="op">(</span>Vertex<span class="op">,</span> Normal<span class="op">));</span></span><span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é¡¶ç‚¹çº¹ç†åæ ‡</span></span><span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">2</span><span class="op">);</span>   </span><span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Vertex<span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span>offsetof<span class="op">(</span>Vertex<span class="op">,</span> TexCoords<span class="op">));</span></span><span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">//ç»“æŸç»‘å®š</span></span><span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  </span></code></pre></div><div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> Draw<span class="op">(</span>Shader shader<span class="op">)</span> </span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> diffuseNr <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> specularNr <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> textures<span class="op">.</span>size<span class="op">();</span> i<span class="op">++)</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>            glActiveTexture<span class="op">(</span>GL_TEXTURE0 <span class="op">+</span> i<span class="op">);</span> <span class="co">// åœ¨ç»‘å®šä¹‹å‰æ¿€æ´»ç›¸åº”çš„çº¹ç†å•å…ƒ</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            <span class="co">// è·å–çº¹ç†åºå·ï¼ˆdiffuse_textureN ä¸­çš„ Nï¼‰</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            string number<span class="op">;</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>            string name <span class="op">=</span> textures<span class="op">[</span>i<span class="op">].</span>type<span class="op">;</span></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span>name <span class="op">==</span> <span class="st">"texture_diffuse"</span><span class="op">)</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                number <span class="op">=</span> <span class="bu">std::</span>to_string<span class="op">(</span>diffuseNr<span class="op">++);</span></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>name <span class="op">==</span> <span class="st">"texture_specular"</span><span class="op">)</span></span><span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                number <span class="op">=</span> <span class="bu">std::</span>to_string<span class="op">(</span>specularNr<span class="op">++);</span></span><span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            shader<span class="op">.</span>setFloat<span class="op">((</span><span class="st">"material."</span> <span class="op">+</span> name <span class="op">+</span> number<span class="op">).</span>c_str<span class="op">(),</span> i<span class="op">);</span></span><span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>            glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> textures<span class="op">[</span>i<span class="op">].</span>id<span class="op">);</span></span><span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        glActiveTexture<span class="op">(</span>GL_TEXTURE0<span class="op">);</span></span><span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ç»˜åˆ¶ç½‘æ ¼</span></span><span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> indices<span class="op">.</span>size<span class="op">(),</span> GL_UNSIGNED_INT<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/03-mo-xing-jia-zai/2.wang-ge-mesh/"/>
      <url>/2022/08/10/opengl/03-mo-xing-jia-zai/2.wang-ge-mesh/</url>
      
        <content type="html"><![CDATA[<h2 id="ç½‘æ ¼mesh">ç½‘æ ¼Mesh</h2><blockquote><p>ç½‘æ ¼(Mesh)ä»£è¡¨çš„æ˜¯å•ä¸ªçš„å¯ç»˜åˆ¶å®ä½“ï¼Œæˆ‘ä»¬ç°åœ¨å…ˆæ¥å®šä¹‰ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„ç½‘æ ¼ç±»ã€‚ä¸€ä¸ªç½‘æ ¼åº”è¯¥è‡³å°‘éœ€è¦ä¸€ç³»åˆ—çš„é¡¶ç‚¹ï¼Œæ¯ä¸ªé¡¶ç‚¹åŒ…å«ä¸€ä¸ªä½ç½®å‘é‡ã€ä¸€ä¸ªæ³•å‘é‡å’Œä¸€ä¸ªçº¹ç†åæ ‡å‘é‡ã€‚ä¸€ä¸ªç½‘æ ¼è¿˜åº”è¯¥åŒ…å«ç”¨äºç´¢å¼•ç»˜åˆ¶çš„ç´¢å¼•ä»¥åŠçº¹ç†å½¢å¼çš„æè´¨æ•°æ®ï¼ˆæ¼«åå°„/é•œé¢å…‰è´´å›¾ï¼‰ã€‚<code>è¿™äº›ç»“æ„æ˜¯cpuçš„å‡†å¤‡æ•°æ®å°è£…</code></p></blockquote><ol type="1"><li><p>é¡¶ç‚¹ç»“æ„<code>cpp         struct Vertex {             glm::vec3 Position;             glm::vec3 Normal;             glm::vec2 TexCoords;         };</code></p></li><li><p>çº¹ç†ç»“æ„<code>cpp         struct Texture {             unsigned int id; //çº¹ç†id             string type;    //çº¹ç†ç±»å‹         };</code></p></li><li><p>ç½‘æ ¼Mesh &gt; å‡†å¤‡å¥½é¡¶ç‚¹å’Œçº¹ç†ç»“æ„ï¼Œåˆ™å¯ä»¥å‡†å¤‡meshç»“æ„äº†</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">class</span> Mesh <span class="op">{</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span><span class="op">:</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>            <span class="co">/*  ç½‘æ ¼æ•°æ®  */</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>            vector<span class="op">&lt;</span>Vertex<span class="op">&gt;</span> vertices<span class="op">;</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>            vector<span class="op">&lt;</span><span class="dt">unsigned</span> <span class="dt">int</span><span class="op">&gt;</span> indices<span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>            vector<span class="op">&lt;</span>Texture<span class="op">&gt;</span> textures<span class="op">;</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>            <span class="co">/*  å‡½æ•°  */</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>            Mesh<span class="op">(</span>vector<span class="op">&lt;</span>Vertex<span class="op">&gt;</span> vertices<span class="op">,</span> vector<span class="op">&lt;</span><span class="dt">unsigned</span> <span class="dt">int</span><span class="op">&gt;</span> indices<span class="op">,</span> vector<span class="op">&lt;</span>Texture<span class="op">&gt;</span> textures<span class="op">);</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">void</span> Draw<span class="op">(</span>Shader shader<span class="op">);</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">private</span><span class="op">:</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>            <span class="co">/*  æ¸²æŸ“æ•°æ®  */</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">unsigned</span> <span class="dt">int</span> VAO<span class="op">,</span> VBO<span class="op">,</span> EBO<span class="op">;</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>            <span class="co">/*  å‡½æ•°  */</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">void</span> setupMesh<span class="op">();</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span>  </span></code></pre></div><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    Mesh<span class="op">(</span>vector<span class="op">&lt;</span>Vertex<span class="op">&gt;</span> vertices<span class="op">,</span> vector<span class="op">&lt;</span><span class="dt">unsigned</span> <span class="dt">int</span><span class="op">&gt;</span> indices<span class="op">,</span> vector<span class="op">&lt;</span>Texture<span class="op">&gt;</span> textures<span class="op">)</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">-&gt;</span>vertices <span class="op">=</span> vertices<span class="op">;</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">-&gt;</span>indices <span class="op">=</span> indices<span class="op">;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">-&gt;</span>textures <span class="op">=</span> textures<span class="op">;</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">//åˆ›å»ºç»‘å®šè®¾ç½®æ¸²æŸ“æ•°æ®ã€‚</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        setupMesh<span class="op">();</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setupMesh<span class="op">()</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>EBO<span class="op">);</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">//bind</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">//set vertex datas</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> vertices<span class="op">.</span>size<span class="op">()</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span>Vertex<span class="op">),</span> <span class="op">&amp;</span>vertices<span class="op">[</span><span class="dv">0</span><span class="op">],</span> GL_STATIC_DRAW<span class="op">);</span>  </span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        <span class="co">//set includies datas</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> EBO<span class="op">);</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>        glBufferData<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> indices<span class="op">.</span>size<span class="op">()</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span><span class="op">),</span> </span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                     <span class="op">&amp;</span>indices<span class="op">[</span><span class="dv">0</span><span class="op">],</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é¡¶ç‚¹ä½ç½®</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span>   </span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Vertex<span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é¡¶ç‚¹æ³•çº¿</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span>   </span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Vertex<span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span>offsetof<span class="op">(</span>Vertex<span class="op">,</span> Normal<span class="op">));</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é¡¶ç‚¹çº¹ç†åæ ‡</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">2</span><span class="op">);</span>   </span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>Vertex<span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span>offsetof<span class="op">(</span>Vertex<span class="op">,</span> TexCoords<span class="op">));</span></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        <span class="co">//ç»“æŸç»‘å®š</span></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>  </span></code></pre></div><div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> Draw<span class="op">(</span>Shader shader<span class="op">)</span> </span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> diffuseNr <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> specularNr <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span><span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> textures<span class="op">.</span>size<span class="op">();</span> i<span class="op">++)</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>            glActiveTexture<span class="op">(</span>GL_TEXTURE0 <span class="op">+</span> i<span class="op">);</span> <span class="co">// åœ¨ç»‘å®šä¹‹å‰æ¿€æ´»ç›¸åº”çš„çº¹ç†å•å…ƒ</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            <span class="co">// è·å–çº¹ç†åºå·ï¼ˆdiffuse_textureN ä¸­çš„ Nï¼‰</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            string number<span class="op">;</span></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            string name <span class="op">=</span> textures<span class="op">[</span>i<span class="op">].</span>type<span class="op">;</span></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span><span class="op">(</span>name <span class="op">==</span> <span class="st">"texture_diffuse"</span><span class="op">)</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                number <span class="op">=</span> <span class="bu">std::</span>to_string<span class="op">(</span>diffuseNr<span class="op">++);</span></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span> <span class="cf">if</span><span class="op">(</span>name <span class="op">==</span> <span class="st">"texture_specular"</span><span class="op">)</span></span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                number <span class="op">=</span> <span class="bu">std::</span>to_string<span class="op">(</span>specularNr<span class="op">++);</span></span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            shader<span class="op">.</span>setFloat<span class="op">((</span><span class="st">"material."</span> <span class="op">+</span> name <span class="op">+</span> number<span class="op">).</span>c_str<span class="op">(),</span> i<span class="op">);</span></span><span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>            glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> textures<span class="op">[</span>i<span class="op">].</span>id<span class="op">);</span></span><span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        glActiveTexture<span class="op">(</span>GL_TEXTURE0<span class="op">);</span></span><span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ç»˜åˆ¶ç½‘æ ¼</span></span><span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> indices<span class="op">.</span>size<span class="op">(),</span> GL_UNSIGNED_INT<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/03-mo-xing-jia-zai/1.assimp/"/>
      <url>/2022/08/10/opengl/03-mo-xing-jia-zai/1.assimp/</url>
      
        <content type="html"><![CDATA[<h2 id="assimp">Assimp</h2><p><a href="https://assimp.org/index.php">Assimpåœ°å€</a></p><blockquote><p>ç¼–è¯‘ã€ç”¨æ³•ã€</p></blockquote><ol type="1"><li><p>ä»æºç ç¼–è¯‘</p></li><li><p>ç”¨æ³•ä»‹ç»</p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/02-guang-zhao-bu-fen/6.duo-guang-yuan/"/>
      <url>/2022/08/10/opengl/02-guang-zhao-bu-fen/6.duo-guang-yuan/</url>
      
        <content type="html"><![CDATA[<h2 id="å¤šå…‰æº">å¤šå…‰æº</h2><blockquote><p>ä¸ºäº†åœ¨åœºæ™¯ä¸­ä½¿ç”¨å¤šä¸ªå…‰æºï¼Œæˆ‘ä»¬å¸Œæœ›å°†å…‰ç…§è®¡ç®—å°è£…åˆ°GLSLå‡½æ•°ä¸­ä¸»è¦çš„åˆ†ç±»:<code>å¹³è¡Œå…‰</code>ï¼Œ<code>ç‚¹å…‰æº</code>,<code>èšå…‰</code></p></blockquote><hr><ol type="1"><li><p>GLSLå¤šå…‰æºå°è£… &gt; å¹³è¡Œå…‰ã€ç‚¹å…‰æºã€èšå…‰ï¼Œ<code>å•ç‹¬è®¡ç®—,ç´¯åŠ å’Œ</code> ```cpp #version 330 core out vec4FragColor;</p><pre><code> struct Material {     sampler2D diffuse;     sampler2D specular;         //sampler2D emission;     float shininess; };  //å¹³è¡Œå…‰ struct DirLight {     vec3 direction;     vec3 ambient;     vec3 diffuse;     vec3 specular; }; //ç‚¹å…‰æº struct PointLight {     vec3 position;     float constant;     float linear;     float quadratic;     vec3 ambient;     vec3 diffuse;     vec3 specular; }; //èšå…‰ struct SpotLight {     vec3 position;     vec3 direction;     float cutOff;     float outerCutOff;     float constant;     float linear;     float quadratic;     vec3 ambient;     vec3 diffuse;     vec3 specular;        }; //é™åˆ¶æ”¯æŒçš„ç‚¹å…‰æºæ•°é‡ã€‚ #define NR_POINT_LIGHTS 4 in vec3 FragPos;   in vec3 Normal;   in vec2 TexCoords; uniform vec3 viewPos; uniform DirLight dirLight; uniform PointLight pointLights[NR_POINT_LIGHTS]; uniform SpotLight spotLight; uniform Material material; // function prototypes vec3 CalcDirLight(DirLight light, vec3 normal, vec3 viewDir); vec3 CalcPointLight(PointLight light, vec3 normal, vec3 fragPos, vec3 viewDir); vec3 CalcSpotLight(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir); void main() {    // properties     vec3 norm = normalize(Normal);     vec3 viewDir = normalize(viewPos - FragPos);     // == =====================================================     // Our lighting is set up in 3 phases: directional, point lights and an optional flashlight     // For each phase, a calculate function is defined that calculates the corresponding color     // per lamp. In the main() function we take all the calculated colors and sum them up for     // this fragment's final color.     // == =====================================================     // phase 1: directional lighting     vec3 result = CalcDirLight(dirLight, norm, viewDir);     // phase 2: point lights     for(int i = 0; i &lt; NR_POINT_LIGHTS; i++)         result += CalcPointLight(pointLights[i], norm, FragPos, viewDir);         // phase 3: spot light     result += CalcSpotLight(spotLight, norm, FragPos, viewDir);         FragColor = vec4(result, 1.0); }  // calculates the color when using a directional light. vec3 CalcDirLight(DirLight light, vec3 normal, vec3 viewDir) {     vec3 lightDir = normalize(-light.direction);     // diffuse shading     float diff = max(dot(normal, lightDir), 0.0);     // specular shading     vec3 reflectDir = reflect(-lightDir, normal);     float spec = pow(max(dot(viewDir, reflectDir), 0.0), material.shininess);     // combine results     vec3 ambient = light.ambient * vec3(texture(material.diffuse, TexCoords));     vec3 diffuse = light.diffuse * diff * vec3(texture(material.diffuse, TexCoords));     vec3 specular = light.specular * spec * vec3(texture(material.specular, TexCoords));     return (ambient + diffuse + specular); } // calculates the color when using a point light. vec3 CalcPointLight(PointLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {     vec3 lightDir = normalize(light.position - fragPos);     // diffuse shading     float diff = max(dot(normal, lightDir), 0.0);     // specular shading     vec3 reflectDir = reflect(-lightDir, normal);     float spec = pow(max(dot(viewDir, reflectDir), 0.0), material.shininess);     // attenuation     float distance = length(light.position - fragPos);     float attenuation = 1.0 / (light.constant + light.linear * distance + light.quadratic * (distance * distance));         // combine results     vec3 ambient = light.ambient * vec3(texture(material.diffuse, TexCoords));     vec3 diffuse = light.diffuse * diff * vec3(texture(material.diffuse, TexCoords));     vec3 specular = light.specular * spec * vec3(texture(material.specular, TexCoords));     ambient *= attenuation;     diffuse *= attenuation;     specular *= attenuation;     return (ambient + diffuse + specular); } // calculates the color when using a spot light. vec3 CalcSpotLight(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {     vec3 lightDir = normalize(light.position - fragPos);     // diffuse shading     float diff = max(dot(normal, lightDir), 0.0);     // specular shading     vec3 reflectDir = reflect(-lightDir, normal);     float spec = pow(max(dot(viewDir, reflectDir), 0.0), material.shininess);     // attenuation     float distance = length(light.position - fragPos);     float attenuation = 1.0 / (light.constant + light.linear * distance + light.quadratic * (distance * distance));         // spotlight intensity     float theta = dot(lightDir, normalize(-light.direction));      float epsilon = light.cutOff - light.outerCutOff;     float intensity = clamp((theta - light.outerCutOff) / epsilon, 0.0, 1.0);     // combine results     vec3 ambient = light.ambient * vec3(texture(material.diffuse, TexCoords));     vec3 diffuse = light.diffuse * diff * vec3(texture(material.diffuse, TexCoords));     vec3 specular = light.specular * spec * vec3(texture(material.specular, TexCoords));     ambient *= attenuation * intensity;     diffuse *= attenuation * intensity;     specular *= attenuation * intensity;     return (ambient + diffuse + specular); }</code></pre><p>```</p></li><li><p>å®Œæ•´ä»£ç </p><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glad/glad.h&gt;</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;GLFW/glfw3.h&gt;</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define STB_IMAGE_IMPLEMENTATION</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"stb_image.h"</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glm/glm.hpp&gt;</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glm/gtc/type_ptr.hpp&gt;</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;shader_m.h&gt;</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;camera.h&gt;</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">);</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> mouse_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xpos<span class="op">,</span> <span class="dt">double</span> ypos<span class="op">);</span></span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> scroll_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xoffset<span class="op">,</span> <span class="dt">double</span> yoffset<span class="op">);</span></span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">);</span></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> loadTexture<span class="op">(</span><span class="at">const</span> <span class="dt">char</span> <span class="op">*</span>path<span class="op">);</span></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">// settings</span></span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> wWidth <span class="op">=</span> <span class="dv">800</span><span class="op">,</span> wHeight <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">char</span><span class="op">*</span> wName <span class="op">=</span> <span class="st">"LearnOpenGL"</span><span class="op">;</span></span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="co">// camera</span></span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>Camera camera<span class="op">(</span>glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">3.0</span><span class="bu">f</span><span class="op">));</span></span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> lastX <span class="op">=</span> wWidth <span class="op">/</span> <span class="fl">2.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> lastY <span class="op">=</span> wHeight <span class="op">/</span> <span class="fl">2.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> firstMouse <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a><span class="co">// timing</span></span><span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> deltaTime <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> lastFrame <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co">// lighting</span></span><span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>glm<span class="op">::</span>vec3 lightPos<span class="op">(</span><span class="fl">1.2</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">2.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span><span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">//1. åˆå§‹åŒ–</span></span><span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwInit<span class="op">()</span> <span class="op">==</span> GLFW_FALSE<span class="op">)</span></span><span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="st">"init glfw fail"</span><span class="op">;</span></span><span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="co">//2. åŸºæœ¬è®¾ç½®</span></span><span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_OPENGL_PROFILE<span class="op">,</span> GLFW_OPENGL_CORE_PROFILE<span class="op">);</span></span><span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a><span class="pp">#if __APPLE__</span></span><span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_OPENGL_FORWARD_COMPAT<span class="op">,</span> GLFW_TRUE<span class="op">);</span></span><span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span><span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>    <span class="co">//3. åˆ›å»ºçª—å£</span></span><span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    GLFWwindow <span class="op">*</span>window <span class="op">=</span> glfwCreateWindow<span class="op">(</span>wWidth<span class="op">,</span> wHeight<span class="op">,</span> wName<span class="op">,</span> <span class="kw">nullptr</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span><span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>window <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span></span><span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="st">"Failed to create GLFW window"</span><span class="op">;</span></span><span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>        <span class="co">//return 1;</span></span><span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">//4. å½“å‰ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡çª—å£</span></span><span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span><span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    <span class="co">//5. ä½¿ç”¨gladç®¡ç†OpenGLæŒ‡é’ˆã€‚</span></span><span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>gladLoadGLLoader<span class="op">((</span>GLADloadproc<span class="op">)</span>glfwGetProcAddress<span class="op">))</span></span><span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to initialize GLAD"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>        <span class="co">//return 1;</span></span><span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>    <span class="co">//6. è®¾ç½®è§†å£</span></span><span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> wWidth<span class="op">,</span> wHeight<span class="op">);</span></span><span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    <span class="co">//7. è®¾ç½®resizeå›è°ƒï¼Œå¯¹åº”åˆ·æ–°è§†å£</span></span><span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span><span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    glfwSetFramebufferSizeCallback<span class="op">(</span>window<span class="op">,</span> framebuffer_size_callback<span class="op">);</span></span><span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>    glfwSetCursorPosCallback<span class="op">(</span>window<span class="op">,</span> mouse_callback<span class="op">);</span></span><span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    glfwSetScrollCallback<span class="op">(</span>window<span class="op">,</span> scroll_callback<span class="op">);</span></span><span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    <span class="co">// build and compile our shader zprogram</span></span><span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ------------------------------------</span></span><span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    Shader lightingShader<span class="op">(</span><span class="st">"res/shaders/lighting_multi.vs"</span><span class="op">,</span> <span class="st">"res/shaders/lighting_multi.fs"</span><span class="op">);</span></span><span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>    Shader textureShader<span class="op">(</span><span class="st">"res/shaders/texture.vs"</span><span class="op">,</span> <span class="st">"res/shaders/texture1.fs"</span><span class="op">);</span></span><span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    Shader lightCubeShader<span class="op">(</span><span class="st">"res/shaders/cube.vs"</span><span class="op">,</span> <span class="st">"res/shaders/white.fs"</span><span class="op">);</span></span><span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> vertices<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>         <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span></span><span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> VBO<span class="op">,</span> cubeVAO<span class="op">;</span></span><span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>    glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>cubeVAO<span class="op">);</span></span><span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>    glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>    glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>vertices<span class="op">),</span> vertices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>cubeVAO<span class="op">);</span></span><span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">6</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>    <span class="co">// second, configure the light's VAO (VBO stays the same; the vertices are the same for the light object which is also a 3D cube)</span></span><span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> lightCubeVAO<span class="op">;</span></span><span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>    glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>lightCubeVAO<span class="op">);</span></span><span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>lightCubeVAO<span class="op">);</span></span><span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>    <span class="co">// note that we update the lamp's position attribute's stride to reflect the updated buffer data</span></span><span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>    <span class="co">// load textures (we now use a utility function to keep the code more organized)</span></span><span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>    <span class="co">// -----------------------------------------------------------------------------</span></span><span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> diffuseMap <span class="op">=</span> loadTexture<span class="op">(</span><span class="st">"./res/textures/container2.png"</span><span class="op">);</span></span><span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> specularMap <span class="op">=</span> loadTexture<span class="op">(</span><span class="st">"./res/textures/container2_specular.png"</span><span class="op">);</span></span><span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> verticesMMap<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a>        <span class="co">//ä½ç½®                    // åŸºç¡€é¢œè‰²          // è´´å›¾uv</span></span><span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.6</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.6</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// top right</span></span><span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.6</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.9</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom right</span></span><span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.9</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.9</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom left</span></span><span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.9</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.6</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span>  <span class="co">// top left </span></span><span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> indicesMMap<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="co">//  ç¬¬ä¸€ä¸ªä¸‰è§’å½¢</span></span><span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>  <span class="co">//  ç¬¬äºŒä¸ªä¸‰è§’å½¢</span></span><span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> mmapVBO<span class="op">,</span> mmapVAO<span class="op">,</span> mmapEBO<span class="op">;</span></span><span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>    glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapVAO<span class="op">);</span></span><span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>mmapVAO<span class="op">);</span></span><span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>    glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapVBO<span class="op">);</span></span><span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> mmapVBO<span class="op">);</span></span><span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>    glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>verticesMMap<span class="op">),</span> verticesMMap<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>    glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapEBO<span class="op">);</span></span><span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> mmapEBO<span class="op">);</span></span><span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>    glBufferData<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>indicesMMap<span class="op">),</span> indicesMMap<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>    <span class="co">//1. æŒ‡å®šé¡¶ç‚¹çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œé¡¶ç‚¹ 3ä¸ªfloatï¼Œä»0å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>    <span class="co">//2. æŒ‡å®šé¢œè‰²çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œä¸‰è‰² 3ä¸ªfloatï¼Œä»3å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>    <span class="co">//3. æŒ‡å®šuvçš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œuv 2ä¸ªfloatï¼Œä»6å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">6</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>    <span class="co">//æŒ‡å®šé‡‡æ ·å™¨è´´å›¾å‚¨å­˜çš„ä½ç½®</span></span><span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>    textureShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a>    textureShader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"texture1"</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"material.diffuse"</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"material.specular"</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>    glEnable<span class="op">(</span>GL_DEPTH_TEST<span class="op">);</span></span><span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a>    glm<span class="op">::</span>vec3 cubePositions<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>         glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">),</span></span><span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">2.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">5.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">15.0</span><span class="bu">f</span><span class="op">),</span></span><span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3<span class="op">(-</span><span class="fl">1.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">2.2</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">2.5</span><span class="bu">f</span><span class="op">),</span></span><span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3<span class="op">(-</span><span class="fl">3.8</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">2.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">12.3</span><span class="bu">f</span><span class="op">),</span></span><span id="cb2-219"><a href="#cb2-219" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">2.4</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.4</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">3.5</span><span class="bu">f</span><span class="op">),</span></span><span id="cb2-220"><a href="#cb2-220" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3<span class="op">(-</span><span class="fl">1.7</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">3.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">7.5</span><span class="bu">f</span><span class="op">),</span></span><span id="cb2-221"><a href="#cb2-221" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">1.3</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">2.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">2.5</span><span class="bu">f</span><span class="op">),</span></span><span id="cb2-222"><a href="#cb2-222" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">1.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">2.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">2.5</span><span class="bu">f</span><span class="op">),</span></span><span id="cb2-223"><a href="#cb2-223" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">1.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.2</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.5</span><span class="bu">f</span><span class="op">),</span></span><span id="cb2-224"><a href="#cb2-224" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3<span class="op">(-</span><span class="fl">1.3</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.5</span><span class="bu">f</span><span class="op">)</span></span><span id="cb2-225"><a href="#cb2-225" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb2-226"><a href="#cb2-226" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-227"><a href="#cb2-227" aria-hidden="true" tabindex="-1"></a>    glm<span class="op">::</span>vec3 pointLightPositions<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb2-228"><a href="#cb2-228" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.7</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.2</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">2.0</span><span class="bu">f</span><span class="op">),</span></span><span id="cb2-229"><a href="#cb2-229" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">2.3</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">3.3</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">4.0</span><span class="bu">f</span><span class="op">),</span></span><span id="cb2-230"><a href="#cb2-230" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3<span class="op">(-</span><span class="fl">4.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">2.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">12.0</span><span class="bu">f</span><span class="op">),</span></span><span id="cb2-231"><a href="#cb2-231" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">3.0</span><span class="bu">f</span><span class="op">)</span></span><span id="cb2-232"><a href="#cb2-232" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span><span id="cb2-233"><a href="#cb2-233" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-234"><a href="#cb2-234" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span>glfwWindowShouldClose<span class="op">(</span>window<span class="op">))</span></span><span id="cb2-235"><a href="#cb2-235" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-236"><a href="#cb2-236" aria-hidden="true" tabindex="-1"></a>        <span class="co">// per-frame time logic</span></span><span id="cb2-237"><a href="#cb2-237" aria-hidden="true" tabindex="-1"></a>        <span class="co">// --------------------</span></span><span id="cb2-238"><a href="#cb2-238" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> currentFrame <span class="op">=</span> glfwGetTime<span class="op">();</span></span><span id="cb2-239"><a href="#cb2-239" aria-hidden="true" tabindex="-1"></a>        deltaTime <span class="op">=</span> currentFrame <span class="op">-</span> lastFrame<span class="op">;</span></span><span id="cb2-240"><a href="#cb2-240" aria-hidden="true" tabindex="-1"></a>        lastFrame <span class="op">=</span> currentFrame<span class="op">;</span></span><span id="cb2-241"><a href="#cb2-241" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-242"><a href="#cb2-242" aria-hidden="true" tabindex="-1"></a>        <span class="co">// input</span></span><span id="cb2-243"><a href="#cb2-243" aria-hidden="true" tabindex="-1"></a>        <span class="co">// -----</span></span><span id="cb2-244"><a href="#cb2-244" aria-hidden="true" tabindex="-1"></a>        processInput<span class="op">(</span>window<span class="op">);</span></span><span id="cb2-245"><a href="#cb2-245" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-246"><a href="#cb2-246" aria-hidden="true" tabindex="-1"></a>        glClearColor<span class="op">(</span><span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-247"><a href="#cb2-247" aria-hidden="true" tabindex="-1"></a>        glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT <span class="op">|</span> GL_DEPTH_BUFFER_BIT<span class="op">);</span></span><span id="cb2-248"><a href="#cb2-248" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-249"><a href="#cb2-249" aria-hidden="true" tabindex="-1"></a>        <span class="co">// be sure to activate shader when setting uniforms/drawing objects</span></span><span id="cb2-250"><a href="#cb2-250" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb2-251"><a href="#cb2-251" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"viewPos"</span><span class="op">,</span> camera<span class="op">.</span>Position<span class="op">);</span></span><span id="cb2-252"><a href="#cb2-252" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"material.shininess"</span><span class="op">,</span> <span class="fl">32.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-253"><a href="#cb2-253" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-254"><a href="#cb2-254" aria-hidden="true" tabindex="-1"></a>        <span class="co">/*</span></span><span id="cb2-255"><a href="#cb2-255" aria-hidden="true" tabindex="-1"></a><span class="co">           Here we set all the uniforms for the 5/6 types of lights we have. We have to set them manually and index</span></span><span id="cb2-256"><a href="#cb2-256" aria-hidden="true" tabindex="-1"></a><span class="co">           the proper PointLight struct in the array to set each uniform variable. This can be done more code-friendly</span></span><span id="cb2-257"><a href="#cb2-257" aria-hidden="true" tabindex="-1"></a><span class="co">           by defining light types as classes and set their values in there, or by using a more efficient uniform approach</span></span><span id="cb2-258"><a href="#cb2-258" aria-hidden="true" tabindex="-1"></a><span class="co">           by using 'Uniform buffer objects', but that is something we'll discuss in the 'Advanced GLSL' tutorial.</span></span><span id="cb2-259"><a href="#cb2-259" aria-hidden="true" tabindex="-1"></a><span class="co">        */</span></span><span id="cb2-260"><a href="#cb2-260" aria-hidden="true" tabindex="-1"></a>        <span class="co">// directional light</span></span><span id="cb2-261"><a href="#cb2-261" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"dirLight.direction"</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.3</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-262"><a href="#cb2-262" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"dirLight.ambient"</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-263"><a href="#cb2-263" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"dirLight.diffuse"</span><span class="op">,</span> <span class="fl">0.4</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.4</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.4</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-264"><a href="#cb2-264" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"dirLight.specular"</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-265"><a href="#cb2-265" aria-hidden="true" tabindex="-1"></a>        <span class="co">// point light 1</span></span><span id="cb2-266"><a href="#cb2-266" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[0].position"</span><span class="op">,</span> pointLightPositions<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span><span id="cb2-267"><a href="#cb2-267" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[0].ambient"</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-268"><a href="#cb2-268" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[0].diffuse"</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-269"><a href="#cb2-269" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[0].specular"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-270"><a href="#cb2-270" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"pointLights[0].constant"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-271"><a href="#cb2-271" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"pointLights[0].linear"</span><span class="op">,</span> <span class="fl">0.09</span><span class="op">);</span></span><span id="cb2-272"><a href="#cb2-272" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"pointLights[0].quadratic"</span><span class="op">,</span> <span class="fl">0.032</span><span class="op">);</span></span><span id="cb2-273"><a href="#cb2-273" aria-hidden="true" tabindex="-1"></a>        <span class="co">// point light 2</span></span><span id="cb2-274"><a href="#cb2-274" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[1].position"</span><span class="op">,</span> pointLightPositions<span class="op">[</span><span class="dv">1</span><span class="op">]);</span></span><span id="cb2-275"><a href="#cb2-275" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[1].ambient"</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-276"><a href="#cb2-276" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[1].diffuse"</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-277"><a href="#cb2-277" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[1].specular"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-278"><a href="#cb2-278" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"pointLights[1].constant"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-279"><a href="#cb2-279" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"pointLights[1].linear"</span><span class="op">,</span> <span class="fl">0.09</span><span class="op">);</span></span><span id="cb2-280"><a href="#cb2-280" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"pointLights[1].quadratic"</span><span class="op">,</span> <span class="fl">0.032</span><span class="op">);</span></span><span id="cb2-281"><a href="#cb2-281" aria-hidden="true" tabindex="-1"></a>        <span class="co">// point light 3</span></span><span id="cb2-282"><a href="#cb2-282" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[2].position"</span><span class="op">,</span> pointLightPositions<span class="op">[</span><span class="dv">2</span><span class="op">]);</span></span><span id="cb2-283"><a href="#cb2-283" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[2].ambient"</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-284"><a href="#cb2-284" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[2].diffuse"</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-285"><a href="#cb2-285" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[2].specular"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-286"><a href="#cb2-286" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"pointLights[2].constant"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-287"><a href="#cb2-287" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"pointLights[2].linear"</span><span class="op">,</span> <span class="fl">0.09</span><span class="op">);</span></span><span id="cb2-288"><a href="#cb2-288" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"pointLights[2].quadratic"</span><span class="op">,</span> <span class="fl">0.032</span><span class="op">);</span></span><span id="cb2-289"><a href="#cb2-289" aria-hidden="true" tabindex="-1"></a>        <span class="co">// point light 4</span></span><span id="cb2-290"><a href="#cb2-290" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[3].position"</span><span class="op">,</span> pointLightPositions<span class="op">[</span><span class="dv">3</span><span class="op">]);</span></span><span id="cb2-291"><a href="#cb2-291" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[3].ambient"</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-292"><a href="#cb2-292" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[3].diffuse"</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.8</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-293"><a href="#cb2-293" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"pointLights[3].specular"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-294"><a href="#cb2-294" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"pointLights[3].constant"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-295"><a href="#cb2-295" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"pointLights[3].linear"</span><span class="op">,</span> <span class="fl">0.09</span><span class="op">);</span></span><span id="cb2-296"><a href="#cb2-296" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"pointLights[3].quadratic"</span><span class="op">,</span> <span class="fl">0.032</span><span class="op">);</span></span><span id="cb2-297"><a href="#cb2-297" aria-hidden="true" tabindex="-1"></a>        <span class="co">// spotLight</span></span><span id="cb2-298"><a href="#cb2-298" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"spotLight.position"</span><span class="op">,</span> camera<span class="op">.</span>Position<span class="op">);</span></span><span id="cb2-299"><a href="#cb2-299" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"spotLight.direction"</span><span class="op">,</span> camera<span class="op">.</span>Front<span class="op">);</span></span><span id="cb2-300"><a href="#cb2-300" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"spotLight.ambient"</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-301"><a href="#cb2-301" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"spotLight.diffuse"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-302"><a href="#cb2-302" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"spotLight.specular"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-303"><a href="#cb2-303" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"spotLight.constant"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-304"><a href="#cb2-304" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"spotLight.linear"</span><span class="op">,</span> <span class="fl">0.09</span><span class="op">);</span></span><span id="cb2-305"><a href="#cb2-305" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"spotLight.quadratic"</span><span class="op">,</span> <span class="fl">0.032</span><span class="op">);</span></span><span id="cb2-306"><a href="#cb2-306" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"spotLight.cutOff"</span><span class="op">,</span> glm<span class="op">::</span>cos<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span><span class="fl">12.5</span><span class="bu">f</span><span class="op">)));</span></span><span id="cb2-307"><a href="#cb2-307" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"spotLight.outerCutOff"</span><span class="op">,</span> glm<span class="op">::</span>cos<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span><span class="fl">15.0</span><span class="bu">f</span><span class="op">)));</span></span><span id="cb2-308"><a href="#cb2-308" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-309"><a href="#cb2-309" aria-hidden="true" tabindex="-1"></a>        <span class="co">// view/projection transformations</span></span><span id="cb2-310"><a href="#cb2-310" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>mat4 projection <span class="op">=</span> glm<span class="op">::</span>perspective<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span>camera<span class="op">.</span>Zoom<span class="op">),</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>wWidth <span class="op">/</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>wHeight<span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">100.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-311"><a href="#cb2-311" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>mat4 view <span class="op">=</span> camera<span class="op">.</span>GetViewMatrix<span class="op">();</span></span><span id="cb2-312"><a href="#cb2-312" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"projection"</span><span class="op">,</span> projection<span class="op">);</span></span><span id="cb2-313"><a href="#cb2-313" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"view"</span><span class="op">,</span> view<span class="op">);</span></span><span id="cb2-314"><a href="#cb2-314" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-315"><a href="#cb2-315" aria-hidden="true" tabindex="-1"></a>        <span class="co">// world transformation</span></span><span id="cb2-316"><a href="#cb2-316" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>mat4 model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-317"><a href="#cb2-317" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"model"</span><span class="op">,</span> model<span class="op">);</span></span><span id="cb2-318"><a href="#cb2-318" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-319"><a href="#cb2-319" aria-hidden="true" tabindex="-1"></a>        <span class="co">// bind diffuse map</span></span><span id="cb2-320"><a href="#cb2-320" aria-hidden="true" tabindex="-1"></a>        glActiveTexture<span class="op">(</span>GL_TEXTURE0<span class="op">);</span></span><span id="cb2-321"><a href="#cb2-321" aria-hidden="true" tabindex="-1"></a>        glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> diffuseMap<span class="op">);</span></span><span id="cb2-322"><a href="#cb2-322" aria-hidden="true" tabindex="-1"></a>        <span class="co">// bind specular map</span></span><span id="cb2-323"><a href="#cb2-323" aria-hidden="true" tabindex="-1"></a>        glActiveTexture<span class="op">(</span>GL_TEXTURE1<span class="op">);</span></span><span id="cb2-324"><a href="#cb2-324" aria-hidden="true" tabindex="-1"></a>        glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> specularMap<span class="op">);</span></span><span id="cb2-325"><a href="#cb2-325" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-326"><a href="#cb2-326" aria-hidden="true" tabindex="-1"></a>        <span class="co">// render containers</span></span><span id="cb2-327"><a href="#cb2-327" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>cubeVAO<span class="op">);</span></span><span id="cb2-328"><a href="#cb2-328" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb2-329"><a href="#cb2-329" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb2-330"><a href="#cb2-330" aria-hidden="true" tabindex="-1"></a>            <span class="co">// calculate the model matrix for each object and pass it to shader before drawing</span></span><span id="cb2-331"><a href="#cb2-331" aria-hidden="true" tabindex="-1"></a>            glm<span class="op">::</span>mat4 model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-332"><a href="#cb2-332" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> cubePositions<span class="op">[</span>i<span class="op">]);</span></span><span id="cb2-333"><a href="#cb2-333" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> angle <span class="op">=</span> <span class="fl">20.0</span><span class="bu">f</span> <span class="op">*</span> i<span class="op">;</span></span><span id="cb2-334"><a href="#cb2-334" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> glm<span class="op">::</span>rotate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>radians<span class="op">(</span>angle<span class="op">),</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">));</span></span><span id="cb2-335"><a href="#cb2-335" aria-hidden="true" tabindex="-1"></a>            lightingShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"model"</span><span class="op">,</span> model<span class="op">);</span></span><span id="cb2-336"><a href="#cb2-336" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-337"><a href="#cb2-337" aria-hidden="true" tabindex="-1"></a>            glDrawArrays<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">36</span><span class="op">);</span></span><span id="cb2-338"><a href="#cb2-338" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb2-339"><a href="#cb2-339" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-340"><a href="#cb2-340" aria-hidden="true" tabindex="-1"></a>        <span class="co">// also draw the lamp object</span></span><span id="cb2-341"><a href="#cb2-341" aria-hidden="true" tabindex="-1"></a>        lightCubeShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb2-342"><a href="#cb2-342" aria-hidden="true" tabindex="-1"></a>        lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"projection"</span><span class="op">,</span> projection<span class="op">);</span></span><span id="cb2-343"><a href="#cb2-343" aria-hidden="true" tabindex="-1"></a>        lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"view"</span><span class="op">,</span> view<span class="op">);</span></span><span id="cb2-344"><a href="#cb2-344" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-345"><a href="#cb2-345" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> lightPos<span class="op">);</span></span><span id="cb2-346"><a href="#cb2-346" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> glm<span class="op">::</span>scale<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">));</span> <span class="co">// a smaller cube</span></span><span id="cb2-347"><a href="#cb2-347" aria-hidden="true" tabindex="-1"></a>        lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"model"</span><span class="op">,</span> model<span class="op">);</span></span><span id="cb2-348"><a href="#cb2-348" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-349"><a href="#cb2-349" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>lightCubeVAO<span class="op">);</span></span><span id="cb2-350"><a href="#cb2-350" aria-hidden="true" tabindex="-1"></a>        glDrawArrays<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">36</span><span class="op">);</span></span><span id="cb2-351"><a href="#cb2-351" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-352"><a href="#cb2-352" aria-hidden="true" tabindex="-1"></a>        <span class="co">// bind Texture1</span></span><span id="cb2-353"><a href="#cb2-353" aria-hidden="true" tabindex="-1"></a>        <span class="co">/*glActiveTexture(GL_TEXTURE0);</span></span><span id="cb2-354"><a href="#cb2-354" aria-hidden="true" tabindex="-1"></a><span class="co">        glBindTexture(GL_TEXTURE_2D, diffuseMap);*/</span></span><span id="cb2-355"><a href="#cb2-355" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-356"><a href="#cb2-356" aria-hidden="true" tabindex="-1"></a>        textureShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb2-357"><a href="#cb2-357" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>mmapVAO<span class="op">);</span></span><span id="cb2-358"><a href="#cb2-358" aria-hidden="true" tabindex="-1"></a>        glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">6</span><span class="op">,</span> GL_UNSIGNED_INT<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb2-359"><a href="#cb2-359" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-360"><a href="#cb2-360" aria-hidden="true" tabindex="-1"></a>        glfwSwapBuffers<span class="op">(</span>window<span class="op">);</span></span><span id="cb2-361"><a href="#cb2-361" aria-hidden="true" tabindex="-1"></a>        glfwPollEvents<span class="op">();</span></span><span id="cb2-362"><a href="#cb2-362" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-363"><a href="#cb2-363" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-364"><a href="#cb2-364" aria-hidden="true" tabindex="-1"></a>    glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>cubeVAO<span class="op">);</span></span><span id="cb2-365"><a href="#cb2-365" aria-hidden="true" tabindex="-1"></a>    glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>lightCubeVAO<span class="op">);</span></span><span id="cb2-366"><a href="#cb2-366" aria-hidden="true" tabindex="-1"></a>    glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb2-367"><a href="#cb2-367" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-368"><a href="#cb2-368" aria-hidden="true" tabindex="-1"></a>    glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapVAO<span class="op">);</span></span><span id="cb2-369"><a href="#cb2-369" aria-hidden="true" tabindex="-1"></a>    glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapVBO<span class="op">);</span></span><span id="cb2-370"><a href="#cb2-370" aria-hidden="true" tabindex="-1"></a>    glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapEBO<span class="op">);</span></span><span id="cb2-371"><a href="#cb2-371" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-372"><a href="#cb2-372" aria-hidden="true" tabindex="-1"></a>TERMINATE<span class="op">:</span></span><span id="cb2-373"><a href="#cb2-373" aria-hidden="true" tabindex="-1"></a>    glfwTerminate<span class="op">();</span></span><span id="cb2-374"><a href="#cb2-374" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-375"><a href="#cb2-375" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb2-376"><a href="#cb2-376" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-377"><a href="#cb2-377" aria-hidden="true" tabindex="-1"></a><span class="co">// process all input: query GLFW whether relevant keys are pressed/released this frame and react accordingly</span></span><span id="cb2-378"><a href="#cb2-378" aria-hidden="true" tabindex="-1"></a><span class="co">// ---------------------------------------------------------------------------------------------------------</span></span><span id="cb2-379"><a href="#cb2-379" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">)</span></span><span id="cb2-380"><a href="#cb2-380" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb2-381"><a href="#cb2-381" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_ESCAPE<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb2-382"><a href="#cb2-382" aria-hidden="true" tabindex="-1"></a>        glfwSetWindowShouldClose<span class="op">(</span>window<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span><span id="cb2-383"><a href="#cb2-383" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-384"><a href="#cb2-384" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_W<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb2-385"><a href="#cb2-385" aria-hidden="true" tabindex="-1"></a>        camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>FORWARD<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb2-386"><a href="#cb2-386" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_S<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb2-387"><a href="#cb2-387" aria-hidden="true" tabindex="-1"></a>        camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>BACKWARD<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb2-388"><a href="#cb2-388" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_A<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb2-389"><a href="#cb2-389" aria-hidden="true" tabindex="-1"></a>        camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>LEFT<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb2-390"><a href="#cb2-390" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_D<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb2-391"><a href="#cb2-391" aria-hidden="true" tabindex="-1"></a>        camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>RIGHT<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb2-392"><a href="#cb2-392" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb2-393"><a href="#cb2-393" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-394"><a href="#cb2-394" aria-hidden="true" tabindex="-1"></a><span class="co">// glfw: whenever the window size changed (by OS or user resize) this callback function executes</span></span><span id="cb2-395"><a href="#cb2-395" aria-hidden="true" tabindex="-1"></a><span class="co">// ---------------------------------------------------------------------------------------------</span></span><span id="cb2-396"><a href="#cb2-396" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">)</span></span><span id="cb2-397"><a href="#cb2-397" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb2-398"><a href="#cb2-398" aria-hidden="true" tabindex="-1"></a>    <span class="co">// make sure the viewport matches the new window dimensions; note that width and </span></span><span id="cb2-399"><a href="#cb2-399" aria-hidden="true" tabindex="-1"></a>    <span class="co">// height will be significantly larger than specified on retina displays.</span></span><span id="cb2-400"><a href="#cb2-400" aria-hidden="true" tabindex="-1"></a>    glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height<span class="op">);</span></span><span id="cb2-401"><a href="#cb2-401" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb2-402"><a href="#cb2-402" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-403"><a href="#cb2-403" aria-hidden="true" tabindex="-1"></a><span class="co">// glfw: whenever the mouse moves, this callback is called</span></span><span id="cb2-404"><a href="#cb2-404" aria-hidden="true" tabindex="-1"></a><span class="co">// -------------------------------------------------------</span></span><span id="cb2-405"><a href="#cb2-405" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> mouse_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xpos<span class="op">,</span> <span class="dt">double</span> ypos<span class="op">)</span></span><span id="cb2-406"><a href="#cb2-406" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb2-407"><a href="#cb2-407" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>firstMouse<span class="op">)</span></span><span id="cb2-408"><a href="#cb2-408" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-409"><a href="#cb2-409" aria-hidden="true" tabindex="-1"></a>        lastX <span class="op">=</span> xpos<span class="op">;</span></span><span id="cb2-410"><a href="#cb2-410" aria-hidden="true" tabindex="-1"></a>        lastY <span class="op">=</span> ypos<span class="op">;</span></span><span id="cb2-411"><a href="#cb2-411" aria-hidden="true" tabindex="-1"></a>        firstMouse <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb2-412"><a href="#cb2-412" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-413"><a href="#cb2-413" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-414"><a href="#cb2-414" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> xoffset <span class="op">=</span> xpos <span class="op">-</span> lastX<span class="op">;</span></span><span id="cb2-415"><a href="#cb2-415" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> yoffset <span class="op">=</span> lastY <span class="op">-</span> ypos<span class="op">;</span> <span class="co">// reversed since y-coordinates go from bottom to top</span></span><span id="cb2-416"><a href="#cb2-416" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-417"><a href="#cb2-417" aria-hidden="true" tabindex="-1"></a>    lastX <span class="op">=</span> xpos<span class="op">;</span></span><span id="cb2-418"><a href="#cb2-418" aria-hidden="true" tabindex="-1"></a>    lastY <span class="op">=</span> ypos<span class="op">;</span></span><span id="cb2-419"><a href="#cb2-419" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-420"><a href="#cb2-420" aria-hidden="true" tabindex="-1"></a>    camera<span class="op">.</span>ProcessMouseMovement<span class="op">(</span>xoffset<span class="op">,</span> yoffset<span class="op">);</span></span><span id="cb2-421"><a href="#cb2-421" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb2-422"><a href="#cb2-422" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-423"><a href="#cb2-423" aria-hidden="true" tabindex="-1"></a><span class="co">// glfw: whenever the mouse scroll wheel scrolls, this callback is called</span></span><span id="cb2-424"><a href="#cb2-424" aria-hidden="true" tabindex="-1"></a><span class="co">// ----------------------------------------------------------------------</span></span><span id="cb2-425"><a href="#cb2-425" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> scroll_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xoffset<span class="op">,</span> <span class="dt">double</span> yoffset<span class="op">)</span></span><span id="cb2-426"><a href="#cb2-426" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb2-427"><a href="#cb2-427" aria-hidden="true" tabindex="-1"></a>    camera<span class="op">.</span>ProcessMouseScroll<span class="op">(</span>yoffset<span class="op">);</span></span><span id="cb2-428"><a href="#cb2-428" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb2-429"><a href="#cb2-429" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-430"><a href="#cb2-430" aria-hidden="true" tabindex="-1"></a><span class="co">// utility function for loading a 2D texture from file</span></span><span id="cb2-431"><a href="#cb2-431" aria-hidden="true" tabindex="-1"></a><span class="co">// ---------------------------------------------------</span></span><span id="cb2-432"><a href="#cb2-432" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> loadTexture<span class="op">(</span><span class="dt">char</span> <span class="at">const</span> <span class="op">*</span> path<span class="op">)</span></span><span id="cb2-433"><a href="#cb2-433" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb2-434"><a href="#cb2-434" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> textureID<span class="op">;</span></span><span id="cb2-435"><a href="#cb2-435" aria-hidden="true" tabindex="-1"></a>    glGenTextures<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>textureID<span class="op">);</span></span><span id="cb2-436"><a href="#cb2-436" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-437"><a href="#cb2-437" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> width<span class="op">,</span> height<span class="op">,</span> nrComponents<span class="op">;</span></span><span id="cb2-438"><a href="#cb2-438" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>data <span class="op">=</span> stbi_load<span class="op">(</span>path<span class="op">,</span> <span class="op">&amp;</span>width<span class="op">,</span> <span class="op">&amp;</span>height<span class="op">,</span> <span class="op">&amp;</span>nrComponents<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb2-439"><a href="#cb2-439" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>data<span class="op">)</span></span><span id="cb2-440"><a href="#cb2-440" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-441"><a href="#cb2-441" aria-hidden="true" tabindex="-1"></a>        GLenum format<span class="op">;</span></span><span id="cb2-442"><a href="#cb2-442" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>nrComponents <span class="op">==</span> <span class="dv">1</span><span class="op">)</span></span><span id="cb2-443"><a href="#cb2-443" aria-hidden="true" tabindex="-1"></a>            format <span class="op">=</span> GL_RED<span class="op">;</span></span><span id="cb2-444"><a href="#cb2-444" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>nrComponents <span class="op">==</span> <span class="dv">3</span><span class="op">)</span></span><span id="cb2-445"><a href="#cb2-445" aria-hidden="true" tabindex="-1"></a>            format <span class="op">=</span> GL_RGB<span class="op">;</span></span><span id="cb2-446"><a href="#cb2-446" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>nrComponents <span class="op">==</span> <span class="dv">4</span><span class="op">)</span></span><span id="cb2-447"><a href="#cb2-447" aria-hidden="true" tabindex="-1"></a>            format <span class="op">=</span> GL_RGBA<span class="op">;</span></span><span id="cb2-448"><a href="#cb2-448" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-449"><a href="#cb2-449" aria-hidden="true" tabindex="-1"></a>        glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> textureID<span class="op">);</span></span><span id="cb2-450"><a href="#cb2-450" aria-hidden="true" tabindex="-1"></a>        glTexImage2D<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> format<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> format<span class="op">,</span> GL_UNSIGNED_BYTE<span class="op">,</span> data<span class="op">);</span></span><span id="cb2-451"><a href="#cb2-451" aria-hidden="true" tabindex="-1"></a>        glGenerateMipmap<span class="op">(</span>GL_TEXTURE_2D<span class="op">);</span></span><span id="cb2-452"><a href="#cb2-452" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-453"><a href="#cb2-453" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_S<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb2-454"><a href="#cb2-454" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_T<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb2-455"><a href="#cb2-455" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MIN_FILTER<span class="op">,</span> GL_LINEAR_MIPMAP_LINEAR<span class="op">);</span></span><span id="cb2-456"><a href="#cb2-456" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MAG_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb2-457"><a href="#cb2-457" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-458"><a href="#cb2-458" aria-hidden="true" tabindex="-1"></a>        stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb2-459"><a href="#cb2-459" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-460"><a href="#cb2-460" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb2-461"><a href="#cb2-461" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-462"><a href="#cb2-462" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Texture failed to load at path: "</span> <span class="op">&lt;&lt;</span> path <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb2-463"><a href="#cb2-463" aria-hidden="true" tabindex="-1"></a>        stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb2-464"><a href="#cb2-464" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-465"><a href="#cb2-465" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-466"><a href="#cb2-466" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> textureID<span class="op">;</span></span><span id="cb2-467"><a href="#cb2-467" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/02-guang-zhao-bu-fen/5.guang-yuan/"/>
      <url>/2022/08/10/opengl/02-guang-zhao-bu-fen/5.guang-yuan/</url>
      
        <content type="html"><![CDATA[<h2 id="å…‰æºæŠ•å…‰ç‰©">å…‰æº(æŠ•å…‰ç‰©)</h2><blockquote><p>å°†å…‰æŠ•å°„(Cast)åˆ°ç‰©ä½“çš„å…‰æºå«åšæŠ•å…‰ç‰©(Light Caster)ã€‚ ä¸»è¦çš„åˆ†ç±»:<code>å¹³è¡Œå…‰</code>ï¼Œ<code>ç‚¹å…‰æº</code>,<code>èšå…‰</code></p></blockquote><hr><ol type="1"><li><p>å¹³è¡Œå…‰ &gt;å½“ä¸€ä¸ªå…‰æºå¤„äºå¾ˆè¿œçš„åœ°æ–¹æ—¶ï¼Œæ¥è‡ªå…‰æºçš„æ¯æ¡å…‰çº¿å°±ä¼šè¿‘ä¼¼äºäº’ç›¸å¹³è¡Œã€‚ä¸è®ºç‰©ä½“å’Œè€…è§‚å¯Ÿè€…çš„ä½ç½®ï¼Œ&gt;çœ‹èµ·æ¥å¥½åƒæ‰€æœ‰çš„å…‰éƒ½æ¥è‡ªäºåŒä¸€ä¸ªæ–¹å‘ã€‚å½“æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå‡è®¾å…‰æºå¤„äºæ— é™è¿œå¤„çš„æ¨¡å‹æ—¶ï¼Œ&gt;å®ƒå°±è¢«ç§°ä¸ºå®šå‘å…‰ï¼Œå› ä¸ºå®ƒçš„æ‰€æœ‰å…‰çº¿éƒ½æœ‰ç€ç›¸åŒçš„æ–¹å‘ï¼Œå®ƒä¸å…‰æºçš„ä½ç½®æ˜¯æ²¡æœ‰å…³ç³»çš„</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Light <span class="op">{</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>        <span class="co">// vec3 position; // å› ä¸ºè¦ä½¿ç”¨çš„æ˜¯æ–¹å‘ï¼Œå°±ä¸éœ€è¦ä½ç½®æ¥è®¡ç®—æ–¹å‘</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        vec3 direction<span class="op">;</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        vec3 ambient<span class="op">;</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        vec3 diffuse<span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        vec3 specular<span class="op">;</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>      vec3 lightDir <span class="op">=</span> normalize<span class="op">(-</span>light<span class="op">.</span>direction<span class="op">);</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li><li><p>ç‚¹å…‰æº</p><blockquote><p>å®šå‘å…‰å¯¹äºç…§äº®æ•´ä¸ªåœºæ™¯çš„å…¨å±€å…‰æºæ˜¯éå¸¸æ£’çš„ï¼Œä½†é™¤äº†å®šå‘å…‰ä¹‹å¤–æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€äº›åˆ†æ•£åœ¨åœºæ™¯ä¸­çš„ç‚¹å…‰æº(PointLight)ã€‚ç‚¹å…‰æºæ˜¯å¤„äºä¸–ç•Œä¸­æŸä¸€ä¸ªä½ç½®çš„å…‰æºï¼Œå®ƒä¼šæœç€æ‰€æœ‰æ–¹å‘å‘å…‰ï¼Œä½†å…‰çº¿ä¼šéšç€è·ç¦»é€æ¸è¡°å‡ã€‚æƒ³è±¡ä½œä¸ºæŠ•å…‰ç‰©çš„ç¯æ³¡å’Œç«æŠŠï¼Œå®ƒä»¬éƒ½æ˜¯ç‚¹å…‰æº</p></blockquote><ol type="1"><li><p>è¡°å‡ &gt; ä¸ºäº†å®ç°è¶‹å‘çœŸå®çš„æ•ˆæœï¼Œ è¡°å‡å…¬å¼ $ F_{att} = , dä»£è¡¨åˆ°å…‰æºè·ç¦»ï¼ŒK_cã€K_lã€K_q å¯æŸ¥è¡¨ã€‚ $</p><table><thead><tr class="header"><th style="text-align: left;">è·ç¦»</th><th style="text-align: left;">å¸¸æ•°é¡¹</th><th style="text-align: left;">ä¸€æ¬¡é¡¹</th><th style="text-align: left;">äºŒæ¬¡é¡¹</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">7</td><td style="text-align: left;">1.0</td><td style="text-align: left;">0.7</td><td style="text-align: left;"></td></tr><tr class="even"><td style="text-align: left;">13</td><td style="text-align: left;">1.0</td><td style="text-align: left;">0.35</td><td style="text-align: left;">0.44</td></tr><tr class="odd"><td style="text-align: left;">20</td><td style="text-align: left;">1.0</td><td style="text-align: left;">0.22</td><td style="text-align: left;">0.20</td></tr><tr class="even"><td style="text-align: left;">32</td><td style="text-align: left;">1.0</td><td style="text-align: left;">0.14</td><td style="text-align: left;">0.07</td></tr><tr class="odd"><td style="text-align: left;">50</td><td style="text-align: left;">1.0</td><td style="text-align: left;">0.09</td><td style="text-align: left;">0.032</td></tr><tr class="even"><td style="text-align: left;">65</td><td style="text-align: left;">1.0</td><td style="text-align: left;">0.07</td><td style="text-align: left;">0.017</td></tr><tr class="odd"><td style="text-align: left;">100</td><td style="text-align: left;">1.0</td><td style="text-align: left;">0.045</td><td style="text-align: left;">0.0075</td></tr><tr class="even"><td style="text-align: left;">160</td><td style="text-align: left;">1.0</td><td style="text-align: left;">0.027</td><td style="text-align: left;">0.0028</td></tr><tr class="odd"><td style="text-align: left;">200</td><td style="text-align: left;">1.0</td><td style="text-align: left;">0.022</td><td style="text-align: left;">0.0019</td></tr><tr class="even"><td style="text-align: left;">325</td><td style="text-align: left;">1.0</td><td style="text-align: left;">0.014</td><td style="text-align: left;">0.0007</td></tr><tr class="odd"><td style="text-align: left;">600</td><td style="text-align: left;">1.0</td><td style="text-align: left;">0.007</td><td style="text-align: left;">0.0002</td></tr><tr class="even"><td style="text-align: left;">3250</td><td style="text-align: left;">1.0</td><td style="text-align: left;">0.0014</td><td style="text-align: left;">0.000007</td></tr></tbody></table><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Light <span class="op">{</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    vec3 position<span class="op">;</span>  </span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    vec3 ambient<span class="op">;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    vec3 diffuse<span class="op">;</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    vec3 specular<span class="op">;</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> constant<span class="op">;</span> <span class="co">//K_c</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> linear<span class="op">;</span>   <span class="co">//K_l</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> quadratic<span class="op">;</span><span class="co">//K_q </span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div></li><li><p>ä»£ç ä¸­è®¾ç½®è¡°å‡å‚æ•°<code>cpp      lightingShader.setFloat("light.constant",  1.0f);      lightingShader.setFloat("light.linear",    0.09f);      lightingShader.setFloat("light.quadratic", 0.032f);</code></p></li><li><p>è®¡ç®—å…‰ç…§<code>GLSLå†…å»ºçš„lengthå‡½æ•°è®¡ç®—è·ç¦»</code></p><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> distance    <span class="op">=</span> length<span class="op">(</span>light<span class="op">.</span>position <span class="op">-</span> FragPos<span class="op">);</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> attenuation <span class="op">=</span> <span class="fl">1.0</span> <span class="op">/</span> <span class="op">(</span>light<span class="op">.</span>constant <span class="op">+</span> light<span class="op">.</span>linear <span class="op">*</span> distance <span class="op">+</span> light<span class="op">.</span>quadratic <span class="op">*</span> <span class="op">(</span>distance <span class="op">*</span> distance<span class="op">));</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ã€‚ã€‚ã€‚ã€‚ã€‚</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//åº”ç”¨è¡°å‡å‚æ•°</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    ambient  <span class="op">*=</span> attenuation<span class="op">;</span> </span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    diffuse  <span class="op">*=</span> attenuation<span class="op">;</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    specular <span class="op">*=</span> attenuation<span class="op">;</span></span></code></pre></div></li></ol></li><li><p>èšå…‰ç¯(Spotlight) &gt;OpenGLä¸­èšå…‰æ˜¯ç”¨ä¸€ä¸ªä¸–ç•Œç©ºé—´ä½ç½®ã€ä¸€ä¸ªæ–¹å‘å’Œä¸€ä¸ªåˆ‡å…‰è§’(CutoffAngle)æ¥è¡¨ç¤ºçš„ï¼Œåˆ‡å…‰è§’æŒ‡å®šäº†èšå…‰çš„åŠå¾„ï¼ˆè¯‘æ³¨ï¼šæ˜¯åœ†é”¥çš„åŠå¾„ä¸æ˜¯è·å…‰æºè·ç¦»é‚£ä¸ªåŠå¾„ï¼‰ã€‚&gt;å¯¹äºæ¯ä¸ªç‰‡æ®µï¼Œæˆ‘ä»¬ä¼šè®¡ç®—ç‰‡æ®µæ˜¯å¦ä½äºèšå…‰çš„åˆ‡å…‰æ–¹å‘ä¹‹é—´ï¼ˆä¹Ÿå°±æ˜¯åœ¨é”¥å½¢å†…ï¼‰ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œæˆ‘ä»¬å°±ä¼šç›¸åº”åœ°ç…§äº®ç‰‡æ®µã€‚</p><p>LightDirï¼šä»ç‰‡æ®µæŒ‡å‘å…‰æºçš„å‘é‡ã€‚ SpotDirï¼šèšå…‰æ‰€æŒ‡å‘çš„æ–¹å‘ã€‚<code>Phi</code> <span class="math inline">\(\phi\)</span>ï¼šæŒ‡å®šäº†èšå…‰åŠå¾„çš„åˆ‡å…‰è§’ã€‚è½åœ¨è¿™ä¸ªè§’åº¦ä¹‹å¤–çš„ç‰©ä½“éƒ½ä¸ä¼šè¢«è¿™ä¸ªèšå…‰æ‰€ç…§äº®ã€‚<code>theta</code><span class="math inline">\(\theta\)</span>ï¼šLightDirå‘é‡å’ŒSpotDirå‘é‡ä¹‹é—´çš„å¤¹è§’ã€‚åœ¨èšå…‰å†…éƒ¨çš„è¯Î¸å€¼åº”è¯¥æ¯”Ï•å€¼å°ã€‚</p><ol type="1"><li>ç»“æ„å®šä¹‰</li></ol><div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Light <span class="op">{</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>        vec3  position<span class="op">;</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        vec3  direction<span class="op">;</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> cutOff<span class="op">;</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">...</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div><ol start="2" type="1"><li>è®¾ç½®å‚æ•°</li></ol><div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.position"</span><span class="op">,</span>  camera<span class="op">.</span>Position<span class="op">);</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.direction"</span><span class="op">,</span> camera<span class="op">.</span>Front<span class="op">);</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"light.cutOff"</span><span class="op">,</span>   glm<span class="op">::</span>cos<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span><span class="fl">12.5</span><span class="bu">f</span><span class="op">)));</span></span></code></pre></div><ol start="3" type="1"><li>åŒºåŸŸåˆ¤å®šï¼Œ ä½¿ç”¨<code>clamp å‡½æ•°</code></li></ol><div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> theta <span class="op">=</span> dot<span class="op">(</span>lightDir<span class="op">,</span> normalize<span class="op">(-</span>light<span class="op">.</span>direction<span class="op">));</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>theta <span class="op">&gt;</span> light<span class="op">.</span>cutOff<span class="op">)</span> </span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span>       </span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>      <span class="co">// æ‰§è¡Œå…‰ç…§è®¡ç®—</span></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>  <span class="co">// å¦åˆ™ï¼Œä½¿ç”¨ç¯å¢ƒå…‰ï¼Œè®©åœºæ™¯åœ¨èšå…‰ä¹‹å¤–æ—¶ä¸è‡³äºå®Œå…¨é»‘æš—</span></span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>      color <span class="op">=</span> vec4<span class="op">(</span>light<span class="op">.</span>ambient <span class="op">*</span> vec3<span class="op">(</span>texture<span class="op">(</span>material<span class="op">.</span>diffuse<span class="op">,</span> TexCoords<span class="op">)),</span> <span class="fl">1.0</span><span class="op">);</span></span></code></pre></div><ol start="4" type="1"><li>è¾¹ç¼˜è½¯åŒ– &gt;ç§çœ‹èµ·æ¥è¾¹ç¼˜å¹³æ»‘çš„èšå…‰ï¼Œæˆ‘ä»¬éœ€è¦æ¨¡æ‹Ÿèšå…‰æœ‰ä¸€ä¸ªå†…åœ†é”¥(InnerCone)å’Œä¸€ä¸ªå¤–åœ†é”¥(OuterCone)ã€‚æˆ‘ä»¬å¯ä»¥å°†å†…åœ†é”¥è®¾ç½®ä¸ºä¸Šä¸€éƒ¨åˆ†ä¸­çš„é‚£ä¸ªåœ†é”¥ï¼Œä½†æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ä¸ªå¤–åœ†é”¥ï¼Œæ¥è®©å…‰ä»å†…åœ†é”¥é€æ¸å‡æš—ï¼Œç›´åˆ°å¤–åœ†é”¥çš„è¾¹ç•Œã€‚<ol type="1"><li>è¡°å‡å…¬å¼ $ I= ,è¿™é‡ŒÏµ(Epsilon)æ˜¯å†…ï¼ˆÏ•ï¼‰å’Œå¤–åœ†é”¥ï¼ˆÎ³ï¼‰ä¹‹é—´çš„ä½™å¼¦å€¼å·®ï¼ˆÏµ=Ï•âˆ’Î³ï¼‰ã€‚æœ€ç»ˆçš„Iå€¼å°±æ˜¯åœ¨å½“å‰ç‰‡æ®µèšå…‰çš„å¼ºåº¦ã€‚$</li></ol><table><colgroup><col style="width: 12%"><col style="width: 12%"><col style="width: 12%"><col style="width: 12%"><col style="width: 12%"><col style="width: 12%"><col style="width: 12%"><col style="width: 12%"></colgroup><thead><tr class="header"><th style="text-align: left;">Î¸</th><th style="text-align: left;">Î¸(è§’åº¦)</th><th style="text-align: left;">Ï•(å†…å…‰åˆ‡)</th><th style="text-align: left;">Ï•(è§’åº¦)</th><th style="text-align: left;">Î³(å¤–å…‰åˆ‡)</th><th style="text-align: left;">Î³(è§’åº¦)</th><th style="text-align: left;">Ïµ</th><th style="text-align: left;">I</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">0.87</td><td style="text-align: left;">30</td><td style="text-align: left;">0.91</td><td style="text-align: left;">25</td><td style="text-align: left;">0.82</td><td style="text-align: left;">35</td><td style="text-align: left;">0.91 - 0.82 = 0.09</td><td style="text-align: left;">0.87 - 0.82 / 0.09 = 0.56</td></tr><tr class="even"><td style="text-align: left;">0.9</td><td style="text-align: left;">26</td><td style="text-align: left;">0.91</td><td style="text-align: left;">25</td><td style="text-align: left;">0.82</td><td style="text-align: left;">35</td><td style="text-align: left;">0.91 - 0.82 = 0.09</td><td style="text-align: left;">0.9 - 0.82 / 0.09 = 0.89</td></tr><tr class="odd"><td style="text-align: left;">0.97</td><td style="text-align: left;">14</td><td style="text-align: left;">0.91</td><td style="text-align: left;">25</td><td style="text-align: left;">0.82</td><td style="text-align: left;">35</td><td style="text-align: left;">0.91 - 0.82 = 0.09</td><td style="text-align: left;">0.97 - 0.82 / 0.09 = 1.67</td></tr><tr class="even"><td style="text-align: left;">0.83</td><td style="text-align: left;">34</td><td style="text-align: left;">0.91</td><td style="text-align: left;">25</td><td style="text-align: left;">0.82</td><td style="text-align: left;">35</td><td style="text-align: left;">0.91 - 0.82 = 0.09</td><td style="text-align: left;">0.83 - 0.82 / 0.09 = 0.11</td></tr><tr class="odd"><td style="text-align: left;">0.64</td><td style="text-align: left;">50</td><td style="text-align: left;">0.91</td><td style="text-align: left;">25</td><td style="text-align: left;">0.82</td><td style="text-align: left;">35</td><td style="text-align: left;">0.91 - 0.82 = 0.09</td><td style="text-align: left;">0.64 - 0.82 / 0.09 = -2.0</td></tr><tr class="even"><td style="text-align: left;">0.966</td><td style="text-align: left;">15</td><td style="text-align: left;">0.9978</td><td style="text-align: left;">12.5</td><td style="text-align: left;">0.953</td><td style="text-align: left;">17.5</td><td style="text-align: left;">0.966 - 0.953 = 0.0448</td><td style="text-align: left;">0.966 - 0.953 / 0.0448 = 0.29</td></tr></tbody></table></li></ol></li><li><p>å®Œæ•´ä»£ç </p><div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glad/glad.h&gt;</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;GLFW/glfw3.h&gt;</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define STB_IMAGE_IMPLEMENTATION</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"stb_image.h"</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glm/glm.hpp&gt;</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glm/gtc/type_ptr.hpp&gt;</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;shader_m.h&gt;</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;camera.h&gt;</span></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span><span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span><span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">);</span></span><span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> mouse_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xpos<span class="op">,</span> <span class="dt">double</span> ypos<span class="op">);</span></span><span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> scroll_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xoffset<span class="op">,</span> <span class="dt">double</span> yoffset<span class="op">);</span></span><span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">);</span></span><span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> loadTexture<span class="op">(</span><span class="at">const</span> <span class="dt">char</span> <span class="op">*</span>path<span class="op">);</span></span><span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">// settings</span></span><span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> wWidth <span class="op">=</span> <span class="dv">800</span><span class="op">,</span> wHeight <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span><span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">char</span><span class="op">*</span> wName <span class="op">=</span> <span class="st">"LearnOpenGL"</span><span class="op">;</span></span><span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">// camera</span></span><span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>Camera camera<span class="op">(</span>glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">3.0</span><span class="bu">f</span><span class="op">));</span></span><span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> lastX <span class="op">=</span> wWidth <span class="op">/</span> <span class="fl">2.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> lastY <span class="op">=</span> wHeight <span class="op">/</span> <span class="fl">2.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> firstMouse <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">// timing</span></span><span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> deltaTime <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> lastFrame <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co">// lighting</span></span><span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>glm<span class="op">::</span>vec3 lightPos<span class="op">(</span><span class="fl">0.</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.4</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span><span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">//1. åˆå§‹åŒ–</span></span><span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwInit<span class="op">()</span> <span class="op">==</span> GLFW_FALSE<span class="op">)</span></span><span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="st">"init glfw fail"</span><span class="op">;</span></span><span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">//2. åŸºæœ¬è®¾ç½®</span></span><span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_OPENGL_PROFILE<span class="op">,</span> GLFW_OPENGL_CORE_PROFILE<span class="op">);</span></span><span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="pp">#if __APPLE__</span></span><span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_OPENGL_FORWARD_COMPAT<span class="op">,</span> GLFW_TRUE<span class="op">);</span></span><span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span><span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">//3. åˆ›å»ºçª—å£</span></span><span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    GLFWwindow <span class="op">*</span>window <span class="op">=</span> glfwCreateWindow<span class="op">(</span>wWidth<span class="op">,</span> wHeight<span class="op">,</span> wName<span class="op">,</span> <span class="kw">nullptr</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span><span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>window <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span></span><span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="st">"Failed to create GLFW window"</span><span class="op">;</span></span><span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">//return 1;</span></span><span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">//4. å½“å‰ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡çª—å£</span></span><span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>    glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span><span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>    <span class="co">//5. ä½¿ç”¨gladç®¡ç†OpenGLæŒ‡é’ˆã€‚</span></span><span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>gladLoadGLLoader<span class="op">((</span>GLADloadproc<span class="op">)</span>glfwGetProcAddress<span class="op">))</span></span><span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to initialize GLAD"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">//return 1;</span></span><span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>    <span class="co">//6. è®¾ç½®è§†å£</span></span><span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>    glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> wWidth<span class="op">,</span> wHeight<span class="op">);</span></span><span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>    <span class="co">//7. è®¾ç½®resizeå›è°ƒï¼Œå¯¹åº”åˆ·æ–°è§†å£</span></span><span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>    glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span><span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>    glfwSetFramebufferSizeCallback<span class="op">(</span>window<span class="op">,</span> framebuffer_size_callback<span class="op">);</span></span><span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>    glfwSetCursorPosCallback<span class="op">(</span>window<span class="op">,</span> mouse_callback<span class="op">);</span></span><span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>    glfwSetScrollCallback<span class="op">(</span>window<span class="op">,</span> scroll_callback<span class="op">);</span></span><span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>    <span class="co">// build and compile our shader zprogram</span></span><span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ------------------------------------</span></span><span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>    Shader lightingShader<span class="op">(</span><span class="st">"res/shaders/light_maps.vs"</span><span class="op">,</span> <span class="st">"res/shaders/light_maps.fs"</span><span class="op">);</span></span><span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>    Shader textureShader<span class="op">(</span><span class="st">"res/shaders/texture.vs"</span><span class="op">,</span> <span class="st">"res/shaders/texture1.fs"</span><span class="op">);</span></span><span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>    Shader lightCubeShader<span class="op">(</span><span class="st">"res/shaders/cube.vs"</span><span class="op">,</span> <span class="st">"res/shaders/white.fs"</span><span class="op">);</span></span><span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> vertices<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>        <span class="co">// positions          // normals           // texture coords</span></span><span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span></span><span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> VBO<span class="op">,</span> cubeVAO<span class="op">;</span></span><span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>    glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>cubeVAO<span class="op">);</span></span><span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a>    glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a>    glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>vertices<span class="op">),</span> vertices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>cubeVAO<span class="op">);</span></span><span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">6</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a>    <span class="co">// second, configure the light's VAO (VBO stays the same; the vertices are the same for the light object which is also a 3D cube)</span></span><span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> lightCubeVAO<span class="op">;</span></span><span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a>    glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>lightCubeVAO<span class="op">);</span></span><span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>lightCubeVAO<span class="op">);</span></span><span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a>    <span class="co">// note that we update the lamp's position attribute's stride to reflect the updated buffer data</span></span><span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a>    <span class="co">// load textures (we now use a utility function to keep the code more organized)</span></span><span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a>    <span class="co">// -----------------------------------------------------------------------------</span></span><span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> diffuseMap <span class="op">=</span> loadTexture<span class="op">(</span><span class="st">"./res/textures/container2.png"</span><span class="op">);</span></span><span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> specularMap <span class="op">=</span> loadTexture<span class="op">(</span><span class="st">"./res/textures/container2_specular.png"</span><span class="op">);</span></span><span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> verticesMMap<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a>        <span class="co">//ä½ç½®                    // åŸºç¡€é¢œè‰²          // è´´å›¾uv</span></span><span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.6</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.6</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// top right</span></span><span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.6</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.9</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom right</span></span><span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.9</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.9</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom left</span></span><span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.9</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.6</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span>  <span class="co">// top left </span></span><span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> indicesMMap<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="co">//  ç¬¬ä¸€ä¸ªä¸‰è§’å½¢</span></span><span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>  <span class="co">//  ç¬¬äºŒä¸ªä¸‰è§’å½¢</span></span><span id="cb7-176"><a href="#cb7-176" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb7-177"><a href="#cb7-177" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-178"><a href="#cb7-178" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> mmapVBO<span class="op">,</span> mmapVAO<span class="op">,</span> mmapEBO<span class="op">;</span></span><span id="cb7-179"><a href="#cb7-179" aria-hidden="true" tabindex="-1"></a>    glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapVAO<span class="op">);</span></span><span id="cb7-180"><a href="#cb7-180" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>mmapVAO<span class="op">);</span></span><span id="cb7-181"><a href="#cb7-181" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-182"><a href="#cb7-182" aria-hidden="true" tabindex="-1"></a>    glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapVBO<span class="op">);</span></span><span id="cb7-183"><a href="#cb7-183" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> mmapVBO<span class="op">);</span></span><span id="cb7-184"><a href="#cb7-184" aria-hidden="true" tabindex="-1"></a>    glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>verticesMMap<span class="op">),</span> verticesMMap<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb7-185"><a href="#cb7-185" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-186"><a href="#cb7-186" aria-hidden="true" tabindex="-1"></a>    glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapEBO<span class="op">);</span></span><span id="cb7-187"><a href="#cb7-187" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> mmapEBO<span class="op">);</span></span><span id="cb7-188"><a href="#cb7-188" aria-hidden="true" tabindex="-1"></a>    glBufferData<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>indicesMMap<span class="op">),</span> indicesMMap<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb7-189"><a href="#cb7-189" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-190"><a href="#cb7-190" aria-hidden="true" tabindex="-1"></a>    <span class="co">//1. æŒ‡å®šé¡¶ç‚¹çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œé¡¶ç‚¹ 3ä¸ªfloatï¼Œä»0å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb7-191"><a href="#cb7-191" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb7-192"><a href="#cb7-192" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb7-193"><a href="#cb7-193" aria-hidden="true" tabindex="-1"></a>    <span class="co">//2. æŒ‡å®šé¢œè‰²çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œä¸‰è‰² 3ä¸ªfloatï¼Œä»3å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb7-194"><a href="#cb7-194" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb7-195"><a href="#cb7-195" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb7-196"><a href="#cb7-196" aria-hidden="true" tabindex="-1"></a>    <span class="co">//3. æŒ‡å®šuvçš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œuv 2ä¸ªfloatï¼Œä»6å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb7-197"><a href="#cb7-197" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">6</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb7-198"><a href="#cb7-198" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb7-199"><a href="#cb7-199" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-200"><a href="#cb7-200" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb7-201"><a href="#cb7-201" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb7-202"><a href="#cb7-202" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-203"><a href="#cb7-203" aria-hidden="true" tabindex="-1"></a>    <span class="co">//æŒ‡å®šé‡‡æ ·å™¨è´´å›¾å‚¨å­˜çš„ä½ç½®</span></span><span id="cb7-204"><a href="#cb7-204" aria-hidden="true" tabindex="-1"></a>    textureShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb7-205"><a href="#cb7-205" aria-hidden="true" tabindex="-1"></a>    textureShader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"texture1"</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb7-206"><a href="#cb7-206" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-207"><a href="#cb7-207" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb7-208"><a href="#cb7-208" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"material.diffuse"</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb7-209"><a href="#cb7-209" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"material.specular"</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb7-210"><a href="#cb7-210" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-211"><a href="#cb7-211" aria-hidden="true" tabindex="-1"></a>    glEnable<span class="op">(</span>GL_DEPTH_TEST<span class="op">);</span></span><span id="cb7-212"><a href="#cb7-212" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span>glfwWindowShouldClose<span class="op">(</span>window<span class="op">))</span></span><span id="cb7-213"><a href="#cb7-213" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-214"><a href="#cb7-214" aria-hidden="true" tabindex="-1"></a>        <span class="co">// per-frame time logic</span></span><span id="cb7-215"><a href="#cb7-215" aria-hidden="true" tabindex="-1"></a>        <span class="co">// --------------------</span></span><span id="cb7-216"><a href="#cb7-216" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> currentFrame <span class="op">=</span> glfwGetTime<span class="op">();</span></span><span id="cb7-217"><a href="#cb7-217" aria-hidden="true" tabindex="-1"></a>        deltaTime <span class="op">=</span> currentFrame <span class="op">-</span> lastFrame<span class="op">;</span></span><span id="cb7-218"><a href="#cb7-218" aria-hidden="true" tabindex="-1"></a>        lastFrame <span class="op">=</span> currentFrame<span class="op">;</span></span><span id="cb7-219"><a href="#cb7-219" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-220"><a href="#cb7-220" aria-hidden="true" tabindex="-1"></a>        <span class="co">// input</span></span><span id="cb7-221"><a href="#cb7-221" aria-hidden="true" tabindex="-1"></a>        <span class="co">// -----</span></span><span id="cb7-222"><a href="#cb7-222" aria-hidden="true" tabindex="-1"></a>        processInput<span class="op">(</span>window<span class="op">);</span></span><span id="cb7-223"><a href="#cb7-223" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-224"><a href="#cb7-224" aria-hidden="true" tabindex="-1"></a>        glClearColor<span class="op">(</span><span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb7-225"><a href="#cb7-225" aria-hidden="true" tabindex="-1"></a>        glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT <span class="op">|</span> GL_DEPTH_BUFFER_BIT<span class="op">);</span></span><span id="cb7-226"><a href="#cb7-226" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-227"><a href="#cb7-227" aria-hidden="true" tabindex="-1"></a>        <span class="co">// be sure to activate shader when setting uniforms/drawing objects</span></span><span id="cb7-228"><a href="#cb7-228" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb7-229"><a href="#cb7-229" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.position"</span><span class="op">,</span> lightPos<span class="op">);</span></span><span id="cb7-230"><a href="#cb7-230" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"viewPos"</span><span class="op">,</span> camera<span class="op">.</span>Position<span class="op">);</span></span><span id="cb7-231"><a href="#cb7-231" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-232"><a href="#cb7-232" aria-hidden="true" tabindex="-1"></a>        <span class="co">// light properties</span></span><span id="cb7-233"><a href="#cb7-233" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.ambient"</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">);</span></span><span id="cb7-234"><a href="#cb7-234" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.diffuse"</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">);</span></span><span id="cb7-235"><a href="#cb7-235" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.specular"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb7-236"><a href="#cb7-236" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-237"><a href="#cb7-237" aria-hidden="true" tabindex="-1"></a>        <span class="co">// material properties</span></span><span id="cb7-238"><a href="#cb7-238" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"material.shininess"</span><span class="op">,</span> <span class="fl">64.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb7-239"><a href="#cb7-239" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-240"><a href="#cb7-240" aria-hidden="true" tabindex="-1"></a>        <span class="co">// view/projection transformations</span></span><span id="cb7-241"><a href="#cb7-241" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>mat4 projection <span class="op">=</span> glm<span class="op">::</span>perspective<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span>camera<span class="op">.</span>Zoom<span class="op">),</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>wWidth <span class="op">/</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>wHeight<span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">100.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb7-242"><a href="#cb7-242" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>mat4 view <span class="op">=</span> camera<span class="op">.</span>GetViewMatrix<span class="op">();</span></span><span id="cb7-243"><a href="#cb7-243" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"projection"</span><span class="op">,</span> projection<span class="op">);</span></span><span id="cb7-244"><a href="#cb7-244" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"view"</span><span class="op">,</span> view<span class="op">);</span></span><span id="cb7-245"><a href="#cb7-245" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-246"><a href="#cb7-246" aria-hidden="true" tabindex="-1"></a>        <span class="co">// world transformation</span></span><span id="cb7-247"><a href="#cb7-247" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>mat4 model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb7-248"><a href="#cb7-248" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"model"</span><span class="op">,</span> model<span class="op">);</span></span><span id="cb7-249"><a href="#cb7-249" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-250"><a href="#cb7-250" aria-hidden="true" tabindex="-1"></a>        <span class="co">// bind diffuse map</span></span><span id="cb7-251"><a href="#cb7-251" aria-hidden="true" tabindex="-1"></a>        glActiveTexture<span class="op">(</span>GL_TEXTURE0<span class="op">);</span></span><span id="cb7-252"><a href="#cb7-252" aria-hidden="true" tabindex="-1"></a>        glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> diffuseMap<span class="op">);</span></span><span id="cb7-253"><a href="#cb7-253" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-254"><a href="#cb7-254" aria-hidden="true" tabindex="-1"></a>        <span class="co">// bind diffuse map</span></span><span id="cb7-255"><a href="#cb7-255" aria-hidden="true" tabindex="-1"></a>        glActiveTexture<span class="op">(</span>GL_TEXTURE1<span class="op">);</span></span><span id="cb7-256"><a href="#cb7-256" aria-hidden="true" tabindex="-1"></a>        glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> specularMap<span class="op">);</span></span><span id="cb7-257"><a href="#cb7-257" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-258"><a href="#cb7-258" aria-hidden="true" tabindex="-1"></a>        <span class="co">// render the cube</span></span><span id="cb7-259"><a href="#cb7-259" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>cubeVAO<span class="op">);</span></span><span id="cb7-260"><a href="#cb7-260" aria-hidden="true" tabindex="-1"></a>        glDrawArrays<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">36</span><span class="op">);</span></span><span id="cb7-261"><a href="#cb7-261" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-262"><a href="#cb7-262" aria-hidden="true" tabindex="-1"></a>        <span class="co">// also draw the lamp object</span></span><span id="cb7-263"><a href="#cb7-263" aria-hidden="true" tabindex="-1"></a>        lightCubeShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb7-264"><a href="#cb7-264" aria-hidden="true" tabindex="-1"></a>        lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"projection"</span><span class="op">,</span> projection<span class="op">);</span></span><span id="cb7-265"><a href="#cb7-265" aria-hidden="true" tabindex="-1"></a>        lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"view"</span><span class="op">,</span> view<span class="op">);</span></span><span id="cb7-266"><a href="#cb7-266" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb7-267"><a href="#cb7-267" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> lightPos<span class="op">);</span></span><span id="cb7-268"><a href="#cb7-268" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> glm<span class="op">::</span>scale<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">));</span> <span class="co">// a smaller cube</span></span><span id="cb7-269"><a href="#cb7-269" aria-hidden="true" tabindex="-1"></a>        lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"model"</span><span class="op">,</span> model<span class="op">);</span></span><span id="cb7-270"><a href="#cb7-270" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-271"><a href="#cb7-271" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>lightCubeVAO<span class="op">);</span></span><span id="cb7-272"><a href="#cb7-272" aria-hidden="true" tabindex="-1"></a>        glDrawArrays<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">36</span><span class="op">);</span></span><span id="cb7-273"><a href="#cb7-273" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-274"><a href="#cb7-274" aria-hidden="true" tabindex="-1"></a>        <span class="co">// bind Texture1</span></span><span id="cb7-275"><a href="#cb7-275" aria-hidden="true" tabindex="-1"></a>        <span class="co">/*glActiveTexture(GL_TEXTURE0);</span></span><span id="cb7-276"><a href="#cb7-276" aria-hidden="true" tabindex="-1"></a><span class="co">        glBindTexture(GL_TEXTURE_2D, diffuseMap);*/</span></span><span id="cb7-277"><a href="#cb7-277" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-278"><a href="#cb7-278" aria-hidden="true" tabindex="-1"></a>        textureShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb7-279"><a href="#cb7-279" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>mmapVAO<span class="op">);</span></span><span id="cb7-280"><a href="#cb7-280" aria-hidden="true" tabindex="-1"></a>        glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">6</span><span class="op">,</span> GL_UNSIGNED_INT<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb7-281"><a href="#cb7-281" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-282"><a href="#cb7-282" aria-hidden="true" tabindex="-1"></a>        glfwSwapBuffers<span class="op">(</span>window<span class="op">);</span></span><span id="cb7-283"><a href="#cb7-283" aria-hidden="true" tabindex="-1"></a>        glfwPollEvents<span class="op">();</span></span><span id="cb7-284"><a href="#cb7-284" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-285"><a href="#cb7-285" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-286"><a href="#cb7-286" aria-hidden="true" tabindex="-1"></a>    glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>cubeVAO<span class="op">);</span></span><span id="cb7-287"><a href="#cb7-287" aria-hidden="true" tabindex="-1"></a>    glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>lightCubeVAO<span class="op">);</span></span><span id="cb7-288"><a href="#cb7-288" aria-hidden="true" tabindex="-1"></a>    glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb7-289"><a href="#cb7-289" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-290"><a href="#cb7-290" aria-hidden="true" tabindex="-1"></a>    glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapVAO<span class="op">);</span></span><span id="cb7-291"><a href="#cb7-291" aria-hidden="true" tabindex="-1"></a>    glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapVBO<span class="op">);</span></span><span id="cb7-292"><a href="#cb7-292" aria-hidden="true" tabindex="-1"></a>    glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapEBO<span class="op">);</span></span><span id="cb7-293"><a href="#cb7-293" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-294"><a href="#cb7-294" aria-hidden="true" tabindex="-1"></a>TERMINATE<span class="op">:</span></span><span id="cb7-295"><a href="#cb7-295" aria-hidden="true" tabindex="-1"></a>    glfwTerminate<span class="op">();</span></span><span id="cb7-296"><a href="#cb7-296" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb7-297"><a href="#cb7-297" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb7-298"><a href="#cb7-298" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-299"><a href="#cb7-299" aria-hidden="true" tabindex="-1"></a><span class="co">// process all input: query GLFW whether relevant keys are pressed/released this frame and react accordingly</span></span><span id="cb7-300"><a href="#cb7-300" aria-hidden="true" tabindex="-1"></a><span class="co">// ---------------------------------------------------------------------------------------------------------</span></span><span id="cb7-301"><a href="#cb7-301" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">)</span></span><span id="cb7-302"><a href="#cb7-302" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb7-303"><a href="#cb7-303" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_ESCAPE<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb7-304"><a href="#cb7-304" aria-hidden="true" tabindex="-1"></a>        glfwSetWindowShouldClose<span class="op">(</span>window<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span><span id="cb7-305"><a href="#cb7-305" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-306"><a href="#cb7-306" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_W<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb7-307"><a href="#cb7-307" aria-hidden="true" tabindex="-1"></a>        camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>FORWARD<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb7-308"><a href="#cb7-308" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_S<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb7-309"><a href="#cb7-309" aria-hidden="true" tabindex="-1"></a>        camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>BACKWARD<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb7-310"><a href="#cb7-310" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_A<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb7-311"><a href="#cb7-311" aria-hidden="true" tabindex="-1"></a>        camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>LEFT<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb7-312"><a href="#cb7-312" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_D<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb7-313"><a href="#cb7-313" aria-hidden="true" tabindex="-1"></a>        camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>RIGHT<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb7-314"><a href="#cb7-314" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb7-315"><a href="#cb7-315" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-316"><a href="#cb7-316" aria-hidden="true" tabindex="-1"></a><span class="co">// glfw: whenever the window size changed (by OS or user resize) this callback function executes</span></span><span id="cb7-317"><a href="#cb7-317" aria-hidden="true" tabindex="-1"></a><span class="co">// ---------------------------------------------------------------------------------------------</span></span><span id="cb7-318"><a href="#cb7-318" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">)</span></span><span id="cb7-319"><a href="#cb7-319" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb7-320"><a href="#cb7-320" aria-hidden="true" tabindex="-1"></a>    <span class="co">// make sure the viewport matches the new window dimensions; note that width and </span></span><span id="cb7-321"><a href="#cb7-321" aria-hidden="true" tabindex="-1"></a>    <span class="co">// height will be significantly larger than specified on retina displays.</span></span><span id="cb7-322"><a href="#cb7-322" aria-hidden="true" tabindex="-1"></a>    glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height<span class="op">);</span></span><span id="cb7-323"><a href="#cb7-323" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb7-324"><a href="#cb7-324" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-325"><a href="#cb7-325" aria-hidden="true" tabindex="-1"></a><span class="co">// glfw: whenever the mouse moves, this callback is called</span></span><span id="cb7-326"><a href="#cb7-326" aria-hidden="true" tabindex="-1"></a><span class="co">// -------------------------------------------------------</span></span><span id="cb7-327"><a href="#cb7-327" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> mouse_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xpos<span class="op">,</span> <span class="dt">double</span> ypos<span class="op">)</span></span><span id="cb7-328"><a href="#cb7-328" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb7-329"><a href="#cb7-329" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>firstMouse<span class="op">)</span></span><span id="cb7-330"><a href="#cb7-330" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-331"><a href="#cb7-331" aria-hidden="true" tabindex="-1"></a>        lastX <span class="op">=</span> xpos<span class="op">;</span></span><span id="cb7-332"><a href="#cb7-332" aria-hidden="true" tabindex="-1"></a>        lastY <span class="op">=</span> ypos<span class="op">;</span></span><span id="cb7-333"><a href="#cb7-333" aria-hidden="true" tabindex="-1"></a>        firstMouse <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb7-334"><a href="#cb7-334" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-335"><a href="#cb7-335" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-336"><a href="#cb7-336" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> xoffset <span class="op">=</span> xpos <span class="op">-</span> lastX<span class="op">;</span></span><span id="cb7-337"><a href="#cb7-337" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> yoffset <span class="op">=</span> lastY <span class="op">-</span> ypos<span class="op">;</span> <span class="co">// reversed since y-coordinates go from bottom to top</span></span><span id="cb7-338"><a href="#cb7-338" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-339"><a href="#cb7-339" aria-hidden="true" tabindex="-1"></a>    lastX <span class="op">=</span> xpos<span class="op">;</span></span><span id="cb7-340"><a href="#cb7-340" aria-hidden="true" tabindex="-1"></a>    lastY <span class="op">=</span> ypos<span class="op">;</span></span><span id="cb7-341"><a href="#cb7-341" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-342"><a href="#cb7-342" aria-hidden="true" tabindex="-1"></a>    camera<span class="op">.</span>ProcessMouseMovement<span class="op">(</span>xoffset<span class="op">,</span> yoffset<span class="op">);</span></span><span id="cb7-343"><a href="#cb7-343" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb7-344"><a href="#cb7-344" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-345"><a href="#cb7-345" aria-hidden="true" tabindex="-1"></a><span class="co">// glfw: whenever the mouse scroll wheel scrolls, this callback is called</span></span><span id="cb7-346"><a href="#cb7-346" aria-hidden="true" tabindex="-1"></a><span class="co">// ----------------------------------------------------------------------</span></span><span id="cb7-347"><a href="#cb7-347" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> scroll_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xoffset<span class="op">,</span> <span class="dt">double</span> yoffset<span class="op">)</span></span><span id="cb7-348"><a href="#cb7-348" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb7-349"><a href="#cb7-349" aria-hidden="true" tabindex="-1"></a>    camera<span class="op">.</span>ProcessMouseScroll<span class="op">(</span>yoffset<span class="op">);</span></span><span id="cb7-350"><a href="#cb7-350" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb7-351"><a href="#cb7-351" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-352"><a href="#cb7-352" aria-hidden="true" tabindex="-1"></a><span class="co">// utility function for loading a 2D texture from file</span></span><span id="cb7-353"><a href="#cb7-353" aria-hidden="true" tabindex="-1"></a><span class="co">// ---------------------------------------------------</span></span><span id="cb7-354"><a href="#cb7-354" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> loadTexture<span class="op">(</span><span class="dt">char</span> <span class="at">const</span> <span class="op">*</span> path<span class="op">)</span></span><span id="cb7-355"><a href="#cb7-355" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb7-356"><a href="#cb7-356" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> textureID<span class="op">;</span></span><span id="cb7-357"><a href="#cb7-357" aria-hidden="true" tabindex="-1"></a>    glGenTextures<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>textureID<span class="op">);</span></span><span id="cb7-358"><a href="#cb7-358" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-359"><a href="#cb7-359" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> width<span class="op">,</span> height<span class="op">,</span> nrComponents<span class="op">;</span></span><span id="cb7-360"><a href="#cb7-360" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>data <span class="op">=</span> stbi_load<span class="op">(</span>path<span class="op">,</span> <span class="op">&amp;</span>width<span class="op">,</span> <span class="op">&amp;</span>height<span class="op">,</span> <span class="op">&amp;</span>nrComponents<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb7-361"><a href="#cb7-361" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>data<span class="op">)</span></span><span id="cb7-362"><a href="#cb7-362" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-363"><a href="#cb7-363" aria-hidden="true" tabindex="-1"></a>        GLenum format<span class="op">;</span></span><span id="cb7-364"><a href="#cb7-364" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>nrComponents <span class="op">==</span> <span class="dv">1</span><span class="op">)</span></span><span id="cb7-365"><a href="#cb7-365" aria-hidden="true" tabindex="-1"></a>            format <span class="op">=</span> GL_RED<span class="op">;</span></span><span id="cb7-366"><a href="#cb7-366" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>nrComponents <span class="op">==</span> <span class="dv">3</span><span class="op">)</span></span><span id="cb7-367"><a href="#cb7-367" aria-hidden="true" tabindex="-1"></a>            format <span class="op">=</span> GL_RGB<span class="op">;</span></span><span id="cb7-368"><a href="#cb7-368" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>nrComponents <span class="op">==</span> <span class="dv">4</span><span class="op">)</span></span><span id="cb7-369"><a href="#cb7-369" aria-hidden="true" tabindex="-1"></a>            format <span class="op">=</span> GL_RGBA<span class="op">;</span></span><span id="cb7-370"><a href="#cb7-370" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-371"><a href="#cb7-371" aria-hidden="true" tabindex="-1"></a>        glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> textureID<span class="op">);</span></span><span id="cb7-372"><a href="#cb7-372" aria-hidden="true" tabindex="-1"></a>        glTexImage2D<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> format<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> format<span class="op">,</span> GL_UNSIGNED_BYTE<span class="op">,</span> data<span class="op">);</span></span><span id="cb7-373"><a href="#cb7-373" aria-hidden="true" tabindex="-1"></a>        glGenerateMipmap<span class="op">(</span>GL_TEXTURE_2D<span class="op">);</span></span><span id="cb7-374"><a href="#cb7-374" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-375"><a href="#cb7-375" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_S<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb7-376"><a href="#cb7-376" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_T<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb7-377"><a href="#cb7-377" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MIN_FILTER<span class="op">,</span> GL_LINEAR_MIPMAP_LINEAR<span class="op">);</span></span><span id="cb7-378"><a href="#cb7-378" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MAG_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb7-379"><a href="#cb7-379" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-380"><a href="#cb7-380" aria-hidden="true" tabindex="-1"></a>        stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb7-381"><a href="#cb7-381" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-382"><a href="#cb7-382" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb7-383"><a href="#cb7-383" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-384"><a href="#cb7-384" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Texture failed to load at path: "</span> <span class="op">&lt;&lt;</span> path <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb7-385"><a href="#cb7-385" aria-hidden="true" tabindex="-1"></a>        stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb7-386"><a href="#cb7-386" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-387"><a href="#cb7-387" aria-hidden="true" tabindex="-1"></a></span><span id="cb7-388"><a href="#cb7-388" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> textureID<span class="op">;</span></span><span id="cb7-389"><a href="#cb7-389" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/02-guang-zhao-bu-fen/4.guang-zhao-tie-tu/"/>
      <url>/2022/08/10/opengl/02-guang-zhao-bu-fen/4.guang-zhao-tie-tu/</url>
      
        <content type="html"><![CDATA[<h2 id="å…‰ç…§è´´å›¾">å…‰ç…§è´´å›¾</h2><blockquote><p>ä¸ºäº†å¯¹ç‰©ä½“çš„æ¼«åå°„åˆ†é‡ï¼ˆä»¥åŠé—´æ¥åœ°å¯¹ç¯å¢ƒå…‰åˆ†é‡ï¼Œå®ƒä»¬å‡ ä¹æ€»æ˜¯ä¸€æ ·çš„ï¼‰å’Œé•œé¢å…‰åˆ†é‡æœ‰ç€æ›´ç²¾ç¡®çš„æ§åˆ¶ï¼Œæè´¨å±æ€§å‡†ç¡®çš„æ§åˆ¶(ç¯å¢ƒå…‰äº¤ç»™light)ã€‚</p></blockquote><hr><ol type="1"><li><p>æ¼«åå°„è´´å›¾ &gt;å…¶å®éƒ½æ˜¯ä½¿ç”¨ä¸€å¼ è¦†ç›–ç‰©ä½“çš„å›¾åƒï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿé€ç‰‡æ®µç´¢å¼•å…¶ç‹¬ç«‹çš„é¢œè‰²å€¼ã€‚åœ¨å…‰ç…§åœºæ™¯ä¸­ï¼Œå®ƒé€šå¸¸å«åšä¸€ä¸ªæ¼«åå°„è´´å›¾(DiffuseMap)ï¼ˆ3Dè‰ºæœ¯å®¶é€šå¸¸éƒ½è¿™ä¹ˆå«å®ƒï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªè¡¨ç°äº†ç‰©ä½“æ‰€æœ‰çš„æ¼«åå°„é¢œè‰²çš„çº¹ç†å›¾åƒã€‚&gt; æ‰€ä»¥æˆ‘ä»¬å°†æè´¨ç»“æ„ä½“çš„æ¼«åå°„å˜é‡ ä¿®æ”¹ä¸ºæ¼«åå°„è´´å›¾ &gt;å¹¶ä½¿ç”¨è´´å›¾é‡‡æ · <code>texture(material.diffuse, TexCoords)</code>è·å–æ»¡å‘å°„é¢œè‰²åˆ†é‡ã€‚<code>cpp         //æ¼«åå°„         vec3 diffuse = light.diffuse * diff * vec3(texture(material.diffuse, TexCoords));         //ç¯å¢ƒå…‰ï¼Œè¿™é‡Œçš„ç¯å¢ƒå…‰ä¹Ÿæ˜¯ç”¨æ¼«åå°„åˆ†é‡å½±å“ï¼Œè€Œä¸æ˜¯ç”¨æè´¨çš„ç¯å¢ƒå…‰å±æ€§         vec3 ambient = light.ambient * vec3(texture(material.diffuse, TexCoords));</code></p></li><li><p>ä½¿ç”¨æè´¨å±æ€§å˜é‡</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    out vec4 FragColor<span class="op">;</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//å®šä¹‰æè´¨å±æ€§</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Material <span class="op">{</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        sampler2D diffuse<span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        sampler2D specular<span class="op">;</span>    </span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        sampler2D emission<span class="op">;</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> shininess<span class="op">;</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span> </span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">//å®šä¹‰å…‰å±æ€§</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Light <span class="op">{</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        vec3 position<span class="op">;</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        vec3 ambient<span class="op">;</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        vec3 diffuse<span class="op">;</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        vec3 specular<span class="op">;</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    in vec3 FragPos<span class="op">;</span>  </span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    in vec3 Normal<span class="op">;</span>  </span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    in vec2 TexCoords<span class="op">;</span>        </span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    uniform vec3 viewPos<span class="op">;</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    uniform Material material<span class="op">;</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    uniform Light light<span class="op">;</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ambient</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        vec3 ambient <span class="op">=</span> light<span class="op">.</span>ambient <span class="op">*</span> texture<span class="op">(</span>material<span class="op">.</span>diffuse<span class="op">,</span> TexCoords<span class="op">).</span>rgb<span class="op">;</span>            </span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">// diffuse </span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        vec3 norm <span class="op">=</span> normalize<span class="op">(</span>Normal<span class="op">);</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        vec3 lightDir <span class="op">=</span> normalize<span class="op">(</span>light<span class="op">.</span>position <span class="op">-</span> FragPos<span class="op">);</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> diff <span class="op">=</span> max<span class="op">(</span>dot<span class="op">(</span>norm<span class="op">,</span> lightDir<span class="op">),</span> <span class="fl">0.0</span><span class="op">);</span></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>        vec3 diffuse <span class="op">=</span> light<span class="op">.</span>diffuse <span class="op">*</span> diff <span class="op">*</span> texture<span class="op">(</span>material<span class="op">.</span>diffuse<span class="op">,</span> TexCoords<span class="op">).</span>rgb<span class="op">;</span>             </span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="co">// specular</span></span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        vec3 viewDir <span class="op">=</span> normalize<span class="op">(</span>viewPos <span class="op">-</span> FragPos<span class="op">);</span></span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        vec3 reflectDir <span class="op">=</span> reflect<span class="op">(-</span>lightDir<span class="op">,</span> norm<span class="op">);</span>  </span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> spec <span class="op">=</span> pow<span class="op">(</span>max<span class="op">(</span>dot<span class="op">(</span>viewDir<span class="op">,</span> reflectDir<span class="op">),</span> <span class="fl">0.0</span><span class="op">),</span> material<span class="op">.</span>shininess<span class="op">);</span></span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        vec3 specular <span class="op">=</span> light<span class="op">.</span>specular <span class="op">*</span> spec <span class="op">*</span> texture<span class="op">(</span>material<span class="op">.</span>specular<span class="op">,</span> TexCoords<span class="op">).</span>rgb<span class="op">;</span>              </span><span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">// emission å…‰æ»‘åº¦ç»†èŠ‚</span></span><span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        vec3 emission <span class="op">=</span> texture<span class="op">(</span>material<span class="op">.</span>emission<span class="op">,</span> TexCoords<span class="op">).</span>rgb<span class="op">;</span>              </span><span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        vec3 result <span class="op">=</span> ambient <span class="op">+</span> diffuse <span class="op">+</span> specular <span class="op">+</span> emission<span class="op">;</span></span><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> vec4<span class="op">(</span>result<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> </span></code></pre></div></li><li><p>ä¸ºShaderæè´¨å±æ€§è®¾ç½®å€¼ &gt;ç»“æ„ä½“åªæ˜¯ä½œä¸ºuniformå˜é‡çš„ä¸€ä¸ªå°è£…ï¼Œæ‰€ä»¥å¦‚æœæƒ³å¡«å……è¿™ä¸ªç»“æ„ä½“çš„è¯ï¼Œæˆ‘ä»¬ä»éœ€è¦å¯¹<code>æ¯ä¸ªå•ç‹¬çš„uniformè¿›è¡Œè®¾ç½®</code>ï¼Œä½†è¿™æ¬¡è¦å¸¦ä¸Šç»“æ„ä½“åçš„å‰ç¼€ï¼š</p><p>é…ç½®Shaderè´´å›¾å±æ€§<code>cpp          lightingShader.use();          lightingShader.setInt("material.diffuse", 0);          lightingShader.setInt("material.specular", 1);          lightingShader.setInt("material.emission", 2);</code></p><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.position"</span><span class="op">,</span> lightPos<span class="op">);</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"viewPos"</span><span class="op">,</span> camera<span class="op">.</span>Position<span class="op">);</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// å…‰å±æ€§</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.ambient"</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.diffuse"</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.specular"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// å¯¹åº”è´´å›¾å±æ€§localçš„é…ç½® 0</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    glActiveTexture<span class="op">(</span>GL_TEXTURE0<span class="op">);</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> diffuseMap<span class="op">);</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// å¯¹åº”è´´å›¾å±æ€§localçš„é…ç½® 1</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    glActiveTexture<span class="op">(</span>GL_TEXTURE1<span class="op">);</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> specularMap<span class="op">);</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// å¯¹åº”è´´å›¾å±æ€§localçš„é…ç½® 2</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    glActiveTexture<span class="op">(</span>GL_TEXTURE2<span class="op">);</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> emissionMap<span class="op">);</span></span></code></pre></div></li><li><p>å®Œæ•´ä»£ç </p><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glad/glad.h&gt;</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;GLFW/glfw3.h&gt;</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define STB_IMAGE_IMPLEMENTATION</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"stb_image.h"</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glm/glm.hpp&gt;</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glm/gtc/type_ptr.hpp&gt;</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;shader_m.h&gt;</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;camera.h&gt;</span></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">);</span></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> mouse_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xpos<span class="op">,</span> <span class="dt">double</span> ypos<span class="op">);</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> scroll_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xoffset<span class="op">,</span> <span class="dt">double</span> yoffset<span class="op">);</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">);</span></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> loadTexture<span class="op">(</span><span class="at">const</span> <span class="dt">char</span> <span class="op">*</span>path<span class="op">);</span></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">// settings</span></span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">int</span> wWidth <span class="op">=</span> <span class="dv">800</span><span class="op">,</span> wHeight <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="at">const</span> <span class="dt">char</span><span class="op">*</span> wName <span class="op">=</span> <span class="st">"LearnOpenGL"</span><span class="op">;</span></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">// camera</span></span><span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>Camera camera<span class="op">(</span>glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">3.0</span><span class="bu">f</span><span class="op">));</span></span><span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> lastX <span class="op">=</span> wWidth <span class="op">/</span> <span class="fl">2.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> lastY <span class="op">=</span> wHeight <span class="op">/</span> <span class="fl">2.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> firstMouse <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co">// timing</span></span><span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> deltaTime <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> lastFrame <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="co">// lighting</span></span><span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>glm<span class="op">::</span>vec3 lightPos<span class="op">(</span><span class="fl">0.</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.4</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span><span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    <span class="co">//1. åˆå§‹åŒ–</span></span><span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwInit<span class="op">()</span> <span class="op">==</span> GLFW_FALSE<span class="op">)</span></span><span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="st">"init glfw fail"</span><span class="op">;</span></span><span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="co">//2. åŸºæœ¬è®¾ç½®</span></span><span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_OPENGL_PROFILE<span class="op">,</span> GLFW_OPENGL_CORE_PROFILE<span class="op">);</span></span><span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="pp">#if __APPLE__</span></span><span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_OPENGL_FORWARD_COMPAT<span class="op">,</span> GLFW_TRUE<span class="op">);</span></span><span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span><span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    <span class="co">//3. åˆ›å»ºçª—å£</span></span><span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    GLFWwindow <span class="op">*</span>window <span class="op">=</span> glfwCreateWindow<span class="op">(</span>wWidth<span class="op">,</span> wHeight<span class="op">,</span> wName<span class="op">,</span> <span class="kw">nullptr</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span><span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>window <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span></span><span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="st">"Failed to create GLFW window"</span><span class="op">;</span></span><span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">//return 1;</span></span><span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>    <span class="co">//4. å½“å‰ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡çª—å£</span></span><span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>    glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span><span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>    <span class="co">//5. ä½¿ç”¨gladç®¡ç†OpenGLæŒ‡é’ˆã€‚</span></span><span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>gladLoadGLLoader<span class="op">((</span>GLADloadproc<span class="op">)</span>glfwGetProcAddress<span class="op">))</span></span><span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to initialize GLAD"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">//return 1;</span></span><span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    <span class="co">//6. è®¾ç½®è§†å£</span></span><span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> wWidth<span class="op">,</span> wHeight<span class="op">);</span></span><span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>    <span class="co">//7. è®¾ç½®resizeå›è°ƒï¼Œå¯¹åº”åˆ·æ–°è§†å£</span></span><span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>    glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span><span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>    glfwSetFramebufferSizeCallback<span class="op">(</span>window<span class="op">,</span> framebuffer_size_callback<span class="op">);</span></span><span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>    glfwSetCursorPosCallback<span class="op">(</span>window<span class="op">,</span> mouse_callback<span class="op">);</span></span><span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>    glfwSetScrollCallback<span class="op">(</span>window<span class="op">,</span> scroll_callback<span class="op">);</span></span><span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>    <span class="co">// build and compile our shader zprogram</span></span><span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ------------------------------------</span></span><span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>    Shader lightingShader<span class="op">(</span><span class="st">"res/shaders/light_maps.vs"</span><span class="op">,</span> <span class="st">"res/shaders/light_maps.fs"</span><span class="op">);</span></span><span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>    Shader textureShader<span class="op">(</span><span class="st">"res/shaders/texture.vs"</span><span class="op">,</span> <span class="st">"res/shaders/texture1.fs"</span><span class="op">);</span></span><span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>    Shader lightCubeShader<span class="op">(</span><span class="st">"res/shaders/cube.vs"</span><span class="op">,</span> <span class="st">"res/shaders/white.fs"</span><span class="op">);</span></span><span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> vertices<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>        <span class="co">// positions          // normals           // texture coords</span></span><span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span></span><span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> VBO<span class="op">,</span> cubeVAO<span class="op">;</span></span><span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>    glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>cubeVAO<span class="op">);</span></span><span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>    glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>    glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>vertices<span class="op">),</span> vertices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>cubeVAO<span class="op">);</span></span><span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">6</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>    <span class="co">// second, configure the light's VAO (VBO stays the same; the vertices are the same for the light object which is also a 3D cube)</span></span><span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> lightCubeVAO<span class="op">;</span></span><span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>    glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>lightCubeVAO<span class="op">);</span></span><span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>lightCubeVAO<span class="op">);</span></span><span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>    <span class="co">// note that we update the lamp's position attribute's stride to reflect the updated buffer data</span></span><span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>    <span class="co">// load textures (we now use a utility function to keep the code more organized)</span></span><span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>    <span class="co">// -----------------------------------------------------------------------------</span></span><span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> diffuseMap <span class="op">=</span> loadTexture<span class="op">(</span><span class="st">"./res/textures/container2.png"</span><span class="op">);</span></span><span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> specularMap <span class="op">=</span> loadTexture<span class="op">(</span><span class="st">"./res/textures/container2_specular.png"</span><span class="op">);</span></span><span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> verticesMMap<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>        <span class="co">//ä½ç½®                    // åŸºç¡€é¢œè‰²          // è´´å›¾uv</span></span><span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.6</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.6</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// top right</span></span><span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.6</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.9</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom right</span></span><span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.9</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.9</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom left</span></span><span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.9</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.6</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span>  <span class="co">// top left </span></span><span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> indicesMMap<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="co">//  ç¬¬ä¸€ä¸ªä¸‰è§’å½¢</span></span><span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>  <span class="co">//  ç¬¬äºŒä¸ªä¸‰è§’å½¢</span></span><span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> mmapVBO<span class="op">,</span> mmapVAO<span class="op">,</span> mmapEBO<span class="op">;</span></span><span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>    glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapVAO<span class="op">);</span></span><span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>mmapVAO<span class="op">);</span></span><span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>    glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapVBO<span class="op">);</span></span><span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> mmapVBO<span class="op">);</span></span><span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>    glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>verticesMMap<span class="op">),</span> verticesMMap<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>    glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapEBO<span class="op">);</span></span><span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> mmapEBO<span class="op">);</span></span><span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>    glBufferData<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>indicesMMap<span class="op">),</span> indicesMMap<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>    <span class="co">//1. æŒ‡å®šé¡¶ç‚¹çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œé¡¶ç‚¹ 3ä¸ªfloatï¼Œä»0å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>    <span class="co">//2. æŒ‡å®šé¢œè‰²çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œä¸‰è‰² 3ä¸ªfloatï¼Œä»3å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>    <span class="co">//3. æŒ‡å®šuvçš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œuv 2ä¸ªfloatï¼Œä»6å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>    glVertexAttribPointer<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">6</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a>    glEnableVertexAttribArray<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>    glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>    <span class="co">//æŒ‡å®šé‡‡æ ·å™¨è´´å›¾å‚¨å­˜çš„ä½ç½®</span></span><span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>    textureShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a>    textureShader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"texture1"</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"material.diffuse"</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"material.specular"</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>    glEnable<span class="op">(</span>GL_DEPTH_TEST<span class="op">);</span></span><span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(!</span>glfwWindowShouldClose<span class="op">(</span>window<span class="op">))</span></span><span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a>        <span class="co">// per-frame time logic</span></span><span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>        <span class="co">// --------------------</span></span><span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> currentFrame <span class="op">=</span> glfwGetTime<span class="op">();</span></span><span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>        deltaTime <span class="op">=</span> currentFrame <span class="op">-</span> lastFrame<span class="op">;</span></span><span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>        lastFrame <span class="op">=</span> currentFrame<span class="op">;</span></span><span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>        <span class="co">// input</span></span><span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>        <span class="co">// -----</span></span><span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a>        processInput<span class="op">(</span>window<span class="op">);</span></span><span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a>        glClearColor<span class="op">(</span><span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>        glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT <span class="op">|</span> GL_DEPTH_BUFFER_BIT<span class="op">);</span></span><span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>        <span class="co">// be sure to activate shader when setting uniforms/drawing objects</span></span><span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.position"</span><span class="op">,</span> lightPos<span class="op">);</span></span><span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"viewPos"</span><span class="op">,</span> camera<span class="op">.</span>Position<span class="op">);</span></span><span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a>        <span class="co">// light properties</span></span><span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.ambient"</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.diffuse"</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.specular"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a>        <span class="co">// material properties</span></span><span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"material.shininess"</span><span class="op">,</span> <span class="fl">64.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a>        <span class="co">// view/projection transformations</span></span><span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>mat4 projection <span class="op">=</span> glm<span class="op">::</span>perspective<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span>camera<span class="op">.</span>Zoom<span class="op">),</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>wWidth <span class="op">/</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>wHeight<span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">100.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>mat4 view <span class="op">=</span> camera<span class="op">.</span>GetViewMatrix<span class="op">();</span></span><span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"projection"</span><span class="op">,</span> projection<span class="op">);</span></span><span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"view"</span><span class="op">,</span> view<span class="op">);</span></span><span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>        <span class="co">// world transformation</span></span><span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>mat4 model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a>        lightingShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"model"</span><span class="op">,</span> model<span class="op">);</span></span><span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a>        <span class="co">// bind diffuse map</span></span><span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a>        glActiveTexture<span class="op">(</span>GL_TEXTURE0<span class="op">);</span></span><span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a>        glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> diffuseMap<span class="op">);</span></span><span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a>        <span class="co">// bind diffuse map</span></span><span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a>        glActiveTexture<span class="op">(</span>GL_TEXTURE1<span class="op">);</span></span><span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a>        glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> specularMap<span class="op">);</span></span><span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a>        <span class="co">// render the cube</span></span><span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>cubeVAO<span class="op">);</span></span><span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a>        glDrawArrays<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">36</span><span class="op">);</span></span><span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a>        <span class="co">// also draw the lamp object</span></span><span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a>        lightCubeShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a>        lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"projection"</span><span class="op">,</span> projection<span class="op">);</span></span><span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a>        lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"view"</span><span class="op">,</span> view<span class="op">);</span></span><span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> lightPos<span class="op">);</span></span><span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a>        model <span class="op">=</span> glm<span class="op">::</span>scale<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">));</span> <span class="co">// a smaller cube</span></span><span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a>        lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"model"</span><span class="op">,</span> model<span class="op">);</span></span><span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>lightCubeVAO<span class="op">);</span></span><span id="cb3-272"><a href="#cb3-272" aria-hidden="true" tabindex="-1"></a>        glDrawArrays<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">36</span><span class="op">);</span></span><span id="cb3-273"><a href="#cb3-273" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-274"><a href="#cb3-274" aria-hidden="true" tabindex="-1"></a>        <span class="co">// bind Texture1</span></span><span id="cb3-275"><a href="#cb3-275" aria-hidden="true" tabindex="-1"></a>        <span class="co">/*glActiveTexture(GL_TEXTURE0);</span></span><span id="cb3-276"><a href="#cb3-276" aria-hidden="true" tabindex="-1"></a><span class="co">        glBindTexture(GL_TEXTURE_2D, diffuseMap);*/</span></span><span id="cb3-277"><a href="#cb3-277" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-278"><a href="#cb3-278" aria-hidden="true" tabindex="-1"></a>        textureShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>mmapVAO<span class="op">);</span></span><span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a>        glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">6</span><span class="op">,</span> GL_UNSIGNED_INT<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a>        glfwSwapBuffers<span class="op">(</span>window<span class="op">);</span></span><span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a>        glfwPollEvents<span class="op">();</span></span><span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a>    glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>cubeVAO<span class="op">);</span></span><span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a>    glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>lightCubeVAO<span class="op">);</span></span><span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a>    glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a>    glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapVAO<span class="op">);</span></span><span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a>    glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapVBO<span class="op">);</span></span><span id="cb3-292"><a href="#cb3-292" aria-hidden="true" tabindex="-1"></a>    glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>mmapEBO<span class="op">);</span></span><span id="cb3-293"><a href="#cb3-293" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-294"><a href="#cb3-294" aria-hidden="true" tabindex="-1"></a>TERMINATE<span class="op">:</span></span><span id="cb3-295"><a href="#cb3-295" aria-hidden="true" tabindex="-1"></a>    glfwTerminate<span class="op">();</span></span><span id="cb3-296"><a href="#cb3-296" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-297"><a href="#cb3-297" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb3-298"><a href="#cb3-298" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-299"><a href="#cb3-299" aria-hidden="true" tabindex="-1"></a><span class="co">// process all input: query GLFW whether relevant keys are pressed/released this frame and react accordingly</span></span><span id="cb3-300"><a href="#cb3-300" aria-hidden="true" tabindex="-1"></a><span class="co">// ---------------------------------------------------------------------------------------------------------</span></span><span id="cb3-301"><a href="#cb3-301" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">)</span></span><span id="cb3-302"><a href="#cb3-302" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-303"><a href="#cb3-303" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_ESCAPE<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb3-304"><a href="#cb3-304" aria-hidden="true" tabindex="-1"></a>        glfwSetWindowShouldClose<span class="op">(</span>window<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span><span id="cb3-305"><a href="#cb3-305" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-306"><a href="#cb3-306" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_W<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb3-307"><a href="#cb3-307" aria-hidden="true" tabindex="-1"></a>        camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>FORWARD<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb3-308"><a href="#cb3-308" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_S<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb3-309"><a href="#cb3-309" aria-hidden="true" tabindex="-1"></a>        camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>BACKWARD<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb3-310"><a href="#cb3-310" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_A<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb3-311"><a href="#cb3-311" aria-hidden="true" tabindex="-1"></a>        camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>LEFT<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb3-312"><a href="#cb3-312" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_D<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb3-313"><a href="#cb3-313" aria-hidden="true" tabindex="-1"></a>        camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>RIGHT<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb3-314"><a href="#cb3-314" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb3-315"><a href="#cb3-315" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-316"><a href="#cb3-316" aria-hidden="true" tabindex="-1"></a><span class="co">// glfw: whenever the window size changed (by OS or user resize) this callback function executes</span></span><span id="cb3-317"><a href="#cb3-317" aria-hidden="true" tabindex="-1"></a><span class="co">// ---------------------------------------------------------------------------------------------</span></span><span id="cb3-318"><a href="#cb3-318" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">)</span></span><span id="cb3-319"><a href="#cb3-319" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-320"><a href="#cb3-320" aria-hidden="true" tabindex="-1"></a>    <span class="co">// make sure the viewport matches the new window dimensions; note that width and </span></span><span id="cb3-321"><a href="#cb3-321" aria-hidden="true" tabindex="-1"></a>    <span class="co">// height will be significantly larger than specified on retina displays.</span></span><span id="cb3-322"><a href="#cb3-322" aria-hidden="true" tabindex="-1"></a>    glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height<span class="op">);</span></span><span id="cb3-323"><a href="#cb3-323" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb3-324"><a href="#cb3-324" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-325"><a href="#cb3-325" aria-hidden="true" tabindex="-1"></a><span class="co">// glfw: whenever the mouse moves, this callback is called</span></span><span id="cb3-326"><a href="#cb3-326" aria-hidden="true" tabindex="-1"></a><span class="co">// -------------------------------------------------------</span></span><span id="cb3-327"><a href="#cb3-327" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> mouse_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xpos<span class="op">,</span> <span class="dt">double</span> ypos<span class="op">)</span></span><span id="cb3-328"><a href="#cb3-328" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-329"><a href="#cb3-329" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>firstMouse<span class="op">)</span></span><span id="cb3-330"><a href="#cb3-330" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb3-331"><a href="#cb3-331" aria-hidden="true" tabindex="-1"></a>        lastX <span class="op">=</span> xpos<span class="op">;</span></span><span id="cb3-332"><a href="#cb3-332" aria-hidden="true" tabindex="-1"></a>        lastY <span class="op">=</span> ypos<span class="op">;</span></span><span id="cb3-333"><a href="#cb3-333" aria-hidden="true" tabindex="-1"></a>        firstMouse <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb3-334"><a href="#cb3-334" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb3-335"><a href="#cb3-335" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-336"><a href="#cb3-336" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> xoffset <span class="op">=</span> xpos <span class="op">-</span> lastX<span class="op">;</span></span><span id="cb3-337"><a href="#cb3-337" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> yoffset <span class="op">=</span> lastY <span class="op">-</span> ypos<span class="op">;</span> <span class="co">// reversed since y-coordinates go from bottom to top</span></span><span id="cb3-338"><a href="#cb3-338" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-339"><a href="#cb3-339" aria-hidden="true" tabindex="-1"></a>    lastX <span class="op">=</span> xpos<span class="op">;</span></span><span id="cb3-340"><a href="#cb3-340" aria-hidden="true" tabindex="-1"></a>    lastY <span class="op">=</span> ypos<span class="op">;</span></span><span id="cb3-341"><a href="#cb3-341" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-342"><a href="#cb3-342" aria-hidden="true" tabindex="-1"></a>    camera<span class="op">.</span>ProcessMouseMovement<span class="op">(</span>xoffset<span class="op">,</span> yoffset<span class="op">);</span></span><span id="cb3-343"><a href="#cb3-343" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb3-344"><a href="#cb3-344" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-345"><a href="#cb3-345" aria-hidden="true" tabindex="-1"></a><span class="co">// glfw: whenever the mouse scroll wheel scrolls, this callback is called</span></span><span id="cb3-346"><a href="#cb3-346" aria-hidden="true" tabindex="-1"></a><span class="co">// ----------------------------------------------------------------------</span></span><span id="cb3-347"><a href="#cb3-347" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> scroll_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xoffset<span class="op">,</span> <span class="dt">double</span> yoffset<span class="op">)</span></span><span id="cb3-348"><a href="#cb3-348" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-349"><a href="#cb3-349" aria-hidden="true" tabindex="-1"></a>    camera<span class="op">.</span>ProcessMouseScroll<span class="op">(</span>yoffset<span class="op">);</span></span><span id="cb3-350"><a href="#cb3-350" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb3-351"><a href="#cb3-351" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-352"><a href="#cb3-352" aria-hidden="true" tabindex="-1"></a><span class="co">// utility function for loading a 2D texture from file</span></span><span id="cb3-353"><a href="#cb3-353" aria-hidden="true" tabindex="-1"></a><span class="co">// ---------------------------------------------------</span></span><span id="cb3-354"><a href="#cb3-354" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> loadTexture<span class="op">(</span><span class="dt">char</span> <span class="at">const</span> <span class="op">*</span> path<span class="op">)</span></span><span id="cb3-355"><a href="#cb3-355" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-356"><a href="#cb3-356" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> textureID<span class="op">;</span></span><span id="cb3-357"><a href="#cb3-357" aria-hidden="true" tabindex="-1"></a>    glGenTextures<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>textureID<span class="op">);</span></span><span id="cb3-358"><a href="#cb3-358" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-359"><a href="#cb3-359" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> width<span class="op">,</span> height<span class="op">,</span> nrComponents<span class="op">;</span></span><span id="cb3-360"><a href="#cb3-360" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>data <span class="op">=</span> stbi_load<span class="op">(</span>path<span class="op">,</span> <span class="op">&amp;</span>width<span class="op">,</span> <span class="op">&amp;</span>height<span class="op">,</span> <span class="op">&amp;</span>nrComponents<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-361"><a href="#cb3-361" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>data<span class="op">)</span></span><span id="cb3-362"><a href="#cb3-362" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb3-363"><a href="#cb3-363" aria-hidden="true" tabindex="-1"></a>        GLenum format<span class="op">;</span></span><span id="cb3-364"><a href="#cb3-364" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>nrComponents <span class="op">==</span> <span class="dv">1</span><span class="op">)</span></span><span id="cb3-365"><a href="#cb3-365" aria-hidden="true" tabindex="-1"></a>            format <span class="op">=</span> GL_RED<span class="op">;</span></span><span id="cb3-366"><a href="#cb3-366" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>nrComponents <span class="op">==</span> <span class="dv">3</span><span class="op">)</span></span><span id="cb3-367"><a href="#cb3-367" aria-hidden="true" tabindex="-1"></a>            format <span class="op">=</span> GL_RGB<span class="op">;</span></span><span id="cb3-368"><a href="#cb3-368" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>nrComponents <span class="op">==</span> <span class="dv">4</span><span class="op">)</span></span><span id="cb3-369"><a href="#cb3-369" aria-hidden="true" tabindex="-1"></a>            format <span class="op">=</span> GL_RGBA<span class="op">;</span></span><span id="cb3-370"><a href="#cb3-370" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-371"><a href="#cb3-371" aria-hidden="true" tabindex="-1"></a>        glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> textureID<span class="op">);</span></span><span id="cb3-372"><a href="#cb3-372" aria-hidden="true" tabindex="-1"></a>        glTexImage2D<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> format<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> format<span class="op">,</span> GL_UNSIGNED_BYTE<span class="op">,</span> data<span class="op">);</span></span><span id="cb3-373"><a href="#cb3-373" aria-hidden="true" tabindex="-1"></a>        glGenerateMipmap<span class="op">(</span>GL_TEXTURE_2D<span class="op">);</span></span><span id="cb3-374"><a href="#cb3-374" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-375"><a href="#cb3-375" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_S<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb3-376"><a href="#cb3-376" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_T<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb3-377"><a href="#cb3-377" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MIN_FILTER<span class="op">,</span> GL_LINEAR_MIPMAP_LINEAR<span class="op">);</span></span><span id="cb3-378"><a href="#cb3-378" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MAG_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb3-379"><a href="#cb3-379" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-380"><a href="#cb3-380" aria-hidden="true" tabindex="-1"></a>        stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb3-381"><a href="#cb3-381" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb3-382"><a href="#cb3-382" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span><span id="cb3-383"><a href="#cb3-383" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb3-384"><a href="#cb3-384" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Texture failed to load at path: "</span> <span class="op">&lt;&lt;</span> path <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb3-385"><a href="#cb3-385" aria-hidden="true" tabindex="-1"></a>        stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb3-386"><a href="#cb3-386" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb3-387"><a href="#cb3-387" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-388"><a href="#cb3-388" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> textureID<span class="op">;</span></span><span id="cb3-389"><a href="#cb3-389" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/02-guang-zhao-bu-fen/3.shu-xing-feng-zhuang-cai-zhi/"/>
      <url>/2022/08/10/opengl/02-guang-zhao-bu-fen/3.shu-xing-feng-zhuang-cai-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="å±æ€§å°è£…-æè´¨å…‰">å±æ€§å°è£…-æè´¨ã€å…‰</h2><blockquote><p>ä¸»è¦æ˜¯é’ˆå¯¹é¢å‘å¯¹è±¡çš„è®¾è®¡ï¼Œshaderæ•°æ®ä½¿ç”¨<code>ç»“æ„struct</code>æ¥æŠ½è±¡ä¸ªä½“</p></blockquote><hr><ol type="1"><li><p>æè´¨ &gt; æè¿°ç‰©ä½“ç‰¹æœ‰åå°„ã€æ•£å°„ã€é«˜å…‰ç­‰å±æ€§ã€‚</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ç»“æ„å®šä¹‰</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Material <span class="op">{</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        vec3 ambient<span class="op">;</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        vec3 diffuse<span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        vec3 specular<span class="op">;</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> shininess<span class="op">;</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span> </span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">//æè´¨å±æ€§</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    uniform Material material<span class="op">;</span></span></code></pre></div></li><li><p>ä½¿ç”¨æè´¨å±æ€§å˜é‡</p><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span>    </span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ç¯å¢ƒå…‰</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        vec3 ambient <span class="op">=</span> lightColor <span class="op">*</span> material<span class="op">.</span>ambient<span class="op">;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// æ¼«åå°„ </span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>        vec3 norm <span class="op">=</span> normalize<span class="op">(</span>Normal<span class="op">);</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>        vec3 lightDir <span class="op">=</span> normalize<span class="op">(</span>lightPos <span class="op">-</span> FragPos<span class="op">);</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> diff <span class="op">=</span> max<span class="op">(</span>dot<span class="op">(</span>norm<span class="op">,</span> lightDir<span class="op">),</span> <span class="fl">0.0</span><span class="op">);</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        vec3 diffuse <span class="op">=</span> lightColor <span class="op">*</span> <span class="op">(</span>diff <span class="op">*</span> material<span class="op">.</span>diffuse<span class="op">);</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">// é•œé¢å…‰</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        vec3 viewDir <span class="op">=</span> normalize<span class="op">(</span>viewPos <span class="op">-</span> FragPos<span class="op">);</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        vec3 reflectDir <span class="op">=</span> reflect<span class="op">(-</span>lightDir<span class="op">,</span> norm<span class="op">);</span>  </span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> spec <span class="op">=</span> pow<span class="op">(</span>max<span class="op">(</span>dot<span class="op">(</span>viewDir<span class="op">,</span> reflectDir<span class="op">),</span> <span class="fl">0.0</span><span class="op">),</span> material<span class="op">.</span>shininess<span class="op">);</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        vec3 specular <span class="op">=</span> lightColor <span class="op">*</span> <span class="op">(</span>spec <span class="op">*</span> material<span class="op">.</span>specular<span class="op">);</span>  </span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        vec3 result <span class="op">=</span> ambient <span class="op">+</span> diffuse <span class="op">+</span> specular<span class="op">;</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> vec4<span class="op">(</span>result<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li><li><p>ä¸ºShaderæè´¨å±æ€§è®¾ç½®å€¼ &gt;ç»“æ„ä½“åªæ˜¯ä½œä¸ºuniformå˜é‡çš„ä¸€ä¸ªå°è£…ï¼Œæ‰€ä»¥å¦‚æœæƒ³å¡«å……è¿™ä¸ªç»“æ„ä½“çš„è¯ï¼Œæˆ‘ä»¬ä»éœ€è¦å¯¹<code>æ¯ä¸ªå•ç‹¬çš„uniformè¿›è¡Œè®¾ç½®</code>ï¼Œä½†è¿™æ¬¡è¦å¸¦ä¸Šç»“æ„ä½“åçš„å‰ç¼€ï¼š</p><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"material.ambient"</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.31</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"material.diffuse"</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.31</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"material.specular"</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"material.shininess"</span><span class="op">,</span> <span class="fl">32.0</span><span class="bu">f</span><span class="op">);</span></span></code></pre></div></li><li><p>å…‰çš„å±æ€§ &gt; å…‰çš„å¯¹åº”å±æ€§å åŠ æè´¨å¯¹åº”å±æ€§</p><div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> Light <span class="op">{</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    vec3 position<span class="op">;</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    vec3 ambient<span class="op">;</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    vec3 diffuse<span class="op">;</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    vec3 specular<span class="op">;</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>uniform Light light<span class="op">;</span></span></code></pre></div></li><li><p>ä½¿ç”¨å…‰å±æ€§å˜é‡<code>cpp         void main()         {             // ambient             vec3 ambient = light.ambient * material.ambient;                         // diffuse              vec3 norm = normalize(Normal);             vec3 lightDir = normalize(light.position - FragPos);             float diff = max(dot(norm, lightDir), 0.0);             vec3 diffuse = light.diffuse * (diff * material.diffuse);                        // specular             vec3 viewDir = normalize(viewPos - FragPos);             vec3 reflectDir = reflect(-lightDir, norm);               float spec = pow(max(dot(viewDir, reflectDir), 0.0), material.shininess);             vec3 specular = light.specular * (spec * material.specular);                             vec3 result = ambient + diffuse + specular;             FragColor = vec4(result, 1.0);         }</code></p></li><li><p>ä¸ºå…‰å±æ€§ä¼ é€’å€¼<code>cpp         lightingShader.setVec3("light.ambient",  0.2f, 0.2f, 0.2f);         lightingShader.setVec3("light.diffuse",  0.5f, 0.5f, 0.5f); // å°†å…‰ç…§è°ƒæš—äº†ä¸€äº›ä»¥æ­é…åœºæ™¯         lightingShader.setVec3("light.specular", 1.0f, 1.0f, 1.0f);</code></p></li><li><p>å®Œæ•´ä»£ç </p><div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;glad/glad.h&gt;</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;GLFW/glfw3.h&gt;</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;glm/glm.hpp&gt;</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;glm/gtc/matrix_transform.hpp&gt;</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;glm/gtc/type_ptr.hpp&gt;</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;shader_m.h&gt;</span></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;camera.h&gt;</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">);</span></span><span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> mouse_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xpos<span class="op">,</span> <span class="dt">double</span> ypos<span class="op">);</span></span><span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> scroll_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xoffset<span class="op">,</span> <span class="dt">double</span> yoffset<span class="op">);</span></span><span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">);</span></span><span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">// settings</span></span><span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">int</span> SCR_WIDTH <span class="op">=</span> <span class="dv">800</span><span class="op">;</span></span><span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">unsigned</span> <span class="dt">int</span> SCR_HEIGHT <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span><span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">// camera</span></span><span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>    Camera camera<span class="op">(</span>glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">3.0</span><span class="bu">f</span><span class="op">));</span></span><span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> lastX <span class="op">=</span> SCR_WIDTH <span class="op">/</span> <span class="fl">2.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> lastY <span class="op">=</span> SCR_HEIGHT <span class="op">/</span> <span class="fl">2.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> firstMouse <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="co">// timing</span></span><span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> deltaTime <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> lastFrame <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="co">// lighting</span></span><span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    glm<span class="op">::</span>vec3 lightPos<span class="op">(</span><span class="fl">1.2</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">2.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> main<span class="op">()</span></span><span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">// glfw: initialize and configure</span></span><span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ------------------------------</span></span><span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>        glfwInit<span class="op">();</span></span><span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_OPENGL_PROFILE<span class="op">,</span> GLFW_OPENGL_CORE_PROFILE<span class="op">);</span></span><span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#ifdef __APPLE__</span></span><span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_OPENGL_FORWARD_COMPAT<span class="op">,</span> GL_TRUE<span class="op">);</span></span><span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span><span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>        <span class="co">// glfw window creation</span></span><span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">// --------------------</span></span><span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>        GLFWwindow<span class="op">*</span> window <span class="op">=</span> glfwCreateWindow<span class="op">(</span>SCR_WIDTH<span class="op">,</span> SCR_HEIGHT<span class="op">,</span> <span class="st">"LearnOpenGL"</span><span class="op">,</span> NULL<span class="op">,</span> NULL<span class="op">);</span></span><span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>window <span class="op">==</span> NULL<span class="op">)</span></span><span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to create GLFW window"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>            glfwTerminate<span class="op">();</span></span><span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>        glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span><span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>        glfwSetFramebufferSizeCallback<span class="op">(</span>window<span class="op">,</span> framebuffer_size_callback<span class="op">);</span></span><span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>        glfwSetCursorPosCallback<span class="op">(</span>window<span class="op">,</span> mouse_callback<span class="op">);</span></span><span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>        glfwSetScrollCallback<span class="op">(</span>window<span class="op">,</span> scroll_callback<span class="op">);</span></span><span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">// tell GLFW to capture our mouse</span></span><span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>        glfwSetInputMode<span class="op">(</span>window<span class="op">,</span> GLFW_CURSOR<span class="op">,</span> GLFW_CURSOR_DISABLED<span class="op">);</span></span><span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>        <span class="co">// glad: load all OpenGL function pointers</span></span><span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ---------------------------------------</span></span><span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>gladLoadGLLoader<span class="op">((</span>GLADloadproc<span class="op">)</span>glfwGetProcAddress<span class="op">))</span></span><span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to initialize GLAD"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span><span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">//xx</span></span><span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>        glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> SCR_WIDTH<span class="op">,</span> SCR_WIDTH<span class="op">);</span></span><span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>        <span class="co">// configure global opengl state</span></span><span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>        <span class="co">// -----------------------------</span></span><span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>        glEnable<span class="op">(</span>GL_DEPTH_TEST<span class="op">);</span></span><span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>        <span class="co">// build and compile our shader zprogram</span></span><span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ------------------------------------</span></span><span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>        Shader lightingShader<span class="op">(</span><span class="st">"res/shaders/light_object_material.vs"</span><span class="op">,</span> <span class="st">"res/shaders/light_object_material.fs"</span><span class="op">);</span></span><span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>        Shader lightCubeShader<span class="op">(</span><span class="st">"res/shaders/cube.vs"</span><span class="op">,</span> <span class="st">"res/shaders/white.fs"</span><span class="op">);</span></span><span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>        <span class="co">// set up vertex data (and buffer(s)) and configure vertex attributes</span></span><span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ------------------------------------------------------------------</span></span><span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> vertices<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.0</span><span class="bu">f</span></span><span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a>        <span class="op">};</span></span><span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>        <span class="co">// first, configure the cube's VAO (and VBO)</span></span><span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> VBO<span class="op">,</span> cubeVAO<span class="op">;</span></span><span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>        glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>cubeVAO<span class="op">);</span></span><span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>        glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>        glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>vertices<span class="op">),</span> vertices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>cubeVAO<span class="op">);</span></span><span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a>        <span class="co">// position attribute</span></span><span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">6</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a>        <span class="co">// normal attribute</span></span><span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">6</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a>        <span class="co">// second, configure the light's VAO (VBO stays the same; the vertices are the same for the light object which is also a 3D cube)</span></span><span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> lightCubeVAO<span class="op">;</span></span><span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a>        glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>lightCubeVAO<span class="op">);</span></span><span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>lightCubeVAO<span class="op">);</span></span><span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>        <span class="co">// note that we update the lamp's position attribute's stride to reflect the updated buffer data</span></span><span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">6</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a>        <span class="co">// render loop</span></span><span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a>        <span class="co">// -----------</span></span><span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!</span>glfwWindowShouldClose<span class="op">(</span>window<span class="op">))</span></span><span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>            <span class="co">// per-frame time logic</span></span><span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a>            <span class="co">// --------------------</span></span><span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>            <span class="dt">float</span> currentFrame <span class="op">=</span> glfwGetTime<span class="op">();</span></span><span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a>            deltaTime <span class="op">=</span> currentFrame <span class="op">-</span> lastFrame<span class="op">;</span></span><span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a>            lastFrame <span class="op">=</span> currentFrame<span class="op">;</span></span><span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a>            <span class="co">// input</span></span><span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a>            <span class="co">// -----</span></span><span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a>            processInput<span class="op">(</span>window<span class="op">);</span></span><span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a>            <span class="co">// render</span></span><span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a>            <span class="co">// ------</span></span><span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a>            glClearColor<span class="op">(</span><span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a>            glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT <span class="op">|</span> GL_DEPTH_BUFFER_BIT<span class="op">);</span></span><span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a>            <span class="co">// be sure to activate shader when setting uniforms/drawing objects</span></span><span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a>            lightingShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a>            lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.position"</span><span class="op">,</span> lightPos<span class="op">);</span></span><span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a>            lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"viewPos"</span><span class="op">,</span> camera<span class="op">.</span>Position<span class="op">);</span></span><span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a>            <span class="co">// light properties</span></span><span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a>            glm<span class="op">::</span>vec3 lightColor<span class="op">;</span></span><span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a>            lightColor<span class="op">.</span>x <span class="op">=</span> sin<span class="op">(</span>glfwGetTime<span class="op">()</span> <span class="op">*</span> <span class="fl">2.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>            lightColor<span class="op">.</span>y <span class="op">=</span> sin<span class="op">(</span>glfwGetTime<span class="op">()</span> <span class="op">*</span> <span class="fl">0.7</span><span class="bu">f</span><span class="op">);</span></span><span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a>            lightColor<span class="op">.</span>z <span class="op">=</span> sin<span class="op">(</span>glfwGetTime<span class="op">()</span> <span class="op">*</span> <span class="fl">1.3</span><span class="bu">f</span><span class="op">);</span></span><span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a>            glm<span class="op">::</span>vec3 diffuseColor <span class="op">=</span> lightColor <span class="op">*</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">);</span> <span class="co">// decrease the influence</span></span><span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a>            glm<span class="op">::</span>vec3 ambientColor <span class="op">=</span> diffuseColor <span class="op">*</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">);</span> <span class="co">// low influence</span></span><span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a>            lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.ambient"</span><span class="op">,</span> ambientColor<span class="op">);</span></span><span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a>            lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.diffuse"</span><span class="op">,</span> diffuseColor<span class="op">);</span></span><span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a>            lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"light.specular"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a>            <span class="co">// material properties</span></span><span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a>            lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"material.ambient"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.31</span><span class="bu">f</span><span class="op">);</span></span><span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a>            lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"material.diffuse"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.31</span><span class="bu">f</span><span class="op">);</span></span><span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a>            lightingShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"material.specular"</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">);</span> <span class="co">// specular lighting doesn't have full effect on this object's material</span></span><span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a>            lightingShader<span class="op">.</span>setFloat<span class="op">(</span><span class="st">"material.shininess"</span><span class="op">,</span> <span class="fl">32.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-199"><a href="#cb5-199" aria-hidden="true" tabindex="-1"></a>            <span class="co">// view/projection transformations</span></span><span id="cb5-200"><a href="#cb5-200" aria-hidden="true" tabindex="-1"></a>            glm<span class="op">::</span>mat4 projection <span class="op">=</span> glm<span class="op">::</span>perspective<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span>camera<span class="op">.</span>Zoom<span class="op">),</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>SCR_WIDTH <span class="op">/</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>SCR_HEIGHT<span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">100.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb5-201"><a href="#cb5-201" aria-hidden="true" tabindex="-1"></a>            glm<span class="op">::</span>mat4 view <span class="op">=</span> camera<span class="op">.</span>GetViewMatrix<span class="op">();</span></span><span id="cb5-202"><a href="#cb5-202" aria-hidden="true" tabindex="-1"></a>            lightingShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"projection"</span><span class="op">,</span> projection<span class="op">);</span></span><span id="cb5-203"><a href="#cb5-203" aria-hidden="true" tabindex="-1"></a>            lightingShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"view"</span><span class="op">,</span> view<span class="op">);</span></span><span id="cb5-204"><a href="#cb5-204" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-205"><a href="#cb5-205" aria-hidden="true" tabindex="-1"></a>            <span class="co">// world transformation</span></span><span id="cb5-206"><a href="#cb5-206" aria-hidden="true" tabindex="-1"></a>            glm<span class="op">::</span>mat4 model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb5-207"><a href="#cb5-207" aria-hidden="true" tabindex="-1"></a>            lightingShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"model"</span><span class="op">,</span> model<span class="op">);</span></span><span id="cb5-208"><a href="#cb5-208" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-209"><a href="#cb5-209" aria-hidden="true" tabindex="-1"></a>            <span class="co">// render the cube</span></span><span id="cb5-210"><a href="#cb5-210" aria-hidden="true" tabindex="-1"></a>            glBindVertexArray<span class="op">(</span>cubeVAO<span class="op">);</span></span><span id="cb5-211"><a href="#cb5-211" aria-hidden="true" tabindex="-1"></a>            glDrawArrays<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">36</span><span class="op">);</span></span><span id="cb5-212"><a href="#cb5-212" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-213"><a href="#cb5-213" aria-hidden="true" tabindex="-1"></a>            <span class="co">// also draw the lamp object</span></span><span id="cb5-214"><a href="#cb5-214" aria-hidden="true" tabindex="-1"></a>            lightCubeShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb5-215"><a href="#cb5-215" aria-hidden="true" tabindex="-1"></a>            lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"projection"</span><span class="op">,</span> projection<span class="op">);</span></span><span id="cb5-216"><a href="#cb5-216" aria-hidden="true" tabindex="-1"></a>            lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"view"</span><span class="op">,</span> view<span class="op">);</span></span><span id="cb5-217"><a href="#cb5-217" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb5-218"><a href="#cb5-218" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> lightPos<span class="op">);</span></span><span id="cb5-219"><a href="#cb5-219" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> glm<span class="op">::</span>scale<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">));</span> <span class="co">// a smaller cube</span></span><span id="cb5-220"><a href="#cb5-220" aria-hidden="true" tabindex="-1"></a>            lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"model"</span><span class="op">,</span> model<span class="op">);</span></span><span id="cb5-221"><a href="#cb5-221" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-222"><a href="#cb5-222" aria-hidden="true" tabindex="-1"></a>            glBindVertexArray<span class="op">(</span>lightCubeVAO<span class="op">);</span></span><span id="cb5-223"><a href="#cb5-223" aria-hidden="true" tabindex="-1"></a>            glDrawArrays<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">36</span><span class="op">);</span></span><span id="cb5-224"><a href="#cb5-224" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-225"><a href="#cb5-225" aria-hidden="true" tabindex="-1"></a>            <span class="co">// glfw: swap buffers and poll IO events (keys pressed/released, mouse moved etc.)</span></span><span id="cb5-226"><a href="#cb5-226" aria-hidden="true" tabindex="-1"></a>            <span class="co">// -------------------------------------------------------------------------------</span></span><span id="cb5-227"><a href="#cb5-227" aria-hidden="true" tabindex="-1"></a>            glfwSwapBuffers<span class="op">(</span>window<span class="op">);</span></span><span id="cb5-228"><a href="#cb5-228" aria-hidden="true" tabindex="-1"></a>            glfwPollEvents<span class="op">();</span></span><span id="cb5-229"><a href="#cb5-229" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb5-230"><a href="#cb5-230" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-231"><a href="#cb5-231" aria-hidden="true" tabindex="-1"></a>        <span class="co">// optional: de-allocate all resources once they've outlived their purpose:</span></span><span id="cb5-232"><a href="#cb5-232" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ------------------------------------------------------------------------</span></span><span id="cb5-233"><a href="#cb5-233" aria-hidden="true" tabindex="-1"></a>        glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>cubeVAO<span class="op">);</span></span><span id="cb5-234"><a href="#cb5-234" aria-hidden="true" tabindex="-1"></a>        glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>lightCubeVAO<span class="op">);</span></span><span id="cb5-235"><a href="#cb5-235" aria-hidden="true" tabindex="-1"></a>        glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb5-236"><a href="#cb5-236" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-237"><a href="#cb5-237" aria-hidden="true" tabindex="-1"></a>        <span class="co">// glfw: terminate, clearing all previously allocated GLFW resources.</span></span><span id="cb5-238"><a href="#cb5-238" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ------------------------------------------------------------------</span></span><span id="cb5-239"><a href="#cb5-239" aria-hidden="true" tabindex="-1"></a>        glfwTerminate<span class="op">();</span></span><span id="cb5-240"><a href="#cb5-240" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb5-241"><a href="#cb5-241" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb5-242"><a href="#cb5-242" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-243"><a href="#cb5-243" aria-hidden="true" tabindex="-1"></a>    <span class="co">// process all input: query GLFW whether relevant keys are pressed/released this frame and react accordingly</span></span><span id="cb5-244"><a href="#cb5-244" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ---------------------------------------------------------------------------------------------------------</span></span><span id="cb5-245"><a href="#cb5-245" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">)</span></span><span id="cb5-246"><a href="#cb5-246" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb5-247"><a href="#cb5-247" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_ESCAPE<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb5-248"><a href="#cb5-248" aria-hidden="true" tabindex="-1"></a>            glfwSetWindowShouldClose<span class="op">(</span>window<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span><span id="cb5-249"><a href="#cb5-249" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-250"><a href="#cb5-250" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_W<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb5-251"><a href="#cb5-251" aria-hidden="true" tabindex="-1"></a>            camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>FORWARD<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb5-252"><a href="#cb5-252" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_S<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb5-253"><a href="#cb5-253" aria-hidden="true" tabindex="-1"></a>            camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>BACKWARD<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb5-254"><a href="#cb5-254" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_A<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb5-255"><a href="#cb5-255" aria-hidden="true" tabindex="-1"></a>            camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>LEFT<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb5-256"><a href="#cb5-256" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_D<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb5-257"><a href="#cb5-257" aria-hidden="true" tabindex="-1"></a>            camera<span class="op">.</span>ProcessKeyboard<span class="op">(</span>RIGHT<span class="op">,</span> deltaTime<span class="op">);</span></span><span id="cb5-258"><a href="#cb5-258" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb5-259"><a href="#cb5-259" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-260"><a href="#cb5-260" aria-hidden="true" tabindex="-1"></a>    <span class="co">// glfw: whenever the window size changed (by OS or user resize) this callback function executes</span></span><span id="cb5-261"><a href="#cb5-261" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ---------------------------------------------------------------------------------------------</span></span><span id="cb5-262"><a href="#cb5-262" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">)</span></span><span id="cb5-263"><a href="#cb5-263" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb5-264"><a href="#cb5-264" aria-hidden="true" tabindex="-1"></a>        <span class="co">// make sure the viewport matches the new window dimensions; note that width and </span></span><span id="cb5-265"><a href="#cb5-265" aria-hidden="true" tabindex="-1"></a>        <span class="co">// height will be significantly larger than specified on retina displays.</span></span><span id="cb5-266"><a href="#cb5-266" aria-hidden="true" tabindex="-1"></a>        glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height<span class="op">);</span></span><span id="cb5-267"><a href="#cb5-267" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb5-268"><a href="#cb5-268" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-269"><a href="#cb5-269" aria-hidden="true" tabindex="-1"></a>    <span class="co">// glfw: whenever the mouse moves, this callback is called</span></span><span id="cb5-270"><a href="#cb5-270" aria-hidden="true" tabindex="-1"></a>    <span class="co">// -------------------------------------------------------</span></span><span id="cb5-271"><a href="#cb5-271" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> mouse_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xpos<span class="op">,</span> <span class="dt">double</span> ypos<span class="op">)</span></span><span id="cb5-272"><a href="#cb5-272" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb5-273"><a href="#cb5-273" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>firstMouse<span class="op">)</span></span><span id="cb5-274"><a href="#cb5-274" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb5-275"><a href="#cb5-275" aria-hidden="true" tabindex="-1"></a>            lastX <span class="op">=</span> xpos<span class="op">;</span></span><span id="cb5-276"><a href="#cb5-276" aria-hidden="true" tabindex="-1"></a>            lastY <span class="op">=</span> ypos<span class="op">;</span></span><span id="cb5-277"><a href="#cb5-277" aria-hidden="true" tabindex="-1"></a>            firstMouse <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb5-278"><a href="#cb5-278" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb5-279"><a href="#cb5-279" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-280"><a href="#cb5-280" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> xoffset <span class="op">=</span> xpos <span class="op">-</span> lastX<span class="op">;</span></span><span id="cb5-281"><a href="#cb5-281" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> yoffset <span class="op">=</span> lastY <span class="op">-</span> ypos<span class="op">;</span> <span class="co">// reversed since y-coordinates go from bottom to top</span></span><span id="cb5-282"><a href="#cb5-282" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-283"><a href="#cb5-283" aria-hidden="true" tabindex="-1"></a>        lastX <span class="op">=</span> xpos<span class="op">;</span></span><span id="cb5-284"><a href="#cb5-284" aria-hidden="true" tabindex="-1"></a>        lastY <span class="op">=</span> ypos<span class="op">;</span></span><span id="cb5-285"><a href="#cb5-285" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-286"><a href="#cb5-286" aria-hidden="true" tabindex="-1"></a>        camera<span class="op">.</span>ProcessMouseMovement<span class="op">(</span>xoffset<span class="op">,</span> yoffset<span class="op">);</span></span><span id="cb5-287"><a href="#cb5-287" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb5-288"><a href="#cb5-288" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-289"><a href="#cb5-289" aria-hidden="true" tabindex="-1"></a>    <span class="co">// glfw: whenever the mouse scroll wheel scrolls, this callback is called</span></span><span id="cb5-290"><a href="#cb5-290" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ----------------------------------------------------------------------</span></span><span id="cb5-291"><a href="#cb5-291" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> scroll_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xoffset<span class="op">,</span> <span class="dt">double</span> yoffset<span class="op">)</span></span><span id="cb5-292"><a href="#cb5-292" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb5-293"><a href="#cb5-293" aria-hidden="true" tabindex="-1"></a>        camera<span class="op">.</span>ProcessMouseScroll<span class="op">(</span>yoffset<span class="op">);</span></span><span id="cb5-294"><a href="#cb5-294" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/02-guang-zhao-bu-fen/2.ji-chu-guang-zhao/"/>
      <url>/2022/08/10/opengl/02-guang-zhao-bu-fen/2.ji-chu-guang-zhao/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸºç¡€å…‰ç…§">åŸºç¡€å…‰ç…§</h2><blockquote><p><code>å†¯æ°å…‰ç…§æ¨¡å‹(Phong Lighting Model)</code></p><hr><p>ç°å®ä¸–ç•Œçš„å…‰ç…§æ˜¯æå…¶å¤æ‚çš„ï¼Œè€Œä¸”ä¼šå—åˆ°è¯¸å¤šå› ç´ çš„å½±å“ï¼Œè¿™æ˜¯æˆ‘ä»¬æœ‰é™çš„è®¡ç®—èƒ½åŠ›æ‰€æ— æ³•æ¨¡æ‹Ÿçš„ã€‚å› æ­¤OpenGLçš„å…‰ç…§ä½¿ç”¨çš„æ˜¯ç®€åŒ–çš„æ¨¡å‹ï¼Œå¯¹ç°å®çš„æƒ…å†µè¿›è¡Œè¿‘ä¼¼ï¼Œè¿™æ ·å¤„ç†èµ·æ¥ä¼šæ›´å®¹æ˜“ä¸€äº›ï¼Œè€Œä¸”çœ‹èµ·æ¥ä¹Ÿå·®ä¸å¤šä¸€æ ·ã€‚è¿™äº›å…‰ç…§æ¨¡å‹éƒ½æ˜¯åŸºäºæˆ‘ä»¬å¯¹å…‰çš„ç‰©ç†ç‰¹æ€§çš„ç†è§£ã€‚å…¶ä¸­ä¸€ä¸ªæ¨¡å‹è¢«ç§°ä¸º<code>å†¯æ°å…‰ç…§æ¨¡å‹(Phong Lighting Model)</code>ã€‚å†¯æ°å…‰ç…§æ¨¡å‹çš„ä¸»è¦ç»“æ„ç”±3ä¸ªåˆ†é‡ç»„æˆï¼šç¯å¢ƒ(Ambient)ã€æ¼«åå°„(Diffuse)å’Œé•œé¢(Specular)å…‰ç…§ã€‚</p></blockquote><ol type="1"><li><p>ç¯å¢ƒå…‰(Ambient Lighting) &gt;å³ä½¿åœ¨é»‘æš—çš„æƒ…å†µä¸‹ï¼Œä¸–ç•Œä¸Šé€šå¸¸ä¹Ÿä»ç„¶æœ‰ä¸€äº›å…‰äº®ï¼ˆæœˆäº®ã€è¿œå¤„çš„å…‰ï¼‰ï¼Œæ‰€ä»¥ç‰©ä½“å‡ ä¹æ°¸è¿œä¸ä¼šæ˜¯å®Œå…¨é»‘æš—çš„ã€‚ä¸ºäº†æ¨¡æ‹Ÿè¿™ä¸ªï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸€ä¸ªç¯å¢ƒå…‰ç…§å¸¸é‡ï¼Œå®ƒæ°¸è¿œä¼šç»™ç‰©ä½“ä¸€äº›é¢œè‰²ã€‚</p><p>å…‰é€šå¸¸éƒ½ä¸æ˜¯æ¥è‡ªäºåŒä¸€ä¸ªå…‰æºï¼Œè€Œæ˜¯æ¥è‡ªäºæˆ‘ä»¬å‘¨å›´åˆ†æ•£çš„å¾ˆå¤šå…‰æºï¼Œå³ä½¿å®ƒä»¬å¯èƒ½å¹¶ä¸æ˜¯é‚£ä¹ˆæ˜¾è€Œæ˜“è§ã€‚å…‰çš„ä¸€ä¸ªå±æ€§æ˜¯ï¼Œå®ƒå¯ä»¥å‘å¾ˆå¤šæ–¹å‘å‘æ•£å¹¶åå¼¹ï¼Œä»è€Œèƒ½å¤Ÿåˆ°è¾¾ä¸æ˜¯éå¸¸ç›´æ¥ä¸´è¿‘çš„ç‚¹ã€‚æ‰€ä»¥ï¼Œå…‰èƒ½å¤Ÿåœ¨å…¶å®ƒçš„è¡¨é¢ä¸Šåå°„ï¼Œå¯¹ä¸€ä¸ªç‰©ä½“äº§ç”Ÿé—´æ¥çš„å½±å“ã€‚è€ƒè™‘åˆ°è¿™ç§æƒ…å†µçš„ç®—æ³•å«åšå…¨å±€ç…§æ˜(GlobalIllumination)ç®—æ³•ï¼Œä½†æ˜¯è¿™ç§ç®—æ³•æ—¢å¼€é”€é«˜æ˜‚åˆæå…¶å¤æ‚ã€‚ç”±äºæˆ‘ä»¬ç°åœ¨å¯¹é‚£ç§åˆå¤æ‚åˆå¼€é”€é«˜æ˜‚çš„ç®—æ³•ä¸æ˜¯å¾ˆæ„Ÿå…´è¶£ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä¼šå…ˆä½¿ç”¨ä¸€ä¸ªç®€åŒ–çš„å…¨å±€ç…§æ˜æ¨¡å‹ï¼Œå³ç¯å¢ƒå…‰ç…§ã€‚æ­£å¦‚ä½ åœ¨ä¸Šä¸€èŠ‚æ‰€å­¦åˆ°çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå¾ˆå°çš„å¸¸é‡ï¼ˆå…‰ç…§ï¼‰é¢œè‰²ï¼Œæ·»åŠ åˆ°ç‰©ä½“ç‰‡æ®µçš„æœ€ç»ˆé¢œè‰²ä¸­ï¼Œè¿™æ ·å­çš„è¯å³ä¾¿åœºæ™¯ä¸­æ²¡æœ‰ç›´æ¥çš„å…‰æºä¹Ÿèƒ½çœ‹èµ·æ¥å­˜åœ¨æœ‰ä¸€äº›å‘æ•£çš„å…‰ã€‚æŠŠç¯å¢ƒå…‰ç…§æ·»åŠ åˆ°åœºæ™¯é‡Œéå¸¸ç®€å•ã€‚æˆ‘ä»¬ç”¨å…‰çš„é¢œè‰²ä¹˜ä»¥ä¸€ä¸ªå¾ˆå°çš„å¸¸é‡ç¯å¢ƒå› å­ï¼Œå†ä¹˜ä»¥ç‰©ä½“çš„é¢œè‰²ï¼Œç„¶åå°†æœ€ç»ˆç»“æœä½œä¸ºç‰‡æ®µçš„é¢œè‰²ï¼š</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> ambientStrength <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        vec3 ambient <span class="op">=</span> ambientStrength <span class="op">*</span> lightColor<span class="op">;</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        vec3 result <span class="op">=</span> ambient <span class="op">*</span> objectColor<span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> vec4<span class="op">(</span>result<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li><li><p>æ¼«åå°„å…‰ç…§(Diffuse Lighting) &gt;æ¨¡æ‹Ÿå…‰æºå¯¹ç‰©ä½“çš„æ–¹å‘æ€§å½±å“(DirectionalImpact)ã€‚å®ƒæ˜¯å†¯æ°å…‰ç…§æ¨¡å‹ä¸­è§†è§‰ä¸Šæœ€æ˜¾è‘—çš„åˆ†é‡ã€‚ç‰©ä½“çš„æŸä¸€éƒ¨åˆ†è¶Šæ˜¯æ­£å¯¹ç€å…‰æºï¼Œå®ƒå°±ä¼šè¶Šäº®ã€‚&gt; ä¸»è¦è®¡ç®—åœ¨äº <code>å…‰ç…§æ–¹å‘</code>ã€<code>å…‰ç…§åˆ†é‡ dot(norm, lightDir)</code>ã€<code>éè´Ÿæ•°æˆªæ–­ max(xx, 0)</code>&gt;æˆ‘ä»¬å¯¹normå’ŒlightDirå‘é‡è¿›è¡Œç‚¹ä¹˜ï¼Œè®¡ç®—å…‰æºå¯¹å½“å‰ç‰‡æ®µå®é™…çš„æ¼«å‘å°„å½±å“ã€‚ç»“æœå€¼å†ä¹˜ä»¥å…‰çš„é¢œè‰²ï¼Œå¾—åˆ°æ¼«åå°„åˆ†é‡ã€‚ä¸¤ä¸ªå‘é‡ä¹‹é—´çš„è§’åº¦è¶Šå¤§ï¼Œæ¼«åå°„åˆ†é‡å°±ä¼šè¶Šå°<code>cpp         #version 330 core         out vec4 FragColor;         in vec3 Normal;           in vec3 FragPos;                   uniform vec3 lightPos;          uniform vec3 lightColor;         uniform vec3 objectColor;         void main()         {             // ambient             float ambientStrength = 0.1;             vec3 ambient = ambientStrength * lightColor;                         // diffuse              vec3 norm = normalize(Normal);             vec3 lightDir = normalize(lightPos - FragPos);             //ç‚¹ä¹˜çš„é›†åˆæ„ä¹‰ï¼ŒæŠ•å½±(åˆ†é‡)å¤§å°             float diff = max(dot(norm, lightDir), 0.0);             vec3 diffuse = diff * lightColor;                                vec3 result = (ambient + diffuse) * objectColor;             FragColor = vec4(result, 1.0);         }</code><code>//ä¸ç­‰æ¯”çš„ç¼©æ”¾ä¼šå¯¼è‡´åŸæœ¬çš„æ³•çº¿ä¸å†å‚ç›´äºè¡¨é¢ï¼Œæ­¤æ—¶éœ€è¦æ³•çº¿çŸ©é˜µæ¥ä¿®å¤         Normal = mat3(transpose(inverse(model))) * aNormal;</code></p></li><li><p>é•œé¢å…‰ç…§(SpecularLighting)ï¼šæ¨¡æ‹Ÿæœ‰å…‰æ³½ç‰©ä½“ä¸Šé¢å‡ºç°çš„äº®ç‚¹ã€‚é•œé¢å…‰ç…§çš„é¢œè‰²ç›¸æ¯”äºç‰©ä½“çš„é¢œè‰²ä¼šæ›´å€¾å‘äºå…‰çš„é¢œè‰²ã€‚</p><blockquote><p>å’Œæ¼«åå°„å…‰ç…§ä¸€æ ·ï¼Œé•œé¢å…‰ç…§ä¹Ÿæ˜¯ä¾æ®å…‰çš„æ–¹å‘å‘é‡å’Œç‰©ä½“çš„æ³•å‘é‡æ¥å†³å®šçš„ï¼Œä½†æ˜¯å®ƒä¹Ÿä¾èµ–äºè§‚å¯Ÿæ–¹å‘ï¼Œä¾‹å¦‚ç©å®¶æ˜¯ä»ä»€ä¹ˆæ–¹å‘çœ‹ç€è¿™ä¸ªç‰‡æ®µçš„ã€‚é•œé¢å…‰ç…§æ˜¯åŸºäºå…‰çš„åå°„ç‰¹æ€§ã€‚å¦‚æœæˆ‘ä»¬æƒ³è±¡ç‰©ä½“è¡¨é¢åƒä¸€é¢é•œå­ä¸€æ ·ï¼Œé‚£ä¹ˆï¼Œæ— è®ºæˆ‘ä»¬ä»å“ªé‡Œå»çœ‹é‚£ä¸ªè¡¨é¢æ‰€åå°„çš„å…‰ï¼Œé•œé¢å…‰ç…§éƒ½ä¼šè¾¾åˆ°æœ€å¤§åŒ–<code>è§‚å¯Ÿç‚¹é€šå¸¸ä½¿ç”¨ç›¸æœºçš„ä½ç½®</code>ï¼Œå’Œ<code>æ¼«åå°„</code>ç±»ä¼¼ï¼Œåªæ˜¯é•œé¢å…‰ç…§æ˜¯åå°„å…‰åœ¨è§‚å¯Ÿæ–¹å‘çš„åˆ†é‡</p></blockquote><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    out vec4 FragColor<span class="op">;</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    in vec3 Normal<span class="op">;</span>  </span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    in vec3 FragPos<span class="op">;</span>          </span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    uniform vec3 lightPos<span class="op">;</span> </span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    uniform vec3 viewPos<span class="op">;</span> </span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    uniform vec3 lightColor<span class="op">;</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    uniform vec3 objectColor<span class="op">;</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    uniform <span class="dt">float</span> specularStrengthPow<span class="op">;</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ambient</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> ambientStrength <span class="op">=</span> <span class="fl">0.1</span><span class="op">;</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        vec3 ambient <span class="op">=</span> ambientStrength <span class="op">*</span> lightColor<span class="op">;</span>            </span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">// diffuse </span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        vec3 norm <span class="op">=</span> normalize<span class="op">(</span>Normal<span class="op">);</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        vec3 lightDir <span class="op">=</span> normalize<span class="op">(</span>lightPos <span class="op">-</span> FragPos<span class="op">);</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> diff <span class="op">=</span> max<span class="op">(</span>dot<span class="op">(</span>norm<span class="op">,</span> lightDir<span class="op">),</span> <span class="fl">0.0</span><span class="op">);</span></span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        vec3 diffuse <span class="op">=</span> diff <span class="op">*</span> lightColor<span class="op">;</span>           </span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// specular</span></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> specularStrength <span class="op">=</span> <span class="fl">0.5</span><span class="op">;</span></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        vec3 viewDir <span class="op">=</span> normalize<span class="op">(</span>viewPos <span class="op">-</span> FragPos<span class="op">);</span></span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        vec3 reflectDir <span class="op">=</span> reflect<span class="op">(-</span>lightDir<span class="op">,</span> norm<span class="op">);</span>  </span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> spec <span class="op">=</span> pow<span class="op">(</span>max<span class="op">(</span>dot<span class="op">(</span>viewDir<span class="op">,</span> reflectDir<span class="op">),</span> <span class="fl">0.0</span><span class="op">),</span> <span class="dv">256</span><span class="op">);</span></span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        vec3 specular <span class="op">=</span> specularStrength <span class="op">*</span> spec <span class="op">*</span> lightColor<span class="op">;</span>               </span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>        vec3 result <span class="op">=</span> <span class="op">(</span>ambient <span class="op">+</span> diffuse <span class="op">+</span> specular<span class="op">)</span> <span class="op">*</span> objectColor<span class="op">;</span></span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">//vec3 result = (ambient + diffuse ) * objectColor;</span></span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        <span class="co">//vec3 result = specular* objectColor;</span></span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        <span class="co">//vec3 result = objectColor;</span></span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> vec4<span class="op">(</span>result<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> </span></code></pre></div></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/02-guang-zhao-bu-fen/1.yan-se/"/>
      <url>/2022/08/10/opengl/02-guang-zhao-bu-fen/1.yan-se/</url>
      
        <content type="html"><![CDATA[<h2 id="å…‰ç…§åŸºç¡€ä¹‹é¢œè‰²">å…‰ç…§åŸºç¡€ä¹‹é¢œè‰²</h2><blockquote><ol type="1"><li>ä¸»è¦ä½¿ç”¨é¢œè‰²å åŠ æ•ˆæœï¼Œ<code>æœ€ç»ˆè¾“å‡ºé¢œè‰² = ç‰©ä½“é¢œè‰²* å…‰ç…§é¢œè‰²</code></li><li>ä½¿ç”¨å·²æœ‰çš„VBOç»˜åˆ¶å…‰æºç«‹æ–¹ä½“ã€‚</li></ol></blockquote><ol type="1"><li><p>è¢«å…‰ç…§å½±å“çš„ç‰©ä½“ä½¿ç”¨çš„Shader</p><ol type="1"><li><p>é¡¶ç‚¹Shaderæ²¡æœ‰å˜åŒ–ï¼Œåªæœ‰transform<code>cpp          #version 330 core          layout (location = 0) in vec3 aPos; // ä½ç½®å˜é‡çš„å±æ€§ä½ç½®å€¼ä¸º0          uniform mat4 model;          uniform mat4 view;          uniform mat4 projection;          void main()          {              gl_Position = projection * view * model * vec4(aPos, 1.0);           }</code></p></li><li><p>ä¸»è¦å˜åŒ–åœ¨ç‰‡å…ƒShader<code>cpp          #version 330 core          out vec4 FragColor;          uniform vec3 objectColor;          uniform vec3 lightColor;          void main()          {              // ä½¿ç”¨ä¹˜æ³•é¢œè‰²å åŠ ï¼Œ alphaå…ˆå›ºå®šä¸º 1.0              FragColor = vec4(lightColor * objectColor, 1.0);          }</code></p></li><li><p>ä¼ é€’é¢œè‰²å€¼<code>cpp          objectShader.use();          objectShader.setVec3("objectColor", 1.0f, 0.5f, 0.31f);          objectShader.setVec3("lightColor", lightColor);</code></p></li><li><p>è°ƒç”¨æ¸²æŸ“æŒ‡ä»¤ï¼Œåˆ™ä¼šæ¸²æŸ“å‡ºå åŠ é¢œè‰²çš„ç‰©ä½“ã€‚</p></li></ol></li><li><p>æ¸²æŸ“å…‰æºç‰©ä½“,(ä¸æ˜¯å¿…é¡»çš„ï¼Œæ¸²æŸ“å‡ºå…‰æºç‰©ä½“æ–¹ä¾¿è°ƒè¯•å…‰æºå‚æ•°) &gt;ä½œä¸ºæ™®é€šç‰©ä½“çš„æ¸²æŸ“ï¼Œé¢œè‰²ã€å˜æ¢ã€ç­‰ &gt;ä½ç½®æ³¨æ„è¦åœ¨<code>è§†æ¤ä½“</code>å†…</p></li><li><p>å®Œæ•´ä»£ç </p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"glad/glad.h"</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"GLFW/glfw3.h"</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//å›¾ç‰‡åº“</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define STB_IMAGE_IMPLEMENTATION</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"stb_image.h"</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">//glm OpenGL Mathåº“</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"glm/glm.hpp"</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"glm/gtc/matrix_transform.hpp"</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"glm/gtc/type_ptr.hpp"</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"shader.h"</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">int</span> wWidth <span class="op">=</span> <span class="dv">800</span><span class="op">,</span> wHeight <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> wName <span class="op">=</span> <span class="st">"LearnOpenGL"</span><span class="op">;</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    glm<span class="op">::</span>vec3 cameraPos <span class="op">=</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">3.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    glm<span class="op">::</span>vec3 cameraFront <span class="op">=</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    glm<span class="op">::</span>vec3 cameraUp <span class="op">=</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> cameraSpeed <span class="op">=</span> <span class="fl">0.05</span><span class="bu">f</span><span class="op">;</span> <span class="co">// adjust accordingly</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> deltaTime <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span> <span class="co">// å½“å‰å¸§ä¸ä¸Šä¸€å¸§çš„æ—¶é—´å·®</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> lastFrame <span class="op">=</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">;</span> <span class="co">// ä¸Šä¸€å¸§çš„æ—¶é—´</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> lastX <span class="op">=</span> <span class="dv">400</span><span class="op">,</span> lastY <span class="op">=</span> <span class="dv">300</span><span class="op">;</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> yaw <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> pitch <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> firstMouse <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> fov <span class="op">=</span> <span class="fl">45.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ç«‹æ–¹ä½“é¡¶ç‚¹</span></span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> vertices<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>         <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span></span><span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">)</span></span><span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>        glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height<span class="op">);</span></span><span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">)</span></span><span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_ESCAPE<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>            glfwSetWindowShouldClose<span class="op">(</span>window<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span><span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> cameraSpeed <span class="op">=</span> <span class="fl">2.5</span><span class="bu">f</span> <span class="op">*</span> deltaTime<span class="op">;</span></span><span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_W<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>            cameraPos <span class="op">+=</span> cameraSpeed <span class="op">*</span> cameraFront<span class="op">;</span></span><span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_S<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>            cameraPos <span class="op">-=</span> cameraSpeed <span class="op">*</span> cameraFront<span class="op">;</span></span><span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_A<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>            cameraPos <span class="op">-=</span> glm<span class="op">::</span>normalize<span class="op">(</span>glm<span class="op">::</span>cross<span class="op">(</span>cameraFront<span class="op">,</span> cameraUp<span class="op">))</span> <span class="op">*</span> cameraSpeed<span class="op">;</span></span><span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_D<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>            cameraPos <span class="op">+=</span> glm<span class="op">::</span>normalize<span class="op">(</span>glm<span class="op">::</span>cross<span class="op">(</span>cameraFront<span class="op">,</span> cameraUp<span class="op">))</span> <span class="op">*</span> cameraSpeed<span class="op">;</span></span><span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> mouse_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xpos<span class="op">,</span> <span class="dt">double</span> ypos<span class="op">)</span></span><span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>firstMouse<span class="op">)</span></span><span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>            lastX <span class="op">=</span> xpos<span class="op">;</span></span><span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>            lastY <span class="op">=</span> ypos<span class="op">;</span></span><span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>            firstMouse <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> xoffset <span class="op">=</span> xpos <span class="op">-</span> lastX<span class="op">;</span></span><span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> yoffset <span class="op">=</span> lastY <span class="op">-</span> ypos<span class="op">;</span></span><span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>        lastX <span class="op">=</span> xpos<span class="op">;</span></span><span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>        lastY <span class="op">=</span> ypos<span class="op">;</span></span><span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>        <span class="dt">float</span> sensitivity <span class="op">=</span> <span class="fl">0.05</span><span class="op">;</span></span><span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>        xoffset <span class="op">*=</span> sensitivity<span class="op">;</span></span><span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>        yoffset <span class="op">*=</span> sensitivity<span class="op">;</span></span><span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>        yaw <span class="op">+=</span> xoffset<span class="op">;</span></span><span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>        pitch <span class="op">+=</span> yoffset<span class="op">;</span></span><span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>pitch <span class="op">&gt;</span> <span class="fl">89.0</span><span class="bu">f</span><span class="op">)</span></span><span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>            pitch <span class="op">=</span> <span class="fl">89.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>pitch <span class="op">&lt;</span> <span class="op">-</span><span class="fl">89.0</span><span class="bu">f</span><span class="op">)</span></span><span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>            pitch <span class="op">=</span> <span class="op">-</span><span class="fl">89.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3 front<span class="op">;</span></span><span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>        front<span class="op">.</span>x <span class="op">=</span> cos<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span>yaw<span class="op">))</span> <span class="op">*</span> cos<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span>pitch<span class="op">));</span></span><span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>        front<span class="op">.</span>y <span class="op">=</span> sin<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span>pitch<span class="op">));</span></span><span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>        front<span class="op">.</span>z <span class="op">=</span> sin<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span>yaw<span class="op">))</span> <span class="op">*</span> cos<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span>pitch<span class="op">));</span></span><span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>        cameraFront <span class="op">=</span> glm<span class="op">::</span>normalize<span class="op">(</span>front<span class="op">);</span></span><span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> scroll_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">double</span> xoffset<span class="op">,</span> <span class="dt">double</span> yoffset<span class="op">)</span></span><span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>fov <span class="op">&gt;=</span> <span class="fl">1.0</span><span class="bu">f</span> <span class="op">&amp;&amp;</span> fov <span class="op">&lt;=</span> <span class="fl">45.0</span><span class="bu">f</span><span class="op">)</span></span><span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>            fov <span class="op">-=</span> yoffset<span class="op">;</span></span><span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>fov <span class="op">&lt;=</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">)</span></span><span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>            fov <span class="op">=</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>fov <span class="op">&gt;=</span> <span class="fl">45.0</span><span class="bu">f</span><span class="op">)</span></span><span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>            fov <span class="op">=</span> <span class="fl">45.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> main<span class="op">()</span></span><span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>        <span class="co">//1. åˆå§‹åŒ–</span></span><span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwInit<span class="op">()</span> <span class="op">==</span> GLFW_FALSE<span class="op">)</span></span><span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>            cout <span class="op">&lt;&lt;</span> <span class="st">"init glfw fail"</span><span class="op">;</span></span><span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>        <span class="co">//2. åŸºæœ¬è®¾ç½®</span></span><span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_OPENGL_PROFILE<span class="op">,</span> GLFW_OPENGL_CORE_PROFILE<span class="op">);</span></span><span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if __APPLE__</span></span><span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_OPENGL_FORWARD_COMPAT<span class="op">,</span> GLFW_TRUE<span class="op">);</span></span><span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span><span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>        <span class="co">//3. åˆ›å»ºçª—å£</span></span><span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>        GLFWwindow <span class="op">*</span>window <span class="op">=</span> glfwCreateWindow<span class="op">(</span>wWidth<span class="op">,</span> wHeight<span class="op">,</span> wName<span class="op">,</span> <span class="kw">nullptr</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span><span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>window <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span></span><span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>            cout <span class="op">&lt;&lt;</span> <span class="st">"Failed to create GLFW window"</span><span class="op">;</span></span><span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>            <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>            <span class="co">//return 1;</span></span><span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>        <span class="co">//4. å½“å‰ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡çª—å£</span></span><span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>        glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span><span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>        <span class="co">//5. ä½¿ç”¨gladç®¡ç†OpenGLæŒ‡é’ˆã€‚</span></span><span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>gladLoadGLLoader<span class="op">((</span>GLADloadproc<span class="op">)</span>glfwGetProcAddress<span class="op">))</span></span><span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to initialize GLAD"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>            <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>            <span class="co">//return 1;</span></span><span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>        <span class="co">//6. è®¾ç½®è§†å£</span></span><span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>        glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> wWidth<span class="op">,</span> wHeight<span class="op">);</span></span><span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>        <span class="co">//7. è®¾ç½®resizeå›è°ƒï¼Œå¯¹åº”åˆ·æ–°è§†å£</span></span><span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>        glfwSetFramebufferSizeCallback<span class="op">(</span>window<span class="op">,</span> framebuffer_size_callback<span class="op">);</span></span><span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>        glfwSetInputMode<span class="op">(</span>window<span class="op">,</span> GLFW_CURSOR<span class="op">,</span> GLFW_CURSOR_DISABLED<span class="op">);</span></span><span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>        glfwSetCursorPosCallback<span class="op">(</span>window<span class="op">,</span> mouse_callback<span class="op">);</span></span><span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>        glfwSetScrollCallback<span class="op">(</span>window<span class="op">,</span> scroll_callback<span class="op">);</span></span><span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>        Shader objectShader<span class="op">(</span><span class="st">"res/shaders/sample_vertex_light_color.shader"</span><span class="op">,</span> <span class="st">"res/shaders/sample_fragment_light_color.shader"</span><span class="op">);</span></span><span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>        Shader lightCubeShader<span class="op">(</span><span class="st">"res/shaders/sample_vertex_light_color.shader"</span><span class="op">,</span> <span class="st">"res/shaders/sample_fragment_light.shader"</span><span class="op">);</span></span><span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> VBO<span class="op">,</span> VAO<span class="op">,</span> lightVAO<span class="op">;</span></span><span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>        glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>        glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>        glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>vertices<span class="op">),</span> vertices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>        <span class="co">//1. æŒ‡å®šé¡¶ç‚¹çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œé¡¶ç‚¹ 3ä¸ªfloatï¼Œä»0å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>        glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>lightVAO<span class="op">);</span></span><span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>lightVAO<span class="op">);</span></span><span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span>GL_FLOAT<span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">0</span><span class="op">));</span></span><span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>        <span class="co">/*glm::vec3 cubePositions[] = {</span></span><span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a><span class="co">          glm::vec3(0.0f,  0.0f,  0.0f),</span></span><span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a><span class="co">          glm::vec3(2.0f,  5.0f, -15.0f),</span></span><span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a><span class="co">          glm::vec3(-1.5f, -2.2f, -2.5f),</span></span><span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a><span class="co">          glm::vec3(-3.8f, -2.0f, -12.3f),</span></span><span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a><span class="co">          glm::vec3(2.4f, -0.4f, -3.5f),</span></span><span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a><span class="co">          glm::vec3(-1.7f,  3.0f, -7.5f),</span></span><span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a><span class="co">          glm::vec3(1.3f, -2.0f, -2.5f),</span></span><span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a><span class="co">          glm::vec3(1.5f,  2.0f, -2.5f),</span></span><span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a><span class="co">          glm::vec3(1.5f,  0.2f, -1.5f),</span></span><span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a><span class="co">          glm::vec3(-1.3f,  1.0f, -1.5f)</span></span><span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a><span class="co">        };*/</span></span><span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3 lightPos<span class="op">(</span><span class="fl">1.2</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">2.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> rgbmax <span class="op">=</span> <span class="bn">0xffffff</span><span class="op">;</span></span><span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> rgbmin <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> rgb <span class="op">=</span> rgbmax<span class="op">;</span></span><span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>        <span class="dt">bool</span> sub <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>        glm<span class="op">::</span>vec3 lightColor<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!</span>glfwWindowShouldClose<span class="op">(</span>window<span class="op">))</span></span><span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>            processInput<span class="op">(</span>window<span class="op">);</span></span><span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>            glClearColor<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>            glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT <span class="op">|</span> GL_DEPTH_BUFFER_BIT<span class="op">);</span></span><span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>            glm<span class="op">::</span>mat4 view <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>            glm<span class="op">::</span>mat4 projection <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>            view <span class="op">=</span> glm<span class="op">::</span>lookAt<span class="op">(</span>cameraPos<span class="op">,</span> cameraPos <span class="op">+</span> cameraFront<span class="op">,</span> cameraUp<span class="op">);</span></span><span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>            projection <span class="op">=</span> glm<span class="op">::</span>perspective<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span>fov<span class="op">),</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>wWidth <span class="op">/</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>wHeight<span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">100.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>            glm<span class="op">::</span>mat4 model<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>            objectShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>            objectShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"objectColor"</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.31</span><span class="bu">f</span><span class="op">);</span></span><span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>rgb <span class="op">&gt;=</span> rgbmax<span class="op">)</span></span><span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>                sub <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>rgb <span class="op">&lt;</span> rgbmin<span class="op">)</span></span><span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>                sub <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span><span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>sub<span class="op">)</span></span><span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>                rgb <span class="op">-=</span> <span class="dv">4</span><span class="op">;</span></span><span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span></span><span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>                rgb <span class="op">+=</span> <span class="dv">4</span><span class="op">;</span></span><span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> ir <span class="op">=</span> <span class="op">(</span>rgb <span class="op">&amp;</span> <span class="bn">0xff0000</span><span class="op">)</span> <span class="op">&gt;&gt;</span> <span class="dv">16</span><span class="op">;</span></span><span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> ig <span class="op">=</span> <span class="op">(</span>rgb <span class="op">&amp;</span> <span class="bn">0x00ff00</span><span class="op">)</span> <span class="op">&gt;&gt;</span> <span class="dv">8</span><span class="op">;</span></span><span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>            <span class="dt">int</span> ib <span class="op">=</span> <span class="op">(</span>rgb <span class="op">&amp;</span> <span class="bn">0x0000ff</span><span class="op">);</span></span><span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>            <span class="co">//std::cout &lt;&lt; rgb&lt;&lt;"\t"&lt;&lt;ir&lt;&lt; "\t" &lt;&lt; ig &lt;&lt; "\t" &lt;&lt; ib &lt;&lt;std::endl;</span></span><span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>            lightColor<span class="op">.</span>r <span class="op">=</span> ir <span class="op">/</span> <span class="fl">255.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>            lightColor<span class="op">.</span>b <span class="op">=</span> ib <span class="op">/</span> <span class="fl">255.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>            lightColor<span class="op">.</span>g <span class="op">=</span> ig <span class="op">/</span> <span class="fl">255.0</span><span class="bu">f</span><span class="op">;</span></span><span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>            objectShader<span class="op">.</span>setVec3<span class="op">(</span><span class="st">"lightColor"</span><span class="op">,</span> lightColor<span class="op">);</span></span><span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>            objectShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"projection"</span><span class="op">,</span> projection<span class="op">);</span></span><span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>            objectShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"view"</span><span class="op">,</span> view<span class="op">);</span></span><span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">));</span></span><span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> glm<span class="op">::</span>rotate<span class="op">(</span>model<span class="op">,</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>glfwGetTime<span class="op">()</span> <span class="op">*</span> glm<span class="op">::</span>radians<span class="op">(</span><span class="fl">50.0</span><span class="bu">f</span><span class="op">),</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">));</span></span><span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>            objectShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"model"</span><span class="op">,</span> model<span class="op">);</span></span><span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>            glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>            glDrawArrays<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">36</span><span class="op">);</span></span><span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>model<span class="op">,</span> lightPos<span class="op">);</span></span><span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>            model <span class="op">=</span> glm<span class="op">::</span>scale<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">));</span></span><span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>            lightCubeShader<span class="op">.</span>use<span class="op">();</span></span><span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>            lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"projection"</span><span class="op">,</span> projection<span class="op">);</span></span><span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>            lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"view"</span><span class="op">,</span> view<span class="op">);</span></span><span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>            lightCubeShader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"model"</span><span class="op">,</span> model<span class="op">);</span></span><span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>            glBindVertexArray<span class="op">(</span>lightVAO<span class="op">);</span></span><span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>            glDrawArrays<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">36</span><span class="op">);</span></span><span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>            glfwSwapBuffers<span class="op">(</span>window<span class="op">);</span></span><span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>            glfwPollEvents<span class="op">();</span></span><span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>        glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>        glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>        <span class="co">//glDeleteBuffers(1, &amp;EBO);</span></span><span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>    TERMINATE<span class="op">:</span></span><span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>        glfwTerminate<span class="op">();</span></span><span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/01-ji-chu-bu-fen/8.she-xiang-ji/"/>
      <url>/2022/08/10/opengl/01-ji-chu-bu-fen/8.she-xiang-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="æ‘„åƒæœº">æ‘„åƒæœº</h2><blockquote><p>æ‘„åƒæœºçš„å¼•å…¥æ§åˆ¶viewçŸ©é˜µã€‚åŒæ—¶å¯æ§åˆ¶é€è§†çš„fovè§†è§’ã€‚æ¥æ¨¡æ‹Ÿäººçš„è§‚å¯Ÿçœ¼ç›ã€‚å› æ­¤å¯ä½¿ç”¨æ‘„åƒæœºä½ç½®æ§åˆ¶viewï¼Œ fovæ§åˆ¶è§†è§’ã€‚ä½¿ç”¨æ¬§æ‹‰è§’æ§åˆ¶é¼ æ ‡æ–¹å‘ä½ç½®ï¼Œå› æ­¤è¦è®¡ç®— yawï¼Œ pitch 1.æ‘„åƒæœºæ–¹å‘ï¼Œviewæ–¹å‘</p></blockquote><pre><code>&gt; glm::lookAt( eye, center, up)```cpp    view = glm::lookAt(cameraPos, cameraPos + cameraFront, cameraUp);```</code></pre><ol start="2" type="1"><li><p>é€è§†çŸ©é˜µæ„é€  &gt; projection =glm::perspective(glm::radians(fov)/<em>fovy</em>/, aspect, near, far);&gt; fov å¼§åº¦ å®½é«˜ä½¿ç”¨æ˜¾ç¤ºåŒºåŸŸçš„å®½é«˜ï¼Œè¿‘è£å‰ªé¢å’Œè¿œè£å‰ªé¢</p></li><li><p>é¼ æ ‡ä½ç½®ï¼Œé¼ æ ‡æ»šè½®æ§åˆ¶ç¼©æ”¾å’Œä½ç½®ã€‚</p><ol type="1"><li>glfw æŒ‰é”®æ£€æµ‹<ol type="1"><li>æ¯å¸§ <code>glfwGetKey</code>è·å–æŒ‰é”®çŠ¶æ€å¤„ç†<code>cpp      void processInput(GLFWwindow *window)      {          if (glfwGetKey(window, GLFW_KEY_ESCAPE) == GLFW_PRESS)              glfwSetWindowShouldClose(window, true);          float cameraSpeed = 2.5f * deltaTime;          if (glfwGetKey(window, GLFW_KEY_W) == GLFW_PRESS)              cameraPos += cameraSpeed * cameraFront;          if (glfwGetKey(window, GLFW_KEY_S) == GLFW_PRESS)              cameraPos -= cameraSpeed * cameraFront;          if (glfwGetKey(window, GLFW_KEY_A) == GLFW_PRESS)              cameraPos -= glm::normalize(glm::cross(cameraFront, cameraUp)) * cameraSpeed;          if (glfwGetKey(window, GLFW_KEY_D) == GLFW_PRESS)              cameraPos += glm::normalize(glm::cross(cameraFront, cameraUp)) * cameraSpeed;      }</code></li></ol></li><li>é¼ æ ‡ä½ç½®æ£€æµ‹<code>glfwSetCursorPosCallback(window, mouse_callback);</code><code>cpp          void mouse_callback(GLFWwindow* window, double xpos, double ypos)          {              if (firstMouse)              {                  lastX = xpos;                  lastY = ypos;                  firstMouse = false;              }              float xoffset = xpos - lastX;              float yoffset = lastY - ypos;              lastX = xpos;              lastY = ypos;              float sensitivity = 0.05;              xoffset *= sensitivity;              yoffset *= sensitivity;              yaw += xoffset;              pitch += yoffset;              if (pitch &gt; 89.0f)                  pitch = 89.0f;              if (pitch &lt; -89.0f)                  pitch = -89.0f;              glm::vec3 front;              front.x = cos(glm::radians(yaw)) * cos(glm::radians(pitch));              front.y = sin(glm::radians(pitch));              front.z = sin(glm::radians(yaw)) * cos(glm::radians(pitch));              cameraFront = glm::normalize(front);          }</code></li><li>é¼ æ ‡æ»šè½®æ£€æµ‹<code>glfwSetScrollCallback(window, scroll_callback);</code><code>cpp          void scroll_callback(GLFWwindow* window, double xoffset, double yoffset)          {              if (fov &gt;= 1.0f &amp;&amp; fov &lt;= 45.0f)                  fov -= yoffset;              if (fov &lt;= 1.0f)                  fov = 1.0f;              if (fov &gt;= 45.0f)                  fov = 45.0f;          }</code></li><li>é¼ æ ‡ç„¦ç‚¹ä¸æ˜¾ç¤ºå…‰æ ‡<code>cpp          glfwSetInputMode(window, GLFW_CURSOR, GLFW_CURSOR_DISABLED);</code></li></ol></li><li><p>åº”ç”¨äºè§‚å¯ŸviewçŸ©é˜µå’Œé€è§†projectionçŸ©é˜µ,å°±å¯ä»¥é€šè¿‡é¼ æ ‡ä½ç½®å’Œæ»‘è½®æ§åˆ¶ çŸ©é˜µï¼Œä½¿å¾—å›¾åƒç§»åŠ¨ã€‚<code>cpp         view = glm::lookAt(cameraPos, cameraPos + cameraFront, cameraUp);         projection = glm::perspective(glm::radians(fov), (float)wWidth / (float)wHeight, 0.1f, 100.0f);</code></p></li><li><p>å®Œæ•´ä»£ç <code>cpp         #include "glad/glad.h"         #include "GLFW/glfw3.h"         //å›¾ç‰‡åº“         #define STB_IMAGE_IMPLEMENTATION         #include "stb_image.h"         //glm OpenGL Mathåº“         #include "glm/glm.hpp"         #include "glm/gtc/matrix_transform.hpp"         #include "glm/gtc/type_ptr.hpp"         #include "shader.h"         #include &lt;iostream&gt;         using namespace std;         const int wWidth = 800, wHeight = 600;         const char* wName = "LearnOpenGL";         glm::vec3 cameraPos = glm::vec3(0.0f, 0.0f, 3.0f);         glm::vec3 cameraFront = glm::vec3(0.0f, 0.0f, -1.0f);         glm::vec3 cameraUp = glm::vec3(0.0f, 1.0f, 0.0f);         float cameraSpeed = 0.05f; // adjust accordingly         float deltaTime = 0.0f; // å½“å‰å¸§ä¸ä¸Šä¸€å¸§çš„æ—¶é—´å·®         float lastFrame = 0.0f; // ä¸Šä¸€å¸§çš„æ—¶é—´         float lastX = 400, lastY = 300;         float yaw = 0, pitch = 0;         bool firstMouse = true;         float fov = 45.0f;         //ç«‹æ–¹ä½“é¡¶ç‚¹         float vertices[] = {             //ä¸€é¢             -0.5f, -0.5f, -0.5f,  0.0f, 0.0f,              0.5f, -0.5f, -0.5f,  1.0f, 0.0f,              0.5f,  0.5f, -0.5f,  1.0f, 1.0f,              0.5f,  0.5f, -0.5f,  1.0f, 1.0f,             -0.5f,  0.5f, -0.5f,  0.0f, 1.0f,             -0.5f, -0.5f, -0.5f,  0.0f, 0.0f,             //ä¸€é¢             -0.5f, -0.5f,  0.5f,  0.0f, 0.0f,              0.5f, -0.5f,  0.5f,  1.0f, 0.0f,              0.5f,  0.5f,  0.5f,  1.0f, 1.0f,              0.5f,  0.5f,  0.5f,  1.0f, 1.0f,             -0.5f,  0.5f,  0.5f,  0.0f, 1.0f,             -0.5f, -0.5f,  0.5f,  0.0f, 0.0f,             //ä¸€é¢             -0.5f,  0.5f,  0.5f,  1.0f, 0.0f,             -0.5f,  0.5f, -0.5f,  1.0f, 1.0f,             -0.5f, -0.5f, -0.5f,  0.0f, 1.0f,             -0.5f, -0.5f, -0.5f,  0.0f, 1.0f,             -0.5f, -0.5f,  0.5f,  0.0f, 0.0f,             -0.5f,  0.5f,  0.5f,  1.0f, 0.0f,             //ä¸€é¢              0.5f,  0.5f,  0.5f,  1.0f, 0.0f,              0.5f,  0.5f, -0.5f,  1.0f, 1.0f,              0.5f, -0.5f, -0.5f,  0.0f, 1.0f,              0.5f, -0.5f, -0.5f,  0.0f, 1.0f,              0.5f, -0.5f,  0.5f,  0.0f, 0.0f,              0.5f,  0.5f,  0.5f,  1.0f, 0.0f,             //ä¸€é¢             -0.5f, -0.5f, -0.5f,  0.0f, 1.0f,              0.5f, -0.5f, -0.5f,  1.0f, 1.0f,              0.5f, -0.5f,  0.5f,  1.0f, 0.0f,              0.5f, -0.5f,  0.5f,  1.0f, 0.0f,             -0.5f, -0.5f,  0.5f,  0.0f, 0.0f,             -0.5f, -0.5f, -0.5f,  0.0f, 1.0f,             //ä¸€é¢             -0.5f,  0.5f, -0.5f,  0.0f, 1.0f,              0.5f,  0.5f, -0.5f,  1.0f, 1.0f,              0.5f,  0.5f,  0.5f,  1.0f, 0.0f,              0.5f,  0.5f,  0.5f,  1.0f, 0.0f,             -0.5f,  0.5f,  0.5f,  0.0f, 0.0f,             -0.5f,  0.5f, -0.5f,  0.0f, 1.0f         };         void framebuffer_size_callback(GLFWwindow* window, int width, int height)         {             glViewport(0, 0, width, height);         }         void processInput(GLFWwindow *window)         {             if (glfwGetKey(window, GLFW_KEY_ESCAPE) == GLFW_PRESS)                 glfwSetWindowShouldClose(window, true);             float cameraSpeed = 2.5f * deltaTime;             if (glfwGetKey(window, GLFW_KEY_W) == GLFW_PRESS)                 cameraPos += cameraSpeed * cameraFront;             if (glfwGetKey(window, GLFW_KEY_S) == GLFW_PRESS)                 cameraPos -= cameraSpeed * cameraFront;             if (glfwGetKey(window, GLFW_KEY_A) == GLFW_PRESS)                 cameraPos -= glm::normalize(glm::cross(cameraFront, cameraUp)) * cameraSpeed;             if (glfwGetKey(window, GLFW_KEY_D) == GLFW_PRESS)                 cameraPos += glm::normalize(glm::cross(cameraFront, cameraUp)) * cameraSpeed;         }         void mouse_callback(GLFWwindow* window, double xpos, double ypos)         {             if (firstMouse)             {                 lastX = xpos;                 lastY = ypos;                 firstMouse = false;             }             float xoffset = xpos - lastX;             float yoffset = lastY - ypos;             lastX = xpos;             lastY = ypos;             float sensitivity = 0.05;             xoffset *= sensitivity;             yoffset *= sensitivity;             yaw += xoffset;             pitch += yoffset;             if (pitch &gt; 89.0f)                 pitch = 89.0f;             if (pitch &lt; -89.0f)                 pitch = -89.0f;             glm::vec3 front;             front.x = cos(glm::radians(yaw)) * cos(glm::radians(pitch));             front.y = sin(glm::radians(pitch));             front.z = sin(glm::radians(yaw)) * cos(glm::radians(pitch));             cameraFront = glm::normalize(front);         }         void scroll_callback(GLFWwindow* window, double xoffset, double yoffset)         {             if (fov &gt;= 1.0f &amp;&amp; fov &lt;= 45.0f)                 fov -= yoffset;             if (fov &lt;= 1.0f)                 fov = 1.0f;             if (fov &gt;= 45.0f)                 fov = 45.0f;         }         int main()         {             //1. åˆå§‹åŒ–             if (glfwInit() == GLFW_FALSE)             {                 cout &lt;&lt; "init glfw fail";                 return 1;             }             //2. åŸºæœ¬è®¾ç½®             glfwWindowHint(GLFW_CONTEXT_VERSION_MAJOR, 3);             glfwWindowHint(GLFW_CONTEXT_VERSION_MINOR, 3);             glfwWindowHint(GLFW_OPENGL_PROFILE, GLFW_OPENGL_CORE_PROFILE);         #if __APPLE__             glfwWindowHint(GLFW_OPENGL_FORWARD_COMPAT, GLFW_TRUE);         #endif             //3. åˆ›å»ºçª—å£             GLFWwindow *window = glfwCreateWindow(wWidth, wHeight, wName, nullptr, nullptr);             if (window == nullptr)             {                 cout &lt;&lt; "Failed to create GLFW window";                 goto TERMINATE;                 //return 1;             }             //4. å½“å‰ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡çª—å£             glfwMakeContextCurrent(window);             //5. ä½¿ç”¨gladç®¡ç†OpenGLæŒ‡é’ˆã€‚             if (!gladLoadGLLoader((GLADloadproc)glfwGetProcAddress))             {                 std::cout &lt;&lt; "Failed to initialize GLAD" &lt;&lt; std::endl;                 goto TERMINATE;                 //return 1;             }             //6. è®¾ç½®è§†å£             glViewport(0, 0, wWidth, wHeight);             //7. è®¾ç½®resizeå›è°ƒï¼Œå¯¹åº”åˆ·æ–°è§†å£             glfwSetFramebufferSizeCallback(window, framebuffer_size_callback);             glfwSetInputMode(window, GLFW_CURSOR, GLFW_CURSOR_DISABLED);             glfwSetCursorPosCallback(window, mouse_callback);             glfwSetScrollCallback(window, scroll_callback);             Shader shader("res/shaders/sample_vertex_mvp.shader", "res/shaders/sample_fragment_mvp.shader");             unsigned int VBO, VAO/*, EBO*/;             glGenVertexArrays(1, &amp;VAO);             glBindVertexArray(VAO);             glGenBuffers(1, &amp;VBO);             glBindBuffer(GL_ARRAY_BUFFER, VBO);             glBufferData(GL_ARRAY_BUFFER, sizeof(vertices), vertices, GL_STATIC_DRAW);             /*glGenBuffers(1, &amp;EBO);             glBindBuffer(GL_ELEMENT_ARRAY_BUFFER, EBO);             glBufferData(GL_ELEMENT_ARRAY_BUFFER, sizeof(indices), indices, GL_STATIC_DRAW);*/             //1. æŒ‡å®šé¡¶ç‚¹çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œé¡¶ç‚¹ 3ä¸ªfloatï¼Œä»0å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚             glVertexAttribPointer(0, 3, GL_FLOAT, GL_FALSE, 5 * sizeof(float), (void*)0);             glEnableVertexAttribArray(0);             //2. æŒ‡å®šuvçš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œuv 2ä¸ªfloatï¼Œä»6å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚             glVertexAttribPointer(2, 2, GL_FLOAT, GL_FALSE, 5 * sizeof(float), (void*)(3 * sizeof(float)));             glEnableVertexAttribArray(2);             glBindBuffer(GL_ARRAY_BUFFER, 0);             glBindVertexArray(0);             unsigned int texture1, texture2;             //åŠ è½½è´´å›¾1             glGenTextures(1, &amp;texture1);             glBindTexture(GL_TEXTURE_2D, texture1);             // è®¾ç½® wrapping å‚æ•°             glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);             glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);             // è®¾ç½®  filtering å‚æ•°             glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);             glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);             // åŠ è½½è§£æè´´å›¾æ–‡ä»¶             int width, height, nrChannels;             stbi_set_flip_vertically_on_load(true); // tell stb_image.h to flip loaded texture's on the y-axis.             unsigned char* data = stbi_load("./res/textures/container.jpg", &amp;width, &amp;height, &amp;nrChannels, 0);             if (data)             {                 //ç¬¬ä¸€ä¸ª GL_RGB å°†è¢«è½¬æ¢çš„æ ¼å¼ï¼Œ ç¬¬äºŒä¸ªGL_RGBåŸå§‹æ–‡ä»¶çš„æ ¼å¼ï¼Œ æ ¼å¼ä¸åŒ¹é…ä¼šæŠ¥é”™ã€‚                 glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, width, height, 0, GL_RGB, GL_UNSIGNED_BYTE, data);                 glGenerateMipmap(GL_TEXTURE_2D);             }             else             {                 std::cout &lt;&lt; "Failed to load texture" &lt;&lt; std::endl;             }             stbi_image_free(data);             //åŠ è½½è´´å›¾2             glGenTextures(1, &amp;texture2);             glBindTexture(GL_TEXTURE_2D, texture2);             //  è®¾ç½® wrapping å‚æ•°             glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_REPEAT);             glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_REPEAT);             // è®¾ç½®  filtering å‚æ•°             glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR);             glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);             // låŠ è½½è§£æè´´å›¾æ–‡ä»¶             data = stbi_load("./res/textures/awesomeface.png", &amp;width, &amp;height, &amp;nrChannels, 0);             if (data)             {                 //ç¬¬ä¸€ä¸ª GL_RGB å°†è¢«è½¬æ¢çš„æ ¼å¼ï¼Œ ç¬¬äºŒä¸ªGL_RGBåŸå§‹æ–‡ä»¶çš„æ ¼å¼ï¼Œ æ ¼å¼ä¸åŒ¹é…ä¼šæŠ¥é”™ã€‚                 glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB, width, height, 0, GL_RGBA, GL_UNSIGNED_BYTE, data);                 glGenerateMipmap(GL_TEXTURE_2D);             }             else             {                 std::cout &lt;&lt; "Failed to load texture" &lt;&lt; std::endl;             }             stbi_image_free(data);             //æŒ‡å®šé‡‡æ ·å™¨è´´å›¾å‚¨å­˜çš„ä½ç½®             shader.use();             shader.setInt("texture1", 0);             shader.setInt("texture2", 1);             glm::vec3 cubePositions[] = {               glm::vec3(0.0f,  0.0f,  0.0f),               glm::vec3(2.0f,  5.0f, -15.0f),               glm::vec3(-1.5f, -2.2f, -2.5f),               glm::vec3(-3.8f, -2.0f, -12.3f),               glm::vec3(2.4f, -0.4f, -3.5f),               glm::vec3(-1.7f,  3.0f, -7.5f),               glm::vec3(1.3f, -2.0f, -2.5f),               glm::vec3(1.5f,  2.0f, -2.5f),               glm::vec3(1.5f,  0.2f, -1.5f),               glm::vec3(-1.3f,  1.0f, -1.5f)                 };             lastFrame = glfwGetTime();             while (!glfwWindowShouldClose(window))             {                 float currentFrame = glfwGetTime();                 deltaTime = currentFrame - lastFrame;                 lastFrame = currentFrame;                 processInput(window);                 glClearColor(0.2f, 0.3f, 0.3f, 1.0f);                 glClear(GL_COLOR_BUFFER_BIT| GL_DEPTH_BUFFER_BIT);                 // bind Texture1                 glActiveTexture(GL_TEXTURE0);                 glBindTexture(GL_TEXTURE_2D, texture1);                 // bind Texture2                 glActiveTexture(GL_TEXTURE1);                 glBindTexture(GL_TEXTURE_2D, texture2);                 shader.use();                 glm::mat4 view = glm::mat4(1.0f);                 glm::mat4 projection = glm::mat4(1.0f);                 //view = glm::translate(view, glm::vec3(0.0f, 0.0f, -3.0f));                 view = glm::lookAt(cameraPos, cameraPos + cameraFront, cameraUp);                 projection = glm::perspective(glm::radians(fov), (float)wWidth / (float)wHeight, 0.1f, 100.0f);                 shader.setMat4("projection", projection);                 shader.setMat4("view", view);                 glBindVertexArray(VAO);                 glEnable(GL_DEPTH_TEST);                 for (size_t i = 0; i &lt; 10; i++)                 {                     glm::mat4 model(1.0f);                     model = glm::translate(model, cubePositions[i]);                     model = glm::rotate(model, (float)glfwGetTime() * glm::radians(50.0f), glm::vec3(0.5f, 1.0f, 0.0f));                     float angle = 20.0f * i;                     model = glm::rotate(model, glm::radians(angle), glm::vec3(1.0f, 0.3f, 0.5f));                     shader.setMat4("model", model);                     glDrawArrays(GL_TRIANGLES, 0, 36);                 }                 glfwSwapBuffers(window);                 glfwPollEvents();             }             glDeleteVertexArrays(1, &amp;VAO);             glDeleteBuffers(1, &amp;VBO);             //glDeleteBuffers(1, &amp;EBO);         TERMINATE:             glfwTerminate();             return 0;         }</code></p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/01-ji-chu-bu-fen/7.li-fang-ti/"/>
      <url>/2022/08/10/opengl/01-ji-chu-bu-fen/7.li-fang-ti/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¸²æŸ“ç«‹æ–¹ä½“">æ¸²æŸ“ç«‹æ–¹ä½“</h2><blockquote><p>æ•°å­¦çŸ¥è¯†å‚è€ƒ<a href="../3dæ•°å­¦/README.md">3dæ•°å­¦éƒ¨åˆ†</a>æ¸²æŸ“ç«‹æ–¹ä½“éœ€è¦6ä¸ªé¢ï¼Œ12ä¸ªä¸‰è§’å½¢ï¼ŒåŒæ ·æ¯ä¸ªé¡¶ç‚¹éœ€è¦å¯¹åº”ä¸€ä¸ªuvã€‚</p></blockquote><ol type="1"><li><p>åŸºç¡€ä»£ç åŒä¸Šä¸€èŠ‚,ç»˜åˆ¶ç«‹æ–¹ä½“ä»£ç ,è¿™é‡Œè°ƒç”¨ç»˜åˆ¶36ä¸ªé¡¶ç‚¹çš„ä»£ç ï¼ˆ6ä¸ªé¢= 12ä¸ªä¸‰è§’å½¢ = 36ä¸ªé¡¶ç‚¹ï¼Œè™½ç„¶é‡ç”¨é¡¶ç‚¹ï¼Œä½†æ˜¯å¯¹äºæ¯æ¬¡ç»˜åˆ¶çš„ä¸‰è§’å½¢è€Œè¨€è¿˜æ˜¯3ä¸ªé¡¶ç‚¹ä¸€ä¸ªä¸‰è§’å½¢ï¼‰<code>cpp         glDrawArrays(GL_TRIANGLES, 0, 36);</code></p></li><li><p>åŒä¸€ä»½é¡¶ç‚¹ã€uvæ•°æ®ã€è´´å›¾æ•°æ®ç»˜åˆ¶å¤šæ¬¡ï¼Œç”¨äºç»˜åˆ¶å¤šä¸ªä¸åŒç‰©ä½“ã€‚ &gt;åªéœ€è¦é‡å¤è°ƒç”¨ç»˜åˆ¶å‡½æ•°ï¼Œæ¯”å¦‚<code>glDrawArrays(GL_TRIANGLES, 0, 36);</code>.å› ä¸ºæ•°æ®å®Œå…¨æ²¡æœ‰å˜åŒ–ï¼Œæ‰€ä»¥ç»˜åˆ¶æ˜¯é‡å¤çš„ã€‚ &gt;æ­¤æ—¶å¯ä»¥ä¼ é€’ä¸åŒçš„ä½ç½®ã€æ—‹è½¬ç­‰å€¼ç„¶ååœ¨ç»˜åˆ¶ã€‚</p></li><li><p>Zç¼“å†²&amp; æ·±åº¦ç¼“å†² &gt;OpenGLå­˜å‚¨å®ƒçš„æ‰€æœ‰æ·±åº¦ä¿¡æ¯äºä¸€ä¸ªZç¼“å†²(Z-buffer)ä¸­ï¼Œä¹Ÿè¢«ç§°ä¸ºæ·±åº¦ç¼“å†²(DepthBuffer)ã€‚GLFWä¼šè‡ªåŠ¨ä¸ºä½ ç”Ÿæˆè¿™æ ·ä¸€ä¸ªç¼“å†²ï¼ˆå°±åƒå®ƒä¹Ÿæœ‰ä¸€ä¸ªé¢œè‰²ç¼“å†²æ¥å­˜å‚¨è¾“å‡ºå›¾åƒçš„é¢œè‰²ï¼‰ã€‚&gt;æ·±åº¦å€¼å­˜å‚¨åœ¨æ¯ä¸ªç‰‡æ®µé‡Œé¢ï¼ˆä½œä¸ºç‰‡æ®µçš„zå€¼ï¼‰ï¼Œå½“ç‰‡æ®µæƒ³è¦è¾“å‡ºå®ƒçš„é¢œè‰²æ—¶ï¼ŒOpenGLä¼šå°†å®ƒçš„æ·±åº¦å€¼å’Œzç¼“å†²è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœå½“å‰çš„ç‰‡æ®µåœ¨å…¶å®ƒç‰‡æ®µä¹‹åï¼Œå®ƒå°†ä¼šè¢«ä¸¢å¼ƒï¼Œå¦åˆ™å°†ä¼šè¦†ç›–ã€‚&gt; è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºæ·±åº¦æµ‹è¯•(Depth Testing)ï¼Œå®ƒæ˜¯ç”±OpenGLè‡ªåŠ¨å®Œæˆçš„ã€‚</p><ol type="1"><li>å¼€å¯æ·±åº¦æµ‹è¯•</li></ol><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>  glEnable<span class="op">(</span>GL_DEPTH_TEST<span class="op">);</span></span></code></pre></div><ol start="2" type="1"><li>å› ä¸ºå¼€å¯äº†æ·±åº¦æµ‹è¯•ï¼Œæ¯æ¬¡æ¸²æŸ“ä¹‹å‰æ·±åº¦ç¼“å†²åŒºï¼Œéƒ½ä¿ç•™äº†ä¹‹å‰çš„æ·±åº¦ç¼“å†²ï¼Œæ‰€ä»¥éœ€è¦å…ˆæ¸…é™¤æ‰<code>GL_DEPTH_BUFFER_BIT</code>ã€‚</li></ol><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>  glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT<span class="op">|</span> GL_DEPTH_BUFFER_BIT<span class="op">);</span></span></code></pre></div></li><li><p>é€è§†æŠ•å½±<br>æ­£å¦‚ä½ çœ‹åˆ°çš„é‚£æ ·ï¼Œç”±äºé€è§†ï¼Œè¿™ä¸¤æ¡çº¿åœ¨å¾ˆè¿œçš„åœ°æ–¹çœ‹èµ·æ¥ä¼šç›¸äº¤ã€‚è¿™æ­£æ˜¯é€è§†æŠ•å½±æƒ³è¦æ¨¡ä»¿çš„æ•ˆæœï¼Œå®ƒæ˜¯ä½¿ç”¨é€è§†æŠ•å½±çŸ©é˜µæ¥å®Œæˆçš„ã€‚è¿™ä¸ªæŠ•å½±çŸ©é˜µå°†ç»™å®šçš„å¹³æˆªå¤´ä½“èŒƒå›´æ˜ å°„åˆ°è£å‰ªç©ºé—´ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜ä¿®æ”¹äº†æ¯ä¸ªé¡¶ç‚¹åæ ‡çš„wå€¼ï¼Œä»è€Œä½¿å¾—ç¦»è§‚å¯Ÿè€…è¶Šè¿œçš„é¡¶ç‚¹åæ ‡wåˆ†é‡è¶Šå¤§ã€‚è¢«å˜æ¢åˆ°è£å‰ªç©ºé—´çš„åæ ‡éƒ½ä¼šåœ¨-wåˆ°wçš„èŒƒå›´ä¹‹é—´ï¼ˆä»»ä½•å¤§äºè¿™ä¸ªèŒƒå›´çš„åæ ‡éƒ½ä¼šè¢«è£å‰ªæ‰ï¼‰ã€‚OpenGLè¦æ±‚æ‰€æœ‰å¯è§çš„åæ ‡éƒ½è½åœ¨-1.0åˆ°1.0èŒƒå›´å†…ï¼Œä½œä¸ºé¡¶ç‚¹ç€è‰²å™¨æœ€åçš„è¾“å‡ºï¼Œå› æ­¤ï¼Œä¸€æ—¦åæ ‡åœ¨è£å‰ªç©ºé—´å†…ä¹‹åï¼Œé€è§†é™¤æ³•å°±ä¼šè¢«åº”ç”¨åˆ°è£å‰ªç©ºé—´åæ ‡ä¸Šï¼šglmå†…ç½®é€è§†æŠ•å½±å‡½æ•° <code>glm::perspective</code><code>cpp         // fov, å®½é«˜æ¯”ï¼Œ è¿‘è£å‰ªé¢ï¼Œè¿œè£å‰ªé¢         projection = glm::perspective(glm::radians(45.0f), (float)wWidth / (float)wHeight, 0.1f, 100.0f);</code></p><p><span class="math display">\[     out = \left( x/w \\ y/w \\ z/w \right)\]</span></p></li><li><p>æœ¬åœ°åæ ‡è½¬æ¢åˆ°è£å‰ªç©ºé—´ <span class="math display">\[     V_{clip} = M_{projection}â‹…M_{view}â‹…M_{model}â‹…V_{local}\]</span></p><p><strong>!!æ³¨æ„çŸ©é˜µè¿ç®—çš„é¡ºåºæ˜¯ç›¸åçš„ï¼ˆè®°ä½æˆ‘ä»¬éœ€è¦ä»å³å¾€å·¦é˜…è¯»çŸ©é˜µçš„ä¹˜æ³•ï¼‰ã€‚æœ€åçš„é¡¶ç‚¹åº”è¯¥è¢«èµ‹å€¼åˆ°é¡¶ç‚¹ç€è‰²å™¨ä¸­çš„gl_Positionï¼ŒOpenGLå°†ä¼šè‡ªåŠ¨è¿›è¡Œé€è§†é™¤æ³•å’Œè£å‰ªã€‚</strong></p></li><li><p>é¡¶ç‚¹Shaderï¼Œæ¥å—<code>MVP</code><code>cpp         #version 330 core         layout (location = 0) in vec3 aPos; // ä½ç½®å˜é‡çš„å±æ€§ä½ç½®å€¼ä¸º0         layout (location = 1) in vec3 aColor; // é¢œè‰²å˜é‡çš„å±æ€§ä½ç½®å€¼ä¸º1         layout (location = 2) in vec2 aUv;  // uvå˜é‡çš„å±æ€§ä½ç½®å€¼ä¸º2         out vec3 vertexColor;   // ä¸ºç‰‡æ®µç€è‰²å™¨æŒ‡å®šä¸€ä¸ªé¢œè‰²è¾“å‡º         out vec2 uv;            // ä¸ºç‰‡æ®µç€è‰²å™¨æŒ‡å®šä¸€ä¸ªuv         uniform mat4 model;         uniform mat4 view;         uniform mat4 projection;         void main()         {             //é¡¶ç‚¹ä¹˜ä»¥mvpï¼Œ è½¬æ¢åˆ° projectionç©ºé—´ï¼Œ MVPç›¸åé¡ºåºã€‚             gl_Position = projection * view * model * vec4(aPos, 1.0); // æ³¨æ„æˆ‘ä»¬å¦‚ä½•æŠŠä¸€ä¸ªvec3ä½œä¸ºvec4çš„æ„é€ å™¨çš„å‚æ•°             vertexColor = aColor; // æŠŠè¾“å‡ºå˜é‡è®¾ç½®ä¸ºæš—çº¢è‰²             uv = aUv; // æŠŠè¾“å‡ºå˜é‡è®¾ç½®ä¸ºæš—çº¢è‰²         }</code></p></li><li><p>æ„é€ mvpçŸ©é˜µï¼Œå¹¶ä¼ é€’å€¼<code>cpp         //åˆå§‹åŒ–çŸ©é˜µå˜é‡         glm::mat4 model = glm::mat4(1.0f);          glm::mat4 view = glm::mat4(1.0f);         glm::mat4 projection = glm::mat4(1.0f);         //ä½¿æ¨¡å‹çŸ©é˜µæ²¿ç€xè½´å‘å€¾æ–œ`-55`         model = glm::rotate(model, glm::radians(-55.0f), glm::vec3(1.0f, 0.0f, 0.0f));         //è§‚å¯ŸçŸ©é˜µ æ²¿ç€ zå¹³ç§» -3         view = glm::translate(view, glm::vec3(0.0f, 0.0f, -3.0f));         // æ„é€ é€è§†æŠ•å½±çŸ©é˜µ         projection = glm::perspective(glm::radians(45.0f), (float)wWidth / (float)wHeight, 0.1f, 100.0f);         //ä¼ é€’model ç»™shader         unsigned int modelLoc = glGetUniformLocation(shader.ID, "model");         glUniformMatrix4fv(modelLoc, 1, GL_FALSE, glm::value_ptr(model));         //ä¼ é€’view ç»™shader         unsigned int viewLoc = glGetUniformLocation(shader.ID, "view");         glUniformMatrix4fv(viewLoc, 1, GL_FALSE, &amp;view[0][0]);         //ä¼ é€’view ç»™shader         unsigned int projectionLoc = glGetUniformLocation(shader.ID, "projection");         glUniformMatrix4fv(projectionLoc, 1, GL_FALSE, glm::value_ptr(projection));         // é…åˆShaderçš„çŸ©é˜µè¿ç®—ï¼Œè‡³æ­¤å›¾å½¢å·²ç»æœ‰äº†é€è§†æ•ˆæœã€‚</code></p></li><li><p>å®Œæ•´ä»£ç </p><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">"glad/glad.h"</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">"GLFW/glfw3.h"</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>     <span class="co">//å›¾ç‰‡åº“</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#define STB_IMAGE_IMPLEMENTATION</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">"stb_image.h"</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>     <span class="co">//glm OpenGL Mathåº“</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">"glm/glm.hpp"</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">"glm/gtc/matrix_transform.hpp"</span></span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">"glm/gtc/type_ptr.hpp"</span></span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">"shader.h"</span></span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>     <span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">const</span> <span class="dt">int</span> wWidth <span class="op">=</span> <span class="dv">800</span><span class="op">,</span> wHeight <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> wName <span class="op">=</span> <span class="st">"LearnOpenGL"</span><span class="op">;</span></span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>     <span class="dt">float</span> vertices<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>         <span class="co">//ä½ç½®                    // åŸºç¡€é¢œè‰²          // é¢˜å›¾uv</span></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// top right</span></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom right</span></span><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom left</span></span><span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span>  <span class="co">// top left </span></span><span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>     <span class="op">};</span></span><span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>     <span class="dt">unsigned</span> <span class="dt">int</span> indices<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>         <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="co">//  ç¬¬ä¸€ä¸ªä¸‰è§’å½¢</span></span><span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>         <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>  <span class="co">//  ç¬¬äºŒä¸ªä¸‰è§’å½¢</span></span><span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>     <span class="op">};</span></span><span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>     <span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">)</span></span><span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>     <span class="op">{</span></span><span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>         glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height<span class="op">);</span></span><span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>     <span class="op">}</span></span><span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>     <span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">)</span></span><span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>     <span class="op">{</span></span><span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_ESCAPE<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>             glfwSetWindowShouldClose<span class="op">(</span>window<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span><span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>     <span class="op">}</span></span><span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>     <span class="dt">int</span> main<span class="op">()</span></span><span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>     <span class="op">{</span></span><span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>         <span class="co">//1. åˆå§‹åŒ–</span></span><span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(</span>glfwInit<span class="op">()</span> <span class="op">==</span> GLFW_FALSE<span class="op">)</span></span><span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>             cout <span class="op">&lt;&lt;</span> <span class="st">"init glfw fail"</span><span class="op">;</span></span><span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>             <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>         <span class="co">//2. åŸºæœ¬è®¾ç½®</span></span><span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>         glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>         glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>         glfwWindowHint<span class="op">(</span>GLFW_OPENGL_PROFILE<span class="op">,</span> GLFW_OPENGL_CORE_PROFILE<span class="op">);</span></span><span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#if __APPLE__</span></span><span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>         glfwWindowHint<span class="op">(</span>GLFW_OPENGL_FORWARD_COMPAT<span class="op">,</span> GLFW_TRUE<span class="op">);</span></span><span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#endif</span></span><span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>         <span class="co">//3. åˆ›å»ºçª—å£</span></span><span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>         GLFWwindow <span class="op">*</span>window <span class="op">=</span> glfwCreateWindow<span class="op">(</span>wWidth<span class="op">,</span> wHeight<span class="op">,</span> wName<span class="op">,</span> <span class="kw">nullptr</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span><span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(</span>window <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span></span><span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>             cout <span class="op">&lt;&lt;</span> <span class="st">"Failed to create GLFW window"</span><span class="op">;</span></span><span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>             <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>             <span class="co">//return 1;</span></span><span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>         <span class="co">//4. å½“å‰ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡çª—å£</span></span><span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>         glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span><span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>         <span class="co">//5. ä½¿ç”¨gladç®¡ç†OpenGLæŒ‡é’ˆã€‚</span></span><span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(!</span>gladLoadGLLoader<span class="op">((</span>GLADloadproc<span class="op">)</span>glfwGetProcAddress<span class="op">))</span></span><span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>             <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to initialize GLAD"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>             <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>             <span class="co">//return 1;</span></span><span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>         <span class="co">//6. è®¾ç½®è§†å£</span></span><span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>         glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> wWidth<span class="op">,</span> wHeight<span class="op">);</span></span><span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>         <span class="co">//7. è®¾ç½®resizeå›è°ƒï¼Œå¯¹åº”åˆ·æ–°è§†å£</span></span><span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>         glfwSetFramebufferSizeCallback<span class="op">(</span>window<span class="op">,</span> framebuffer_size_callback<span class="op">);</span></span><span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>         Shader shader<span class="op">(</span><span class="st">"res/shaders/sample_vertex_mvp.shader"</span><span class="op">,</span> <span class="st">"res/shaders/sample_fragment_mvp.shader"</span><span class="op">);</span></span><span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>         <span class="dt">unsigned</span> <span class="dt">int</span> VBO<span class="op">,</span> VAO<span class="op">,</span> EBO<span class="op">;</span></span><span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>         glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>         glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>         glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>         glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>         glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>vertices<span class="op">),</span> vertices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>         glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>EBO<span class="op">);</span></span><span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>         glBindBuffer<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> EBO<span class="op">);</span></span><span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>         glBufferData<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>indices<span class="op">),</span> indices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>         <span class="co">//1. æŒ‡å®šé¡¶ç‚¹çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œé¡¶ç‚¹ 3ä¸ªfloatï¼Œä»0å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>         glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>         glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>         <span class="co">//2. æŒ‡å®šé¢œè‰²çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œä¸‰è‰² 3ä¸ªfloatï¼Œä»3å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>         glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>         glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>         <span class="co">//3. æŒ‡å®šuvçš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œuv 2ä¸ªfloatï¼Œä»6å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>         glVertexAttribPointer<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">6</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>         glEnableVertexAttribArray<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>         glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>         glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>         <span class="dt">unsigned</span> <span class="dt">int</span> texture1<span class="op">,</span> texture2<span class="op">;</span></span><span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>         <span class="co">//åŠ è½½è´´å›¾1</span></span><span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>         glGenTextures<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>texture1<span class="op">);</span></span><span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>         glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture1<span class="op">);</span></span><span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>         <span class="co">// è®¾ç½® wrapping å‚æ•°</span></span><span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_S<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_T<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>         <span class="co">// è®¾ç½®  filtering å‚æ•°</span></span><span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MIN_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MAG_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>         <span class="co">// åŠ è½½è§£æè´´å›¾æ–‡ä»¶</span></span><span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>         <span class="dt">int</span> width<span class="op">,</span> height<span class="op">,</span> nrChannels<span class="op">;</span></span><span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>         stbi_set_flip_vertically_on_load<span class="op">(</span><span class="kw">true</span><span class="op">);</span> <span class="co">// tell stb_image.h to flip loaded texture's on the y-axis.</span></span><span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>         <span class="dt">unsigned</span> <span class="dt">char</span><span class="op">*</span> data <span class="op">=</span> stbi_load<span class="op">(</span><span class="st">"./res/textures/container.jpg"</span><span class="op">,</span> <span class="op">&amp;</span>width<span class="op">,</span> <span class="op">&amp;</span>height<span class="op">,</span> <span class="op">&amp;</span>nrChannels<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(</span>data<span class="op">)</span></span><span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>             <span class="co">//ç¬¬ä¸€ä¸ª GL_RGB å°†è¢«è½¬æ¢çš„æ ¼å¼ï¼Œ ç¬¬äºŒä¸ªGL_RGBåŸå§‹æ–‡ä»¶çš„æ ¼å¼ï¼Œ æ ¼å¼ä¸åŒ¹é…ä¼šæŠ¥é”™ã€‚</span></span><span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>             glTexImage2D<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> GL_UNSIGNED_BYTE<span class="op">,</span> data<span class="op">);</span></span><span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>             glGenerateMipmap<span class="op">(</span>GL_TEXTURE_2D<span class="op">);</span></span><span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>         <span class="cf">else</span></span><span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>             <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to load texture"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>         stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>         <span class="co">//åŠ è½½è´´å›¾2</span></span><span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>         glGenTextures<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>texture2<span class="op">);</span></span><span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>         glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture2<span class="op">);</span></span><span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>         <span class="co">//  è®¾ç½® wrapping å‚æ•°</span></span><span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_S<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_T<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>         <span class="co">// è®¾ç½®  filtering å‚æ•°</span></span><span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MIN_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MAG_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>         <span class="co">// låŠ è½½è§£æè´´å›¾æ–‡ä»¶</span></span><span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>         data <span class="op">=</span> stbi_load<span class="op">(</span><span class="st">"./res/textures/awesomeface.png"</span><span class="op">,</span> <span class="op">&amp;</span>width<span class="op">,</span> <span class="op">&amp;</span>height<span class="op">,</span> <span class="op">&amp;</span>nrChannels<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(</span>data<span class="op">)</span></span><span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>             <span class="co">//ç¬¬ä¸€ä¸ª GL_RGB å°†è¢«è½¬æ¢çš„æ ¼å¼ï¼Œ ç¬¬äºŒä¸ªGL_RGBåŸå§‹æ–‡ä»¶çš„æ ¼å¼ï¼Œ æ ¼å¼ä¸åŒ¹é…ä¼šæŠ¥é”™ã€‚</span></span><span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>             glTexImage2D<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGBA<span class="op">,</span> GL_UNSIGNED_BYTE<span class="op">,</span> data<span class="op">);</span></span><span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>             glGenerateMipmap<span class="op">(</span>GL_TEXTURE_2D<span class="op">);</span></span><span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>         <span class="cf">else</span></span><span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>             <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to load texture"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>         stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>         <span class="co">//æŒ‡å®šé‡‡æ ·å™¨è´´å›¾å‚¨å­˜çš„ä½ç½®</span></span><span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>         shader<span class="op">.</span>use<span class="op">();</span></span><span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>         shader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"texture1"</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>         shader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"texture2"</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>         <span class="cf">while</span> <span class="op">(!</span>glfwWindowShouldClose<span class="op">(</span>window<span class="op">))</span></span><span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>             processInput<span class="op">(</span>window<span class="op">);</span></span><span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>             glClearColor<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>             glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT<span class="op">);</span></span><span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>             <span class="co">// bind Texture1</span></span><span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>             glActiveTexture<span class="op">(</span>GL_TEXTURE0<span class="op">);</span></span><span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>             glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture1<span class="op">);</span></span><span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a>             <span class="co">// bind Texture2</span></span><span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>             glActiveTexture<span class="op">(</span>GL_TEXTURE1<span class="op">);</span></span><span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>             glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture2<span class="op">);</span></span><span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a>             shader<span class="op">.</span>use<span class="op">();</span></span><span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>             glm<span class="op">::</span>mat4 model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span> </span><span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>             glm<span class="op">::</span>mat4 view <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>             glm<span class="op">::</span>mat4 projection <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>             model <span class="op">=</span> glm<span class="op">::</span>rotate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>radians<span class="op">(-</span><span class="fl">55.0</span><span class="bu">f</span><span class="op">),</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">));</span></span><span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>             view <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>view<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">3.0</span><span class="bu">f</span><span class="op">));</span></span><span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>             projection <span class="op">=</span> glm<span class="op">::</span>perspective<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span><span class="fl">45.0</span><span class="bu">f</span><span class="op">),</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>wWidth <span class="op">/</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>wHeight<span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">100.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a>             <span class="dt">unsigned</span> <span class="dt">int</span> modelLoc <span class="op">=</span> glGetUniformLocation<span class="op">(</span>shader<span class="op">.</span>ID<span class="op">,</span> <span class="st">"model"</span><span class="op">);</span></span><span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a>             <span class="dt">unsigned</span> <span class="dt">int</span> viewLoc <span class="op">=</span> glGetUniformLocation<span class="op">(</span>shader<span class="op">.</span>ID<span class="op">,</span> <span class="st">"view"</span><span class="op">);</span></span><span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>             glUniformMatrix4fv<span class="op">(</span>modelLoc<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span> glm<span class="op">::</span>value_ptr<span class="op">(</span>model<span class="op">));</span></span><span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>             glUniformMatrix4fv<span class="op">(</span>viewLoc<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="op">&amp;</span>view<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span><span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a>             shader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"projection"</span><span class="op">,</span> projection<span class="op">);</span></span><span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a>             glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a>             glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">6</span><span class="op">,</span> GL_UNSIGNED_INT<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>             glfwSwapBuffers<span class="op">(</span>window<span class="op">);</span></span><span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a>             glfwPollEvents<span class="op">();</span></span><span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>         glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>         glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>         glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>EBO<span class="op">);</span></span><span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>     TERMINATE<span class="op">:</span></span><span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a>         glfwTerminate<span class="op">();</span></span><span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>         <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>     <span class="op">}</span></span></code></pre></div></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/01-ji-chu-bu-fen/6.zuo-biao-xi/"/>
      <url>/2022/08/10/opengl/01-ji-chu-bu-fen/6.zuo-biao-xi/</url>
      
        <content type="html"><![CDATA[<h2 id="ä½¿ç”¨glmæ•°å­¦åº“">ä½¿ç”¨glmæ•°å­¦åº“</h2><blockquote><p>æ•°å­¦çŸ¥è¯†å‚è€ƒ<a href="../3dæ•°å­¦/README.md">3dæ•°å­¦éƒ¨åˆ†</a>glm::perspective æ„é€ </p></blockquote><ol type="1"><li><p>æ­£äº¤æŠ•å½±<br>æ­£å°„æŠ•å½±çŸ©é˜µå®šä¹‰äº†ä¸€ä¸ªç±»ä¼¼ç«‹æ–¹ä½“çš„å¹³æˆªå¤´ç®±ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªè£å‰ªç©ºé—´ï¼Œåœ¨è¿™ç©ºé—´ä¹‹å¤–çš„é¡¶ç‚¹éƒ½ä¼šè¢«è£å‰ªæ‰ã€‚åˆ›å»ºä¸€ä¸ªæ­£å°„æŠ•å½±çŸ©é˜µéœ€è¦æŒ‡å®šå¯è§å¹³æˆªå¤´ä½“çš„å®½ã€é«˜å’Œé•¿åº¦ã€‚åœ¨ä½¿ç”¨æ­£å°„æŠ•å½±çŸ©é˜µå˜æ¢è‡³è£å‰ªç©ºé—´ä¹‹åå¤„äºè¿™ä¸ªå¹³æˆªå¤´ä½“å†…çš„æ‰€æœ‰åæ ‡å°†ä¸ä¼šè¢«è£å‰ªæ‰ã€‚å®ƒçš„å¹³æˆªå¤´ä½“çœ‹èµ·æ¥åƒä¸€ä¸ªå®¹å™¨ï¼š<br>ä¸Šé¢çš„å¹³æˆªå¤´ä½“å®šä¹‰äº†å¯è§çš„åæ ‡ï¼Œå®ƒç”±ç”±å®½ã€é«˜ã€è¿‘(Near)å¹³é¢å’Œè¿œ(Far)å¹³é¢æ‰€æŒ‡å®šã€‚ä»»ä½•å‡ºç°åœ¨è¿‘å¹³é¢ä¹‹å‰æˆ–è¿œå¹³é¢ä¹‹åçš„åæ ‡éƒ½ä¼šè¢«è£å‰ªæ‰ã€‚æ­£å°„å¹³æˆªå¤´ä½“ç›´æ¥å°†å¹³æˆªå¤´ä½“å†…éƒ¨çš„æ‰€æœ‰åæ ‡æ˜ å°„ä¸ºæ ‡å‡†åŒ–è®¾å¤‡åæ ‡ï¼Œå› ä¸ºæ¯ä¸ªå‘é‡çš„wåˆ†é‡éƒ½æ²¡æœ‰è¿›è¡Œæ”¹å˜ï¼›å¦‚æœwåˆ†é‡ç­‰äº1.0ï¼Œé€è§†é™¤æ³•åˆ™ä¸ä¼šæ”¹å˜è¿™ä¸ªåæ ‡ã€‚<br>glmå†…ç½®æ­£äº¤æŠ•å½±å‡½æ•° <code>glm::ortho</code>ï¼š</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>     glm<span class="op">::</span>ortho<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">800.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">600.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">100.0</span><span class="bu">f</span><span class="op">);</span></span></code></pre></div></li><li><p>é€è§†æŠ•å½±<br>æ­£å¦‚ä½ çœ‹åˆ°çš„é‚£æ ·ï¼Œç”±äºé€è§†ï¼Œè¿™ä¸¤æ¡çº¿åœ¨å¾ˆè¿œçš„åœ°æ–¹çœ‹èµ·æ¥ä¼šç›¸äº¤ã€‚è¿™æ­£æ˜¯é€è§†æŠ•å½±æƒ³è¦æ¨¡ä»¿çš„æ•ˆæœï¼Œå®ƒæ˜¯ä½¿ç”¨é€è§†æŠ•å½±çŸ©é˜µæ¥å®Œæˆçš„ã€‚è¿™ä¸ªæŠ•å½±çŸ©é˜µå°†ç»™å®šçš„å¹³æˆªå¤´ä½“èŒƒå›´æ˜ å°„åˆ°è£å‰ªç©ºé—´ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜ä¿®æ”¹äº†æ¯ä¸ªé¡¶ç‚¹åæ ‡çš„wå€¼ï¼Œä»è€Œä½¿å¾—ç¦»è§‚å¯Ÿè€…è¶Šè¿œçš„é¡¶ç‚¹åæ ‡wåˆ†é‡è¶Šå¤§ã€‚è¢«å˜æ¢åˆ°è£å‰ªç©ºé—´çš„åæ ‡éƒ½ä¼šåœ¨-wåˆ°wçš„èŒƒå›´ä¹‹é—´ï¼ˆä»»ä½•å¤§äºè¿™ä¸ªèŒƒå›´çš„åæ ‡éƒ½ä¼šè¢«è£å‰ªæ‰ï¼‰ã€‚OpenGLè¦æ±‚æ‰€æœ‰å¯è§çš„åæ ‡éƒ½è½åœ¨-1.0åˆ°1.0èŒƒå›´å†…ï¼Œä½œä¸ºé¡¶ç‚¹ç€è‰²å™¨æœ€åçš„è¾“å‡ºï¼Œå› æ­¤ï¼Œä¸€æ—¦åæ ‡åœ¨è£å‰ªç©ºé—´å†…ä¹‹åï¼Œé€è§†é™¤æ³•å°±ä¼šè¢«åº”ç”¨åˆ°è£å‰ªç©ºé—´åæ ‡ä¸Šï¼šglmå†…ç½®é€è§†æŠ•å½±å‡½æ•° <code>glm::perspective</code><code>cpp         // fov, å®½é«˜æ¯”ï¼Œ è¿‘è£å‰ªé¢ï¼Œè¿œè£å‰ªé¢         projection = glm::perspective(glm::radians(45.0f), (float)wWidth / (float)wHeight, 0.1f, 100.0f);</code></p><p><span class="math display">\[     out = \left( x/w \\ y/w \\ z/w \right)\]</span></p></li><li><p>æœ¬åœ°åæ ‡è½¬æ¢åˆ°è£å‰ªç©ºé—´ <span class="math display">\[     V_{clip} = M_{projection}â‹…M_{view}â‹…M_{model}â‹…V_{local}\]</span></p><p><strong>!!æ³¨æ„çŸ©é˜µè¿ç®—çš„é¡ºåºæ˜¯ç›¸åçš„ï¼ˆè®°ä½æˆ‘ä»¬éœ€è¦ä»å³å¾€å·¦é˜…è¯»çŸ©é˜µçš„ä¹˜æ³•ï¼‰ã€‚æœ€åçš„é¡¶ç‚¹åº”è¯¥è¢«èµ‹å€¼åˆ°é¡¶ç‚¹ç€è‰²å™¨ä¸­çš„gl_Positionï¼ŒOpenGLå°†ä¼šè‡ªåŠ¨è¿›è¡Œé€è§†é™¤æ³•å’Œè£å‰ªã€‚</strong></p></li><li><p>é¡¶ç‚¹Shaderï¼Œæ¥å—<code>MVP</code><code>cpp         #version 330 core         layout (location = 0) in vec3 aPos; // ä½ç½®å˜é‡çš„å±æ€§ä½ç½®å€¼ä¸º0         layout (location = 1) in vec3 aColor; // é¢œè‰²å˜é‡çš„å±æ€§ä½ç½®å€¼ä¸º1         layout (location = 2) in vec2 aUv;  // uvå˜é‡çš„å±æ€§ä½ç½®å€¼ä¸º2         out vec3 vertexColor;   // ä¸ºç‰‡æ®µç€è‰²å™¨æŒ‡å®šä¸€ä¸ªé¢œè‰²è¾“å‡º         out vec2 uv;            // ä¸ºç‰‡æ®µç€è‰²å™¨æŒ‡å®šä¸€ä¸ªuv         uniform mat4 model;         uniform mat4 view;         uniform mat4 projection;         void main()         {             //é¡¶ç‚¹ä¹˜ä»¥mvpï¼Œ è½¬æ¢åˆ° projectionç©ºé—´ï¼Œ MVPç›¸åé¡ºåºã€‚             gl_Position = projection * view * model * vec4(aPos, 1.0); // æ³¨æ„æˆ‘ä»¬å¦‚ä½•æŠŠä¸€ä¸ªvec3ä½œä¸ºvec4çš„æ„é€ å™¨çš„å‚æ•°             vertexColor = aColor; // æŠŠè¾“å‡ºå˜é‡è®¾ç½®ä¸ºæš—çº¢è‰²             uv = aUv; // æŠŠè¾“å‡ºå˜é‡è®¾ç½®ä¸ºæš—çº¢è‰²         }</code></p></li><li><p>æ„é€ mvpçŸ©é˜µï¼Œå¹¶ä¼ é€’å€¼<code>cpp         //åˆå§‹åŒ–çŸ©é˜µå˜é‡         glm::mat4 model = glm::mat4(1.0f);          glm::mat4 view = glm::mat4(1.0f);         glm::mat4 projection = glm::mat4(1.0f);         //ä½¿æ¨¡å‹çŸ©é˜µæ²¿ç€xè½´å‘å€¾æ–œ`-55`         model = glm::rotate(model, glm::radians(-55.0f), glm::vec3(1.0f, 0.0f, 0.0f));         //è§‚å¯ŸçŸ©é˜µ æ²¿ç€ zå¹³ç§» -3         view = glm::translate(view, glm::vec3(0.0f, 0.0f, -3.0f));         // æ„é€ é€è§†æŠ•å½±çŸ©é˜µ         projection = glm::perspective(glm::radians(45.0f), (float)wWidth / (float)wHeight, 0.1f, 100.0f);         //ä¼ é€’model ç»™shader         unsigned int modelLoc = glGetUniformLocation(shader.ID, "model");         glUniformMatrix4fv(modelLoc, 1, GL_FALSE, glm::value_ptr(model));         //ä¼ é€’view ç»™shader         unsigned int viewLoc = glGetUniformLocation(shader.ID, "view");         glUniformMatrix4fv(viewLoc, 1, GL_FALSE, &amp;view[0][0]);         //ä¼ é€’view ç»™shader         unsigned int projectionLoc = glGetUniformLocation(shader.ID, "projection");         glUniformMatrix4fv(projectionLoc, 1, GL_FALSE, glm::value_ptr(projection));         // é…åˆShaderçš„çŸ©é˜µè¿ç®—ï¼Œè‡³æ­¤å›¾å½¢å·²ç»æœ‰äº†é€è§†æ•ˆæœã€‚</code></p></li><li><p>å®Œæ•´ä»£ç </p><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">"glad/glad.h"</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">"GLFW/glfw3.h"</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>     <span class="co">//å›¾ç‰‡åº“</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#define STB_IMAGE_IMPLEMENTATION</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">"stb_image.h"</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>     <span class="co">//glm OpenGL Mathåº“</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">"glm/glm.hpp"</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">"glm/gtc/matrix_transform.hpp"</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">"glm/gtc/type_ptr.hpp"</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">"shader.h"</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>     <span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">const</span> <span class="dt">int</span> wWidth <span class="op">=</span> <span class="dv">800</span><span class="op">,</span> wHeight <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> wName <span class="op">=</span> <span class="st">"LearnOpenGL"</span><span class="op">;</span></span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>     <span class="dt">float</span> vertices<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>         <span class="co">//ä½ç½®                    // åŸºç¡€é¢œè‰²          // é¢˜å›¾uv</span></span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// top right</span></span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom right</span></span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom left</span></span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>            <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span>  <span class="co">// top left </span></span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>     <span class="op">};</span></span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>     <span class="dt">unsigned</span> <span class="dt">int</span> indices<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>         <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="co">//  ç¬¬ä¸€ä¸ªä¸‰è§’å½¢</span></span><span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>         <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>  <span class="co">//  ç¬¬äºŒä¸ªä¸‰è§’å½¢</span></span><span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>     <span class="op">};</span></span><span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>     <span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">)</span></span><span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>     <span class="op">{</span></span><span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>         glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height<span class="op">);</span></span><span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>     <span class="op">}</span></span><span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>     <span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">)</span></span><span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>     <span class="op">{</span></span><span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_ESCAPE<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>             glfwSetWindowShouldClose<span class="op">(</span>window<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span><span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>     <span class="op">}</span></span><span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>     <span class="dt">int</span> main<span class="op">()</span></span><span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>     <span class="op">{</span></span><span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>         <span class="co">//1. åˆå§‹åŒ–</span></span><span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(</span>glfwInit<span class="op">()</span> <span class="op">==</span> GLFW_FALSE<span class="op">)</span></span><span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>             cout <span class="op">&lt;&lt;</span> <span class="st">"init glfw fail"</span><span class="op">;</span></span><span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>             <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>         <span class="co">//2. åŸºæœ¬è®¾ç½®</span></span><span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>         glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>         glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>         glfwWindowHint<span class="op">(</span>GLFW_OPENGL_PROFILE<span class="op">,</span> GLFW_OPENGL_CORE_PROFILE<span class="op">);</span></span><span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#if __APPLE__</span></span><span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>         glfwWindowHint<span class="op">(</span>GLFW_OPENGL_FORWARD_COMPAT<span class="op">,</span> GLFW_TRUE<span class="op">);</span></span><span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>     <span class="pp">#endif</span></span><span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>         <span class="co">//3. åˆ›å»ºçª—å£</span></span><span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>         GLFWwindow <span class="op">*</span>window <span class="op">=</span> glfwCreateWindow<span class="op">(</span>wWidth<span class="op">,</span> wHeight<span class="op">,</span> wName<span class="op">,</span> <span class="kw">nullptr</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span><span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(</span>window <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span></span><span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>             cout <span class="op">&lt;&lt;</span> <span class="st">"Failed to create GLFW window"</span><span class="op">;</span></span><span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>             <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>             <span class="co">//return 1;</span></span><span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>         <span class="co">//4. å½“å‰ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡çª—å£</span></span><span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>         glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span><span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>         <span class="co">//5. ä½¿ç”¨gladç®¡ç†OpenGLæŒ‡é’ˆã€‚</span></span><span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(!</span>gladLoadGLLoader<span class="op">((</span>GLADloadproc<span class="op">)</span>glfwGetProcAddress<span class="op">))</span></span><span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>             <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to initialize GLAD"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>             <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>             <span class="co">//return 1;</span></span><span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>         <span class="co">//6. è®¾ç½®è§†å£</span></span><span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>         glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> wWidth<span class="op">,</span> wHeight<span class="op">);</span></span><span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>         <span class="co">//7. è®¾ç½®resizeå›è°ƒï¼Œå¯¹åº”åˆ·æ–°è§†å£</span></span><span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>         glfwSetFramebufferSizeCallback<span class="op">(</span>window<span class="op">,</span> framebuffer_size_callback<span class="op">);</span></span><span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>         Shader shader<span class="op">(</span><span class="st">"res/shaders/sample_vertex_mvp.shader"</span><span class="op">,</span> <span class="st">"res/shaders/sample_fragment_mvp.shader"</span><span class="op">);</span></span><span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>         <span class="dt">unsigned</span> <span class="dt">int</span> VBO<span class="op">,</span> VAO<span class="op">,</span> EBO<span class="op">;</span></span><span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>         glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>         glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>         glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>         glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>         glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>vertices<span class="op">),</span> vertices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>         glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>EBO<span class="op">);</span></span><span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>         glBindBuffer<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> EBO<span class="op">);</span></span><span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>         glBufferData<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>indices<span class="op">),</span> indices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>         <span class="co">//1. æŒ‡å®šé¡¶ç‚¹çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œé¡¶ç‚¹ 3ä¸ªfloatï¼Œä»0å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>         glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>         glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>         <span class="co">//2. æŒ‡å®šé¢œè‰²çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œä¸‰è‰² 3ä¸ªfloatï¼Œä»3å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>         glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>         glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>         <span class="co">//3. æŒ‡å®šuvçš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œuv 2ä¸ªfloatï¼Œä»6å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>         glVertexAttribPointer<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">6</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>         glEnableVertexAttribArray<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>         glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>         glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>         <span class="dt">unsigned</span> <span class="dt">int</span> texture1<span class="op">,</span> texture2<span class="op">;</span></span><span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>         <span class="co">//åŠ è½½è´´å›¾1</span></span><span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>         glGenTextures<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>texture1<span class="op">);</span></span><span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>         glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture1<span class="op">);</span></span><span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>         <span class="co">// è®¾ç½® wrapping å‚æ•°</span></span><span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_S<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_T<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>         <span class="co">// è®¾ç½®  filtering å‚æ•°</span></span><span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MIN_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MAG_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>         <span class="co">// åŠ è½½è§£æè´´å›¾æ–‡ä»¶</span></span><span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>         <span class="dt">int</span> width<span class="op">,</span> height<span class="op">,</span> nrChannels<span class="op">;</span></span><span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>         stbi_set_flip_vertically_on_load<span class="op">(</span><span class="kw">true</span><span class="op">);</span> <span class="co">// tell stb_image.h to flip loaded texture's on the y-axis.</span></span><span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a>         <span class="dt">unsigned</span> <span class="dt">char</span><span class="op">*</span> data <span class="op">=</span> stbi_load<span class="op">(</span><span class="st">"./res/textures/container.jpg"</span><span class="op">,</span> <span class="op">&amp;</span>width<span class="op">,</span> <span class="op">&amp;</span>height<span class="op">,</span> <span class="op">&amp;</span>nrChannels<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(</span>data<span class="op">)</span></span><span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>             <span class="co">//ç¬¬ä¸€ä¸ª GL_RGB å°†è¢«è½¬æ¢çš„æ ¼å¼ï¼Œ ç¬¬äºŒä¸ªGL_RGBåŸå§‹æ–‡ä»¶çš„æ ¼å¼ï¼Œ æ ¼å¼ä¸åŒ¹é…ä¼šæŠ¥é”™ã€‚</span></span><span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>             glTexImage2D<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> GL_UNSIGNED_BYTE<span class="op">,</span> data<span class="op">);</span></span><span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>             glGenerateMipmap<span class="op">(</span>GL_TEXTURE_2D<span class="op">);</span></span><span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>         <span class="cf">else</span></span><span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>             <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to load texture"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>         stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>         <span class="co">//åŠ è½½è´´å›¾2</span></span><span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>         glGenTextures<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>texture2<span class="op">);</span></span><span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>         glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture2<span class="op">);</span></span><span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>         <span class="co">//  è®¾ç½® wrapping å‚æ•°</span></span><span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_S<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_T<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>         <span class="co">// è®¾ç½®  filtering å‚æ•°</span></span><span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MIN_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>         glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MAG_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>         <span class="co">// låŠ è½½è§£æè´´å›¾æ–‡ä»¶</span></span><span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>         data <span class="op">=</span> stbi_load<span class="op">(</span><span class="st">"./res/textures/awesomeface.png"</span><span class="op">,</span> <span class="op">&amp;</span>width<span class="op">,</span> <span class="op">&amp;</span>height<span class="op">,</span> <span class="op">&amp;</span>nrChannels<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>         <span class="cf">if</span> <span class="op">(</span>data<span class="op">)</span></span><span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb2-158"><a href="#cb2-158" aria-hidden="true" tabindex="-1"></a>             <span class="co">//ç¬¬ä¸€ä¸ª GL_RGB å°†è¢«è½¬æ¢çš„æ ¼å¼ï¼Œ ç¬¬äºŒä¸ªGL_RGBåŸå§‹æ–‡ä»¶çš„æ ¼å¼ï¼Œ æ ¼å¼ä¸åŒ¹é…ä¼šæŠ¥é”™ã€‚</span></span><span id="cb2-159"><a href="#cb2-159" aria-hidden="true" tabindex="-1"></a>             glTexImage2D<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGBA<span class="op">,</span> GL_UNSIGNED_BYTE<span class="op">,</span> data<span class="op">);</span></span><span id="cb2-160"><a href="#cb2-160" aria-hidden="true" tabindex="-1"></a>             glGenerateMipmap<span class="op">(</span>GL_TEXTURE_2D<span class="op">);</span></span><span id="cb2-161"><a href="#cb2-161" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb2-162"><a href="#cb2-162" aria-hidden="true" tabindex="-1"></a>         <span class="cf">else</span></span><span id="cb2-163"><a href="#cb2-163" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb2-164"><a href="#cb2-164" aria-hidden="true" tabindex="-1"></a>             <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to load texture"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb2-165"><a href="#cb2-165" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb2-166"><a href="#cb2-166" aria-hidden="true" tabindex="-1"></a>         stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb2-167"><a href="#cb2-167" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-168"><a href="#cb2-168" aria-hidden="true" tabindex="-1"></a>         <span class="co">//æŒ‡å®šé‡‡æ ·å™¨è´´å›¾å‚¨å­˜çš„ä½ç½®</span></span><span id="cb2-169"><a href="#cb2-169" aria-hidden="true" tabindex="-1"></a>         shader<span class="op">.</span>use<span class="op">();</span></span><span id="cb2-170"><a href="#cb2-170" aria-hidden="true" tabindex="-1"></a>         shader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"texture1"</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb2-171"><a href="#cb2-171" aria-hidden="true" tabindex="-1"></a>         shader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"texture2"</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb2-172"><a href="#cb2-172" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-173"><a href="#cb2-173" aria-hidden="true" tabindex="-1"></a>         <span class="cf">while</span> <span class="op">(!</span>glfwWindowShouldClose<span class="op">(</span>window<span class="op">))</span></span><span id="cb2-174"><a href="#cb2-174" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span><span id="cb2-175"><a href="#cb2-175" aria-hidden="true" tabindex="-1"></a>             processInput<span class="op">(</span>window<span class="op">);</span></span><span id="cb2-176"><a href="#cb2-176" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-177"><a href="#cb2-177" aria-hidden="true" tabindex="-1"></a>             glClearColor<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-178"><a href="#cb2-178" aria-hidden="true" tabindex="-1"></a>             glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT<span class="op">);</span></span><span id="cb2-179"><a href="#cb2-179" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-180"><a href="#cb2-180" aria-hidden="true" tabindex="-1"></a>             <span class="co">// bind Texture1</span></span><span id="cb2-181"><a href="#cb2-181" aria-hidden="true" tabindex="-1"></a>             glActiveTexture<span class="op">(</span>GL_TEXTURE0<span class="op">);</span></span><span id="cb2-182"><a href="#cb2-182" aria-hidden="true" tabindex="-1"></a>             glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture1<span class="op">);</span></span><span id="cb2-183"><a href="#cb2-183" aria-hidden="true" tabindex="-1"></a>             <span class="co">// bind Texture2</span></span><span id="cb2-184"><a href="#cb2-184" aria-hidden="true" tabindex="-1"></a>             glActiveTexture<span class="op">(</span>GL_TEXTURE1<span class="op">);</span></span><span id="cb2-185"><a href="#cb2-185" aria-hidden="true" tabindex="-1"></a>             glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture2<span class="op">);</span></span><span id="cb2-186"><a href="#cb2-186" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-187"><a href="#cb2-187" aria-hidden="true" tabindex="-1"></a>             shader<span class="op">.</span>use<span class="op">();</span></span><span id="cb2-188"><a href="#cb2-188" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-189"><a href="#cb2-189" aria-hidden="true" tabindex="-1"></a>             glm<span class="op">::</span>mat4 model <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span> </span><span id="cb2-190"><a href="#cb2-190" aria-hidden="true" tabindex="-1"></a>             glm<span class="op">::</span>mat4 view <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-191"><a href="#cb2-191" aria-hidden="true" tabindex="-1"></a>             glm<span class="op">::</span>mat4 projection <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-192"><a href="#cb2-192" aria-hidden="true" tabindex="-1"></a>             model <span class="op">=</span> glm<span class="op">::</span>rotate<span class="op">(</span>model<span class="op">,</span> glm<span class="op">::</span>radians<span class="op">(-</span><span class="fl">55.0</span><span class="bu">f</span><span class="op">),</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">));</span></span><span id="cb2-193"><a href="#cb2-193" aria-hidden="true" tabindex="-1"></a>             view <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>view<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">3.0</span><span class="bu">f</span><span class="op">));</span></span><span id="cb2-194"><a href="#cb2-194" aria-hidden="true" tabindex="-1"></a>             projection <span class="op">=</span> glm<span class="op">::</span>perspective<span class="op">(</span>glm<span class="op">::</span>radians<span class="op">(</span><span class="fl">45.0</span><span class="bu">f</span><span class="op">),</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>wWidth <span class="op">/</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>wHeight<span class="op">,</span> <span class="fl">0.1</span><span class="bu">f</span><span class="op">,</span> <span class="fl">100.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb2-195"><a href="#cb2-195" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-196"><a href="#cb2-196" aria-hidden="true" tabindex="-1"></a>             <span class="dt">unsigned</span> <span class="dt">int</span> modelLoc <span class="op">=</span> glGetUniformLocation<span class="op">(</span>shader<span class="op">.</span>ID<span class="op">,</span> <span class="st">"model"</span><span class="op">);</span></span><span id="cb2-197"><a href="#cb2-197" aria-hidden="true" tabindex="-1"></a>             <span class="dt">unsigned</span> <span class="dt">int</span> viewLoc <span class="op">=</span> glGetUniformLocation<span class="op">(</span>shader<span class="op">.</span>ID<span class="op">,</span> <span class="st">"view"</span><span class="op">);</span></span><span id="cb2-198"><a href="#cb2-198" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-199"><a href="#cb2-199" aria-hidden="true" tabindex="-1"></a>             glUniformMatrix4fv<span class="op">(</span>modelLoc<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span> glm<span class="op">::</span>value_ptr<span class="op">(</span>model<span class="op">));</span></span><span id="cb2-200"><a href="#cb2-200" aria-hidden="true" tabindex="-1"></a>             glUniformMatrix4fv<span class="op">(</span>viewLoc<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="op">&amp;</span>view<span class="op">[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]);</span></span><span id="cb2-201"><a href="#cb2-201" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-202"><a href="#cb2-202" aria-hidden="true" tabindex="-1"></a>             shader<span class="op">.</span>setMat4<span class="op">(</span><span class="st">"projection"</span><span class="op">,</span> projection<span class="op">);</span></span><span id="cb2-203"><a href="#cb2-203" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-204"><a href="#cb2-204" aria-hidden="true" tabindex="-1"></a>             glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb2-205"><a href="#cb2-205" aria-hidden="true" tabindex="-1"></a>             glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">6</span><span class="op">,</span> GL_UNSIGNED_INT<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb2-206"><a href="#cb2-206" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-207"><a href="#cb2-207" aria-hidden="true" tabindex="-1"></a>             glfwSwapBuffers<span class="op">(</span>window<span class="op">);</span></span><span id="cb2-208"><a href="#cb2-208" aria-hidden="true" tabindex="-1"></a>             glfwPollEvents<span class="op">();</span></span><span id="cb2-209"><a href="#cb2-209" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span><span id="cb2-210"><a href="#cb2-210" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-211"><a href="#cb2-211" aria-hidden="true" tabindex="-1"></a>         glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb2-212"><a href="#cb2-212" aria-hidden="true" tabindex="-1"></a>         glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb2-213"><a href="#cb2-213" aria-hidden="true" tabindex="-1"></a>         glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>EBO<span class="op">);</span></span><span id="cb2-214"><a href="#cb2-214" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-215"><a href="#cb2-215" aria-hidden="true" tabindex="-1"></a>     TERMINATE<span class="op">:</span></span><span id="cb2-216"><a href="#cb2-216" aria-hidden="true" tabindex="-1"></a>         glfwTerminate<span class="op">();</span></span><span id="cb2-217"><a href="#cb2-217" aria-hidden="true" tabindex="-1"></a>         <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-218"><a href="#cb2-218" aria-hidden="true" tabindex="-1"></a>     <span class="op">}</span></span></code></pre></div></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/01-ji-chu-bu-fen/5.shi-yong-glm-shu-xue-ku/"/>
      <url>/2022/08/10/opengl/01-ji-chu-bu-fen/5.shi-yong-glm-shu-xue-ku/</url>
      
        <content type="html"><![CDATA[<h2 id="ä½¿ç”¨glmæ•°å­¦åº“">ä½¿ç”¨glmæ•°å­¦åº“</h2><blockquote><p>æ•°å­¦çŸ¥è¯†å‚è€ƒ<a href="../3dæ•°å­¦/README.md">3dæ•°å­¦éƒ¨åˆ†</a> openglglfwGetTime()æ—¶é—´å‡½æ•°</p></blockquote><ol type="1"><li><p>glmæ•°å­¦åº“<code>cpp         #include &lt;glm/glm.hpp&gt;         #include &lt;glm/gtc/matrix_transform.hpp&gt;         #include &lt;glm/gtc/type_ptr.hpp&gt;</code></p></li><li><p>çŸ©é˜µå’Œå‘é‡åˆå§‹åŒ–<code>cpp     //çŸ©é˜µåˆå§‹åŒ–     glm::mat4 mat = glm::mat4(1.0f)     //å‘é‡åˆå§‹åŒ–     glm::vec4 vec(1.0f, 0.0f, 0.0f, 1.0f);</code></p></li><li><p>åŸºç¡€æ–¹æ³•</p><ol type="1"><li>ä½ç§» <code>glm::translate</code></li><li>æ—‹è½¬ <code>glm::rotate</code></li><li>ç¼©æ”¾ <code>glm::scale</code></li></ol></li><li><p>ç®€å•ç¤ºä¾‹ <code>ä½¿ç”¨transform</code></p><ol type="1"><li>é¡¶ç‚¹Shader<code>cpp          #version 330 core          layout (location = 0) in vec3 aPos;          layout (location = 1) in vec2 aTexCoord;          out vec2 TexCoord;          uniform mat4 transform; //ä¼ é€’tranformçŸ©é˜µï¼ŒåŒ…å«æ—‹è½¬åç§»ç¼©æ”¾é‡          void main()          {              gl_Position = transform * vec4(aPos, 1.0f);              TexCoord = vec2(aTexCoord.x, 1.0 - aTexCoord.y);          }</code></li><li>ä¼ é€’ transformå€¼ç»™Shader<code>cpp          unsigned int transformLoc = glGetUniformLocation(ourShader.ID, "transform");          glUniformMatrix4fv(transformLoc, 1, GL_FALSE, glm::value_ptr(trans));</code></li></ol></li><li><p>å®Œæ•´ä»£ç </p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"glad/glad.h"</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"GLFW/glfw3.h"</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//å›¾ç‰‡åº“</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define STB_IMAGE_IMPLEMENTATION</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"stb_image.h"</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//glm OpenGL Mathåº“</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"glm/glm.hpp"</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"glm/gtc/matrix_transform.hpp"</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"glm/gtc/type_ptr.hpp"</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"shader.h"</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">int</span> wWidth <span class="op">=</span> <span class="dv">800</span><span class="op">,</span> wHeight <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> wName <span class="op">=</span> <span class="st">"LearnOpenGL"</span><span class="op">;</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> vertices<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">//ä½ç½®                    // åŸºç¡€é¢œè‰²          // é¢˜å›¾uv</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// top right</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom right</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>           <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom left</span></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>           <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span>  <span class="co">// top left </span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> indices<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="co">//  ç¬¬ä¸€ä¸ªä¸‰è§’å½¢</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>  <span class="co">//  ç¬¬äºŒä¸ªä¸‰è§’å½¢</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">)</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height<span class="op">);</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">)</span></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_ESCAPE<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>            glfwSetWindowShouldClose<span class="op">(</span>window<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> main<span class="op">()</span></span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">//1. åˆå§‹åŒ–</span></span><span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwInit<span class="op">()</span> <span class="op">==</span> GLFW_FALSE<span class="op">)</span></span><span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>            cout <span class="op">&lt;&lt;</span> <span class="st">"init glfw fail"</span><span class="op">;</span></span><span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">//2. åŸºæœ¬è®¾ç½®</span></span><span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_OPENGL_PROFILE<span class="op">,</span> GLFW_OPENGL_CORE_PROFILE<span class="op">);</span></span><span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if __APPLE__</span></span><span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_OPENGL_FORWARD_COMPAT<span class="op">,</span> GLFW_TRUE<span class="op">);</span></span><span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span><span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>        <span class="co">//3. åˆ›å»ºçª—å£</span></span><span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>        GLFWwindow <span class="op">*</span>window <span class="op">=</span> glfwCreateWindow<span class="op">(</span>wWidth<span class="op">,</span> wHeight<span class="op">,</span> wName<span class="op">,</span> <span class="kw">nullptr</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span><span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>window <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span></span><span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>            cout <span class="op">&lt;&lt;</span> <span class="st">"Failed to create GLFW window"</span><span class="op">;</span></span><span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>            <span class="co">//return 1;</span></span><span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>        <span class="co">//4. å½“å‰ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡çª—å£</span></span><span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span><span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        <span class="co">//5. ä½¿ç”¨gladç®¡ç†OpenGLæŒ‡é’ˆã€‚</span></span><span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>gladLoadGLLoader<span class="op">((</span>GLADloadproc<span class="op">)</span>glfwGetProcAddress<span class="op">))</span></span><span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to initialize GLAD"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>            <span class="co">//return 1;</span></span><span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>        <span class="co">//6. è®¾ç½®è§†å£</span></span><span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>        glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> wWidth<span class="op">,</span> wHeight<span class="op">);</span></span><span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>        <span class="co">//7. è®¾ç½®resizeå›è°ƒï¼Œå¯¹åº”åˆ·æ–°è§†å£</span></span><span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>        glfwSetFramebufferSizeCallback<span class="op">(</span>window<span class="op">,</span> framebuffer_size_callback<span class="op">);</span></span><span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>        Shader shader<span class="op">(</span><span class="st">"res/shaders/sample_vertex_transoform.shader"</span><span class="op">,</span> <span class="st">"res/shaders/sample_fragment_transoform.shader"</span><span class="op">);</span></span><span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> VBO<span class="op">,</span> VAO<span class="op">,</span> EBO<span class="op">;</span></span><span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>        glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>        glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>        glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>vertices<span class="op">),</span> vertices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>        glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>EBO<span class="op">);</span></span><span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> EBO<span class="op">);</span></span><span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>        glBufferData<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>indices<span class="op">),</span> indices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>        <span class="co">//1. æŒ‡å®šé¡¶ç‚¹çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œé¡¶ç‚¹ 3ä¸ªfloatï¼Œä»0å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>        <span class="co">//2. æŒ‡å®šé¢œè‰²çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œä¸‰è‰² 3ä¸ªfloatï¼Œä»3å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>        <span class="co">//3. æŒ‡å®šuvçš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œuv 2ä¸ªfloatï¼Œä»6å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">6</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> texture1<span class="op">,</span> texture2<span class="op">;</span></span><span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>        <span class="co">//åŠ è½½è´´å›¾1</span></span><span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>        glGenTextures<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>texture1<span class="op">);</span></span><span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>        glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture1<span class="op">);</span></span><span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>        <span class="co">// è®¾ç½® wrapping å‚æ•°</span></span><span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_S<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_T<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>        <span class="co">// è®¾ç½®  filtering å‚æ•°</span></span><span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MIN_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MAG_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>        <span class="co">// åŠ è½½è§£æè´´å›¾æ–‡ä»¶</span></span><span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> width<span class="op">,</span> height<span class="op">,</span> nrChannels<span class="op">;</span></span><span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>        stbi_set_flip_vertically_on_load<span class="op">(</span><span class="kw">true</span><span class="op">);</span> <span class="co">// tell stb_image.h to flip loaded texture's on the y-axis.</span></span><span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">char</span><span class="op">*</span> data <span class="op">=</span> stbi_load<span class="op">(</span><span class="st">"./res/textures/container.jpg"</span><span class="op">,</span> <span class="op">&amp;</span>width<span class="op">,</span> <span class="op">&amp;</span>height<span class="op">,</span> <span class="op">&amp;</span>nrChannels<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>data<span class="op">)</span></span><span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>            <span class="co">//ç¬¬ä¸€ä¸ª GL_RGB å°†è¢«è½¬æ¢çš„æ ¼å¼ï¼Œ ç¬¬äºŒä¸ªGL_RGBåŸå§‹æ–‡ä»¶çš„æ ¼å¼ï¼Œ æ ¼å¼ä¸åŒ¹é…ä¼šæŠ¥é”™ã€‚</span></span><span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>            glTexImage2D<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> GL_UNSIGNED_BYTE<span class="op">,</span> data<span class="op">);</span></span><span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>            glGenerateMipmap<span class="op">(</span>GL_TEXTURE_2D<span class="op">);</span></span><span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to load texture"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>        stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>        <span class="co">//åŠ è½½è´´å›¾2</span></span><span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>        glGenTextures<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>texture2<span class="op">);</span></span><span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>        glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture2<span class="op">);</span></span><span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>        <span class="co">//  è®¾ç½® wrapping å‚æ•°</span></span><span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_S<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_T<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>        <span class="co">// è®¾ç½®  filtering å‚æ•°</span></span><span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MIN_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MAG_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>        <span class="co">// låŠ è½½è§£æè´´å›¾æ–‡ä»¶</span></span><span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> stbi_load<span class="op">(</span><span class="st">"./res/textures/awesomeface.png"</span><span class="op">,</span> <span class="op">&amp;</span>width<span class="op">,</span> <span class="op">&amp;</span>height<span class="op">,</span> <span class="op">&amp;</span>nrChannels<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>data<span class="op">)</span></span><span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>            <span class="co">//ç¬¬ä¸€ä¸ª GL_RGB å°†è¢«è½¬æ¢çš„æ ¼å¼ï¼Œ ç¬¬äºŒä¸ªGL_RGBåŸå§‹æ–‡ä»¶çš„æ ¼å¼ï¼Œ æ ¼å¼ä¸åŒ¹é…ä¼šæŠ¥é”™ã€‚</span></span><span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>            glTexImage2D<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGBA<span class="op">,</span> GL_UNSIGNED_BYTE<span class="op">,</span> data<span class="op">);</span></span><span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>            glGenerateMipmap<span class="op">(</span>GL_TEXTURE_2D<span class="op">);</span></span><span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to load texture"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>        stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>        <span class="co">//æŒ‡å®šé‡‡æ ·å™¨è´´å›¾å‚¨å­˜çš„ä½ç½®</span></span><span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>        shader<span class="op">.</span>use<span class="op">();</span></span><span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>        shader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"texture1"</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>        shader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"texture2"</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!</span>glfwWindowShouldClose<span class="op">(</span>window<span class="op">))</span></span><span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>            processInput<span class="op">(</span>window<span class="op">);</span></span><span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>            glClearColor<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>            glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT<span class="op">);</span></span><span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>            <span class="co">// bind Texture1</span></span><span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>            glActiveTexture<span class="op">(</span>GL_TEXTURE0<span class="op">);</span></span><span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>            glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture1<span class="op">);</span></span><span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>            <span class="co">// bind Texture2</span></span><span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>            glActiveTexture<span class="op">(</span>GL_TEXTURE1<span class="op">);</span></span><span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>            glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture2<span class="op">);</span></span><span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>            glm<span class="op">::</span>mat4 transform <span class="op">=</span> glm<span class="op">::</span>mat4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span> </span><span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>            transform <span class="op">=</span> glm<span class="op">::</span>translate<span class="op">(</span>transform<span class="op">,</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">));</span></span><span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>            transform <span class="op">=</span> glm<span class="op">::</span>rotate<span class="op">(</span>transform<span class="op">,</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>glfwGetTime<span class="op">(),</span> glm<span class="op">::</span>vec3<span class="op">(</span><span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">));</span></span><span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>            shader<span class="op">.</span>use<span class="op">();</span></span><span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>            <span class="dt">unsigned</span> <span class="dt">int</span> transformLoc <span class="op">=</span> glGetUniformLocation<span class="op">(</span>shader<span class="op">.</span>ID<span class="op">,</span> <span class="st">"transform"</span><span class="op">);</span></span><span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>            glUniformMatrix4fv<span class="op">(</span>transformLoc<span class="op">,</span> <span class="op">(</span><span class="dt">float</span><span class="op">)</span>glfwGetTime<span class="op">(),</span> GL_FALSE<span class="op">,</span> glm<span class="op">::</span>value_ptr<span class="op">(</span>transform<span class="op">));</span></span><span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>            glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>            glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">6</span><span class="op">,</span> GL_UNSIGNED_INT<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>            glfwSwapBuffers<span class="op">(</span>window<span class="op">);</span></span><span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>            glfwPollEvents<span class="op">();</span></span><span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>        glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>        glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>        glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>EBO<span class="op">);</span></span><span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>    TERMINATE<span class="op">:</span></span><span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>        glfwTerminate<span class="op">();</span></span><span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/01-ji-chu-bu-fen/4.tie-tu/"/>
      <url>/2022/08/10/opengl/01-ji-chu-bu-fen/4.tie-tu/</url>
      
        <content type="html"><![CDATA[<h2 id="è´´å›¾">è´´å›¾</h2><blockquote><p>ä½¿ç”¨è´´å›¾ï¼Œè´´å›¾è§£æä½¿ç”¨ std_image åº“</p></blockquote><ol type="1"><li>è´´å›¾è§£æåº“</li></ol><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define STB_IMAGE_IMPLEMENTATION</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"stb_image.h"</span></span></code></pre></div><ol start="2" type="1"><li>è´´å›¾è§£æå’ŒåŠ è½½</li></ol><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> texture1<span class="op">;</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">//1. åˆ›å»ºè´´å›¾id</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>glGenTextures<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>texture1<span class="op">);</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">//2. ç»‘å®šè´´å›¾idï¼Œä¸€ä¸‹æ“ä½œéƒ½æ˜¯é’ˆå¯¹æ­¤è´´å›¾</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture1<span class="op">);</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">//3. è®¾ç½®è´´å›¾å„ç§å±æ€§</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">//3.1 è®¾ç½®wrappingå‚æ•°</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_S<span class="op">,</span> GL_REPEAT<span class="op">);</span>  <span class="co">//è®¾ç½®ä¸ºé‡å¤æ ·å¼ï¼Œä¸å¤Ÿå°ºå¯¸åˆ™é‡å¤æ¥å¡«å……</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_T<span class="op">,</span> GL_REPEAT<span class="op">);</span>  <span class="co">//è®¾ç½®ä¸ºé‡å¤æ ·å¼ï¼Œä¸å¤Ÿå°ºå¯¸åˆ™é‡å¤æ¥å¡«å……</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">//3.2 è®¾ç½®filteræ»¤æ³¢</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MIN_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span><span class="co">//è®¾ç½®ä¸ºçº¿æ€§æ’å€¼</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MAG_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span><span class="co">//è®¾ç½®ä¸ºçº¿æ€§æ’å€¼</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">//ã€‚ã€‚ã€‚å…¶ä»–å‚æ•°è®¾ç½®</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">//4. åŠ è½½è§£æå›¾ç‰‡æ–‡ä»¶</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> width<span class="op">,</span> height<span class="op">,</span> nrChannels<span class="op">;</span> </span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">char</span><span class="op">*</span> data <span class="op">=</span> stbi_load<span class="op">(</span><span class="st">"./res/textures/container.jpg"</span><span class="op">,</span> <span class="op">&amp;</span>width<span class="op">,</span> <span class="op">&amp;</span>height<span class="op">,</span> <span class="op">&amp;</span>nrChannels<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>data<span class="op">)</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">//5. è§£ææˆåŠŸï¼Œè®¾ç½®è´´å›¾æ•°æ®ï¼Œ </span></span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ç¬¬ä¸€ä¸ª GL_RGB å°†è¢«è½¬æ¢çš„æ ¼å¼ï¼Œ ç¬¬äºŒä¸ªGL_RGBåŸå§‹æ–‡ä»¶çš„æ ¼å¼ï¼Œé€šé“æ•°å¯å°‘ä¸èƒ½å¤šï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</span></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    glTexImage2D<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> GL_UNSIGNED_BYTE<span class="op">,</span> data<span class="op">);</span></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    glGenerateMipmap<span class="op">(</span>GL_TEXTURE_2D<span class="op">);</span></span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to load texture"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="co">//6. è®¾ç½®å®Œè´´å›¾æ•°æ®ï¼Œåˆ™ä¸éœ€è¦å­—ç¬¦ä¸²æ•°æ®ï¼Œé‡Šæ”¾ã€‚</span></span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="co">//7. è‡³æ­¤è´´å›¾æ•°æ®å‡†å¤‡å®Œæ¯•ï¼Œä½¿ç”¨texture1è´´å›¾idå³å¯ã€‚</span></span></code></pre></div><ol start="3" type="1"><li>ä½¿ç”¨è´´å›¾ï¼Œéœ€è¦æ¸²æŸ“çš„shaderæ”¯æŒè´´å›¾ã€‚</li></ol><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">//æ¿€æ´»è´´å›¾GL_TEXTURE0ï¼Œç¬¬ä¸€ç»„è´´å›¾</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    glActiveTexture<span class="op">(</span>GL_TEXTURE0<span class="op">);</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ç»‘å®štexture1åˆ°ç¬¬ä¸€ç»„è´´å›¾</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture1<span class="op">);</span></span></code></pre></div><ol start="4" type="1"><li>è´´å›¾Shader<ol type="1"><li>é¡¶ç‚¹Shader</li></ol><div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">//locationå¯¹åº”é¡¶ç‚¹å±æ€§ä½ç½®ã€‚</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">0</span><span class="op">)</span> in vec3 aPos<span class="op">;</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">1</span><span class="op">)</span> in vec3 aColor<span class="op">;</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">2</span><span class="op">)</span> in vec2 aTexCoord<span class="op">;</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>out vec3 ourColor<span class="op">;</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>out vec2 TexCoord<span class="op">;</span></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> main<span class="op">()</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    gl_Position <span class="op">=</span> vec4<span class="op">(</span>aPos<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    ourColor <span class="op">=</span> aColor<span class="op">;</span></span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    TexCoord <span class="op">=</span> aTexCoord<span class="op">;</span></span><span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><ol start="2" type="1"><li>ç‰‡å…ƒShaderï¼Œ ä½¿ç”¨textureå‡½æ•°å¯¹è´´å›¾uvé‡‡æ ·ã€‚</li></ol><div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>out vec4 FragColor<span class="op">;</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>in vec3 ourColor<span class="op">;</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>in vec2 TexCoord<span class="op">;</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>uniform sampler2D ourTexture<span class="op">;</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> main<span class="op">()</span></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    FragColor <span class="op">=</span> texture<span class="op">(</span>ourTexture<span class="op">,</span> TexCoord<span class="op">);</span></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li><li>å¯ä»¥ä½¿ç”¨å¤šå¼ çº¹ç†,Shaderä½¿ç”¨ mixå‡½æ•°æ··åˆï¼Œ</li></ol><div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// åœ¨ç»‘å®šçº¹ç†ä¹‹å‰å…ˆæ¿€æ´»ä½ç½®çº¹ç†å•å…ƒ</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    glActiveTexture<span class="op">(</span>GL_TEXTURE0<span class="op">);</span> </span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture<span class="op">);</span></span></code></pre></div><pre><code>1. å¤šå¼ çº¹ç†çš„ç‰‡å…ƒShader</code></pre><div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    out vec4 FragColor<span class="op">;</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    in vec3 ourColor<span class="op">;</span></span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    in vec2 TexCoord<span class="op">;</span></span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    uniform sampler2D texture1<span class="op">;</span></span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    uniform sampler2D texture2<span class="op">;</span></span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> main<span class="op">()</span></span><span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        FragColor <span class="op">=</span> mix<span class="op">(</span>texture<span class="op">(</span>texture1<span class="op">,</span> TexCoord<span class="op">),</span> texture<span class="op">(</span>texture2<span class="op">,</span> TexCoord<span class="op">),</span> <span class="fl">0.2</span><span class="op">);</span></span><span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><pre><code>2. è¿˜è¦é€šè¿‡ä½¿ç”¨glUniform1iè®¾ç½®æ¯ä¸ªé‡‡æ ·å™¨çš„æ–¹å¼å‘Šè¯‰OpenGLæ¯ä¸ªç€è‰²å™¨é‡‡æ ·å™¨å±äºå“ªä¸ªçº¹ç†å•å…ƒã€‚æˆ‘ä»¬åªéœ€è¦è®¾ç½®ä¸€æ¬¡å³å¯    &gt; textureè´´å›¾ä¸åŒäºå…¶ä»–`Uniform`å‚æ•°ï¼Œå› ä¸ºæ•°æ®åœ¨GPU,ä¸èƒ½ç›´æ¥è®¾ç½®å€¼ï¼Œ    &gt; éœ€è¦æŒ‡å®š`ä½ç½®å€¼`ï¼Œç„¶åé€šè¿‡`glActiveTexture(GL_TEXTURE1)`å‡½æ•°æ¿€æ´»å¯¹åº”ä½ç½®;    &gt; ä½¿ç”¨`glBindTexture(GL_TEXTURE_2D, texture1)`å‡½æ•°æŒ‡å®šè´´å›¾å€¼;</code></pre><div class="sourceCode" id="cb10"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">//glUniform1i</span></span><span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>shader<span class="op">.</span>use<span class="op">();</span></span><span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">//glUniform1i(glGetUniformLocation(ourShader.ID, "texture1"), 0); // æ‰‹åŠ¨è®¾ç½®</span></span><span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>shader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"texture1"</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>shader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"texture2"</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span></code></pre></div><pre><code>3. ä½¿ç”¨å¤šå¼ è´´å›¾</code></pre><div class="sourceCode" id="cb12"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>    glActiveTexture<span class="op">(</span>GL_TEXTURE0<span class="op">);</span></span><span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture1<span class="op">);</span></span><span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    glActiveTexture<span class="op">(</span>GL_TEXTURE1<span class="op">);</span></span><span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture2<span class="op">);</span></span></code></pre></div><ol start="6" type="1"><li>é‡è¦æ¦‚å¿µ&amp;å‚æ•°<ol type="1"><li>çº¹ç†ç¯ç»•æ–¹å¼ Wrapping &gt; é€šè¿‡<code>glTexParameterfv</code>å‡½æ•°è®¾ç½® |ç¯ç»•æ–¹å¼ | æè¿°| |:--|:--||GL_REPEAT |å¯¹çº¹ç†çš„é»˜è®¤è¡Œä¸ºã€‚é‡å¤çº¹ç†å›¾åƒã€‚| |GL_MIRRORED_REPEAT |å’ŒGL_REPEATä¸€æ ·ï¼Œä½†æ¯æ¬¡é‡å¤å›¾ç‰‡æ˜¯é•œåƒæ”¾ç½®çš„ã€‚| |GL_CLAMP_TO_EDGE |çº¹ç†åæ ‡ä¼šè¢«çº¦æŸåœ¨0åˆ°1ä¹‹é—´ï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šé‡å¤çº¹ç†åæ ‡çš„è¾¹ç¼˜ï¼Œäº§ç”Ÿä¸€ç§è¾¹ç¼˜è¢«æ‹‰ä¼¸çš„æ•ˆæœã€‚||GL_CLAMP_TO_BORDER | è¶…å‡ºçš„åæ ‡ä¸ºç”¨æˆ·æŒ‡å®šçš„è¾¹ç¼˜é¢œè‰²ã€‚|</li><li>çº¹ç†è¿‡æ»¤ filter (GL_TEXTURE_MIN_FILTER æ¸è¿›ï¼ŒGL_TEXTURE_MAG_FILTERæ¸è¿œ)<ol type="1"><li>GL_NEAREST GL_NEARESTï¼ˆä¹Ÿå«é‚»è¿‘è¿‡æ»¤ï¼ŒNearest NeighborFilteringï¼‰æ˜¯OpenGLé»˜è®¤çš„çº¹ç†è¿‡æ»¤æ–¹å¼ã€‚å½“è®¾ç½®ä¸ºGL_NEARESTçš„æ—¶å€™ï¼ŒOpenGLä¼šé€‰æ‹©ä¸­å¿ƒç‚¹æœ€æ¥è¿‘çº¹ç†åæ ‡çš„é‚£ä¸ªåƒç´ ã€‚ä¸‹å›¾ä¸­ä½ å¯ä»¥çœ‹åˆ°å››ä¸ªåƒç´ ï¼ŒåŠ å·ä»£è¡¨çº¹ç†åæ ‡ã€‚å·¦ä¸Šè§’é‚£ä¸ªçº¹ç†åƒç´ çš„ä¸­å¿ƒè·ç¦»çº¹ç†åæ ‡æœ€è¿‘ï¼Œæ‰€ä»¥å®ƒä¼šè¢«é€‰æ‹©ä¸ºæ ·æœ¬é¢œè‰²ï¼š</li><li>GL_LINEAR GL_LINEARï¼ˆä¹Ÿå«çº¿æ€§è¿‡æ»¤ï¼Œ(Bi)linearFilteringï¼‰å®ƒä¼šåŸºäºçº¹ç†åæ ‡é™„è¿‘çš„çº¹ç†åƒç´ ï¼Œè®¡ç®—å‡ºä¸€ä¸ªæ’å€¼ï¼Œè¿‘ä¼¼å‡ºè¿™äº›çº¹ç†åƒç´ ä¹‹é—´çš„é¢œè‰²ã€‚ä¸€ä¸ªçº¹ç†åƒç´ çš„ä¸­å¿ƒè·ç¦»çº¹ç†åæ ‡è¶Šè¿‘ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¹ç†åƒç´ çš„é¢œè‰²å¯¹æœ€ç»ˆçš„æ ·æœ¬é¢œè‰²çš„è´¡çŒ®è¶Šå¤§ã€‚ä¸‹å›¾ä¸­ä½ å¯ä»¥çœ‹åˆ°è¿”å›çš„é¢œè‰²æ˜¯é‚»è¿‘åƒç´ çš„æ··åˆè‰²ï¼š</li></ol></li><li>å¤šçº§æ¸è¿œçº¹ç† Mipmap ï¼ˆGL_TEXTURE_MIN_FILTER æ¸è¿‘ï¼Œæ¸è¿œæ— ç”¨ä¼šäº§ç”Ÿé”™è¯¯ç ï¼‰å¤šçº§æ¸è¿œçº¹ç†èƒŒåçš„ç†å¿µå¾ˆç®€å•ï¼šè·è§‚å¯Ÿè€…çš„è·ç¦»è¶…è¿‡ä¸€å®šçš„é˜ˆå€¼ï¼ŒOpenGLä¼šä½¿ç”¨ä¸åŒçš„å¤šçº§æ¸è¿œçº¹ç†ï¼Œå³æœ€é€‚åˆç‰©ä½“çš„è·ç¦»çš„é‚£ä¸ªã€‚&gt;ä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯ï¼Œå°†æ”¾å¤§è¿‡æ»¤çš„é€‰é¡¹è®¾ç½®ä¸ºå¤šçº§æ¸è¿œçº¹ç†è¿‡æ»¤é€‰é¡¹ä¹‹ä¸€ã€‚è¿™æ ·æ²¡æœ‰ä»»ä½•æ•ˆæœï¼Œå› ä¸ºå¤šçº§æ¸è¿œçº¹ç†ä¸»è¦æ˜¯ä½¿ç”¨åœ¨çº¹ç†è¢«ç¼©å°çš„æƒ…å†µä¸‹çš„ï¼šçº¹ç†æ”¾å¤§ä¸ä¼šä½¿ç”¨å¤šçº§æ¸è¿œçº¹ç†ï¼Œä¸ºæ”¾å¤§è¿‡æ»¤è®¾ç½®å¤šçº§æ¸è¿œçº¹&gt;ç†çš„é€‰é¡¹ä¼šäº§ç”Ÿä¸€ä¸ªGL_INVALID_ENUMé”™è¯¯ä»£ç ã€‚ |è¿‡æ»¤æ–¹å¼ | æè¿°||:--|:--| |GL_NEAREST_MIPMAP_NEAREST |ä½¿ç”¨æœ€é‚»è¿‘çš„å¤šçº§æ¸è¿œçº¹ç†æ¥åŒ¹é…åƒç´ å¤§å°ï¼Œå¹¶ä½¿ç”¨é‚»è¿‘æ’å€¼è¿›è¡Œçº¹ç†é‡‡æ ·||GL_LINEAR_MIPMAP_NEAREST|ä½¿ç”¨æœ€é‚»è¿‘çš„å¤šçº§æ¸è¿œçº¹ç†çº§åˆ«ï¼Œå¹¶ä½¿ç”¨çº¿æ€§æ’å€¼è¿›è¡Œé‡‡æ ·||GL_NEAREST_MIPMAP_LINEAR|åœ¨ä¸¤ä¸ªæœ€åŒ¹é…åƒç´ å¤§å°çš„å¤šçº§æ¸è¿œçº¹ç†ä¹‹é—´è¿›è¡Œçº¿æ€§æ’å€¼ï¼Œä½¿ç”¨é‚»è¿‘æ’å€¼è¿›è¡Œé‡‡æ ·||GL_LINEAR_MIPMAP_LINEAR|åœ¨ä¸¤ä¸ªé‚»è¿‘çš„å¤šçº§æ¸è¿œçº¹ç†ä¹‹é—´ä½¿ç”¨çº¿æ€§æ’å€¼ï¼Œå¹¶ä½¿ç”¨çº¿æ€§æ’å€¼è¿›è¡Œé‡‡æ ·|</li><li>åŠ è½½å›¾åƒ api<ol type="1"><li>stbi_load åŠ è½½</li><li>stbi_set_flip_vertically_on_load(true) ã€è®¾ç½®ä¸ºç«–ç›´ç¿»è½¬ã€‚</li></ol></li></ol></li><li>å®Œæ•´ä»£ç </li></ol><div class="sourceCode" id="cb13"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"glad/glad.h"</span></span><span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"GLFW/glfw3.h"</span></span><span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//å›¾ç‰‡åº“</span></span><span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#define STB_IMAGE_IMPLEMENTATION</span></span><span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"stb_image.h"</span></span><span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">//glm OpenGL Mathåº“</span></span><span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"glm/glm.hpp"</span></span><span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"glm/gtc/matrix_transform.hpp"</span></span><span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"glm/gtc/type_ptr.hpp"</span></span><span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"shader.h"</span></span><span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span><span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span><span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">int</span> wWidth <span class="op">=</span> <span class="dv">800</span><span class="op">,</span> wHeight <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span><span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> wName <span class="op">=</span> <span class="st">"LearnOpenGL"</span><span class="op">;</span></span><span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> vertices<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">//ä½ç½®                    // åŸºç¡€é¢œè‰²          // é¢˜å›¾uv</span></span><span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// top right</span></span><span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>            <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom right</span></span><span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>           <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="co">// bottom left</span></span><span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>           <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>   <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span>  <span class="co">// top left </span></span><span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> indices<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span><span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>        <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="co">//  ç¬¬ä¸€ä¸ªä¸‰è§’å½¢</span></span><span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>        <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span>  <span class="co">//  ç¬¬äºŒä¸ªä¸‰è§’å½¢</span></span><span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">)</span></span><span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>        glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height<span class="op">);</span></span><span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">)</span></span><span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_ESCAPE<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>            glfwSetWindowShouldClose<span class="op">(</span>window<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span><span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> main<span class="op">()</span></span><span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>        <span class="co">//1. åˆå§‹åŒ–</span></span><span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwInit<span class="op">()</span> <span class="op">==</span> GLFW_FALSE<span class="op">)</span></span><span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>            cout <span class="op">&lt;&lt;</span> <span class="st">"init glfw fail"</span><span class="op">;</span></span><span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>        <span class="co">//2. åŸºæœ¬è®¾ç½®</span></span><span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_OPENGL_PROFILE<span class="op">,</span> GLFW_OPENGL_CORE_PROFILE<span class="op">);</span></span><span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if __APPLE__</span></span><span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_OPENGL_FORWARD_COMPAT<span class="op">,</span> GLFW_TRUE<span class="op">);</span></span><span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span><span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">//3. åˆ›å»ºçª—å£</span></span><span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>        GLFWwindow <span class="op">*</span>window <span class="op">=</span> glfwCreateWindow<span class="op">(</span>wWidth<span class="op">,</span> wHeight<span class="op">,</span> wName<span class="op">,</span> <span class="kw">nullptr</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span><span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>window <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span></span><span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>            cout <span class="op">&lt;&lt;</span> <span class="st">"Failed to create GLFW window"</span><span class="op">;</span></span><span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>            <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>            <span class="co">//return 1;</span></span><span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">//4. å½“å‰ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡çª—å£</span></span><span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>        glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span><span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>        <span class="co">//5. ä½¿ç”¨gladç®¡ç†OpenGLæŒ‡é’ˆã€‚</span></span><span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>gladLoadGLLoader<span class="op">((</span>GLADloadproc<span class="op">)</span>glfwGetProcAddress<span class="op">))</span></span><span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to initialize GLAD"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>            <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>            <span class="co">//return 1;</span></span><span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>        <span class="co">//6. è®¾ç½®è§†å£</span></span><span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>        glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> wWidth<span class="op">,</span> wHeight<span class="op">);</span></span><span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>        <span class="co">//7. è®¾ç½®resizeå›è°ƒï¼Œå¯¹åº”åˆ·æ–°è§†å£</span></span><span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>        glfwSetFramebufferSizeCallback<span class="op">(</span>window<span class="op">,</span> framebuffer_size_callback<span class="op">);</span></span><span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>        Shader shader<span class="op">(</span><span class="st">"res/shaders/sample_vertex_texture.shader"</span><span class="op">,</span> <span class="st">"res/shaders/sample_fragment_2texture.shader"</span><span class="op">);</span></span><span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> VBO<span class="op">,</span> VAO<span class="op">,</span> EBO<span class="op">;</span></span><span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>        glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>        glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>        glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>vertices<span class="op">),</span> vertices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>        glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>EBO<span class="op">);</span></span><span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> EBO<span class="op">);</span></span><span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>        glBufferData<span class="op">(</span>GL_ELEMENT_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>indices<span class="op">),</span> indices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>        <span class="co">//1. æŒ‡å®šé¡¶ç‚¹çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œé¡¶ç‚¹ 3ä¸ªfloatï¼Œä»0å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>        <span class="co">//2. æŒ‡å®šé¢œè‰²çš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œä¸‰è‰² 3ä¸ªfloatï¼Œä»3å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span><span id="cb13-109"><a href="#cb13-109" aria-hidden="true" tabindex="-1"></a>        <span class="co">//3. æŒ‡å®šuvçš„é¡¶ç‚¹å±æ€§çš„ç»“æ„ï¼Œuv 2ä¸ªfloatï¼Œä»6å¼€å§‹ï¼Œæ•´ä½“æ¯ä¸€ç»„æ•°æ®8ä¸ªã€‚</span></span><span id="cb13-110"><a href="#cb13-110" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> GL_FALSE<span class="op">,</span> <span class="dv">8</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)(</span><span class="dv">6</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">)));</span></span><span id="cb13-111"><a href="#cb13-111" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">2</span><span class="op">);</span></span><span id="cb13-112"><a href="#cb13-112" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-113"><a href="#cb13-113" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb13-114"><a href="#cb13-114" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb13-115"><a href="#cb13-115" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-116"><a href="#cb13-116" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-117"><a href="#cb13-117" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> texture1<span class="op">,</span> texture2<span class="op">;</span></span><span id="cb13-118"><a href="#cb13-118" aria-hidden="true" tabindex="-1"></a>        <span class="co">//åŠ è½½è´´å›¾1</span></span><span id="cb13-119"><a href="#cb13-119" aria-hidden="true" tabindex="-1"></a>        glGenTextures<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>texture1<span class="op">);</span></span><span id="cb13-120"><a href="#cb13-120" aria-hidden="true" tabindex="-1"></a>        glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture1<span class="op">);</span></span><span id="cb13-121"><a href="#cb13-121" aria-hidden="true" tabindex="-1"></a>        <span class="co">// è®¾ç½® wrapping å‚æ•°</span></span><span id="cb13-122"><a href="#cb13-122" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_S<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb13-123"><a href="#cb13-123" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_T<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb13-124"><a href="#cb13-124" aria-hidden="true" tabindex="-1"></a>        <span class="co">// è®¾ç½®  filtering å‚æ•°</span></span><span id="cb13-125"><a href="#cb13-125" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MIN_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb13-126"><a href="#cb13-126" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MAG_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb13-127"><a href="#cb13-127" aria-hidden="true" tabindex="-1"></a>        <span class="co">// åŠ è½½è§£æè´´å›¾æ–‡ä»¶</span></span><span id="cb13-128"><a href="#cb13-128" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> width<span class="op">,</span> height<span class="op">,</span> nrChannels<span class="op">;</span></span><span id="cb13-129"><a href="#cb13-129" aria-hidden="true" tabindex="-1"></a>        stbi_set_flip_vertically_on_load<span class="op">(</span><span class="kw">true</span><span class="op">);</span> <span class="co">// tell stb_image.h to flip loaded texture's on the y-axis.</span></span><span id="cb13-130"><a href="#cb13-130" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">char</span><span class="op">*</span> data <span class="op">=</span> stbi_load<span class="op">(</span><span class="st">"./res/textures/container.jpg"</span><span class="op">,</span> <span class="op">&amp;</span>width<span class="op">,</span> <span class="op">&amp;</span>height<span class="op">,</span> <span class="op">&amp;</span>nrChannels<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb13-131"><a href="#cb13-131" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>data<span class="op">)</span></span><span id="cb13-132"><a href="#cb13-132" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb13-133"><a href="#cb13-133" aria-hidden="true" tabindex="-1"></a>            <span class="co">//ç¬¬ä¸€ä¸ª GL_RGB å°†è¢«è½¬æ¢çš„æ ¼å¼ï¼Œ ç¬¬äºŒä¸ªGL_RGBåŸå§‹æ–‡ä»¶çš„æ ¼å¼ï¼Œ æ ¼å¼ä¸åŒ¹é…ä¼šæŠ¥é”™ã€‚</span></span><span id="cb13-134"><a href="#cb13-134" aria-hidden="true" tabindex="-1"></a>            glTexImage2D<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> GL_UNSIGNED_BYTE<span class="op">,</span> data<span class="op">);</span></span><span id="cb13-135"><a href="#cb13-135" aria-hidden="true" tabindex="-1"></a>            glGenerateMipmap<span class="op">(</span>GL_TEXTURE_2D<span class="op">);</span></span><span id="cb13-136"><a href="#cb13-136" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb13-137"><a href="#cb13-137" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb13-138"><a href="#cb13-138" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb13-139"><a href="#cb13-139" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to load texture"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb13-140"><a href="#cb13-140" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb13-141"><a href="#cb13-141" aria-hidden="true" tabindex="-1"></a>        stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb13-142"><a href="#cb13-142" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-143"><a href="#cb13-143" aria-hidden="true" tabindex="-1"></a>        <span class="co">//åŠ è½½è´´å›¾2</span></span><span id="cb13-144"><a href="#cb13-144" aria-hidden="true" tabindex="-1"></a>        glGenTextures<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>texture2<span class="op">);</span></span><span id="cb13-145"><a href="#cb13-145" aria-hidden="true" tabindex="-1"></a>        glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture2<span class="op">);</span></span><span id="cb13-146"><a href="#cb13-146" aria-hidden="true" tabindex="-1"></a>        <span class="co">//  è®¾ç½® wrapping å‚æ•°</span></span><span id="cb13-147"><a href="#cb13-147" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_S<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb13-148"><a href="#cb13-148" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_WRAP_T<span class="op">,</span> GL_REPEAT<span class="op">);</span></span><span id="cb13-149"><a href="#cb13-149" aria-hidden="true" tabindex="-1"></a>        <span class="co">// è®¾ç½®  filtering å‚æ•°</span></span><span id="cb13-150"><a href="#cb13-150" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MIN_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb13-151"><a href="#cb13-151" aria-hidden="true" tabindex="-1"></a>        glTexParameteri<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> GL_TEXTURE_MAG_FILTER<span class="op">,</span> GL_LINEAR<span class="op">);</span></span><span id="cb13-152"><a href="#cb13-152" aria-hidden="true" tabindex="-1"></a>        <span class="co">// låŠ è½½è§£æè´´å›¾æ–‡ä»¶</span></span><span id="cb13-153"><a href="#cb13-153" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> stbi_load<span class="op">(</span><span class="st">"./res/textures/awesomeface.png"</span><span class="op">,</span> <span class="op">&amp;</span>width<span class="op">,</span> <span class="op">&amp;</span>height<span class="op">,</span> <span class="op">&amp;</span>nrChannels<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb13-154"><a href="#cb13-154" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>data<span class="op">)</span></span><span id="cb13-155"><a href="#cb13-155" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb13-156"><a href="#cb13-156" aria-hidden="true" tabindex="-1"></a>            <span class="co">//ç¬¬ä¸€ä¸ª GL_RGB å°†è¢«è½¬æ¢çš„æ ¼å¼ï¼Œ ç¬¬äºŒä¸ªGL_RGBåŸå§‹æ–‡ä»¶çš„æ ¼å¼ï¼Œ æ ¼å¼ä¸åŒ¹é…ä¼šæŠ¥é”™ã€‚</span></span><span id="cb13-157"><a href="#cb13-157" aria-hidden="true" tabindex="-1"></a>            glTexImage2D<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGB<span class="op">,</span> width<span class="op">,</span> height<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> GL_RGBA<span class="op">,</span> GL_UNSIGNED_BYTE<span class="op">,</span> data<span class="op">);</span></span><span id="cb13-158"><a href="#cb13-158" aria-hidden="true" tabindex="-1"></a>            glGenerateMipmap<span class="op">(</span>GL_TEXTURE_2D<span class="op">);</span></span><span id="cb13-159"><a href="#cb13-159" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb13-160"><a href="#cb13-160" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb13-161"><a href="#cb13-161" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb13-162"><a href="#cb13-162" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to load texture"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb13-163"><a href="#cb13-163" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb13-164"><a href="#cb13-164" aria-hidden="true" tabindex="-1"></a>        stbi_image_free<span class="op">(</span>data<span class="op">);</span></span><span id="cb13-165"><a href="#cb13-165" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-166"><a href="#cb13-166" aria-hidden="true" tabindex="-1"></a>        <span class="co">//æŒ‡å®šé‡‡æ ·å™¨è´´å›¾å‚¨å­˜çš„ä½ç½®</span></span><span id="cb13-167"><a href="#cb13-167" aria-hidden="true" tabindex="-1"></a>        shader<span class="op">.</span>use<span class="op">();</span></span><span id="cb13-168"><a href="#cb13-168" aria-hidden="true" tabindex="-1"></a>        shader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"texture1"</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb13-169"><a href="#cb13-169" aria-hidden="true" tabindex="-1"></a>        shader<span class="op">.</span>setInt<span class="op">(</span><span class="st">"texture2"</span><span class="op">,</span> <span class="dv">1</span><span class="op">);</span></span><span id="cb13-170"><a href="#cb13-170" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-171"><a href="#cb13-171" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!</span>glfwWindowShouldClose<span class="op">(</span>window<span class="op">))</span></span><span id="cb13-172"><a href="#cb13-172" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb13-173"><a href="#cb13-173" aria-hidden="true" tabindex="-1"></a>            processInput<span class="op">(</span>window<span class="op">);</span></span><span id="cb13-174"><a href="#cb13-174" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-175"><a href="#cb13-175" aria-hidden="true" tabindex="-1"></a>            glClearColor<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb13-176"><a href="#cb13-176" aria-hidden="true" tabindex="-1"></a>            glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT<span class="op">);</span></span><span id="cb13-177"><a href="#cb13-177" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-178"><a href="#cb13-178" aria-hidden="true" tabindex="-1"></a>            <span class="co">// bind Texture1</span></span><span id="cb13-179"><a href="#cb13-179" aria-hidden="true" tabindex="-1"></a>            glActiveTexture<span class="op">(</span>GL_TEXTURE0<span class="op">);</span></span><span id="cb13-180"><a href="#cb13-180" aria-hidden="true" tabindex="-1"></a>            glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture1<span class="op">);</span></span><span id="cb13-181"><a href="#cb13-181" aria-hidden="true" tabindex="-1"></a>            <span class="co">// bind Texture2</span></span><span id="cb13-182"><a href="#cb13-182" aria-hidden="true" tabindex="-1"></a>            glActiveTexture<span class="op">(</span>GL_TEXTURE1<span class="op">);</span></span><span id="cb13-183"><a href="#cb13-183" aria-hidden="true" tabindex="-1"></a>            glBindTexture<span class="op">(</span>GL_TEXTURE_2D<span class="op">,</span> texture2<span class="op">);</span></span><span id="cb13-184"><a href="#cb13-184" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-185"><a href="#cb13-185" aria-hidden="true" tabindex="-1"></a>            shader<span class="op">.</span>use<span class="op">();</span></span><span id="cb13-186"><a href="#cb13-186" aria-hidden="true" tabindex="-1"></a>            glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb13-187"><a href="#cb13-187" aria-hidden="true" tabindex="-1"></a>            glDrawElements<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">6</span><span class="op">,</span> GL_UNSIGNED_INT<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb13-188"><a href="#cb13-188" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-189"><a href="#cb13-189" aria-hidden="true" tabindex="-1"></a>            glfwSwapBuffers<span class="op">(</span>window<span class="op">);</span></span><span id="cb13-190"><a href="#cb13-190" aria-hidden="true" tabindex="-1"></a>            glfwPollEvents<span class="op">();</span></span><span id="cb13-191"><a href="#cb13-191" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb13-192"><a href="#cb13-192" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-193"><a href="#cb13-193" aria-hidden="true" tabindex="-1"></a>        glDeleteVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb13-194"><a href="#cb13-194" aria-hidden="true" tabindex="-1"></a>        glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb13-195"><a href="#cb13-195" aria-hidden="true" tabindex="-1"></a>        glDeleteBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>EBO<span class="op">);</span></span><span id="cb13-196"><a href="#cb13-196" aria-hidden="true" tabindex="-1"></a></span><span id="cb13-197"><a href="#cb13-197" aria-hidden="true" tabindex="-1"></a>    TERMINATE<span class="op">:</span></span><span id="cb13-198"><a href="#cb13-198" aria-hidden="true" tabindex="-1"></a>        glfwTerminate<span class="op">();</span></span><span id="cb13-199"><a href="#cb13-199" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb13-200"><a href="#cb13-200" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/01-ji-chu-bu-fen/3.zhao-se-qi-glsl/"/>
      <url>/2022/08/10/opengl/01-ji-chu-bu-fen/3.zhao-se-qi-glsl/</url>
      
        <content type="html"><![CDATA[<h2 id="glsl">glsl</h2><blockquote><p>ç€è‰²å™¨æ˜¯ä½¿ç”¨ä¸€ç§å«GLSLçš„ç±»Cè¯­è¨€å†™æˆçš„ã€‚GLSLæ˜¯ä¸ºå›¾å½¢è®¡ç®—é‡èº«å®šåˆ¶çš„ï¼Œå®ƒåŒ…å«ä¸€äº›é’ˆå¯¹å‘é‡å’ŒçŸ©é˜µæ“ä½œçš„æœ‰ç”¨ç‰¹æ€§ã€‚ç€è‰²å™¨çš„å¼€å¤´æ€»æ˜¯è¦å£°æ˜ç‰ˆæœ¬ï¼Œæ¥ç€æ˜¯è¾“å…¥å’Œè¾“å‡ºå˜é‡ã€uniformå’Œmainå‡½æ•°ã€‚æ¯ä¸ªç€è‰²å™¨çš„å…¥å£ç‚¹éƒ½æ˜¯mainå‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­æˆ‘ä»¬å¤„ç†æ‰€æœ‰çš„è¾“å…¥å˜é‡ï¼Œå¹¶å°†ç»“æœè¾“å‡ºåˆ°è¾“å‡ºå˜é‡ä¸­ã€‚å¦‚æœä½ ä¸çŸ¥é“ä»€ä¹ˆæ˜¯uniformä¹Ÿä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬åé¢ä¼šè¿›è¡Œè®²è§£ã€‚</p><p>glfwGetTime()è·å–è¿è¡Œçš„ç§’æ•°</p></blockquote><ol type="1"><li>åŸºæœ¬ç»“æ„</li></ol><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#</span><span class="er">version version_number</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>in type in_variable_name<span class="op">;</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>in type in_variable_name<span class="op">;</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>out type out_variable_name<span class="op">;</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>uniform type uniform_name<span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// å¤„ç†è¾“å…¥å¹¶è¿›è¡Œä¸€äº›å›¾å½¢æ“ä½œ</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// è¾“å‡ºå¤„ç†è¿‡çš„ç»“æœåˆ°è¾“å‡ºå˜é‡</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  out_variable_name <span class="op">=</span> weird_stuff_we_processed<span class="op">;</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><ol start="2" type="1"><li>æ”¯æŒçš„åŸºæœ¬æ•°æ®ç±»å‹</li></ol><table><thead><tr class="header"><th style="text-align: left;">ç±»å‹</th><th style="text-align: left;">å«ä¹‰</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">vecn</td><td style="text-align: left;">åŒ…å«nä¸ªfloatåˆ†é‡çš„é»˜è®¤å‘é‡</td></tr><tr class="even"><td style="text-align: left;">bvecn</td><td style="text-align: left;">åŒ…å«nä¸ªboolåˆ†é‡çš„å‘é‡</td></tr><tr class="odd"><td style="text-align: left;">ivecn</td><td style="text-align: left;">åŒ…å«nä¸ªintåˆ†é‡çš„å‘é‡</td></tr><tr class="even"><td style="text-align: left;">uvecn</td><td style="text-align: left;">åŒ…å«nä¸ªunsigned intåˆ†é‡çš„å‘é‡</td></tr><tr class="odd"><td style="text-align: left;">dvecn</td><td style="text-align: left;">åŒ…å«nä¸ªdoubleåˆ†é‡çš„å‘é‡</td></tr></tbody></table><ol start="3" type="1"><li><p>Shaderæ•°æ®æ¥æºå’Œè¾“å‡º &gt;è™½ç„¶ç€è‰²å™¨æ˜¯å„è‡ªç‹¬ç«‹çš„å°ç¨‹åºï¼Œä½†æ˜¯å®ƒä»¬éƒ½æ˜¯ä¸€ä¸ªæ•´ä½“çš„ä¸€éƒ¨åˆ†ï¼Œå‡ºäºè¿™æ ·çš„åŸå› ï¼Œ&gt;æˆ‘ä»¬å¸Œæœ›æ¯ä¸ªç€è‰²å™¨éƒ½æœ‰è¾“å…¥å’Œè¾“å‡ºï¼Œè¿™æ ·æ‰èƒ½è¿›è¡Œæ•°æ®äº¤æµå’Œä¼ é€’ã€‚GLSLå®šä¹‰äº†inå’Œoutå…³é”®å­—ä¸“é—¨æ¥å®ç°è¿™ä¸ªç›®çš„ã€‚</p><ul><li><p>Uniform &gt;Uniformæ˜¯ä¸€ç§ä»CPUä¸­çš„åº”ç”¨å‘GPUä¸­çš„ç€è‰²å™¨å‘é€æ•°æ®çš„æ–¹å¼ï¼Œä½†uniformå’Œé¡¶ç‚¹å±æ€§æœ‰äº›ä¸åŒã€‚é¦–å…ˆï¼Œuniformæ˜¯å…¨å±€çš„(Global)ã€‚&gt;å…¨å±€æ„å‘³ç€uniformå˜é‡å¿…é¡»åœ¨æ¯ä¸ªç€è‰²å™¨ç¨‹åºå¯¹è±¡ä¸­éƒ½æ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œè€Œä¸”å®ƒå¯ä»¥è¢«ç€è‰²å™¨ç¨‹åºçš„ä»»æ„ç€è‰²å™¨åœ¨ä»»æ„é˜¶æ®µè®¿é—®ã€‚&gt;ç¬¬äºŒï¼Œæ— è®ºä½ æŠŠuniformå€¼è®¾ç½®æˆä»€ä¹ˆï¼Œuniformä¼šä¸€ç›´ä¿å­˜å®ƒä»¬çš„æ•°æ®ï¼Œç›´åˆ°å®ƒä»¬è¢«é‡ç½®æˆ–æ›´æ–°ã€‚</p><ul><li>glGetUniformLocationæŸ¥è¯¢uniform ä½ç½®å€¼</li><li>glUniformxx ç»™ä½ç½®çš„è®¾ç½®å€¼</li></ul></li><li><p>OpenGLå‡½æ•°å‘½åçº¦å®š</p></li></ul></li></ol><table><thead><tr class="header"><th style="text-align: left;">f</th><th style="text-align: left;">å‡½æ•°éœ€è¦ä¸€ä¸ªfloatä½œä¸ºå®ƒçš„å€¼</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">i</td><td style="text-align: left;">å‡½æ•°éœ€è¦ä¸€ä¸ªintä½œä¸ºå®ƒçš„å€¼</td></tr><tr class="even"><td style="text-align: left;">ui</td><td style="text-align: left;">å‡½æ•°éœ€è¦ä¸€ä¸ªunsigned intä½œä¸ºå®ƒçš„å€¼</td></tr><tr class="odd"><td style="text-align: left;">3f</td><td style="text-align: left;">å‡½æ•°éœ€è¦3ä¸ªfloatä½œä¸ºå®ƒçš„å€¼</td></tr><tr class="even"><td style="text-align: left;">fv</td><td style="text-align: left;">å‡½æ•°éœ€è¦ä¸€ä¸ªfloatå‘é‡/æ•°ç»„ä½œä¸ºå®ƒçš„å€¼</td></tr></tbody></table><ul><li>ç€è‰²å™¨ç±» &gt; åŠŸèƒ½ï¼š åŠ è½½ç€è‰²å™¨ï¼Œè·å–å’Œè®¾ç½®å±æ€§å€¼ã€‚è¾…åŠ©æ–‡ä»¶è¯»å†™ç±»</li></ul><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef SHADER_H</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define SHADER_H</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;glad/glad.h&gt;</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string&gt;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fstream&gt;</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sstream&gt;</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Shader</span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span><span class="op">:</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> ID<span class="op">;</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// constructor generates the shader on the fly</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ------------------------------------------------------------------------</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>    Shader<span class="op">(</span><span class="at">const</span> <span class="dt">char</span><span class="op">*</span> vertexPath<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> fragmentPath<span class="op">)</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 1. retrieve the vertex/fragment source code from filePath</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op"> </span>vertexCode<span class="op">;</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>string<span class="op"> </span>fragmentCode<span class="op">;</span></span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>ifstream<span class="op"> </span>vShaderFile<span class="op">;</span></span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>ifstream<span class="op"> </span>fShaderFile<span class="op">;</span></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// ensure ifstream objects can throw exceptions:</span></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>        vShaderFile<span class="op">.</span>exceptions<span class="op">(</span><span class="bu">std::</span>ifstream<span class="bu">::</span>failbit<span class="op"> |</span> <span class="bu">std::</span>ifstream<span class="bu">::</span>badbit<span class="op">);</span></span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        fShaderFile<span class="op">.</span>exceptions<span class="op">(</span><span class="bu">std::</span>ifstream<span class="bu">::</span>failbit<span class="op"> |</span> <span class="bu">std::</span>ifstream<span class="bu">::</span>badbit<span class="op">);</span></span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span></span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>            <span class="co">// open files</span></span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>            vShaderFile<span class="op">.</span>open<span class="op">(</span>vertexPath<span class="op">);</span></span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>            fShaderFile<span class="op">.</span>open<span class="op">(</span>fragmentPath<span class="op">);</span></span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>stringstream<span class="op"> </span>vShaderStream<span class="op">,</span> fShaderStream<span class="op">;</span></span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>            <span class="co">// read file's buffer contents into streams</span></span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>            vShaderStream <span class="op">&lt;&lt;</span> vShaderFile<span class="op">.</span>rdbuf<span class="op">();</span></span><span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>            fShaderStream <span class="op">&lt;&lt;</span> fShaderFile<span class="op">.</span>rdbuf<span class="op">();</span></span><span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>            <span class="co">// close file handlers</span></span><span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>            vShaderFile<span class="op">.</span>close<span class="op">();</span></span><span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>            fShaderFile<span class="op">.</span>close<span class="op">();</span></span><span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>            <span class="co">// convert stream into string</span></span><span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>            vertexCode <span class="op">=</span> vShaderStream<span class="op">.</span>str<span class="op">();</span></span><span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>            fragmentCode <span class="op">=</span> fShaderStream<span class="op">.</span>str<span class="op">();</span></span><span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>        <span class="cf">catch</span> <span class="op">(</span><span class="bu">std::</span>ifstream<span class="bu">::</span>failure<span class="op">&amp;</span> e<span class="op">)</span></span><span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"ERROR::SHADER::FILE_NOT_SUCCESFULLY_READ"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> vShaderCode <span class="op">=</span> vertexCode<span class="op">.</span>c_str<span class="op">();</span></span><span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">const</span> <span class="dt">char</span> <span class="op">*</span> fShaderCode <span class="op">=</span> fragmentCode<span class="op">.</span>c_str<span class="op">();</span></span><span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>        <span class="co">// 2. compile shaders</span></span><span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> vertex<span class="op">,</span> fragment<span class="op">;</span></span><span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>        <span class="co">// vertex shader</span></span><span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        vertex <span class="op">=</span> glCreateShader<span class="op">(</span>GL_VERTEX_SHADER<span class="op">);</span></span><span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>        glShaderSource<span class="op">(</span>vertex<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>vShaderCode<span class="op">,</span> NULL<span class="op">);</span></span><span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>        glCompileShader<span class="op">(</span>vertex<span class="op">);</span></span><span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>        checkCompileErrors<span class="op">(</span>vertex<span class="op">,</span> <span class="st">"VERTEX"</span><span class="op">);</span></span><span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>        <span class="co">// fragment Shader</span></span><span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>        fragment <span class="op">=</span> glCreateShader<span class="op">(</span>GL_FRAGMENT_SHADER<span class="op">);</span></span><span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>        glShaderSource<span class="op">(</span>fragment<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>fShaderCode<span class="op">,</span> NULL<span class="op">);</span></span><span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>        glCompileShader<span class="op">(</span>fragment<span class="op">);</span></span><span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>        checkCompileErrors<span class="op">(</span>fragment<span class="op">,</span> <span class="st">"FRAGMENT"</span><span class="op">);</span></span><span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>        <span class="co">// shader Program</span></span><span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>        ID <span class="op">=</span> glCreateProgram<span class="op">();</span></span><span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>        glAttachShader<span class="op">(</span>ID<span class="op">,</span> vertex<span class="op">);</span></span><span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        glAttachShader<span class="op">(</span>ID<span class="op">,</span> fragment<span class="op">);</span></span><span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>        glLinkProgram<span class="op">(</span>ID<span class="op">);</span></span><span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>        checkCompileErrors<span class="op">(</span>ID<span class="op">,</span> <span class="st">"PROGRAM"</span><span class="op">);</span></span><span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>        <span class="co">// delete the shaders as they're linked into our program now and no longer necessary</span></span><span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        glDeleteShader<span class="op">(</span>vertex<span class="op">);</span></span><span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>        glDeleteShader<span class="op">(</span>fragment<span class="op">);</span></span><span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    <span class="co">// activate the shader</span></span><span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ------------------------------------------------------------------------</span></span><span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> use<span class="op">()</span></span><span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>        glUseProgram<span class="op">(</span>ID<span class="op">);</span></span><span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>    <span class="co">// utility uniform functions</span></span><span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ------------------------------------------------------------------------</span></span><span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setBool<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op"> &amp;</span>name<span class="op">,</span> <span class="dt">bool</span> value<span class="op">)</span> <span class="at">const</span></span><span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>        glUniform1i<span class="op">(</span>glGetUniformLocation<span class="op">(</span>ID<span class="op">,</span> name<span class="op">.</span>c_str<span class="op">()),</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span>value<span class="op">);</span></span><span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ------------------------------------------------------------------------</span></span><span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setInt<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op"> &amp;</span>name<span class="op">,</span> <span class="dt">int</span> value<span class="op">)</span> <span class="at">const</span></span><span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>        glUniform1i<span class="op">(</span>glGetUniformLocation<span class="op">(</span>ID<span class="op">,</span> name<span class="op">.</span>c_str<span class="op">()),</span> value<span class="op">);</span></span><span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ------------------------------------------------------------------------</span></span><span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> setFloat<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>string<span class="op"> &amp;</span>name<span class="op">,</span> <span class="dt">float</span> value<span class="op">)</span> <span class="at">const</span></span><span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>        glUniform1f<span class="op">(</span>glGetUniformLocation<span class="op">(</span>ID<span class="op">,</span> name<span class="op">.</span>c_str<span class="op">()),</span> value<span class="op">);</span></span><span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>    <span class="co">//void setMat4(const glm::mat4 mat)</span></span><span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>    <span class="co">//{</span></span><span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span><span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>    <span class="co">//}</span></span><span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a><span class="kw">private</span><span class="op">:</span></span><span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>    <span class="co">// utility function for checking shader compilation/linking errors.</span></span><span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ------------------------------------------------------------------------</span></span><span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> checkCompileErrors<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">int</span> shader<span class="op">,</span> <span class="bu">std::</span>string<span class="op"> </span>type<span class="op">)</span></span><span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> success<span class="op">;</span></span><span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>        <span class="co">//char infoLog[1024];</span></span><span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span><span class="op">*</span> infoLog <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span><span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>type <span class="op">!=</span> <span class="st">"PROGRAM"</span><span class="op">)</span></span><span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>            glGetShaderiv<span class="op">(</span>shader<span class="op">,</span> GL_COMPILE_STATUS<span class="op">,</span> <span class="op">&amp;</span>success<span class="op">);</span></span><span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>success<span class="op">)</span></span><span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>                <span class="dt">int</span> logLength<span class="op">;</span></span><span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>                glGetShaderiv<span class="op">(</span>shader<span class="op">,</span> GL_INFO_LOG_LENGTH<span class="op">,</span> <span class="op">&amp;</span>logLength<span class="op">);</span></span><span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>                <span class="dt">char</span><span class="op">*</span> infoLog <span class="op">=</span> <span class="op">(</span><span class="dt">char</span><span class="op">*)</span>realloc<span class="op">(</span>infoLog<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">char</span><span class="op">)</span> <span class="op">*</span> logLength<span class="op">);</span></span><span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>                glGetShaderInfoLog<span class="op">(</span>shader<span class="op">,</span> logLength<span class="op">,</span> NULL<span class="op">,</span> infoLog<span class="op">);</span></span><span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"ERROR::SHADER_COMPILATION_ERROR of type: "</span> <span class="op">&lt;&lt;</span> type <span class="op">&lt;&lt;</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span> <span class="op">&lt;&lt;</span> infoLog <span class="op">&lt;&lt;</span> <span class="st">"</span><span class="sc">\n</span><span class="st"> -- --------------------------------------------------- -- "</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span><span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>            glGetProgramiv<span class="op">(</span>shader<span class="op">,</span> GL_LINK_STATUS<span class="op">,</span> <span class="op">&amp;</span>success<span class="op">);</span></span><span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(!</span>success<span class="op">)</span></span><span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>                <span class="dt">int</span> logLength<span class="op">;</span></span><span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>                glGetShaderiv<span class="op">(</span>shader<span class="op">,</span> GL_INFO_LOG_LENGTH<span class="op">,</span> <span class="op">&amp;</span>logLength<span class="op">);</span></span><span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>                <span class="dt">char</span><span class="op">*</span> infoLog <span class="op">=</span> <span class="op">(</span><span class="dt">char</span><span class="op">*)</span>realloc<span class="op">(</span>infoLog<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">char</span><span class="op">)</span> <span class="op">*</span> logLength<span class="op">);</span></span><span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>                glGetProgramInfoLog<span class="op">(</span>shader<span class="op">,</span> <span class="dv">1024</span><span class="op">,</span> NULL<span class="op">,</span> infoLog<span class="op">);</span></span><span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>                <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"ERROR::PROGRAM_LINKING_ERROR of type: "</span> <span class="op">&lt;&lt;</span> type <span class="op">&lt;&lt;</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span> <span class="op">&lt;&lt;</span> infoLog <span class="op">&lt;&lt;</span> <span class="st">"</span><span class="sc">\n</span><span class="st"> -- --------------------------------------------------- -- "</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>infoLog <span class="op">!=</span> <span class="kw">nullptr</span><span class="op">)</span></span><span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a>            free<span class="op">(</span>infoLog<span class="op">);</span></span><span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span><span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/01-ji-chu-bu-fen/2.san-jiao-xing-hui-zhi/"/>
      <url>/2022/08/10/opengl/01-ji-chu-bu-fen/2.san-jiao-xing-hui-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="ç»˜åˆ¶åŸºæœ¬å›¾å½¢">ç»˜åˆ¶åŸºæœ¬å›¾å½¢</h2><blockquote><p>å›¾å½¢ç»˜åˆ¶æµç¨‹ é¡¶ç‚¹æ•°æ®--&gt;é¡¶ç‚¹ç€è‰²å™¨--&gt;å›¾å…ƒè£…é…--&gt;å‡ ä½•ç€è‰²å™¨--&gt;å…‰æ …åŒ–--&gt;--&gt;æµ‹è¯•å’Œæ··åˆglPolygonMode(GL_FRONT_AND_BACK, GL_LINE) çº¿æ¡†æ¨¡å¼ï¼ŒGL_FILL é»˜è®¤æ¨¡å¼</p></blockquote><h3 id="é‡ç‚¹è§£é‡Š">é‡ç‚¹è§£é‡Š</h3><ul><li><p>VBO ,é¡¶ç‚¹ç¼“å†²å¯¹è±¡ï¼šVertex Buffer Object &gt; é¡¶ç‚¹ç¼“å†²å¯¹è±¡(VertexBuffer Objects,VBO)ç®¡ç†è¿™ä¸ªå†…å­˜ï¼Œå®ƒä¼šåœ¨GPUå†…å­˜ï¼ˆé€šå¸¸è¢«ç§°ä¸ºæ˜¾å­˜ï¼‰ä¸­å‚¨å­˜å¤§é‡é¡¶ç‚¹ã€‚ &gt;ä½¿ç”¨è¿™äº›ç¼“å†²å¯¹è±¡çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ€§çš„å‘é€ä¸€å¤§æ‰¹æ•°æ®åˆ°æ˜¾å¡ä¸Šï¼Œè€Œä¸æ˜¯æ¯ä¸ªé¡¶ç‚¹å‘é€ä¸€æ¬¡ã€‚&gt;ä»CPUæŠŠæ•°æ®å‘é€åˆ°æ˜¾å¡ç›¸å¯¹è¾ƒæ…¢ï¼Œæ‰€ä»¥åªè¦å¯èƒ½æˆ‘ä»¬éƒ½è¦å°è¯•å°½é‡ä¸€æ¬¡æ€§å‘é€å°½å¯èƒ½å¤šçš„æ•°æ®ã€‚&gt;å½“æ•°æ®å‘é€è‡³æ˜¾å¡çš„å†…å­˜ä¸­åï¼Œé¡¶ç‚¹ç€è‰²å™¨å‡ ä¹èƒ½ç«‹å³è®¿é—®é¡¶ç‚¹ï¼Œè¿™æ˜¯ä¸ªéå¸¸å¿«çš„è¿‡ç¨‹ã€‚</p></li><li><p>VAO ,é¡¶ç‚¹æ•°ç»„å¯¹è±¡ï¼šVertex Array Object &gt; é¡¶ç‚¹æ•°ç»„å¯¹è±¡(VertexArray Object,VAO)å¯ä»¥åƒé¡¶ç‚¹ç¼“å†²å¯¹è±¡é‚£æ ·è¢«ç»‘å®šï¼Œä»»ä½•éšåçš„é¡¶ç‚¹å±æ€§è°ƒç”¨éƒ½ä¼šå‚¨å­˜åœ¨è¿™ä¸ªVAOä¸­ã€‚&gt;è¿™æ ·çš„å¥½å¤„å°±æ˜¯ï¼Œå½“é…ç½®é¡¶ç‚¹å±æ€§æŒ‡é’ˆæ—¶ï¼Œä½ åªéœ€è¦å°†é‚£äº›è°ƒç”¨æ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åå†ç»˜åˆ¶ç‰©ä½“çš„æ—¶å€™åªéœ€è¦ç»‘å®šç›¸åº”çš„VAOå°±è¡Œäº†ã€‚&gt;è¿™ä½¿åœ¨ä¸åŒé¡¶ç‚¹æ•°æ®å’Œå±æ€§é…ç½®ä¹‹é—´åˆ‡æ¢å˜å¾—éå¸¸ç®€å•ï¼Œåªéœ€è¦ç»‘å®šä¸åŒçš„VAOå°±è¡Œäº†ã€‚åˆšåˆšè®¾ç½®çš„æ‰€æœ‰çŠ¶æ€éƒ½å°†å­˜å‚¨åœ¨VAOä¸­</p></li><li><p>IBO ,ç´¢å¼•ç¼“å†²å¯¹è±¡ï¼šElement Buffer Objectï¼ŒEBOæˆ–Index BufferObject</p></li></ul><h3 id="vao-vbo-ibo">VAO &amp; VBO &amp;IBO</h3><p><img src="/Sources/imgs/vertex_array_objects_ebo.png"></p><p>OpenGLåœ¨ç”»ç”»çš„æ—¶å€™ï¼Œè¦ç”¨åˆ°å¾ˆå¤šçš„ä¿¡æ¯ï¼Œå¦‚é¡¶ç‚¹çš„åæ ‡ã€çº¹ç†ã€é¢œè‰²ç­‰ç­‰....å‡å¦‚ä¸€ä¸ªé¡¶ç‚¹åŒ…å«äº†åæ ‡å’Œé¢œè‰²çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™ä¸ªé¡¶ç‚¹å¤„çš„æ•°æ®æ ¼å¼å¯èƒ½å¦‚ä¸‹ï¼šx,y, z, r, g, bè¿™äº›å€¼ä¼šè¢«å­˜å‚¨åœ¨ä¸€ä¸ªå«VBO (vertex bufferobject)çš„åœ°æ–¹ã€‚å› è€Œï¼Œå¯ä»¥æŠŠVBOç†è§£æˆä¸€ä¸ªæ•°æ®åŒºåŸŸï¼Œè¿™é‡Œé¢å­˜æ”¾äº†æ¸²æŸ“æ‰€éœ€è¦çš„ä¸€åˆ‡ä¿¡æ¯ã€‚ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ•°æ®åœ¨VBOé‡Œé¢çš„æ—¶å€™ï¼ŒOpenGLæ˜¯å¹¶ä¸çŸ¥é“è¿™é‡Œé¢çš„æ¯ä¸ªæ•°æ®æ‰€ä»£è¡¨çš„å…·ä½“å«ä¹‰çš„ï¼Œåªæ˜¯ä¸€å †æ•°å€¼ç½¢äº†ã€‚è¿™æ—¶å€™ï¼ŒVAO(vertexarrayobject)å°±æ´¾ä¸Šç”¨åœºäº†ã€‚VAOæŒ‡å®šäº†è¯»å–VBOçš„æ–¹å¼~~å‡å¦‚VBOé‡Œé¢ç°åœ¨å­˜æ”¾äº†å¦‚ä¸‹çš„å†…å®¹ï¼šx0,y0, z0, r0, g0, b0x1, y1, z1, r1, g1, b1x2, y2, z2, r2, g2,b2VAOå¯ä»¥å®šä¹‰ä¸€ç§æ ¼å¼è¯´ï¼Œæˆ‘æ¯æ¬¡åªå–VBOé‡Œé¢çš„x,y,zçš„å€¼ï¼›ä¹Ÿå¯ä»¥å®šä¹‰ä¸€ç§æ ¼å¼è¯´ï¼Œæ¯æ¬¡åªå–VBOé‡Œé¢çš„r,g,bçš„å€¼ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨æ¸²æŸ“çš„æ—¶å€™ï¼Œç»‘å®šä¸åŒçš„VAOï¼Œå®ç°æŒ‰ç…§ä¸åŒçš„æ ¼å¼å°†VBOé‡Œé¢çš„ä¸œè¥¿æ¸²æŸ“å‡ºæ¥~é€šè¿‡å®šä¹‰VBOé‡Œé¢æ•°æ®å­˜æ”¾çš„æ–¹å¼ã€VAOçš„æ ¼å¼ä»¥åŠåˆé€‚çš„GLSLè¯­è¨€ï¼Œå°±èƒ½å¤Ÿçµæ´»åœ°ç”»å‡ºæˆ‘ä»¬æ‰€éœ€è¦çš„å„ç§å›¾å½¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒVAOç›¸å½“äºæ•°ç»„åœ°å€,VBOã€IBOç›¸å½“äºæ•°æ®å…ƒç´  1. ç»‘å®šVAOglBindVertexArray(VAO); 2. ç»‘å®šVBO glBindBuffer(GL_ARRAY_BUFFER, VBO);1. å¤åˆ¶æ•°æ®åˆ°VBO glBufferData(GL_ARRAY_BUFFER, sizeof(vertices),vertices, GL_STATIC_DRAW); 2. è®¾ç½®é¡¶ç‚¹å±æ€§çš„ç»“æ„glVertexAttribPointer(0, 3, GL_FLOAT, /<em>å•ä½æ­¥é•¿</em>/GL_FALSE, 3 *sizeof(float), (void*)0); 3. è®¾ç½®é¡¶ç‚¹å±æ€§åœ¨VAOä¸­çš„ä½ç½®glEnableVertexAttribArray(0); 3. ç»“æŸæ­¤å½“å‰é¡¶ç‚¹å±æ€§çš„ç»‘å®šglBindBuffer(GL_ARRAY_BUFFER, 0); 4. ç»“æŸVAOç»‘å®š glBindVertexArray(0);5.è‡³æ­¤VAOåŒ…å«äº†VBOé¡¶ç‚¹å±æ€§æ•°æ®å’Œé¡¶ç‚¹å±æ€§ç»“æ„çš„æ•°æ®ã€‚ä½¿ç”¨æ—¶åªéœ€è¦ä½¿ç”¨åˆ‡æ¢ç»‘å®šVAOå³å¯ã€‚å¦‚ä¸‹</p><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>glUseProgram<span class="op">(</span>shaderProgram<span class="op">);</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>glDrawArrays<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span></code></pre></div><p>`</p><ol type="1"><li>é¡¶ç‚¹Shader</li></ol><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">//ç®€å•è¾“å‡ºé¡¶ç‚¹ä½ç½® xyz,w =1</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#</span><span class="er">version 330 core\n</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>layout <span class="op">(</span>location <span class="op">=</span> <span class="dv">0</span><span class="op">)</span> in vec3 aPos<span class="op">;</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> main<span class="op">()</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>   gl_Position <span class="op">=</span> vec4<span class="op">(</span>aPos<span class="op">.</span>x<span class="op">,</span> aPos<span class="op">.</span>y<span class="op">,</span> aPos<span class="op">.</span>z<span class="op">,</span> <span class="fl">1.0</span><span class="op">);</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><ol start="2" type="1"><li>ç‰‡å…ƒShader</li></ol><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">//ç®€å•è¾“å‡º (1.0f, 0.5f, 0.2f, 1.0f)çš„é¢œè‰²ã€‚</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#</span><span class="er">version 330 core</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>out vec4 FragColor<span class="op">;</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> main<span class="op">()</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>   FragColor <span class="op">=</span> vec4<span class="op">(</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.2</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><ol start="3" type="1"><li>ç¼–è¯‘é“¾æ¥ShaderProgram</li></ol><div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">//1é¡¶ç‚¹Shaderidï¼Œç‰‡å…ƒShaderidã€‚</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> vertexShader<span class="op">,</span> fragmentShader<span class="op">;</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">//1.1 åˆ›å»ºä¸€ä¸ªé¡¶ç‚¹ShaderID</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>vertexShader <span class="op">=</span> glCreateShader<span class="op">(</span>GL_VERTEX_SHADER<span class="op">);</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">//1.1 åŠ è½½å¹¶ç¼–è¯‘é¡¶ç‚¹Shader</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>glShaderSource<span class="op">(</span>vertexShader<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>vertexShaderSource<span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>glCompileShader<span class="op">(</span>vertexShader<span class="op">);</span></span><span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">//1.2 æ£€æŸ¥ç¼–è¯‘çŠ¶æ€</span></span><span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> success<span class="op">;</span></span><span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> infoLog<span class="op">[</span><span class="dv">512</span><span class="op">];</span></span><span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">//1.3 æ£€æŸ¥é¡¶ç‚¹vertexShaderçš„ç¼–è¯‘çŠ¶æ€</span></span><span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>glGetShaderiv<span class="op">(</span>vertexShader<span class="op">,</span> GL_COMPILE_STATUS<span class="op">,</span> <span class="op">&amp;</span>success<span class="op">);</span></span><span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>success<span class="op">)</span></span><span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">//1.4 ç¼–è¯‘å¤±è´¥ï¼Œè·å–é”™è¯¯ä¿¡æ¯ã€‚</span></span><span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>    glGetShaderInfoLog<span class="op">(</span>vertexShader<span class="op">,</span> <span class="dv">512</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">,</span> infoLog<span class="op">);</span></span><span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"ERROR::SHADER::VERTEX::COMPILATION_FAILED</span><span class="sc">\n</span><span class="st">"</span> <span class="op">&lt;&lt;</span> infoLog <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co">//åŒç†ç¼–è¯‘ç‰‡å…ƒShader .....</span></span><span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co">// </span></span><span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Shaderç¨‹åºã€‚ã€‚ã€‚ é¡¶ç‚¹ + ç‰‡å…ƒ</span></span><span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> shaderProgram<span class="op">;</span></span><span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>shaderProgram <span class="op">=</span> glCreateProgram<span class="op">();</span></span><span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>glAttachShader<span class="op">(</span>shaderProgram<span class="op">,</span> vertexShader<span class="op">);</span></span><span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>glAttachShader<span class="op">(</span>shaderProgram<span class="op">,</span> fragmentShader<span class="op">);</span></span><span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>glLinkProgram<span class="op">(</span>shaderProgram<span class="op">);</span></span><span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">//æ£€æŸ¥LinkçŠ¶æ€</span></span><span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>glGetProgramiv<span class="op">(</span>shaderProgram<span class="op">,</span> GL_LINK_STATUS<span class="op">,</span> <span class="op">&amp;</span>success<span class="op">);</span></span><span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>success<span class="op">)</span> <span class="op">{</span></span><span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    glGetProgramInfoLog<span class="op">(</span>shaderProgram<span class="op">,</span> <span class="dv">512</span><span class="op">,</span> NULL<span class="op">,</span> infoLog<span class="op">);</span></span><span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"ERROR::SHADER::PROGRAM::LINK_FAILED</span><span class="sc">\n</span><span class="st">"</span> <span class="op">&lt;&lt;</span> infoLog <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span><span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co">// Shaderç¨‹åºæˆåŠŸï¼Œä½¿ç”¨Shaderç¨‹åºï¼Œæ­¤æ—¶é¡¶ç‚¹å’Œç‰‡å…ƒShaderæ²¡ç”¨åˆ é™¤æ‰</span></span><span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>glDeleteShader<span class="op">(</span>vertexShader<span class="op">);</span></span><span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>glDeleteShader<span class="op">(</span>fragmentShader<span class="op">);</span></span></code></pre></div><ol start="4" type="1"><li>å‡†å¤‡é¡¶ç‚¹æ•°æ®</li></ol><div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// id,</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> VAO<span class="op">,</span> VBO<span class="op">;</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">//èµ‹å€¼buffer æ•°æ®</span></span><span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>vertices<span class="op">),</span> vertices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> <span class="co">/*å•ä½æ­¥é•¿*/</span>GL_FALSE<span class="op">,</span> <span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">//è§£é™¤ç»‘å®š</span></span><span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span></code></pre></div><ol start="5" type="1"><li>ç»˜åˆ¶ä¸‰è§’å½¢</li></ol><div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>    glClearColor<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT<span class="op">);</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    glUseProgram<span class="op">(</span>shaderProgram<span class="op">);</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    glDrawArrays<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span></code></pre></div><ol start="6" type="1"><li>å®Œæ•´ä»£ç </li></ol><div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">//å…ˆåé¡ºåº</span></span><span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"glad/glad.h"</span></span><span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"GLFW/glfw3.h"</span></span><span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span><span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">int</span> wWidth <span class="op">=</span> <span class="dv">800</span><span class="op">,</span> wHeight <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span><span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> wName <span class="op">=</span> <span class="st">"LearnOpenGL"</span><span class="op">;</span></span><span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">/***************</span></span><span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">          *</span></span><span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">    *           *</span></span><span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">    ****************/</span></span><span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> vertices<span class="op">[]{</span></span><span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>        <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span></span><span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>         <span class="fl">0.0</span><span class="bu">f</span><span class="op">,</span>  <span class="fl">0.5</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.0</span><span class="bu">f</span></span><span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span><span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> vertexShaderSource <span class="op">=</span>  <span class="st">"#version 330 core</span><span class="sc">\n</span><span class="st">"</span></span><span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">"layout (location = 0) in vec3 aPos;</span><span class="sc">\n</span><span class="st">"</span></span><span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">"void main()</span><span class="sc">\n</span><span class="st">"</span></span><span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="st">"{</span><span class="sc">\n</span><span class="st">"</span></span><span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="st">"   gl_Position = vec4(aPos.x, aPos.y, aPos.z, 1.0);</span><span class="sc">\n</span><span class="st">"</span></span><span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="st">"}</span><span class="sc">\0</span><span class="st">"</span><span class="op">;</span></span><span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> fragmentShaderSource <span class="op">=</span> <span class="st">"#version 330 core</span><span class="sc">\n</span><span class="st">"</span></span><span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="st">"out vec4 FragColor;</span><span class="sc">\n</span><span class="st">"</span></span><span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="st">"void main()</span><span class="sc">\n</span><span class="st">"</span></span><span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        <span class="st">"{</span><span class="sc">\n</span><span class="st">"</span></span><span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>        <span class="st">"   FragColor = vec4(1.0f, 0.5f, 0.2f, 1.0f);</span><span class="sc">\n</span><span class="st">"</span></span><span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">"}</span><span class="sc">\n\0</span><span class="st">"</span><span class="op">;</span></span><span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">)</span></span><span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>        glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height<span class="op">);</span></span><span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">)</span></span><span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_ESCAPE<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>            glfwSetWindowShouldClose<span class="op">(</span>window<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span><span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> main<span class="op">(</span><span class="at">const</span> <span class="dt">int</span> argc<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span><span class="op">*</span>argv<span class="op">[])</span></span><span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        <span class="co">//1. åˆå§‹åŒ–</span></span><span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwInit<span class="op">()</span> <span class="op">==</span> GLFW_FALSE<span class="op">)</span></span><span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>            cout <span class="op">&lt;&lt;</span> <span class="st">"init glfw fail"</span><span class="op">;</span></span><span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>        <span class="co">//2. åŸºæœ¬è®¾ç½®</span></span><span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_OPENGL_PROFILE<span class="op">,</span> GLFW_OPENGL_CORE_PROFILE<span class="op">);</span></span><span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if __APPLE__</span></span><span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_OPENGL_FORWARD_COMPAT<span class="op">,</span> GLFW_TRUE<span class="op">);</span></span><span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span><span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>        <span class="co">//3. åˆ›å»ºçª—å£</span></span><span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>        GLFWwindow <span class="op">*</span>window <span class="op">=</span> glfwCreateWindow<span class="op">(</span>wWidth<span class="op">,</span> wHeight<span class="op">,</span> wName<span class="op">,</span> <span class="kw">nullptr</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span><span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>window <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span></span><span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>            cout <span class="op">&lt;&lt;</span> <span class="st">"Failed to create GLFW window"</span><span class="op">;</span></span><span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>            <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>            <span class="co">//return 1;</span></span><span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>        <span class="co">//4. å½“å‰ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡çª—å£</span></span><span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>        glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span><span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">//5. ä½¿ç”¨gladç®¡ç†OpenGLæŒ‡é’ˆã€‚</span></span><span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>gladLoadGLLoader<span class="op">((</span>GLADloadproc<span class="op">)</span>glfwGetProcAddress<span class="op">))</span></span><span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to initialize GLAD"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>            <span class="co">//return 1;</span></span><span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>        <span class="co">//6. è®¾ç½®è§†å£</span></span><span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>        glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> wWidth<span class="op">,</span> wHeight<span class="op">);</span></span><span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>        <span class="co">//7. è®¾ç½®resizeå›è°ƒï¼Œå¯¹åº”åˆ·æ–°è§†å£</span></span><span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>        glfwSetFramebufferSizeCallback<span class="op">(</span>window<span class="op">,</span> framebuffer_size_callback<span class="op">);</span></span><span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>        <span class="co">//**********************</span></span><span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> vertexShader<span class="op">;</span></span><span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>        vertexShader <span class="op">=</span> glCreateShader<span class="op">(</span>GL_VERTEX_SHADER<span class="op">);</span></span><span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>        glShaderSource<span class="op">(</span>vertexShader<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>vertexShaderSource<span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span><span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>        glCompileShader<span class="op">(</span>vertexShader<span class="op">);</span>          </span><span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> success<span class="op">;</span></span><span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> infoLog<span class="op">[</span><span class="dv">512</span><span class="op">];</span></span><span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>        glGetShaderiv<span class="op">(</span>vertexShader<span class="op">,</span> GL_COMPILE_STATUS<span class="op">,</span> <span class="op">&amp;</span>success<span class="op">);</span></span><span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>success<span class="op">)</span></span><span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>            glGetShaderInfoLog<span class="op">(</span>vertexShader<span class="op">,</span> <span class="dv">512</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">,</span> infoLog<span class="op">);</span></span><span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"ERROR::SHADER::VERTEX::COMPILATION_FAILED</span><span class="sc">\n</span><span class="st">"</span> <span class="op">&lt;&lt;</span> infoLog <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> fragmentShader<span class="op">;</span></span><span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>        fragmentShader <span class="op">=</span> glCreateShader<span class="op">(</span>GL_FRAGMENT_SHADER<span class="op">);</span></span><span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>        glShaderSource<span class="op">(</span>fragmentShader<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>fragmentShaderSource<span class="op">,</span> NULL<span class="op">);</span></span><span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>        glCompileShader<span class="op">(</span>fragmentShader<span class="op">);</span></span><span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>        glGetShaderiv<span class="op">(</span>fragmentShader<span class="op">,</span> GL_COMPILE_STATUS<span class="op">,</span> <span class="op">&amp;</span>success<span class="op">);</span></span><span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>success<span class="op">)</span></span><span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>            glGetShaderInfoLog<span class="op">(</span>fragmentShader<span class="op">,</span> <span class="dv">512</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">,</span> infoLog<span class="op">);</span></span><span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"ERROR::SHADER::VERTEX::COMPILATION_FAILED</span><span class="sc">\n</span><span class="st">"</span> <span class="op">&lt;&lt;</span> infoLog <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> shaderProgram<span class="op">;</span></span><span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>        shaderProgram <span class="op">=</span> glCreateProgram<span class="op">();</span></span><span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>        glAttachShader<span class="op">(</span>shaderProgram<span class="op">,</span> vertexShader<span class="op">);</span></span><span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>        glAttachShader<span class="op">(</span>shaderProgram<span class="op">,</span> fragmentShader<span class="op">);</span></span><span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>        glLinkProgram<span class="op">(</span>shaderProgram<span class="op">);</span></span><span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>        glGetProgramiv<span class="op">(</span>shaderProgram<span class="op">,</span> GL_LINK_STATUS<span class="op">,</span> <span class="op">&amp;</span>success<span class="op">);</span></span><span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>success<span class="op">)</span> <span class="op">{</span></span><span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>            glGetProgramInfoLog<span class="op">(</span>shaderProgram<span class="op">,</span> <span class="dv">512</span><span class="op">,</span> NULL<span class="op">,</span> infoLog<span class="op">);</span></span><span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"ERROR::SHADER::PROGRAM::LINK_FAILED</span><span class="sc">\n</span><span class="st">"</span> <span class="op">&lt;&lt;</span> infoLog <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>        glDeleteShader<span class="op">(</span>vertexShader<span class="op">);</span></span><span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>        glDeleteShader<span class="op">(</span>fragmentShader<span class="op">);</span></span><span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>        <span class="co">// id,</span></span><span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>        <span class="dt">unsigned</span> <span class="dt">int</span> VAO<span class="op">,</span> VBO<span class="op">;</span></span><span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>        glGenVertexArrays<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VAO<span class="op">);</span></span><span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>        glGenBuffers<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="op">&amp;</span>VBO<span class="op">);</span></span><span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> VBO<span class="op">);</span></span><span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>        <span class="co">//èµ‹å€¼buffer æ•°æ®</span></span><span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>        glBufferData<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>vertices<span class="op">),</span> vertices<span class="op">,</span> GL_STATIC_DRAW<span class="op">);</span></span><span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>        glVertexAttribPointer<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> GL_FLOAT<span class="op">,</span> <span class="co">/*å•ä½æ­¥é•¿*/</span>GL_FALSE<span class="op">,</span> <span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">),</span> <span class="op">(</span><span class="dt">void</span><span class="op">*)</span><span class="dv">0</span><span class="op">);</span></span><span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>        glEnableVertexAttribArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>        <span class="co">//è§£é™¤ç»‘å®š</span></span><span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>        glBindBuffer<span class="op">(</span>GL_ARRAY_BUFFER<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span><span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>        glBindVertexArray<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span><span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>        <span class="co">//**********************</span></span><span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>        <span class="co">//8. è®¾ç½®å°±ç»ªï¼Œå‡†å¤‡è¿›å…¥æ¸²æŸ“çš„å¾ªç¯ã€‚</span></span><span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!</span>glfwWindowShouldClose<span class="op">(</span>window<span class="op">))</span></span><span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>            <span class="co">//8.0 å¤„ç†ç”¨æˆ·è¾“å…¥</span></span><span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>            processInput<span class="op">(</span>window<span class="op">);</span></span><span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>            <span class="co">//*************  render</span></span><span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>            glClearColor<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>            glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT<span class="op">);</span></span><span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>            glUseProgram<span class="op">(</span>shaderProgram<span class="op">);</span></span><span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>            glBindVertexArray<span class="op">(</span>VAO<span class="op">);</span></span><span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>            glDrawArrays<span class="op">(</span>GL_TRIANGLES<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>            <span class="co">//*************</span></span><span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>            <span class="co">//8.1 äº¤æ¢é¢œè‰²ç¼“å†²,ï¼ˆOpenGLåŒç¼“å†²ï¼‰</span></span><span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>            glfwSwapBuffers<span class="op">(</span>window<span class="op">);</span></span><span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a>            <span class="co">//8.2 äº‹ä»¶æ´¾å‘</span></span><span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a>            glfwPollEvents<span class="op">();</span></span><span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a>    TERMINATE<span class="op">:</span></span><span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a>        glfwTerminate<span class="op">();</span></span><span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/01-ji-chu-bu-fen/1.glfw-chuang-kou/"/>
      <url>/2022/08/10/opengl/01-ji-chu-bu-fen/1.glfw-chuang-kou/</url>
      
        <content type="html"><![CDATA[<h2 id="glfwçª—å£">GLFWçª—å£</h2><ul><li>å¤´æ–‡ä»¶<code>glad.h,glfw3.h</code>, åŒ…å«é¡ºåº gladï¼Œglfw3</li></ul><ol type="1"><li>åˆå§‹åŒ–</li></ol><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">//1. åˆå§‹åŒ–</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>glfwInit<span class="op">()</span> <span class="op">==</span> GLFW_FALSE<span class="op">)</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="st">"init glfw fail"</span><span class="op">;</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><ol start="2" type="1"><li>è®¾ç½®OpenGLé…ç½®</li></ol><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">//2. åŸºæœ¬è®¾ç½®, ç‰ˆæœ¬å·ï¼Œå’Œ core_profile</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_OPENGL_PROFILE<span class="op">,</span> GLFW_OPENGL_CORE_PROFILE<span class="op">);</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#if __APPLE__</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    glfwWindowHint<span class="op">(</span>GLFW_OPENGL_FORWARD_COMPAT<span class="op">,</span> GLFW_TRUE<span class="op">);</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div><ol start="3" type="1"><li>åˆ›å»ºçª—å£</li></ol><div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">//3. åˆ›å»ºçª—å£</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    GLFWwindow <span class="op">*</span>window <span class="op">=</span> glfwCreateWindow<span class="op">(</span>wWidth<span class="op">,</span> wHeight<span class="op">,</span> wName<span class="op">,</span> <span class="kw">nullptr</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>window <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="st">"Failed to create GLFW window"</span><span class="op">;</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">//return 1;</span></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">//4. å½“å‰ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡çª—å£</span></span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span></code></pre></div><ol start="4" type="1"><li>ä½¿ç”¨gladç®¡ç†OpenGLæŒ‡é’ˆ</li></ol><div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">//5. ä½¿ç”¨gladç®¡ç†OpenGLæŒ‡é’ˆã€‚</span></span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(!</span>gladLoadGLLoader<span class="op">((</span>GLADloadproc<span class="op">)</span>glfwGetProcAddress<span class="op">))</span></span><span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to initialize GLAD"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="co">//return 1;</span></span><span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div><ol start="5" type="1"><li>è®¾ç½®è§†å£å’Œresizeå›è°ƒ</li></ol><div class="sourceCode" id="cb5"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">//6. è®¾ç½®è§†å£</span></span><span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> wWidth<span class="op">,</span> wHeight<span class="op">);</span></span><span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">//7. è®¾ç½®resizeå›è°ƒï¼Œå¯¹åº”åˆ·æ–°è§†å£</span></span><span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>glfwSetFramebufferSizeCallback<span class="op">(</span>window<span class="op">,</span> framebuffer_size_callback<span class="op">);</span></span></code></pre></div><ol start="6" type="1"><li>è‡³æ­¤åŸºæœ¬è®¾ç½®å·²ç»å®Œæˆï¼Œè¿›å…¥æ¸²æŸ“Loop</li></ol><div class="sourceCode" id="cb6"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">//8. è®¾ç½®å°±ç»ªï¼Œå‡†å¤‡è¿›å…¥æ¸²æŸ“çš„å¾ªç¯ã€‚</span></span><span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(!</span>glfwWindowShouldClose<span class="op">(</span>window<span class="op">))</span></span><span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//8.0 å¤„ç†ç”¨æˆ·è¾“å…¥</span></span><span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    processInput<span class="op">(</span>window<span class="op">);</span></span><span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">//************æ¸²æŸ“çº¯è‰²èƒŒæ™¯</span></span><span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    glClearColor<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT<span class="op">);</span></span><span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">//*************</span></span><span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">//8.1 äº¤æ¢é¢œè‰²ç¼“å†²,ï¼ˆOpenGLåŒç¼“å†²ï¼‰</span></span><span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    glfwSwapBuffers<span class="op">(</span>window<span class="op">);</span></span><span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">//8.2 äº‹ä»¶æ´¾å‘</span></span><span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    glfwPollEvents<span class="op">();</span></span><span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><ol start="7" type="1"><li>æœ€ååœ¨é€€å‡ºæ—¶æ¸…ç†window</li></ol><div class="sourceCode" id="cb7"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>TERMINATE<span class="op">:</span></span><span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>glfwTerminate<span class="op">();</span></span></code></pre></div><ol start="8" type="1"><li>å®Œæ•´ä»£ç </li></ol><div class="sourceCode" id="cb8"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span><span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//å…ˆåé¡ºåº</span></span><span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"glad/glad.h"</span></span><span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">"GLFW/glfw3.h"</span></span><span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span><span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">int</span> wWidth <span class="op">=</span> <span class="dv">800</span><span class="op">,</span> wHeight <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span><span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">char</span><span class="op">*</span> wName <span class="op">=</span> <span class="st">"LearnOpenGL"</span><span class="op">;</span></span><span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> framebuffer_size_callback<span class="op">(</span>GLFWwindow<span class="op">*</span> window<span class="op">,</span> <span class="dt">int</span> width<span class="op">,</span> <span class="dt">int</span> height<span class="op">)</span></span><span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> width<span class="op">,</span> height<span class="op">);</span></span><span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> processInput<span class="op">(</span>GLFWwindow <span class="op">*</span>window<span class="op">)</span></span><span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwGetKey<span class="op">(</span>window<span class="op">,</span> GLFW_KEY_ESCAPE<span class="op">)</span> <span class="op">==</span> GLFW_PRESS<span class="op">)</span></span><span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>            glfwSetWindowShouldClose<span class="op">(</span>window<span class="op">,</span> <span class="kw">true</span><span class="op">);</span></span><span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> main<span class="op">(</span><span class="at">const</span> <span class="dt">int</span> argc<span class="op">,</span> <span class="at">const</span> <span class="dt">char</span><span class="op">*</span>argv<span class="op">[])</span></span><span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        <span class="co">//1. åˆå§‹åŒ–</span></span><span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>glfwInit<span class="op">()</span> <span class="op">==</span> GLFW_FALSE<span class="op">)</span></span><span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>            cout <span class="op">&lt;&lt;</span> <span class="st">"init glfw fail"</span><span class="op">;</span></span><span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span><span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>        <span class="co">//2. åŸºæœ¬è®¾ç½®</span></span><span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MAJOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_CONTEXT_VERSION_MINOR<span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span><span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_OPENGL_PROFILE<span class="op">,</span> GLFW_OPENGL_CORE_PROFILE<span class="op">);</span></span><span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#if __APPLE__</span></span><span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>        glfwWindowHint<span class="op">(</span>GLFW_OPENGL_FORWARD_COMPAT<span class="op">,</span> GLFW_TRUE<span class="op">);</span></span><span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#endif</span></span><span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>        <span class="co">//3. åˆ›å»ºçª—å£</span></span><span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>        GLFWwindow <span class="op">*</span>window <span class="op">=</span> glfwCreateWindow<span class="op">(</span>wWidth<span class="op">,</span> wHeight<span class="op">,</span> wName<span class="op">,</span> <span class="kw">nullptr</span><span class="op">,</span> <span class="kw">nullptr</span><span class="op">);</span></span><span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>window <span class="op">==</span> <span class="kw">nullptr</span><span class="op">)</span></span><span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>            cout <span class="op">&lt;&lt;</span> <span class="st">"Failed to create GLFW window"</span><span class="op">;</span></span><span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>            <span class="co">//return 1;</span></span><span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>        <span class="co">//4. å½“å‰ä¸»çº¿ç¨‹ä¸Šä¸‹æ–‡çª—å£</span></span><span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>        glfwMakeContextCurrent<span class="op">(</span>window<span class="op">);</span></span><span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>        <span class="co">//5. ä½¿ç”¨gladç®¡ç†OpenGLæŒ‡é’ˆã€‚</span></span><span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(!</span>gladLoadGLLoader<span class="op">((</span>GLADloadproc<span class="op">)</span>glfwGetProcAddress<span class="op">))</span></span><span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>            <span class="bu">std::</span>cout<span class="op"> &lt;&lt;</span> <span class="st">"Failed to initialize GLAD"</span> <span class="op">&lt;&lt;</span> <span class="bu">std::</span>endl<span class="op">;</span></span><span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">goto</span> TERMINATE<span class="op">;</span></span><span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>            <span class="co">//return 1;</span></span><span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">//6. è®¾ç½®è§†å£</span></span><span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>        glViewport<span class="op">(</span><span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> wWidth<span class="op">,</span> wHeight<span class="op">);</span></span><span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>        <span class="co">//7. è®¾ç½®resizeå›è°ƒï¼Œå¯¹åº”åˆ·æ–°è§†å£</span></span><span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>        glfwSetFramebufferSizeCallback<span class="op">(</span>window<span class="op">,</span> framebuffer_size_callback<span class="op">);</span></span><span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>        <span class="co">//8. è®¾ç½®å°±ç»ªï¼Œå‡†å¤‡è¿›å…¥æ¸²æŸ“çš„å¾ªç¯ã€‚</span></span><span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(!</span>glfwWindowShouldClose<span class="op">(</span>window<span class="op">))</span></span><span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>            <span class="co">//8.0 å¤„ç†ç”¨æˆ·è¾“å…¥</span></span><span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>            processInput<span class="op">(</span>window<span class="op">);</span></span><span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>            <span class="co">//*************  render</span></span><span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>            glClearColor<span class="op">(</span><span class="fl">0.2</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">0.3</span><span class="bu">f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span><span class="op">);</span></span><span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>            glClear<span class="op">(</span>GL_COLOR_BUFFER_BIT<span class="op">);</span></span><span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>            <span class="co">//*************</span></span><span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>            <span class="co">//8.1 äº¤æ¢é¢œè‰²ç¼“å†²,ï¼ˆOpenGLåŒç¼“å†²ï¼‰</span></span><span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>            glfwSwapBuffers<span class="op">(</span>window<span class="op">);</span></span><span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>            <span class="co">//8.2 äº‹ä»¶æ´¾å‘</span></span><span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>            glfwPollEvents<span class="op">();</span></span><span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a></span><span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>    TERMINATE<span class="op">:</span></span><span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>        glfwTerminate<span class="op">();</span></span><span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/opengl/readme/"/>
      <url>/2022/08/10/opengl/readme/</url>
      
        <content type="html"><![CDATA[<h2 id="å‚è€ƒå­¦ä¹ èµ„æ–™">å‚è€ƒå­¦ä¹ èµ„æ–™</h2><ul><li><a href="https://learnopengl.com/">LearnOpenGLè‹±æ–‡ç‰ˆ</a></li><li><a href="https://learnopengl-cn.github.io/">LearnOpenGLä¸­æ–‡ç‰ˆ</a></li><li><a href="http://www.opengl-tutorial.org/cn/beginners-tutorials/">OpenGL-Tutorial</a></li><li><a href="http://ogldev.atspace.co.uk/www/tutorial01/tutorial01.html">ogl</a></li><li><a href="http://wiki.jikexueyuan.com/project/modern-opengl-tutorial/tutorial1.html">æå®¢å­¦é™¢oglç¿»è¯‘</a></li><li><a href="https://www.bilibili.com/video/av28667650">bç«™OpenGL</a></li><li><a href="https://download.csdn.net/download/lady_killer9/11149754">OpenGLç¼–ç¨‹æŒ‡å—</a></li><li><a href="https://download.csdn.net/download/lady_killer9/10926222">OpenGLè¶…çº§å®å…¸</a></li><li><a href="https://download.csdn.net/download/lady_killer9/10926222">OpenGLè¶…çº§å®å…¸</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/lua/1.lua-nei-cun-xie-lou-jian-ce/"/>
      <url>/2022/08/10/lua/1.lua-nei-cun-xie-lou-jian-ce/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><a href="https://www.cnblogs.com/yaukey/p/unity_lua_memory_leak_trace.html">Luaå†…å­˜æ£€æµ‹ç»Ÿè®¡</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2022/08/10/linux-ji-chu/1.linux-ji-chu-ming-ling-xiang-jie/"/>
      <url>/2022/08/10/linux-ji-chu/1.linux-ji-chu-ming-ling-xiang-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="linuxåŸºç¡€å‘½ä»¤è¯¦è§£">LinuxåŸºç¡€å‘½ä»¤è¯¦è§£</h2><blockquote><p><a href="http://c.biancheng.net/view/723.html">linux å­¦ä¹ </a></p></blockquote><ol type="1"><li><p>scp<code>è¿œç¨‹ä¼ è¾“æ–‡ä»¶å¤¹ä»¥åŠæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œè¿›è¡Œè¿œç¨‹æ‹·è´å¹¶é‡å‘½åå‘½ä»¤</code></p><div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ä¸Šä¼ ç›®å½•</span> scp  [-r]   ./util   ç”¨æˆ·å@ip:/home/wwwroot/limesurvey_back/scp</span></code></pre></div><div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ä¸Šä¼ æ–‡ä»¶</span> scp   ./util   ç”¨æˆ·å@ip:/home/wwwroot/limesurvey_back/scp </span></code></pre></div><div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">è¿œç¨‹ä¸‹è½½</span> scp  [-r]   jiangzhaowei@211.154.xxx.xxx:/kk/jiangzhaowei/share/webCompileOut.sql     ./</span></code></pre></div><div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">æ·»åŠ ç§˜é’¥</span> scp .ssh/id_rsa.pub xxx@192.168.0.2:~/.ssh/authorized_keys</span><span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">å¦‚æœå¤šä¸ªç§˜é’¥ï¼Œåˆ™éœ€è¦è¿½åŠ </span> â€œcat id_dsa.pub <span class="op">&gt;&gt;</span> ~/.ssh/authorized_keys â€</span></code></pre></div></li><li><p>æŸ¥æ‰¾æ–‡ä»¶æ‰€åœ¨è·¯å¾„</p><ol type="1"><li><p>æŸ¥æ‰¾æ–‡ä»¶</p><div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">whereis</span> æ–‡ä»¶å</span></code></pre></div></li><li><p>æŸ¥æ‰¾å¯æ‰§è¡Œç¨‹åº</p><div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span> ç¨‹åºå</span></code></pre></div></li><li><p><a href="https://www.cnblogs.com/lnlvinso/p/9955074.html">findå‘½ä»¤</a></p></li></ol></li><li><p>åˆ›å»ºè¿æ¥</p><ol type="1"><li>è½¯è¿æ¥</li><li>ç¡¬é“¾æ¥</li></ol></li><li><p><a href="https://www.cnblogs.com/wangcp-2014/p/9922845.html">nginx</a></p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>1.åŸºç¡€ä¹‹åæ ‡ç³»</title>
      <link href="/2020/09/25/3d-shu-xue/1.zuo-biao-xi/"/>
      <url>/2020/09/25/3d-shu-xue/1.zuo-biao-xi/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç ”ç©¶çš„éƒ½æ˜¯ç¦»æ•£æ•°å­¦ï¼Œ éç¦»æ•£ä¹Ÿæ˜¯ä¾èµ–ç²¾ç¡®åº¦ï¼Œ æ‰€ä»¥<code>è®¡ç®—æœºå›¾å½¢å­¦ç¬¬ä¸€å‡†åˆ™ï¼šè¿‘ä¼¼åŸåˆ™ï¼Œå¦‚æœçœ‹èµ·æ¥æ˜¯å¯¹çš„ï¼Œå®ƒå°±æ˜¯å¯¹çš„ã€‚</code></p></blockquote><ul><li><p>ç¬›å¡å°”åæ ‡ç³»</p><ul><li>2d åæ ‡ç³» å’Œ 3dåæ ‡ç³»</li></ul><p><img src="/imgs/dikaer2d.png" style="zoom:80%;"><img src="/imgs\dikaer3d.png" style="zoom:120%;"></p><p>â€‹</p><ul><li>å·¦æ‰‹åæ ‡ç³»å’Œå³æ‰‹åæ ‡ç³»ï¼Œ<code>ä¸å¤ªæ˜ç¡®çš„æ—¶å€™,ä½¿ç”¨ +xå‘ä¸œï¼Œ +zå‘åŒ—æ¥å¯¹åº”ï¼Œæ¯”è¾ƒæœ‰æ•ˆã€‚</code> <img src="/imgs\hand.png"></li></ul></li><li><p>æ¸¸æˆå¸¸ç”¨åæ ‡ç³»</p><ul><li>ä¸–ç•Œåæ ‡ç³»</li><li>ç‰©ä½“åæ ‡ç³»ï¼ˆæœ¬åœ°åæ ‡ç³»ï¼‰</li><li>æ‘„åƒæœºåæ ‡ç³» (ä»¥æ‘„åƒæœºä¸ºåŸç‚¹ï¼Œä½¿ç”¨å·¦æ‰‹åæ ‡ç³»)</li><li>æƒ¯æ€§åæ ‡ç³»ï¼ˆtempï¼‰</li><li>åµŒå¥—å¼åæ ‡ç³»ï¼ˆçˆ¶ç©ºé—´åæ ‡ç³»ï¼‰</li></ul></li><li><p>æè¿°åæ ‡ç³»å’Œåæ ‡ç³»è½¬æ¢</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 3dæ•°å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼•æ“ </tag>
            
            <tag> 3dæ•°å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2.å‘é‡</title>
      <link href="/2020/09/25/3d-shu-xue/2.xiang-liang/"/>
      <url>/2020/09/25/3d-shu-xue/2.xiang-liang/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æè¿°ç©ºé—´çš„ç‚¹ï¼Œæ–¹å‘ï¼Œå˜æ¢ï¼Œç›¸å¯¹ä½ç½®ç­‰ã€‚</p></blockquote><ul><li><p>æ•°å­¦å‘é‡</p><ul><li><p>è¡Œå‘é‡ <span class="math display">\[\begin{matrix} 1&amp;2&amp;3 \end{matrix}\]</span></p></li><li><p>åˆ—å‘é‡ <span class="math display">\[\begin{bmatrix}1\\2\\3\end{bmatrix}\]</span></p></li></ul></li><li><p>0 å‘é‡ï¼Œå¤§å°ä¸º0çš„å‘é‡ã€‚ <span class="math display">\[\begin{bmatrix}0&amp;0&amp;0\end{bmatrix} æˆ–è€…\begin{bmatrix}0\\0\\0\end{bmatrix}\]</span></p></li><li><p>å‘é‡å’Œç‚¹</p><ul><li>ç‚¹ åªæœ‰ä½ç½®</li><li>å‘é‡ï¼Œä½ç½®å¤§å°æ–¹å‘</li></ul></li><li><p>å‘é‡è¿ç®—</p><ul><li><p>ä¸æ ‡é‡çš„<code>+</code>ã€<code>-</code>ã€<code>*</code>ã€<code>/</code>è¿ç®—ï¼Œå¯¹æ¯ä¸ªåˆ†é‡å•ç‹¬è¿ç®—. <code>/</code>è¿ç®—éœ€è¦ é0é™¤æ•°ã€‚ <span class="math display">\[k * \begin{bmatrix}1&amp;2&amp;3\end{bmatrix}=\begin{bmatrix}1&amp;2&amp;3\end{bmatrix} * k =\begin{bmatrix}1*k&amp;2*k&amp;3*k\end{bmatrix}\]</span></p></li><li><p>é•¿åº¦/æ¨¡ï¼ŒäºŒç»´å’Œä¸‰ç»´çš„ç¬›å¡å°”åæ ‡ç³»ï¼Œåˆ†é‡æ–¹å‘åˆ†åˆ«å‚ç›´ï¼Œæ‰€ä»¥ç¬¦åˆ<code>å‹¾è‚¡å®šç†</code>.<span class="math display">\[\begin{Vmatrix}v\end{Vmatrix} = \sqrt{v_1^2 +v_2^2+ .. + v_n^2},nä»£è¡¨vå‘é‡çš„ç»´æ•°ã€‚\]</span></p></li><li><p>æ ‡å‡†åŒ–å‘é‡<del>normalize</del>ï¼Œ <span class="math display">\[v_{normal} = \frac{v}{\begin{Vmatrix}v\end{Vmatrix}}, vä¸ºé0å‘é‡ã€‚\]</span></p></li><li><p>å‘é‡å’Œå‘é‡<code>+</code>ã€<code>-</code>è¿ç®—ï¼Œ<strong><code>éœ€è¦åŒç»´åº¦</code></strong>,å¯¹åº”ç»´åº¦å‘é‡ç›¸<code>+</code>ã€<code>-</code>ï¼Œ<strong><code>a-b</code>ç›¸å‡å‡ ä½•æ„ä¹‰ï¼Œ<code>b</code>çš„å°¾ç›´æ¥è¿æ¥<code>a</code>çš„å¤´å½¢æˆçš„å‘é‡.</strong><span class="math display">\[\begin{bmatrix}1&amp;2&amp;3\end{bmatrix} +\begin{bmatrix}4&amp;5&amp;6\end{bmatrix}=\begin{bmatrix}4&amp;5&amp;6\end{bmatrix}+\begin{bmatrix}1&amp;2&amp;3\end{bmatrix} =\begin{bmatrix}1+4&amp;2+5&amp;3+6\end{bmatrix}, è¡Œå‘é‡ç›¸åŠ \]</span></p><p><span class="math display">\[\begin{bmatrix}1\\2\\3\end{bmatrix} +\begin{bmatrix}4\\5\\6\end{bmatrix} =\begin{bmatrix}4\\5\\6\end{bmatrix}+\begin{bmatrix}1\\2\\3\end{bmatrix} =\begin{bmatrix}1+4\\2+5\\3+6\end{bmatrix} , åˆ—å‘é‡ç›¸åŠ \]</span></p><p><span class="math display">\[\begin{bmatrix}1&amp;2&amp;3\end{bmatrix} -\begin{bmatrix}4&amp;5&amp;6\end{bmatrix} =\begin{bmatrix}1-4&amp;2-5&amp;3-6\end{bmatrix}, è¡Œå‘é‡ç›¸å‡\]</span></p><p><span class="math display">\[\begin{bmatrix}1\\2\\3\end{bmatrix} -\begin{bmatrix}4\\5\\6\end{bmatrix} =\begin{bmatrix}1-4\\2-5\\3-6\end{bmatrix} , åˆ—å‘é‡ç›¸å‡\]</span></p></li><li><p>å‘é‡ç‚¹ä¹˜<code>*</code>ï¼ˆå†…ç§¯ï¼‰ï¼Œå¯¹åº”åˆ†é‡ç›¸ä¹˜ï¼Œç»“æœç›¸åŠ ï¼Œå¾—åˆ°ä¸€ä¸ªæ ‡é‡ã€‚<code>å› æ­¤éœ€è¦ç»´æ•°ç›¸åŒ</code><span class="math display">\[a_n * b_n \sum_{i=1}^{n}v_i*k_i, å¯¹åº”é¡¹ç›¸ä¹˜ï¼Œå¹¶ç´¯åŠ ã€‚\]</span></p><p><span class="math display">\[\begin{bmatrix}1\\2\\3\end{bmatrix} *\begin{bmatrix}4\\5\\6\end{bmatrix} =\begin{bmatrix}4\\5\\6\end{bmatrix}*\begin{bmatrix}1\\2\\3\end{bmatrix} = 1*4 + 2*5 + 3*6 = 32\]</span></p><ul><li><p>å‡ ä½•è§£é‡Š <span class="math display">\[a * b=\begin{Vmatrix}a\end{Vmatrix}*\begin{Vmatrix}b\end{Vmatrix}*\cos\theta_{a,b}\]</span></p></li><li><p>å‡ ä½•ç”¨é€”</p><ul><li><p>åˆ©ç”¨ <code>æ­£</code>ã€<code>è´Ÿ</code>ã€<code>0</code>ï¼Œ åˆ¤æ–­é”è§’ï¼Œç›´è§’å’Œé’è§’ã€‚</p></li><li><p><span class="math display">\[a * b_{normal} = a * \frac{b}{\begin{Vmatrix}b\end{Vmatrix}} =\frac{\begin{Vmatrix}a\end{Vmatrix}*\begin{Vmatrix}b\end{Vmatrix}*\cos\theta_{a,b}}{\begin{Vmatrix}b\end{Vmatrix}}=\begin{Vmatrix}a\end{Vmatrix}*\cos\theta_{a,b}ï¼Œ è¡¨ç¤º aåœ¨bä¸Šçš„æŠ•å½±ã€‚\]</span></p></li></ul></li></ul></li><li><p>å‘é‡å‰ä¹˜ <code>x</code>, ç¬¬äºŒä½å¼€å§‹å¾ªç¯ç›¸ä¹˜å‡å»åå¯¹ç§°ç›¸ä¹˜ä½œä¸ºä¸Šä¸€é¡¹å…ƒç´ ã€‚ <span class="math display">\[\begin{bmatrix}x_1\\y_1\\z_1\end{bmatrix} \times\begin{bmatrix}x_2\\y_2\\z_2\end{bmatrix} =\begin{bmatrix}y_1*z_2 -z_1*y_2\\z_1*x_2 - x_1*z_2\\x_1*y_2 - x_2*y_1\end{bmatrix}\]</span></p><p><span class="math display">\[\begin{bmatrix}1\\2\\3\end{bmatrix} \times\begin{bmatrix}4\\5\\6\end{bmatrix} =\begin{bmatrix}2*6 - 3*5\\3*4 -1*6\\1*5 - 2*4\end{bmatrix} = \begin{bmatrix}-3\\6\\-3\end{bmatrix}\]</span></p><ul><li>å‡ ä½•è§£é‡Š,å‰ä¹˜çš„æ¨¡ç­‰äº'a'ã€<code>b</code>è¿æ¥çš„å¹³è¡Œå››è¾¹å½¢é¢ç§¯ï¼Œæ–¹å‘æ»¡è¶³å·¦æ‰‹æ³•åˆ™ï¼Œç”±<code>a</code>çš„å¤´æŒ‡å‘ï¼Œ<code>b</code>çš„å°¾ã€‚axa = 0ï¼Œax(axb) = 0 <span class="math display">\[\begin{Vmatrix}a \times b\end{Vmatrix}=\begin{Vmatrix}a\end{Vmatrix}*\begin{Vmatrix}b\end{Vmatrix}*\sin\theta_{a,b}\]</span><img src="D:\gitworkspace\WebSource\imgs\cross.png" style="zoom:80%;"></li></ul></li><li><p>c++ vector ç»ƒä¹ ã€‚</p><p><a href="../codes/vector.h">vector.h</a></p><ol type="1"><li>ç±»å‹ç²¾åº¦å†³ç­–</li><li>è¿ç®—ç¬¦é‡è½½ï¼Œä¸è¦é‡è½½è¿‡å¤šçš„è¿ç®—ç¬¦ï¼Œåªæœ‰æ“ä½œç¬¦æ„ä¹‰ç‰¹åˆ«æ˜ç¡®ã€‚</li><li>ä»…æä¾›é‡è¦çš„æ“ä½œ</li><li>ä½¿ç”¨ <code>const</code>,å¯¹è°ƒç”¨è€…æ‰¿è¯º<strong>ä¸ä¿®æ”¹å¯¹è±¡</strong></li><li>æˆå‘˜æ–¹æ³•ä¸éæˆå‘˜æ–¹æ³•ã€‚</li><li><strong>ä¸è¦ä½¿ç”¨è™šå‡½æ•°</strong>ï¼Œæ€»ä¹‹è™šå‡½æ•°å¹¶ä¸é€‚åˆå‘é‡ç±»ã€‚<ol type="1"><li><code>è‡ªå®šä¹‰</code>çš„å‘é‡æ“ä½œé€šå¸¸æ²¡æœ‰å¤ªå¤§æ„ä¹‰ã€‚</li><li><code>vector3</code>ä¸¥æ ¼è¦æ±‚é€Ÿåº¦ï¼Œå¦‚æœä½¿ç”¨äº†è™šå‡½æ•°ï¼Œä¼˜åŒ–å™¨é€šå¸¸ä¸èƒ½äº§ç”Ÿæˆå‘˜å‡½æ•°çš„å†…è”ä»£ç ã€‚</li><li>è™šå‡½æ•°éœ€è¦æŒ‡å‘è™šå‡½æ•°è¡¨çš„æŒ‡é’ˆã€‚å‘é‡å®šä¹‰æ—¶è¯¥æŒ‡é’ˆå¿…é¡»è¢«åˆå§‹åŒ–ï¼Œå¹¶ä½¿å¯¹è±¡çš„å¤§å°å¢åŠ <code>25%</code>ã€‚å­˜å‚¨åŒ…å«å‘é‡çš„å¤§æ•°ç»„æ˜¯ä¸€ç§æ™®ééœ€æ±‚ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè™šå‡½æ•°è¡¨æŒ‡é’ˆå ç”¨çš„ç©ºé—´å¤§éƒ¨åˆ†è¢«æµªè´¹æ‰ã€‚</li></ol></li><li>å‘é‡ä¸é€‚åˆä¿¡æ¯å±è”½ï¼ˆä½¿ç”¨å…¬å¼€æ–¹æ³•ï¼Œé™åˆ¶ç›´æ¥è®¿é—®æ•°æ®ï¼‰ï¼Œ</li><li>å…¨å±€å¸¸é‡ 0.</li><li>ç‚¹å’Œå‘é‡ä½¿ç”¨åŒä¸€ä¸ªç±»ï¼Œæ€ä¹ˆä½¿ç”¨äº¤ç»™ä½¿ç”¨è€…èµ·å˜é‡åã€‚</li><li>æš‚æ—¶ä¸åšä¼˜åŒ–ã€‚</li></ol></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 3dæ•°å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼•æ“ </tag>
            
            <tag> 3dæ•°å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤šçº¿ç¨‹Threadç¯‡</title>
      <link href="/2020/09/25/godot-yin-qing/3.yuan-ma-fen-xi-os-zhi-duo-xian-cheng/"/>
      <url>/2020/09/25/godot-yin-qing/3.yuan-ma-fen-xi-os-zhi-duo-xian-cheng/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä¸»è¦æ–‡ä»¶ <a href="">core/os/thread.h</a> ã€<a href="">core/os/thread.cpp</a></p></blockquote><ol type="1"><li>çº¿ç¨‹ç±» thread å£°æ˜åŸå‹</li></ol><div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>   <span class="kw">typedef</span> <span class="dt">void</span> <span class="op">(*</span>ThreadCreateCallback<span class="op">)(</span><span class="dt">void</span> <span class="op">*</span>p_userdata<span class="op">);</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>   <span class="kw">class</span> Thread <span class="op">{</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>   <span class="kw">public</span><span class="op">:</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    </span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ä¼˜å…ˆæƒå£°æ˜</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">enum</span> Priority <span class="op">{</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    PRIORITY_LOW<span class="op">,</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    PRIORITY_NORMAL<span class="op">,</span></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    PRIORITY_HIGH</span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>   <span class="op">};</span></span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">//é»˜è®¤ normalä¼˜å…ˆçº§</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>   <span class="kw">struct</span> Settings <span class="op">{</span></span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    Priority priority<span class="op">;</span></span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    Settings<span class="op">()</span> <span class="op">{</span> priority <span class="op">=</span> PRIORITY_NORMAL<span class="op">;</span> <span class="op">}</span></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>   <span class="op">};</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>   <span class="kw">typedef</span> <span class="dt">uint64_t</span> ID<span class="op">;</span></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>   <span class="kw">protected</span><span class="op">:</span></span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>   <span class="at">static</span> Thread <span class="op">*(*</span>create_func<span class="op">)(</span>ThreadCreateCallback p_callback<span class="op">,</span> <span class="dt">void</span> <span class="op">*,</span> <span class="at">const</span> Settings <span class="op">&amp;);</span></span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>   <span class="at">static</span> ID <span class="op">(*</span>get_thread_id_func<span class="op">)();</span></span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>   <span class="at">static</span> <span class="dt">void</span> <span class="op">(*</span>wait_to_finish_func<span class="op">)(</span>Thread <span class="op">*);</span></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>   <span class="at">static</span> Error <span class="op">(*</span>set_name_func<span class="op">)(</span><span class="at">const</span> String <span class="op">&amp;);</span></span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>   <span class="kw">friend</span> <span class="kw">class</span> Main<span class="op">;</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>   <span class="at">static</span> ID _main_thread_id<span class="op">;</span></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>   Thread<span class="op">()</span> <span class="op">{}</span></span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>   <span class="kw">public</span><span class="op">:</span></span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>   <span class="kw">virtual</span> ID get_id<span class="op">()</span> <span class="at">const</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>   <span class="at">static</span> Error set_name<span class="op">(</span><span class="at">const</span> String <span class="op">&amp;</span>p_name<span class="op">);</span></span><span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>   _FORCE_INLINE_ <span class="at">static</span> ID get_main_id<span class="op">()</span> <span class="op">{</span> <span class="cf">return</span> _main_thread_id<span class="op">;</span> <span class="op">}</span> <span class="co">///&lt; get the ID of the main thread</span></span><span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>   <span class="at">static</span> ID get_caller_id<span class="op">();</span> <span class="co">///&lt; get the ID of the caller function ID</span></span><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>   <span class="at">static</span> <span class="dt">void</span> wait_to_finish<span class="op">(</span>Thread <span class="op">*</span>p_thread<span class="op">);</span> <span class="co">///&lt; waits until thread is finished, and deallocates it.</span></span><span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>   <span class="at">static</span> Thread <span class="op">*</span>create<span class="op">(</span>ThreadCreateCallback p_callback<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>p_user<span class="op">,</span> <span class="at">const</span> Settings <span class="op">&amp;</span>p_settings <span class="op">=</span> Settings<span class="op">());</span> <span class="co">///&lt; Static function to create a thread, will call p_callback</span></span><span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>   <span class="kw">virtual</span> <span class="op">~</span>Thread<span class="op">()</span> <span class="op">{}</span></span><span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>   <span class="op">};</span></span></code></pre></div><ol start="2" type="1"><li>Threadå®ç°</li></ol><div class="sourceCode" id="cb2"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>   <span class="co">// åˆå§‹åŒ–é™æ€ createcallback = null</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>   Thread <span class="op">*(*</span>Thread<span class="op">::</span>create_func<span class="op">)(</span>ThreadCreateCallback<span class="op">,</span> <span class="dt">void</span> <span class="op">*,</span> <span class="at">const</span> Settings <span class="op">&amp;)</span> <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>   <span class="co">//åˆå§‹åŒ– getthreadidcallback = null</span></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>   Thread<span class="op">::</span>ID <span class="op">(*</span>Thread<span class="op">::</span>get_thread_id_func<span class="op">)()</span> <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>   <span class="co">//åˆå§‹åŒ– waitfinishcallback = null</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>   <span class="dt">void</span> <span class="op">(*</span>Thread<span class="op">::</span>wait_to_finish_func<span class="op">)(</span>Thread <span class="op">*)</span> <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>   <span class="co">//åˆå§‹åŒ– setnamecallback = null</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>   Error <span class="op">(*</span>Thread<span class="op">::</span>set_name_func<span class="op">)(</span><span class="at">const</span> String <span class="op">&amp;)</span> <span class="op">=</span> <span class="kw">nullptr</span><span class="op">;</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>   <span class="co">//åˆå§‹åŒ– mainthread = 0</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>   Thread<span class="op">::</span>ID Thread<span class="op">::</span>_main_thread_id <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>   </span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>   Thread<span class="op">::</span>ID Thread<span class="op">::</span>get_caller_id<span class="op">()</span> <span class="op">{</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>get_thread_id_func<span class="op">)</span> <span class="op">{</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> get_thread_id_func<span class="op">();</span></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>   </span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>   Thread <span class="op">*</span>Thread<span class="op">::</span>create<span class="op">(</span>ThreadCreateCallback p_callback<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>p_user<span class="op">,</span> <span class="at">const</span> Settings <span class="op">&amp;</span>p_settings<span class="op">)</span> <span class="op">{</span></span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>create_func<span class="op">)</span> <span class="op">{</span></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> create_func<span class="op">(</span>p_callback<span class="op">,</span> p_user<span class="op">,</span> p_settings<span class="op">);</span></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">nullptr</span><span class="op">;</span></span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>   </span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>   <span class="dt">void</span> Thread<span class="op">::</span>wait_to_finish<span class="op">(</span>Thread <span class="op">*</span>p_thread<span class="op">)</span> <span class="op">{</span></span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>wait_to_finish_func<span class="op">)</span> <span class="op">{</span></span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        wait_to_finish_func<span class="op">(</span>p_thread<span class="op">);</span></span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>   </span><span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>   Error Thread<span class="op">::</span>set_name<span class="op">(</span><span class="at">const</span> String <span class="op">&amp;</span>p_name<span class="op">)</span> <span class="op">{</span></span><span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>set_name_func<span class="op">)</span> <span class="op">{</span></span><span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> set_name_func<span class="op">(</span>p_name<span class="op">);</span></span><span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>   </span><span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ERR_UNAVAILABLE<span class="op">;</span></span><span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>   <span class="op">}</span></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> 3då¼•æ“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼•æ“ </tag>
            
            <tag> OS </tag>
            
            <tag> Thread </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0.åšå®¢ç½‘ç«™</title>
      <link href="/2020/09/25/bo-ke-wang-zhan/0.huan-jing/"/>
      <url>/2020/09/25/bo-ke-wang-zhan/0.huan-jing/</url>
      
        <content type="html"><![CDATA[<p>ä¸»è¦è®¾è®¡ä¸¤æ¬¾å…è´¹åˆ‡è¾ƒä¸ºç®€å•çš„ç½‘ç«™ç³»ç»Ÿ <a href="1.gitbook.md">gitbook</a>ã€<a href="2.hexo.md">hexo</a> *hexoé’ˆå¯¹æ­å»ºä¸ªäººä¼˜ç¾åšå®¢æ¯”è¾ƒå¥½ã€‚ *gitbooké’ˆå¯¹æ¯”è¾ƒæ­£å¼çš„ä¹¦ç±ç½‘ç«™æˆ–è€…å¯¼å‡ºç”µå­ä¹¦æ¯”è¾ƒæœ‰ä¼˜åŠ¿ã€‚ *hexoå’Œgitbookéƒ½ä½¿ç”¨äº†nodejsä½œä¸ºæ„å»ºç³»ç»Ÿï¼Œæ‰€ç³»éƒ½éœ€è¦å®‰è£…nodejs</p><p>å…±åŒéœ€è¦çš„ç¯å¢ƒ 1. å®‰è£…<a href="">nodejs</a>,å¹¶è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚ 1.ä¸‹è½½å®‰è£… <img src="/Sources/imgs/nodejs.jpg"> 2. éªŒè¯å®‰è£…ç‰ˆæœ¬<code>$ node -v        vx.x.x #ç‰ˆæœ¬å·</code> 2. å®‰è£…<a href="">Git</a>,å¹¶è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚ 1. ä¸‹è½½å®‰è£… <img src="/Sources/imgs/nodejs.jpg"> 2. éªŒè¯å®‰è£…ç‰ˆæœ¬<code>$ node -v        vx.x.x #ç‰ˆæœ¬å·</code> 3. å›½å†…å¯è®¾ç½®æ·˜å®é•œåƒåœ°å€<code>$npm config set registry=http://registry.npm.taobao.org</code></p><p><img src="/Sources/imgs/gitbook.jpg"> <strong>Gitbook</strong> <img src="/Sources/imgs/hexo.jpg"> <strong>Hexo</strong></p>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ç½‘ç«™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åšå®¢ç½‘ç«™ </tag>
            
            <tag> gitbook </tag>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2.Hexo</title>
      <link href="/2020/09/25/bo-ke-wang-zhan/2.hexo/"/>
      <url>/2020/09/25/bo-ke-wang-zhan/2.hexo/</url>
      
        <content type="html"><![CDATA[<p>Hexo å‚è€ƒ<a href="https://hexo.io/zh-cn/docs/configuration">å®˜ç½‘</a></p>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ç½‘ç«™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åšå®¢ç½‘ç«™ </tag>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1.gitbook</title>
      <link href="/2020/09/25/bo-ke-wang-zhan/1.gitbook/"/>
      <url>/2020/09/25/bo-ke-wang-zhan/1.gitbook/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li>å®‰è£…gitbook<ol type="1"><li><p>å®‰è£…gitbook</p><pre><code> $ npm install gitbook-cli -g</code></pre></li><li><p>éªŒè¯å®‰è£…ç‰ˆæœ¬</p><pre><code> $ gitbook -V CLI version: 2.3.2 GitBook version: 3.2.3</code></pre></li></ol></li><li>ä½¿ç”¨('markdownè¯­æ³•')<ol type="1"><li><p>åˆ›å»ºæ–‡ä»¶å¤¹å·¥ä½œåŒºå¹¶åˆå§‹åŒ–</p><pre><code>  $ mkdir æ–‡ä»¶å¤¹å &amp; cd æ–‡ä»¶å¤¹å   #é»˜è®¤æ–‡ä»¶å¤¹åä½œä¸ºä¹¦å  $ gitbook init                  #åœ¨æ–‡ä»¶å¤¹ç›®å½•ä¸‹æ‰§è¡Œåˆå§‹åŒ–å‘½ä»¤</code></pre></li><li><p>å®Œæˆåè‡ªåŠ¨ç”Ÿæˆçš„ç›®å½•ç»“æ„<br><code>SUMMARY.md</code> ä¹¦ç›®å½•ç»“æ„ï¼Œé»˜è®¤çš„ä»‹ç»è¿æ¥ä¸º<code>README.md</code>ï¼Œç½‘ç«™ä¾§æ çš„ç›®å½•ã€‚<br><code>README.md</code> ä»‹ç»æ–‡ç« </p></li><li><p>ç¼–å†™æ–‡ç« ï¼Œå¹¶åœ¨<code>SUMMARY.md</code>æ·»åŠ è¿æ¥</p></li><li><p>æ„å»º</p><pre><code> $gitbook build # å¯é€‰å‚æ•°ï¼š ä¹¦è·¯å¾„ è¾“å‡ºè·¯å¾„,</code></pre></li><li><p>ç”Ÿæˆ, ç”Ÿæˆç”µå­ä¹¦éœ€è¦å®‰è£… <a href="https://calibre-ebook.com/download">è½¬æ¢è½¯ä»¶</a>,å¹¶æ·»åŠ ç¯å¢ƒå˜é‡ã€‚</p><ol type="1"><li><p>ç½‘é¡µæœ¬åœ°é¢„è§ˆ,å¯åŠ¨æˆåŠŸåä½¿ç”¨æµè§ˆå™¨è®¿é—® ``</p><pre><code>     $ gitbook serve # å¯é€‰å‚æ•°ï¼š --port æœ¬æœºç”µè„‘ç«¯å£</code></pre></li><li><p>ç”Ÿæˆpdfç”µå­ä¹¦</p><pre><code>     $ gitbook pdf  # å¯é€‰å‚æ•° ä¹¦è·¯å¾„ è¾“å‡ºæ–‡ä»¶è·¯å¾„</code></pre></li><li><p>ç”Ÿæˆepubç”µå­ä¹¦</p><pre><code>     $ gitbook epub   # å¯é€‰å‚æ•° ä¹¦è·¯å¾„ è¾“å‡ºæ–‡ä»¶è·¯å¾„</code></pre></li><li><p>ç”Ÿæˆmobiç”µå­ä¹¦</p><pre><code>     $ gitbook mobi   # å¯é€‰å‚æ•° ä¹¦è·¯å¾„ è¾“å‡ºæ–‡ä»¶è·¯å¾„</code></pre></li></ol></li></ol></li><li>æ’ä»¶å®‰è£…æ–¹æ³•<ol type="1"><li>æ–¹æ³•ä¸€ (é€Ÿåº¦æ…¢)<ol type="1"><li>åœ¨ä¹¦ç›®å½•æ–°å»º book.json, æ·»åŠ éœ€è¦å®‰è£…çš„æ’ä»¶<code>{          "plugins":[              "-lunr", "-search", "search-pro",              "expandable-chapters",              "chapter-fold",              "splitter",              "anchor-navigation-ex",              "back-to-top-button",              "prism","-highlight",              "tbfed-pagefooter"          ],          "pluginsConfig": {              "prism": {                            }          }      }</code></li><li>æ‰§è¡Œ <code>gitbook install</code></li></ol></li><li>æ–¹æ³•äºŒ <code>$ npm install gitbook-plugin-æ’ä»¶å</code></li><li>æ–¹æ³•ä¸‰<ol type="1"><li><code>npm init</code> åˆå§‹åŒ–ä¸€ä¸ªpackage.json</li><li>åœ¨package.jsonä¸­<code>dependencies</code>æ·»åŠ æ’ä»¶</li><li>ä½¿ç”¨<code>npm install</code>å®‰è£…æ’ä»¶</li></ol></li></ol></li><li>å¸¸ç”¨æ’ä»¶<ol type="1"><li>æœç´¢<a href="https://www.npmjs.com/package/gitbook-plugin-search-pro">search-pro</a>ï¼Œ<ol type="1"><li>å…¼å®¹æ€§ï¼Œéœ€è¦<code>gitbook &gt;= 3.0.0 support</code>,</li><li>æ’ä»¶å®‰è£…æ’é™¤å†²çª<code>"-lunr", "-search", "search-pro"</code></li></ol></li><li>å·¦ä¾§å¯æŠ˜å èœå•æ <a href="https://www.npmjs.com/package/gitbook-plugin-chapter-fold">chapter-fold</a><ol type="1"><li>æ’ä»¶å®‰è£… <code>"chapter-fold"</code></li><li>æ’ä»¶é…ç½® <code>"chapter-fold":{}</code></li></ol></li><li>å·¦ä¾§å¯æŠ˜å èœå•æ 2<a href="https://www.npmjs.com/package/gitbook-plugin-chapter-fold">expandable-chapters</a><ol type="1"><li>æ’ä»¶å®‰è£… <code>"expandable-chapters"</code></li><li>æ’ä»¶é…ç½® <code>"expandable-chapters":{}</code></li></ol></li><li>å¯è°ƒèŠ‚ä¾§æ å®½åº¦<a href="https://www.npmjs.com/package/gitbook-plugin-splitter">splitter</a><ol type="1"><li>æ’ä»¶å®‰è£… <code>"splitter"</code></li></ol></li><li>é¡µé¢å†…ç›®å½•<a href="">page-treeview</a><ol type="1"><li>æ’ä»¶å®‰è£… <code>"page-treeview"</code></li><li>æ’ä»¶é…ç½®<code>"page-treeview": {          "copyright": "Copyright &amp;#169; aleen42",          "minHeaderCount": "2",          "minHeaderDeep": "2"      }</code></li></ol></li><li>æ‚¬æµ®æŒ‰é’®ç›®å½•<a href="https://www.npmjs.com/package/gitbook-plugin-anchor-navigation-ex">anchor-navigation-ex</a><ol type="1"><li>æ’ä»¶å®‰è£… <code>"anchor-navigation-ex"</code></li></ol></li><li>å›åˆ°é¡¶éƒ¨<a href="https://www.npmjs.com/package/gitbook-plugin-back-to-top-button">back-to-top-button</a><ol type="1"><li>æ’ä»¶å®‰è£… <code>"back-to-top-button"</code></li></ol></li><li>æ•°å­¦å…¬å¼æ”¯æŒ<a href="https://www.npmjs.com/package/gitbook-plugin-mathjax-pro">mathjax-pro</a><ol type="1"><li>æ’ä»¶å®‰è£… <code>"mathjax-pro"</code></li><li>æ’ä»¶é…ç½®<code>"mathjax-pro":{          "version": "2.7.5"      }</code></li></ol></li><li>æµç¨‹å›¾<a href="https://www.npmjs.com/package/gitbook-plugin-flowchart">flowchart</a><ol type="1"><li>æ’ä»¶å®‰è£… <code>"flowchart"</code></li><li>æ’ä»¶é…ç½®<code>"flowchart": {          "line-color": "red"       }</code></li></ol></li></ol></li><li>å…¶ä»–å†…å®¹<ul><li>æ›´å¤šæ’ä»¶<a href="https://www.npmjs.com/search?q=gitbook-plugin&amp;ranking=popularity&amp;page=1&amp;perPage=20">https://www.npmjs.com/search?q=gitbook-plugin&amp;ranking=popularity&amp;page=1&amp;perPage=20</a></li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> åšå®¢ç½‘ç«™ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åšå®¢ç½‘ç«™ </tag>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1.git</title>
      <link href="/2020/09/25/ban-ben-kong-zhi/1.git/"/>
      <url>/2020/09/25/ban-ben-kong-zhi/1.git/</url>
      
        <content type="html"><![CDATA[<h1 id="git-gitee">git &amp; gitee</h1><h2 id="git-gitee-1">git &amp; gitee</h2><p>å›½å†…ç¯å¢ƒgiteeé€Ÿåº¦è¾ƒå¿«å¯ä½œä¸ºClone &amp; pollä¸­è½¬ã€‚</p><h2 id="pushæäº¤">pushæäº¤</h2><div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push <span class="at">-f</span> git@github.com:<span class="kw">`</span><span class="ex">USERNAME</span><span class="kw">`</span>/<span class="kw">`</span><span class="ex">REPO</span><span class="kw">`</span>.git master:gh-pages</span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push <span class="at">-f</span> git@gitee.com:<span class="kw">`</span><span class="ex">USERNAME</span><span class="kw">`</span>/<span class="kw">`</span><span class="ex">REPO</span><span class="kw">`</span>.git master:gh-pages</span></code></pre></div><h2 id="åŒæ­¥æ“ä½œ">åŒæ­¥æ“ä½œ</h2><p><a href="https://www.cnblogs.com/einstein-2014731/p/11492637.html"></a></p>]]></content>
      
      
      <categories>
          
          <category> ç‰ˆæœ¬æ§åˆ¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> ç‰ˆæœ¬æ§åˆ¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0.æ¦‚è®º</title>
      <link href="/2020/09/25/unity/xing-neng-you-hua/0.gai-lun/"/>
      <url>/2020/09/25/unity/xing-neng-you-hua/0.gai-lun/</url>
      
        <content type="html"><![CDATA[<p>å®Œæ•´æµç¨‹å›¾</p><pre class="mermaid">graph TD;    0(å¼€å§‹)--&gt;A;    subgraph äººå·¥å‚ä¸        A[æ€§èƒ½æŒ‡æ ‡1]--&gt;åˆ†æ--&gt;conditionA{é—®é¢˜?}        conditionA--&gt;|æ˜¯|B;        conditionA--&gt;|å¦|F;         F[å­˜æŒ‡æ ‡ç»“æŸ]--&gt;åˆå…¥ä¸»å¹²        subgraph ä¸€è½®ä¼˜åŒ–            B(ç¡®å®šæ”¹è¿›æ–¹æ¡ˆ)--&gt;ä¼˜åŒ–ä¿®æ”¹;            ä¼˜åŒ–ä¿®æ”¹--&gt;æ€§èƒ½æŒ‡æ ‡2            æ€§èƒ½æŒ‡æ ‡2--&gt;åˆ†ædiff        end        åˆ†ædiff--&gt;A    end</pre><p>é‡æ–°è§„åˆ’</p><pre class="mermaid">graph TD;    0(å¼€å§‹)--&gt;A    subgraph è‡ªåŠ¨åŒ–        A[å›¾è¡¨æ•°æ®æŒ‡æ ‡1]--&gt;B--&gt;conditionA{é—®é¢˜?}        conditionA--&gt;|æ˜¯|C;        conditionA--&gt;|å¦|F;         F[å­˜æŒ‡æ ‡ç»“æŸ]--&gt;åˆå…¥ä¸»å¹²                 C(ç¡®å®šæ”¹è¿›æ–¹æ¡ˆ)--&gt;ä¼˜åŒ–ä¿®æ”¹;        ä¼˜åŒ–ä¿®æ”¹--&gt;æ€§èƒ½æŒ‡æ ‡2        æ€§èƒ½æŒ‡æ ‡2--&gt;åˆ†ædiff        åˆ†ædiff--&gt;A        subgraph äººå·¥å‚ä¸            B[åˆ†æ]        end    end</pre>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ä¼˜åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> Unity </tag>
            
            <tag> Android </tag>
            
            <tag> iOS </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1.æ€§èƒ½è°ƒè¯•</title>
      <link href="/2020/09/25/unity/xing-neng-you-hua/1.xing-neng-diao-shi/"/>
      <url>/2020/09/25/unity/xing-neng-you-hua/1.xing-neng-diao-shi/</url>
      
        <content type="html"><![CDATA[<h2 id="unity-profiler">Unity Profiler</h2><ol type="1"><li>æ‰“åŒ…éœ€è¦å‹¾é€‰<ul><li>æ‰‹åŠ¨å‹¾é€‰<ol type="1"><li><code>Development Build</code>ã€</li><li><code>Autoconnect to Profiler</code> (å¯é€‰)</li><li><code>Deep Profiling Support</code> ï¼ˆdeep æ”¯æŒï¼‰</li></ol></li><li>ä»£ç å‹¾é€‰<ol type="1"><li>UnityEditor.EditorUserBuildSettings.development/<code>csharp       BuildOptions.Development = true;</code></li><li>UnityEditor.EditorUserBuildSettings.connectProfiler/<code>csharp       BuildOptions.ConnectWithProfiler = true;</code></li><li>UnityEditor.EditorUserBuildSettings.buildWithDeepProfilingSupport/<code>csharp       BuildOptions.EnableDeepProfilingSupport  = true;</code></li></ol></li></ul></li></ol><blockquote><p>--ä»£ç è°ƒè¯• Script Debugging:EditorUserBuildSettings.allowDebugging/</p></blockquote><div class="sourceCode" id="cb1"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    BuildOptions<span class="op">.</span><span class="fu">AllowDebugging</span>  <span class="op">=</span> <span class="kw">true</span><span class="op">;</span> </span></code></pre></div><ol start="2" type="1"><li><p>ios &gt; build &amp; run å°±å¯ä»¥äº†</p></li><li><p>Android è¿æ¥é…ç½®<br>&gt; Unityä½¿ç”¨çš„é»˜è®¤ç«¯å£<code>AndroidProfiler(ADB@127.0.0.1:34999).</code></p><ul><li>é…ç½®æ•°æ®é€šä¿¡ä¼ è¾“ &gt; æ–°ç‰ˆæœ¬æ”¯æŒçš„ç«¯å£ä¸º55000å¼€å§‹ï¼Œæ‰€ä»¥34999,æ”¹ä¸º55002ç­‰æ”¯æŒçš„èŒƒå›´ã€‚</li></ul><div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a> <span class="ex">$</span> adb forward tcp:34999 localabstract:Unity-åŒ…å</span></code></pre></div><ul><li>å¼€å¯ deepæ¨¡å¼</li></ul><div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a> <span class="ex">adb</span> shell am start <span class="at">-n</span> åŒ…å/Activityå <span class="at">-e</span> <span class="st">'unity'</span> <span class="st">'-deepprofiling'</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># adb shell am start -S -n åŒ…å/Activityå -e 'unity' '-deepprofiling' #åœæ­¢ä¹‹å‰çš„è¿›ç¨‹</span></span></code></pre></div></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ä¼˜åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> Unity </tag>
            
            <tag> Android </tag>
            
            <tag> iOS </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2.Unity Profiler</title>
      <link href="/2020/09/25/unity/xing-neng-you-hua/2.unityprofiler/"/>
      <url>/2020/09/25/unity/xing-neng-you-hua/2.unityprofiler/</url>
      
        <content type="html"><![CDATA[<h2 id="cpu">1. CPU</h2><ul><li><ol type="1"><li>æ¸²æŸ“å›¾å½¢</li></ol></li><li><ol start="2" type="1"><li>è„šæœ¬æ‰§è¡Œ</li></ol></li><li><ol start="3" type="1"><li>ç‰©ç†</li></ol></li><li><ol start="4" type="1"><li>åŠ¨ç”»</li></ol></li><li><ol start="5" type="1"><li>åƒåœ¾å›æ”¶</li></ol></li><li><ol start="6" type="1"><li>å…‰ç…§</li></ol></li><li><ol start="7" type="1"><li>UI</li></ol></li><li><ol start="8" type="1"><li>å‚ç›´åŒæ­¥VSync</li></ol></li><li><ol start="9" type="1"><li>å…¶ä»–</li></ol></li></ul><h2 id="memory">2. Memory</h2><ul><li><ol type="1"><li>Scene Memoryï¼Œåœºæ™¯å¯¹è±¡ç»„ä»¶ã€‚</li></ol></li><li><ol start="2" type="1"><li>Assets èµ„æº</li></ol></li><li><ol start="3" type="1"><li>Builtin Resources å†…ç½®èµ„æº</li></ol></li><li><ol start="4" type="1"><li>Not Savedæ ‡è®°ä¸ºDontSaveçš„å¯¹è±¡(è¯¥å¯¹è±¡ä¸ä¿å­˜åˆ°åœºæ™¯ã€‚åŠ è½½æ–°åœºæ™¯æ—¶ï¼Œä¹Ÿä¸ä¼šé”€æ¯å®ƒã€‚å®ƒæ˜¯HideFlags.DontSaveInBuild | HideFlags.DontSaveInEditor |HideFlags.DontUnloadUnusedAsset çš„å¿«æ·æ–¹å¼)</li></ol></li><li><ol start="5" type="1"><li>å…¶ä»–</li></ol></li></ul><h2 id="rendering">3. Rendering</h2><ul><li><ol type="1"><li>Draw Calls Count, Unity åœ¨ä¸€å¸§å†…å‘å‡ºçš„ç»˜åˆ¶è°ƒç”¨æ€»æ•°ã€‚Unityåœ¨å°†æ¸¸æˆå¯¹è±¡æ¸²æŸ“åˆ°å±å¹•æ—¶å‘å‡ºç»˜åˆ¶è°ƒç”¨ã€‚è¿™ä¸ªæ•°å­—åŒ…æ‹¬éæ‰¹é‡ç»˜åˆ¶è°ƒç”¨ä»¥åŠåŠ¨æ€å’Œé™æ€æ‰¹é‡ç»˜åˆ¶è°ƒç”¨ã€‚</li></ol></li><li><ol start="2" type="1"><li>SetPass Calls Countï¼Œ Unityåœ¨ä¸€å¸§ä¸­åˆ‡æ¢ç”¨äºæ¸²æŸ“æ¸¸æˆå¯¹è±¡çš„ç€è‰²å™¨é€šé“çš„æ¬¡æ•°ã€‚ä¸€ä¸ªç€è‰²å™¨å¯èƒ½åŒ…å«å¤šä¸ªç€è‰²å™¨é€šé“ï¼Œæ¯ä¸ªé€šé“ä»¥ä¸åŒçš„æ–¹å¼æ¸²æŸ“åœºæ™¯ä¸­çš„æ¸¸æˆå¯¹è±¡ã€‚</li></ol></li><li><ol start="3" type="1"><li>Total Batches Countã€‚ Unityåœ¨ä¸€å¸§å†…å¤„ç†çš„æ‰¹æ¬¡æ€»æ•°ã€‚è¿™ä¸ªæ•°å­—åŒ…æ‹¬é™æ€å’ŒåŠ¨æ€æ‰¹æ¬¡ã€‚</li></ol></li><li><ol start="4" type="1"><li>Triangles Countã€‚Unity åœ¨ä¸€å¸§å†…å¤„ç†çš„ä¸‰è§’å½¢æ•°ã€‚</li></ol></li><li><ol start="5" type="1"><li>Vertices Count Unity åœ¨å¸§æœŸé—´å¤„ç†çš„é¡¶ç‚¹æ•°ã€‚</li></ol></li><li><ol start="6" type="1"><li>Dynamic Batchingã€Static Batchingã€Instancing</li></ol></li><li><ol start="7" type="1"><li>Used Textures Countã€‚ Unity åœ¨å¸§æœŸé—´ä½¿ç”¨çš„çº¹ç†æ•°</li></ol></li><li><ol start="8" type="1"><li>Used Textures Bytesã€‚ çº¹ç†ä½¿ç”¨çš„å†…å­˜é‡ã€‚</li></ol></li><li><ol start="9" type="1"><li>Render Textures Countã€‚ Unity åœ¨å¸§æœŸé—´ä½¿ç”¨çš„ RenderTextures æ•°</li></ol></li><li><ol start="10" type="1"><li>Render Textures Changes Countã€‚ Unity åœ¨å¸§æœŸé—´å°†ä¸€ä¸ªæˆ–å¤šä¸ªRenderTextures è®¾ç½®ä¸ºæ¸²æŸ“ç›®æ ‡çš„æ¬¡æ•°ã€‚</li></ol></li><li><ol start="11" type="1"><li>Used Buffers Countã€‚ æ‰€ä½¿ç”¨çš„ GPUç¼“å†²åŒºå’Œå†…å­˜çš„æ€»æ•°ã€‚è¿™åŒ…æ‹¬é¡¶ç‚¹ã€ç´¢å¼•å’Œè®¡ç®—ç¼“å†²åŒºä»¥åŠæ¸²æŸ“æ‰€éœ€çš„æ‰€æœ‰å†…éƒ¨ç¼“å†²åŒºã€‚</li></ol></li><li><ol start="12" type="1"><li>Used Buffers Bytesã€‚ RenderTextures ä½¿ç”¨çš„å†…å­˜é‡ã€‚</li></ol></li><li><ol start="13" type="1"><li>Vertex Buffer Upload In Frame Countã€‚ CPU åœ¨å¸§ä¸­ä¸Šä¼ åˆ° GPUçš„å‡ ä½•ä½“æ•°é‡ã€‚è¿™ä»£è¡¨é¡¶ç‚¹/æ³•çº¿/ texcoord æ•°æ®ã€‚GPUä¸Šå¯èƒ½å·²ç»æœ‰ä¸€äº›å‡ ä½•ä½“ã€‚æ­¤ç»Ÿè®¡ä¿¡æ¯ä»…åŒ…æ‹¬ Unity åœ¨å¸§ä¸­ä¼ è¾“çš„å‡ ä½•ä½“ã€‚</li></ol></li><li><ol start="14" type="1"><li>Index Buffer Upload In Frame Countã€‚ PU åœ¨å¸§ä¸­ä¸Šä¼ åˆ° GPUçš„å‡ ä½•ä½“æ•°é‡ã€‚è¿™è¡¨ç¤ºä¸‰è§’å½¢ç´¢å¼•æ•°æ®ã€‚GPUä¸Šå¯èƒ½å·²ç»æœ‰ä¸€äº›å‡ ä½•ä½“ã€‚æ­¤ç»Ÿè®¡ä¿¡æ¯ä»…åŒ…æ‹¬ Unity åœ¨å¸§ä¸­ä¼ è¾“çš„å‡ ä½•ä½“ã€‚</li></ol></li><li><ol start="15" type="1"><li>Index Buffer Upload In Frame Bytesã€‚</li></ol></li><li><ol start="16" type="1"><li>Shadow Casters Countã€‚åœ¨ä¸€å¸§ä¸­æŠ•å°„é˜´å½±çš„æ¸¸æˆå¯¹è±¡çš„æ•°é‡ã€‚å¦‚æœä¸€ä¸ªæ¸¸æˆå¯¹è±¡æŠ•å°„å¤šä¸ªé˜´å½±ï¼ˆå› ä¸ºå¤šä¸ªå…‰æºç…§äº®å®ƒï¼‰ï¼Œè¯¥å¯¹è±¡æŠ•å°„çš„æ¯ä¸ªé˜´å½±éƒ½æœ‰ä¸€ä¸ªæ¡ç›®ã€‚</li></ol></li></ul><h2 id="ui">4. UI</h2><ul><li><ol type="1"><li>Layoutã€‚ å¸ƒå±€æ¶ˆè€—, å¸ƒå±€ç»„ä»¶é‡ç‚¹ã€‚</li></ol></li><li><ol start="2" type="1"><li>Renderã€‚ UI åœ¨å®Œæˆæ¸²æŸ“éƒ¨åˆ†ä¸­èŠ±è´¹çš„æ—¶é—´ã€‚</li></ol></li><li><ol start="3" type="1"><li>Batchesã€‚ æ˜¾ç¤ºä¸€èµ·æ‰¹å¤„ç†çš„ç»˜åˆ¶è°ƒç”¨çš„æ€»æ•°ã€‚</li></ol></li><li><ol start="4" type="1"><li>Rebuildã€‚ é¡¶ç‚¹é‡å»ºã€‚</li></ol></li><li><ol start="5" type="1"><li>Verticesã€‚ç”¨äºæ¸²æŸ“ UI æŸä¸ªéƒ¨åˆ†çš„é¡¶ç‚¹æ€»æ•°ã€‚</li></ol></li></ul><blockquote><p>å¸¸è§åŸå› ï¼š 1. ä¸ä¸ç”»å¸ƒå…±é¢ (Not Coplanar WithCanvas)ï¼šæ‰¹å¤„ç†éœ€è¦å¯¹è±¡çš„çŸ©å½¢å˜æ¢ä¸ç”»å¸ƒå…±é¢ï¼ˆæœªæ—‹è½¬ï¼‰ã€‚ 2. ç”»å¸ƒæ³¨å…¥ç´¢å¼•(CanvasInjectionIndex)ï¼šCanvasGroupç»„ä»¶å­˜åœ¨å¹¶å¼ºåˆ¶æ–°å»ºæ‰¹æ¬¡ï¼Œä¾‹å¦‚åœ¨å…¶ä½™éƒ¨åˆ†ä¸Šæ˜¾ç¤ºä¸€ä¸ªç»„åˆæ¡†çš„ä¸‹æ‹‰åˆ—è¡¨æ—¶ã€‚ 3.ä¸åŒçš„æè´¨å®ä¾‹ã€çŸ©å½¢è£å‰ªã€çº¹ç†ã€A8 çº¹ç†ç”¨æ³• (Different MaterialInstance, Rect clipping, Texture, or A8TextureUsage)ï¼šUnityåªèƒ½å°†å…·æœ‰ç›¸åŒæè´¨ã€é®ç½©ã€çº¹ç†å’Œçº¹ç† Alphaé€šé“ç”¨æ³•çš„å¯¹è±¡ä¸€èµ·è¿›è¡Œå¤„ç†ã€‚</p></blockquote><h2 id="global-illumination">5. Global Illumination</h2><ul><li><ol type="1"><li>Total CPUã€‚æ¶ˆè€—çš„æ—¶é—´ã€‚</li></ol></li></ul><h2 id="ç‰©ç†">6. ç‰©ç†</h2><ul><li><ol type="1"><li>Physics.Processing æˆ– Physics.Simulateã€‚ æ¶ˆè€—æ—¶é—´ã€è°ƒç”¨æ¬¡æ•°</li></ol></li><li><ol start="2" type="1"><li>ç‰©ç†ç»„ä»¶ç»Ÿè®¡ã€‚</li></ol></li></ul><h2 id="å¯ç”¨ä»£ç ">7. å¯ç”¨ä»£ç </h2><ul><li><ol type="1"><li>CustomSampler. ä½¿ç”¨ CustomSampleræµ‹é‡è„šæœ¬ä»£ç å—çš„æ‰§è¡Œæ—¶é—´ã€‚ç”Ÿæˆçš„ä¿¡æ¯å°†æ˜¾ç¤ºåœ¨ CPUæ€§èƒ½åˆ†æå™¨ä¸­ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ Recorder æ•è·ã€‚&nbsp;ä½¿ç”¨ CustomSampleræ¥åˆ†æä»£ç æ¯”ä½¿ç”¨ Profiler.BeginSample æ›´é«˜æ•ˆã€‚è¿™æ˜¯å› ä¸ºä¸Profiler.BeginSample ç›¸æ¯”ï¼Œé¢„å…ˆåˆ›å»ºçš„ CustomSamplers å…·æœ‰éå¸¸ä½çš„ Beginè°ƒç”¨å¼€é”€ã€‚</li></ol></li><li><ol start="2" type="1"><li>Profiler</li></ol></li><li><ol start="3" type="1"><li>Recorder</li></ol></li><li><ol start="4" type="1"><li>Sampler</li></ol></li></ul><div class="sourceCode" id="cb1"><pre class="sourceCode c#"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// debug æ¨¡å¼</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    EditorUserBuildSettings<span class="op">.</span><span class="fu">development</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ä¸‹é¢ä¸º Unity Profiler è°ƒè¯•é€‰é¡¹</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    EditorUserBuildSettings<span class="op">.</span><span class="fu">connectProfiler</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    EditorUserBuildSettings<span class="op">.</span><span class="fu">buildWithDeepProfilingSupport</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    </span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// deep æ¨¡å¼æ”¯æŒ</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    EditorUserBuildSettings<span class="op">.</span><span class="fu">buildWithDeepProfilingSupport</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span></code></pre></div><div class="sourceCode" id="cb2"><pre class="sourceCode c#"><code class="sourceCode cs"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">;</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> UnityEngine<span class="op">.</span><span class="fu">Profiling</span><span class="op">;</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> ProfilerAPITest <span class="op">:</span> MonoBehaviour</span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    CustomSampler sampler<span class="op">;</span></span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    Recorder behaviourUpdateRecorder<span class="op">;</span></span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">Start</span><span class="op">()</span></span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        sampler <span class="op">=</span> CustomSampler<span class="op">.</span><span class="fu">Create</span><span class="op">(</span><span class="st">"ProfilerAPITest"</span><span class="op">);</span></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        behaviourUpdateRecorder <span class="op">=</span> Recorder<span class="op">.</span><span class="fu">Get</span><span class="op">(</span><span class="st">"BehaviourUpdate"</span><span class="op">);</span></span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        behaviourUpdateRecorder<span class="op">.</span><span class="fu">enabled</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">Update</span><span class="op">()</span></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        sampler<span class="op">.</span><span class="fu">Begin</span><span class="op">();</span></span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>            GameObject<span class="op">[]</span> gos <span class="op">=</span> <span class="kw">new</span> GameObject<span class="op">[</span><span class="dv">10</span><span class="op">];</span></span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> gos<span class="op">.</span><span class="fu">Length</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                gos<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> GameObject<span class="op">.</span><span class="fu">CreatePrimitive</span><span class="op">(</span>PrimitiveType<span class="op">.</span><span class="fu">Cube</span><span class="op">);</span></span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>            <span class="kw">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> gos<span class="op">.</span><span class="fu">Length</span><span class="op">;</span> i<span class="op">++)</span></span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                GameObject<span class="op">.</span><span class="fu">Destroy</span><span class="op">(</span>gos<span class="op">[</span>i<span class="op">]);</span></span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>        sampler<span class="op">.</span><span class="fu">End</span><span class="op">();</span></span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span>behaviourUpdateRecorder<span class="op">.</span><span class="fu">isValid</span><span class="op">)</span></span><span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span><span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>            Debug<span class="op">.</span><span class="fu">Log</span><span class="op">(</span>$<span class="st">"BehaviourUpdate time { behaviourUpdateRecorder.elapsedNanoseconds}"</span><span class="op">);</span></span><span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span><span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span><span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div><p><a href="https://docs.unity3d.com/cn/2022.1/Manual/ProfilerWindow.html">https://docs.unity3d.com/cn/2022.1/Manual/ProfilerWindow.html</a></p>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ä¼˜åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> Unity </tag>
            
            <tag> Android </tag>
            
            <tag> iOS </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3.Unity Memory Profiler</title>
      <link href="/2020/09/25/unity/xing-neng-you-hua/3.unitymemoryprofiler/"/>
      <url>/2020/09/25/unity/xing-neng-you-hua/3.unitymemoryprofiler/</url>
      
        <content type="html"><![CDATA[<p>Unity Profiler - Memory çš„è¯¦ç»†ç‹¬ç«‹å·¥å…·ã€‚</p><div class="sourceCode" id="cb1"><pre class="sourceCode c#"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// debug æ¨¡å¼</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    EditorUserBuildSettings<span class="op">.</span><span class="fu">development</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ä¸‹é¢ä¸º Unity Profiler è°ƒè¯•é€‰é¡¹</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    EditorUserBuildSettings<span class="op">.</span><span class="fu">connectProfiler</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    EditorUserBuildSettings<span class="op">.</span><span class="fu">buildWithDeepProfilingSupport</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// deep æ¨¡å¼æ”¯æŒ</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    EditorUserBuildSettings<span class="op">.</span><span class="fu">buildWithDeepProfilingSupport</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span></code></pre></div><p>Unity App æ€§èƒ½ä¸»è¦åˆ†ä¸‰éƒ¨åˆ†éƒ¨åˆ†ï¼š</p><ol type="1"><li>å¼•æ“çš„Nativeéƒ¨åˆ†</li><li>åŸç”Ÿåº“çš„Nativeéƒ¨åˆ† (lualibã€jniã€å…¶ä»–c/c++éƒ¨åˆ†)</li><li>éåŸç”Ÿæ¸¸æˆéƒ¨åˆ† (è¿™éƒ¨åˆ†ä¸»è¦ä½¿ç”¨ Unity Profilerå·¥å…·æ£€æµ‹)</li></ol><p><a href="https://docs.unity3d.com/Packages/com.unity.memoryprofiler@0.2/manual/index.html">https://docs.unity3d.com/Packages/com.unity.memoryprofiler@0.2/manual/index.html</a></p>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ä¼˜åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> Unity </tag>
            
            <tag> Android </tag>
            
            <tag> iOS </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>4.Android Profiler</title>
      <link href="/2020/09/25/unity/xing-neng-you-hua/4.androidprofiler/"/>
      <url>/2020/09/25/unity/xing-neng-you-hua/4.androidprofiler/</url>
      
        <content type="html"><![CDATA[<p>Android è°ƒè¯•Unityç¨‹åºï¼Œéœ€è¦ä½¿ç”¨<code>PlayerSettings.SetIl2CppCompilerConfiguration</code>è®¾ç½®ä¸º Debug å¯è°ƒå¼il2cppã€‚</p><div class="sourceCode" id="cb1"><pre class="sourceCode c#"><code class="sourceCode cs"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">//è°ƒè¯• il2cpp</span></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    PlayerSettings<span class="op">.</span><span class="fu">SetIl2CppCompilerConfiguration</span><span class="op">(</span>BuildTargetGroup<span class="op">.</span><span class="fu">Android</span><span class="op">,</span> Il2CppCompilerConfiguration<span class="op">.</span><span class="fu">Debug</span><span class="op">)</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// debug æ¨¡å¼</span></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    EditorUserBuildSettings<span class="op">.</span><span class="fu">development</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">//ä¸‹é¢ä¸º Unity Profiler è°ƒè¯•é€‰é¡¹</span></span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    EditorUserBuildSettings<span class="op">.</span><span class="fu">connectProfiler</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    EditorUserBuildSettings<span class="op">.</span><span class="fu">buildWithDeepProfilingSupport</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    </span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ä»£ç æ–­ç‚¹è°ƒè¯•</span></span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    EditorUserBuildSettings<span class="op">.</span><span class="fu">allowDebugging</span> <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span></code></pre></div><p><a href="https://source.android.com/devices/tech/debug/native-memory">https://source.android.com/devices/tech/debug/native-memory</a><a href="https://perfetto.dev/#/heapprofd">Heapprofd</a></p>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ä¼˜åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> Unity </tag>
            
            <tag> Android </tag>
            
            <tag> iOS </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>8. GPUä¼˜åŒ–</title>
      <link href="/2020/09/25/unity/xing-neng-you-hua/8.gpu/"/>
      <url>/2020/09/25/unity/xing-neng-you-hua/8.gpu/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€gpu">ä¸€ã€GPU</h2><ol type="1"><li>SetPassCallæ¸²æŸ“çŠ¶æ€åˆ‡æ¢é¢‘æ¬¡æ§åˆ¶</li><li>DrawCallæ•°é‡æ§åˆ¶</li><li>å¸¦å®½è´Ÿè½½</li><li>æ˜¾å­˜å ç”¨</li><li>GPUè®¡ç®—é‡</li></ol><h2 id="äºŒèµ„æºä¼˜åŒ–">äºŒã€èµ„æºä¼˜åŒ–</h2><ol type="1"><li>çº¹ç†ä¼˜åŒ–</li><li>UIä¼˜åŒ–</li><li>å­—ä½“ä¼˜åŒ–</li><li>æ¨¡å‹ä¼˜åŒ–</li><li>åœºæ™¯ä¼˜åŒ–</li><li>ç²’å­ä¼˜åŒ–</li><li>æè´¨ä¼˜åŒ–</li><li>æŒ‡å®šæ ‡å‡†ç¾æœ¯è§„èŒƒ</li><li>Shaderå˜ä½“æ•°é‡ä¼˜åŒ–</li></ol>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ä¼˜åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> Unity </tag>
            
            <tag> Android </tag>
            
            <tag> iOS </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>5.RDC Profiler</title>
      <link href="/2020/09/25/unity/xing-neng-you-hua/5.renderdoc-python-zi-dong-hua-gong-ju/"/>
      <url>/2020/09/25/unity/xing-neng-you-hua/5.renderdoc-python-zi-dong-hua-gong-ju/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è‡ªåŠ¨åŒ–æˆªå¸§/è‡ªåŠ¨åŒ–å›æ”¾åˆ†æ</p></blockquote><h2 id="æˆªå¸§-capure.py">æˆªå¸§ (capure.py)</h2><div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># _*_ encoding:utf-8 _*_</span></span><span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdc_mudule <span class="im">import</span> <span class="op">*</span></span><span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>rd <span class="op">=</span> IfImportRdcPackage()</span><span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    status, protocol_to_use <span class="op">=</span> SelectSupportedDeviceProtocols()</span><span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    status, protocol_controller, URL <span class="op">=</span> GetDeviceProtocolController(protocol_to_use)</span><span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    CheckRdcRemoteEnv(protocol_controller, URL)</span><span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    status,remote_server <span class="op">=</span> ConnectRemoteServer(URL, protocol_controller)</span><span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># å¡«å†™è‡ªå·±çš„</span></span><span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    executeResult <span class="op">=</span> ExecuteAndInjectPackage(remote_server,<span class="st">'åŒ…å'</span>, <span class="st">'å¯åŠ¨çš„Activityå'</span>)</span><span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    killEvt, th <span class="op">=</span> PingRemoteServer(remote_server)</span><span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># URL, ident, ClientName, ForceConnect</span></span><span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    captureController <span class="op">=</span> rd.CreateTargetControl(URL, result.ident, <span class="st">'auto py script'</span>, <span class="va">True</span>)</span><span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> captureController:</span><span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        KillPingRemoteServer(killEvt, th)</span><span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        ShutdownServerAndConnection(remote_server)</span><span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">RuntimeError</span>(<span class="ss">f"æ— æ³•è¿æ¥è°ƒè¯• app"</span>)</span><span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f"-------------- å¯åŠ¨è°ƒè¯• æˆåŠŸ --------------"</span>)  </span><span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># å¼€å§‹æˆªå¸§ç‡</span></span><span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    msg <span class="op">=</span> TriggerCapture(captureController, <span class="dv">1</span>)</span><span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    cap_path <span class="op">=</span> msg.newCapture.path</span><span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    cap_id <span class="op">=</span> msg.newCapture.captureId</span><span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Got new capture at </span><span class="sc">{</span>cap_path<span class="sc">}</span><span class="ss"> which is frame </span><span class="sc">{</span>msg<span class="sc">.</span>newCapture<span class="sc">.</span>frameNumber<span class="sc">}</span><span class="ss"> with </span><span class="sc">{</span>msg<span class="sc">.</span>newCapture<span class="sc">.</span>api<span class="sc">}</span><span class="ss">"</span>)</span><span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    </span><span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">#ç»“æŸæˆªå¸§</span></span><span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    captureController.Shutdown()</span><span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    captureController <span class="op">=</span> <span class="va">None</span></span><span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    KillPingRemoteServer(killEvt, th)</span><span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span><span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    ShutdownServerAndConnection(remote_server)</span><span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span></code></pre></div><h2 id="å›æ”¾replay.py">å›æ”¾(replay.py)</h2><div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _*_ encoding:utf-8 _*_</span></span><span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rdc_mudule <span class="im">import</span> <span class="op">*</span></span><span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>rd <span class="op">=</span> IfImportRdcPackage()</span><span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> ReplayContext(<span class="bu">object</span>):</span><span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, replayController):</span><span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.controller <span class="op">=</span> replayController</span><span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._drawcalls <span class="op">=</span> <span class="va">None</span></span><span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> GetDrawcalls(<span class="va">self</span>):</span><span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._drawcalls <span class="op">==</span> <span class="va">None</span>:</span><span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._drawcalls <span class="op">=</span> <span class="va">self</span>.controller.GetDrawcalls()</span><span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._drawcalls</span><span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> GetDrawcalls(<span class="va">self</span>):</span><span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>._drawcalls <span class="op">==</span> <span class="va">None</span>:</span><span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>._drawcalls <span class="op">=</span> <span class="va">self</span>.controller.GetDrawcalls()</span><span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">self</span>._drawcalls</span><span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span><span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    rd.InitialiseReplay(rd.GlobalEnvironment(), [])</span><span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    status, protocol_to_use <span class="op">=</span> SelectSupportedDeviceProtocols()</span><span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    status, protocol_controller, URL <span class="op">=</span> GetDeviceProtocolController(protocol_to_use)</span><span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    CheckRdcRemoteEnv(protocol_controller, URL)</span><span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    status, remote_server <span class="op">=</span> ConnectRemoteServer(URL, protocol_controller)</span><span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cap_path</span></span><span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    status, replayController <span class="op">=</span> remote_server.OpenCapture(rd.RemoteServer.NoPreference, cap_path, rd.ReplayOptions(), <span class="va">None</span>)</span><span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> status <span class="op">!=</span> rd.ReplayStatus.Succeeded:</span><span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">RuntimeError</span>(<span class="ss">f"Couldn't open </span><span class="sc">{</span>cap_path<span class="sc">}</span><span class="ss">, got error </span><span class="sc">{</span><span class="bu">str</span>(result.status)<span class="sc">}</span><span class="ss">"</span>)</span><span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span><span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        sampleCode(replayController)</span><span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>        <span class="co"># replayController.Shutdown()</span></span><span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>        <span class="co"># replayController = None</span></span><span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>        remote_server.CloseCapture(replayController)</span><span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a></span><span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>    KillPingRemoteServer(killEvt, th)</span><span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>    ShutdownServerAndConnection(remote_server)</span><span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    rd.ShutdownReplay()</span><span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>        </span></code></pre></div><h2 id="è¾…åŠ©éƒ¨åˆ†rdc_mudule.py">è¾…åŠ©éƒ¨åˆ†(rdc_mudule.py)</h2><div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># _*_ encoding:utf-8 _*_</span></span><span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>renderdoc_home  <span class="op">=</span> <span class="st">'C:/Program Files/RenderDoc'</span></span><span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>renderdoc_pymodule  <span class="op">=</span> renderdoc_home <span class="op">+</span> <span class="st">'/pymodules'</span></span><span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>scripts_home <span class="op">=</span> renderdoc_home <span class="op">+</span><span class="st">'/rdc_pys'</span></span><span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys, os, time, threading</span><span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>sys.path.append(renderdoc_pymodule)</span><span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>sys.path.append(scripts_home)</span><span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">"PATH"</span>] <span class="op">+=</span> os.pathsep <span class="op">+</span> os.path.abspath(renderdoc_home)</span><span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> sys.platform <span class="op">==</span> <span class="st">'win32'</span> <span class="kw">and</span> sys.version_info[<span class="dv">1</span>] <span class="op">&gt;=</span> <span class="dv">8</span>:</span><span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    os.add_dll_directory(renderdoc_home)</span><span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------- env -------------------------------</span></span><span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># import rdc_package </span></span><span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> IfImportRdcPackage():</span><span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'renderdoc'</span> <span class="kw">not</span> <span class="kw">in</span> sys.modules <span class="kw">and</span> <span class="st">'_renderdoc'</span> <span class="kw">not</span> <span class="kw">in</span> sys.modules:</span><span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        <span class="im">import</span> renderdoc</span><span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> renderdoc</span><span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------- logic -------------------------------</span></span><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>rd <span class="op">=</span> IfImportRdcPackage()</span><span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> namedtuple</span><span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> logging <span class="im">as</span> logger</span><span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co"># namedtuple('ProtocolSelection', ['protocols', devices])</span></span><span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> SelectSupportedDeviceProtocols()<span class="op">-&gt;</span>(<span class="bu">bool</span>, <span class="bu">str</span>):</span><span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    protocols <span class="op">=</span> rd.GetSupportedDeviceProtocols()</span><span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(protocols) <span class="op">&lt;=</span> <span class="dv">0</span>:</span><span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="st">'è¯·æ£€æŸ¥android ndk, sdkï¼Œ adbç¯å¢ƒ'</span>)</span><span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span>, <span class="va">None</span></span><span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>    protocol_to_use <span class="op">=</span> protocols[<span class="dv">0</span>]</span><span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f'å¤šç§æ–¹å¼é»˜è®¤è¿æ¥ç¬¬ä¸€ä¸ª:</span><span class="sc">{</span>protocol_to_use<span class="sc">}</span><span class="ss">'</span>)</span><span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">True</span>, protocol_to_use</span><span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> GetDeviceProtocolController(protocol_to_use:<span class="bu">str</span> <span class="op">=</span> <span class="st">'adb'</span>)<span class="op">-&gt;</span>(<span class="bu">bool</span>, rd.DeviceProtocolController, <span class="bu">str</span>):</span><span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    protocol_controller <span class="op">=</span> rd.GetDeviceProtocolController(protocol_to_use)</span><span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>    devices <span class="op">=</span> protocol_controller.GetDevices()</span><span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(devices) <span class="op">==</span> <span class="dv">0</span>:</span><span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="ss">f"æ²¡æœ‰ </span><span class="sc">{</span>protocol_to_use<span class="sc">}</span><span class="ss"> è®¾å¤‡è¿æ¥,è¯·æ£€æŸ¥è®¾å¤‡æ˜¯å¦è¿æ¥ï¼Œä»¥åŠè°ƒè¯•æ¨¡å¼æ˜¯å¦å¼€å¯"</span>)</span><span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span>, protocol_controller,<span class="va">None</span></span><span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>    dev <span class="op">=</span> devices[<span class="dv">0</span>]</span><span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>    name <span class="op">=</span> protocol_controller.GetFriendlyName(dev)</span><span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>    logger.info(<span class="ss">f'å¤šä¸ªè®¾å¤‡é»˜è®¤è¿æ¥ç¬¬ä¸€ä¸ª:</span><span class="sc">{</span>dev<span class="sc">}</span><span class="ss"> - named </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">'</span>)</span><span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>    URL <span class="op">=</span> protocol_controller.GetProtocolName() <span class="op">+</span> <span class="st">"://"</span> <span class="op">+</span> dev</span><span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">True</span>, protocol_controller,URL</span><span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> CheckRdcRemoteEnv(protocol_controller:rd.DeviceProtocolController, URL:<span class="bu">str</span>):</span><span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> protocol_controller.IsSupported(URL):</span><span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="ss">f"</span><span class="sc">{</span>dev<span class="sc">}</span><span class="ss"> ä¸æ”¯æŒ 'capture/replay' - å¯èƒ½ç‰ˆæœ¬å¤ªä½?"</span>)</span><span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">False</span></span><span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> protocol_controller.SupportsMultiplePrograms(URL):</span><span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>        ident <span class="op">=</span> rd.EnumerateRemoteTargets(URL, <span class="dv">0</span>)</span><span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ident <span class="op">!=</span> <span class="dv">0</span>:</span><span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>            logger.error(<span class="ss">f"</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> å·²ç»æœ‰ä¸€ä¸ªrdc ç¨‹åºæ­£åœ¨è¿è¡Œ,é»˜è®¤å¼ºåˆ¶å…³é—­ </span><span class="sc">{</span>ident<span class="sc">}</span><span class="ss">"</span>)</span><span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>            <span class="co"># å¼ºåˆ¶å…³é—­ </span><span class="al">TODO</span></span><span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>  </span><span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ConnectRemoteServer(URL:<span class="bu">str</span>, protocol_controller:rd.DeviceProtocolController)<span class="op">-&gt;</span>(<span class="bu">bool</span>, rd.RemoteServer):</span><span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span><span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="co">    è¿æ¥è¿œç¨‹æœåŠ¡å™¨, è‡ªåŠ¨é‡è¯•æ¬¡æ•°20æ¬¡</span></span><span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span><span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>    status,remote_server <span class="op">=</span> rd.CreateRemoteServerConnection(URL)</span><span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> status <span class="op">==</span> rd.ReplayStatus.NetworkIOFailed <span class="kw">and</span> protocol_controller <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span><span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>        maxRetry <span class="op">=</span> <span class="dv">20</span></span><span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>        retry <span class="op">=</span> <span class="dv">1</span></span><span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>        <span class="co"># å¾ªç¯é‡æ–°å¯åŠ¨</span></span><span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span><span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>            status <span class="op">=</span> protocol_controller.StartRemoteServer(URL)</span><span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> status <span class="op">==</span> rd.ReplayStatus.Succeeded:</span><span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span><span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> retry <span class="op">&gt;</span> maxRetry:</span><span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">TimeoutError</span>(<span class="st">'å¯åŠ¨rdc remote server fail'</span>)</span><span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>            logger.error(<span class="ss">f"å¯åŠ¨è¿œç¨‹ rdc server error: </span><span class="sc">{</span><span class="bu">str</span>(status)<span class="sc">}</span><span class="ss">, é‡æ–°å°è¯•å¯åŠ¨ ç¬¬</span><span class="sc">{</span>retry<span class="sc">}</span><span class="ss"> æ¬¡"</span>)</span><span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>            retry <span class="op">=</span> retry <span class="op">+</span><span class="dv">1</span></span><span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="fl">0.5</span>)</span><span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>        retry <span class="op">=</span> <span class="dv">1</span></span><span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>        <span class="co"># å¾ªç¯è¿æ¥</span></span><span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="va">True</span>:</span><span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>            status,remote_server <span class="op">=</span> rd.CreateRemoteServerConnection(URL)</span><span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> status <span class="op">==</span> rd.ReplayStatus.Succeeded:</span><span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span></span><span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>            </span><span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> retry <span class="op">&gt;</span> maxRetry:</span><span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">TimeoutError</span>(<span class="st">'è¿æ¥rdc remote server fail'</span>)</span><span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>            logger.error(<span class="ss">f"è¿æ¥ rdc server error: </span><span class="sc">{</span><span class="bu">str</span>(status)<span class="sc">}</span><span class="ss">, é‡æ–°å°è¯•å¯åŠ¨ ç¬¬</span><span class="sc">{</span>retry<span class="sc">}</span><span class="ss"> æ¬¡"</span>)</span><span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>            retry <span class="op">=</span> retry <span class="op">+</span><span class="dv">1</span></span><span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="fl">0.1</span>)</span><span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> status, remote_server</span><span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> PingRemoteServer(remote_server:rd.RemoteServer)<span class="op">-&gt;</span>(threading.Event, threading.Thread):</span><span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> ping_remote(remote_server, kill):</span><span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>        success <span class="op">=</span> <span class="va">True</span></span><span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> success <span class="kw">and</span> <span class="kw">not</span> kill.is_set():</span><span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>            success <span class="op">=</span> remote_server.Ping()</span><span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>            time.sleep(<span class="dv">1</span>)</span><span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>    kill <span class="op">=</span> threading.Event()</span><span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>    ping_thread <span class="op">=</span> threading.Thread(target<span class="op">=</span>ping_remote, args<span class="op">=</span>(remote_server,kill))</span><span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>    ping_thread.start()</span><span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> kill, ping_thread</span><span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ExecuteAndInjectPackage(remote_server:rd.RemoteServer, package:<span class="bu">str</span>, activity:<span class="bu">str</span>):</span><span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if not package or len(package.split('.'))[2] != 'Alibaba':</span></span><span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     pass</span></span><span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if not package or not activity:</span></span><span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     logger.error(f"å‚æ•°ä¸æ­£ç¡®ï¼Œpackage/activityä¸å¯¹, è¯·ä»”ç»†æ£€æŸ¥: {package}, {activity}")</span></span><span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     return False, None</span></span><span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>    <span class="co"># å±è”½æ£€æŸ¥ï¼Œ ç¡¬æ€§é€Ÿåº¦</span></span><span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>    home <span class="op">=</span> remote_server.GetHomeFolder()</span><span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>    InstalledPackages <span class="op">=</span> [path.filename <span class="cf">for</span> path <span class="kw">in</span>  remote_server.ListFolder(home)]</span><span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>    <span class="co"># if package not in InstalledPackages:</span></span><span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> pkg <span class="kw">in</span> InstalledPackages:</span><span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>        logger.info(<span class="ss">f"  --  </span><span class="sc">{</span>pkg<span class="sc">}</span><span class="ss">"</span>)</span><span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     logger.error(f"æ²¡æœ‰å®‰è£…æ¸¸æˆåŒ…ï¼Œ æˆ–è€…åŒ…åä¸å¯¹, è¯·ä»”ç»†æ£€æŸ¥: {package}")</span></span><span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     return False,None</span></span><span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a>    packageFullName <span class="op">=</span> package <span class="op">+</span><span class="st">'/'</span> <span class="op">+</span> activity</span><span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>    executeResult <span class="op">=</span> remote_server.ExecuteAndInject(packageFullName, <span class="st">''</span>, <span class="st">''</span>, [], rd.GetDefaultCaptureOptions())</span><span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>    maxRetry <span class="op">=</span> <span class="dv">3</span></span><span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>    retry <span class="op">=</span> <span class="dv">1</span></span><span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="va">True</span>:</span><span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> executeResult.status <span class="op">==</span> rd.ReplayStatus.Succeeded:   </span><span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span><span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>        </span><span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> retry <span class="op">&gt;</span> maxRetry:</span><span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">'å¯åŠ¨app fail, è¯·æ£€æŸ¥è¿æ¥ä»¥åŠå¼€å‘è€…æ¨¡å¼ç­‰é€‰é¡¹'</span>)</span><span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>        logger.error(<span class="ss">f"å¯åŠ¨app å¤±è´¥ </span><span class="sc">{</span>packageFullName<span class="sc">}</span><span class="ss">, error </span><span class="sc">{</span><span class="bu">str</span>(executeResult.status)<span class="sc">}</span><span class="ss">, é‡è¯•å¯åŠ¨ ç¬¬</span><span class="sc">{</span>retry<span class="sc">}</span><span class="ss">æ¬¡"</span>)            </span><span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>        executeResult <span class="op">=</span> remote_server.ExecuteAndInject(packageFullName, <span class="st">''</span>, <span class="st">''</span>, [], rd.GetDefaultCaptureOptions())</span><span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>        retry <span class="op">=</span> retry <span class="op">+</span><span class="dv">1</span></span><span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>        time.sleep(<span class="fl">0.5</span>)</span><span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> executeResult</span><span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> TriggerCapture(targetController: rd.TargetControl, count: <span class="bu">int</span> <span class="op">=</span> <span class="dv">1</span>)<span class="op">-&gt;</span>rd.TargetControlMessage:</span><span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>    target.TriggerCapture(<span class="dv">1</span>)</span><span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>    msg <span class="op">=</span> <span class="va">None</span></span><span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> time.clock()</span><span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> msg <span class="kw">is</span> <span class="va">None</span> <span class="kw">or</span> msg.<span class="bu">type</span> <span class="op">!=</span> rd.TargetControlMessageType.NewCapture:</span><span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>        msg <span class="op">=</span> target.ReceiveMessage(<span class="va">None</span>)</span><span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> time.clock() <span class="op">-</span> start <span class="op">&gt;</span> <span class="dv">30</span>:</span><span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span><span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> msg</span><span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> KillPingRemoteServer(evt: threading.Event, th: threading.Thread):</span><span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>    kill.<span class="bu">set</span>()</span><span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>    ping_thread.join()</span><span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ShutdownServerAndConnection(remote_server:rd.RemoteServer):</span><span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>    <span class="co">'''</span></span><span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a><span class="co">    æ–­å¼€è¿œç¨‹æœåŠ¡å™¨</span></span><span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a><span class="co">    '''</span></span><span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> remote_server:</span><span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span><span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a></span><span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>    remote_server.ShutdownServerAndConnection()</span><span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a></span></code></pre></div>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ä¼˜åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> Unity </tag>
            
            <tag> Android </tag>
            
            <tag> iOS </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>6.Unityå„ä¸ªå¹³å°è´´å›¾æ ¼å¼</title>
      <link href="/2020/09/25/unity/xing-neng-you-hua/6.unity-ge-ge-ping-tai-tie-tu-ge-shi/"/>
      <url>/2020/09/25/unity/xing-neng-you-hua/6.unity-ge-ge-ping-tai-tie-tu-ge-shi/</url>
      
        <content type="html"><![CDATA[<h2 id="pc">PC</h2><ul><li>é»˜è®¤<ul><li>RGB Compressed DXT1<br></li><li>RGBA Compressed DXT5</li></ul></li><li>RGB<ul><li>RGB Crunched DXT1</li><li>RGB Compressed DXT1</li><li>RGB Crunched DXT5</li><li>RGB Compressed DXT5</li></ul></li><li>RGBA<ul><li>RGBA Crunched DXT1</li><li>RGBA Compressed DXT1</li><li>RGBA Crunched DXT15</li><li>RGBA Compressed DXT5</li></ul></li></ul><h2 id="android">Android</h2><blockquote><p>ETC ä¸æ”¯æŒalphaé€šé“ï¼Œ ETC2 æ”¯æŒalphaé€šé“ï¼Œéœ€è¦OpenGL ES 3.0æ”¯æŒã€‚</p></blockquote><ul><li>é»˜è®¤<ul><li>RGB Compressed ETC 4 bits<br></li><li>RGBA Compressed ETC2 8 bits</li></ul></li><li>RGB<ul><li>RGB Crunched ETC</li><li>RGB Compressed ETC 4 bits</li><li>RGB Compressed ETC2 4 bits</li></ul></li><li>RGBA<ul><li>RGBA Crunched ETC2</li><li>RGB + 1-bit Alpha Crunched ETC2 4 bits</li><li>RGBA Compressed ETC2 4 bits</li><li>RGBA Compressed ETC2 8 bits</li></ul></li></ul><h2 id="ios">ios</h2><ul><li>é»˜è®¤<ul><li>RGB Compressed PVRTC 4 bits<br></li><li>RGBA Compressed PVRTC 4 bits<br></li><li>RGB ASTC(4x4ã€5x5ã€6x6ã€8x8ã€10x10ã€12x12)ã€‚</li></ul></li><li>RGB<ul><li>RGB Compressed PVRTC 2 bits<br></li><li>RGB Compressed PVRTC 4 bits</li><li>RGBA ASTC(4x4ã€5x5ã€6x6ã€8x8ã€10x10ã€12x12)ã€‚</li></ul></li><li>RGBA<ul><li>RGBA Compressed PVRTC 2 bits<br></li><li>RGBA Compressed PVRTC 4 bits</li></ul></li></ul><h2 id="é€šç”¨å…¨å¹³å°æ— å‹ç¼©æ ¼å¼">é€šç”¨å…¨å¹³å°<code>æ— å‹ç¼©</code>æ ¼å¼</h2><ul><li>RGB16ï¼Œ å¯¹æ¸å˜æ”¯æŒä¸å¥½</li><li>RGB32ï¼Œ</li><li>RGBA16ï¼Œ å¯¹æ¸å˜æ”¯æŒä¸å¥½</li><li>RGBA32ï¼Œ</li></ul><h2 id="androidetc2fallback">AndroidETC2Fallback</h2><blockquote><p>æ­¤æšä¸¾å…·æœ‰ä¸åŒè´¨é‡çš„å€¼ï¼Œç”¨äºåœ¨ä¸æ”¯æŒ ETC2 çº¹ç†æ ¼å¼çš„ Androidè®¾å¤‡ä¸Šè§£å‹ç¼© ETC2 çº¹ç†ã€‚ * Quality32Bit çº¹ç†å°†è§£å‹ç¼©ä¸º RGBA32 æ ¼å¼ã€‚ *Quality16Bit çº¹ç†å°†è§£å‹ç¼©ä¸ºåˆé€‚çš„ 16 ä½æ ¼å¼ã€‚ * Quality32BitDownscaledçº¹ç†å°†è§£å‹ç¼©ä¸º RGBA32 æ ¼å¼ï¼Œå¹¶ç¼©å°ä¸ºåŸå§‹çº¹ç†å®½åº¦å’Œé«˜åº¦çš„ä¸€åŠã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ä¼˜åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> Unity </tag>
            
            <tag> Android </tag>
            
            <tag> iOS </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>7. CPUä¼˜åŒ–</title>
      <link href="/2020/09/25/unity/xing-neng-you-hua/7.cpu/"/>
      <url>/2020/09/25/unity/xing-neng-you-hua/7.cpu/</url>
      
        <content type="html"><![CDATA[<p>cpuè€—æ—¶ 1. drawcall 2. åŠ¨ç”» 3. èµ„æºåŠ å¸è½½ 4. ugui é—®é¢˜ 1. Rebuild 2.Raycast 5. GCç³»ç»Ÿ 1. lua gc 2. C# GC 6. åˆ†å¸§æ’ä¸Šä¸‹ä¸€å¸§é‡ä»»åŠ¡ 7.è‡ªå®šä¹‰æ§ä»¶æ•ˆç‡ 8. å¸¸é©»å‘¨æœŸå‡½æ•° 1. Update 2. LateUpdate 3. OnGUI 4.FixedUpdate 9. å¼•æ“ç³»ç»Ÿ 1. ç½‘ç»œåºåˆ—åŒ–&amp;æ´¾å‘ 2. è¾“å…¥æŒ‡ä»¤çš„é¢‘ç‡ 3.åˆ†æ¨¡å—ç›‘æ§ 4. æ•°æ®åŒ…åˆå¹¶ 5. ä»£ç æ•ˆç‡ä»¥åŠé‡æ„</p>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ä¼˜åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> Unity </tag>
            
            <tag> Android </tag>
            
            <tag> iOS </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>9.ç½‘ç»œæ•°æ®ä¼˜åŒ–</title>
      <link href="/2020/09/25/unity/xing-neng-you-hua/9.wang-luo-shu-ju/"/>
      <url>/2020/09/25/unity/xing-neng-you-hua/9.wang-luo-shu-ju/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ç½‘ç»œä¼˜åŒ–">ä¸€ã€ç½‘ç»œä¼˜åŒ–</h2><ol type="1"><li>å‡å°‘æ— ç”¨å­—æ®µ</li><li>é™ä½å­—æ®µç²¾åº¦</li><li>é¿å…é‡å¤å‘é€</li><li>ç½‘ç»œå¼‚æ­¥åŒ–</li><li>å‹ç¼©æ— æ•ˆå­—èŠ‚</li><li>å‹ç¼©åè®®åŒ…</li></ol>]]></content>
      
      
      <categories>
          
          <category> æ€§èƒ½ä¼˜åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ€§èƒ½ä¼˜åŒ– </tag>
            
            <tag> Unity </tag>
            
            <tag> Android </tag>
            
            <tag> iOS </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1.æ¸²æŸ“æµæ°´çº¿</title>
      <link href="/2020/09/25/xuan-ran/ta-ru-men/1.xuan-ran-liu-shui-xian/"/>
      <url>/2020/09/25/xuan-ran/ta-ru-men/1.xuan-ran-liu-shui-xian/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¸²æŸ“æµæ°´çº¿render-pipline">æ¸²æŸ“æµæ°´çº¿(Render Pipline)</h2><p>ç®€åŒ–æµæ°´çº¿:</p><pre class="mermaid">graph TD;    A[æ•°æ®]--&gt;B[é¡¶ç‚¹Shader]--&gt;C[å…‰æ …åŒ–]--&gt;D[ç‰‡å…ƒç€è‰²å™¨]--&gt;E[æ¸²æŸ“è¾“å‡º];</pre><p><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Graphics_pipeline_basics/Introduction">vulkan-tutorialä»‹ç»</a></p><p><img src="https://vulkan-tutorial.com/images/vulkan_simplified_pipeline.svg"></p><ol type="1"><li>è¾“å…¥è£…è½½ã€‚ ä»æäº¤çš„bufferä¸­, æ ¹æ®è®¾ç½®æ”¶é›†é¡¶ç‚¹æ•°æ®ã€‚</li><li>é¡¶ç‚¹ç€è‰²å™¨ã€‚å¯¹æ¯ä¸ªé¡¶ç‚¹è¿›è¡Œå¤„ç†ï¼Œé€šå¸¸æ˜¯æ‰§è¡Œé¡¶ç‚¹ä»æ¨¡å‹ç©ºé—´è½¬æ¢åˆ°å±å¹•ç©ºé—´ã€‚ç„¶åå†ä¼ é€’åˆ°æµæ°´çº¿ä¸­ã€‚</li><li>æ›²é¢ç»†åˆ†ç€è‰²å™¨ã€‚æ ¹æ®æŸäº›è§„åˆ™ç»†åˆ†ç½‘æ ¼ä»¥æé«˜è´¨é‡ã€‚</li><li>å‡ ä½•ç€è‰²å™¨ã€‚å¯¹æ¯ä¸ªå›¾å…ƒ(ä¸‰è§’å½¢ã€çº¿ã€ç‚¹)è¿›è¡Œå¤„ç†ï¼Œä¸¢å¼ƒæˆ–è€…è¾“å‡ºæ›´å¤šçš„å›¾å…ƒã€‚ç±»ä¼¼<code>æ›²é¢ç»†åˆ†ç€è‰²å™¨</code>ï¼Œä½†æ›´çµæ´»ã€‚</li><li>å…‰æ …åŒ–é˜¶æ®µã€‚å°†å›¾å…ƒç¦»æ•£ä¸ºç‰‡å…ƒã€‚è¿™äº›æ˜¯ä»–ä»¬åœ¨ç¼“å†²åŒºä¸­å¡«å……çš„å…ƒç´ ã€‚ä»»ä½•å±å¹•å¤–çš„ç‰‡å…ƒéƒ½å°†è¢«ä¸¢å¼ƒï¼Œ<code>é¡¶ç‚¹ç€è‰²å™¨è¾“å‡ºçš„å±æ€§éƒ½å°†è¢«æ’å€¼åˆ°ç‰‡å…ƒä¸­</code>ã€‚</li><li>ç‰‡å…ƒç€è‰²å™¨ã€‚ä¸º<code>æ¯ä¸ªå¹¸å­˜çš„ç‰‡å…ƒ</code>æ‰§è¡Œç‰‡å…ƒç€è‰²å™¨ï¼Œå¹¶ç¡®å®šå°†ç‰‡å…ƒå†™å…¥<code>å“ªäº›ç¼“å†²åŒº</code>ä»¥åŠä½¿ç”¨<code>å“ªäº›é¢œè‰²</code>å’Œ<code>æ·±åº¦å€¼</code>ã€‚å®ƒå¯ä»¥ä½¿ç”¨æ¥è‡ªé¡¶ç‚¹ç€è‰²å™¨çš„æ’å€¼æ•°æ®æ¥æ‰§è¡Œæ­¤æ“ä½œï¼Œå…¶ä¸­å¯ä»¥åŒ…æ‹¬çº¹ç†åæ ‡å’Œå…‰ç…§æ³•çº¿ç­‰å†…å®¹ã€‚</li><li>æ··åˆé˜¶æ®µï¼ˆé€åƒç´ å¤„ç†é˜¶æ®µï¼‰ã€‚åº”ç”¨<code>æ··åˆæ“ä½œ</code>æ˜ å°„åˆ°åŒä¸€åƒç´ çš„ä¸åŒç‰‡å…ƒã€‚ç‰‡å…ƒæ··åˆå¯ä»¥æ˜¯ç›¸äº’è¦†ç›–ã€å åŠ æˆ–è€…åŸºäºé€æ˜åº¦çš„æ··åˆã€‚</li></ol><ul><li>å…¶ä¸­è¾“å…¥è£…è½½ã€å…‰æ …åŒ–ã€æ··åˆé˜¶æ®µç§°ä¹‹ä¸º<code>å›ºå®šåŠŸèƒ½é˜¶æ®µ</code>ã€‚è¿™äº›é˜¶æ®µæ˜¯é¢„å®šä¹‰çš„ï¼Œå…è®¸ä½¿ç”¨é€‰é¡¹/å‚æ•°è°ƒæ•´ä»–ä»¬çš„æ“ä½œã€‚æ¯”å¦‚:<ol type="1"><li>è¾“å…¥è£…è½½ã€‚æäº¤é¡¶ç‚¹æ•°æ®è¿›è¡Œæ¸²æŸ“éœ€è¦åˆ›å»ºä¸€ä¸ªé¡¶ç‚¹æµï¼Œç„¶åå‘Šè¯‰Piplineå¦‚ä½•è§£é‡Šè¯¥æµã€‚(å„ç§é¡¶ç‚¹buffå¡«å……ä¸ç»‘å®šæäº¤)</li><li>å…‰æ …åŒ–ã€‚<a href="https://www.khronos.org/opengl/wiki/Rendering_Pipeline_Overview#Rasterization">å¤šé‡é‡‡æ ·</a>ã€‚</li><li>æ··åˆé˜¶æ®µã€‚<ol type="1"><li>åƒç´ æ‰€æœ‰æƒæµ‹è¯•ï¼ˆPixel ownership testï¼‰ã€‚å¦‚æœç‰‡æ®µçš„åƒç´ ä¸æ˜¯OpenGLâ€œæ‹¥æœ‰â€çš„ï¼ˆå¦‚æœå¦ä¸€ä¸ªçª—å£ä¸ GL çª—å£é‡å ï¼‰ï¼Œåˆ™å¤±è´¥ã€‚ä½¿ç”¨FramebufferObjectæ—¶æ€»æ˜¯é€šè¿‡ã€‚å¤±è´¥æ„å‘³ç€åƒç´ åŒ…å«æœªå®šä¹‰çš„å€¼ã€‚</li><li>è£å‰ªæµ‹è¯•ï¼ˆScissorTestï¼‰ï¼šå¯ç”¨åï¼Œå¦‚æœç‰‡æ®µçš„åƒç´ ä½äºå±å¹•çš„æŒ‡å®šçŸ©å½¢ä¹‹å¤–ï¼Œåˆ™æµ‹è¯•å¤±è´¥ã€‚</li><li>æ¨¡æ¿æµ‹è¯•ï¼ˆStencilTestï¼‰ï¼šï¼šå¯ç”¨åï¼Œå¦‚æœæµ‹è¯•æä¾›çš„æ¨¡æ¿å€¼æ²¡æœ‰ä¸ç”¨æˆ·æŒ‡å®šçš„æ¨¡æ¿ç¼“å†²åŒºä¸­åº•å±‚æ ·æœ¬çš„æ¨¡æ¿å€¼è¿›è¡Œæ¯”è¾ƒï¼Œåˆ™æµ‹è¯•å¤±è´¥ã€‚è¯·æ³¨æ„ï¼Œå³ä½¿æ¨¡æ¿æµ‹è¯•å¤±è´¥ï¼ˆå³ä½¿æ·±åº¦æµ‹è¯•å¤±è´¥ï¼‰ï¼Œä»ç„¶å¯ä»¥ä¿®æ”¹å¸§ç¼“å†²åŒºä¸­çš„æ¨¡æ¿å€¼ã€‚</li><li>æ·±åº¦æµ‹è¯•ï¼ˆDepthTestï¼‰ï¼šå¯ç”¨åï¼Œå¦‚æœç‰‡æ®µçš„æ·±åº¦æ²¡æœ‰æŒ‰ç…§ç”¨æˆ·æŒ‡å®šçš„ä¸æ·±åº¦ç¼“å†²åŒºä¸­åŸºç¡€æ ·æœ¬çš„æ·±åº¦å€¼è¿›è¡Œæ¯”è¾ƒï¼Œåˆ™æµ‹è¯•å¤±è´¥ã€‚</li></ol></li></ol></li></ul><p>** æ³¨æ„ï¼šè™½ç„¶è¿™äº›è¢«æŒ‡å®šåœ¨FragmentShaderä¹‹åå‘ç”Ÿï¼Œä½†åœ¨æŸäº›æ¡ä»¶ä¸‹å®ƒä»¬å¯ä»¥åœ¨ç‰‡æ®µç€è‰²å™¨ä¹‹å‰å‘ç”Ÿã€‚å¦‚æœå®ƒä»¬å‘ç”Ÿåœ¨FS ä¹‹å‰ï¼Œé‚£ä¹ˆç‰‡æ®µçš„ä»»ä½•å‰”é™¤ä¹Ÿä¼šé˜»æ­¢ç‰‡æ®µç€è‰²å™¨æ‰§è¡Œï¼Œä»è€ŒèŠ‚çœæ€§èƒ½ã€‚åœ¨æ­¤ä¹‹åæ‰§è¡Œé¢œè‰²æ··åˆã€‚å¯¹äºæ¯ä¸ªç‰‡æ®µé¢œè‰²å€¼ï¼Œåœ¨å®ƒä¸è¯¥ä½ç½®å¸§ç¼“å†²åŒºä¸­å·²ç»å­˜åœ¨çš„é¢œè‰²ä¹‹é—´éƒ½æœ‰ä¸€ä¸ªç‰¹å®šçš„æ··åˆæ“ä½œã€‚é€»è¾‘æ“ä½œä¹Ÿå¯ä»¥ä»£æ›¿æ··åˆè¿›è¡Œï¼Œæ··åˆåœ¨ç‰‡æ®µé¢œè‰²å’Œå¸§ç¼“å†²åŒºé¢œè‰²ä¹‹é—´æ‰§è¡ŒæŒ‰ä½æ“ä½œã€‚**</p><p>æœ€åï¼Œå°†ç‰‡æ®µæ•°æ®å†™å…¥å¸§ç¼“å†²åŒºã€‚å±è”½æ“ä½œå…è®¸ç”¨æˆ·é˜²æ­¢å†™å…¥æŸäº›å€¼ã€‚å¯ä»¥æ‰“å¼€å’Œå…³é—­é¢œè‰²ã€æ·±åº¦å’Œæ¨¡æ¿ä¹¦å†™ï¼›å•ä¸ªé¢œè‰²é€šé“ä¹Ÿå¯ä»¥è¢«å±è”½ã€‚</p><figure><img src="https://www.khronos.org/opengl/wiki_opengl/images/RenderingPipeline.png" alt="opengl pipline"><figcaption aria-hidden="true">opengl pipline</figcaption></figure><p><a href="https://www.khronos.org/opengl/wiki/Rendering_Pipeline_Overview#Rasterization">https://www.khronos.org/opengl/wiki/Rendering_Pipeline_Overview#Rasterization</a></p>]]></content>
      
      
      <categories>
          
          <category> å›¾å½¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¸²æŸ“ </tag>
            
            <tag> å›¾å½¢ </tag>
            
            <tag> TA </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3.çŸ©é˜µ</title>
      <link href="/2020/09/23/3d-shu-xue/3.ju-zhen/"/>
      <url>/2020/09/23/3d-shu-xue/3.ju-zhen/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è¡Œå’Œåˆ—çš„å½¢å¼ç»„ç»‡æ•°å­—å—ã€‚</p></blockquote><ul><li><p>è¡Œåˆ—ç›¸åŒçš„çŸ©é˜µ--- <code>æ–¹é˜µ</code> <span class="math display">\[\begin{bmatrix}m_{11}&amp;m_{12}&amp;m_{13}\\m_{21}&amp;m_{22}&amp;m_{23}\\m_{31}&amp;m_{32}&amp;m_{33}\end{bmatrix}\]</span></p><ul><li>å¯¹è§’çŸ©é˜µï¼Œéå¯¹è§’çº¿éƒ½ä¸º0ï¼Œå¯¹è§’çº¿å¯0å¯é0çš„<strong><code>ç‰¹æ®Šæ–¹é˜µ</code></strong></li></ul><p><span class="math display">\[\begin{bmatrix}m_{11}&amp;0&amp;0\\0&amp;m_{22}&amp;0\\0&amp;0&amp;m_{33}\end{bmatrix}\]</span></p><ul><li>å•ä½çŸ©é˜µ<strong>I</strong>ï¼Œå¯¹è§’çº¿å…ƒç´ ä¸º1çš„<strong><code>ç‰¹æ®Šå¯¹è§’çŸ©é˜µ</code></strong> <span class="math display">\[\begin{bmatrix}1&amp;0&amp;0\\0&amp;1&amp;0\\0&amp;0&amp;1\end{bmatrix}\]</span></li></ul></li><li><p>å•è¡Œå•åˆ—çŸ©é˜µ---<code>å‘é‡</code> <span class="math display">\[è¡ŒçŸ©é˜µ(å‘é‡) \begin{bmatrix}m_{11}&amp;m_{12}&amp;m_{13}\end{bmatrix}\]</span></p><p><span class="math display">\[åˆ—çŸ©é˜µ(å‘é‡)\begin{bmatrix}m_{11}\\m_{12}\\m_{13}\end{bmatrix}\]</span></p></li><li><p>çŸ©é˜µè¿ç®—</p><ul><li>çŸ©é˜µè½¬ç½®</li></ul><p><span class="math display">\[M^{T}_{ij} = M_{ji}\]</span></p><p><span class="math display">\[ä¾‹å¦‚ï¼š \begin{bmatrix}1&amp;2\\3&amp;4\\5&amp;6\end{bmatrix}^T =\begin{bmatrix}1&amp;3 &amp;5\\2&amp;4&amp;6\end{bmatrix}\]</span></p><ul><li><p>æ ‡é‡ä¸çŸ©é˜µä¹˜æ³•ï¼Œæ ‡é‡ä¸çŸ©é˜µæ¯ä¸ªå…ƒç´ ç›¸ä¹˜ã€‚ <span class="math display">\[k\begin{bmatrix}m_{11}&amp;m_{12}&amp;m_{13}\\m_{21}&amp;m_{22}&amp;m_{23}\\m_{31}&amp;m_{32}&amp;m_{33}\end{bmatrix}=\begin{bmatrix}km_{11}&amp;km_{12}&amp;km_{13}\\km_{21}&amp;km_{22}&amp;km_{23}\\km_{31}&amp;km_{32}&amp;km_{33}\end{bmatrix}\]</span></p></li><li><p>çŸ©é˜µå’ŒçŸ©é˜µä¹˜æ³•ï¼Œ<strong>A</strong><strong>B</strong>çŸ©é˜µç›¸ä¹˜ï¼Œå‰ææ˜¯ <strong>Açš„åˆ—å¿…é¡»ç­‰äºBçš„è¡Œ</strong>ï¼Œ ç»“æœä¸º Aè¡ŒBåˆ—çš„çŸ©é˜µã€‚ <span class="math display">\[C_{ij} = \sum_{k=1}^{n}a_{ik}b_{ki}, nä¸º açš„åˆ—ï¼Œbçš„è¡Œ\]</span> açš„ iè¡Œ å¯¹åº”ä¹˜ä»¥ bçš„jåˆ—ï¼Œç„¶åæ±‚å’Œ ä½œä¸º ijçš„å€¼ã€‚ <span class="math display">\[ä¾‹å¦‚ï¼š\begin{bmatrix}a_{11}&amp;a_{12}&amp;a_{13}\\a_{21}&amp;a_{22}&amp;a_{23}\end{bmatrix}\begin{bmatrix}b_{11}&amp;b_{12}\\b_{21}&amp;b_{22}\\b_{31}&amp;b_{32}\end{bmatrix}= \begin{bmatrix}a_{11}b_{11}+a_{12}b_{21} + a_{13}b_{31}&amp;a_{11}b_{12}+a_{12}b_{22} + a_{13}b_{32}\\a_{21}b_{11}+a_{22}b_{21} + a_{23}b_{31}&amp;a_{21}b_{12}+a_{22}b_{22} + a_{23}b_{32}\end{bmatrix}\]</span></p><p><span class="math display">\[ä¾‹å¦‚ï¼š\begin{bmatrix}1&amp;3&amp;5\\7&amp;9&amp;11\end{bmatrix}\begin{bmatrix}2&amp;4\\6&amp;8\\10&amp;12\end{bmatrix}= \begin{bmatrix}1*2+3 *6 + 5*10&amp;1*4 + 3*8 + 5*12\\7*2 + 9* 6 + 11 * 10&amp;7*4 + 9*8 + 11 * 12\end{bmatrix}= \begin{bmatrix}70 &amp; 88\\178 &amp; 316\end{bmatrix}\]</span></p></li><li><p>ä»»æ„çŸ©é˜µ <code>M</code>ä¹˜ä»¥æ–¹é˜µ <code>S</code> ç­‰äºåŸçŸ©é˜µï¼Œ <span class="math display">\[MI = IM= M\]</span></p></li></ul></li><li><p>çŸ©é˜µä¹˜æ³•<code>æ»¡è¶³ç»“åˆå¾‹ï¼ˆæ ‡é‡ä¹Ÿé€‚ç”¨ï¼‰</code>ï¼Œ<code>ä¸æ»¡è¶³äº¤æ¢å¾‹</code>,æ ‡é‡æ»¡è¶³äº¤æ¢å¾‹ï¼Œ<code>çŸ©é˜µç›¸ä¹˜çš„è½¬ç½® ç­‰äºæ¯ä¸ªè½¬ç½®çš„ä¹˜æ³•</code></p></li><li><p>çŸ©é˜µå‡ ä½•è§£é‡Š</p><ul><li>æ—‹è½¬</li><li>ç¼©æ”¾</li><li>æŠ•å½±</li><li>é•œåƒ</li><li>ä»¿å°„</li></ul></li><li><p>çŸ©é˜µå˜æ¢å‘é‡çš„è¿‡ç¨‹ï¼š</p><ul><li><p>ä¾‹å¦‚ [1, -3, -4] ,å¯ç†è§£ä¸º [0,0,0] å…ˆä½ç§» [1,0,0], å†ä½ç§»[0,-3,0] ï¼Œå†ä½ç§» [0,0,-4] <span class="math display">\[\begin{bmatrix} 1 \\-3\\ -4 \end{bmatrix} = \begin{bmatrix} 1 \\0 \\0\end{bmatrix} + \begin{bmatrix} 0 \\-3 \\0 \end{bmatrix} +\begin{bmatrix} 0 \\0 \\-4 \end{bmatrix}\]</span></p></li><li><p>å¯¹äºä»»æ„çš„å‘é‡ <code>v</code>éƒ½èƒ½åæˆ <code>'æ‹“å±•'</code>å½¢å¼<span class="math display">\[v = \begin{bmatrix} x \\y\\ z \end{bmatrix} = x\begin{bmatrix} 1 \\0 \\0\end{bmatrix} + y\begin{bmatrix} 0 \\1 \\0 \end{bmatrix} +z\begin{bmatrix} 0 \\0 \\1 \end{bmatrix}   ã€1ã€‘\]</span></p></li><li><p>å¦‚æœæŠŠå…¬å¼ ã€1ã€‘çš„å•ä½å‘é‡åˆ†åˆ«ç”¨<strong>p,g,rï¼ˆåŸºå‘é‡éœ€è¦çº¿æ€§æ— å…³ï¼‰</strong> ä»£æ›¿ï¼Œåˆ™å¯å†™æˆ <span class="math display">\[v = xp + yg+ zr ã€2ã€‘\]</span></p></li><li><p>å°†å‘é‡è¡¨ç¤ºä¸ºåŸºå‘é‡çš„çº¿æ€§ç»„å’Œ <span class="math display">\[M = \begin{bmatrix} p \\g\\ r \end{bmatrix} = \begin{bmatrix} p_x &amp;p_y &amp; p_z \\g_x&amp;g_y&amp;g_z \\r_x&amp;r_y&amp;r_z \end{bmatrix}ã€3ã€‘\]</span></p></li><li><p>ä½¿ç”¨å…¬å¼ã€3ã€‘Må±•å¼€å…¬å¼ã€2ã€‘ <span class="math display">\[\begin{bmatrix} x &amp;y&amp;z \end{bmatrix}\ \begin{bmatrix} p_x &amp;p_y &amp; p_z \\g_x&amp;g_y&amp;g_z \\r_x&amp;r_y&amp;r_z \end{bmatrix}= \begin{bmatrix}xp_x + yg_x +zr_x &amp; xp_y + yg_y +zr_y &amp; xp_z + yg_z + zr_z\end{bmatrix}== xp + yg+ zrã€4ã€‘\]</span></p></li><li><p>è¯æ˜ã€4ã€‘æœ€åä¸€æ­¥ï¼Œåˆå› ä¸º<strong>M</strong>ä¸ºåŸºå‘é‡çš„å±•å¼€å¼ï¼Œæ‰€ä»¥ <span class="math display">\[\begin{bmatrix} x &amp;y&amp;z \end{bmatrix}\ \begin{bmatrix} p_x &amp;p_y &amp; p_z \\g_x&amp;g_y&amp;g_z \\r_x&amp;r_y&amp;r_z \end{bmatrix}= \begin{bmatrix} x &amp;y&amp;z \end{bmatrix}\ \begin{bmatrix} p \\g\\r \end{bmatrix}\]</span></p><p><span class="math display">\[æ‰€ä»¥ \begin{bmatrix}xp_x + yg_x +zr_x &amp; xp_y + yg_y +zr_y &amp; xp_z + yg_z + zr_z\end{bmatrix} = xp + yg+ zr\]</span></p></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 3dæ•°å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼•æ“ </tag>
            
            <tag> 3dæ•°å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>4.å˜æ¢</title>
      <link href="/2020/09/23/3d-shu-xue/4.bian-huan/"/>
      <url>/2020/09/23/3d-shu-xue/4.bian-huan/</url>
      
        <content type="html"><![CDATA[<ol type="1"><li><p>æ—‹è½¬</p><ol type="1"><li><p>2Dæ—‹è½¬</p><p><img src="/imgs/rotate2d.png" style="zoom:80%;"> <span class="math display">\[2dæ„é€ çŸ©é˜µï¼š  R(\theta) = \begin{bmatrix} p^` \\q^` \end{bmatrix} =\begin{bmatrix} \cos\theta &amp; \sin\theta\\-\sin\theta &amp;\cos\theta\end{bmatrix}, p ä¸ºxè½´æ—‹è½¬ï¼Œ qä¸ºyè½´æ—‹è½¬ã€‚\]</span></p></li><li><p>3Dæ—‹è½¬ï¼Œ<code>ç»•è½´æ—‹è½¬</code></p><ol type="1"><li><p>åŒºåˆ†æ—‹è½¬æ–¹å‘ï¼Œ<code>å·¦æ‰‹æ³•åˆ™ï¼Œæ‰‹æ¡æ—‹è½¬è½´ï¼Œæ‹‡æŒ‡æœå‘æ­£æ–¹å‘ï¼Œå››æŒ‡ç»•å‘ä¸ºæ­£</code></p><table><thead><tr class="header"><th style="text-align: left;"></th><th style="text-align: center;">å·¦æ‰‹åæ ‡ç³»</th><th style="text-align: center;">å³æ‰‹åæ ‡ç³»</th></tr></thead><tbody><tr class="odd"><td style="text-align: left;">ä»å“ªè¾¹çœ‹</td><td style="text-align: center;">æ­£æ–¹å‘|è´Ÿæ–¹å‘</td><td style="text-align: center;">æ­£æ–¹å‘| è´Ÿæ–¹å‘</td></tr><tr class="even"><td style="text-align: left;">ä»è´Ÿç«¯å‘æ­£ç«¯çœ‹</td><td style="text-align: center;">é€†æ—¶é’ˆ|é¡ºæ—¶é’ˆ</td><td style="text-align: center;">é¡ºæ—¶é’ˆ|é€†æ—¶é’ˆ</td></tr><tr class="odd"><td style="text-align: left;">ä»æ­£ç«¯å‘è´Ÿç«¯çœ‹</td><td style="text-align: center;">é¡ºæ—¶é’ˆ|é€†æ—¶é’ˆ</td><td style="text-align: center;">é€†æ—¶é’ˆ|é¡ºæ—¶é’ˆ</td></tr></tbody></table></li><li><p>ç»•ç€xè½´æ—‹è½¬ï¼Œ(æ­¤æ—¶ç­‰äºæ—‹è½¬ yzç»„æˆçš„2dç¬›å¡å°”åæ ‡ç³»ï¼Œè€Œxè½´ä¸å˜ï¼Œå› æ­¤æ„é€ çŸ©é˜µå¦‚ä¸‹ï¼šï¼‰</p><p><img src="/imgs\rotate3d.png" style="zoom:80%;"> <span class="math display">\[ç»•xæ—‹è½¬çš„æ„é€ çŸ©é˜µï¼š  R(\theta) = \begin{bmatrix} p^`\\q^` \\r^`\end{bmatrix} = \begin{bmatrix} 1&amp;0&amp;0\\0&amp;\cos\theta &amp;\sin\theta\\0&amp;-\sin\theta &amp;\cos\theta \end{bmatrix}, pä¸ºxè½´æ—‹è½¬ï¼Œ qä¸ºyè½´æ—‹è½¬,rä¸ºzè½´æ—‹è½¬ã€‚\]</span><br></p></li><li><p>ç»•yæ—‹è½¬ç±»ä¼¼ï¼Œ(æ­¤æ—¶ç­‰äºæ—‹è½¬ xzç»„æˆçš„2dç¬›å¡å°”åæ ‡ç³»ï¼Œè€Œyè½´ä¸å˜ï¼Œå› æ­¤æ„é€ çŸ©é˜µå¦‚ä¸‹ï¼šï¼‰ <span class="math display">\[ç»•yæ—‹è½¬çš„æ„é€ çŸ©é˜µï¼š  R(\theta) = \begin{bmatrix} p^`\\q^` \\r^`\end{bmatrix} = \begin{bmatrix}\cos\theta&amp;0&amp;-\sin\theta\\0&amp; 1&amp;0 \\\sin\theta &amp;0&amp;\cos\theta \end{bmatrix}, p ä¸ºxè½´æ—‹è½¬ï¼Œqä¸ºyè½´æ—‹è½¬,rä¸ºzè½´æ—‹è½¬ã€‚\]</span></p></li><li><p>ç»•zæ—‹è½¬ç±»ä¼¼ï¼Œ(æ­¤æ—¶ç­‰äºæ—‹è½¬ xyç»„æˆçš„2dç¬›å¡å°”åæ ‡ç³»ï¼Œè€Œzè½´ä¸å˜ï¼Œå› æ­¤æ„é€ çŸ©é˜µå¦‚ä¸‹ï¼šï¼‰ <span class="math display">\[ç»•yæ—‹è½¬çš„æ„é€ çŸ©é˜µï¼š  R(\theta) = \begin{bmatrix} p^`\\q^` \\r^`\end{bmatrix} = \begin{bmatrix}\cos\theta&amp;\sin\theta&amp;0\\-\sin\theta &amp;\cos\theta &amp;0 \\0&amp; 0&amp; 1\end{bmatrix}, p ä¸ºxè½´æ—‹è½¬ï¼Œ qä¸ºyè½´æ—‹è½¬,rä¸ºzè½´æ—‹è½¬ã€‚\]</span><br></p></li><li><p>ç»•<strong>ä»»æ„æ–¹å‘ï¼Œä¸ä¾èµ–æ—‹è½¬è½´</strong>æ—‹è½¬ï¼ŒåŸç†ç±»ä¼¼ï¼Œå¿½ç•¥æ¨åˆ°ï¼Œå…¬å¼å¦‚ä¸‹ï¼š<span class="math display">\[R(n, \theta),ä»£è¡¨ ç»•næ–¹å‘æ—‹è½¬ \theta.\]</span><br><span class="math display">\[R(n,\theta) = \begin{bmatrix} p^`\\q^` \\r^` \end{bmatrix} =\begin{bmatrix}n_x^2(1-\cos\theta)+   \cos\theta&amp;n_xn_y(1-\cos\theta)+n_z\sin\theta&amp;n_xn_z(1-\cos\theta)-n_y\sin\theta\\n_xn_y(1-\cos\theta)-n_x\sin\theta&amp; n_y^2(1-\cos\theta)+   \cos\theta&amp;n_yn_z(1-\cos\theta)-n_x\sin\theta\\n_xn_z(1-\cos\theta)+n_y\sin\theta&amp;n_yn_z(1-\cos\theta)-n_x\sin\theta&amp;n_z^2(1-\cos\theta)+    \cos\theta\\\end{bmatrix}\]</span></p></li></ol></li></ol></li><li><p>ç¼©æ”¾</p><ol type="1"><li><p>æ²¿åæ ‡è½´ç¼©æ”¾ <span class="math display">\[S(k_x, k_y, k_z) = \begin{bmatrix}k_x &amp; 0 &amp;0\\0&amp;k_y&amp;0\\0&amp;0&amp;k_z\end{bmatrix}\]</span></p></li><li><p>æ²¿<strong>ä»»æ„æ–¹å‘ï¼Œä¸ä¾èµ–æ—‹è½¬è½´</strong>ç¼©æ”¾ <span class="math display">\[R(n, k),ä»£è¡¨ ç»•næ–¹å‘ç¼©æ”¾ k.\]</span></p><p><span class="math display">\[S(n,k) = \begin{bmatrix} p^`\\q^` \\r^` \end{bmatrix} = \begin{bmatrix}1+(k-1)n_x^2&amp; (k-1)n_xn_y&amp; (k-1)n_xn_z\\(k-1)n_xn_y&amp; 1+(k-1)n_y^2&amp; (k-1)n_yn_z\\(k-1)n_xn_z&amp; (k-1)n_zn_y&amp; 1+(k-1)n_z^2\end{bmatrix}\]</span></p></li></ol></li><li><p>æ­£äº¤æŠ•å½± &gt;ä¸€èˆ¬æ¥è¯´æŠ•å½±æ„å‘³ç€é™ç»´æ“ä½œï¼Œä¾‹å¦‚3dèµ‹å€¼ç»™2dï¼ŒæŠ›å¼ƒzã€‚ï¼ˆæ­£äº¤ã€å¹³è¡Œã€é€è§†æŠ•å½±ï¼‰</p><ol type="1"><li>å‘xè½´æŠ•å½±ï¼Œä¿ç•™xä¸º1ï¼Œ èˆå¼ƒéƒ¨åˆ†ç½®0 <span class="math display">\[P_x = S(\begin{bmatrix}0&amp;1\end{bmatrix} ,0) = \begin{bmatrix}1&amp;0\\0&amp;0 \end{bmatrix}\]</span></li><li>åŒç†yè½´æŠ•å½± <span class="math display">\[P_y = S(\begin{bmatrix}1&amp;0\end{bmatrix} ,0) = \begin{bmatrix}0&amp;0\\0&amp;1 \end{bmatrix}\]</span></li><li>å‘xyæŠ•å½± <span class="math display">\[P_{xy} = S(\begin{bmatrix}0&amp;0&amp;1\end{bmatrix} ,0) =\begin{bmatrix} 1&amp;0&amp;0\\0&amp;1&amp;0\\0&amp;0&amp;0\end{bmatrix}\]</span></li><li>å‘xzæŠ•å½± <span class="math display">\[P_{xz} = S(\begin{bmatrix}0&amp;1&amp;0\end{bmatrix} ,0) =\begin{bmatrix} 1&amp;0&amp;0\\0&amp;0&amp;0\\0&amp;0&amp;1\end{bmatrix}\]</span><br></li><li>å‘yzæŠ•å½± <span class="math display">\[P_{yz} = S(\begin{bmatrix}1&amp;0&amp;0\end{bmatrix} ,0) =\begin{bmatrix} 0&amp;0&amp;0\\0&amp;1&amp;0\\0&amp;0&amp;1\end{bmatrix}\]</span></li><li>å‘ä»»æ„å¹³é¢æŠ•å½± <span class="math display">\[P(n) = S(n, 0), nä»£è¡¨ä»»æ„ç›´çº¿/å¹³é¢\]</span><br><span class="math display">\[P(n) = S(n,0) = \begin{bmatrix}1+(0-1)n_x^2&amp; (0-1)n_xn_y&amp; (0-1)n_xn_z\\(0-1)n_xn_y&amp; 1+(0-1)n_y^2&amp; (0-1)n_yn_z\\(0-1)n_xn_z&amp; (0-1)n_zn_y&amp; 1+(0-1)n_z^2\end{bmatrix}\]</span></li></ol></li><li><p>é•œåƒ <code>ç¿»æŠ˜</code></p><ol type="1"><li>2D <span class="math display">\[P(n) = S(n,-1) = \begin{bmatrix}1+(-1-1)n_x^2&amp; (-1-1)n_xn_y\\(-1-1)n_xn_y&amp; 1+(-1-1)n_y^2\\(-1-1)n_xn_z&amp; (-1-1)n_zn_y\end{bmatrix}\]</span><br></li><li>3D <span class="math display">\[P(n) = S(n,-1) = \begin{bmatrix}1+(-1-1)n_x^2&amp; (-1-1)n_xn_y&amp; (-1-1)n_xn_z\\(-1-1)n_xn_y&amp; 1+(-1-1)n_y^2&amp; (-1-1)n_yn_z\\(-1-1)n_xn_z&amp; (-1-1)n_zn_y&amp; 1+(-1-1)n_z^2\end{bmatrix}= \begin{bmatrix}1-2n_x^2&amp; -2n_xn_y&amp;-2n_xn_z\\-2n_xn_y&amp; -2n_y^2&amp;-2n_yn_z\\-2n_xn_z&amp; -2n_zn_y&amp;-2n_z^2\\\end{bmatrix}\]</span></li></ol></li><li><p>åˆ‡å˜ï¼Œ<code>ï¼ˆéå‡åŒ€åœ°æ‹‰ä¼¸å®ƒï¼Œè§’åº¦å‘ç”Ÿå˜åŒ–ï¼Œé¢ç§¯å’Œä½“ç§¯ä¸å˜ï¼‰</code><img src="/imgs\tbian.png" style="zoom:80%;"><br><span class="math display">\[x^` = x + sy,  sä¸ºå˜åŒ–å› å­ã€‚ H_x(s)=\begin{bmatrix}1&amp;0\\s&amp;1\end{bmatrix}, xéšç€yè¢«åˆ‡å˜ï¼Œsæ§åˆ¶æ–¹å‘å’Œé‡\]</span></p><p><span class="math display">\[å¦ä¸€ç§å˜æ¢ H_yã€‚ H_y(s) =\begin{bmatrix}1&amp;s\\0&amp;1\end{bmatrix}, xéšç€yè¢«åˆ‡å˜ï¼Œsæ§åˆ¶æ–¹å‘å’Œé‡\]</span></p></li><li><p>3Dåˆ‡å˜</p><blockquote><p>3dä¸­çš„åˆ‡å˜æ˜¯å–å‡ºä¸€ä¸ªåæ ‡ä¹˜ä»¥ä¸åŒçš„å› å­ï¼Œå†åŠ åˆ°å…¶ä»–åæ ‡ä¸Šï¼ŒH_{xy}æ„ä¹‰æ˜¯ xyåæ ‡è¢«zæ”¹å˜ï¼Œ</p></blockquote><p><span class="math display">\[H_{xy}(s)=\begin{bmatrix}1&amp;0&amp;0\\0&amp;1&amp;0\\s&amp;t&amp;1\end{bmatrix}\]</span></p><p><span class="math display">\[H_{xz}(s)=\begin{bmatrix}1&amp;0&amp;0\\s&amp;1&amp;t\\0&amp;0&amp;1\end{bmatrix}\]</span></p><p><span class="math display">\[H_{yz}(s)=\begin{bmatrix}1&amp;s&amp;t\\0&amp;1&amp;0\\0&amp;0&amp;1\end{bmatrix}\]</span></p></li><li><p>ç»„åˆå˜æ¢</p><ol type="1"><li><p>åæ ‡ç³»ç»„åˆå˜æ¢ <span class="math display">\[P_{ä¸–ç•Œ} = P_{ç‰©ä½“}M_{ç‰©ä½“\rightarrowä¸–ç•Œ}\]</span></p><p><span class="math display">\[P_{ç›¸æœº} = P_{ä¸–ç•Œ}M_{ä¸–ç•Œ\rightarrowç›¸æœº} =(P_{ç‰©ä½“}M_{ç‰©ä½“\rightarrowä¸–ç•Œ})M_{ä¸–ç•Œ\rightarrowç›¸æœº} =P_{ç‰©ä½“}(M_{ç‰©ä½“\rightarrowä¸–ç•Œ}M_{ä¸–ç•Œ\rightarrowç›¸æœº})\]</span></p><p><span class="math display">\[M_{ç‰©ä½“\rightarrowç›¸æœº} = M_{ç‰©ä½“\rightarrowä¸–ç•Œ}M_{ä¸–ç•Œ\rightarrowç›¸æœº}\]</span></p><p><span class="math display">\[P_{ç›¸æœº} =P_{ç‰©ä½“}M_{ç‰©ä½“\rightarrowç›¸æœº}\]</span></p></li></ol></li><li><p>å˜æ¢åˆ†ç±»</p><ol type="1"><li>çº¿æ€§å˜æ¢</li><li>ä»¿å°„å˜æ¢ï¼ˆçº¿æ€§å˜æ¢è¶…é›†ï¼‰</li><li>å¯é€†å˜æ¢ ï¼ˆå¥‡å¼‚çŸ©é˜µä¸å¯é€†ï¼Œè¡Œåˆ—å¼ä¸ä¸º0ï¼‰</li><li>ç­‰è§’å˜æ¢ (å¤¹è§’å¤§å°æ–¹å‘ä¸å˜,æ‰€æœ‰ç­‰è§’å˜æ¢éƒ½æ˜¯å¯é€†ï¼Œä»¿å°„å˜æ¢)</li><li>æ­£äº¤å˜æ¢ (å‚ç›´å˜æ¢ï¼Œåˆ‡ä¸ç¼©æ”¾)</li><li>åˆšä½“å˜æ¢</li></ol></li><li><p>4x4é½æ¬¡çŸ©é˜µ</p></li><li><p>çŸ©é˜µå½¢å¼çš„ä¼˜ç¼ºç‚¹</p><ol type="1"><li>ä¼˜ç‚¹<ol type="1"><li>å¯ç«‹å³å˜æ¢</li><li>è¢«å›¾å½¢apiä½¿ç”¨</li><li>å¤šä¸ªè§’ä½ç§»è¿æ¥</li><li>çŸ©é˜µçš„é€†</li></ol></li><li>ç¼ºç‚¹<ol type="1"><li>å ç”¨æ›´å¤šå†…å­˜</li><li>ä½¿ç”¨éš¾åº¦</li><li>å¯èƒ½å¤šä½™æ•°æ®çš„ç´¯èµ˜</li></ol></li></ol></li></ol>]]></content>
      
      
      <categories>
          
          <category> 3dæ•°å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼•æ“ </tag>
            
            <tag> 3dæ•°å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>5.æ¬§æ‹‰è§’å’Œå››å…ƒæ•°</title>
      <link href="/2020/09/23/3d-shu-xue/5.ou-la-jiao/"/>
      <url>/2020/09/23/3d-shu-xue/5.ou-la-jiao/</url>
      
        <content type="html"><![CDATA[<p><img src="/imgs\ola.png" style="zoom:80%;"></p><ul><li><p>æ¬§æ‹‰è§’</p><ul><li>æ¬§æ‹‰è§’ æ˜¯å°†æ—‹è½¬åˆ†è§£æˆä¸‰ä¸ªç›¸äº’å‚ç›´çš„åˆ†é‡ï¼Œåˆ†åˆ«æ“ä½œã€‚ä¸‰ä¸ªåˆ†é‡åˆ†åˆ«æ˜¯headingã€pitchã€bank(<strong>æŒ‡çš„æ˜¯æƒ¯æ€§åˆ°ç‰©ä½“åæ ‡ç³»</strong>ï¼‰ã€‚è¿˜æœ‰ä¸€ç§å¸¸ç”¨çš„åå­—rollã€pitchã€yawï¼Œä¸headingã€pitchã€banké¡ºåºç›¸åï¼ˆ<strong>ç‰©ä½“åˆ°æƒ¯æ€§åæ ‡ç³»</strong>ï¼‰ï¼Œ</li><li>å…ˆåæ¬¡åºä¸é‡è¦</li><li>æ¬§æ‹‰è§’ ä¼˜ç¼ºç‚¹<ul><li>ä¼˜ç‚¹<ul><li>ä½¿ç”¨å®¹æ˜“</li><li>ç®€æ´çš„è¡¨è¾¾å¼</li><li>ä»»æ„ä¸‰ä¸ªæ•°éƒ½åˆæ³•</li></ul></li><li>ç¼ºç‚¹<ul><li>ç»™å®šæ–¹ä½çš„è¡¨è¾¾å¼ä¸å”¯ä¸€ï¼ˆ360å‘¨æœŸå€ç»“æœä¸€è‡´ï¼Œæ•°å€¼ä¸åŒã€‚pitch135åº¦ç­‰ä»·äºheading 180ï¼Œpitch45ï¼Œ å†bank 180ï¼‰ï¼Œè‘—å<code>ä¸‡å‘é”(è‡³ä»Šæ²¡æœ‰ç®€å•çš„è§£å†³æ–¹æ¡ˆ)</code></li><li>ä¸¤ä¸ªè§’åº¦é—´çš„æ’å€¼å›°éš¾ï¼ˆï¼‰</li></ul></li></ul></li><li>é™åˆ¶ headingå’Œbankåœ¨ï¼ˆ-180ï¼Œ +180ï¼‰ä¹‹é—´ï¼Œ pitch åœ¨(-90ï¼Œ 90)</li></ul></li><li><p>å››å…ƒæ•°</p></li><li><p>å„ç§æ–¹æ³•æ¯”è¾ƒ</p><table><colgroup><col style="width: 25%"><col style="width: 25%"><col style="width: 25%"><col style="width: 25%"></colgroup><thead><tr class="header"><th>ä»»åŠ¡/æ€§è´¨</th><th>çŸ©é˜µ</th><th>æ¬§æ‹‰è§’</th><th>å››å…ƒæ•°</th></tr></thead><tbody><tr class="odd"><td>åœ¨åæ ‡ç³»é—´æ—‹è½¬ç‚¹</td><td>èƒ½</td><td>ä¸èƒ½ï¼ˆéœ€è¦è½¬æ¢åˆ°çŸ©é˜µï¼‰</td><td>ä¸èƒ½ï¼ˆéœ€è¦è½¬æ¢åˆ°çŸ©é˜µï¼‰</td></tr><tr class="even"><td>è¿æ¥æˆ–å¢é‡æ—‹è½¬</td><td>èƒ½ï¼Œæ¯”å››å…ƒæ•°æ…¢ï¼Œè¿˜éœ€è¦å°å¿ƒçŸ©é˜µè •å˜çš„æƒ…å†µ</td><td>ä¸èƒ½</td><td>èƒ½ï¼Œæ¯”çŸ©é˜µå¿«</td></tr><tr class="odd"><td>æ’å€¼</td><td>ä¸èƒ½</td><td>èƒ½ï¼Œé­é‡ä¸‡å‘é”å’Œå…¶ä»–é—®é¢˜</td><td>Slerp æä¾›å¹³æ»‘æ’å€¼</td></tr><tr class="even"><td>éš¾æ˜“ç¨‹åº¦</td><td>éš¾</td><td>æ˜“</td><td>éš¾</td></tr><tr class="odd"><td>å‚¨å­˜</td><td>9ä¸ªæ•°</td><td>3ä¸ªæ•°</td><td>4ä¸ªæ•°</td></tr><tr class="even"><td>å˜æ¢å”¯ä¸€æ€§</td><td>å”¯ä¸€</td><td>ä¸å”¯ä¸€ï¼Œå¤šç§æˆ–è€…æ— æ•°ç§</td><td>ä¸å”¯ä¸€ï¼Œæœ‰ä¸¤ç§ï¼Œä»–ä»¬ç›¸äº’ä¸ºè´Ÿ</td></tr><tr class="odd"><td>å¯èƒ½å¯¼è‡´éæ³•</td><td>çŸ©é˜µè •å˜</td><td>åˆæ³•</td><td>å¯èƒ½å‡ºç°è¯¯å·®ç´¯è®¡ï¼Œä»è€Œäº§ç”Ÿéæ³•å››å…ƒæ•°</td></tr></tbody></table></li><li><p>å„ç§æ–¹æ³•ä¹‹é—´çš„è½¬æ¢</p><ul><li><p>æ¬§æ‹‰è§’åˆ°çŸ©é˜µ</p><blockquote><p>Hã€Pã€Båˆ†åˆ«ä¸ºheadingã€pitchã€bankçš„æ—‹è½¬çŸ©é˜µï¼Œä»–ä»¬åˆ†åˆ«ç»•yï¼Œxï¼Œzå·¦æ‰‹æ³•åˆ™æ—‹è½¬ã€‚è®¾ headingã€pitchã€bank æ—‹è½¬è§’åˆ†é‡åˆ†åˆ«æ˜¯ hã€pã€båˆ™æ—‹è½¬çŸ©é˜µä¸º åå‘æ“ä½œï¼Œ</p></blockquote></li></ul></li><li><p>æ¬§æ‹‰è§’â€”â€”&gt; çŸ©é˜µ</p><ul><li>æƒ¯æ€§â€”â€”&gt;ç‰©ä½“</li></ul><p><span class="math display">\[  H = R_y(-h)= \begin{bmatrix}   \cos(-h)&amp; 0&amp; -\sin(-h)\\   0&amp; 1&amp; 0\\   \sin(-h)&amp; 0&amp; \cos(-h)  \end{bmatrix}= \begin{bmatrix}   \cos(h)&amp; 0&amp; \sin(h)\\   0&amp; 1&amp; 0\\   -\sin(h)&amp; 0&amp; \cos(h)  \end{bmatrix}  \]</span></p><p><span class="math display">\[  P = R_x(-p)= \begin{bmatrix}   1&amp; 0&amp; 0\\  0&amp; \cos(-p)&amp; \sin(-p)\\   0&amp;-\sin(-p)&amp; \cos(-p)  \end{bmatrix}= \begin{bmatrix}   0&amp; 1&amp; 0\\  0&amp;\cos(p)&amp; -\sin(p)\\  0&amp; \sin(p)&amp;  \cos(p)  \end{bmatrix}  \]</span></p><p><span class="math display">\[  B = R_z(-b)= \begin{bmatrix}  \cos(-b)&amp; \sin(-b)&amp;0\\   -\sin(-b)&amp; \cos(-b)&amp;0\\   0&amp; 0&amp; 1  \end{bmatrix}= \begin{bmatrix}  \cos(b)&amp; -\sin(b)&amp;0\\  \sin(b)&amp;  \cos(b)&amp;0\\   0&amp; 0&amp; 1  \end{bmatrix}  \]</span></p><p><span class="math display">\[  M_{æƒ¯æ€§\rightarrowç‰©ä½“} = HPB =\begin{bmatrix}   \cos(h)&amp; 0&amp; \sin(h)\\   0&amp; 1&amp; 0\\   -\sin(h)&amp; 0&amp; \cos(h)  \end{bmatrix}\begin{bmatrix}   0&amp; 1&amp; 0\\  0&amp;\cos(p)&amp; -\sin(p)\\  0&amp; \sin(p)&amp;  \cos(p)  \end{bmatrix}\begin{bmatrix}  \cos(b)&amp; -\sin(b)&amp;0\\  \sin(b)&amp;  \cos(b)&amp;0\\   0&amp; 0&amp; 1  \end{bmatrix}  \]</span></p><p><span class="math display">\[  =\begin{bmatrix}  \cos(h)\cos(b) + \sin(h)\sin(p)\sin(b)&amp; -\cos(h)\sin(b) +\sin(h)\sin(p)\sin(b)&amp; \sin(h)\cos(p)\\  \sin(b)\cos(p)                        &amp;\cos(b)\sin(p)                         &amp; -\sin(p)\\  \sin(h)\cos(b) + \cos(h)\sin(p)\sin(b)&amp; \sin(b)\sin(h) +\cos(h)\cos(p)\cos(b)&amp; \cos(h)\cos(p)\\  \end{bmatrix}  \]</span></p><ul><li><p>ç‰©ä½“â€”â€”&gt;æƒ¯æ€§</p></li><li><p>çŸ©é˜µ â€”â€”&gt; æ¬§æ‹‰è§’</p></li><li><p>å››å…ƒæ•° â€”â€”&gt; çŸ©é˜µ</p></li><li><p>çŸ©é˜µ â€”â€”&gt; å››å…ƒæ•°</p></li><li><p>æ¬§æ‹‰è§’ â€”â€”&gt; å››å…ƒæ•°</p></li><li><p>å››å…ƒæ•° â€”â€”&gt; æ¬§æ‹‰è§’</p></li><li><p>ä»£ç å®ç° EulerAnglesã€Quaternionã€RotationMatrixã€Matrix4x3</p><ul><li>todo</li></ul></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> 3dæ•°å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼•æ“ </tag>
            
            <tag> 3dæ•°å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>6.å‡ ä½•å›¾å…ƒ</title>
      <link href="/2020/09/23/3d-shu-xue/6.ji-he-tu-yuan/"/>
      <url>/2020/09/23/3d-shu-xue/6.ji-he-tu-yuan/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å›¾å…ƒä¸€èˆ¬æ–¹æ³•ã€ç›´çº¿å’Œå°„çº¿ã€çƒå’Œåœ†ã€çŸ©å½¢è¾¹ç•Œæ¡†ã€å¹³é¢ã€ä¸‰è§’å½¢ã€å¤šè¾¹å½¢ã€‚</p></blockquote><ul><li><p>è¡¨ç¤ºå½¢å¼</p><ul><li>éšå¼è¡¨ç¤ºï¼Œ å¦‚æ–¹ç¨‹å¼ï¼Œå‡½æ•°</li><li>æ˜¾å¼è¡¨ç¤ºï¼Œå¦‚çº¿æ®µçš„èµ·ç‚¹å’Œç»ˆç‚¹ã€‚</li></ul></li><li><p>ç›´çº¿å’Œå°„çº¿</p><ul><li>ç›´çº¿ ä¸¤ä¸ªæ–¹å‘æ— é™å»¶ä¼¸ã€‚</li><li>çº¿æ®µ ç›´çº¿çš„æœ‰é™éƒ¨åˆ†ï¼Œæœ‰ä¸¤ä¸ªç«¯ç‚¹</li><li>å°„çº¿ä¸€ä¸ªæ–¹å‘æ— é™å»¶ä¼¸ï¼Œ<strong>è®¡ç®—æœºå‡ ä½•ä¸­ï¼Œå®šä¹‰å°„çº¿æ˜¯æœ‰å‘çº¿æ®µ</strong></li></ul></li><li><p>çŸ©å½¢è¾¹ç•Œæ¡† AABBï¼Œ <span class="math display">\[x_{min} &lt; x &lt; x_{max},    y_{min} &lt; y &lt; y_{max},  z_{min}&lt; z &lt; z_{max},\]</span></p></li><li><p>å¹³é¢æ–¹ç¨‹</p><ul><li><p>éšå¼å®šä¹‰ p å’Œæ³•çº¿n</p></li><li><p>ä¸‰ç‚¹å®šä¹‰ p1ã€p2ã€p3</p></li></ul></li><li><p>ç‚¹åˆ°å¹³é¢è·ç¦»ã€‚ ç‚¹å’Œå¹³é¢å†…ä¸€ç‚¹çš„å‘é‡ï¼Œå‘æ³•çº¿æŠ•å½±çš„é•¿åº¦ã€‚</p></li><li><p>ä¸‰è§’å½¢é¢ç§¯</p><ul><li><p>ä¸€ç­ç®—æ³• <span class="math display">\[    s = bh/2ï¼Œ båº•è¾¹ï¼Œhä¸ºé«˜  \]</span></p></li><li><p>æµ·ä¼¦å…¬å¼ï¼š<br><span class="math display">\[    s = \frac{l_1+l_2+l_3}{2}, lä¸ºè¾¹é•¿ï¼Œ sä¸ºå‘¨é•¿ä¸€åŠã€‚  \]</span></p><p><span class="math display">\[  é¢ç§¯ A =\sqrt{s(s - l_1)(s-l_2)(s-l_3)}  \]</span></p></li></ul></li><li><p>ç‰¹æ®Šç‚¹ï¼š</p><ul><li>é‡å¿ƒï¼Œä¸‰æ¡è¾¹ä¸­çº¿äº¤ç‚¹ï¼Œä¹Ÿå«è´¨å¿ƒã€‚</li><li>å†…å¿ƒï¼Œåˆ°ä¸‰æ¡è¾¹è·ç¦»ç›¸ç­‰</li><li>å¤–å¿ƒ åˆ°ä¸‰ä¸ªé¡¶ç‚¹è·ç¦»ç›¸ç­‰ã€‚</li></ul></li><li><p>å‡¹å‡¸å¤šè¾¹å½¢åˆ¤æ–­ todo</p></li><li><p>å‡ ä½•æ£€æµ‹</p></li><li><p>ä¸‰è§’ç½‘æ ¼</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 3dæ•°å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼•æ“ </tag>
            
            <tag> 3dæ•°å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>7.å‡ ä½•å›¾å…ƒ</title>
      <link href="/2020/09/23/3d-shu-xue/7.tu-xing-shu-xue/"/>
      <url>/2020/09/23/3d-shu-xue/7.tu-xing-shu-xue/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> 3dæ•°å­¦ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¼•æ“ </tag>
            
            <tag> 3dæ•°å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
